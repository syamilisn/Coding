cscope 15 $HOME/Kaiwan               0001441177
	@Books/Hands-on-System-Programming-with-Linux/A_fileio/fork_printf_1.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<sig«l.h
>

21 
	~<°rög.h
>

22 
	~<uni°d.h
>

23 
	~"../comm⁄.h
"

25 
	$maö
(
¨gc
, **
¨gv
)

27 
	`f‹k
();

28 
	`¥ötf
("Hello, world. ");

29 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/A_fileio/fork_printf_2.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<sig«l.h
>

21 
	~<°rög.h
>

22 
	~<uni°d.h
>

23 
	~"../comm⁄.h
"

25 
	$maö
(
¨gc
, **
¨gv
)

27 
	`¥ötf
("Hello, world. ");

28 
	`f‹k
();

29 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/A_fileio/io_setbuf.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<sig«l.h
>

21 
	~<°rög.h
>

22 
	~<uni°d.h
>

23 
	~<î∫o.h
>

24 
	~<sys/ty≥s.h
>

25 
	~<sys/°©.h
>

26 
	~<f˙é.h
>

27 
	~"../comm⁄.h
"

29 
	#MIN
(
x
,
y
Ë((x)<(y)?(x):(y))

	)

30 
	#NREAD
 512

	)

32 
	ggVîbo£
 = 1;

33 *
	ggbuf
;

35 *
	giow_buf
, *
	gi‹_buf
;

36 
size_t
 
	gbufsz
 = 0;

38 
	$ã°ô
(
FILE
 * 
wr°rm
, FILE * 
rd°rm
, 
numio
)

40 
i
;

41 
size_t
 
‚r
 = 0;

43 
	`VPRINT
("numio=%dÅotalÑdwr=%uÉxpected #Ñw syscalls=%ld\n",

44 
numio
, 
NREAD
 *Çumio, 
	`MIN
“umio, NREAD *Çumiÿ/ 
bufsz
));

46 
i
 = 0; i < 
numio
; i++) {

47 
‚r
 = 
	`‰ód
(
gbuf
, 1, 
NREAD
, 
rd°rm
);

48 i‡(!
‚r
)

49 
	`FATAL
("fread on /dev/urandom failed\n");

51 i‡(!
	`fwrôe
(
gbuf
, 1, 
‚r
, 
wr°rm
)) {

52 
	`‰ì
(
gbuf
);

53 i‡(
	`„of
(
wr°rm
))

55 i‡(
	`„º‹
(
wr°rm
))

56 
	`FATAL
("fwrite on our file failed\n");

59 
	}
}

62 
	$¥öt_io°©s
()

64 
cmd
[128];

65 
	`¢¥ötf
(
cmd
, 127, "ˇà/¥oc/%d/io", 
	`gëpid
());

66 ()
	`sy°em
(
cmd
);

67 
	}
}

69 
	$maö
(
¨gc
, **
¨gv
)

71 *
‚ame
 = "/tmp/iobuf_tmp";

72 
FILE
 *
wÂ
 = 
NULL
, *
rÂ
 = NULL;

73 
numio
;

75 i‡(
¨gc
 != 3) {

76 
	`Ârötf
(
°dîr
,

78 
¨gv
[0]);

79 
	`exô
(
EXIT_FAILURE
);

82 
î∫o
 = 0;

83 
bufsz
 = 
	`°πoul
(
¨gv
[1], 0, 0);

84 i‡(
î∫o
 =
ERANGE
 ||Éºnÿ=
EINVAL
)

85 
	`FATAL
("Invalid size input [strtoul]\n");

87 
numio
 = 
	`©oi
(
¨gv
[2]);

88 i‡(
numio
 <0 || 
bufsz
 <= 0) {

89 
	`Ârötf
(
°dîr
,

91 
¨gv
[0]);

92 
	`exô
(
EXIT_FAILURE
);

95 
	`¥ötf
("%s: setting our IO RW buffersÅo size %zu bytes; # IOs=%d\n",

96 
¨gv
[0], 
bufsz
, 
numio
);

99 
iow_buf
 = 
	`mÆloc
(
bufsz
);

100 i‡(!
iow_buf
)

101 
	`FATAL
("mÆlo¯%zu faûed!\n", 
bufsz
);

104 
i‹_buf
 = 
	`mÆloc
(
bufsz
);

105 i‡(!
i‹_buf
)

106 
	`FATAL
("mÆlo¯%zu faûed!\n", 
bufsz
);

108 
gbuf
 = 
	`mÆloc
(
NREAD
);

109 i‡(!
gbuf
)

110 
	`FATAL
("mÆlo¯%zu faûed!\n", 
NREAD
);

112 
	`u∆ök
(
‚ame
);

113 
wÂ
 = 
	`f›í
(
‚ame
, "a");

114 i‡(!
wÂ
)

115 
	`FATAL
("f›í o¿%†Áûed\n", 
‚ame
);

117 
rÂ
 = 
	`f›í
("/dev/urandom", "r");

118 i‡(!
rÂ
)

119 
	`FATAL
("fopen on /dev/urandom failed\n");

124 i‡(
	`£tvbuf
(
rÂ
, 
i‹_buf
, 
_IOFBF
, 
bufsz
))

125 
	`FATAL
("setvbuf onÑead buffer failed\n");

126 i‡(
	`£tvbuf
(
wÂ
, 
iow_buf
, 
_IOFBF
, 
bufsz
))

127 
	`FATAL
("setvbuf on write buffer failed\n");

129 
	`ã°ô
(
wÂ
, 
rÂ
, 
numio
);

130 
	`f˛o£
(
rÂ
);

131 
	`f˛o£
(
wÂ
);

132 
	`¥öt_io°©s
();

133 
	`‰ì
(
gbuf
);

135 
	`exô
(
EXIT_SUCCESS
);

136 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/A_fileio/iobuf.c

16 
	#_GNU_SOURCE


	)

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<sig«l.h
>

20 
	~<°rög.h
>

21 
	~<uni°d.h
>

22 
	~<î∫o.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/°©.h
>

25 
	~<f˙é.h
>

26 
	~"../comm⁄.h
"

28 
	#NREAD
 512

	)

30 
	ggVîbo£
 = 1;

31 *
	ggbuf
 = 
NULL
;

33 
	$ã°ô
(
FILE
 * 
wr°rm
, FILE * 
rd°rm
, 
numio
)

35 
i
, 
sysˇŒs
 = 
NREAD
 * 
numio
 / 
	`gë∑gesize
();

36 
size_t
 
‚r
 = 0;

38 i‡(
sysˇŒs
 <= 0)

39 
sysˇŒs
 = 1;

40 
	`VPRINT
("numio=%dÅotalÑdwr=%uÉxpected #Ñw syscalls=%d\n",

41 
numio
, 
NREAD
 *Çumio, 
sysˇŒs
);

43 
i
 = 0; i < 
numio
; i++) {

44 
‚r
 = 
	`‰ód
(
gbuf
, 1, 
NREAD
, 
rd°rm
);

45 i‡(!
‚r
)

46 
	`FATAL
("fread on /dev/urandom failed\n");

48 i‡(!
	`fwrôe
(
gbuf
, 1, 
‚r
, 
wr°rm
)) {

49 
	`‰ì
(
gbuf
);

50 i‡(
	`„of
(
wr°rm
))

52 i‡(
	`„º‹
(
wr°rm
))

53 
	`FATAL
("fwrite on our file failed\n");

56 
	}
}

58 
	$maö
(
¨gc
, **
¨gv
)

60 *
‚ame
 = "/tmp/iobuf_tmp";

61 
FILE
 *
wÂ
 = 
NULL
, *
rÂ
 = NULL;

62 
numio
;

64 i‡(
¨gc
 != 2) {

65 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-times-to-rdwr\n", 
¨gv
[0]);

66 
	`exô
(
EXIT_FAILURE
);

68 
numio
 = 
	`©oi
(
¨gv
[1]);

69 i‡(
numio
 <= 0) {

70 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-times-to-rdwr\n", 
¨gv
[0]);

71 
	`exô
(
EXIT_FAILURE
);

74 
¥ötf


76 
¨gv
[0], 
	`gë∑gesize
(), 
numio
);

78 
gbuf
 = 
	`mÆloc
(
NREAD
);

79 i‡(!
gbuf
)

80 
	`FATAL
("mÆlo¯%zu faûed!\n", 
NREAD
);

82 
	`u∆ök
(
‚ame
);

83 
wÂ
 = 
	`f›í
(
‚ame
, "a");

84 i‡(!
wÂ
)

85 
	`FATAL
("f›í o¿%†Áûed\n", 
‚ame
);

87 
rÂ
 = 
	`f›í
("/dev/urandom", "r");

88 i‡(!
rÂ
)

89 
	`FATAL
("fopen on /dev/urandom failed\n");

91 
	`ã°ô
(
wÂ
, 
rÂ
, 
numio
);

92 
	`f˛o£
(
rÂ
);

93 
	`f˛o£
(
wÂ
);

94 
	`‰ì
(
gbuf
);

96 
	`exô
(
EXIT_SUCCESS
);

97 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/A_fileio/mode_def.c

16 
	#_GNU_SOURCE


	)

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<sig«l.h
>

20 
	~<°rög.h
>

21 
	~<uni°d.h
>

22 
	~<sys/ty≥s.h
>

23 
	~<sys/°©.h
>

24 
	~<f˙é.h
>

25 
	~"../comm⁄.h
"

27 
	$maö
(
¨gc
, **
¨gv
)

29 
fd
;

31 i‡(
¨gc
 != 2) {

32 
	`Ârötf
(
°dîr
, "Ußge: %†√w-fûe-∑th«me\n", 
¨gv
[0]);

33 
	`exô
(
EXIT_FAILURE
);

36 
fd
 = 
	`›í
(
¨gv
[1], 
O_CREAT
 | 
O_RDONLY
);

38 
	`umask
(0);

39 
fd
 = 
	`›í
(
¨gv
[1], 
O_CREAT
,

40 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IWGRP
 | 
S_IROTH
);

42 i‡(
fd
 < 0)

43 
	`FATAL
("›í o¿%†Áûed\n", 
¨gv
[1]);

45 
	`¥ötf
("Cuºíà£ekÖosôi⁄: %ld\n", 
	`l£ek
(
fd
, 0, 
SEEK_CUR
));

46 
	`˛o£
(
fd
);

47 
	`exô
(
EXIT_SUCCESS
);

48 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/A_fileio/redirct.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<sig«l.h
>

22 
	~<°rög.h
>

23 
	~<uni°d.h
>

24 
	~"../comm⁄.h
"

26 
	$maö
(
¨gc
, **
¨gv
)

28 
FILE
 *
Âlog
 = 
NULL
, *
pÂ
 = NULL, *
Â
 = NULL;

29 
	#DTMAX
 256

	)

30 
dt
[
DTMAX
];

31 *
junk
 = "abcxyz";

33 i‡(
¨gc
 != 2) {

34 
	`Ârötf
(
°dîr
, "Ußge: %†logfûe\n", 
¨gv
[0]);

35 
	`exô
(
EXIT_FAILURE
);

39 
Âlog
 = 
	`‰e›í
(
¨gv
[1], "a", 
°dout
);

40 i‡(!
Âlog
)

41 
	`FATAL
("‰e›í stdouà⁄ %†Áûed\n", 
¨gv
[1]);

43 
Âlog
 = 
	`‰e›í
(
¨gv
[1], "a", 
°dîr
);

44 i‡(!
Âlog
)

45 
	`FATAL
("‰e›í stdî∏⁄ %†Áûed\n", 
¨gv
[1]);

48 i‡(!(
pÂ
 = 
	`p›í
("date", "r")))

49 
	`FATAL
("popen (date) failed\n");

50 i‡(!
	`fgës
(
dt
, 
DTMAX
, 
pÂ
)) {

51 
	`WARN
("fgets (date) failed\n");

52 
	`°∫˝y
(
dt
, "---", 4);

54 
dt
[
	`°æí
(dt) - 1] = '\0';

55 
	`p˛o£
(
pÂ
);

58 
	`¥ötf
("%s:%s:cuºíà£ekÖosôi⁄: %ld\n", 
¨gv
[0], 
dt
, 
	`·ñl
(
Âlog
));

61 i‡(!(
Â
 = 
	`f›í
(
junk
, "r"))) {

62 
	`Ârötf
(
°dîr
, "%s:%s:f›í o¿%†Áûed\n", 
¨gv
[0], 
dt
,

63 
junk
);

64 
	`≥º‹
(" fopen");

65 
	`f˛o£
(
Âlog
);

66 
	`exô
(
EXIT_SUCCESS
);

69 
	`f˛o£
(
Â
);

70 
	`f˛o£
(
Âlog
);

71 
	`exô
(
EXIT_SUCCESS
);

72 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/A_fileio/simpcp1.c

19 
	#_GNU_SOURCE


	)

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<°rög.h
>

23 
	~<uni°d.h
>

24 
	~<sys/ty≥s.h
>

25 
	~<sys/°©.h
>

26 
	~<f˙é.h
>

27 
	~"../comm⁄.h
"

29 
	ggVîbo£
 = 0;

37 
	$doc›y
(*
§c
, 
fd_§c
, 
fd_de°
)

39 *
buf
 = 
NULL
;

40 
°©
 
sb
;

41 
size_t
 
n
 = 0;

42 
ssize_t
 
ƒ
 = 0, 
nw
 = 0;

43 
lo›
 = 1;

45 
	`mem£t
(&
sb
, 0, (
°©
));

46 i‡(
	`°©
(
§c
, &
sb
) < 0) {

47 
	`WARN
("°© o¿%†Áûed\n", 
§c
);

50 
	`VPRINT
("%s: size=%ld Block size for filesystem I/O = %ld bytes\n",

51 
§c
, 
sb
.
°_size
, sb.
°_blksize
);

52 
n
 = 
sb
.
°_blksize
;

54 
buf
 = 
	`mÆloc
(
sb
.
°_blksize
);

55 i‡(!
buf
) {

56 
	`WARN
("mÆlo¯(%ldËÁûed!\n", 
sb
.
°_blksize
);

60 
	`VPRINT
("Expected #Üoop iterations: %ld [+1 forÑem %ld bytes]\n\n",

61 
sb
.
°_size
 / 
n
, sb.st_size %Ç);

64 
ƒ
 = 
	`ªad
(
fd_§c
, 
buf
, 
n
);

65 
	`VPRINT
("%06d:Ñód %9ld ", 
lo›
, 
ƒ
);

66 i‡(
ƒ
 < 0) {

67 
	`WARN
("read on src failed\n");

68 
	`‰ì
(
buf
);

70 } i‡(
ƒ
 == 0)

73 
nw
 = 
	`wrôe
(
fd_de°
, 
buf
, 
ƒ
);

74 
	`VPRINT
("wrŸê%9ld\n", 
nw
);

75 i‡(
nw
 < 0) {

76 
	`WARN
("write on dest failed\n");

77 
	`‰ì
(
buf
);

80 
lo›
++;

83 
	`‰ì
(
buf
);

85 
	}
}

87 
	$maö
(
¨gc
, **
¨gv
)

89 
fdr
, 
fdw
, 
ªt
 = 0;

91 i‡(
¨gc
 < 3) {

92 
	`Ârötf
(
°dîr
, "Usage: %s source-file destination-file"

93 " [1 f‹ vîbo£-mode]\n", 
¨gv
[0]);

94 
	`exô
(
EXIT_FAILURE
);

96 i‡(
¨gc
 =4 && (!
	`°rcmp
(
¨gv
[3], "1")))

97 
gVîbo£
 = 1;

100 
fdr
 = 
	`›í
(
¨gv
[1], 
O_RDONLY
);

101 i‡(
fdr
 < 0)

102 
	`FATAL
("open on source file \"%s\" failed,áborting.\n",

103 
¨gv
[1]);

106 
fdw
 = 
	`›í
(
¨gv
[2], 
O_CREAT
 | 
O_WRONLY
,

107 
S_IWUSR
 | 
S_IRUSR
 | 
S_IRGRP
 | 
S_IROTH
);

108 i‡(
fdw
 < 0)

109 
	`FATAL
("open on destination file \"%s\" failed,áborting.\n",

110 
¨gv
[2]);

112 i‡((
ªt
 = 
	`doc›y
(
¨gv
[1], 
fdr
, 
fdw
)) < 0) {

113 
	`˛o£
(
fdr
);

114 
	`˛o£
(
fdw
);

115 
	`FATAL
("doc›y(ËÁûed: (°©=%d)\n", 
ªt
);

117 i‡(
gVîbo£
 == 1)

118 
	`¥ötf
("\n");

120 
	`˛o£
(
fdr
);

121 
	`˛o£
(
fdw
);

123 
	`exô
(
EXIT_SUCCESS
);

124 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/A_fileio/simpcp2.c

25 
	#_GNU_SOURCE


	)

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°rög.h
>

29 
	~<uni°d.h
>

30 
	~<sys/ty≥s.h
>

31 
	~<sys/°©.h
>

32 
	~<f˙é.h
>

33 
	~"../comm⁄.h
"

35 
	ggVîbo£
 = 0;

37 
	$fd_ªad
(
fd
, *
dbuf
, 
size_t
 
n
)

39 
ssize_t
 
rd
 = 0;

40 
size_t
 
å
 = 0;

43 
rd
 = 
	`ªad
(
fd
, 
dbuf
, 
n
);

44 i‡(
rd
 < 0)

46 i‡(
rd
 == 0)

48 
å
 +
rd
;

49 #ifde‡
DEBUG


50 
	`¥ötf
("Ñeque°ed=%9lu,á˘uÆrd=%9zu,ÅŸÆrd=%9zu\n", 
n
, 
rd
,

51 
å
);

53 } 
å
 < 
n
);

54  
å
;

55 
	}
}

57 
	$fd_wrôe
(
fd
, *
sbuf
, 
size_t
 
n
)

59 
ssize_t
 
wr
 = 0;

60 
size_t
 
tw
 = 0;

63 
wr
 = 
	`wrôe
(
fd
, 
sbuf
, 
n
);

64 i‡(
wr
 < 0)

66 
tw
 +
wr
;

67 #ifde‡
DEBUG


68 
	`¥ötf
("Ñeque°ed=%9zu,á˘uÆwr=%9zu,ÅŸÆwr=%9lu\n", 
n
, 
wr
,

69 
tw
);

71 } 
tw
 < 
n
);

72  
tw
;

73 
	}
}

81 
	$doc›y
(*
§c
, 
fd_§c
, 
fd_de°
)

83 *
buf
 = 
NULL
;

84 
°©
 
sb
;

85 
size_t
 
n
 = 0;

86 
ssize_t
 
ƒ
 = 0, 
nw
 = 0;

87 
lo›
 = 1;

89 
	`mem£t
(&
sb
, 0, (
°©
));

90 i‡(
	`°©
(
§c
, &
sb
) < 0) {

91 
	`WARN
("°© o¿%†Áûed\n", 
§c
);

94 
	`VPRINT
("%s: size=%ld Block size for filesystem I/O = %ld bytes\n",

95 
§c
, 
sb
.
°_size
, sb.
°_blksize
);

96 
n
 = 
sb
.
°_blksize
;

98 
buf
 = 
	`mÆloc
(
sb
.
°_blksize
);

99 i‡(!
buf
) {

100 
	`WARN
("mÆlo¯(%ldËÁûed!\n", 
sb
.
°_blksize
);

104 
	`VPRINT
("Expected #Üoop iterations: %ld [+1 forÑem %ld bytes]\n\n",

105 
sb
.
°_size
 / 
n
, sb.st_size %Ç);

108 
ƒ
 = 
	`fd_ªad
(
fd_§c
, 
buf
, 
n
);

109 
	`VPRINT
("%06d:Ñód %9ld ", 
lo›
, 
ƒ
);

110 i‡(
ƒ
 < 0) {

111 
	`WARN
("read on src failed\n");

112 
	`‰ì
(
buf
);

114 } i‡(
ƒ
 == 0)

117 
nw
 = 
	`fd_wrôe
(
fd_de°
, 
buf
, 
ƒ
);

118 
	`VPRINT
("wrŸê%9ld\n", 
nw
);

119 i‡(
nw
 < 0) {

120 
	`WARN
("write on dest failed\n");

121 
	`‰ì
(
buf
);

124 
lo›
++;

127 
	`‰ì
(
buf
);

129 
	}
}

131 
	$maö
(
¨gc
, **
¨gv
)

133 
fdr
, 
fdw
, 
ªt
 = 0;

134 
°©
 
sb
;

136 i‡(
¨gc
 < 3) {

137 
	`Ârötf
(
°dîr
, "Usage: %s source-file destination-file"

138 " [1 f‹ vîbo£-mode]\n", 
¨gv
[0]);

139 
	`exô
(
EXIT_FAILURE
);

141 i‡(
¨gc
 =4 && (!
	`°rcmp
(
¨gv
[3], "1")))

142 
gVîbo£
 = 1;

145 
fdr
 = 
	`›í
(
¨gv
[1], 
O_RDONLY
);

146 i‡(
fdr
 < 0)

147 
	`FATAL
("open on source file \"%s\" failed,áborting.\n",

148 
¨gv
[1]);

151 i‡(
	`°©
(
¨gv
[1], &
sb
) < 0)

152 
	`FATAL
("°© o¿%†Áûed\n", 
¨gv
[1]);

153 
	`VPRINT
("%†mode=%ÿ(o˘Æ)\n", 
¨gv
[1], 
sb
.
°_mode
 & 
ACCESSPERMS
);

157 
fdw
 = 
	`›í
(
¨gv
[2], 
O_CREAT
 | 
O_WRONLY
, 
sb
.
°_mode
 & 
ACCESSPERMS
);

158 i‡(
fdw
 < 0)

159 
	`FATAL
("open on destination file \"%s\" failed,áborting.\n",

160 
¨gv
[2]);

162 i‡((
ªt
 = 
	`doc›y
(
¨gv
[1], 
fdr
, 
fdw
)) < 0) {

163 
	`˛o£
(
fdr
);

164 
	`˛o£
(
fdw
);

165 
	`FATAL
("doc›y(ËÁûed: (°©=%d)\n", 
ªt
);

167 i‡(
gVîbo£
 == 1)

168 
	`¥ötf
("\n");

170 
	`˛o£
(
fdr
);

171 
	`˛o£
(
fdw
);

173 
	`exô
(
EXIT_SUCCESS
);

174 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/A_fileio/streamio1.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<sig«l.h
>

22 
	~<°rög.h
>

23 
	~<uni°d.h
>

24 
	~"../comm⁄.h
"

26 
	$maö
(
¨gc
, **
¨gv
)

28 
FILE
 *
Â
 = 
NULL
;

30 i‡(
¨gc
 != 3) {

31 
	`Ârötf
(
°dîr
, "Ußge: %†∑th«mê{mode=b|e}\n", 
¨gv
[0]);

32 
	`exô
(
EXIT_FAILURE
);

35 i‡(!
	`°∫cmp
(
¨gv
[2], "b", 1))

36 
Â
 = 
	`f›í
(
¨gv
[1], "r");

37 i‡(!
	`°∫cmp
(
¨gv
[2], "e", 1))

38 
Â
 = 
	`f›í
(
¨gv
[1], "a");

40 
	`Ârötf
(
°dîr
, "Ußge: %†∑th«mê{mode=b|e}\n", 
¨gv
[0]);

41 
	`exô
(
EXIT_FAILURE
);

43 i‡(!
Â
)

44 
	`FATAL
("f›í o¿%†Áûed\n", 
¨gv
[1]);

46 
	`¥ötf
("Cuºíà£ekÖosôi⁄: %ld\n", 
	`·ñl
(
Â
));

47 
	`f˛o£
(
Â
);

48 
	`exô
(
EXIT_SUCCESS
);

49 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/B_daemon/daemon_trad.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<î∫o.h
>

22 
	~<sig«l.h
>

23 
	~<°rög.h
>

24 
	~<sys/time.h
>

25 
	~<sys/ty≥s.h
>

26 
	~<sys/ªsour˚.h
>

27 
	~<sys/°©.h
>

28 
	~<f˙é.h
>

29 
	~"../comm⁄.h
"

31 
	#SET_TO_NULDEV
(
‹ig_fd
, 
√w_fd
) do { \

32 i‡(
	`dup2
(
‹ig_fd
, 
√w_fd
) < 0) { \

33 
	`WARN
("dup2(" #orig_fd ", " #new_fd ") failed\n"); \

36 } 0)

	)

47 
	$d´m⁄ize_åadôi⁄Æ
()

49 
i
, 
fd_nuŒ
;

50 
æimô
 
æim
;

51 
siga˘i⁄
 
a˘
;

52 
sig£t_t
 
sigmask
;

61 i‡(
	`¥limô
(0, 
RLIMIT_NOFILE
, 0, &
æim
) < 0) {

62 
	`WARN
("prlimit RLIMIT_NOFILE failed\n");

65 
	`¥ötf
("%d:%s: [+] step 1 : close fd's (3Åo %ld)\n",

66 
	`gëpid
(), 
__func__
, 
æim
.
æim_max
);

67 
i
 = 3; i < 
æim
.
æim_max
; i++)

68 ()
	`˛o£
(
i
);

74 
	`¥ötf
("%d:%s: [+] step 2 :Ñeset signalsÅo default\n",

75 
	`gëpid
(), 
__func__
);

76 
	`mem£t
(&
a˘
, 0, (act));

77 
a˘
.
ß_h™dÀr
 = 
SIG_DFL
;

78 
i
 = 1; i < 
_NSIG
; i++) {

79 i‡((
i
 =
SIGKILL
) ||

80 (
i
 =
SIGSTOP
) || (i == 32) || (i == 33))

82 i‡(
	`siga˘i⁄
(
i
, &
a˘
, 0) == -1) {

83 
	`WARN
("siga˘i⁄ %d faûed\n", 
i
);

89 
	`¥ötf
("%d:%s: [+] sã∞3 :Ñe£àsig«»mask\n", 
	`gëpid
(), 
__func__
);

90 i‡(
	`sigem±y£t
(&
sigmask
) < 0) {

91 
	`WARN
("sigemptyset failed\n");

100 
	`¥ötf
("%d:%s: [+] sã∞5 : fú° f‹k\n", 
	`gëpid
(), 
__func__
);

101 
	`f‹k
()) {

103 
	`WARN
("fork #1 failed!\n");

108 
	`¥ötf
("%d:%s: [+] step 6 : createÇew session\n",

109 
	`gëpid
(), 
__func__
);

110 i‡(
	`£tsid
() < 0) {

111 
	`WARN
("setsid failed\n");

117 
	`¥ötf
("%d:%s: [+] sã∞7 : sec⁄d f‹k\n", 
	`gëpid
(), 
__func__
);

118 
	`f‹k
()) {

120 
	`WARN
("fork #2 failed!\n");

123 
	`¥ötf
(" %d:%s:Åhe ACTUAL DAEMON !\n",

124 
	`gëpid
(), 
__func__
);

128 
¥ötf


130 
	`gëpid
(), 
__func__
);

131 
fd_nuŒ
 = 
	`›í
("/dev/nuŒ", 
O_RDWR
);

132 i‡(
fd_nuŒ
 < 0) {

133 
	`WARN
("open onÇull dev failed\n");

138 
	`SET_TO_NULDEV
(
fd_nuŒ
, 
STDIN_FILENO
);

139 
	`SET_TO_NULDEV
(
fd_nuŒ
, 
STDOUT_FILENO
);

140 
	`SET_TO_NULDEV
(
fd_nuŒ
, 
STDERR_FILENO
);

142 
	`˛o£
(
fd_nuŒ
);

147 
¥ötf


149 
	`gëpid
(), 
__func__
);

150 
	`umask
(0x0);

155 
¥ötf


157 
	`gëpid
(), 
__func__
);

158 i‡(
	`chdú
("/") < 0) {

159 
	`WARN
("chdirÅo '/' failed\n");

170 
¥ötf


173 
	`gëpid
(), 
__func__
);

183 
¥ötf


186 
	`gëpid
(), 
__func__
);

193 
¥ötf


196 
	`gëpid
(), 
__func__
);

198 
	`∑u£
();

199 
	`exô
(
EXIT_SUCCESS
);

209 
	`¥ötf
("%d:%s: [+] step 8 : first childÉxit\n",

210 
	`gëpid
(), 
__func__
);

211 
	`exô
(
EXIT_SUCCESS
);

218 
	`¥ötf
(

220 
	`gëpid
(), 
__func__
);

221 
	`exô
(
EXIT_SUCCESS
);

225 
	}
}

228 
ölöe
 
	$ußge
(*
«me
)

230 
	`Ârötf
(
°dîr
, "Usage: %sÜock-or-not\n"

231 " 0 : dÿNŸÜock (buggy!)\n" " 1 : dÿlock (c‹ª˘)\n", 
«me
);

232 
	}
}

235 
	$maö
(
¨gc
, **
¨gv
)

237 
ªt
;

244 i‡((
ªt
 = 
	`d´m⁄ize_åadôi⁄Æ
()) < 0)

245 
	`¥ötf
("FaûedÅÿd´m⁄izê—ødôi⁄Æ):Éº codê%d\n", 
ªt
);

246 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch1/getreg.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<°dlib.h
>

23 
	tu64
;

25 
u64
 
	$gë_rcx
()

27 
__asm__
 
	`__vﬁ©ûe__
("movq $5, %rcx\n\t"

30 
	}
}

32 
	$maö
()

34 
	`¥ötf
("Hñlo, i∆öêas£mbly:\¿rcx = 0x%lx\n", 
	`gë_rcx
());

35 
	`exô
(0);

36 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch1/getreg_cr0.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<°dlib.h
>

23 
	tu64
;

25 
u64
 
	$gë_¸0
()

29 
__asm__
 
	`__vﬁ©ûe__
("movq %cr0, %rax");

31 
	}
}

33 
	$maö
()

35 
	`¥ötf
("Hñlo, i∆öêas£mbly:\¿[CR0] = 0x%lx\n", 
	`gë_¸0
());

36 
	`exô
(0);

37 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch1/getreg_cr3.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<°dlib.h
>

23 
	tu64
;

25 
u64
 
	$gë_¸3
()

29 
__asm__
 
	`__vﬁ©ûe__
(

31 
	}
}

33 
	$maö
()

35 
	`¥ötf
("Hñlo, i∆öêas£mbly:\¿[CR3] = 0x%lx\n", 
	`gë_¸3
());

36 
	`exô
(0);

37 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch1/getreg_rcx.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<°dlib.h
>

23 
	tu64
;

25 
u64
 
	$gë_rcx
()

29 
__asm__
 
	`__vﬁ©ûe__
("push %rcx\n\t"

32 
__asm__
 
	`__vﬁ©ûe__
("pop %rcx");

33 
	}
}

35 
	$maö
()

37 
	`¥ötf
("Hñlo, i∆öêas£mbly:\¿[RCX] = 0x%lx\n", 
	`gë_rcx
());

38 
	`exô
(0);

39 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch1/hello.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<uni°d.h
>

20 
	~<°dlib.h
>

22 
	$maö
()

24 
a
;

26 
	`¥ötf
("Hello, Linux System Programming, World!\n");

27 
a
 = 5;

28 
	`exô
(0);

29 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch1/helloworld.c

17 
	~<°dio.h
>

19 
	$maö
()

21 
	`¥ötf
("hello, world\n");

22 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/fork1.c

16 
	#_GNU_SOURCE


	)

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<sys/ty≥s.h
>

21 
	~"../comm⁄.h
"

23 
	$maö
(
¨gc
, **
¨gv
)

25 
	`f‹k
();

26 
	`¥ötf
("Hello, fork.\n");

27 
	`exô
(
EXIT_SUCCESS
);

28 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/fork2.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<sys/ty≥s.h
>

22 
	~"../comm⁄.h
"

24 
	$maö
(
¨gc
, **
¨gv
)

26 i‡(
	`f‹k
() == -1)

27 
	`FATAL
("fork failed!\n");

29 
	`¥ötf
("Hello, fork.\n");

30 
	`exô
(
EXIT_SUCCESS
);

31 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/fork3.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<sys/ty≥s.h
>

22 
	~"../comm⁄.h
"

24 
	$maö
(
¨gc
, **
¨gv
)

26 i‡(
	`f‹k
() == -1)

27 
	`FATAL
("fork failed!\n");

29 
	`¥ötf
("PID %d: Hñlo, f‹k.\n", 
	`gëpid
());

30 
	`exô
(
EXIT_SUCCESS
);

31 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/fork4.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<sys/ty≥s.h
>

23 
	~"../comm⁄.h
"

25 
	$b¨
(
n£c
)

27 
	`¥ötf
(" %s:%s :: willÅakeáÇap for %us ...\n",

28 
__FILE__
, 
__func__
, 
n£c
);

29 
	`¶ìp
(
n£c
);

30 
	}
}

32 
	$foo
(
n£c
)

34 
	`¥ötf
(" %s:%s :: willÅakeáÇap for %us ...\n",

35 
__FILE__
, 
__func__
, 
n£c
);

36 
	`¶ìp
(
n£c
);

37 
	}
}

39 
	$maö
(
¨gc
, **
¨gv
)

41 
pid_t
 
ªt
;

43 i‡(
¨gc
 != 3) {

44 
	`Ârötf
(
°dîr
,

46 
¨gv
[0]);

47 
	`exô
(
EXIT_FAILURE
);

53 (
ªt
 = 
	`f‹k
())) {

55 
	`FATAL
("fork failed,áborting!\n");

57 
	`¥ötf
("ChildÖrocess, PID %d:\n"

58 "Ñëu∫ %d from f‹k()\n", 
	`gëpid
(), 
ªt
);

59 
	`foo
(
	`©oi
(
¨gv
[1]));

60 
	`¥ötf
("ChûdÖro˚s†(%dËd⁄e,Éxôög ...\n", 
	`gëpid
());

61 
	`exô
(
EXIT_SUCCESS
);

63 
	`¥ötf
("ParentÖrocess, PID %d:\n"

64 "Ñëu∫ %d from f‹k()\n", 
	`gëpid
(), 
ªt
);

65 
	`b¨
(
	`©oi
(
¨gv
[2]));

67 
	`¥ötf
("P¨íà(%dËwû»exôÇow...\n", 
	`gëpid
());

68 
	`exô
(
EXIT_SUCCESS
);

69 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/fork4_prnum.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<sys/ty≥s.h
>

23 
	~"../comm⁄.h
"

25 
	$maö
(
¨gc
, **
¨gv
)

27 
pid_t
 
ªt
;

29 i‡(
¨gc
 != 3) {

30 
	`Ârötf
(
°dîr
,

32 
¨gv
[0]);

33 
	`exô
(
EXIT_FAILURE
);

39 (
ªt
 = 
	`f‹k
())) {

41 
	`FATAL
("fork failed,áborting!\n");

43 
	`¥ötf
("ChildÖrocess, PID %d:\n"

44 "Ñëu∫ %d from f‹k()\n", 
	`gëpid
(), 
ªt
);

45 
	`DELAY_LOOP
('c', 
	`©oi
(
¨gv
[1]));

46 
	`¥ötf
("ChûdÖro˚s†(%dËd⁄e,Éxôög ...\n", 
	`gëpid
());

47 
	`exô
(
EXIT_SUCCESS
);

49 
	`¥ötf
("ParentÖrocess, PID %d:\n"

50 "Ñëu∫ %d from f‹k()\n", 
	`gëpid
(), 
ªt
);

51 
	`DELAY_LOOP
('p', 
	`©oi
(
¨gv
[2]));

53 
	`¥ötf
("P¨íà(%dËwû»exôÇow...\n", 
	`gëpid
());

54 
	`exô
(
EXIT_SUCCESS
);

55 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/fork5.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<sys/ty≥s.h
>

22 
	~"../comm⁄.h
"

24 
	gg
 = 7;

26 
	$maö
(
¨gc
, **
¨gv
)

28 
pid_t
 
ªt
;

29 
loc
 = 8;

31 (
ªt
 = 
	`f‹k
())) {

33 
	`FATAL
("fork failed,áborting!\n");

35 
	`¥ötf
("ChûdÖro˚ss, PID %d:\n", 
	`gëpid
());

36 
loc
++;

37 
g
--;

38 
	`¥ötf
("Üoc=%d g=%d\n", 
loc
, 
g
);

39 
	`¥ötf
("Chûd (%dËd⁄e,Éxôög ...\n", 
	`gëpid
());

40 
	`exô
(
EXIT_SUCCESS
);

43 
	`¶ìp
(2);

45 
	`¥ötf
("P¨íà¥o˚ss, PID %d:\n", 
	`gëpid
());

46 
loc
--;

47 
g
++;

48 
	`¥ötf
("Üoc=%d g=%d\n", 
loc
, 
g
);

50 
	`¥ötf
("P¨íà(%dËwû»exôÇow...\n", 
	`gëpid
());

51 
	`exô
(
EXIT_SUCCESS
);

52 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/fork_malloc_test.c

32 
	#_GNU_SOURCE


	)

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

35 
	~<°rög.h
>

36 
	~<uni°d.h
>

37 
	~<sys/ty≥s.h
>

38 
	~"../comm⁄.h
"

40 
	#CHILD
 1

	)

41 
	#PARENT
 2

	)

43 
	#WORK_ON_MEM
(
PROCESS
, 
loc
, 
g
) do { \

44 i‡(
PROCESS
 =
CHILD
) { \

45 
loc
 ++ ; 
g
 --; \

46 } i‡(
PROCESS
 =
PARENT
) { \

47 
loc
 -- ; 
g
 ++; \

49 
	`¥ötf
("Üoc=%d, g=%d\n" \

51 , 
loc
, 
g
, &loc, &g); \

52 } 0)

	)

54 c⁄° 
	gmemsz
 = 2048;

55 *
	gg±r
;

56 
	gg
 = 5;

58 
ölöe
 
	$di•_„w
(*
p
)

60 
i
;

61 
	`¥ötf
(" mÆlo¯g±r=%p\¿", 
p
);

62 
i
 = 0; i < 16; i++)

63 
	`¥ötf
("%c", *(
p
 + 
i
));

64 
	`¥ötf
("\n");

65 
	}
}

67 
	$maö
(
¨gc
, **
¨gv
)

69 
pid_t
 
ªt
;

70 
show_v¨s
 = 0, 
loc
 = 8;

72 i‡(
¨gc
 > 1)

73 
show_v¨s
 = 1;

75 
g±r
 = 
	`mÆloc
(
memsz
);

76 i‡(!
g±r
)

77 
	`FATAL
("malloc failed!\n");

79 
	`¥ötf
("Inô: mÆlo¯g±r=%p\n", 
g±r
);

80 i‡(
show_v¨s
)

81 
	`¥ötf
("Inô:Üoc=%d, g=%d\n", 
loc
, 
g
);

83 (
ªt
 = 
	`f‹k
())) {

85 
	`‰ì
(
g±r
);

86 
	`FATAL
("fork failed,áborting!\n");

88 
	`¥ötf
("\nChûdÖro˚ss, PID %d:\n", 
	`gëpid
());

90 
	`mem£t
(
g±r
, 'c', 
memsz
);

91 
	`di•_„w
(
g±r
);

92 i‡(
show_v¨s
)

93 
	`WORK_ON_MEM
(
CHILD
, 
loc
, 
g
);

95 
	`‰ì
(
g±r
);

96 
	`¥ötf
("Chûd (%dËd⁄e,Éxôög ...\n", 
	`gëpid
());

97 
	`exô
(
EXIT_SUCCESS
);

100 
	`¶ìp
(2);

102 
	`¥ötf
("\nP¨íà¥o˚ss, PID %d:\n", 
	`gëpid
());

104 
	`mem£t
(
g±r
, 'p', 
memsz
);

105 
	`di•_„w
(
g±r
);

106 i‡(
show_v¨s
)

107 
	`WORK_ON_MEM
(
PARENT
, 
loc
, 
g
);

110 
	`‰ì
(
g±r
);

111 
	`¥ötf
("P¨íà(%dËwû»exôÇow...\n", 
	`gëpid
());

112 
	`exô
(
EXIT_SUCCESS
);

113 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/fork_r6_of.c

26 
	#_GNU_SOURCE


	)

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<uni°d.h
>

30 
	~<°rög.h
>

31 
	~<sys/ty≥s.h
>

32 
	~<sys/°©.h
>

33 
	~<f˙é.h
>

34 
	~"../comm⁄.h
"

36 
	#CHILD
 1

	)

37 
	#PARENT
 2

	)

39 c⁄° 
	g£ekto
 = 10, 
	g size
 = 80, 
	gnumlöes
 = 100;

41 
	$w‹k_⁄_fûe
(
whom
, 
fd
)

43 *
buf
 = 
	`ˇŒoc
(
 size
, ());

44 
i
;

46 i‡(!
buf
)

47 
	`FATAL
("malloc failed\n");

49 
	`¥ötf
(" i¿%s:%†now...\n", 
__FILE__
, 
__func__
);

51 i‡(
whom
 =
CHILD
) {

53 
	`¥ötf
(" context: childÖrocess\n");

54 i‡(
	`l£ek
(
fd
, 
£ekto
, 
SEEK_SET
) < 0) {

55 
	`‰ì
(
buf
);

56 
	`˛o£
(
fd
);

57 
	`FATAL
("child:Üseek failed\n");

59 
	`mem£t
(
buf
, 'c', 
 size
 - 1);

60 
buf
[
 size
 - 1] = '\n';

61 
i
 = 0; i < 
numlöes
; i++) {

62 i‡(
	`wrôe
(
fd
, 
buf
, 
 size
) == -1) {

63 
	`‰ì
(
buf
);

64 
	`˛o£
(
fd
);

65 
	`FATAL
("child: write failed\n");

68 } i‡(
whom
 =
PARENT
) {

70 
	`¥ötf
(" context:ÖarentÖrocess\n");

71 i‡(
	`l£ek
(
fd
, 
£ekto
 + (
 size
 * 
numlöes
), 
SEEK_SET
) < 0) {

72 
	`‰ì
(
buf
);

73 
	`˛o£
(
fd
);

74 
	`FATAL
("parent:Üseek failed\n");

76 
	`mem£t
(
buf
, 'p', 
 size
 - 1);

77 
buf
[
 size
 - 1] = '\n';

78 
i
 = 0; i < 
numlöes
; i++) {

79 i‡(
	`wrôe
(
fd
, 
buf
, 
 size
) == -1) {

80 
	`‰ì
(
buf
);

81 
	`˛o£
(
fd
);

82 
	`FATAL
("parent: write failed\n");

86 
	`‰ì
(
buf
);

87 
	}
}

89 
	$do_w‹k
(
fd
)

91 
pid_t
 
ªt
;

93 (
ªt
 = 
	`f‹k
())) {

95 
	`FATAL
("fork failed,áborting!\n");

97 
	`¥ötf
("ChûdÖro˚ss, PID %d:\n", 
	`gëpid
());

98 
	`w‹k_⁄_fûe
(
CHILD
, 
fd
);

99 
	`˛o£
(
fd
);

101 
	`¥ötf
("Chûd (%dËd⁄e,Éxôög ...\n", 
	`gëpid
());

102 
	`exô
(
EXIT_SUCCESS
);

105 
	`¶ìp
(1);

107 
	`¥ötf
("P¨íà¥o˚ss, PID %d:\n", 
	`gëpid
());

108 
	`w‹k_⁄_fûe
(
PARENT
, 
fd
);

109 
	`˛o£
(
fd
);

111 
	}
}

113 
	$maö
(
¨gc
, **
¨gv
)

115 
fd
;

117 i‡(
¨gc
 != 2) {

118 
	`Ârötf
(
°dîr
, "Ußge: %†{ã°-fûe-«me}\n", 
¨gv
[0]);

119 
	`exô
(
EXIT_FAILURE
);

121 
	`u∆ök
(
¨gv
[1]);

123 
	#FILEMODE
 
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IROTH


	)

124 
fd
 = 
	`›í
(
¨gv
[1], 
O_CREAT
 | 
O_TRUNC
 | 
O_RDWR
, 
FILEMODE
);

125 i‡(
fd
 == -1)

126 
	`FATAL
("›í(%sËÁûed\n", 
¨gv
[1]);

128 
	`do_w‹k
(
fd
);

130 
	`¥ötf
("P¨íà(%dËwû»exôÇow...\n", 
	`gëpid
());

131 
	`exô
(
EXIT_SUCCESS
);

132 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/simpsh_v1.c

22 
	#_GNU_SOURCE


	)

23 
	~<°dio.h
>

24 
	~<°dlib.h
>

25 
	~<uni°d.h
>

26 
	~<°rög.h
>

27 
	~<sys/ty≥s.h
>

28 
	~<sys/waô.h
>

29 
	~"../comm⁄.h
"

31 
	#CMD_MAXLEN
 128

	)

33 
	ggVîbo£
 = 0;

34 c⁄° *
	gProm±Så
 = ">> ";

37 *
	$gëcmd
(*
cmd°r
)

39 
	`¥ötf
("%s", 
Prom±Så
);

40 
	`fÊush
(
°dout
);

42 i‡(!
	`fgës
(
cmd°r
, 
CMD_MAXLEN
 - 1, 
°dö
))

43  
NULL
;

46 
cmd°r
[
	`°æí
(cmdstr) - 1] = '\0';

48  
cmd°r
;

49 
	}
}

51 
	$do_simpsh
()

53 
pid_t
 
ªt
;

54 *
cmd
;

56 
cmd
 = 
	`ˇŒoc
(
CMD_MAXLEN
, ());

57 i‡(!
cmd
)

58 
	`FATAL
("calloc failed!\n");

61 i‡(!
	`gëcmd
(
cmd
)) {

62 
	`‰ì
(
cmd
);

63 
	`FATAL
("getcmd(): EOF or failed\n");

67 i‡(!
	`°∫cmp
(
cmd
, "quit", 4))

70 i‡(
cmd
[0] == 0)

74 (
ªt
 = 
	`f‹k
())) {

76 
	`‰ì
(
cmd
);

77 
	`FATAL
("fork failed,áborting!\n");

79 
VPRINT


81 
	`gëpid
(), 
cmd
);

82 i‡(
	`exe˛p
(
cmd
, cmd, (*)0) == -1) {

83 
	`WARN
("child:Éxeclp failed\n");

84 
	`‰ì
(
cmd
);

85 
	`exô
(
EXIT_FAILURE
);

88 
	`exô
(
EXIT_FAILURE
);

90 
	`VPRINT
("ParentÖrocess (%7d) issuingÅhe wait...\n",

91 
	`gëpid
());

94 i‡(
	`waô
(0) < 0)

95 
	`FATAL
("wait failed,áborting..\n");

98 
	`‰ì
(
cmd
);

99 
	}
}

101 
ölöe
 
	$ußge
(*
«me
)

103 
	`¥ötf
("Usage: %s [-v]|[--help]\n"

105 " --hñ∞: di•œyÅhi†hñ∞s¸ìn.\n", 
«me
);

106 
	}
}

108 
	$maö
(
¨gc
, **
¨gv
)

110 i‡(
¨gc
 >= 2) {

111 i‡(!
	`°∫cmp
(
¨gv
[1], "--help", 6)) {

112 
	`ußge
(
¨gv
[0]);

113 
	`exô
(
EXIT_SUCCESS
);

115 i‡(!
	`°∫cmp
(
¨gv
[1], "-v", 2))

116 
gVîbo£
 = 1;

119 
	`do_simpsh
();

120 
	`VPRINT
("P¨íà¥o˚s†(%7dËexôög...\n", 
	`gëpid
());

121 
	`exô
(
EXIT_SUCCESS
);

122 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/simpsh_v2.c

21 
	#_GNU_SOURCE


	)

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<°rög.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<sys/waô.h
>

28 
	~"../comm⁄.h
"

30 
	#CMD_MAXLEN
 128

	)

32 
	ggVîbo£
 = 0;

33 c⁄° *
	gProm±Så
 = ">> ";

35 
	$öãΩªt_waô
(
pid_t
 
chûd
, 
w°©us
)

37 
	`VPRINT
("Chûd (%7dË°©u†ch™ged:\n", 
chûd
);

38 i‡(
	`WIFEXITED
(
w°©us
))

39 
	`VPRINT
("ÇormalÅermination:Éxit status: %d\n",

40 
	`WEXITSTATUS
(
w°©us
));

41 i‡(
	`WIFSIGNALED
(
w°©us
)) {

42 
	`VPRINT
("ábnormalÅermination: killer signal: %d",

43 
	`WTERMSIG
(
w°©us
));

44 i‡(
	`WCOREDUMP
(
w°©us
))

45 
	`VPRINT
(" : core dumped\n");

47 
	`VPRINT
("\n");

49 i‡(
	`WIFSTOPPED
(
w°©us
))

50 
	`VPRINT
(" stopped: stop signal: %d\n",

51 
	`WSTOPSIG
(
w°©us
));

52 i‡(
	`WIFCONTINUED
(
w°©us
))

53 
	`VPRINT
(" (was stopped),Ñesumed (SIGCONT)\n");

54 
	}
}

57 *
	$gëcmd
(*
cmd°r
)

59 
	`¥ötf
("%s", 
Prom±Så
);

60 
	`fÊush
(
°dout
);

62 i‡(!
	`fgës
(
cmd°r
, 
CMD_MAXLEN
 - 1, 
°dö
))

63  
NULL
;

66 
cmd°r
[
	`°æí
(cmdstr) - 1] = '\0';

68  
cmd°r
;

69 
	}
}

71 
	$do_simpsh
()

73 
pid_t
 
ªt
, 
˝id
;

74 *
cmd
;

75 
w°©
=0;

77 
cmd
 = 
	`ˇŒoc
(
CMD_MAXLEN
, ());

78 i‡(!
cmd
)

79 
	`FATAL
("calloc failed!\n");

82 i‡(!
	`gëcmd
(
cmd
)) {

83 
	`‰ì
(
cmd
);

84 
	`FATAL
("getcmd(): EOF or failed\n");

88 if(!
	`°∫cmp
(
cmd
, "quit", 4))

91 i‡(
cmd
[0] == 0)

95 (
ªt
 = 
	`f‹k
())) {

97 
	`‰ì
(
cmd
);

98 
	`FATAL
("fork failed,áborting!\n");

100 
VPRINT


102 
	`gëpid
(), 
cmd
);

103 i‡(
	`exe˛p
(
cmd
, cmd, (*)0) == -1) {

104 
	`WARN
("child:Éxeclp failed\n");

105 
	`‰ì
(
cmd
);

106 
	`exô
(
EXIT_FAILURE
);

109 
	`exô
(
EXIT_FAILURE
);

111 
	`VPRINT
("ParentÖrocess (%7d) issuingÅhe wait...\n",

112 
	`gëpid
());

115 i‡((
˝id
 = 
	`waô
(&
w°©
)) < 0) {

116 
	`‰ì
(
cmd
);

117 
	`FATAL
("wait failed,áborting..\n");

119 i‡(
gVîbo£
)

120 
	`öãΩªt_waô
(
˝id
, 
w°©
);

123 
	`‰ì
(
cmd
);

124 
	}
}

126 
ölöe
 
	$ußge
(*
«me
)

128 
	`¥ötf
("Usage: %s [-v]|[--help]\n"

131 " --hñ∞: di•œyÅhi†hñ∞s¸ìn.\n", 
«me
);

132 
	}
}

134 
	$maö
(
¨gc
, **
¨gv
)

136 i‡(
¨gc
 >= 2) {

137 i‡(!
	`°∫cmp
(
¨gv
[1], "--help", 6)) {

138 
	`ußge
(
¨gv
[0]);

139 
	`exô
(
EXIT_SUCCESS
);

141 i‡(!
	`°∫cmp
(
¨gv
[1], "-v", 2))

142 
gVîbo£
 = 1;

145 
	`do_simpsh
();

146 
	`VPRINT
("P¨íà¥o˚s†(%7dËexôög...\n", 
	`gëpid
());

147 
	`exô
(
EXIT_SUCCESS
);

148 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch10/simpsh_v3.c

21 
	#_GNU_SOURCE


	)

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<°rög.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<sys/waô.h
>

28 
	~"../comm⁄.h
"

31 
	#CMD_MAXLEN
 128

	)

33 
	ggVîbo£
 = 0;

34 c⁄° *
	gProm±Så
 = ">> ";

36 
	$öãΩªt_waô
(
pid_t
 
chûd
, 
w°©us
)

38 
	`VPRINT
("Chûd (%7dË°©u†ch™ged:\n", 
chûd
);

39 i‡(
	`WIFEXITED
(
w°©us
))

40 
	`VPRINT
("ÇormalÅermination:Éxit status: %d\n",

41 
	`WEXITSTATUS
(
w°©us
));

42 i‡(
	`WIFSIGNALED
(
w°©us
)) {

43 
	`VPRINT
("ábnormalÅermination: killer signal: %d",

44 
	`WTERMSIG
(
w°©us
));

45 i‡(
	`WCOREDUMP
(
w°©us
))

46 
	`VPRINT
(" : core dumped\n");

48 
	`VPRINT
("\n");

50 i‡(
	`WIFSTOPPED
(
w°©us
))

51 
	`VPRINT
(" stopped: stop signal: %d\n",

52 
	`WSTOPSIG
(
w°©us
));

53 i‡(
	`WIFCONTINUED
(
w°©us
))

54 
	`VPRINT
(" (was stopped),Ñesumed (SIGCONT)\n");

55 
	}
}

58 *
	$gëcmd
(*
cmd°r
)

60 
	`¥ötf
("%s", 
Prom±Så
);

61 
	`fÊush
(
°dout
);

63 i‡(!
	`fgës
(
cmd°r
, 
CMD_MAXLEN
 - 1, 
°dö
))

64  
NULL
;

67 
cmd°r
[
	`°æí
(cmdstr) - 1] = '\0';

69  
cmd°r
;

70 
	}
}

72 
	$do_simpsh
()

74 
pid_t
 
ªt
, 
˝id
;

75 *
cmd
;

76 
w°©
=0;

78 
cmd
 = 
	`ˇŒoc
(
CMD_MAXLEN
, ());

79 i‡(!
cmd
)

80 
	`FATAL
("calloc failed!\n");

83 i‡(!
	`gëcmd
(
cmd
)) {

84 
	`‰ì
(
cmd
);

85 
	`FATAL
("getcmd(): EOF or failed\n");

89 if(!
	`°∫cmp
(
cmd
, "quit", 4))

92 i‡(
cmd
[0] == 0)

96 (
ªt
 = 
	`f‹k
())) {

98 
	`‰ì
(
cmd
);

99 
	`FATAL
("fork failed,áborting!\n");

101 
VPRINT


103 
	`gëpid
(), 
cmd
);

104 i‡(
	`exe˛p
(
cmd
, cmd, (*)0) == -1) {

105 
	`WARN
("child:Éxeclp failed\n");

106 
	`‰ì
(
cmd
);

107 
	`exô
(
EXIT_FAILURE
);

110 
	`exô
(
EXIT_FAILURE
);

112 
	`VPRINT
("ParentÖrocess (%7d) issuingÅhe waitpid...\n",

113 
	`gëpid
());

119 i‡((
˝id
 = 
	`waôpid
(-1, &
w°©
,

120 
WUNTRACED
|
WCONTINUED
)) < 0) {

121 
	`‰ì
(
cmd
);

122 
	`FATAL
("wait failed,áborting..\n");

124 i‡(
gVîbo£
)

125 
	`öãΩªt_waô
(
˝id
, 
w°©
);

128 
	`‰ì
(
cmd
);

129 
	}
}

131 
ölöe
 
	$ußge
(*
«me
)

133 
	`¥ötf
("Usage: %s [-v]|[--help]\n"

136 " --hñ∞: di•œyÅhi†hñ∞s¸ìn.\n", 
«me
);

137 
	}
}

139 
	$maö
(
¨gc
, **
¨gv
)

141 i‡(
¨gc
 >= 2) {

142 i‡(!
	`°∫cmp
(
¨gv
[1], "--help", 6)) {

143 
	`ußge
(
¨gv
[0]);

144 
	`exô
(
EXIT_SUCCESS
);

146 i‡(!
	`°∫cmp
(
¨gv
[1], "-v", 2))

147 
gVîbo£
 = 1;

150 
	`do_simpsh
();

151 
	`VPRINT
("P¨íà¥o˚s†(%7dËexôög...\n", 
	`gëpid
());

152 
	`exô
(
EXIT_SUCCESS
);

153 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch11/altstack.c

29 
	~<°dio.h
>

30 
	~<°dlib.h
>

31 
	~<uni°d.h
>

32 
	~<sig«l.h
>

33 
	~<°rög.h
>

34 
	~<sys/fûe.h
>

35 
	~"../comm⁄.h
"

37 
	#MAX
 9

	)

39 vﬁ©ûê
sig_©omic_t
 
	gs
=0, 
	gt
=0;

40 vﬁ©ûê
	g°k_°¨t
=0, 
	g°k
=0;

47 *
	$°ack
()

49 i‡(
__WORDSIZE
 == 32) {

50 
	`__asm__
("movl %esp, %eax");

51 } i‡(
__WORDSIZE
 == 64) {

52 
	`__asm__
("movq %rsp, %rax");

55 
	}
}

62 
	$sighdÃ
(
signum
)

64 i‡(
t
 == 0)

65 
°k_°¨t
 = ()
	`°ack
();

67 
signum
) {

68 
SIGUSR1
:

69 
°k
 = ()
	`°ack
();

70 
s
 ++; 
t
 ++;

71 i‡(
s
 >
MAX
)

72 
s
 = 1;

73 
	`Ârötf
(
°dîr
, " s=%d ;ÅŸÆ=%d; sèck %p\n", 
s
, 
t
, 
	`°ack
());

75 
	`DELAY_LOOP_SILENT
(5);

77 
SIGUSR2
:

78 
	`Ârötf
(
°dîr
, "*** signal %d:: stack@:Å0=%lxÜast=%lx : delta=%ld ***\n",

79 
signum
, 
°k_°¨t
, 
°k
, (stk_start-stk));

81 
SIGSEGV
:

82 
	`Ârötf
(
°dîr
, "*** signal %d:: stack@:Å0=%lxÜast=%lx : delta=%ld ***\n",

83 
signum
, 
°k_°¨t
, 
°k
, (stk_start-stk));

84 
	`ab‹t
();

86 
	}
}

88 
	$£tup_Ætsig°ack
(
size_t
 
°ack_sz
)

90 
°ack_t
 
ss
;

92 
	`¥ötf
("A… sig«»°ack sizê%zu\n", 
°ack_sz
);

93 
ss
.
ss_•
 = 
	`mÆloc
(
°ack_sz
);

94 i‡(!
ss
.
ss_•
)

95 
	`FATAL
("mÆloc(%zuËf‹á… sig sèck faûed\n", 
°ack_sz
);

96 
ss
.
ss_size
 = 
°ack_sz
;

97 
ss
.
ss_Êags
 = 0;

98 i‡(
	`sigÆt°ack
(&
ss
, 
NULL
) == -1)

99 
	`FATAL
("sigÆt°ack f‹ sizê%zu faûed!\n", 
°ack_sz
);

100 
	}
}

102 
	$maö
(
¨gc
, **
¨gv
)

104 
size_t
 
Æt°acksz
=0;

105 
siga˘i⁄
 
a˘
;

107 i‡(
¨gc
 != 2) {

108 
	`Ârötf
(
°dîr
, "Usage: %s {alternate-signal-stack-size-in-KB}\n",

109 
¨gv
[0]);

110 
	`exô
(
EXIT_FAILURE
);

113 
Æt°acksz
 = 
	`©oi
(
¨gv
[1])*1024;

114 
	`£tup_Ætsig°ack
(
Æt°acksz
);

116 
	`mem£t
(&
a˘
, 0, (act));

117 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

118 
a˘
.
ß_Êags
 = 
SA_NODEFER
 | 
SA_ONSTACK
 | 
SA_RESTART
;

119 i‡(
	`siga˘i⁄
(
SIGUSR1
, &
a˘
, 0) == -1)

120 
	`FATAL
("sigaction SIGUSR1 failed\n");

123 
	`mem£t
(&
a˘
, 0, (act));

124 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

125 
a˘
.
ß_Êags
 = 
SA_RESTART
;

126 i‡(
	`siga˘i⁄
(
SIGUSR2
, &
a˘
, 0) == -1)

127 
	`FATAL
("sigaction SIGUSR2 failed\n");

131 
	`mem£t
(&
a˘
, 0, (act));

132 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

133 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_ONSTACK
;

134 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1)

135 
	`FATAL
("sigaction SIGSEGV failed\n");

137 
	`¥ötf
("Running: signal SIGUSR1 flags: SA_NODEFER | SA_ONSTACK | SA_RESTART\n");

138 
	`¥ötf
("Processáwaiting signals ...\n");

140 ()
	`∑u£
();

141 
	`exô
(
EXIT_SUCCESS
);

142 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch11/defer_or_not.c

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

35 
	~<uni°d.h
>

36 
	~<sig«l.h
>

37 
	~<°rög.h
>

38 
	~<sys/fûe.h
>

39 
	~"../comm⁄.h
"

41 
	#MAX
 10

	)

43 vﬁ©ûê
sig_©omic_t
 
	gs
=0, 
	gt
=0;

50 *
	$°ack
()

52 i‡(
__WORDSIZE
 == 32) {

53 
	`__asm__
("movl %esp, %eax");

54 } i‡(
__WORDSIZE
 == 64) {

55 
	`__asm__
("movq %rsp, %rax");

58 
	}
}

64 
	$sighdÃ
(
signum
)

66 
ßved
;

68 
	`Ârötf
(
°dîr
, "\nsighdÃ: sig«»%d,", 
signum
);

69 
signum
) {

70 
SIGUSR1
:

71 
s
 ++; 
t
 ++;

72 i‡(
s
 >
MAX
)

73 
s
 = 1;

74 
ßved
 = 
s
;

75 
	`Ârötf
(
°dîr
, " s=%d ;ÅŸÆ=%d; sèck %∞:", 
s
, 
t
, 
	`°ack
());

76 
	`DELAY_LOOP
(
ßved
+48, 5);

77 
	`Ârötf
(
°dîr
, "*");

81 
	}
}

83 
	$maö
(
¨gc
, **
¨gv
)

85 
Êags
=0;

86 
siga˘i⁄
 
a˘
;

88 i‡(
¨gc
 != 2) {

89 
	`Ârötf
(
°dîr
, "Ußge: %†{›ti⁄}\n\
=1 : d⁄'àu£ (˛órËSA_NODEFER fœg (deÁu… siga˘i⁄ styÀ)\n\
=2 : u£ (£tËSA_NODEFER fœg (wû»¥o˚s†sig«»immd)\n", 
¨gv
[0]);

92 
	`exô
(
EXIT_FAILURE
);

95 
Êags
 = 
SA_RESTART
;

96 i‡(
	`©oi
(
¨gv
[1]) == 2) {

97 
Êags
 |
SA_NODEFER
;

98 
	`¥ötf
("PID %d:Ñunning withÅhe SA_NODEFER signal flag Set\n",

99 
	`gëpid
());

101 
	`¥ötf
("PID %d:Ñunning withÅhe SA_NODEFER signal flag Cleared [default]\n",

102 
	`gëpid
());

105 
	`mem£t
(&
a˘
, 0, (act));

106 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

107 
a˘
.
ß_Êags
 = 
Êags
;

108 i‡(
	`siga˘i⁄
(
SIGUSR1
, &
a˘
, 0) == -1)

109 
	`FATAL
("sigaction failed\n");

111 
	`¥ötf
("Processáwaiting signals ...\n");

113 ()
	`∑u£
();

114 
	`exô
(
EXIT_SUCCESS
);

115 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch11/query_mask.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<sys/ty≥s.h
>

23 
	~<°rög.h
>

24 
	~<sig«l.h
>

25 
	~"../comm⁄.h
"

28 
	$my_h™dÀr
(
signum
)

30 c⁄° *
°r1
 = "*** my_handler: handled SIGINT ***\n";

31 c⁄° *
°r2
 = "*** my_handler: handled SIGQUIT ***\n";

33 i‡(
	`show_blocked_sig«ls
() < 0)

34 
	`FATAL
("sigprocmask -query- failed\n");

36 
signum
) {

37 
SIGINT
:

38 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r1
, 
	`°æí
(str1)) < 0)

39 
	`WARN
("write str1 failed!");

41 
SIGQUIT
:

42 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r2
, 
	`°æí
(str2)) < 0)

43 
	`WARN
("write str2 failed!");

46 
	}
}

48 
	$maö
()

50 
i
 = 1;

51 
siga˘i⁄
 
a˘
;

57 
	`mem£t
(&
a˘
, 0, (act));

58 
a˘
.
ß_h™dÀr
 = 
my_h™dÀr
;

62 
	`sigfûl£t
(&
a˘
.
ß_mask
);

64 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) < 0)

65 
	`FATAL
("sigaction on SIGINT failed");

66 i‡(
	`siga˘i⁄
(
SIGQUIT
, &
a˘
, 0) < 0)

67 
	`FATAL
("sigaction on SIGQUIT failed");

70 
	`¥ötf
("Lo›ög, iãøti⁄ #%02ld ...\n", 
i
++);

71 ()
	`¶ìp
(1);

74 
	`exô
(
EXIT_SUCCESS
);

75 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch11/sig1.c

20 
	#_GNU_SOURCE


	)

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<uni°d.h
>

24 
	~<sys/ty≥s.h
>

25 
	~"../comm⁄.h
"

27 
	$maö
()

29 
i
 = 1;

32 
	`¥ötf
("Lo›ög, iãøti⁄ #%02ld ...\n", 
i
++);

33 ()
	`¶ìp
(1);

36 
	`exô
(
EXIT_SUCCESS
);

37 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch11/sig2.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<sys/ty≥s.h
>

23 
	~<°rög.h
>

24 
	~<sig«l.h
>

25 
	~"../comm⁄.h
"

28 
	$siggy
(
signum
)

30 c⁄° *
°r1
 = "*** siggy: handled SIGINT ***\n";

31 c⁄° *
°r2
 = "*** siggy: handled SIGQUIT ***\n";

33 
signum
) {

34 
SIGINT
:

35 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r1
, 
	`°æí
(str1)) < 0)

36 
	`WARN
("write str1 failed!");

38 
SIGQUIT
:

39 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r2
, 
	`°æí
(str2)) < 0)

40 
	`WARN
("write str2 failed!");

43 
	}
}

45 
	$maö
()

47 
i
 = 1;

48 
siga˘i⁄
 
a˘
;

54 
	`mem£t
(&
a˘
, 0, (act));

55 
a˘
.
ß_h™dÀr
 = 
siggy
;

56 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) < 0)

57 
	`FATAL
("sigaction on SIGINT failed");

58 i‡(
	`siga˘i⁄
(
SIGQUIT
, &
a˘
, 0) < 0)

59 
	`FATAL
("sigaction on SIGQUIT failed");

62 
	`¥ötf
("Lo›ög, iãøti⁄ #%02ld ...\n", 
i
++);

63 ()
	`¶ìp
(1);

66 
	`exô
(
EXIT_SUCCESS
);

67 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch11/zombies_clear_linux26.c

27 
	~<°dio.h
>

28 
	~<uni°d.h
>

29 
	~<°dlib.h
>

30 
	~<sig«l.h
>

31 
	~<°rög.h
>

32 
	~<sys/ty≥s.h
>

33 
	~<sys/waô.h
>

34 
	~"../comm⁄.h
"

36 
	#DEBUG


	)

38 
	$chûd_dõs
(
signum
)

40 #ifde‡
DEBUG


41 
	`¥ötf
("\n*** Child dies! ***\n");

43 
	}
}

45 
	$ußge
(*
«me
)

47 
	`Ârötf
(
°dîr
,

50 " 2 : ju° ign‹êthêsig«»SIGCHLD\n", 
«me
);

51 
	`exô
(
EXIT_FAILURE
);

52 
	}
}

54 
	$maö
(
¨gc
, **
¨gv
)

56 
siga˘i⁄
 
a˘
;

57 
›t
 = 0;

59 i‡(
¨gc
 != 2)

60 
	`ußge
(
¨gv
[0]);

62 
›t
 = 
	`©oi
(
¨gv
[1]);

63 i‡(
›t
 != 1 && opt != 2)

64 
	`ußge
(
¨gv
[0]);

66 
	`mem£t
(&
a˘
, 0, (act));

67 i‡(
›t
 == 1) {

68 
a˘
.
ß_h™dÀr
 = 
chûd_dõs
;

70 
a˘
.
ß_Êags
 = 
SA_NOCLDWAIT
;

72 i‡(
›t
 == 2)

73 
a˘
.
ß_h™dÀr
 = 
SIG_IGN
;

74 
a˘
.
ß_Êags
 |
SA_RESTART
 | 
SA_NOCLDSTOP
;

76 i‡(
	`siga˘i⁄
(
SIGCHLD
, &
a˘
, 0) == -1)

77 
	`FATAL
("sigaction failed");

79 
	`¥ötf
("∑ª¡: %d\n", 
	`gëpid
());

80 
	`f‹k
()) {

82 
	`FATAL
("fork failed");

84 
	`¥ötf
("chûd: %d\n", 
	`gëpid
());

85 
	`DELAY_LOOP
('c', 25);

86 
	`exô
(0);

89 
	`∑u£
();

91 
	`exô
(0);

92 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch12/handle_segv.c

23 
	#_GNU_SOURCE


	)

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<uni°d.h
>

27 
	~<sys/ty≥s.h
>

28 
	~<sig«l.h
>

29 
	~<uc⁄ãxt.h
>

30 
	~<î∫o.h
>

31 
	~<°rög.h
>

32 
	~<˘y≥.h
>

33 
	~"../comm⁄.h
"

36 
	tu32
;

37 
	tu64
;

40 
	#APPNAME
 "h™dÀ_£gv"

	)

42 
	#ADDR_FMT
 "%lx"

	)

43 #i‡
__x86_64__


44 
	#ADDR_TYPE
 
u64


	)

45 
u64
 
	gövÆid_uaddr
 = 0xdeadfaceL;

46 
u64
 
	gövÆid_kaddr
 = 0xffff0b9ffacedeadL;

48 
	#ADDR_TYPE
 
u32


	)

49 
u32
 
	gövÆid_uaddr
 = 0xfacedeadL;

50 
u32
 
	gövÆid_kaddr
 = 0xdeadfaceL;

56 
ölöe
 
	$dump_ªgs
(*
uc⁄ãxt
)

58 
	#FMT
 "%016Œx"

	)

60 
uc⁄ãxt_t
 *
u˘x
 = (uc⁄ãxt_à*)
uc⁄ãxt
;

61 
	`Ârötf
(
°dîr
,

62 " RAX = 0x" 
FMT
 " RBX = 0x" FMT " RCX = 0x" FMT "\n"

63 " RDX = 0x" 
FMT
 " RSI = 0x" FMT " RDI = 0x" FMT "\n"

64 " RBP = 0x" 
FMT
 " R8 = 0x" FMT " R9 = 0x" FMT "\n"

66 " R10 = 0x" 
FMT
 " R11 = 0x" FMT " R12 = 0x" FMT "\n"

67 " R13 = 0x" 
FMT
 " R14 = 0x" FMT " R15 = 0x" FMT "\n"

68 " RSP = 0x" 
FMT
 "\n"

69 "\¿RIP = 0x" 
FMT
 " EFLAGS = 0x" FMT "\n"

73 " CR2 = 0x" 
FMT
 "\n"

75 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RAX
]

76 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RBX
]

77 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RCX
]

79 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RDX
]

80 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RSI
]

81 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RDI
]

83 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RBP
]

84 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_R8
]

85 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_R9
]

87 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_R10
]

88 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_R11
]

89 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_R12
]

91 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_R13
]

92 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_R14
]

93 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_R15
]

95 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RSP
]

96 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_RIP
]

97 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_EFL
]

98 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_TRAPNO
]

99 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_ERR
]

100 , 
u˘x
->
uc_mc⁄ãxt
.
gªgs
[
REG_CR2
]

102 
	}
}

104 
	$myÁu…
(
signum
, 
sigöfo_t
 * 
si
, *
uc⁄ãxt
)

106 
	`Ârötf
(
°dîr
,

108 
APPNAME
);

109 
	`Ârötf
(
°dîr
," %s:Ñeceived signal %d.Érrno=%d\n"

111 
__func__
, 
signum
, 
si
->
si_î∫o
, si->
si_code
);

113 
si
->
si_code
) {

115 
SEGV_MAPERR
:

116 
	`Ârötf
(
°dîr
,"SEGV_MAPERR:áddressÇot mappedÅo object\n");

118 
SEGV_ACCERR
:

119 
	`Ârötf
(
°dîr
,"SEGV_ACCERR: invalidÖermissions for mapped object\n");

123 
SEGV_BNDERR
:

124 
	`Ârötf
(
°dîr
,"SEGV_BNDERR: failedáddress bound checks\n");

125 
SEGV_PKUERR
:

126 
	`Ârötf
(
°dîr
,"SEGV_PKUERR:áccess denied by memory-protection keys\n");

129 
SI_USER
:

130 
	`Ârötf
(
°dîr
,"user\n");

132 
SI_KERNEL
:

133 
	`Ârötf
(
°dîr
,"kernel\n");

135 
SI_QUEUE
:

136 
	`Ârötf
(
°dîr
,"queue\n");

138 
SI_TIMER
:

139 
	`Ârötf
(
°dîr
,"timer\n");

141 
SI_MESGQ
:

142 
	`Ârötf
(
°dîr
,"mesgq\n");

144 
SI_ASYNCIO
:

145 
	`Ârötf
(
°dîr
,"async io\n");

147 
SI_SIGIO
:

148 
	`Ârötf
(
°dîr
,"sigio\n");

150 
SI_TKILL
:

151 
	`Ârötf
(
°dîr
,"t[g]kill\n");

154 
	`Ârötf
(
°dîr
,"-none-\n");

157 
	`Ârötf
(
°dîr
," Fau…ög in°∏‹áddªs†0x" 
ADDR_FMT
 "\n",

158 (
ADDR_TYPE
Ë
si
->
si_addr
);

159 
	`Ârötf
(
°dîr
, " --- Register Dump [x86_64] ---\n");

160 
	`dump_ªgs
(
uc⁄ãxt
);

161 
	`Ârötf
(
°dîr
,

163 
	`psigöfo
(
si
, "psiginfo helper");

164 
	`Ârötf
(
°dîr
,

177 i‡(
	`sig«l
(
SIGSEGV
, 
SIG_DFL
Ë=
SIG_ERR
)

178 
	`FATAL
("signal -reverting SIGSEGVÅo default- failed");

179 i‡(
	`øi£
(
SIGSEGV
))

180 
	`FATAL
("raise SIGSEGV failed");

181 
	}
}

183 
	$ußge
(*
nm
)

185 
	`Ârötf
(
°dîr
, "Usage: %s u|kÑ|w\n"

188 "Ñ =>Ñódáâem±\n" " w => wrôê©ãm±\n", 
nm
);

189 
	}
}

191 
	$maö
(
¨gc
, **
¨gv
)

193 
siga˘i⁄
 
a˘
;

195 i‡(
¨gc
 != 3) {

196 
	`ußge
(
¨gv
[0]);

197 
	`exô
(1);

200 
	`mem£t
(&
a˘
, 0, (act));

201 
a˘
.
ß_siga˘i⁄
 = 
myÁu…
;

202 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

203 
	`sigem±y£t
(&
a˘
.
ß_mask
);

204 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1)

205 
	`FATAL
("sigaction SIGSEGV failed\n");

207 i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'r')) {

208 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë
övÆid_uaddr
;

209 
	`¥ötf
("Aâem±ögÅÿªad c⁄ã¡†o‡¨bôøry u£rmodêv®u±∏0x" 
ADDR_FMT
 ":\n",

210 (
ADDR_TYPE
Ë
u±r
);

211 
	`¥ötf
("*u±∏0x" 
ADDR_FMT
 "\n", *
u±r
);

212 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'w')) {

213 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë& 
maö
;

214 
¥ötf


215 ("Aâem±ögÅÿwrôêötÿ¨bôøry u£rmodêv®u±∏(&maöá˘uÆlyË0x" 
ADDR_FMT
 ":\n",

216 (
ADDR_TYPE
Ë
u±r
);

217 *
u±r
 = 0x2A;

218 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'r')) {

219 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
övÆid_kaddr
;

220 
¥ötf


221 ("Aâem±ögÅÿªad c⁄ã¡†o‡¨bôøry kî√»v®k±∏0x" 
ADDR_FMT
 ":\n",

222 (
ADDR_TYPE
Ë
k±r
);

223 
	`¥ötf
("*k±∏0x" 
ADDR_FMT
 "\n", *
k±r
);

224 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'w')) {

225 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
övÆid_kaddr
;

226 
¥ötf


227 ("Aâem±ögÅÿwrôêötÿ¨bôøry kî√»v®k±∏0x" 
ADDR_FMT
 ":\n",

228 (
ADDR_TYPE
Ë
k±r
);

229 *
k±r
 = 0x2A;

231 
	`ußge
(
¨gv
[0]);

232 
	`exô
(0);

233 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch12/rtsigs_waiter.c

30 
	~<°dio.h
>

31 
	~<°dlib.h
>

32 
	~<uni°d.h
>

33 
	~<sig«l.h
>

34 
	~<°rög.h
>

35 
	~<sys/fûe.h
>

36 
	~"../comm⁄.h
"

38 
	#MAX
 10

	)

39 vﬁ©ûê
sig_©omic_t
 
	gs
=0, 
	gt
=0;

47 *
	$°ack
()

49 i‡(
__WORDSIZE
 == 32) {

50 
	`__asm__
("movl %esp, %eax");

51 } i‡(
__WORDSIZE
 == 64) {

52 
	`__asm__
("movq %rsp, %rax");

55 
	}
}

61 #unde‡
SHOW_MASKED


63 
	$π_sighdÃ
(
signum
)

65 #ifde‡
SHOW_MASKED


66 i‡(
	`show_blocked_sig«ls
() < 0)

67 
	`WARN
("sigprocmask -query- failed\n");

70 
	`Ârötf
(
°dîr
, "\nsighdÃ: sig«»%d,", 
signum
);

71 i‡((
signum
 =
SIGRTMAX
-5) ||

72 (
signum
 =
SIGRTMIN
+5) ||

73 (
signum
 =
SIGRTMAX
)) {

74 
s
 ++; 
t
 ++;

75 i‡(
s
 >
MAX
)

76 
s
 = 1;

77 
	`Ârötf
(
°dîr
, " s=%d ;ÅŸÆ=%d; sèck %∞:", 
s
, 
t
, 
	`°ack
());

79 
	`DELAY_LOOP_SILENT
(8);

80 
	`Ârötf
(
°dîr
, "*");

82 
	}
}

84 
	$maö
()

86 
siga˘i⁄
 
a˘
;

88 
	`¥ötf
("TrappingÅheÅhreeÑealtime signals\n");

89 
	`mem£t
(&
a˘
, 0, (act));

90 
a˘
.
ß_h™dÀr
 = 
π_sighdÃ
;

91 
a˘
.
ß_Êags
 = 
SA_RESTART
;

94 
	`sigfûl£t
(&
a˘
.
ß_mask
);

96 i‡(
	`siga˘i⁄
(
SIGRTMAX
-5, &
a˘
, 0) == -1)

97 
	`FATAL
("sigaction %s failed\n", "SIGRTMAX-5");

98 i‡(
	`siga˘i⁄
(
SIGRTMIN
+5, &
a˘
, 0) == -1)

99 
	`FATAL
("sigaction %s failed\n", "SIGRTMIN+5");

100 i‡(
	`siga˘i⁄
(
SIGRTMAX
, &
a˘
, 0) == -1)

101 
	`FATAL
("sigaction %s failed\n", "SIGRTMAX");

103 
	`¥ötf
("Processáwaiting signals ...\n");

105 ()
	`∑u£
();

106 
	`exô
(
EXIT_SUCCESS
);

107 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch12/sigq_ipc/sigq_recv.c

21 
	~"../../comm⁄.h
"

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<sig«l.h
>

25 
	~<uni°d.h
>

26 
	~<time.h
>

27 
	~<sys/ty≥s.h
>

29 
	#SIG_COMM
 
SIGRTMIN


	)

30 
	#SLP_SEC
 3

	)

32 vﬁ©ûê
sig_©omic_t
 
	gd©a_ªcvd
=0;

34 
time_t
 
	mtime°amp
;

35 
	msignum
;

36 
pid_t
 
	m£ndî_pid
;

37 
uid_t
 
	m£ndî_uid
;

38 
	md©a
;

39 } 
	trcv_d©a_t
;

40 
rcv_d©a_t
 
	gªcv_d©a
;

49 
	$ªad_msg
(
signum
, 
sigöfo_t
 *
si
, *
˘x
)

51 
time_t
 
tm
;

53 i‡(
	`time
(&
tm
) < 0)

54 
	`WARN
("time(2) failed\n");

56 
ªcv_d©a
.
time°amp
 = 
tm
;

57 
ªcv_d©a
.
signum
 = signum;

58 
ªcv_d©a
.
£ndî_pid
 = 
si
->
si_pid
;

59 
ªcv_d©a
.
£ndî_uid
 = 
si
->
si_uid
;

60 
ªcv_d©a
.
d©a
 = 
si
->
si_vÆue
.
sivÆ_öt
;

62 
d©a_ªcvd
 = 1;

63 
	}
}

65 
	$di•œy_ªcv_d©a
()

67 
as˘m
[128];

69 
	`˘ime_r
(&
ªcv_d©a
.
time°amp
, 
as˘m
);

70 
	`¥ötf
 ("Consumer [%d]Ñeceived data @ %s"

74 
	`gëpid
(),

75 
as˘m
,

76 
ªcv_d©a
.
signum
,

77 
ªcv_d©a
.
£ndî_pid
,

78 
ªcv_d©a
.
£ndî_uid
,

79 
ªcv_d©a
.
d©a
);

80 
	}
}

82 
	$maö
(
¨gc
, **
¨gv
)

84 
siga˘i⁄
 
a˘
;

86 
a˘
.
ß_siga˘i⁄
 = 
ªad_msg
;

87 
	`sigfûl£t
(&
a˘
.
ß_mask
);

88 
a˘
.
ß_Êags
 = 
SA_SIGINFO
 | 
SA_RESTART
;

89 i‡(
	`siga˘i⁄
(
SIG_COMM
, &
a˘
, 0) == -1)

90 
	`FATAL
("sigaction failure");

92 
	`¥ötf
("%s: Hey, consumer here [%d]! Awaiting data fromÖroducer\n"

94 
¨gv
[0], 
	`gëpid
(), 
SLP_SEC
);

98 
	`r_¶ìp
(
SLP_SEC
, 0);

99 i‡(
d©a_ªcvd
) {

100 
	`di•œy_ªcv_d©a
();

101 
d©a_ªcvd
 = 0;

105 
	`exô
(
EXIT_SUCCESS
);

106 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch12/sigq_ipc/sigq_sender.c

21 
	~"../../comm⁄.h
"

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<sig«l.h
>

25 
	~<uni°d.h
>

26 
	~<sys/ty≥s.h
>

28 
	#SIG_COMM
 
SIGRTMIN


	)

30 
	$£nd_≥î
(
pid_t
 
èrgë
, 
sig
, 
vÆ
)

32 
sigvÆ
 
sv
;

34 i‡(
	`kûl
(
èrgë
, 0) < 0)

37 
sv
.
sivÆ_öt
 = 
vÆ
;

38 i‡(
	`sigqueue
(
èrgë
, 
sig
, 
sv
) == -1)

41 
	}
}

43 
	$maö
 (
¨gc
, **
¨gv
)

45 
ªt
=0;

47 i‡(
¨gc
 != 3) {

48 
	`Ârötf
(
°dîr
, "Ußge: %†pid-to-£nd-tÿvÆue-to-£nd[öt]\n", 
¨gv
[0]);

49 
	`exô
 (1);

51 
ªt
 = 
	`£nd_≥î
(
	`©ﬁ
(
¨gv
[1]), 
SIG_COMM
, 
	`©oi
(argv[2]));

52 
ªt
) {

53 -1 : 
	`FATAL
("Target PID invalid orÇoÖermission\n");

54 -2 : 
	`FATAL
("sigqueue failed\n");

55 0 : 
	`¥ötf
("Producer [%d]: sent signal %dÅo PID %ld with data item %d\n",

56 
	`gëpid
(), 
SIG_COMM
, 
	`©ﬁ
(
¨gv
[1]), 
	`©oi
(argv[2]));

58 
	`exô
 (
EXIT_SUCCESS
);

59 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch12/sigwt/sigwt.c

21 
	#_GNU_SOURCE


	)

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<sys/ty≥s.h
>

26 
	~<°rög.h
>

27 
	~<sig«l.h
>

28 
	~"../../comm⁄.h
"

31 
	$siggy
(
signum
)

33 c⁄° *
°r1
 = "*** siggy: handled SIGFPE (8) ***\n";

34 c⁄° *
°r2
 = "*** siggy: handled SIGSEGV (11) ***\n";

36 
signum
) {

37 
SIGFPE
:

38 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r1
, 
	`°æí
(str1)) < 0)

39 
	`WARN
("write str1 failed!");

41 
SIGSEGV
:

42 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r2
, 
	`°æí
(str2)) < 0)

43 
	`WARN
("write str2 failed!");

46 
	}
}

48 
	$maö
(
¨gc
, **
¨gv
)

50 
siga˘i⁄
 
a˘
;

51 
sig£t_t
 
£t
;

52 
sig
=0;

54 i‡(
¨gc
 !2 || ((
	`©oi
(
¨gv
[1]) != 0) &&átoi(argv[1]) != 1)) {

55 
	`Ârötf
(
°dîr
, "Usage: %s 0|1\n"

61 , 
¨gv
[0]);

62 
	`exô
(
EXIT_FAILURE
);

64 
	`sigfûl£t
(&
£t
);

66 i‡(
	`©oi
(
¨gv
[1]) == 1) {

71 
	`¥ötf
("%s:Ñemovög SIGFPEánd SIGSEGV fromÅhêsig«»mask...\n", 
¨gv
[0]);

72 
	`sigdñ£t
(&
£t
, 
SIGFPE
);

74 
	`sigdñ£t
(&
£t
, 
SIGSEGV
);

81 
	`mem£t
(&
a˘
, 0, (act));

82 
a˘
.
ß_h™dÀr
 = 
siggy
;

83 i‡(
	`siga˘i⁄
(
SIGFPE
, &
a˘
, 0) < 0)

84 
	`FATAL
("sigaction on SIGFPE failed");

85 
	`¥ötf
("%s:áŒ sig«l†ex˚± SIGFPEánd SIGSEGV blocked\n", 
¨gv
[0]);

88 
	`¥ötf
("%s: AŒ sig«l†blocked (™d o∆y SIGFPE caughàw/ siga˘i⁄)\n", 
¨gv
[0]);

93 i‡(
	`sig¥ocmask
(
SIG_BLOCK
, &
£t
, 0) < 0)

94 
	`FATAL
("sigprocmask -to block- failed\n");

95 i‡(
	`show_blocked_sig«ls
() < 0)

96 
	`WARN
("sigprocmask -query- failed\n");

98 
	`¥ötf
("%s: waôög up⁄ sig«l†now ...\n", 
¨gv
[0]);

100 i‡(
	`sigwaô
(&
£t
, &
sig
))

101 
	`FATAL
("sigwait failed\n");

102 
	`¥ötf
("Re˚ived sig«l# %2d\n", 
sig
);

104 
	`exô
(
EXIT_SUCCESS
);

105 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch12/sleeping_beauty.c

24 
	~<°dio.h
>

25 
	~<uni°d.h
>

26 
	~<°dlib.h
>

27 
	~<time.h
>

28 
	~<sig«l.h
>

29 
	~<°rög.h
>

30 
	~<î∫o.h
>

31 
	~"../comm⁄.h
"

33 
	$sig_h™dÀr
(
signum
)

35 
	`Ârötf
(
°dîr
, "**Sig«»%d i¡îru±i⁄!**\n", 
signum
);

36 
	}
}

38 
	$maö
(
¨gc
, **
¨gv
)

40 
siga˘i⁄
 
a˘
;

41 
n£c
 = 10, 
ªt
;

42 
time•ec
 
ªq
, 
ªm
;

44 i‡(
¨gc
 == 1) {

45 
	`Ârötf
(
°dîr
, "Usage: %s option=[0|1]\n"

47 "1 : u£†thê«no¶ìp(2ËsysˇŒ\n", 
¨gv
[0]);

48 
	`exô
(
EXIT_FAILURE
);

52 
	`mem£t
(&
a˘
, 0, (act));

53 
a˘
.
ß_h™dÀr
 = 
sig_h™dÀr
;

54 
	`sigem±y£t
(&
a˘
.
ß_mask
);

55 
a˘
.
ß_Êags
 = 
SA_RESTART
;

56 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0Ë|| siga˘i⁄(
SIGQUIT
, &act, 0))

57 
	`FATAL
("sigaction failure\n");

59 i‡(
	`©oi
(
¨gv
[1]) == 0) {

60 
	`¥ötf
("¶ì∞f‹ %d sÇow...\n", 
n£c
);

61 
ªt
 = 
	`¶ìp
(
n£c
);

62 
	`¥ötf
("¶ì∞ªtu∫ed %u\n", 
ªt
);

63 } i‡(
	`©oi
(
¨gv
[1]) == 1) {

64 
ªq
.
tv_£c
 = 
n£c
;

65 
ªq
.
tv_n£c
 = 0;

66 (
	`«no¶ìp
(&
ªq
, &
ªm
Ë=-1Ë&& (
î∫o
 =
EINTR
)) {

67 
	`¥ötf
("nanosleep interrupted:ÑemÅime: %07lu.%07lu\n",

68 
ªm
.
tv_£c
,Ñem.
tv_n£c
);

69 
ªq
 = 
ªm
;

72 
	`exô
(
EXIT_SUCCESS
);

73 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch13/alarm1.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<sig«l.h
>

22 
	~<°rög.h
>

23 
	~<uni°d.h
>

24 
	~"../comm⁄.h
"

27 
	$sig_h™dÀr
(
signum
)

29 c⁄° *
°r
 = " *** Timeout! [SIGALRMÑeceived] ***\n";

31 i‡(
signum
 !
SIGALRM
)

33 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r
, 
	`°æí
(str)) < 0)

34 
	`WARN
("write str failed!");

35 
	}
}

37 
	$maö
(
¨gc
, **
¨gv
)

39 
n
 = 0;

40 
siga˘i⁄
 
a˘
;

42 i‡(
¨gc
 != 2) {

43 
	`Ârötf
(
°dîr
, "Ußge: %†£c⁄ds-to-timeout(>0)\n", 
¨gv
[0]);

44 
	`exô
(
EXIT_FAILURE
);

46 
n
 = 
	`©oi
(
¨gv
[1]);

47 i‡(
n
 <= 0) {

48 
	`Ârötf
(
°dîr
, "Ußge: %†£c⁄ds-to-timeout(>0)\n", 
¨gv
[0]);

49 
	`exô
(
EXIT_FAILURE
);

56 
	`mem£t
(&
a˘
, 0, (act));

57 
a˘
.
ß_h™dÀr
 = 
sig_h™dÀr
;

58 i‡(
	`siga˘i⁄
(
SIGALRM
, &
a˘
, 0) < 0)

59 
	`FATAL
("sigaction on SIGALRM failed");

61 
	`Æ¨m
(
n
);

62 
	`¥ötf
("AÅimeouàf‹ %d†ha†bì¿¨med...\n", 
n
);

63 
	`∑u£
();

65 
	`exô
(
EXIT_SUCCESS
);

66 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch13/alarm2_rep.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<sig«l.h
>

21 
	~<°rög.h
>

22 
	~<uni°d.h
>

23 
	~"../comm⁄.h
"

26 
	$sig_h™dÀr
(
signum
)

28 c⁄° *
°r
 = " *** Timeout! [SIGALRMÑeceived] ***\n";

30 i‡(
signum
 !
SIGALRM
)

32 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r
, 
	`°æí
(str)) < 0)

33 
	`WARN
("write str failed!");

34 
	}
}

36 
	$maö
(
¨gc
, **
¨gv
)

38 
n
 = 0;

39 
siga˘i⁄
 
a˘
;

41 i‡(
¨gc
 != 2) {

42 
	`Ârötf
(
°dîr
, "Usage: %s seconds-to-repetitive-timeout(>0)\n",

43 
¨gv
[0]);

44 
	`exô
(
EXIT_FAILURE
);

46 
n
 = 
	`©oi
(
¨gv
[1]);

47 i‡(
n
 <= 0) {

48 
	`Ârötf
(
°dîr
, "Usage: %s seconds-to-repetitive-timeout(>0)\n",

49 
¨gv
[0]);

50 
	`exô
(
EXIT_FAILURE
);

57 
	`mem£t
(&
a˘
, 0, (act));

58 
a˘
.
ß_h™dÀr
 = 
sig_h™dÀr
;

59 i‡(
	`siga˘i⁄
(
SIGALRM
, &
a˘
, 0) < 0)

60 
	`FATAL
("sigaction on SIGALRM failed");

62 
	`Æ¨m
(
n
);

63 
	`¥ötf
("AÅimeouàf‹ %d†ha†bì¿¨med...\n", 
n
);

66 
	`∑u£
();

67 
	`Æ¨m
(
n
);

68 
	`¥ötf
(" Timeouàf‹ %d†ha†bì¿‘eÔrmed...\n", 
n
);

71 
	`exô
(
EXIT_SUCCESS
);

72 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch13/intv_clksimple.c

19 
	#_GNU_SOURCE


	)

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<sig«l.h
>

23 
	~<°rög.h
>

24 
	~<uni°d.h
>

25 
	~<time.h
>

26 
	~<sys/time.h
>

27 
	~<î∫o.h
>

28 
	~"../comm⁄.h
"

30 vﬁ©ûê
sig_©omic_t
 
	g›t
;

32 
	$ticktock
(
signum
)

34 
tm°amp
[128];

35 
time•ec
 
tm
;

36 
myî∫o
 = 
î∫o
;

40 i‡(
	`˛ock_gëtime
(
CLOCK_REALTIME
, &
tm
) < 0)

41 
	`FATAL
("clock_gettime failed\n");

42 i‡(
	`˘ime_r
(&
tm
.
tv_£c
, &
tm°amp
[0]Ë=
NULL
)

43 
	`FATAL
("ctime_r failed\n");

45 i‡(
›t
 == 0) {

46 i‡(
	`wrôe
(
STDOUT_FILENO
, 
tm°amp
, 
	`°æí
(tmstamp)) < 0)

47 
	`FATAL
("write failed\n");

48 } i‡(
›t
 == 1) {

53 
tm°amp
[
	`°æí
(tmstamp) - 1] = '\0';

54 
	`¥ötf
("\r%s", 
tm°amp
);

55 
	`fÊush
(
°dout
);

57 
î∫o
 = 
myî∫o
;

58 
	}
}

60 
	$ußge_dõ
(*
«me
)

62 
	`Ârötf
(
°dîr
, "Usage: %s {0|1}\n"

65 
«me
);

66 
	`exô
(
EXIT_FAILURE
);

67 
	}
}

69 
	$maö
(
¨gc
, **
¨gv
)

71 
siga˘i⁄
 
a˘
;

72 
ôimîvÆ
 
mytimî
;

74 i‡((
¨gc
 !2Ë|| (
	`°æí
(
¨gv
[1]) != 1))

75 
	`ußge_dõ
(
¨gv
[0]);

76 
›t
 = 
	`©oi
(
¨gv
[1]);

77 i‡((
›t
 != 0) && (opt != 1))

78 
	`ußge_dõ
(
¨gv
[0]);

80 
	`¥ötf
("Initializing ...\n");

81 i‡(
›t
 == 1)

82 
	`¥ötf
(" *WARNING* [UsingÖrintf in signal handler]\n");

84 
	`mem£t
(&
a˘
, 0, (act));

85 
a˘
.
ß_h™dÀr
 = 
ticktock
;

86 
	`sigfûl£t
(&
a˘
.
ß_mask
);

95 i‡(
	`siga˘i⁄
(
SIGALRM
, &
a˘
, 0) < 0)

96 
	`FATAL
("sigaction on SIGALRM failed");

99 
	`mem£t
(&
mytimî
, 0, (
ôimîvÆ
));

100 
mytimî
.
ô_vÆue
.
tv_£c
 = 1;

101 
mytimî
.
ô_öãrvÆ
.
tv_£c
 = 1;

102 i‡(
	`£tôimî
(
ITIMER_REAL
, &
mytimî
, 0) < 0)

103 
	`FATAL
("setitimer failed\n");

106 ()
	`∑u£
();

108 
	`exô
(
EXIT_SUCCESS
);

109 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch13/react.c

39 
	#_GNU_SOURCE


	)

40 
	~<°dio.h
>

41 
	~<°dlib.h
>

42 
	~<uni°d.h
>

43 
	~<sig«l.h
>

44 
	~<time.h
>

45 
	~<sys/time.h
>

46 
	~<sys/ªsour˚.h
>

47 
	~<°rög.h
>

48 
	~<m©h.h
>

49 
	~"../comm⁄.h
"

52 
	ggVîbo£
 = 0;

53 
	g‰eq_ms
 = 0;

54 
ôimî•ec
 
	gôv
;

55 
timî_t
 
	gtimîid
;

56 vﬁ©ûê
sig_©omic_t
 
	ggTimîRïóts
 = 0, 
	gc
 = 0, 
	gfú°_time
 = 1,

57 
	gjum≥d_the_gun
 = 1;

58 
time•ec
 
	gtm_°¨t
, 
	gtm_íd
;

60 
	#MIN_START_SEC
 1

	)

61 
	#MAX_START_SEC
 5

	)

71 
	$timî_h™dÀr
(
sig
, 
sigöfo_t
 * 
si
, *
uc
)

73 
buf
[] = ".";

75 
c
++;

76 i‡(
gVîbo£
) {

77 
	`wrôe
(2, 
buf
, 1);

78 
	#SHOW_OVERRUN
 1

	)

79 #i‡(
SHOW_OVERRUN
 == 1)

81 
ovrun
 = 
	`timî_gëovîrun
(
timîid
);

82 i‡(
ovrun
 == -1)

83 
	`WARN
("timer_getoverrun");

85 i‡(
ovrun
)

86 
	`¥ötf
(" overrun=%d [@count=%d]\n",

87 
ovrun
, 
c
);

92 
	}
}

102 
	$u£Ωªss
(
sig
)

104 
time•ec
 
ªs
;

107 i‡(
	`˛ock_gëtime
(
CLOCK_REALTIME
, &
tm_íd
) < 0)

108 
	`FATAL
("clock_gettime (tm_end) failed\n");

110 i‡(
jum≥d_the_gun
) {

111 
	`¥ötf
("\n:-/ Whoops, you jumpedÅhe gun! Unfair,áborting.\n");

112 
	`exô
(
EXIT_FAILURE
);

115 i‡(
fú°_time
) {

116 i‡(
c
 == 0)

117 
¥ötf


120 
	`¥ötf
("\n*** PRESSED ***\n");

126 
	`timî•ecsub
(&
tm_íd
, &
tm_°¨t
, &
ªs
);

127 
¥ötf


130 
ªs
.
tv_£c
,Ñes.
tv_n£c
,

131 
ªs
.
tv_£c
 * 1000 +

132 
	`round
(()
ªs
.
tv_n£c
 / 1000000), 
c
);

134 
fú°_time
 = 0;

136 
	`¥ötf
("\¿^CÖªs£d [cou¡=%d]\n", 
c
);

138 
c
 = 0;

140 i‡(!
gTimîRïóts
)

141 
	`exô
(
EXIT_SUCCESS
);

142 
	}
}

144 
	$¨m_timî
(
timî_t
 
tmrid
, 
ôimî•ec
 *
ôm•ec
)

146 
	`VPRINT
("ArmingÅimerÇow\n");

147 i‡(
	`timî_£âime
(
tmrid
, 0, 
ôm•ec
, 
NULL
) == -1)

148 
	`FATAL
("timer_settime failed\n");

149 
jum≥d_the_gun
 = 0;

150 
	}
}

158 
	$°¨toff
(
sig
)

160 
¥ess_msg
[] = "\n*** QUICK! Press ^C !!! ***\n";

162 
	`¨m_timî
(
timîid
, &
ôv
);

163 
	`wrôe
(
STDERR_FILENO
, 
¥ess_msg
, 
	`°æí
(press_msg));

166 i‡(
	`˛ock_gëtime
(
CLOCK_REALTIME
, &
tm_°¨t
) < 0)

167 
	`FATAL
("clock_gettime (tm_start) failed\n");

168 
	}
}

170 
	$show_tmvÆ
(
ôimî•ec
 
ôv
)

172 
	`¥ötf
("timer struct ::\n"

175 
ôv
.
ô_vÆue
.
tv_£c
, itv.ô_vÆue.
tv_n£c
,

176 
ôv
.
ô_öãrvÆ
.
tv_£c
, itv.ô_öãrvÆ.
tv_n£c
);

177 
	}
}

179 
	$öô
()

181 
sigevít
 
£v
;

182 
æimô
 
æim
;

183 
siga˘i⁄
 
a˘
;

186 
	`mem£t
(&
a˘
, 0, (act));

187 
a˘
.
ß_Êags
 = 
SA_SIGINFO
 | 
SA_RESTART
;

188 
a˘
.
ß_siga˘i⁄
 = 
timî_h™dÀr
;

189 i‡(
	`siga˘i⁄
(
SIGRTMIN
, &
a˘
, 
NULL
) == -1)

190 
	`FATAL
("sigaction SIGRTMIN failed\n");

193 
	`mem£t
(&
a˘
, 0, (act));

194 
a˘
.
ß_h™dÀr
 = 
u£Ωªss
;

195 
a˘
.
ß_Êags
 = 
SA_RESTART
;

196 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 
NULL
) == -1)

197 
	`FATAL
("sigaction SIGINT failed\n");

200 
	`mem£t
(&
a˘
, 0, (act));

201 
a˘
.
ß_h™dÀr
 = 
°¨toff
;

202 
a˘
.
ß_Êags
 = 
SA_RESTART
;

203 i‡(
	`siga˘i⁄
(
SIGALRM
, &
a˘
, 
NULL
) == -1)

204 
	`FATAL
("sigaction SIGALRM failed\n");

207 
£v
.
sigev_nŸify
 = 
SIGEV_SIGNAL
;

208 
£v
.
sigev_signo
 = 
SIGRTMIN
;

209 
£v
.
sigev_vÆue
.
sivÆ_±r
 = &
timîid
;

210 i‡(
	`timî_¸óã
(
CLOCK_REALTIME
, &
£v
, &
timîid
) == -1)

211 
	`FATAL
("timer_create failed\n");

213 
	`¥ötf
("InitializingÅimerÅo generate SIGRTMINÉvery %ld ms\n",

214 
‰eq_ms
);

215 
	`mem£t
(&
ôv
, 0, (
ôimî•ec
));

216 
ôv
.
ô_vÆue
.
tv_£c
 = (
‰eq_ms
 * 1000000) / 1000000000;

217 
ôv
.
ô_vÆue
.
tv_n£c
 = (
‰eq_ms
 * 1000000) % 1000000000;

218 
ôv
.
ô_öãrvÆ
.
tv_£c
 = (
‰eq_ms
 * 1000000) / 1000000000;

219 
ôv
.
ô_öãrvÆ
.
tv_n£c
 = (
‰eq_ms
 * 1000000) % 1000000000;

221 i‡(
gVîbo£
) {

222 
	`show_tmvÆ
(
ôv
);

223 i‡(
	`show_blocked_sig«ls
() < 0)

224 
	`WARN
("sigprocmask -query- failed\n");

231 
	`mem£t
(&
æim
, 0, (rlim));

232 i‡(
	`¥limô
(0, 
RLIMIT_CORE
, &
æim
, 
NULL
) == -1)

233 
	`WARN
("prlimit:coreÅo zero failed\n");

235 
	}
}

241 
	$øndom_°¨t
(
mö
, 
max
)

243 
ƒ
;

245 
	`Æ¨m
(0);

246 
	`§™dom
(
	`time
(0));

247 
ƒ
 = (
	`øndom
(Ë% 
max
Ë+ 
mö
;

249 
	#CHEAT_MODE
 0

	)

250 #i‡(
CHEAT_MODE
 == 1)

251 
	`¥ötf
("Ok Chóã∏:-ËgëÑódy;Öªs†^C i¿%d†...\n", 
ƒ
);

254 
	`Æ¨m
(
ƒ
);

255 
	}
}

257 
	$hñp
(*
«me
)

259 
	`Ârötf
(
°dîr
,

270 
«me
,Çame,Çame, 
MIN_START_SEC
, 
MAX_START_SEC
);

271 
	}
}

273 
	$maö
(
¨gc
, **
¨gv
)

275 i‡(
¨gc
 < 2) {

276 
	`hñp
(
¨gv
[0]);

277 
	`exô
(
EXIT_FAILURE
);

279 i‡(
¨gc
 =3 && 
	`©oi
(
¨gv
[2]) == 1)

280 
gVîbo£
 = 1;

281 
‰eq_ms
 = 
	`©ﬁl
(
¨gv
[1]);

282 i‡(
‰eq_ms
 < 1) {

283 
	`hñp
(
¨gv
[0]);

284 
	`exô
(
EXIT_FAILURE
);

287 
	`öô
();

288 
	`¥ötf
("[Verbose: %s]\n"

290 
gVîbo£
 =1 ? "Y" : "N", 
MIN_START_SEC
, 
MAX_START_SEC
);

291 
	`¥ötf
("\nGET READY ...\n"

294 
	`øndom_°¨t
(
MIN_START_SEC
, 
MAX_START_SEC
);

297 ()
	`∑u£
();

300 
	`exô
(
EXIT_SUCCESS
);

301 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch13/runwalk_timer.c

39 
	~<°dio.h
>

40 
	~<sig«l.h
>

41 
	~<time.h
>

42 
	~<°dlib.h
>

43 
	~<°rög.h
>

44 
	~<uni°d.h
>

45 
	~<limôs.h
>

46 
	~<î∫o.h
>

47 
	~<as£π.h
>

48 
	~<sys/ty≥s.h
>

49 
	~<sys/time.h
>

50 
	~"../comm⁄.h
"

53 
	#VER
 "1.0"

	)

54 
	#PRG_BANNER
 "************* Ru¿WÆk Timî *************\n"

	)

55 
	#WALK_MIN_GRANULARITY
 1

	)

59 
	evîbosôy_Àvñ
 {

60 
	mOFF
 = 0,

61 
	mLOW
,

62 
	mHIGH


64 vﬁ©ûê
sig_©omic_t
 
	gvîbo£
 = 
LOW
;

66 
	ety≥
 {

67 
	mRUN
 = 0,

68 
	mWALK


73 
	måun
, 
	mtwÆk
;

74 
	mty≥
;

75 
ôimî•ec
 *
	mômr•ec
;

76 
timî_t
 
	mtimîid
;

77 } 
	tsRunWÆk
;

81 
ölöe
 
	$BUZZ
(*
msg
)

83 
	`Ârötf
(
°dîr
, "\n*** Bzzzz!!! %†***", 
msg
);

86 
	}
}

88 
	$ôs_time
(
signum
, 
sigöfo_t
 *
si
, *
u˘x
)

91 vﬁ©ûê
sRunWÆk
 *
ps
 = (sRunWÆk *)
si
->
si_vÆue
.
sivÆ_±r
;

93 
	`as£π
(
ps
);

94 i‡(
vîbo£
 =
HIGH
)

95 
	`¥ötf
("%s: signal %d.ÑunwalkÖtr: %p"

97 
__func__
, 
signum
,

98 
ps
,

99 
ps
->
ty≥
 =
WALK
 ? "WÆk" : "Run", 
	`timî_gëovîrun
’s->
timîid
)

102 
	`mem£t
(
ps
->
ômr•ec
, 0, (
sRunWÆk
));

103 i‡(
ps
->
ty≥
 =
WALK
) {

104 
	`BUZZ
(" RUN!");

105 
ps
->
ômr•ec
->
ô_vÆue
.
tv_£c
 =Ös->
åun
;

106 
	`¥ötf
(" f‹ %4d sec⁄ds\n", 
ps
->
åun
);

109 
	`BUZZ
(" WALK!");

110 
ps
->
ômr•ec
->
ô_vÆue
.
tv_£c
 =Ös->
twÆk
;

111 
	`¥ötf
(" f‹ %4d sec⁄ds\n", 
ps
->
twÆk
);

113 
ps
->
ty≥
 = !ps->type;

116 i‡(
	`timî_£âime
(
ps
->
timîid
, 0,Ös->
ômr•ec
, 
NULL
) < 0)

117 
	`FATAL
("timer_settime failed");

118 
	}
}

124 
	$runwÆk_timî_öô_™d_¨m
(
sRunWÆk
 * 
ps
)

126 
siga˘i⁄
 
a˘
;

127 
sigevít
 
runwÆk_evp
;

129 
	`as£π
(
ps
);

131 
a˘
.
ß_siga˘i⁄
 = 
ôs_time
;

132 
a˘
.
ß_Êags
 = 
SA_SIGINFO
;

133 
	`sigfûl£t
(&
a˘
.
ß_mask
);

134 i‡(
	`siga˘i⁄
(
SIGRTMIN
, &
a˘
, 0) < 0)

135 
	`FATAL
("sigaction: SIGRTMIN");

137 
	`mem£t
(
ps
->
ômr•ec
, 0, (
sRunWÆk
));

138 
ps
->
ty≥
 = 
RUN
;

139 
ps
->
ômr•ec
->
ô_vÆue
.
tv_£c
 =Ös->
åun
;

141 
runwÆk_evp
.
sigev_nŸify
 = 
SIGEV_SIGNAL
;

142 
runwÆk_evp
.
sigev_signo
 = 
SIGRTMIN
;

144 
runwÆk_evp
.
sigev_vÆue
.
sivÆ_±r
 = 
ps
;

147 i‡(
	`timî_¸óã
(
CLOCK_REALTIME
, &
runwÆk_evp
, &
ps
->
timîid
) < 0)

148 
	`FATAL
("timer_create");

151 i‡(
	`timî_£âime
(
ps
->
timîid
, 0,Ös->
ômr•ec
, 
NULL
) < 0)

152 
	`FATAL
("timer_settime failed");

153 
	}
}

155 
	$bye
(
signum
)

157 *
ßybye
 = "\n+++ Good job, bye! +++\n";

158 
	`wrôe
(
STDOUT_FILENO
, 
ßybye
, 
	`°æí
(saybye));

159 
	`exô
(
EXIT_SUCCESS
);

160 
	}
}

162 
ölöe
 
	$hñp_™d_dõ
(**
¨gv
)

164 
	`Ârötf
(
°dîr
,

167 
¨gv
[0]);

168 
	`exô
(
EXIT_FAILURE
);

169 
	}
}

171 
	$maö
(
¨gc
, **
¨gv
)

173 
siga˘i⁄
 
a˘
;

174 
sRunWÆk
 
runwÆk
;

175 
ôimî•ec
 
runwÆk_curvÆ
;

177 i‡(
¨gc
 < 3)

178 
	`hñp_™d_dõ
(
¨gv
);

179 i‡(
¨gc
 == 4) {

180 
vîbo£
 = 
	`©oi
(
¨gv
[3]);

181 i‡(
vîbo£
 < 0 || vîbo£ > 
HIGH
)

182 
	`hñp_™d_dõ
(
¨gv
);

186 
	`mem£t
(&
a˘
, 0, (act));

187 
a˘
.
ß_h™dÀr
 = 
bye
;

188 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) < 0)

189 
	`FATAL
("sigaction: SIGINT");

191 
	`mem£t
(&
runwÆk
, 0, (
sRunWÆk
));

193 
î∫o
 = 0;

194 
runwÆk
.
åun
 = 
	`°πoul
(
¨gv
[1], 0, 0);

195 i‡(
î∫o
 =
ERANGE
 ||Éºnÿ=
EINVAL
)

196 
	`FATAL
("Invalid input [strtoul]\n");

198 
î∫o
 = 0;

199 
runwÆk
.
twÆk
 = 
	`°πoul
(
¨gv
[2], 0, 0);

200 i‡(
î∫o
 =
ERANGE
 ||Éºnÿ=
EINVAL
)

201 
	`FATAL
("Invalid input [strtoul]\n");

204 i‡(
runwÆk
.
åun
 <0 ||ÑunwÆk.
twÆk
 <= 0)

205 
	`hñp_™d_dõ
(
¨gv
);

207 
	`¥ötf
("%† Vî %s\n", 
PRG_BANNER
, 
VER
);

209 
runwÆk
.
ômr•ec
 = 
	`ˇŒoc
(1, (
ôimî•ec
));

210 i‡(!
runwÆk
.
ômr•ec
)

211 
	`FATAL
("calloc failed");

213 
	`¥ötf
("\nGë movög... Ru¿f‹ %d sec⁄ds\n", 
runwÆk
.
åun
);

214 i‡(
vîbo£
 =
HIGH
)

215 
	`¥ötf
("trun=%4dÅwalk=%4d;ápp ctxÖtr = %p\n",

216 
runwÆk
.
åun
,ÑunwÆk.
twÆk
, &runwalk);

218 
	`runwÆk_timî_öô_™d_¨m
(&
runwÆk
);

221 i‡(
vîbo£
 =
HIGH
) {

222 i‡(
	`timî_gëtime
(
runwÆk
.
timîid
, &
runwÆk_curvÆ
) < 0)

223 
	`FATAL
("timer_gettime failed");

226 
	`¥ötf
("runwalk: %4ld.%lds\n",

227 
runwÆk_curvÆ
.
ô_vÆue
.
tv_£c
,

228 
runwÆk_curvÆ
.
ô_vÆue
.
tv_n£c
 / 1000000);

229 } i‡(
vîbo£
 =
LOW
) {

230 
	`¥ötf
(".");

231 
	`fÊush
(
°dout
);

234 i‡(
vîbo£
 !
OFF
)

239 
	`¶ìp
(
WALK_MIN_GRANULARITY
);

242 ()
	`∑u£
();

246 ()
	`∑u£
();

247 
	`‰ì
(
runwÆk
.
ômr•ec
);

248 
	`exô
(
EXIT_SUCCESS
);

249 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/cr8_so_many_threads.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<±hªad.h
>

21 
	~"../comm⁄.h
"

23 * 
	$w‹kî
(*
d©a
)

25 
d©um
 = ()
d©a
;

26 
	`¥ötf
("W‹kîÅhªad #%5ld:ÖausögÇow...\n", 
d©um
);

27 ()
	`∑u£
();

28 
	`¥ötf
(" #%5ld: w‹k d⁄e,ÉxôögÇow\n", 
d©um
);

29 
	`±hªad_exô
(
NULL
);

30 
	}
}

32 
	$maö
(
¨gc
, **
¨gv
)

34 
i
;

35 
ªt
;

36 
±hªad_t
 
tid
;

37 
numthrds
=0;

39 i‡(
¨gc
 != 2) {

40 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-thªads-to-¸óã\n", 
¨gv
[0]);

41 
	`exô
(
EXIT_FAILURE
);

43 
numthrds
 = 
	`©ﬁ
(
¨gv
[1]);

44 i‡(
numthrds
 <= 0) {

45 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-thªads-to-¸óã\n", 
¨gv
[0]);

46 
	`exô
(
EXIT_FAILURE
);

49 
i
 = 0; i < 
numthrds
; i++) {

50 
ªt
 = 
	`±hªad_¸óã
(&
tid
, 
NULL
, 
w‹kî
, (*)
i
);

51 i‡(
ªt
)

52 
	`FATAL
("±hªad_¸óã(Ë#%d faûed! [%d]\n", 
i
, 
ªt
);

54 
	`±hªad_exô
(
NULL
);

55 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/disp_defattr_pthread.c

18 
	~"../comm⁄.h
"

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<±hªad.h
>

24 
	$di•œy_thrd_©å
(
±hªad_©å_t
 *
©å
)

26 
dëach°
=0;

27 
sched_sc›e
=0, 
sched_öh
=0, 
sched_pﬁicy
=0;

28 
sched_∑øm
 
sch_∑øm
;

29 
size_t
 
gu¨dsz
=0, 
°acksz
=0;

30 *
°ackaddr
;

33 i‡(
	`±hªad_©å_gëdëach°©e
(
©å
, &
dëach°
))

34 
	`WARN
("pthread_attr_getdetachstate() failed.\n");

35 
	`¥ötf
("Detach State : %s\n",

36 (
dëach°
 =
PTHREAD_CREATE_JOINABLE
) ? "PTHREAD_CREATE_JOINABLE" :

37 (
dëach°
 =
PTHREAD_CREATE_DETACHED
) ? "PTHREAD_CREATE_DETACHED" :

41 
	`¥ötf
("Scheduling \n");

43 i‡(
	`±hªad_©å_gësc›e
(
©å
, &
sched_sc›e
))

44 
	`WARN
("pthread_attr_getscope() failed.\n");

45 
	`¥ötf
(" Scope : %s\n",

46 (
sched_sc›e
 =
PTHREAD_SCOPE_SYSTEM
) ? "PTHREAD_SCOPE_SYSTEM" :

47 (
sched_sc›e
 =
PTHREAD_SCOPE_PROCESS
) ? "PTHREAD_SCOPE_PROCESS" :

51 i‡(
	`±hªad_©å_gëöhîôsched
(
©å
, &
sched_öh
))

52 
	`WARN
("pthread_attr_getinheritsched() failed.\n");

53 
	`¥ötf
(" Inheritance : %s\n",

54 (
sched_öh
 =
PTHREAD_INHERIT_SCHED
) ? "PTHREAD_INHERIT_SCHED" :

55 (
sched_öh
 =
PTHREAD_EXPLICIT_SCHED
) ? "PTHREAD_EXPLICIT_SCHED" :

59 i‡(
	`±hªad_©å_gëschedpﬁicy
(
©å
, &
sched_pﬁicy
))

60 
	`WARN
("pthread_attr_getschedpolicy() failed.\n");

61 
	`¥ötf
(" Policy : %s\n",

62 (
sched_pﬁicy
 =
SCHED_FIFO
) ? "SCHED_FIFO" :

63 (
sched_pﬁicy
 =
SCHED_RR
) ? "SCHED_RR" :

64 (
sched_pﬁicy
 =
SCHED_OTHER
) ? "SCHED_OTHER" :

68 i‡(
	`±hªad_©å_gësched∑øm
(
©å
, &
sch_∑øm
))

69 
	`WARN
("pthread_attr_getschedparam() failed.\n");

70 
	`¥ötf
(" Pri‹ôy : %d\n", 
sch_∑øm
.
sched_¥i‹ôy
);

73 
	`¥ötf
("Thread Stack \n");

75 i‡(
	`±hªad_©å_gëgu¨dsize
(
©å
, &
gu¨dsz
))

76 
	`WARN
("pthread_attr_getguardsize() failed.\n");

77 
	`¥ötf
(" Gu¨d Sizê: %9zu byãs\n", 
gu¨dsz
);

83 i‡(
	`±hªad_©å_gë°ack
(
©å
, &
°ackaddr
, &
°acksz
))

84 
	`WARN
("pthread_attr_getstack() failed.\n");

85 
	`¥ötf
(" Sèck Sizê: %9zu byãs\n", 
°acksz
);

86 
	}
}

88 
	$maö
()

90 
ªt
;

91 
±hªad_©å_t
 
©å
;

93 
ªt
 = 
	`±hªad_gë©å_deÁu…_≈
(&
©å
);

94 i‡(
ªt
)

95 
	`FATAL
("±hªad_gë©å_deÁu…_≈(ËÁûed! [%d]\n", 
ªt
);

96 
	`¥ötf
("Linux Default Thread Attributes:\n");

97 
	`di•œy_thrd_©å
(&
©å
);

99 
	`exô
(
EXIT_SUCCESS
);

100 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/param_passing/pthreads1_wrong.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<±hªad.h
>

21 
	~"../../comm⁄.h
"

23 
	#NTHREADS
 3

	)

25 * 
	$w‹kî
(*
d©a
)

27 
d©a_addr
 = ()
d©a
;

28 
ödex
 = *(*)
d©a_addr
;

30 
	`¥ötf
("WorkerÅhread: data_addr=%p value=%ld\n",

31 (*)
d©a_addr
, 
ödex
);

32 
	`±hªad_exô
((*)0);

33 
	}
}

35 
	$maö
()

37 
i
;

38 
ªt
;

39 
±hªad_t
 
tid
;

41 
	`¥ötf
("maö: &i=%p\n", &
i
);

42 
i
 = 0; i < 
NTHREADS
; i++) {

43 
	`¥ötf
("Cª©ögÅhªad #%ldÇow ...\n", 
i
);

44 
ªt
 = 
	`±hªad_¸óã
(&
tid
, 
NULL
, 
w‹kî
, (*)&
i
);

45 i‡(
ªt
)

46 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

48 
	`¶ìp
(2);

50 
	`exô
(
EXIT_SUCCESS
);

51 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/param_passing/struct_as_param.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<°rög.h
>

20 
	~<uni°d.h
>

21 
	~<±hªad.h
>

22 
	~"../../comm⁄.h
"

24 
	#NTHREADS
 3

	)

25 
	#IATA_MAXSZ
 3

	)

26 
	#CITY_MAXSZ
 128

	)

32 
	mIATA_code
[
IATA_MAXSZ
];

33 
	mcôy
[
CITY_MAXSZ
];

34 
	mœtôude
, 
	ml⁄gôude
;

35 
	mÆtôude
;

37 
	mª£rved
;

38 } 
	tAúp‹t
;

40 c⁄° 
Aúp‹t
 
	gcôy_aúp‹ts
[3] = {

47 * 
	$w‹kî
(*
d©a
)

49 
Aúp‹t
 * 
¨g
 = (Aúp‹à*)
d©a
;

50 
¶±m
=8;

52 
	`¥ötf
( "\n----------- Airports Details ---------------\n"

55 , 
IATA_MAXSZ
, 
¨g
->
IATA_code
,

56 
¨g
->
côy
,

57 
¨g
->
œtôude
,árg->
l⁄gôude
,árg->
Ætôude
);

59 
	`¥ötf
(" w‹kî : wû»¶ì∞f‹ %d†now ...\n", 
¶±m
);

60 
	`¶ìp
(
¶±m
);

61 
	`¥ötf
(" worker : work done,ÉxitingÇow\n");

65 
	`±hªad_exô
((*)0);

66 
	}
}

68 
	$maö
()

70 
i
;

71 
ªt
, 
°©
=0;

72 
±hªad_t
 
tid
[
NTHREADS
];

73 
±hªad_©å_t
 
©å
;

74 
Aúp‹t
 * 
∂ocd©a
[
NTHREADS
];

77 
	`±hªad_©å_öô
(&
©å
);

79 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

82 
i
 = 0; i < 
NTHREADS
; i++) {

83 
	`¥ötf
("maö: cª©ögÅhªad #%ld ...\n", 
i
);

87 
∂ocd©a
[
i
] = 
	`ˇŒoc
(1, (
Aúp‹t
));

88 i‡(!
∂ocd©a
[
i
])

89 
	`FATAL
("ˇŒo¯[%d] faûed\n", 
i
);

90 
	`mem˝y
(
∂ocd©a
[
i
], &
côy_aúp‹ts
[i], (
Aúp‹t
));

92 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)
∂ocd©a
[i]);

93 i‡(
ªt
)

94 
	`FATAL
("±hªad_¸óã(Ëödex %d faûed! [%d]\n", 
i
, 
ªt
);

96 
	`±hªad_©å_de°roy
(&
©å
);

99 
i
 = 0; i < 
NTHREADS
; i++) {

100 
	`¥ötf
("maö: joöög (waôögËup⁄Åhªad #%ld ...\n", 
i
);

101 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

102 i‡(
ªt
)

103 
	`WARN
("±hªad_joö(Ëödex %d faûed! [%d]\n", 
i
, 
ªt
);

105 
	`¥ötf
("Thread #%ld successfully joined; itÅerminated with "

106 "°©us=%d\n", 
i
, 
°©
);

107 
	`‰ì
(
∂ocd©a
[
i
]);

110 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

111 
	`±hªad_exô
(
NULL
);

112 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/pthreads1.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<±hªad.h
>

21 
	~"../comm⁄.h
"

23 
	#NTHREADS
 3

	)

25 * 
	$w‹kî
(*
d©a
)

27 
d©um
 = ()
d©a
;

28 
	`¥ötf
("W‹kîÅhªad #%ld says: hñlo, w‹ld.\n", 
d©um
);

29 
	`¥ötf
(" #%ld: w‹k d⁄e,ÉxôögÇow\n", 
d©um
);

30 
	}
}

32 
	$maö
()

34 
i
;

35 
ªt
;

36 
±hªad_t
 
tid
;

38 
i
 = 0; i < 
NTHREADS
; i++) {

39 
ªt
 = 
	`±hªad_¸óã
(&
tid
, 
NULL
, 
w‹kî
, (*)
i
);

40 i‡(
ªt
)

41 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

44 
	`exô
(
EXIT_SUCCESS
);

45 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/pthreads2.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<±hªad.h
>

21 
	~"../comm⁄.h
"

23 
	#NTHREADS
 3

	)

25 * 
	$w‹kî
(*
d©a
)

27 
d©um
 = ()
d©a
;

28 
	`¥ötf
("W‹kîÅhªad #%ldÑu¬ög ...\n", 
d©um
);

29 
	`¥ötf
("#%ld: w‹k d⁄e,ÉxôögÇow\n", 
d©um
);

30 
	`±hªad_exô
(
NULL
);

31 
	}
}

33 
	$maö
()

35 
i
;

36 
ªt
;

37 
±hªad_t
 
tid
;

39 
i
 = 0; i < 
NTHREADS
; i++) {

40 
ªt
 = 
	`±hªad_¸óã
(&
tid
, 
NULL
, 
w‹kî
, (*)
i
);

41 i‡(
ªt
)

42 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

45 
	`±hªad_exô
(
NULL
);

47 
	`exô
(
EXIT_SUCCESS
);

49 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/pthreads3.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<±hªad.h
>

22 
	~"../comm⁄.h
"

24 
	#NTHREADS
 3

	)

26 * 
	$w‹kî
(*
d©a
)

28 
d©um
 = ()
d©a
;

29 
	`¥ötf
("W‹kîÅhªad #%ldÑu¬ög ...\n", 
d©um
);

30 
	`¶ìp
(30);

31 
	`¥ötf
("#%ld: w‹k d⁄e,ÉxôögÇow\n", 
d©um
);

32 
	`±hªad_exô
(
NULL
);

33 
	}
}

35 
	$maö
()

37 
i
;

38 
ªt
;

39 
±hªad_t
 
tid
;

41 
i
 = 0; i < 
NTHREADS
; i++) {

42 
ªt
 = 
	`±hªad_¸óã
(&
tid
, 
NULL
, 
w‹kî
, (*)
i
);

43 i‡(
ªt
)

44 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

47 
	`±hªad_exô
(
NULL
);

49 
	`exô
(
EXIT_SUCCESS
);

51 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/pthreads_joiner1.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<±hªad.h
>

22 
	~"../comm⁄.h
"

24 
	#NTHREADS
 3

	)

26 * 
	$w‹kî
(*
d©a
)

28 
d©um
 = ()
d©a
;

29 
¶±m
=8;

31 
	`¥ötf
(" w‹kî #%ld: wû»¶ì∞f‹ %d†now ...\n", 
d©um
, 
¶±m
);

32 
	`¶ìp
(
¶±m
);

33 
	`¥ötf
(" w‹kî #%ld: w‹k (eyîﬁlËd⁄e,ÉxôögÇow\n", 
d©um
);

37 
	`±hªad_exô
((*)0);

38 
	}
}

40 
	$maö
()

42 
i
;

43 
ªt
, 
°©
=0;

44 
±hªad_t
 
tid
[
NTHREADS
];

45 
±hªad_©å_t
 
©å
;

48 
	`±hªad_©å_öô
(&
©å
);

50 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

53 
i
 = 0; i < 
NTHREADS
; i++) {

54 
	`¥ötf
("maö: cª©ögÅhªad #%ld ...\n", 
i
);

55 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)i);

56 i‡(
ªt
)

57 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

59 
	`±hªad_©å_de°roy
(&
©å
);

62 
i
 = 0; i < 
NTHREADS
; i++) {

63 
	`¥ötf
("maö: joöög (waôögËup⁄Åhªad #%ld ...\n", 
i
);

64 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

65 i‡(
ªt
)

66 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

68 
	`¥ötf
("Thread #%ld successfully joined; itÅerminated with "

69 "°©us=%d\n", 
i
, 
°©
);

72 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

73 
	`±hªad_exô
(
NULL
);

74 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/pthreads_joiner2.c

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<uni°d.h
>

23 
	~<±hªad.h
>

24 
	~"../comm⁄.h
"

26 
	#NTHREADS
 3

	)

28 * 
	$w‹kî
(*
d©a
)

30 
d©um
 = ()
d©a
;

31 
¶±m
=8;

33 
	`¥ötf
(" w‹kî #%ld: wû»¶ì∞f‹ %ld†now ...\n", 
d©um
, (
¶±m
-datum));

34 
	`¶ìp
(
¶±m
-
d©um
);

35 
	`¥ötf
(" w‹kî #%ld: w‹k (eyîﬁlËd⁄e,ÉxôögÇow\n", 
d©um
);

39 
	`±hªad_exô
((*)0);

40 
	}
}

42 
	$maö
()

44 
i
;

45 
ªt
, 
°©
=0;

46 
±hªad_t
 
tid
[
NTHREADS
];

47 
±hªad_©å_t
 
©å
;

50 
	`±hªad_©å_öô
(&
©å
);

52 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

55 
i
 = 0; i < 
NTHREADS
; i++) {

56 
	`¥ötf
("maö: cª©ögÅhªad #%ld ...\n", 
i
);

57 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)i);

58 i‡(
ªt
)

59 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

61 
	`±hªad_©å_de°roy
(&
©å
);

64 
i
 = 0; i < 
NTHREADS
; i++) {

65 
	`¥ötf
("maö: joöög (waôögËup⁄Åhªad #%ld ...\n", 
i
);

66 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

67 i‡(
ªt
)

68 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

70 
	`¥ötf
("Thread #%ld successfully joined; itÅerminated with "

71 "°©us=%d\n", 
i
, 
°©
);

74 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

75 
	`±hªad_exô
(
NULL
);

76 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/speed_multiprcs_vs_multithrd_simple/create_destroy/fork_test.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<sys/waô.h
>

21 
	~"../../../comm⁄.h
"

23 
	#NFORKS
 60000

	)

25 
	$do_nŸhög
()

27 
f
 = 0xb00da;

28 
	}
}

30 
	$maö
()

32 
pid
, 
j
, 
°©us
;

34 
j
 = 0; j < 
NFORKS
; j++) {

35 
pid
 = 
	`f‹k
()) {

37 
	`FATAL
("f‹k faûed! [%d]\n", 
pid
);

39 
	`do_nŸhög
();

40 
	`exô
(
EXIT_SUCCESS
);

42 
	`waôpid
(
pid
, &
°©us
, 0);

45 
	`exô
(
EXIT_SUCCESS
);

46 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/speed_multiprcs_vs_multithrd_simple/create_destroy/pthread_test.c

18 
	~<±hªad.h
>

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~"../../../comm⁄.h
"

24 
	#NTHREADS
 60000

	)

26 *
	$do_nŸhög
(*
d©a
)

28 
t
 = 0xb00da;

29 
	`±hªad_exô
(
NULL
);

30 
	}
}

32 
	$maö
()

34 
ªt
, 
i
;

35 
±hªad_t
 
tid
;

36 
±hªad_©å_t
 
©å
;

38 
	`±hªad_©å_öô
(&
©å
);

39 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

41 
i
 = 0; i < 
NTHREADS
; i++) {

42 
ªt
 = 
	`±hªad_¸óã
(&
tid
, &
©å
, 
do_nŸhög
, 
NULL
);

43 i‡(
ªt
)

44 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

47 
ªt
 = 
	`±hªad_joö
(
tid
, 
NULL
);

48 i‡(
ªt
)

49 
	`FATAL
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

52 
	`±hªad_©å_de°roy
(&
©å
);

53 
	`±hªad_exô
(
NULL
);

54 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/speed_multiprcs_vs_multithrd_simple/matrixmul/prcs_matrixmul.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~"../../../comm⁄.h
"

22 
	#N
 1024

23 
a
[
N
][N], 
b
[N][N], 
c
[N][N];

	)

25 
	$maö
()

27 
i
, 
j
, 
k
;

30 
i
 = 0; i < 
N
; i++) {

31 
j
 = 0; j < 
N
; j++) {

32 
a
[
i
][
j
] = 2;

33 
b
[
i
][
j
] = 3;

38 
i
 = 0; i < 
N
; i++)

39 
j
 = 0; j < 
N
; j++)

40 
k
 = 0; k < 
N
; k++)

41 
c
[
i
][
j
] = c[i][j] + 
a
[i][
k
] * 
b
[k][j];

44 
	`¥ötf
("TheÑesultant matrix is:\n");

45 
i
 = 0; i < 
N
; i++) {

46 
	`¥ötf
(" [row %3d] ", 
i
+1);

47 
j
 = 0; j < 
N
; j++)

48 
	`¥ötf
("%d ", 
c
[
i
][
j
]);

49 
	`¥ötf
(" [row %3d]\n", 
i
+1);

52 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/speed_multiprcs_vs_multithrd_simple/matrixmul/thrd_matrixmul.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<±hªad.h
>

21 
	~"../../../comm⁄.h
"

23 
	#N
 1024

24 
a
[
N
][N], 
b
[N][N], 
c
[N][N];

	)

26 
	#NCORES
 4

27 
a
[
N
][N], 
b
[N][N], 
c
[N][N];

	)

32 *
	$thªadfun
(*
d©a_¨g
)

34 *
p
 = (*)
d©a_¨g
;

35 
i
, 
j
, 
k
;

37 
i
 = *
p
; i < (*∞+ (
N
 / 
NCORES
)); i++)

38 
j
 = 0; j < 
N
; j++)

39 
k
 = 0; k < 
N
; k++)

40 
c
[
i
][
j
] = c[i][j] + 
a
[i][
k
] * 
b
[k][j];

42 
	`±hªad_exô
((*)0);

43 
	}
}

45 
	$maö
()

47 
i
, 
j
, 
row
[
NCORES
];

48 
±hªad_t
 
tid
[
NCORES
];

51 
i
 = 0; i < 
N
; i++) {

52 
j
 = 0; j < 
N
; j++) {

53 
a
[
i
][
j
] = 2;

54 
b
[
i
][
j
] = 3;

61 
i
 = 0; i < 
NCORES
; i++) {

62 
row
[
i
] = i * (
N
 / 
NCORES
);

63 
	`±hªad_¸óã
(&
tid
[
i
], 
NULL
, 
thªadfun
, &
row
[i]);

67 
i
 = 0; i < 
NCORES
; i++)

68 
	`±hªad_joö
(
tid
[
i
], 
NULL
);

71 
	`¥ötf
("TheÑesultant matrix is:\n");

72 
i
 = 0; i < 
N
; i++) {

73 
	`¥ötf
(" [row %3d] ", 
i
+1);

74 
j
 = 0; j < 
N
; j++)

75 
	`¥ötf
("%d ", 
c
[
i
][
j
]);

76 
	`¥ötf
(" [row %3d]\n", 
i
+1);

79 
	`±hªad_exô
((*)0);

80 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch14/stack_test.c

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<±hªad.h
>

26 
	~<limôs.h
>

27 
	~<time.h
>

28 
	~"../comm⁄.h
"

30 
	#NTHREADS
 3

	)

31 
	#TSTACK
 (1024*1024Ë

	)

33 
	$dummy
(
day
)

35 
	`¥ötf
("%s():Ö¨amëî vÆ = %ld\n", 
__func__
, 
day
);

36 
	}
}

38 
	$d™gî
()

40 
	#NEL
 500

	)

41 
hóvyloˇl
[
NEL
][NEL], 
Æpha
=0;

42 
i
, 
j
;

43 
k
=0;

45 
	`§™dom
(
	`time
(0));

47 
	`¥ötf
("\¿*** I¿%s(): hîe, sizeo‡l⁄g i†%ld\n", 
__func__
, ());

59 
i
=0; i<
NEL
; i++) {

60 
k
 = 
	`øndom
() % 1000;

61 
j
=0; j<
NEL
-1; j++)

62 
hóvyloˇl
[
i
][
j
] = 
k
;

66 
i
=0; i<
NEL
; i++)

67 
j
=0; j<
NEL
; j++)

68 
Æpha
 +
hóvyloˇl
[
i
][
j
];

69 
	`dummy
(
Æpha
);

70 
	}
}

72 * 
	$w‹kî
(*
d©a
)

74 
d©um
 = ()
d©a
;

76 
	`¥ötf
(" w‹kî #%ld:\n", 
d©um
);

77 i‡(
d©um
 != 1)

78 
	`±hªad_exô
((*)1);

80 
	`d™gî
();

84 
	`±hªad_exô
((*)0);

85 
	}
}

87 
	$maö
(
¨gc
, **
¨gv
)

89 
i
;

90 
ªt
, 
°©
=0;

91 
±hªad_t
 
tid
[
NTHREADS
];

92 
±hªad_©å_t
 
©å
;

93 
size_t
 
°acksz
=0, 
°ackgu¨dsz
=0;

94 
°ack_£t
=0;

96 i‡(
¨gc
 != 2) {

97 
	`Ârötf
(
°dîr
, "Ußge: %†size-of-thªad-°ack-ö-KB\n", 
¨gv
[0]);

98 
	`exô
(
EXIT_FAILURE
);

100 
°ack_£t
 = 
	`©oi
(
¨gv
[1]) * 1024;

101 i‡(
°ack_£t
 <0 || sèck_£à> 
INT_MAX
) {

102 
	`Ârötf
(
°dîr
, "%s: invalid stack size (%u)Örovided, defaultingÅo %d bytes\n",

103 
¨gv
[0], 
°ack_£t
, 
TSTACK
);

104 
°ack_£t
 = 
TSTACK
;

108 
	`±hªad_©å_öô
(&
©å
);

110 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

113 
ªt
 = 
	`±hªad_©å_gë°acksize
(&
©å
, &
°acksz
);

114 i‡(
ªt
)

115 
	`FATAL
("±hªad_©å_gë°ack(ËÁûed! [%d]\n", 
ªt
);

116 
	`¥ötf
("DeÁu…Åhªad sèck sizê : %10zu byãs\n", 
°acksz
);

119 
ªt
 = 
	`±hªad_©å_£t°acksize
(&
©å
, 
°ack_£t
);

120 i‡(
ªt
)

121 
	`FATAL
("±hªad_©å_£t°ack(%uËÁûed! [%d]\n", 
TSTACK
, 
ªt
);

122 
	`¥ötf
("Thªad sèck sizênow sëÅÿ : %10u byãs\n", 
°ack_£t
);

125 
ªt
 = 
	`±hªad_©å_gëgu¨dsize
(&
©å
, &
°ackgu¨dsz
);

126 i‡(
ªt
)

127 
	`FATAL
("±hªad_©å_gë°ackgu¨d(ËÁûed! [%d]\n", 
ªt
);

128 
	`¥ötf
("DeÁu…Åhªad sèck gu¨d sizê: %10zu byãs\n\n", 
°ackgu¨dsz
);

131 
i
 = 0; i < 
NTHREADS
; i++) {

132 
	`¥ötf
("maö: cª©ögÅhªad #%ld ...\n", 
i
);

133 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)i);

134 i‡(
ªt
)

135 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

137 
	`±hªad_©å_de°roy
(&
©å
);

140 
i
 = 0; i < 
NTHREADS
; i++) {

141 
	`¥ötf
("maö: joöög (waôögËup⁄Åhªad #%ld ...\n", 
i
);

142 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

143 i‡(
ªt
)

144 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

146 
	`¥ötf
("Thread #%ld successfully joined; itÅerminated with "

147 "°©us=%d\n", 
i
, 
°©
);

150 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

151 
	`±hªad_exô
(
NULL
);

152 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch15/cv_simple.c

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<±hªad.h
>

23 
	~"../comm⁄.h
"

25 
	#NTHREADS
 2

	)

27 
	ggW‹kD⁄e
=0;

29 
±hªad_c⁄d_t
 
	gmycv
;

30 
±hªad_muãx_t
 
	gmycv_muãx
 = 
PTHREAD_MUTEX_INITIALIZER
;

35 * 
	$w‹kîB
(*
msg
)

37 
ªt
=0;

39 
	`¥ötf
(" [thread B] :ÖerformÅhe 'work'Çow (first sleep(1) :-)) ...\n");

40 
	`¶ìp
(1);

41 
	`DELAY_LOOP
('b', 72);

43 
	`¥ötf
("\n [thread B] : work done, signalÅhread AÅo continue ...\n");

48 
	`LOCK_MTX
(&
mycv_muãx
);

49 
gW‹kD⁄e
 = 1;

50 
ªt
 = 
	`±hªad_c⁄d_sig«l
(&
mycv
);

51 i‡(
ªt
)

52 
	`FATAL
("±hªad_c⁄d_sig«l(ËöÅhªad B faûed! [%d]\n", 
ªt
);

53 
	`UNLOCK_MTX
(&
mycv_muãx
);

54 
	`±hªad_exô
((*)0);

55 
	}
}

61 * 
	$w‹kîA
(*
msg
)

63 
ªt
=0;

65 
	`LOCK_MTX
(&
mycv_muãx
);

67 
	`¥ötf
(" [thread A] :Çow waiting onÅhe CV forÅhread BÅo finish...\n");

68 
ªt
 = 
	`±hªad_c⁄d_waô
(&
mycv
, &
mycv_muãx
);

70 i‡(
ªt
)

71 
	`FATAL
("±hªad_c⁄d_waô(ËöÅhªad A faûed! [%d]\n", 
ªt
);

74 
	`¥ötf
(" [thread A] :ÑecheckÅheÖredicate (isÅhe workÑeally "

76 i‡(
gW‹kD⁄e
)

78 
	`¥ötf
(" [thread A] : SPURIOUS WAKEUP detected !!! "

81 
	`UNLOCK_MTX
(&
mycv_muãx
);

82 
	`¥ötf
(" [thread A] : (cv wait done)Åhread B has completed it's work...\n");

83 
	`±hªad_exô
((*)0);

84 
	}
}

86 
	$maö
()

88 
i
;

89 
ªt
, 
°©
=0;

90 
±hªad_t
 
tid
[
NTHREADS
];

91 
±hªad_©å_t
 
©å
;

92 
±hªad_c⁄d©å_t
 
cv©å
;

95 
	`±hªad_©å_öô
(&
©å
);

96 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

99 i‡((
ªt
 = 
	`±hªad_c⁄d©å_öô
(&
cv©å
)))

100 
	`FATAL
("±hªad_c⁄d©å_öô faûed [%d].\n", 
ªt
);

102 i‡((
ªt
 = 
	`±hªad_c⁄d_öô
(&
mycv
, &
cv©å
)))

103 
	`FATAL
("±hªad_c⁄d_öô faûed [%d].\n", 
ªt
);

107 
ªt
 = 
	`±hªad_¸óã
(&
tid
[0], &
©å
, 
w‹kîA
, (*)0);

108 i‡(
ªt
)

109 
	`FATAL
("±hªad_¸óã(Ëthªad A faûed! [%d]\n", 
ªt
);

110 
ªt
 = 
	`±hªad_¸óã
(&
tid
[1], &
©å
, 
w‹kîB
, (*)0);

111 i‡(
ªt
)

112 
	`FATAL
("±hªad_¸óã(Ëthªad B faûed! [%d]\n", 
ªt
);

113 
	`±hªad_©å_de°roy
(&
©å
);

116 
i
 = 0; i < 
NTHREADS
; i++) {

117 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

118 i‡(
ªt
)

119 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

123 
	`±hªad_c⁄d©å_de°roy
(&
cv©å
);

124 
	`±hªad_muãx_de°roy
(&
mycv_muãx
);

125 
	`±hªad_c⁄d_de°roy
(&
mycv
);

127 
	`exô
(
EXIT_SUCCESS
);

128 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch15/facto.c

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<±hªad.h
>

26 
	~"../comm⁄.h
"

28 
	#NTHREADS
 2

	)

30 
	ggLockög
=1, 
	ggVîbo£
=0;

31 
	ggFa˘‹ül
=1;

32 
±hªad_muãx_t
 
	gmylock
;

40 
	$Á˘‹ize
(
num
)

42 
i
;

44 
gFa˘‹ül
 = 1;

45 i‡(
num
 <= 0)

48 
i
=1; i<=
num
; i++) {

49 
gFa˘‹ül
 *
i
;

50 
	`VPRINT
(" i=%2d fa˘=%20Œd\n", 
i
, 
gFa˘‹ül
);

52 
	}
}

59 * 
	$w‹kî
(*
d©a
)

61 
d©um
 = ()
d©a
 + 1;

62 
N
=0, 
ªt
=0;

64 
d©um
) {

65 1 : 
N
 = 10;

67 2 : 
N
 = 12;

69 : 
	`WARN
("d©um = %ld ! [shouldÇevî occur]!\n", 
d©um
);

72 i‡(
gLockög
) {

73 i‡((
ªt
 = 
	`±hªad_muãx_lock
(&
mylock
)))

74 
	`FATAL
("±hªad_muãx_lock faûed! [%d]\n", 
ªt
);

78 
	`Á˘‹ize
(
N
);

79 
	`¥ötf
("[Thread #%ld] (factorial) %d ! = %20lld\n",

80 
d©um
, 
N
, 
gFa˘‹ül
);

83 i‡(
gLockög
) {

84 i‡((
ªt
 = 
	`±hªad_muãx_u∆ock
(&
mylock
)))

85 
	`FATAL
("±hªad_muãx_u∆ock faûed! [%d]\n", 
ªt
);

90 
	`±hªad_exô
((*)0);

91 
	}
}

93 
ölöe
 
	$ußge
(*
«me
)

95 
	`Ârötf
(
°dîr
, "Usage: %sÜock-or-not [verbose=[0]|1]\n"

100 
«me
);

101 
	}
}

103 
	$maö
(
¨gc
, **
¨gv
)

105 
i
;

106 
ªt
, 
°©
=0;

107 
±hªad_t
 
tid
[
NTHREADS
];

108 
±hªad_©å_t
 
©å
;

110 i‡(
¨gc
 < 2) {

111 
	`ußge
(
¨gv
[0]);

112 
	`exô
(
EXIT_FAILURE
);

114 i‡(
	`©oi
(
¨gv
[1]) == 0)

115 
gLockög
 = 0;

116 i‡(
	`©oi
(
¨gv
[1]) == 1)

117 
gLockög
 = 1;

119 
	`ußge
(
¨gv
[0]);

120 
	`exô
(
EXIT_FAILURE
);

122 i‡(
¨gc
 == 3)

123 
gVîbo£
 = 
	`©oi
(
¨gv
[2]);

126 
	`±hªad_©å_öô
(&
©å
);

128 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

130 
	`¥ötf
( "Locking mode : %s\n"

132 (
gLockög
 == 1?"ON":"OFF"),

133 (
gVîbo£
 == 1?"ON":"OFF"));

134 i‡(
gLockög
) {

135 i‡((
ªt
 = 
	`±hªad_muãx_öô
(&
mylock
, 
NULL
)))

136 
	`FATAL
("±hªad_muãx_öô(ËÁûed! [%d]\n", 
ªt
);

140 
i
 = 0; i < 
NTHREADS
; i++) {

141 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)i);

142 i‡(
ªt
)

143 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

145 
	`±hªad_©å_de°roy
(&
©å
);

148 
i
 = 0; i < 
NTHREADS
; i++) {

149 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

150 i‡(
ªt
)

151 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

156 i‡(
gLockög
) {

157 i‡((
ªt
 = 
	`±hªad_muãx_de°roy
(&
mylock
)))

158 
	`FATAL
("±hªad_muãx_de°roy(ËÁûed! [%d]\n", 
ªt
);

161 
	`±hªad_exô
(
NULL
);

162 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch15/mutex1.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<±hªad.h
>

21 
	~"../comm⁄.h
"

23 
	#NTHREADS
 3

	)

24 
	#MYCONST
 3

	)

26 
	glockög
=1;

27 
	gg1
=10, 
	gg2
=12, 
	gg3
=14;

28 
±hªad_muãx_t
 
	gmylock
;

30 * 
	$w‹kî
(*
d©a
)

32 
d©um
 = ()
d©a
 + 1;

33 
ªt
=0;

35 i‡(
lockög
) {

36 i‡((
ªt
 = 
	`±hªad_muãx_lock
(&
mylock
)))

37 
	`FATAL
("±hªad_muãx_lock faûed! [%d]\n", 
ªt
);

41 
g1
 ++; 
g2
 ++; 
g3
 ++;

42 
	`¥ötf
("[Thªad #%ld] %2ld %2ld %2ld\n", 
d©um
, 
g1
, 
g2
, 
g3
);

45 i‡(
lockög
) {

46 i‡((
ªt
 = 
	`±hªad_muãx_u∆ock
(&
mylock
)))

47 
	`FATAL
("±hªad_muãx_u∆ock faûed! [%d]\n", 
ªt
);

52 
	`±hªad_exô
((*)0);

53 
	}
}

55 
ölöe
 
	$ußge
(*
«me
)

57 
	`Ârötf
(
°dîr
, "Usage: %sÜock-or-not\n"

59 " 1 : dÿlock (c‹ª˘)\n", 
«me
);

60 
	}
}

62 
	$maö
(
¨gc
, **
¨gv
)

64 
i
;

65 
ªt
, 
°©
=0;

66 
±hªad_t
 
tid
[
NTHREADS
];

67 
±hªad_©å_t
 
©å
;

69 i‡(
¨gc
 != 2) {

70 
	`ußge
(
¨gv
[0]);

71 
	`exô
(
EXIT_FAILURE
);

73 i‡(
	`©oi
(
¨gv
[1]) == 0)

74 
lockög
 = 0;

75 i‡(
	`©oi
(
¨gv
[1]) == 1)

76 
lockög
 = 1;

78 
	`ußge
(
¨gv
[0]);

79 
	`exô
(
EXIT_FAILURE
);

83 
	`±hªad_©å_öô
(&
©å
);

85 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

87 i‡(
lockög
) {

88 i‡((
ªt
 = 
	`±hªad_muãx_öô
(&
mylock
, 
NULL
)))

89 
	`FATAL
("±hªad_muãx_öô(ËÁûed! [%d]\n", 
ªt
);

92 
	`¥ötf
("At start: g1 g2 g3\n"

93 " %2ld %2ld %2ld\n", 
g1
, 
g2
, 
g3
);

96 
i
 = 0; i < 
NTHREADS
; i++) {

97 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)i);

98 i‡(
ªt
)

99 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

101 
	`±hªad_©å_de°roy
(&
©å
);

104 
i
 = 0; i < 
NTHREADS
; i++) {

105 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

106 i‡(
ªt
)

107 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

112 i‡(
lockög
) {

113 i‡((
ªt
 = 
	`±hªad_muãx_de°roy
(&
mylock
)))

114 
	`FATAL
("±hªad_muãx_de°roy(ËÁûed! [%d]\n", 
ªt
);

117 
	`±hªad_exô
(
NULL
);

118 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch15/pshared_mutex_demo.c

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<uni°d.h
>

28 
	~<±hªad.h
>

29 
	~<sys/ùc.h
>

30 
	~<sys/shm.h
>

31 
	~<î∫o.h
>

32 
	~<°rög.h
>

33 
	~<˘y≥.h
>

34 
	~<sys/ty≥s.h
>

35 
	~<sys/waô.h
>

36 
	~"../comm⁄.h
"

38 
	#NTHREADS
 1

	)

39 
	#NUM_PSMUTEX
 1

	)

40 
	#GBUFSIZE
 128

	)

42 
±hªad_⁄˚_t
 *
	gmuãx_öô_⁄˚
;

49 
±hªad_muãx©å_t
 
	gmtx_©å
;

50 
±hªad_muãx_t
 *
	gshmtx
;

52 
	ggshm_id
, 
	ggshmbuf_id
;

53 * 
	ggshmbuf
;

55 
ölöe
 
	$¥öt_löe
(c⁄° *
buf
, 
°¨t
, 
numbyãs
)

57 
j
;

59 
	`¥ötf
 ("%08d ", 
°¨t
);

60 
j
=
°¨t
; j<°¨t+
numbyãs
; j++) {

61 
	`¥ötf
 ("%02x ", ()
buf
[
j
]);

65 
	`¥ötf
 (" ");

66 
j
=
°¨t
; j<°¨t+
numbyãs
; j++) {

67 i‡(
	`i•röt
 (()
buf
[
j
]))

68 
	`¥ötf
 ("%c", ()
buf
[
j
]);

70 
	`¥ötf
 (".");

72 
	`¥ötf
 ("\n");

73 
	}
}

75 
	$showbuf
(c⁄° *
buf
)

77 
i
;

79 
i
=0; i < 
GBUFSIZE
/16; i++)

80 
	`¥öt_löe
(
buf
, 
i
*16, 16);

81 
	}
}

83 * 
	$w‹kî
(*
d©a
)

85 
d©um
 = ()
d©a
;

86 
	`¥ötf
("W‹kîÅhªad #%ld [%d]Ñu¬ög ...\n", 
d©um
, 
	`gëpid
());

87 
	`¶ìp
(1);

88 
	`¥ötf
(" [thrd %ld]:áâem±ögÅÿèkêthêsh¨ed muãxÜock...\n", 
d©um
);

90 
	`LOCK_MTX
(
shmtx
);

92 
	`¥ötf
(" [thrd %ld]: gŸÅhê(sh¨edËlock!\n", 
d©um
);

95 
	`mem£t
(&
gshmbuf
[0]+25, 't', 5);

96 
	`¢¥ötf
(&
gshmbuf
[0]+31, 32, "thªad %d hîe!\n", 
	`gëpid
());

98 
	`UNLOCK_MTX
(
shmtx
);

100 
	`¥ötf
("#%ld: w‹k d⁄e,ÉxôögÇow\n", 
d©um
);

101 
	`±hªad_exô
(
NULL
);

102 
	}
}

110 * 
	$shmem_£tup
(*
shmid
, *
«me
, 
key_t
 
key
, 
size
)

112 *
shmaddr
;

114 *
shmid
 = 
	`shmgë
(
IPC_PRIVATE
, 
size
, (
IPC_CREAT
|
IPC_EXCL
|0600));

115 i‡(*
shmid
 < 0 ) {

117 *
shmid
 = 
	`shmgë
(
key
, 0, 0);

118 i‡(*
shmid
 < 0 )

119 
	`FATAL
("shmget failed\n");

121 
	`¥ötf
 ("%s:%d: shmem segment successfully created /áccessed. ID=%d\n",

122 
«me
, 
	`gëpid
(), *
shmid
);

125 
shmaddr
 = 
	`shm©
(*
shmid
, 0, 0);

126 if(
shmaddr
 == (*)-1)

127 
	`FATAL
("shmat failed\n");

128 
	`¥ötf
 ("%s:%d: Attached successfullyÅo shmem segmentát %p\n",

129 
«me
, 
	`gëpid
(), (*)
shmaddr
);

131  
shmaddr
;

132 
	}
}

137 
	$öô_muãx
()

139 
ªt
=0;

141 
	`¥ötf
("[pthread_once(): calls %s(): from PID %d]\n",

142 
__func__
, 
	`gëpid
());

143 
ªt
 = 
	`±hªad_muãx©å_öô
(&
mtx_©å
);

144 i‡(
ªt
)

145 
	`FATAL
("±hªad_muãx©å_öô faûed [%d]\n", 
ªt
);

147 
ªt
 = 
	`±hªad_muãx©å_£çsh¨ed
(&
mtx_©å
, 
PTHREAD_PROCESS_SHARED
);

148 i‡(
ªt
)

149 
	`FATAL
("±hªad_muãx©å_£çsh¨ed faûed [%d]\n", 
ªt
);

154 
ªt
 = 
	`±hªad_muãx_öô
(
shmtx
, &
mtx_©å
);

155 i‡(
ªt
)

156 
	`FATAL
("±hªad_muãx_öô faûed [%d]\n", 
ªt
);

157 
	}
}

159 
	$maö
(
¨gc
, **
¨gv
)

161 
i
;

162 
ªt
, 
°©
=0;

163 *
shmaddr
;

164 
±hªad_t
 
tid
[
NTHREADS
];

165 
±hªad_©å_t
 
©å
;

166 
pid_t
 
˝id
=0;

176 
shmaddr
 = 
	`shmem_£tup
(&
gshm_id
, 
¨gv
[0], 0,

177 (
NUM_PSMUTEX
*(
±hªad_muãx_t
Ë+ 32 + (
±hªad_⁄˚_t
)));

178 i‡(!
shmaddr
)

179 
	`FATAL
("shmem setup 1 failed\n");

184 
shmtx
 = (
±hªad_muãx_t
 *)
shmaddr
;

185 
muãx_öô_⁄˚
 = (
±hªad_⁄˚_t
 *)
shmaddr
 + (
NUM_PSMUTEX
*(
±hªad_muãx_t
)) + 32;

186 *
muãx_öô_⁄˚
 = 
PTHREAD_ONCE_INIT
;

189 
gshmbuf
 = 
	`shmem_£tup
(&
gshmbuf_id
, 
¨gv
[0], 0, 
GBUFSIZE
);

190 i‡(!
gshmbuf
)

191 
	`FATAL
("shmem setup 2 failed\n");

192 
	`mem£t
(
gshmbuf
, 0, 
GBUFSIZE
);

207 
ªt
 = 
	`±hªad_⁄˚
(
muãx_öô_⁄˚
, 
öô_muãx
);

208 i‡(
ªt
)

209 
	`FATAL
("±hªad_⁄˚ faûed [%d]\n", 
ªt
);

211 
ªt
 = 
	`±hªad_©å_öô
(&
©å
);

212 i‡(
ªt
)

213 
	`FATAL
("±hªad_©å_öô faûed [%d]\n", 
ªt
);

216 
i
 = 0; i < 
NTHREADS
; i++) {

217 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)i);

218 i‡(
ªt
)

219 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

221 
	`±hªad_©å_de°roy
(&
©å
);

225 
˝id
 = 
	`f‹k
()) {

226 -1 : 
	`FATAL
("fork failed!\n");

228 
ªt
 = 
	`±hªad_⁄˚
(
muãx_öô_⁄˚
, 
öô_muãx
);

229 i‡(
ªt
)

230 
	`FATAL
("±hªad_⁄˚ faûed [%d]\n", 
ªt
);

231 
	`¶ìp
(1);

232 
	`¥ötf
(" Child[%d]:áttemptingÅoÅakingÅhe shared mutexÜock...\n",

233 
	`gëpid
());

234 
	`LOCK_MTX
(
shmtx
);

236 
	`¥ötf
(" Chûd[%d]: gŸÅhê(sh¨edËlock!\n", 
	`gëpid
());

239 
	`mem£t
(&
gshmbuf
[0], 'c', 5);

240 
	`¢¥ötf
(&
gshmbuf
[0]+6, 32, "chûd %d hîe!\n", 
	`gëpid
());

242 
	`UNLOCK_MTX
(
shmtx
);

243 
	`exô
(
EXIT_SUCCESS
);

245 i‡(
	`waô
(0) < 0)

247 
	`WARN
("wait failed\n");

251 
i
 = 0; i < 
NTHREADS
; i++) {

252 
	`¥ötf
("maö: joöög (waôögËup⁄Åhªad #%ld ...\n", 
i
);

253 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

254 i‡(
ªt
)

255 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

257 
	`¥ötf
("Thread #%ld successfully joined; itÅerminated with "

258 "°©us=%d\n", 
i
, 
°©
);

261 
	`¥ötf
("\nShared Memory 'comm' buffer:\n");

262 
	`showbuf
(
gshmbuf
);

265 i‡(
	`shmdt
(
shmaddr
) < 0)

266 
	`WARN
("Shmem segment detach 1 failed\n");

267 i‡(
	`shm˘l
(
gshm_id
, 
IPC_RMID
, 0) < 0)

268 
	`FATAL
("Deletion of shmem segment 1 failed\n");

270 i‡(
	`shmdt
(
gshmbuf
) < 0)

271 
	`WARN
("Shmem segment detach 2 failed\n");

272 i‡(
	`shm˘l
(
gshmbuf_id
, 
IPC_RMID
, 0) < 0)

273 
	`FATAL
("Deletion of shmem segment 2 failed\n");

275 
	`±hªad_exô
(
NULL
);

276 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch16/cancelit.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<±hªad.h
>

21 
	~"../comm⁄.h
"

23 
	#NTHREADS
 2

	)

25 *
	$w‹kî
(*
d©a
)

27 
d©um
 = ()
d©a
;

28 
¶±m
 = 8, 
ªt
 = 0;

30 i‡(
d©um
 == 0) {

33 
	`¥ötf
(" worker #%ld: disabling Cancellation:"

34 " wû»'w‹k'Çow...\n", 
d©um
);

35 i‡((
ªt
 =

36 
	`±hªad_£tˇn˚l°©e
(
PTHREAD_CANCEL_DISABLE
, 
NULL
)))

37 
	`FATAL
("±hªad_£tˇn˚l°©êÁûed 0 [%d]\n", 
ªt
);

38 
	`DELAY_LOOP
(
d©um
 + 48, 100);

39 
	`¥ötf
("\¿w‹kî #%ld:É«blög C™˚Œ©i⁄\n", 
d©um
);

40 i‡((
ªt
 = 
	`±hªad_£tˇn˚l°©e
(
PTHREAD_CANCEL_ENABLE
, 
NULL
)))

41 
	`FATAL
("±hªad_£tˇn˚l°©êÁûed 1 [%d]\n", 
ªt
);

44 
	`¥ötf
(" w‹kî #%ld: wû»¶ì∞f‹ %d†now ...\n", 
d©um
, 
¶±m
);

45 
	`¶ìp
(
¶±m
);

46 
	`¥ötf
(" w‹kî #%ld: w‹k (eyîﬁlËd⁄e,ÉxôögÇow\n", 
d©um
);

50 
	`±hªad_exô
((*)0);

51 
	}
}

53 
	$maö
()

55 
i
, 
°©
 = 0;

56 
ªt
;

57 
±hªad_t
 
tid
[
NTHREADS
];

58 
±hªad_©å_t
 
©å
;

61 
	`±hªad_©å_öô
(&
©å
);

63 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

66 
i
 = 0; i < 
NTHREADS
; i++) {

67 
	`¥ötf
("maö: cª©ögÅhªad #%ld ...\n", 
i
);

68 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)i);

69 i‡(
ªt
)

70 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

72 
	`±hªad_©å_de°roy
(&
©å
);

75 
ªt
 = 
	`±hªad_ˇn˚l
(
tid
[0]);

76 i‡(
ªt
)

77 
	`FATAL
("±hªad_ˇn˚l—hªad 0ËÁûed! [%d]\n", 
ªt
);

80 
i
 = 0; i < 
NTHREADS
; i++) {

81 
	`¥ötf
("maö: joöög (waôögËup⁄Åhªad #%ld ...\n", 
i
);

82 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

83 i‡(
ªt
)

84 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

86 
¥ötf


88 "°©us=%ld\n", 
i
, 
°©
);

89 i‡((*)
°©
 =
PTHREAD_CANCELED
)

90 
	`¥ötf
(" *** Was CANCELLED ***\n");

94 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

95 
	`±hªad_exô
(
NULL
);

96 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch16/cleanup_hdlr.c

23 
	#_GNU_SOURCE


	)

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<sig«l.h
>

27 
	~<°rög.h
>

28 
	~<uni°d.h
>

29 
	~<î∫o.h
>

30 
	~<sys/ty≥s.h
>

31 
	~<sys/°©.h
>

32 
	~<f˙é.h
>

33 
	~<as£π.h
>

34 
	~<±hªad.h
>

35 
	~"../comm⁄.h
"

37 
	#NREAD
 512

	)

38 
	#NTHREADS
 2

	)

40 
	ggVîbo£
 = 1;

42 
	$ã°ô_mt_ªÁ˘‹ed
(
FILE
 * 
wr°rm
, FILE * 
rd°rm
, 
numio
,

43 
thrdnum
, *
iobuf
)

45 
i
, 
sysˇŒs
 = 
NREAD
 * 
numio
 / 
	`gë∑gesize
();

46 
size_t
 
‚r
 = 0;

48 i‡(
sysˇŒs
 <= 0)

49 
sysˇŒs
 = 1;

50 
VPRINT


52 " iobu‡%p\n", 
thrdnum
, 
numio
, 
NREAD
 *Çumio, 
sysˇŒs
, 
iobuf
);

54 
i
 = 0; i < 
numio
; i++) {

55 
‚r
 = 
	`‰ód
(
iobuf
, 1, 
NREAD
, 
rd°rm
);

56 i‡(!
‚r
)

57 
	`FATAL
("fread on /dev/urandom failed\n");

59 i‡(!
	`fwrôe
(
iobuf
, 1, 
‚r
, 
wr°rm
)) {

60 i‡(
	`„of
(
wr°rm
))

62 i‡(
	`„º‹
(
wr°rm
)) {

63 
	`‰ì
(
iobuf
);

64 
	`FATAL
("fwrite on our file failed\n");

68 
	}
}

70 
	s°ToThªad
 {

71 
FILE
 *
	mwr°rm
, *
	mrd°rm
;

72 
	mthrdnum
, 
	mnumio
;

73 *
	miobuf
;

75 
°ToThªad
 *
	gToThªad
[
NTHREADS
];

77 
	$˛ónup_h™dÀr
(*
¨g
)

79 
	`¥ötf
("+++ I¿%†+++\n" " fªe-ög buf„∏%p\n", 
__func__
, 
¨g
);

80 
	`‰ì
(
¨g
);

81 
	}
}

83 *
	$wøµî_ã°ô_mt_ªÁ˘‹ed
(*
msg
)

85 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

86 
	`as£π
(
p°ToThªad
);

90 
p°ToThªad
->
iobuf
 = 
	`mÆloc
(
NREAD
);

91 i‡(!
p°ToThªad
->
iobuf
)

92 
	`FATAL
("thread #%d: malloc(%d) failed!\n",

93 
p°ToThªad
->
thrdnum
, 
NREAD
);

96 
	`±hªad_˛ónup_push
(
˛ónup_h™dÀr
, 
p°ToThªad
->
iobuf
);

98 
	`ã°ô_mt_ªÁ˘‹ed
(
p°ToThªad
->
wr°rm
,Ö°ToThªad->
rd°rm
,

99 
p°ToThªad
->
numio
,Ö°ToThªad->
thrdnum
,

100 
p°ToThªad
->
iobuf
);

107 
	`±hªad_˛ónup_p›
(0);

108 
	`‰ì
(
p°ToThªad
->
iobuf
);

111 
	`±hªad_exô
((*)0);

112 
	}
}

114 
	$maö
(
¨gc
, **
¨gv
)

116 *
‚ame
 = "/tmp/iobuf_tmp";

117 
FILE
 *
wÂ
 = 
NULL
, *
rÂ
 = NULL;

118 
numio
;

119 
i
, 
ªt
;

120 
±hªad_t
 
tid
[
NTHREADS
];

121 
±hªad_©å_t
 
©å
;

122 *
°©
=0;

124 i‡(
¨gc
 != 3) {

125 
	`Ârötf
(
°dîr
,

128 " 0 othîwi£).\n", 
¨gv
[0]);

129 
	`exô
(
EXIT_FAILURE
);

131 
numio
 = 
	`©oi
(
¨gv
[1]);

132 i‡(
numio
 <= 0) {

133 
	`Ârötf
(
°dîr
,

136 " 0 othîwi£).\n", 
¨gv
[0]);

137 
	`exô
(
EXIT_FAILURE
);

140 
¥ötf


142 
¨gv
[0], 
	`gë∑gesize
(), 
numio
);

144 
	`u∆ök
(
‚ame
);

145 
wÂ
 = 
	`f›í
(
‚ame
, "a");

146 i‡(!
wÂ
)

147 
	`FATAL
("f›í o¿%†Áûed\n", 
‚ame
);

149 
rÂ
 = 
	`f›í
("/dev/urandom", "r");

150 i‡(!
rÂ
)

151 
	`FATAL
("fopen on /dev/urandom failed\n");

154 
	`±hªad_©å_öô
(&
©å
);

155 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

158 
i
 = 0; i < 
NTHREADS
; i++) {

159 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

160 i‡(!
ToThªad
[
i
])

161 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

163 
ToThªad
[
i
]->
thrdnum
 = i;

164 
ToThªad
[
i
]->
wr°rm
 = 
wÂ
;

165 
ToThªad
[
i
]->
rd°rm
 = 
rÂ
;

166 
ToThªad
[
i
]->
numio
 =Çumio;

167 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

168 
wøµî_ã°ô_mt_ªÁ˘‹ed
,

169 (*)
ToThªad
[
i
]);

170 i‡(
ªt
)

171 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

173 
	`±hªad_©å_de°roy
(&
©å
);

175 i‡(
	`©oi
(
¨gv
[2]) == 1) {

177 
	`¥ötf
("%s: sending CANCEL REQUESTÅo workerÅhread 0 ...\n",

178 
__func__
);

179 
ªt
 = 
	`±hªad_ˇn˚l
(
tid
[0]);

180 i‡(
ªt
)

181 
	`FATAL
("±hªad_ˇn˚l—hªad 0ËÁûed! [%d]\n", 
ªt
);

185 
i
 = 0; i < 
NTHREADS
; i++) {

186 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

187 i‡(
ªt
)

188 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

190 
	`¥ötf
(" Thread #%d successfully joined; it "

191 "ãrmö©ed wôh sètus=%ld\n", 
i
, ()
°©
);

192 i‡(
°©
 =
PTHREAD_CANCELED
)

193 
	`¥ötf
(" : was CANCELED\n");

195 
	`‰ì
(
ToThªad
[
i
]);

198 
	`f˛o£
(
rÂ
);

199 
	`f˛o£
(
wÂ
);

201 
	`±hªad_exô
(
NULL
);

202 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch16/mt_iobuf_mtx.c

21 
	#_GNU_SOURCE


	)

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<sig«l.h
>

25 
	~<°rög.h
>

26 
	~<uni°d.h
>

27 
	~<î∫o.h
>

28 
	~<sys/ty≥s.h
>

29 
	~<sys/°©.h
>

30 
	~<f˙é.h
>

31 
	~<as£π.h
>

32 
	~<±hªad.h
>

33 
	~"../comm⁄.h
"

35 
	#NREAD
 512

	)

36 
	#NTHREADS
 2

	)

38 
±hªad_muãx_t
 
	gmylock
 = 
PTHREAD_MUTEX_INITIALIZER
;

39 
	ggVîbo£
 = 1;

40 *
	ggbuf
 = 
NULL
;

42 
	$ã°ô_mt_mtx
(
FILE
 * 
wr°rm
, FILE * 
rd°rm
, 
numio
, 
thrdnum
)

44 
i
, 
sysˇŒs
 = 
NREAD
 * 
numio
 / 
	`gë∑gesize
();

45 
size_t
 
‚r
 = 0;

47 i‡(
sysˇŒs
 <= 0)

48 
sysˇŒs
 = 1;

49 
VPRINT


51 
thrdnum
, 
numio
, 
NREAD
 *Çumio, 
sysˇŒs
);

55 
	`VPRINT
(" gbu‡%p\n", 
gbuf
);

57 
i
 = 0; i < 
numio
; i++) {

58 
	`LOCK_MTX
(&
mylock
);

59 
‚r
 = 
	`‰ód
(
gbuf
, 1, 
NREAD
, 
rd°rm
);

60 
	`UNLOCK_MTX
(&
mylock
);

61 i‡(!
‚r
)

62 
	`FATAL
("fread on /dev/urandom failed\n");

64 
	`LOCK_MTX
(&
mylock
);

65 i‡(!
	`fwrôe
(
gbuf
, 1, 
‚r
, 
wr°rm
)) {

66 
	`‰ì
(
gbuf
);

67 
	`UNLOCK_MTX
(&
mylock
);

68 i‡(
	`„of
(
wr°rm
))

70 i‡(
	`„º‹
(
wr°rm
))

71 
	`FATAL
("fwrite on our file failed\n");

73 
	`UNLOCK_MTX
(&
mylock
);

75 
	}
}

77 
	s°ToThªad
 {

78 
FILE
 *
	mwr°rm
, *
	mrd°rm
;

79 
	mthrdnum
, 
	mnumio
;

81 
°ToThªad
 *
	gToThªad
[
NTHREADS
];

83 *
	$wøµî_ã°ô_mt_mtx
(*
msg
)

85 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

86 
	`as£π
(
p°ToThªad
);

87 
	`ã°ô_mt_mtx
(
p°ToThªad
->
wr°rm
,Ö°ToThªad->
rd°rm
,

88 
p°ToThªad
->
numio
,Ö°ToThªad->
thrdnum
);

89 
	`±hªad_exô
((*)0);

90 
	}
}

92 
	$maö
(
¨gc
, **
¨gv
)

94 *
‚ame
 = "/tmp/iobuf_tmp";

95 
FILE
 *
wÂ
 = 
NULL
, *
rÂ
 = NULL;

96 
numio
;

97 
i
, 
ªt
, 
°©
 = 0;

98 
±hªad_t
 
tid
[
NTHREADS
];

99 
±hªad_©å_t
 
©å
;

101 i‡(
¨gc
 != 2) {

102 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-times-to-rdwr\n", 
¨gv
[0]);

103 
	`exô
(
EXIT_FAILURE
);

105 
numio
 = 
	`©oi
(
¨gv
[1]);

106 i‡(
numio
 <= 0) {

107 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-times-to-rdwr\n", 
¨gv
[0]);

108 
	`exô
(
EXIT_FAILURE
);

111 
¥ötf


113 
¨gv
[0], 
	`gë∑gesize
(), 
numio
);

115 
gbuf
 = 
	`mÆloc
(
NREAD
);

116 i‡(!
gbuf
)

117 
	`FATAL
("mÆlo¯%zu faûed!\n", 
NREAD
);

119 
	`u∆ök
(
‚ame
);

120 
wÂ
 = 
	`f›í
(
‚ame
, "a");

121 i‡(!
wÂ
)

122 
	`FATAL
("f›í o¿%†Áûed\n", 
‚ame
);

124 
rÂ
 = 
	`f›í
("/dev/urandom", "r");

125 i‡(!
rÂ
)

126 
	`FATAL
("fopen on /dev/urandom failed\n");

129 
	`±hªad_©å_öô
(&
©å
);

130 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

133 
i
 = 0; i < 
NTHREADS
; i++) {

134 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

135 i‡(!
ToThªad
[
i
])

136 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

138 
ToThªad
[
i
]->
thrdnum
 = i;

139 
ToThªad
[
i
]->
wr°rm
 = 
wÂ
;

140 
ToThªad
[
i
]->
rd°rm
 = 
rÂ
;

141 
ToThªad
[
i
]->
numio
 =Çumio;

142 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

143 
wøµî_ã°ô_mt_mtx
,

144 (*)
ToThªad
[
i
]);

145 i‡(
ªt
)

146 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

148 
	`±hªad_©å_de°roy
(&
©å
);

151 
i
 = 0; i < 
NTHREADS
; i++) {

152 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

153 i‡(
ªt
)

154 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

156 
	`¥ötf
(" Thread #%d successfully joined; it "

157 "ãrmö©ed wôh sètus=%d\n", 
i
, 
°©
);

158 
	`‰ì
(
ToThªad
[
i
]);

160 i‡((
ªt
 = 
	`±hªad_muãx_de°roy
(&
mylock
)))

161 
	`FATAL
("±hªad_muãx_de°roy(ËÁûed! [%d]\n", 
ªt
);

163 
	`f˛o£
(
rÂ
);

164 
	`f˛o£
(
wÂ
);

165 
	`‰ì
(
gbuf
);

167 
	`±hªad_exô
(
NULL
);

168 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch16/mt_iobuf_rfct.c

22 
	#_GNU_SOURCE


	)

23 
	~<°dio.h
>

24 
	~<°dlib.h
>

25 
	~<sig«l.h
>

26 
	~<°rög.h
>

27 
	~<uni°d.h
>

28 
	~<î∫o.h
>

29 
	~<sys/ty≥s.h
>

30 
	~<sys/°©.h
>

31 
	~<f˙é.h
>

32 
	~<as£π.h
>

33 
	~<±hªad.h
>

34 
	~"../comm⁄.h
"

36 
	#NREAD
 512

	)

37 
	#NTHREADS
 2

	)

39 
	ggVîbo£
 = 1;

41 
	$ã°ô_mt_ªÁ˘‹ed
(
FILE
 * 
wr°rm
, FILE * 
rd°rm
, 
numio
,

42 
thrdnum
, *
iobuf
)

44 
i
, 
sysˇŒs
 = 
NREAD
 * 
numio
 / 
	`gë∑gesize
();

45 
size_t
 
‚r
 = 0;

47 i‡(
sysˇŒs
 <= 0)

48 
sysˇŒs
 = 1;

49 
VPRINT


51 " iobu‡%p\n", 
thrdnum
, 
numio
, 
NREAD
 *Çumio, 
sysˇŒs
, 
iobuf
);

53 
i
 = 0; i < 
numio
; i++) {

54 
‚r
 = 
	`‰ód
(
iobuf
, 1, 
NREAD
, 
rd°rm
);

55 i‡(!
‚r
)

56 
	`FATAL
("fread on /dev/urandom failed\n");

58 i‡(!
	`fwrôe
(
iobuf
, 1, 
‚r
, 
wr°rm
)) {

59 i‡(
	`„of
(
wr°rm
))

61 i‡(
	`„º‹
(
wr°rm
)) {

62 
	`‰ì
(
iobuf
);

63 
	`FATAL
("fwrite on our file failed\n");

67 
	}
}

69 
	s°ToThªad
 {

70 
FILE
 *
	mwr°rm
, *
	mrd°rm
;

71 
	mthrdnum
, 
	mnumio
;

72 *
	miobuf
;

74 
°ToThªad
 *
	gToThªad
[
NTHREADS
];

76 *
	$wøµî_ã°ô_mt_ªÁ˘‹ed
(*
msg
)

78 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

79 
	`as£π
(
p°ToThªad
);

83 
p°ToThªad
->
iobuf
 = 
	`mÆloc
(
NREAD
);

84 i‡(!
p°ToThªad
->
iobuf
)

85 
	`FATAL
("thread #%d: malloc(%d) failed!\n",

86 
p°ToThªad
->
thrdnum
, 
NREAD
);

88 
	`ã°ô_mt_ªÁ˘‹ed
(
p°ToThªad
->
wr°rm
,Ö°ToThªad->
rd°rm
,

89 
p°ToThªad
->
numio
,Ö°ToThªad->
thrdnum
,

90 
p°ToThªad
->
iobuf
);

92 
	`‰ì
(
p°ToThªad
->
iobuf
);

93 
	`±hªad_exô
((*)0);

94 
	}
}

96 
	$maö
(
¨gc
, **
¨gv
)

98 *
‚ame
 = "/tmp/iobuf_tmp";

99 
FILE
 *
wÂ
 = 
NULL
, *
rÂ
 = NULL;

100 
numio
;

101 
i
, 
ªt
, 
°©
 = 0;

102 
±hªad_t
 
tid
[
NTHREADS
];

103 
±hªad_©å_t
 
©å
;

105 i‡(
¨gc
 != 2) {

106 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-times-to-rdwr\n", 
¨gv
[0]);

107 
	`exô
(
EXIT_FAILURE
);

109 
numio
 = 
	`©oi
(
¨gv
[1]);

110 i‡(
numio
 <= 0) {

111 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-times-to-rdwr\n", 
¨gv
[0]);

112 
	`exô
(
EXIT_FAILURE
);

115 
¥ötf


117 
¨gv
[0], 
	`gë∑gesize
(), 
numio
);

119 
	`u∆ök
(
‚ame
);

120 
wÂ
 = 
	`f›í
(
‚ame
, "a");

121 i‡(!
wÂ
)

122 
	`FATAL
("f›í o¿%†Áûed\n", 
‚ame
);

124 
rÂ
 = 
	`f›í
("/dev/urandom", "r");

125 i‡(!
rÂ
)

126 
	`FATAL
("fopen on /dev/urandom failed\n");

129 
	`±hªad_©å_öô
(&
©å
);

130 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

133 
i
 = 0; i < 
NTHREADS
; i++) {

134 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

135 i‡(!
ToThªad
[
i
])

136 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

138 
ToThªad
[
i
]->
thrdnum
 = i;

139 
ToThªad
[
i
]->
wr°rm
 = 
wÂ
;

140 
ToThªad
[
i
]->
rd°rm
 = 
rÂ
;

141 
ToThªad
[
i
]->
numio
 =Çumio;

142 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

143 
wøµî_ã°ô_mt_ªÁ˘‹ed
,

144 (*)
ToThªad
[
i
]);

145 i‡(
ªt
)

146 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

148 
	`±hªad_©å_de°roy
(&
©å
);

151 
i
 = 0; i < 
NTHREADS
; i++) {

152 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

153 i‡(
ªt
)

154 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

156 
	`¥ötf
(" Thread #%d successfully joined; it "

157 "ãrmö©ed wôh sètus=%d\n", 
i
, 
°©
);

158 
	`‰ì
(
ToThªad
[
i
]);

161 
	`f˛o£
(
rÂ
);

162 
	`f˛o£
(
wÂ
);

164 
	`±hªad_exô
(
NULL
);

165 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch16/mt_iobuf_tls.c

20 
	#_GNU_SOURCE


	)

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<sig«l.h
>

24 
	~<°rög.h
>

25 
	~<uni°d.h
>

26 
	~<î∫o.h
>

27 
	~<sys/ty≥s.h
>

28 
	~<sys/°©.h
>

29 
	~<f˙é.h
>

30 
	~<as£π.h
>

31 
	~<±hªad.h
>

32 
	~"../comm⁄.h
"

34 
	#NREAD
 512

	)

35 
	#NTHREADS
 2

	)

37 
	ggVîbo£
 = 1;

38 
__thªad
 
	giobuf
[
NREAD
];

40 
	$ã°ô_mt_és
(
FILE
 * 
wr°rm
, FILE * 
rd°rm
, 
numio
, 
thrdnum
)

42 
i
, 
sysˇŒs
 = 
NREAD
 * 
numio
 / 
	`gë∑gesize
();

43 
size_t
 
‚r
 = 0;

45 i‡(
sysˇŒs
 <= 0)

46 
sysˇŒs
 = 1;

47 
VPRINT


49 " iobu‡%p\n", 
thrdnum
, 
numio
, 
NREAD
 *Çumio, 
sysˇŒs
, 
iobuf
);

51 
i
 = 0; i < 
numio
; i++) {

52 
‚r
 = 
	`‰ód
(
iobuf
, 1, 
NREAD
, 
rd°rm
);

53 i‡(!
‚r
)

54 
	`FATAL
("fread on /dev/urandom failed\n");

56 i‡(!
	`fwrôe
(
iobuf
, 1, 
‚r
, 
wr°rm
)) {

57 i‡(
	`„of
(
wr°rm
))

59 i‡(
	`„º‹
(
wr°rm
))

60 
	`FATAL
("fwrite on our file failed\n");

63 
	}
}

65 
	s°ToThªad
 {

66 
FILE
 *
	mwr°rm
, *
	mrd°rm
;

67 
	mthrdnum
, 
	mnumio
;

69 
°ToThªad
 *
	gToThªad
[
NTHREADS
];

71 *
	$wøµî_ã°ô_mt_és
(*
msg
)

73 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

74 
	`as£π
(
p°ToThªad
);

75 
	`ã°ô_mt_és
(
p°ToThªad
->
wr°rm
,Ö°ToThªad->
rd°rm
,

76 
p°ToThªad
->
numio
,Ö°ToThªad->
thrdnum
);

77 
	`±hªad_exô
((*)0);

78 
	}
}

80 
	$maö
(
¨gc
, **
¨gv
)

82 *
‚ame
 = "/tmp/iobuf_tmp";

83 
FILE
 *
wÂ
 = 
NULL
, *
rÂ
 = NULL;

84 
numio
;

85 
i
, 
ªt
, 
°©
 = 0;

86 
±hªad_t
 
tid
[
NTHREADS
];

87 
±hªad_©å_t
 
©å
;

89 i‡(
¨gc
 != 2) {

90 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-times-to-rdwr\n", 
¨gv
[0]);

91 
	`exô
(
EXIT_FAILURE
);

93 
numio
 = 
	`©oi
(
¨gv
[1]);

94 i‡(
numio
 <= 0) {

95 
	`Ârötf
(
°dîr
, "Ußge: %†numbî-of-times-to-rdwr\n", 
¨gv
[0]);

96 
	`exô
(
EXIT_FAILURE
);

99 
¥ötf


101 
¨gv
[0], 
	`gë∑gesize
(), 
numio
);

104 
gbuf
 = 
	`mÆloc
(
NREAD
);

105 i‡(!
gbuf
)

106 
	`FATAL
("mÆlo¯%zu faûed!\n", 
NREAD
);

108 
	`u∆ök
(
‚ame
);

109 
wÂ
 = 
	`f›í
(
‚ame
, "a");

110 i‡(!
wÂ
)

111 
	`FATAL
("f›í o¿%†Áûed\n", 
‚ame
);

113 
rÂ
 = 
	`f›í
("/dev/urandom", "r");

114 i‡(!
rÂ
)

115 
	`FATAL
("fopen on /dev/urandom failed\n");

118 
	`±hªad_©å_öô
(&
©å
);

119 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

122 
i
 = 0; i < 
NTHREADS
; i++) {

123 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

124 i‡(!
ToThªad
[
i
])

125 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

127 
ToThªad
[
i
]->
thrdnum
 = i;

128 
ToThªad
[
i
]->
wr°rm
 = 
wÂ
;

129 
ToThªad
[
i
]->
rd°rm
 = 
rÂ
;

130 
ToThªad
[
i
]->
numio
 =Çumio;

131 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

132 
wøµî_ã°ô_mt_és
,

133 (*)
ToThªad
[
i
]);

134 i‡(
ªt
)

135 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

137 
	`±hªad_©å_de°roy
(&
©å
);

140 
i
 = 0; i < 
NTHREADS
; i++) {

141 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

142 i‡(
ªt
)

143 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

145 
	`¥ötf
(" Thread #%d successfully joined; it "

146 "ãrmö©ed wôh sètus=%d\n", 
i
, 
°©
);

147 
	`‰ì
(
ToThªad
[
i
]);

150 
	`f˛o£
(
rÂ
);

151 
	`f˛o£
(
wÂ
);

154 
	`±hªad_exô
(
NULL
);

155 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch16/pthreads_app_template.c

18 
	~<°dio.h
>

19 
	~<uni°d.h
>

20 
	~<°dlib.h
>

21 
	~<°rög.h
>

22 
	~<as£π.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<±hªad.h
>

25 
	~"../comm⁄.h
"

27 
	#NTHREADS
 3

	)

29 
	s°ToThªad
 {

30 
	mthrdnum
;

31 
	m°¨t_num
, 
	míd_num
;

32 *
	miobuf
;

34 
°ToThªad
 *
	gToThªad
[
NTHREADS
];

37 
	$˛ónup_h™dÀr
(*
¨g
)

39 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
¨g
;

40 
	`as£π
(
p°ToThªad
);

42 
	`¥ötf
("+++ I¿%s():thrd #%d +++\n", 
__func__
, 
p°ToThªad
->
thrdnum
);

44 
	}
}

46 *
	$w‹kî
(*
msg
)

48 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

49 
	`as£π
(
p°ToThªad
);

56 
	`±hªad_˛ónup_push
(
˛ónup_h™dÀr
, 
p°ToThªad
);

66 
	`±hªad_˛ónup_p›
(0);

67 
	`±hªad_exô
((*)0);

68 
	}
}

71 
	$maö
(
¨gc
, **
¨gv
)

73 
i
, 
ªt
;

74 
±hªad_t
 
tid
[
NTHREADS
];

75 
±hªad_©å_t
 
©å
;

76 *
°©
=0;

79 
	`±hªad_©å_öô
(&
©å
);

80 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

83 
i
 = 0; i < 
NTHREADS
; i++) {

84 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

85 i‡(!
ToThªad
[
i
])

86 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

88 
ToThªad
[
i
]->
thrdnum
 = i;

89 
ToThªad
[
i
]->
°¨t_num
 = 1;

90 
ToThªad
[
i
]->
íd_num
 = 50;

91 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

92 
w‹kî
, (*)
ToThªad
[
i
]);

93 i‡(
ªt
)

94 
	`FATAL
("[%d]Öthªad_¸óã(ËÁûed! [%d]\n", 
i
, 
ªt
);

95 
	`¥ötf
("Thªad #%d suc˚ssfuŒy cª©ed\n", 
i
);

97 
	`±hªad_©å_de°roy
(&
©å
);

101 i‡(
¨gc
 >2 && 
	`©oi
(
¨gv
[1]) == 1) {

103 
	`¥ötf
("%s: sending CANCEL REQUESTÅo workerÅhread 0 ...\n",

104 
__func__
);

105 
ªt
 = 
	`±hªad_ˇn˚l
(
tid
[0]);

106 i‡(
ªt
)

107 
	`FATAL
("±hªad_ˇn˚l—hªad 0ËÁûed! [%d]\n", 
ªt
);

112 
i
 = 0; i < 
NTHREADS
; i++) {

113 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

114 i‡(
ªt
)

115 
	`WARN
("[%d]Öthªad_joö(ËÁûed! [%d]\n", 
i
, 
ªt
);

117 
	`¥ötf
(" Thread #%d successfully joined; it "

118 "ãrmö©ed wôh sètus=%ld\n", 
i
, ()
°©
);

119 i‡(
°©
 =
PTHREAD_CANCELED
)

120 
	`¥ötf
(" : was CANCELED\n");

122 
	`‰ì
(
ToThªad
[
i
]);

125 
	`±hªad_exô
(
NULL
);

126 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch16/tsig.c

23 
	~<°dio.h
>

24 
	~<°dlib.h
>

25 
	~<uni°d.h
>

26 
	~<±hªad.h
>

27 
	~<sig«l.h
>

28 
	~"../comm⁄.h
"

30 
	#NTHREADS
 2

	)

36 *
	$sig«l_h™dÀr
(*
¨g
)

38 
sig£t_t
 
sig£t
;

39 
sig
;

41 
	`¥ötf
("Dedicated signal_handler()Åhreadálive..\n");

44 i‡(
	`sigfûl£t
(&
sig£t
) == -1)

45 
	`FATAL
("sigfillset failed");

46 i‡(
	`sigwaô
(&
sig£t
, &
sig
) < 0)

47 
	`FATAL
("sigwait failed");

64 
sig
) {

65 
SIGINT
:

67 
	`¥ötf
("+++ signal_handler(): caught signal #%d +++\n",

68 
sig
);

70 
SIGQUIT
:

72 
	`¥ötf
("+++ signal_handler(): caught signal #%d +++\n",

73 
sig
);

75 
SIGIO
:

77 
	`¥ötf
("+++ signal_handler(): caught signal #%d +++\n",

78 
sig
);

82 
¥ötf


84 
sig
);

89 
	}
}

91 *
	$w‹k
(*
id
)

93 
this
 = ()
id
;

94 
	`¥ötf
(" [Thªad #%ld] PID %dÑu¬ög ...\n", 
this
, 
	`gëpid
());

95 i‡(
this
 == 1) {

96 
	`DELAY_LOOP
('1', 200);

97 } i‡(
this
 == 2) {

98 
	`DELAY_LOOP
('2', 200);

100 
	`¥ötf
("\n---------------------------------------\n");

101 
	`±hªad_exô
((*)0);

102 
	}
}

104 
	$maö
()

106 
sig£t_t
 
sig£t
;

107 
±hªad_t
 
±hrd
[
NTHREADS
 + 1];

108 
±hªad_©å_t
 
©å
;

109 
t
 = 0, 
°©
;

110 
ªt
 = 0;

116 
	`sigfûl£t
(&
sig£t
);

117 i‡(
	`±hªad_sigmask
(
SIG_BLOCK
, &
sig£t
, 
NULL
))

118 
	`FATAL
("main:Öthread_sigmask failed");

120 
	`±hªad_©å_öô
(&
©å
);

121 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_DETACHED
);

124 
ªt
 = 
	`±hªad_¸óã
(&
±hrd
[
t
], &
©å
, 
sig«l_h™dÀr
, 
NULL
);

125 i‡(
ªt
)

126 
	`FATAL
("±hªad_¸óã %ld faûed [%d]\n", 
t
, 
ªt
);

129 
t
 = 1;Å < 
NTHREADS
 + 1;Å++) {

130 
ªt
 = 
	`±hªad_¸óã
(&
±hrd
[
t
], &
©å
, 
w‹k
, (*)t);

131 i‡(
ªt
)

132 
	`FATAL
("±hªad_¸óã %ld faûed [%d]\n", 
t
, 
ªt
);

137 ()
	`∑u£
();

142 
t
 = 0;Å < 
NTHREADS
;Å++) {

143 
	`¥ötf
("maö: joöög (waôögËup⁄Åhªad #%ld ...\n", 
t
);

144 
ªt
 = 
	`±hªad_joö
(
±hrd
[
t
], (**)&
°©
);

145 i‡(
ªt
)

146 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

148 
¥ötf


150 "°©us=%ld\n", 
t
, 
°©
);

151 i‡((*)
°©
 =
PTHREAD_CANCELED
)

152 
	`¥ötf
(" *** Was CANCELLED ***\n");

156 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

157 
	`±hªad_exô
(
NULL
);

158 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch17/sched_rt_eg.c

42 
	~<°dio.h
>

43 
	~<uni°d.h
>

44 
	~<±hªad.h
>

45 
	~<°dlib.h
>

46 
	~<sig«l.h
>

47 
	~"../comm⁄.h
"

49 
	#NTHREADS
 2

	)

50 
	#NUMWORK
 200

	)

56 *
	$w‹kî1
(*
msg
)

58 
sched_∑øm
 
p
;

65 
	`¥ötf
(" RT ThreadÖ1 (%s():%d:LWP %d):\n"

67 
__func__
, 
__LINE__
, 
	`gëpid
(), ()
msg
);

71 
p
.
sched_¥i‹ôy
 = ()
msg
;

72 i‡(
	`±hªad_£tsched∑øm
(
	`±hªad_£lf
(), 
SCHED_RR
, &
p
))

73 
	`WARN
("pthread_setschedparam failed\n");

75 
	`¶ìp
(2);

77 
	`puts
("Ö1 working");

78 
	`DELAY_LOOP
('1', 
NUMWORK
);

80 
	`puts
("Ö1:Éxiting..");

81 
	`±hªad_exô
((*)0);

82 
	}
}

88 *
	$w‹kî2
(*
msg
)

90 
sched_∑øm
 
p
;

96 
¥io
 = ()
msg
;

98 
	`¥ötf
(" RT ThreadÖ2 (%s():%d:LWP %d):\n"

100 
__func__
, 
__LINE__
, 
	`gëpid
(), ()
msg
+10);

104 
p
.
sched_¥i‹ôy
 = 
¥io
 + 10;

105 i‡(
	`±hªad_£tsched∑øm
(
	`±hªad_£lf
(), 
SCHED_FIFO
, &
p
))

106 
	`WARN
("pthread_setschedparam failed\n");

107 
	`¶ìp
(4);

109 
	`puts
("Ö2 working");

110 
	`DELAY_LOOP
('2', 
NUMWORK
);

112 
	`puts
("Ö2Éxiting ...");

113 
	`±hªad_exô
((*)0);

114 
	}
}

116 
	$maö
(
¨gc
, **
¨gv
)

118 
±hªad_t
 
tid
[
NTHREADS
];

119 
±hªad_©å_t
 
©å
;

120 
ªt
, 
mö
, 
max
;

121 
π_¥io
 = 1;

123 i‡(
¨gc
 == 1) {

124 
	`Ârötf
(
°dîr
, "Ußge: %†ªÆtime-¥i‹ôy\n", 
¨gv
[0]);

125 
	`exô
(
EXIT_FAILURE
);

128 
mö
 = 
	`sched_gë_¥i‹ôy_mö
(
SCHED_FIFO
);

129 i‡(
mö
 == -1)

130 
	`FATAL
("sched_get_priority_min failure");

131 
max
 = 
	`sched_gë_¥i‹ôy_max
(
SCHED_FIFO
);

132 i‡(
max
 == -1)

133 
	`FATAL
("sched_get_priority_max failure");

134 
	`¥ötf
("SCHED_FIFO:Öri‹ôyÑ™gêi†%dÅÿ%d\n", 
mö
, 
max
);

136 
π_¥io
 = 
	`©oi
(
¨gv
[1]);

137 i‡((
π_¥io
 < 
mö
Ë|| (π_¥iÿ> (
max
 - 10)))

138 
	`FATAL
("%s: Priority valueÖassed (%ld) out ofÑange [%d-%d].\n",

139 
¨gv
[0], 
π_¥io
, 
mö
, (
max
 - 10));

141 i‡(
	`gëeuid
() != 0)

142 
	`¥ötf
("\nNote:Åo createÅrue RTÅhreads, youÇeedÅoÑunÅhis"

146 
	`±hªad_©å_öô
(&
©å
);

147 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_DETACHED
);

149 
	`¥ötf
("main: creating RT workerÅhread #1 ...\n");

150 
ªt
 = 
	`±hªad_¸óã
(&
tid
[0], &
©å
, 
w‹kî1
, (*)
π_¥io
);

151 i‡(
ªt
)

152 
	`FATAL
("±hªad_¸óã(Ë#1 faûed! [%d]\n", 
ªt
);

154 
	`¥ötf
("main: creating RT workerÅhread #2 ...\n");

155 
ªt
 = 
	`±hªad_¸óã
(&
tid
[1], &
©å
, 
w‹kî2
, (*)
π_¥io
);

156 i‡(
ªt
)

157 
	`FATAL
("±hªad_¸óã(Ë#2 faûed! [%d]\n", 
ªt
);

159 
	`±hªad_©å_de°roy
(&
©å
);

161 
	`DELAY_LOOP
('m', 
NUMWORK
+100);

163 
	`¥ötf
("\nmain:áll done,áppÉxiting ...\n");

164 
	`±hªad_exô
((*)0);

165 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch18/diskspc.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<sig«l.h
>

21 
	~<°rög.h
>

22 
	~<uni°d.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/°©.h
>

25 
	~<f˙é.h
>

26 
	~"../comm⁄.h
"

28 
	$maö
(
¨gc
, **
¨gv
)

30 
fd
;

31 
off_t
 
sz
;

33 i‡(
¨gc
 != 3) {

34 
	`Ârötf
(
°dîr
, "Ußge: %†√w-fûe-∑th«mêsize-to-ª£rve-ö-MB\n", 
¨gv
[0]);

35 
	`exô
(
EXIT_FAILURE
);

37 
sz
 = 
	`©ﬁ
(
¨gv
[2])*1024*1024;

38 i‡(
sz
 <= 0)

39 
	`FATAL
("övÆid sizê%†MB\n", 
¨gv
[2]);

41 
	`u∆ök
(
¨gv
[1]);

42 
	`umask
(0);

43 
fd
 = 
	`›í
(
¨gv
[1], 
O_CREAT
|
O_RDWR
, 0644);

44 i‡(
fd
 < 0)

45 
	`FATAL
("›í o¿%†Áûed\n", 
¨gv
[1]);

47 i‡(
	`posix_ÁŒoˇã
(
fd
, 0, 
sz
) != 0)

48 
	`FATAL
("posix_fallocate failed\n");

50 
	`˛o£
(
fd
);

51 
	`exô
(
EXIT_SUCCESS
);

52 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch18/mmap_file_simple.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<°rög.h
>

21 
	~<uni°d.h
>

22 
	~<sys/mm™.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/°©.h
>

25 
	~<f˙é.h
>

26 
	~"../comm⁄.h
"

36 
	$hex_dump
(*
d©a
, 
off£t
, 
size
, *
ˇ±i⁄
, 
vîbo£
)

38 
i
;

39 
j
;

40 
	#MAX_NUMERALS
 20

41 
ãmp
[
MAX_NUMERALS
];

	)

42 
buf„r
[128];

43 *
ascii
;

45 
	`mem£t
(
buf„r
, 0, 128);

47 i‡(
vîbo£
 && 
ˇ±i⁄
)

48 
	`¥ötf
("---------> %†<--------- (%d byã†‰om %p)\n", 
ˇ±i⁄
,

49 
size
, 
d©a
);

52 
¥ötf


57 
ascii
 = 
buf„r
 + 58;

58 
	`mem£t
(
buf„r
, ' ', 58 + 16);

60 
	`¢¥ötf
(
ãmp
, 
MAX_NUMERALS
, "+%06d", 
off£t
);

61 
buf„r
[58 + 16] = '\n';

62 
buf„r
[58 + 17] = '\0';

63 
buf„r
[0] = '+';

66 
buf„r
[1] = 
ãmp
[1];

67 
buf„r
[2] = 
ãmp
[2];

68 
buf„r
[3] = 
ãmp
[3];

69 
buf„r
[4] = 
ãmp
[4];

70 
buf„r
[5] = 
ãmp
[5];

71 
buf„r
[6] = 
ãmp
[6];

73 
i
 = 0, 
j
 = 0; i < 
size
; i++, j++) {

74 i‡(
j
 == 16) {

75 
	`¥ötf
("%s", 
buf„r
);

76 
	`mem£t
(
buf„r
, ' ', 58 + 16);

78 
	`¢¥ötf
(
ãmp
, 
MAX_NUMERALS
, "+%06d", 
i
+
off£t
);

79 
	`mem˝y
(
buf„r
, 
ãmp
, 7);

81 
j
 = 0;

84 
	`¢¥ötf
(
ãmp
, 
MAX_NUMERALS
, "%02x", 0xf‡& 
d©a
[
i
]);

85 
	`mem˝y
(
buf„r
 + 8 + (
j
 * 3), 
ãmp
, 2);

86 i‡((
d©a
[
i
] > 31) && (data[i] < 127))

87 
ascii
[
j
] = 
d©a
[
i
];

89 
ascii
[
j
] = '.';

92 i‡(
j
 != 0)

93 
	`¥ötf
("%s", 
buf„r
);

94 
	}
}

96 
	ggVîbo£
=1;

98 
	$maö
(
¨gc
, **
¨gv
)

100 
fd_‰om
;

101 
off_t
 
fsz
, 
Àn
, 
off
 = 0;

102 
°©
 
s°©
;

103 *
d©a_§c
=0, *
mm≠_ba£
=0;

105 i‡(
¨gc
 < 2 ||árgc > 4 ||árgc == 3) {

106 
	`Ârötf
(
°dîr
, "Usage: %s source-file [start_offsetÜength]\n"

110 
¨gv
[0]);

111 
	`exô
(
EXIT_FAILURE
);

114 
fd_‰om
 = 
	`›í
(
¨gv
[1], 
O_RDONLY
);

115 i‡(
fd_‰om
 < 0)

116 
	`FATAL
("open: src file");

119 i‡(
	`f°©
(
fd_‰om
, &
s°©
) == -1)

120 
	`FATAL
("f°© o¿§¯fûê%†Áûed\n", 
¨gv
[1]);

122 
fsz
 = 
s°©
.
°_size
;

123 i‡(0 =
fsz
)

124 
	`FATAL
("sour˚-fûê%†sizê0 byãs,áb‹tög...\n", 
¨gv
[1]);

126 
Àn
 = 
fsz
;

127 i‡(
¨gc
 == 4) {

128 
Àn
 = 
	`©ﬁ
(
¨gv
[3]);

129 i‡(
Àn
 <= 0)

130 
	`FATAL
("övÆidÜígth %ld,áb‹tög...\n", 
Àn
);

133 i‡(
¨gc
 >= 3) {

134 
off
 = 
	`©ﬁ
(
¨gv
[2]);

135 i‡((
off
 < 0Ë|| ((off+
Àn
Ë> 
fsz
))

136 
	`FATAL
("invalid offset or offset/length combination,áborting...\n");

148 
mm≠_ba£
 = 
d©a_§c
 = 
	`mm≠
(0, 
fsz
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd_‰om
, 0);

149 i‡(
d©a_§c
 =
MAP_FAILED
)

150 
	`FATAL
("mm≠:Åÿ§¯fûê%†Áûed\n", 
¨gv
[1]);

152 i‡(()
mm≠_ba£
 % 
	`gë∑gesize
() != 0)

153 
	`WARN
("mmap:ÇotálignedÅoÖage boundary\n");

154 
	`VPRINT
("fsz=%ld mm≠_ba£ = %p\n", 
fsz
, 
mm≠_ba£
);

157 
	`hex_dump
(
d©a_§c
 + 
off
, off, 
Àn
, "Data", 0);

160 i‡(
	`msync
 (
mm≠_ba£
, 
Àn
, 
MS_SYNC
) < 0)

162 
	`WARN
("mysnc failed\n");

164 i‡(
	`munm≠
(
mm≠_ba£
, 
Àn
) == -1)

165 
	`FATAL
("munmap failed\n");

167 
	`˛o£
(
fd_‰om
);

168 
	`exô
(
EXIT_SUCCESS
);

169 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch18/sgio_simple.c

21 
	#_GNU_SOURCE


	)

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<sig«l.h
>

25 
	~<°rög.h
>

26 
	~<uni°d.h
>

27 
	~<sys/ty≥s.h
>

28 
	~<sys/°©.h
>

29 
	~<f˙é.h
>

30 
	~<sys/uio.h
>

31 
	~"../comm⁄.h
"

43 
	#A_HOLE_LEN
 10

	)

44 
	#A_START_OFF
 
A_HOLE_LEN


	)

45 
	#A_LEN
 20

	)

47 
	#B_HOLE_LEN
 100

	)

48 
	#B_START_OFF
 (
A_HOLE_LEN
+
A_LEN
+
B_HOLE_LEN
)

	)

49 
	#B_LEN
 30

	)

51 
	#C_HOLE_LEN
 20

	)

52 
	#C_START_OFF
 (
A_HOLE_LEN
+
A_LEN
+
B_HOLE_LEN
+
B_LEN
+
C_HOLE_LEN
)

	)

53 
	#C_LEN
 42

	)

55 *
	ggbufA
, *
	ggbufB
, *
	ggbufC
, *
	ggbuf_hﬁe
;

59 
	$£tup_buf„rs
()

62 
gbufA
 = 
	`mÆloc
(
A_LEN
);

63 i‡(!
gbufA
)

64 
	`FATAL
("malloc on gbufA failed\n");

65 
	`mem£t
(
gbufA
, 'A', 
A_LEN
);

68 
gbufB
 = 
	`mÆloc
(
B_LEN
);

69 i‡(!
gbufB
) {

70 
	`‰ì
(
gbufA
);

71 
	`FATAL
("malloc on gbufB failed\n");

73 
	`mem£t
(
gbufB
, 'B', 
B_LEN
);

76 
gbufC
 = 
	`mÆloc
(
C_LEN
);

77 i‡(!
gbufC
) {

78 
	`‰ì
(
gbufB
);

79 
	`‰ì
(
gbufA
);

80 
	`FATAL
("malloc on gbufC failed\n");

82 
	`mem£t
(
gbufB
, 'C', 
C_LEN
);

85 
gbuf_hﬁe
 = 
	`mÆloc
(
A_HOLE_LEN
 + 
B_HOLE_LEN
 + 
C_HOLE_LEN
);

86 i‡(!
gbuf_hﬁe
) {

87 
	`‰ì
(
gbufC
);

88 
	`‰ì
(
gbufB
);

89 
	`‰ì
(
gbufA
);

90 
	`FATAL
("malloc on gbuf_hole failed\n");

92 
	`mem£t
(
gbuf_hﬁe
, 0, 
A_HOLE_LEN
 + 
B_HOLE_LEN
 + 
C_HOLE_LEN
);

93 
	}
}

100 
	$£tup_buf„rs_gŸo
()

102 
ªt
 = -1;

104 
	`¥ötf
("I¿%s()\n", 
__func__
);

112 
gbufA
 = 
	`mÆloc
(
A_LEN
);

113 i‡(!
gbufA
)

114 
out
;

115 
	`mem£t
(
gbufA
, 'A', 
A_LEN
);

118 
ªt
 = -2;

119 
gbufB
 = 
	`mÆloc
(
B_LEN
);

120 i‡(!
gbufB
)

121 
out_‰ìA
;

122 
	`mem£t
(
gbufB
, 'B', 
B_LEN
);

125 
ªt
 = -3;

126 
gbufC
 = 
	`mÆloc
(
C_LEN
);

127 i‡(!
gbufC
)

128 
out_‰ìB
;

129 
	`mem£t
(
gbufC
, 'C', 
C_LEN
);

132 
ªt
 = -4;

133 
gbuf_hﬁe
 = 
	`mÆloc
(
A_HOLE_LEN
 + 
B_HOLE_LEN
 + 
C_HOLE_LEN
);

134 i‡(!
gbuf_hﬁe
)

135 
out_‰ìC
;

136 
	`mem£t
(
gbuf_hﬁe
, 0, 
A_HOLE_LEN
 + 
B_HOLE_LEN
 + 
C_HOLE_LEN
);

139 
out_‰ìC
:

140 
	`‰ì
(
gbufC
);

141 
out_‰ìB
:

142 
	`‰ì
(
gbufB
);

143 
out_‰ìA
:

144 
	`‰ì
(
gbufA
);

145 
out
:

146  
ªt
;

147 
	}
}

150 
	#SEEK_POS
(
m¨k
) \

151 
	`¥ötf
("%s: curr seekÖosition: %ld\n", \

152 
m¨k
, 
	`l£ek
(
fd
, 0, 
SEEK_CUR
));

	)

168 
	$wr_disc⁄tig_the_n‹mÆ_way
(
fd
)

170 
	`¥ötf
("I¿%s()\n", 
__func__
);

173 i‡(
	`l£ek
(
fd
, 
A_START_OFF
, 
SEEK_SET
) < 0)

174 
	`FATAL
("lseek A failed\n");

175 i‡(
	`wrôe
(
fd
, 
gbufA
, 
A_LEN
) < 0)

176 
	`FATAL
("write A failed\n");

179 i‡(
	`l£ek
(
fd
, 
B_START_OFF
, 
SEEK_SET
) < 0)

180 
	`FATAL
("lseek B failed\n");

181 i‡(
	`wrôe
(
fd
, 
gbufB
, 
B_LEN
) < 0)

182 
	`FATAL
("write B failed\n");

185 i‡(
	`l£ek
(
fd
, 
C_START_OFF
, 
SEEK_SET
) < 0)

186 
	`FATAL
("lseek C failed\n");

187 i‡(
	`wrôe
(
fd
, 
gbufC
, 
C_LEN
) < 0)

188 
	`FATAL
("write C failed\n");

191 
	}
}

193 
	$show_iovec
(
iovec
 *
vec
, 
nvec
)

195 
i
;

197 i‡(
nvec
 <0 || !
vec
)

200 
	`¥ötf
("iovec# Baseáddr Length\n");

201 
i
=0; i<
nvec
; i++)

202 
	`¥ötf
("%2d: %16∞ %6ld\n", 
i
, 
vec
[i].
iov_ba£
, vec[i].
iov_Àn
);

203 
	}
}

218 
	$wr_disc⁄tig_the_bëãr_SGIO_way
(
fd
)

220 
iovec
 
iov
[6];

221 
i
=0;

223 
	`¥ötf
("I¿%s()\n", 
__func__
);

229 
iov
[
i
].
iov_ba£
 = 
gbuf_hﬁe
;

230 
iov
[
i
].
iov_Àn
 = 
A_HOLE_LEN
;

231 
i
 ++;

232 
iov
[
i
].
iov_ba£
 = 
gbufA
;

233 
iov
[
i
].
iov_Àn
 = 
A_LEN
;

236 
i
 ++;

237 
iov
[
i
].
iov_ba£
 = 
gbuf_hﬁe
;

238 
iov
[
i
].
iov_Àn
 = 
B_HOLE_LEN
;

239 
i
 ++;

240 
iov
[
i
].
iov_ba£
 = 
gbufB
;

241 
iov
[
i
].
iov_Àn
 = 
B_LEN
;

244 
i
 ++;

245 
iov
[
i
].
iov_ba£
 = 
gbuf_hﬁe
;

246 
iov
[
i
].
iov_Àn
 = 
C_HOLE_LEN
;

247 
i
 ++;

248 
iov
[
i
].
iov_ba£
 = 
gbufC
;

249 
iov
[
i
].
iov_Àn
 = 
C_LEN
;

250 
i
 ++;

253 
	`show_iovec
(
iov
, 
i
);

256 i‡(
	`wrôev
(
fd
, 
iov
, 
i
) < 0)

259 
	}
}

261 c⁄° *
	gã°fûe
 = "tmptest";

263 
	$maö
(
¨gc
, **
¨gv
)

265 
fd
, 
›t
;

267 i‡(
¨gc
 != 2) {

268 
	`Ârötf
(
°dîr
, "Usage: %s use-method-option\n"

271 , 
¨gv
[0]);

272 
	`exô
(
EXIT_FAILURE
);

274 
›t
 = 
	`©oi
(
¨gv
[1]);

275 i‡(
›t
 != 0 && opt != 1) {

276 
	`Ârötf
(
°dîr
, "Usage: %s use-method-option\n"

279 , 
¨gv
[0]);

280 
	`exô
(
EXIT_FAILURE
);

283 #i‡(
USE_LOCAL_GOTO
 == 0)

284 
	`£tup_buf„rs
();

286 i‡(
	`£tup_buf„rs_gŸo
() < 0)

287 
	`FATAL
("Buffer setup failed\n");

290 
	`u∆ök
(
ã°fûe
);

291 
	`umask
(0);

292 
fd
 = 
	`›í
(
ã°fûe
, 
O_CREAT
|
O_RDWR
,

293 
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IWGRP
|
S_IROTH
);

294 i‡(
fd
 < 0)

295 
	`FATAL
("›í o¿%†Áûed\n", 
¨gv
[1]);

297 i‡(
›t
 == 0)

298 
	`wr_disc⁄tig_the_n‹mÆ_way
(
fd
);

300 
	`wr_disc⁄tig_the_bëãr_SGIO_way
(
fd
);

302 
	`˛o£
(
fd
);

303 
	`‰ì
(
gbufC
);

304 
	`‰ì
(
gbufB
);

305 
	`‰ì
(
gbufA
);

307 
	`exô
(
EXIT_SUCCESS
);

308 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch2/mem_app1buggy.c

22 
	#_GNU_SOURCE


	)

23 
	~<°dio.h
>

24 
	~<uni°d.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

27 
	~"../comm⁄.h
"

29 
	$maö
(
¨gc
, **
¨gv
)

31 *
±r
 = 
NULL
;

32 *
de°
, *
§c
 = "abcdef0123456789";

33 *
¨bô_addr
 = (*)0xffffffffff601000;

34 
n
 = 
	`°æí
(
§c
);

36 
±r
 = 
	`mÆloc
(256 * 1024);

37 i‡(!
±r
)

38 
	`FATAL
("malloc(256*1024) failed\n");

40 i‡(
¨gc
 == 1)

41 
de°
 = 
±r
;

43 
de°
 = 
¨bô_addr
;

44 
	`mem˝y
(
de°
, 
§c
, 
n
);

46 
	`‰ì
(
±r
);

47 
	`exô
(0);

48 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch2/stacker.c

24 
	#_GNU_SOURCE


	)

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<uni°d.h
>

28 
	~<sys/ty≥s.h
>

29 
	~"../comm⁄.h
"

31 
	$b¨_is_now_˛o£d
()

33 
loˇlv¨
 = 5;

35 
	`¥ötf
("In function %20s; &localvar = %p\n"

37 
__func__
, &
loˇlv¨
);

38 
	`¥ötf
("\n Now blocking onÖause()...\n"

41 
	`∑u£
();

42 
	}
}

43 
	$b¨
()

45 
loˇlv¨
 = 5;

47 
	`¥ötf
("I¿fun˘i⁄ %20s; &loˇlv¨ = %p\n", 
__func__
, &
loˇlv¨
);

48 
	`b¨_is_now_˛o£d
();

49 
	}
}

50 
	$foo
()

52 
loˇlv¨
 = 5;

54 
	`¥ötf
("I¿fun˘i⁄ %20s; &loˇlv¨ = %p\n", 
__func__
, &
loˇlv¨
);

55 
	`b¨
();

56 
	}
}

58 
	$maö
(
¨gc
, **
¨gv
)

60 
loˇlv¨
 = 5;

62 
	`¥ötf
("I¿fun˘i⁄ %20s; &loˇlv¨ = %p\n", 
__func__
, &
loˇlv¨
);

63 
	`foo
();

64 
	`exô
 (
EXIT_SUCCESS
);

65 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch3/rlimit_primes.c

21 
	#_GNU_SOURCE


	)

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<°rög.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<sys/time.h
>

28 
	~<sys/ªsour˚.h
>

29 
	~"../comm⁄.h
"

31 
	#MAX
 10000000

32 

	)

33 
	$sim∂e_¥imegí
(
limô
)

35 
i
, 
j
, 
num
 = 2, 
i•rime
;

37 
	`¥ötf
(" 2, 3, ");

38 
i
 = 4; i <
limô
; i++) {

39 
i•rime
 = 1;

40 
j
 = 2; j < 
limô
 / 2; j++) {

41 i‡((
i
 !
j
) && (i % j == 0)) {

42 
i•rime
 = 0;

46 i‡(
i•rime
) {

47 
num
++;

48 
	`¥ötf
("%6d, ", 
i
);

54 
	#WRAP
 16

	)

55 i‡(
num
 % 
WRAP
 == 0)

56 
	`¥ötf
("\n");

59 
	`¥ötf
("\n");

60 
	}
}

65 
	$£tup_˝u_æimô
(
˝ulimô
)

67 
æimô
 
æim_√w
, 
æim_ﬁd
;

69 i‡(
˝ulimô
 == -1)

70 
æim_√w
.
æim_cur
 =Ñlim_√w.
æim_max
 = 
RLIM_INFINITY
;

72 
æim_√w
.
æim_cur
 =Ñlim_√w.
æim_max
 = (
æim_t
Ë
˝ulimô
;

74 i‡(
	`¥limô
(0, 
RLIMIT_CPU
, &
æim_√w
, &
æim_ﬁd
) == -1)

75 
	`FATAL
("prlimit:cpu failed\n");

76 
¥ötf


78 
æim_√w
.
æim_cur
,Ñlim_√w.
æim_max
, 
æim_ﬁd
.rlim_cur,

79 
æim_ﬁd
.
æim_max
);

80 
	}
}

82 
	$maö
(
¨gc
, **
¨gv
)

84 
limô
, 
n£c
;

86 i‡(
¨gc
 < 3) {

87 
	`Ârötf
(
°dîr
,

91 
¨gv
[0], 
MAX
);

92 
	`exô
(
EXIT_FAILURE
);

95 
limô
 = 
	`©oi
(
¨gv
[1]);

96 i‡(
limô
 <4 ||Üimô > 
MAX
) {

97 
	`Ârötf
(
°dîr
,

99 "thêøngê[4 - %d].\n", 
¨gv
[0], 
limô
, 
MAX
);

100 
	`exô
(
EXIT_FAILURE
);

102 
n£c
 = 
	`©oi
(
¨gv
[2]);

103 i‡(
n£c
 == 0)

104 
n£c
 = 1;

106 i‡(
n£c
 != -2)

107 
	`£tup_˝u_æimô
(
n£c
);

108 
	`sim∂e_¥imegí
(
limô
);

110 
	`exô
(
EXIT_SUCCESS
);

111 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch3/rlimits_show.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<°rög.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/time.h
>

25 
	~<sys/ªsour˚.h
>

26 
	~"../comm⁄.h
"

29 
	#ARRAY_LEN
(
¨r
Ë((◊º))/(◊º)[0]))

	)

34 
	$quîy_æimôs
()

36 
i
;

37 
æimô
 
æim
;

38 
	sæim∑ú
 {

39 
æim
;

40 *
«me
;

42 
æim∑ú
 
æim∑ú_¨r
[] = {

43 {
RLIMIT_CORE
, "RLIMIT_CORE"},

44 {
RLIMIT_DATA
, "RLIMIT_DATA"},

45 {
RLIMIT_NICE
, "RLIMIT_NICE"},

46 {
RLIMIT_FSIZE
, "RLIMIT_FSIZE"},

47 {
RLIMIT_SIGPENDING
, "RLIMIT_SIGPENDING"},

48 {
RLIMIT_MEMLOCK
, "RLIMIT_MEMLOCK"},

49 {
RLIMIT_NOFILE
, "RLIMIT_NOFILE"},

50 {
RLIMIT_MSGQUEUE
, "RLIMIT_MSGQUEUE"},

51 {
RLIMIT_RTTIME
, "RLIMIT_RTTIME"},

52 {
RLIMIT_STACK
, "RLIMIT_STACK"},

53 {
RLIMIT_CPU
, "RLIMIT_CPU"},

54 {
RLIMIT_NPROC
, "RLIMIT_NPROC"},

55 {
RLIMIT_AS
, "RLIMIT_AS"},

56 {
RLIMIT_LOCKS
, "RLIMIT_LOCKS"},

58 
tmp1
[16], 
tmp2
[16];

60 
	`¥ötf
("RESOURCE LIMIT SOFT HARD\n");

61 
i
 = 0; i < 
	`ARRAY_LEN
(
æim∑ú_¨r
); i++) {

62 i‡(
	`¥limô
(0, 
æim∑ú_¨r
[
i
].
æim
, 0, &rlim) == -1)

63 
	`FATAL
("¥limô[%d] faûed\n", 
i
);

65 
	`¢¥ötf
(
tmp1
, 16, "%ld", 
æim
.
æim_cur
);

66 
	`¢¥ötf
(
tmp2
, 16, "%ld", 
æim
.
æim_max
);

67 
	`¥ötf
("%-18s: %16s %16s\n",

68 
æim∑ú_¨r
[
i
].
«me
,

69 (
æim
.
æim_cur
 =-1UL ? "u∆imôed" : 
tmp1
),

70 (
æim
.
æim_max
 =-1UL ? "u∆imôed" : 
tmp2
)

73 
	}
}

75 
	$maö
()

77 
	`quîy_æimôs
();

78 
	`exô
(
EXIT_SUCCESS
);

79 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch4/alloca_try.c

19 
	#_GNU_SOURCE


	)

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<uni°d.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<Æloˇ.h
>

25 
	~<°rög.h
>

26 
	~"../comm⁄.h
"

28 
	$åy_Æloˇ
(c⁄° *
csz
, 
do_the_mem£t
)

30 
size_t
 
sz
 = 
	`©ﬁ
(
csz
);

31 *
≠å
;

33 
≠å
 = 
	`Æloˇ
(
sz
);

34 i‡(!
≠å
)

35 
	`FATAL
("Æloˇ(%zuËÁûed\n", 
sz
);

37 i‡(1 =
do_the_mem£t
)

38 
	`mem£t
(
≠å
, 'a', 
sz
);

43 
	}
}

45 
	$maö
(
¨gc
, **
¨gv
)

47 i‡(
¨gc
 < 3) {

48 
	`Ârötf
(
°dîr
, "Usage: %s size-to-alloca do_the_memset[1|0]\n",

49 
¨gv
[0]);

50 
	`exô
(
EXIT_FAILURE
);

53 i‡(
	`©oi
(
¨gv
[2]) == 1)

54 
	`åy_Æloˇ
(
¨gv
[1], 1);

55 i‡(
	`©oi
(
¨gv
[2]) == 0)

56 
	`åy_Æloˇ
(
¨gv
[1], 0);

58 
	`Ârötf
(
°dîr
, "Usage: %s size-to-alloca do_the_memset[1|0]\n",

59 
¨gv
[0]);

60 
	`exô
(
EXIT_FAILURE
);

63 
	`exô
(
EXIT_SUCCESS
);

64 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch4/malloc_brk_test.c

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<°rög.h
>

22 
	~<uni°d.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/waô.h
>

25 
	~<mÆloc.h
>

28 #unde‡
USE_CALLOC


29 
	#TRIES
 5

	)

31 
	ggFœg_show_m°©s
, 
	ggFœg_œrge_Ælocs
, 
	ggFœg_ã°_£gÁu…1
,

32 
	ggFœg_ã°_£gÁu…2
;

33 *
	ghóp_±r
[
TRIES
];

34 *
	göô_brk
;

39 
	$Ælo˘e°
(
ödex
, 
size_t
 
num
)

41 *
p
;

43 #i‚de‡
USE_CALLOC


44 
p
 = 
	`mÆloc
(
num
);

46 
p
 = 
	`ˇŒoc
(
num
, ());

48 i‡(!
p
) {

49 
	`Ârötf
(
°dîr
, "out of memory!\n");

50 
	`exô
(
EXIT_FAILURE
);

53 
hóp_±r
[
ödex
] = 
p
;

54 #i‚de‡
USE_CALLOC


55 
	`¥ötf
("%2d: mÆloc(%8luË", 
ödex
, 
num
);

57 
	`¥ötf
("%d: cÆloc", 
ödex
);

59 
	`¥ötf
("%16∞", 
p
);

60 
	`¥ötf
(" %16∞[%lu]\n", 
	`sbrk
(0), (sbrk(0Ë- 
öô_brk
));

61 i‡(
gFœg_show_m°©s
 == 1) {

62 
	`mÆloc_°©s
();

63 
	`¥ötf
("\n");

65 
	}
}

67 
	$ußge
(*
«me
)

69 
	`Ârötf
(
°dîr
,

76 "-h | --hñ∞: showÅhi†hñ∞s¸ìn\n", 
«me
);

77 
	}
}

79 
	$¥o˚ss_¨gs
(
¨gc
, **
¨gv
)

81 i‡((
¨gc
 =2Ë&& ((
	`°∫cmp
(
¨gv
[1], "-h", 2) == 0) ||

82 (
	`°∫cmp
(
¨gv
[1], "--help", 6) == 0))) {

83 
	`ußge
(
¨gv
[0]);

84 
	`exô
(
EXIT_SUCCESS
);

87 i‡(
¨gc
 == 2) {

88 
	`©oi
(
¨gv
[1])) {

90 
gFœg_show_m°©s
 = 1;

93 
gFœg_show_m°©s
 = 
gFœg_œrge_Ælocs
 = 1;

96 
gFœg_ã°_£gÁu…1
 = 1;

99 
gFœg_ã°_£gÁu…2
 = 1;

102 
	`ußge
(
¨gv
[0]);

103 
	`exô
(
EXIT_FAILURE
);

106 
	}
}

108 
	$maö
(
¨gc
, **
¨gv
)

110 
i
 = 0;

111 vﬁ©ûê*
q
;

113 
	`¥o˚ss_¨gs
(
¨gc
, 
¨gv
);

115 
öô_brk
 = 
	`sbrk
(0);

116 
	`¥ötf
(" inô_brk = %16p\n", 
öô_brk
);

117 
¥ötf


120 
	`Ælo˘e°
(
i
++, 8);

122 i‡(
gFœg_ã°_£gÁu…1
 == 1) {

123 
q
 = 
hóp_±r
[0];

124 *(
q
 + 3000) = 'a';

128 
	`¥ötf
("###Åest segfault 1:\n"

131 ()
q
, ()(q + 3000),

132 ()*(
q
 + 3000));

137 i‡(
gFœg_ã°_£gÁu…2
 == 1) {

138 
q
 = 
hóp_±r
[0];

139 
	`¥ötf
("###Åest segfault 2:\n"

142 ()
q
,

143 ()(
q
 + 3000 + (
	`sbrk
(0Ë- 
öô_brk
)));

144 *(
q
 + 3000 + (
	`sbrk
(0Ë- 
öô_brk
)) = 'b';

147 
	`Ælo˘e°
(
i
++, (
	`gë∑gesize
() - 8 - 5));

148 
	`Ælo˘e°
(
i
++, 3);

150 i‡(
gFœg_œrge_Ælocs
 == 1) {

151 
	`Ælo˘e°
(
i
++, (
	`sbrk
(0Ë- 
öô_brk
 + 1000));

159 
	`Ælo˘e°
(
i
++, 1024 * 1024);

162 
i
--)

163 
	`‰ì
(
hóp_±r
[
i
]);

165 
	`exô
(
EXIT_SUCCESS
);

166 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch4/mallocmax.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<m©h.h
>

22 
	~<sys/ty≥s.h
>

23 
	~"../comm⁄.h
"

28 
	tu64
;

32 
	$max_mÆloc
()

34 
szt
 = (
size_t
);

35 
max
 = 0;

37 
	`¥ötf
("*** %s(Ë***\n", 
__func__
);

38 
max
 = 
	`pow
(2, 
szt
 * 8);

39 
	`¥ötf
("sizeof size_t = %u; "

40 "max vÆuêo‡thê∑ømÅÿmÆlo¯%.0f\n", 
szt
, 
max
);

41 
	}
}

43 
	$√g©ive_mÆloc
()

45 
szt
 = (
size_t
);

46 
max
 = 0;

49 c⁄° 
size_t
 
⁄ePB
 = 1125899907000000;

50 
qa
 = 28 * 1000000;

52 
ld_num2Æloc
 = 
qa
 * 
⁄ePB
;

53 
size_t
 
szt_num2Æloc
 = 
qa
 * 
⁄ePB
;

54 
sd_num2Æloc
;

55 *
±r
;

57 
	`¥ötf
("*** %s(Ë***\n", 
__func__
);

59 
max
 = 
	`pow
(2, 
szt
 * 8);

60 
	`¥ötf
("size_àmax = %.0f\n", 
max
);

62 
	`¥ötf
("ld_num2alloc = %ld\nszt_num2alloc = %zu\n",

63 
ld_num2Æloc
, 
szt_num2Æloc
);

65 
±r
 = 
	`mÆloc
(
ld_num2Æloc
);

66 
	`¥ötf
("1.Ü⁄g i¡ u£d: mÆloc(%ldËªtu∫†%p\n", 
ld_num2Æloc
,

67 
±r
);

68 
	`‰ì
(
±r
);

70 
±r
 = 
	`mÆloc
(
szt_num2Æloc
);

71 
	`¥ötf
("2. size_àu£d: mÆloc(%zuËªtu∫†%p\n", 
szt_num2Æloc
,

72 
±r
);

73 
	`‰ì
(
±r
);

75 
sd_num2Æloc
 = 6 * 1024;

76 
±r
 = 
	`mÆloc
(
sd_num2Æloc
);

77 
	`¥ötf
("3. sh‹àöàu£d: mÆloc(%dËªtu∫†%p\n", 
sd_num2Æloc
, 
±r
);

78 
	`‰ì
(
±r
);

80 
sd_num2Æloc
 = 60 * 1024;

81 
±r
 = 
	`mÆloc
(
sd_num2Æloc
);

82 
	`¥ötf
("4. sh‹àöàu£d: mÆloc(%dËªtu∫†%p\n", 
sd_num2Æloc
, 
±r
);

83 
	`‰ì
(
±r
);

85 
szt_num2Æloc
 = 
sd_num2Æloc
;

86 
±r
 = 
	`mÆloc
(
szt_num2Æloc
);

87 
	`¥ötf
("5. size_àu£d: mÆloc(%zuËªtu∫†%p\n", 
szt_num2Æloc
,

88 
±r
);

89 
	`‰ì
(
±r
);

91 
±r
 = 
	`mÆloc
(-1UL);

92 
	`¥ötf
("6. mÆloc(%luËªtu∫†%p\n", -1UL, 
±r
);

93 
	`‰ì
(
±r
);

95 
±r
 = 
	`mÆloc
(0);

96 
	`¥ötf
("7. mÆloc(0Ëªtu∫†%p\n", 
±r
);

97 
	`‰ì
(
±r
);

98 
	}
}

100 
	$maö
()

102 
	`max_mÆloc
();

103 
	`√g©ive_mÆloc
();

104 
	`exô
(
EXIT_SUCCESS
);

105 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch4/memprot.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<°rög.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/mm™.h
>

25 
	~"../comm⁄.h
"

28 
	ggPgsz
;

29 
	gok‹nŸ
[4];

31 
	#TEST_READ
(
pgnum
, 
addr
) do { \

32 
	`¥ötf
("page %d:Ñeading: byte @ 0x%llx is ", \

33 
pgnum
, (
u64
)
addr
); \

34 
	`fÊush
(
°dout
); \

35 
	`¥ötf
(" %x", *
addr
); \

36 
	`¥ötf
(" [OK]\n"); \

37 } 0)

	)

39 
	#TEST_WRITE
(
pgnum
, 
addr
, 
byã
) do { \

40 
	`¥ötf
("page %d: writing: byte '%c'Åoáddress 0x%llxÇow ...", \

41 
pgnum
, 
byã
, (
u64
)
addr
); \

42 
	`fÊush
(
°dout
); \

43 *
addr
 = 
byã
; \

44 
	`¥ötf
(" [OK]\n"); \

45 } 0)

	)

48 
	tu64
;

51 
	$ã°_mem
(*
±r
, 
wrôe_⁄_ro_mem
)

53 
byã
 = 
	`øndom
(Ë% 
gPgsz
;

54 *
°¨t_off
;

56 
	`¥ötf
("\n----- %s(Ë-----\n", 
__func__
);

59 i‡(
ok‹nŸ
[0] == 1) {

60 
°¨t_off
 = (*)
±r
 + 0 * 
gPgsz
 + 
byã
;

61 
	`TEST_WRITE
(0, 
°¨t_off
, 'a');

62 
	`TEST_READ
(0, 
°¨t_off
);

64 
	`¥ötf
("*** Page 0 : skippingÅestsás memprot failed...\n");

67 i‡(
ok‹nŸ
[1] == 1) {

68 
°¨t_off
 = (*)
±r
 + 1 * 
gPgsz
 + 
byã
;

69 
	`TEST_READ
(1, 
°¨t_off
);

70 i‡(
wrôe_⁄_ro_mem
 == 1) {

71 
	`TEST_WRITE
(1, 
°¨t_off
, 'b');

74 
	`¥ötf
("*** Page 1 : skippingÅestsás memprot failed...\n");

77 i‡(
ok‹nŸ
[2] == 1) {

78 
°¨t_off
 = (*)
±r
 + 2 * 
gPgsz
 + 
byã
;

79 
	`TEST_READ
(2, 
°¨t_off
);

80 
	`TEST_WRITE
(2, 
°¨t_off
, 'c');

82 
	`¥ötf
("*** Page 2 : skippingÅestsás memprot failed...\n");

85 i‡(
ok‹nŸ
[3] == 1) {

86 
°¨t_off
 = (*)
±r
 + 3 * 
gPgsz
 + 
byã
;

87 
	`TEST_READ
(3, 
°¨t_off
);

88 
	`TEST_WRITE
(3, 
°¨t_off
, 'd');

90 
	`¥ötf
("*** Page 3 : skippingÅestsás memprot failed...\n");

91 
	}
}

93 
	$¥Ÿe˘_mem
(*
±r
)

95 
i
;

96 
u64
 
°¨t_off
 = 0;

97 
°r_¥Ÿs
[][128] = { "PROT_READ|PROT_WRITE", "PROT_READ",

100 
¥Ÿs
[4] = { 
PROT_READ
 | 
PROT_WRITE
, PROT_READ,

101 
PROT_READ
 | 
PROT_WRITE
 | 
PROT_EXEC
, 
PROT_NONE


104 
	`¥ötf
("----- %s(Ë-----\n", 
__func__
);

105 
	`mem£t
(
ok‹nŸ
, 0, (okornot));

108 
i
 = 0; i < 4; i++) {

109 
°¨t_off
 = (
u64
Ë
±r
 + (
i
 * 
gPgsz
);

110 
	`¥ötf
("page %d:Örotections: %30s: "

112 
i
, 
°r_¥Ÿs
[i], 
°¨t_off
, sèπ_of‡+ 
gPgsz
 - 1);

114 i‡(
	`m¥Ÿe˘
((*)
°¨t_off
, 
gPgsz
, 
¥Ÿs
[
i
]) == -1)

115 
	`WARN
("m¥Ÿe˘(%sËÁûed\n", 
°r_¥Ÿs
[
i
]);

117 
ok‹nŸ
[
i
] = 1;

119 
	}
}

121 
	$maö
(
¨gc
, **
¨gv
)

123 *
±r
 = 
NULL
;

125 i‡(
¨gc
 < 2) {

126 
	`Ârötf
(
°dîr
, "Usage: %sÅest-write-to-ro-mem [0|1]\n",

127 
¨gv
[0]);

128 
	`exô
(
EXIT_FAILURE
);

130 
gPgsz
 = 
	`gë∑gesize
();

133 
¥ötf


135 &
maö
);

136 i‡(
	`m¥Ÿe˘
((*)&
maö
, 
gPgsz
, 
PROT_READ
 | 
PROT_WRITE
 | 
PROT_EXEC
)

138 
	`WARN
("mprotect(%s) on main failed\n",

143 
	`posix_memÆign
(&
±r
, 
gPgsz
, 4 * gPgsz);

144 i‡(!
±r
)

145 
	`FATAL
("posix_memÆign(f‹ %zu byãsËÁûed\n", 4 * 
gPgsz
);

147 
	`¥Ÿe˘_mem
(
±r
);

148 
	`ã°_mem
(
±r
, 
	`©oi
(
¨gv
[1]));

150 
	`‰ì
(
±r
);

151 
	`exô
(
EXIT_SUCCESS
);

152 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch4/memprot_arm.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<°rög.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/mm™.h
>

25 
	~"../comm⁄.h
"

28 
	ggPgsz
;

29 
	gok‹nŸ
[4];

31 
	#TEST_READ
(
pgnum
, 
addr
) do { \

32 
	`¥ötf
("page %d:Ñeading: byte @ 0x%lx is ", \

33 
pgnum
, (
u32
)
addr
); \

34 
	`fÊush
(
°dout
); \

35 
	`¥ötf
(" %x", *
addr
); \

36 
	`¥ötf
(" [OK]\n"); \

37 } 0)

	)

39 
	#TEST_WRITE
(
pgnum
, 
addr
, 
byã
) do { \

40 
	`¥ötf
("page %d: writing: byte '%c'Åoáddress 0x%lxÇow ...", \

41 
pgnum
, 
byã
, (
u32
)
addr
); \

42 
	`fÊush
(
°dout
); \

43 *
addr
 = 
byã
; \

44 
	`¥ötf
(" [OK]\n"); \

45 } 0)

	)

48 
	tu32
;

51 
	$ã°_mem
(*
±r
, 
wrôe_⁄_ro_mem
)

53 
byã
 = 
	`øndom
(Ë% 
gPgsz
;

54 *
°¨t_off
 = (*)
±r
 + 
byã
;

56 
	`¥ötf
("\n----- %s(Ë-----\n", 
__func__
);

59 i‡(
ok‹nŸ
[0] == 1) {

60 
	`TEST_WRITE
(0, 
°¨t_off
, 'a');

61 
	`TEST_READ
(0, 
°¨t_off
);

63 
	`¥ötf
("*** Page 0 : skippingÅestsás memprot failed...\n");

66 i‡(
ok‹nŸ
[1] == 1) {

67 
°¨t_off
 = (*)
±r
 + 1 * 
gPgsz
 + 
byã
;

68 
	`TEST_READ
(1, 
°¨t_off
);

69 i‡(
wrôe_⁄_ro_mem
 == 1) {

70 
	`TEST_WRITE
(1, 
°¨t_off
, 'b');

73 
	`¥ötf
("*** Page 1 : skippingÅestsás memprot failed...\n");

76 i‡(
ok‹nŸ
[2] == 1) {

77 
°¨t_off
 = (*)
±r
 + 2 * 
gPgsz
 + 
byã
;

78 
	`TEST_READ
(2, 
°¨t_off
);

79 
	`TEST_WRITE
(2, 
°¨t_off
, 'c');

81 
	`¥ötf
("*** Page 2 : skippingÅestsás memprot failed...\n");

84 i‡(
ok‹nŸ
[3] == 1) {

85 
°¨t_off
 = (*)
±r
 + 3 * 
gPgsz
 + 
byã
;

86 
	`TEST_READ
(3, 
°¨t_off
);

87 
	`TEST_WRITE
(3, 
°¨t_off
, 'd');

89 
	`¥ötf
("*** Page 3 : skippingÅestsás memprot failed...\n");

90 
	}
}

92 
	$¥Ÿe˘_mem
(*
±r
)

94 
i
;

95 
u32
 
°¨t_off
 = 0;

96 
°r_¥Ÿs
[][128] = { "PROT_READ|PROT_WRITE", "PROT_READ",

99 
¥Ÿs
[4] = { 
PROT_READ
 | 
PROT_WRITE
, PROT_READ,

100 
PROT_READ
 | 
PROT_WRITE
 | 
PROT_EXEC
, 
PROT_NONE


103 
	`¥ötf
("----- %s(Ë-----\n", 
__func__
);

104 
	`mem£t
(
ok‹nŸ
, 0, (okornot));

107 
i
 = 0; i < 4; i++) {

108 
°¨t_off
 = (
u32
Ë
±r
 + (
i
 * 
gPgsz
);

109 
	`¥ötf
("page %d:Örotections: %30s: "

111 
i
, 
°r_¥Ÿs
[i], 
°¨t_off
, sèπ_of‡+ 
gPgsz
 - 1);

113 i‡(
	`m¥Ÿe˘
((*)
°¨t_off
, 
gPgsz
, 
¥Ÿs
[
i
]) == -1)

114 
	`WARN
("m¥Ÿe˘(%sËÁûed\n", 
°r_¥Ÿs
[
i
]);

116 
ok‹nŸ
[
i
] = 1;

118 
	}
}

120 
	$maö
(
¨gc
, **
¨gv
)

122 *
±r
 = 
NULL
;

124 i‡(
¨gc
 < 2) {

125 
	`Ârötf
(
°dîr
, "Usage: %sÅest-write-to-ro-mem [0|1]\n",

126 
¨gv
[0]);

127 
	`exô
(
EXIT_FAILURE
);

129 
gPgsz
 = 
	`gë∑gesize
();

132 
¥ötf


134 &
maö
);

135 i‡(
	`m¥Ÿe˘
((*)&
maö
, 
gPgsz
, 
PROT_READ
 | 
PROT_WRITE
 | 
PROT_EXEC
)

137 
	`WARN
("mprotect(%s) on main failed\n",

142 
	`posix_memÆign
(&
±r
, 
gPgsz
, 4 * gPgsz);

143 i‡(!
±r
)

144 
	`FATAL
("posix_memÆign(f‹ %zu byãsËÁûed\n", 4 * 
gPgsz
);

146 
	`¥Ÿe˘_mem
(
±r
);

147 
	`ã°_mem
(
±r
, 
	`©oi
(
¨gv
[1]));

149 
	`‰ì
(
±r
);

150 
	`exô
(
EXIT_SUCCESS
);

151 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch4/mlock_try.c

26 
	#_GNU_SOURCE


	)

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<uni°d.h
>

30 
	~<sys/ty≥s.h
>

31 
	~<sys/mm™.h
>

32 
	~<°rög.h
>

33 
	~<limôs.h
>

34 
	~"../comm⁄.h
"

36 
	#CMD_MAX
 256

	)

38 
	$di•_locked_mem
()

40 *
cmd
 = 
	`mÆloc
(
CMD_MAX
);

41 i‡(!
cmd
)

42 
	`FATAL
("mÆloc(%zuËÁûed\n", 
CMD_MAX
);

43 
	`¢¥ötf
(
cmd
, 
CMD_MAX
 - 1, "gª∞Lck /¥oc/%d/°©us", 
	`gëpid
());

44 
	`sy°em
(
cmd
);

45 
	`‰ì
(
cmd
);

46 
	}
}

48 
	$åy_mlock
(c⁄° *
˝gs
)

50 
size_t
 
num_pg
 = 
	`©ﬁ
(
˝gs
);

51 c⁄° 
pgsz
 = 
	`sysc⁄f
(
_SC_PAGESIZE
);

52 *
±r
 = 
NULL
;

53 
size_t
 
Àn
;

55 
Àn
 = 
num_pg
 * 
pgsz
;

56 i‡(
Àn
 >
LONG_MAX
)

57 
	`FATAL
("toÿm™y byã†tÿÆlo¯(%zu),áb‹tögÇow\n", 
Àn
);

61 
	`posix_memÆign
(&
±r
, 
pgsz
, 
Àn
);

62 i‡(!
±r
)

63 
	`FATAL
("posix_memÆign(f‹ %zu byãsËÁûed\n", 
Àn
);

66 i‡(
	`mlock
(
±r
, 
Àn
)) {

67 
	`‰ì
(
±r
);

68 
	`FATAL
("mlock failed\n");

70 
	`¥ötf
("Locked %zu byã†‰omáddªs†%p\n", 
Àn
, 
±r
);

71 
	`mem£t
(
±r
, 'L', 
Àn
);

72 
	`di•_locked_mem
();

73 
	`¶ìp
(1);

76 i‡(
	`mu∆ock
(
±r
, 
Àn
)) {

77 
	`‰ì
(
±r
);

78 
	`FATAL
("munlock failed\n");

80 
	`¥ötf
("unlocked..\n");

81 
	`‰ì
(
±r
);

82 
	}
}

84 
	$maö
(
¨gc
, **
¨gv
)

86 i‡(
¨gc
 < 2) {

87 
	`Ârötf
(
°dîr
, "Ußge: %†∑ges-to-Æloc\n", 
¨gv
[0]);

88 
	`exô
(
EXIT_FAILURE
);

90 
	`di•_locked_mem
();

91 
	`åy_mlock
(
¨gv
[1]);

92 
	`exô
(
EXIT_SUCCESS
);

93 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch4/show_curbrk.c

23 
	#_GNU_SOURCE


	)

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<uni°d.h
>

27 
	~<î∫o.h
>

28 
	~<limôs.h
>

29 
	~"../comm⁄.h
"

31 
	$maö
(
¨gc
, **
¨gv
)

33 *
hóp_±r
;

34 
size_t
 
num
 = 2048;

37 i‡(
¨gc
 == 1) {

38 
	`¥ötf
("Cuºíà¥ogøm bªak: %p\n", 
	`sbrk
(0));

39 
	`exô
(
EXIT_SUCCESS
);

46 
num
 = 
	`°πoul
(
¨gv
[1], 0, 10);

47 i‡((
î∫o
 =
ERANGE
 && 
num
 =
ULONG_MAX
)

48 || (
î∫o
 !0 && 
num
 == 0))

49 
	`FATAL
("°πoul(%sËÁûed!\n", 
¨gv
[1]);

50 i‡(
num
 >= 128 * 1024)

51 
	`FATAL
("%s:Ö»∑s†®vÆuê< 128 KB\n", 
¨gv
[0]);

53 
	`¥ötf
("OrigöÆÖrogøm bªak: %∞; ", 
	`sbrk
(0));

54 
hóp_±r
 = 
	`mÆloc
(
num
);

55 i‡(!
hóp_±r
)

56 
	`FATAL
("malloc failed!");

57 
	`¥ötf
("malloc(%lu) = %16p ; curr break = %16p\n",

58 
num
, 
hóp_±r
, 
	`sbrk
(0));

59 
	`‰ì
(
hóp_±r
);

61 
	`exô
(
EXIT_SUCCESS
);

62 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch5/membugs.c

24 
	#_GNU_SOURCE


	)

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<uni°d.h
>

28 
	~<°rög.h
>

29 
	~"../comm⁄.h
"

32 c⁄° 
size_t
 
	gBLK_1MB
 = 1024*1024;

42 
	$sûly_gë∑th
(**
±r
)

44 
	~<löux/limôs.h
>

45 *
±r
 = 
	`mÆloc
(
PATH_MAX
);

46 i‡(!
±r
)

47 
	`FATAL
("malloc failed\n");

49 
	`°r˝y
(*
±r
, 
	`gëív
("PATH"));

50 i‡(!*
±r
)

51 
	`WARN
("getenv failed\n");

52 
	}
}

55 
	$Àakage_ˇ£3
(
c⁄d
)

57 *
my∑th
=
NULL
;

59 
	`¥ötf
("\n## LeakageÅest: case 3: \"lib\" API"

60 ":Ñu¡imêc⁄d = %d\n", 
c⁄d
);

63 
	`sûly_gë∑th
(&
my∑th
);

64 
	`¥ötf
("my∑th = %s\n", 
my∑th
);

66 i‡(
c⁄d
)

67 
	`‰ì
(
my∑th
);

68 
	}
}

70 
	$amÀaky
(
size_t
 
mem
)

72 *
±r
;

74 
±r
 = 
	`mÆloc
(
mem
);

75 i‡(!
±r
)

76 
	`FATAL
("mÆloc(%zuËÁûed\n", 
mem
);

81 
	`mem£t
(
±r
, 0, 
mem
);

84 
	}
}

87 
	$Àakage_ˇ£2
(
size_t
 
size
, 
ªps
)

89 
i
, 
thªshﬁd
 = 3*
BLK_1MB
;

90 
mem_Àaked
;

92 i‡(
ªps
 == 0)

93 
ªps
 = 1;

94 
mem_Àaked
 = 
size
 * 
ªps
;

95 
	`¥ötf
("%s(): willÇowÜeakáÅotal of %.0f bytes (%.2f MB)"

97 
__func__
, 
mem_Àaked
, mem_leaked/(1024*1024),

98 
size
, 
ªps
);

100 i‡(
mem_Àaked
 >
thªshﬁd
)

101 
	`sy°em
("free|grep \"^Mem:\"");

103 
i
=0; i<
ªps
; i++) {

104 i‡(
i
%10000 == 0)

105 
	`¥ötf
("%s():%6d:mÆloc(%zu)\n", 
__func__
, 
i
, 
size
);

106 
	`amÀaky
(
size
);

109 i‡(
mem_Àaked
 >
thªshﬁd
)

110 
	`sy°em
("free|grep \"^Mem:\"");

111 
	`¥ötf
("\n");

112 
	}
}

115 
	$Àakage_ˇ£1
(
size_t
 
size
)

117 
	`¥ötf
("%s(): willÇowÜeak %zu bytes (%ld MB)\n",

118 
__func__
, 
size
, size/(1024*1024));

119 
	`amÀaky
(
size
);

120 
	}
}

123 
	$doubÀ‰ì
(
c⁄d
)

125 *
±r
, *
bogus
;

126 
«me
[]="Hands-on Linux Sys Prg";

127 
n
=512;

129 
	`¥ötf
("%s(): c⁄d %d\n", 
__func__
, 
c⁄d
);

130 
±r
 = 
	`mÆloc
(
n
);

131 i‡(!
±r
)

132 
	`FATAL
("malloc failed\n");

133 
	`°∫˝y
(
±r
, 
«me
, 
	`°æí
(name));

134 
	`‰ì
(
±r
);

136 i‡(
c⁄d
) {

137 
bogus
 = 
	`mÆloc
(-1UL);

138 i‡(!
bogus
) {

139 
	`Ârötf
(
°dîr
, "%s:%s:%d: malloc failed\n",

140 
__FILE__
, 
__func__
, 
__LINE__
);

141 
	`‰ì
(
±r
);

142 
	`exô
(
EXIT_FAILURE
);

145 
	}
}

148 * 
	$u¨
()

150 
«me
[32];

152 
	`mem£t
(
«me
, 0, 32);

153 
	`°∫˝y
(
«me
, "Hands-on Linux Sys Prg", 22);

155  
«me
;

156 
	}
}

159 
	$uaf
()

161 *
¨r
, *
√xt
;

162 
«me
[]="Hands-on Linux Sys Prg";

163 
n
=512;

165 
¨r
 = 
	`mÆloc
(
n
);

166 i‡(!
¨r
)

167 
	`FATAL
("mallocárr failed\n");

168 
	`mem£t
(
¨r
, 'a', 
n
);

169 
¨r
[
n
-1]='\0';

170 
	`¥ötf
("%s():%d:áº = %p:%.*s\n", 
__func__
, 
__LINE__
, 
¨r
, 32,árr);

172 
√xt
 = 
	`mÆloc
(
n
);

173 i‡(!
√xt
) {

174 
	`‰ì
(
¨r
);

175 
	`Ârötf
(
°dîr
, "Eº‹Üog:áº=%p:vÆ=%s\n", 
¨r
,árr);

177 
	`FATAL
("mallocÇext failed\n");

179 
	`‰ì
(
¨r
);

180 
	`°∫˝y
(
¨r
, 
«me
, 
	`°æí
(name));

182 
	`¥ötf
("%s():%d:áº = %p:%.*s\n", 
__func__
, 
__LINE__
, 
¨r
, 32,árr);

183 
	`‰ì
(
√xt
);

184 
	}
}

187 
	$ªad_undîÊow
(
c⁄d
)

189 *
de°
, 
§c
[] = "abcd56789", *
‹ig
;

191 
	`¥ötf
("%s(): c⁄d %d\n", 
__func__
, 
c⁄d
);

192 
de°
 = 
	`mÆloc
(25);

193 i‡(!
de°
)

194 
	`FATAL
("malloc failed\n");

195 
‹ig
 = 
de°
;

197 
	`°∫˝y
(
de°
, 
§c
, 
	`°æí
(src));

198 i‡(
c⁄d
) {

199 *(
‹ig
-1) = 'x';

200 
de°
 --;

202 
	`¥ötf
(" de°: %s\n", 
de°
);

204 
	`‰ì
(
‹ig
);

205 
	}
}

208 
	$ªad_ovîÊow_dynmem
()

210 *
¨r
;

212 
¨r
 = 
	`mÆloc
(5);

213 i‡(!
¨r
)

214 
	`FATAL
("malloc failed\n");

215 
	`mem£t
(
¨r
, 'a', 5);

221 
¨r
[5] = 'S';árr[6] = 'e';árr[7] = 'c';

222 
¨r
[8] = 'r';árr[9] = 'e';árr[10] = 'T';

223 
	`¥ötf
("¨∏%s\n", 
¨r
);

226 
	`¥ötf
("*◊º+100)=%d\n", *(
¨r
 + 100));

227 
	`¥ötf
("*◊º+10000)=%d\n", *(
¨r
 + 10000));

229 
	`‰ì
(
¨r
);

230 
	}
}

233 
	$ªad_ovîÊow_compûemem
()

235 
¨r
[5], 
tmp
[8];

237 
	`mem£t
(
¨r
, 'a', 5);

238 
	`mem£t
(
tmp
, 't', 8);

239 
tmp
[7] = '\0';

241 
	`¥ötf
("¨∏%s\n", 
¨r
);

242 
	}
}

245 
	$wrôe_undîÊow
()

247 *
p
 = 
	`mÆloc
(8);

249 i‡(!
p
)

250 
	`FATAL
("malloc failed\n");

252 
p
--;

253 
	`°∫˝y
(
p
, "abcd5678", 8);

254 
	`‰ì
(++
p
);

255 
	}
}

258 
	$wrôe_ovîÊow_dynmem
()

260 *
de°
, 
§c
[] = "abcd56789";

262 
de°
 = 
	`mÆloc
(8);

263 i‡(!
de°
)

264 
	`FATAL
("malloc failed\n");

266 
	`°r˝y
(
de°
, 
§c
);

267 
	`‰ì
(
de°
);

268 
	}
}

271 
	$wrôe_ovîÊow_compûemem
()

273 
i
, 
¨r
[5];

275 
i
 = 0; i <= 5; i++) {

276 
¨r
[
i
] = 100;

280 
	}
}

283 
	gg¨r
[5];

284 
	$wrôe_ovîÊow_globÆmem
()

286 
i
, 
¨r
[5];

288 
i
 = 0; i <= 5; i++) {

289 
g¨r
[
i
] = 100;

291 
	}
}

294 
	$unöô_v¨
()

296 
x
;

298 i‡(
x
)

299 
	`¥ötf
("åuêˇ£: x=%d\n", 
x
);

301 
	`¥ötf
("false case\n");

302 
	}
}

304 
	$ußge
(*
«me
)

306 
	`Ârötf
(
°dîr
,

322 "-h | --hñ∞: showÅhi†hñ∞s¸ìn\n", 
«me
);

323 
	}
}

325 
	$¥o˚ss_¨gs
(
¨gc
, **
¨gv
)

327 *
ªs
;

329 i‡(
¨gc
 < 2) {

330 
	`ußge
(
¨gv
[0]);

331 
	`exô
(
EXIT_FAILURE
);

333 i‡((
¨gc
 =2Ë&& ((
	`°∫cmp
(
¨gv
[1], "-h", 2) == 0) ||

334 (
	`°∫cmp
(
¨gv
[1], "--help", 6) == 0))) {

335 
	`ußge
(
¨gv
[0]);

336 
	`exô
(
EXIT_SUCCESS
);

339 i‡(
¨gc
 == 2) {

340 
	`©oi
(
¨gv
[1])) {

342 
	`unöô_v¨
();

345 
	`wrôe_ovîÊow_compûemem
();

348 
	`wrôe_ovîÊow_dynmem
();

351 
	`wrôe_undîÊow
();

354 
	`ªad_ovîÊow_compûemem
();

357 
	`ªad_ovîÊow_dynmem
();

360 
	`ªad_undîÊow
(0);

361 
	`ªad_undîÊow
(1);

364 
	`uaf
();

367 
ªs
 = 
	`u¨
();

368 
	`¥ötf
("ªs: %s\n", (*)
ªs
);

371 
	`doubÀ‰ì
(0);

372 
	`doubÀ‰ì
(1);

375 
	`Àakage_ˇ£1
(32);

376 
	`Àakage_ˇ£1
(
BLK_1MB
);

379 
	`Àakage_ˇ£2
(32, 100000);

380 
	`Àakage_ˇ£2
(
BLK_1MB
, 12);

383 
	`Àakage_ˇ£3
(0);

384 
	`Àakage_ˇ£3
(1);

387 
	`wrôe_ovîÊow_globÆmem
();

390 
	`ußge
(
¨gv
[0]);

391 
	`exô
(
EXIT_FAILURE
);

394 
	}
}

396 
	$maö
(
¨gc
, **
¨gv
)

398 
	`¥o˚ss_¨gs
(
¨gc
, 
¨gv
);

399 
	`exô
(
EXIT_SUCCESS
);

400 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch7/hello_pause.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<°dlib.h
>

23 
	$maö
()

25 
	`¥ötf
("Hello, Linux System Programming, World!\n");

26 
	`∑u£
();

27 
	`exô
(
EXIT_SUCCESS
);

28 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch7/query_creds.c

14 
	#_GNU_SOURCE


	)

15 
	~<°dio.h
>

16 
	~<°dlib.h
>

17 
	~<uni°d.h
>

18 
	~<sys/ty≥s.h
>

19 
	~"../comm⁄.h
"

21 
	#SHOW_CREDS
() do { \

22 
	`¥ötf
("RUID=%d EUID=%d\n" \

24 
	`gëuid
(), 
	`gëeuid
(), \

25 
	`gëgid
(), 
	`gëegid
()); \

26 } 0)

	)

28 
	$maö
(
¨gc
, **
¨gv
)

30 
	`SHOW_CREDS
();

31 i‡(
	`gëeuid
() == 0) {

32 
	`¥ötf
("%†nowÉf„˘ivñyÑu¬ögá†roŸ! ...\n", 
¨gv
[0]);

33 
	`¶ìp
(1);

35 
	`exô
 (
EXIT_SUCCESS
);

36 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch7/rootsh_hack1.c

14 
	#_GNU_SOURCE


	)

15 
	~<°dio.h
>

16 
	~<°dlib.h
>

17 
	~<uni°d.h
>

18 
	~<sys/ty≥s.h
>

19 
	~"../comm⁄.h
"

21 
	$maö
(
¨gc
, **
¨gv
)

27 
	`sy°em
("/bin/bash");

28 
	`exô
 (
EXIT_SUCCESS
);

29 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch7/rootsh_hack2.c

14 
	#_GNU_SOURCE


	)

15 
	~<°dio.h
>

16 
	~<°dlib.h
>

17 
	~<uni°d.h
>

18 
	~<sys/ty≥s.h
>

19 
	~"../comm⁄.h
"

21 
	$maö
(
¨gc
, **
¨gv
)

24 i‡(
	`£tuid
(0) == -1)

25 
	`WARN
("setuid(0) failed!\n");

30 
	`sy°em
("/bin/bash");

31 
	`exô
 (
EXIT_SUCCESS
);

32 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch7/savedset_demo.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<sys/ty≥s.h
>

22 
	~"../comm⁄.h
"

24 
	#SHOW_CREDS
() do { \

25 
	`¥ötf
("RUID=%d EUID=%d\n" \

27 
	`gëuid
(), 
	`gëeuid
(), \

28 
	`gëgid
(), 
	`gëegid
()); \

29 } 0)

	)

31 
	$maö
(
¨gc
, **
¨gv
)

33 
uid_t
 
ßved_£tuid
;

35 
	`¥ötf
("t0: Init:\n");

36 
	`SHOW_CREDS
();

37 i‡(0 !
	`gëeuid
())

38 
	`FATAL
("Notá setuid-rootÉxecutable,"

43 , 
¨gv
[0],árgv[0],árgv[0]);

44 
	`¥ötf
(" Ok, we'reÉffectivelyÑunningásÑoot! (EUID==0)\n");

49 
ßved_£tuid
 = 
	`gëeuid
();

51 
	`¥ötf
("t1: Becoming my original self!\n");

52 i‡(
	`£ãuid
(
	`gëuid
()) == -1)

53 
	`FATAL
("seteuid() step 2 failed!\n");

54 
	`SHOW_CREDS
();

56 
	`¥ötf
("t2: SwitchingÅoÖrivileged stateÇow...\n");

57 i‡(
	`£ãuid
(
ßved_£tuid
) == -1)

58 
	`FATAL
("seteuid() step 3 failed!\n");

59 
	`SHOW_CREDS
();

60 i‡(0 =
	`gëeuid
())

61 
	`¥ötf
(" Yup, we'reÑootágain!\n");

63 
	`FATAL
(" should be butáren'tÑoot; something wrong,áborting!\n");

65 
	`¥ötf
("t3: Switching backÅo unprivileged stateÇow ...\n");

66 i‡(
	`£ãuid
(
	`gëuid
()) == -1)

67 
	`FATAL
("seteuid() step 4 failed!\n");

68 
	`SHOW_CREDS
();

70 
	`exô
 (
EXIT_SUCCESS
);

71 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch8/hello_pause.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<°dlib.h
>

23 
	$maö
()

25 
	`¥ötf
("Hello, Linux System Programming, World!\n");

26 
	`∑u£
();

27 
	`exô
(
EXIT_SUCCESS
);

28 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch8/query_pcap.c

13 
	#_GNU_SOURCE


	)

14 
	~<°dio.h
>

15 
	~<°dlib.h
>

16 
	~<uni°d.h
>

17 
	~<sys/ty≥s.h
>

18 
	~<sys/ˇ∑bûôy.h
>

19 
	~<as£π.h
>

20 
	~"../comm⁄.h
"

22 
	$maö
(
¨gc
, **
¨gv
)

24 
pid_t
 
pid
;

25 
ˇp_t
 
pˇps
 = 
	`ˇp_öô
();

26 *
ˇps_ãxt
 = 
NULL
;

28 i‡(
¨gc
 < 2) {

29 
	`Ârötf
(
°dîr
, "Usage: %s PID\n"

30 " PID:Öro˚s†tÿquîy c≠abûôõ†of\n", 
¨gv
[0]);

31 
	`exô
(
EXIT_FAILURE
);

33 
	`as£π
 (
pˇps
 !
NULL
);

34 
pid
 = 
	`©oi
(
¨gv
[1]);

37 
	`¥ötf
("System supports CAP_SETFCAP? %s\n",

38 (
	`CAP_IS_SUPPORTED
(
CAP_SETFCAP
) ? "yes" : "no"));

40 
pˇps
 = 
	`ˇp_gë_pid
(
pid
);

41 i‡(!
pˇps
)

42 
	`FATAL
("ˇp_gë_pid faûed; i†¥o˚s†%d vÆid?\n", 
pid
);

44 
ˇps_ãxt
 = 
	`ˇp_to_ãxt
(
pˇps
, 
NULL
);

45 i‡(!
ˇps_ãxt
)

46 
	`FATAL
("ˇps_to_ãxàÁûed\n", 
¨gv
[1]);

48 
	`¥ötf
("Pro˚s†%6d : c≠abûôõ†¨e: %s\n", 
pid
, 
ˇps_ãxt
);

49 
	`ˇp_‰ì
(
ˇps_ãxt
);

51 
	`exô
(
EXIT_SUCCESS
);

52 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch8/set_pcap.c

27 
	#_GNU_SOURCE


	)

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<uni°d.h
>

31 
	~<sys/ty≥s.h
>

32 
	~<sys/ˇ∑bûôy.h
>

33 
	~<sig«l.h
>

34 
	~<as£π.h
>

35 
	~"../comm⁄.h
"

37 
	$boög
(
sig
)

39 
	`¥ötf
("*(boing!)*\n");

40 
	}
}

42 
	$dr›_ˇps_be_n‹mÆ
()

44 
ˇp_t
 
n⁄e
;

47 i‡((
n⁄e
 = 
	`ˇp_öô
()Ë=
NULL
)

48 
	`FATAL
("cap_init() failed,áborting...\n");

49 i‡(
	`ˇp_£t_¥oc
(
n⁄e
) == -1) {

50 
	`ˇp_‰ì
(
n⁄e
);

51 
	`FATAL
("cap_set_proc('none') failed,áborting...\n");

53 
	`ˇp_‰ì
(
n⁄e
);

56 i‡(
	`£tuid
(
	`gëuid
()) < 0)

57 
	`FATAL
("setuidÅoÜowerÖrivileges failed,áborting..\n");

58 
	}
}

60 
	$ã°_£tuid
()

62 
	`¥ötf
("%s:\nRUID = %d EUID = %d\n", 
__func__
, 
	`gëuid
(), 
	`gëeuid
());

63 i‡(
	`£ãuid
(0) == -1)

64 
	`WARN
("seteuid(0) failed...\n");

65 
	`¥ötf
("RUID = %d EUID = %d\n", 
	`gëuid
(), 
	`gëeuid
());

66 
	}
}

68 
	$ußge
(**
¨gv
, 
°©
)

70 
	`Ârötf
(
°dîr
, "Usage: %s 1|2\n"

74 
¨gv
[0]);

75 
	`exô
(
°©
);

76 
	}
}

78 
	$maö
(
¨gc
, **
¨gv
)

80 
›t
, 
nˇp
;

81 
ˇp_t
 
myˇps
 = 
	`ˇp_öô
();

82 
ˇp_vÆue_t
 
ˇps2£t
[2];

84 i‡(
¨gc
 < 2)

85 
	`ußge
(
¨gv
, 
EXIT_FAILURE
);

87 
›t
 = 
	`©oi
(
¨gv
[1]);

88 i‡(
›t
 != 1 && opt != 2)

89 
	`ußge
(
¨gv
, 
EXIT_FAILURE
);

92 i‡(
	`sig«l
(
SIGINT
, 
boög
Ë=
SIG_ERR
)

93 
	`FATAL
("signal() SIGINT failed,áborting...\n");

94 i‡(
	`sig«l
(
SIGTERM
, 
boög
Ë=
SIG_ERR
)

95 
	`FATAL
("signal() SIGTERM failed,áborting...\n");

97 i‡(!
	`CAP_IS_SUPPORTED
(
CAP_SETUID
))

98 
FATAL


100 i‡(
›t
 == 2) {

101 i‡(!
	`CAP_IS_SUPPORTED
(
CAP_SYS_ADMIN
))

102 
FATAL


107 
	`as£π
(
myˇps
 !
NULL
);

108 
myˇps
 = 
	`ˇp_gë_¥oc
();

109 i‡(!
myˇps
)

110 
	`FATAL
("cap_get_proc() for CAP_SETUID failed,áborting...\n");

112 i‡(
›t
 == 1) {

113 
nˇp
 = 1;

114 
ˇps2£t
[0] = 
CAP_SETUID
;

115 } i‡(
›t
 == 2) {

116 
nˇp
 = 2;

117 
ˇps2£t
[0] = 
CAP_SETUID
;

118 
ˇps2£t
[1] = 
CAP_SYS_ADMIN
;

120 i‡(
	`ˇp_£t_Êag
(
myˇps
, 
CAP_EFFECTIVE
, 
nˇp
, 
ˇps2£t
, 
CAP_SET
) == -1) {

121 
	`ˇp_‰ì
(
myˇps
);

122 
	`FATAL
("cap_set_flag() failed,áborting...\n");

131 i‡(
›t
 == 1) {

132 
ˇps2£t
[0] = 
CAP_SYS_ADMIN
;

133 i‡(
	`ˇp_£t_Êag
(
myˇps
, 
CAP_EFFECTIVE
, 1, 
ˇps2£t
, 
CAP_CLEAR
)

135 
	`ˇp_‰ì
(
myˇps
);

136 
FATAL


148 i‡(
	`ˇp_£t_¥oc
(
myˇps
) == -1) {

149 
	`ˇp_‰ì
(
myˇps
);

150 
FATAL


152 (
›t
 == 1 ? "CAP_SETUID" : "CAP_SETUID,CAP_SYS_ADMIN"));

154 i‡(
›t
 == 1)

155 
	`¥ötf
("PID %6dÇow ha†CAP_SETUID c≠abûôy.\n", 
	`gëpid
());

156 i‡(
›t
 == 2)

157 
	`¥ötf
("PID %6dÇow has CAP_SETUID,CAP_SYS_ADMIN capability.\n",

158 
	`gëpid
());

160 
	`¥ötf
("Pausing #1 ...\n");

161 
	`∑u£
();

162 
	`ã°_£tuid
();

163 
	`ˇp_‰ì
(
myˇps
);

165 
¥ötf


167 
	`dr›_ˇps_be_n‹mÆ
();

168 
	`ã°_£tuid
();

170 
	`¥ötf
("Pausing #2 ...\n");

171 
	`∑u£
();

172 
	`¥ötf
(".. done,Éxiting.\n");

173 
	`exô
(
EXIT_SUCCESS
);

174 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch9/execl_eg.c

17 
	#_GNU_SOURCE


	)

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<°rög.h
>

21 
	~<uni°d.h
>

22 
	~<sys/ty≥s.h
>

23 
	~"../comm⁄.h
"

25 
	$maö
(
¨gc
, **
¨gv
)

27 i‡(
¨gc
 < 2) {

28 
	`Ârötf
(
°dîr
, "Usage: %s {-a|-r}\n"

31 , 
¨gv
[0]);

32 
	`exô
(
EXIT_FAILURE
);

36 i‡(
	`exe˛
("/bö/u«me", "u«me", 
¨gv
[1], (*)0) == -1)

37 
	`FATAL
("execl failed\n");

39 
	`¥ötf
("This shouldÇever getÉxecuted!\n");

40 
	`exô
 (
EXIT_SUCCESS
);

41 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch9/pdfrdr_exec.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<°rög.h
>

22 
	~<uni°d.h
>

23 
	~<sys/ty≥s.h
>

24 
	~"../comm⁄.h
"

29 c⁄° *
	gpdf_ªadî_≠p
="/usr/bin/evince";

31 
	$exec_pdf_ªadî_≠p
(*
pdfdoc
)

33 * c⁄° 
pdf_¨gv
[] = {"evö˚", 
pdfdoc
, 0};

35 i‡(
	`execv
(
pdf_ªadî_≠p
, 
pdf_¨gv
) < 0) {

36 
	`WARN
("execv failed\n");

40 
	}
}

42 
	$maö
(
¨gc
, **
¨gv
)

44 i‡(
¨gc
 < 2) {

45 
	`Ârötf
(
°dîr
, "Usage: %s {pathname_of_doc.pdf}\n"

46 , 
¨gv
[0]);

47 
	`exô
(
EXIT_FAILURE
);

50 i‡(
	`exec_pdf_ªadî_≠p
(
¨gv
[1]) < 0)

51 
	`FATAL
("execÖdf function failed\n");

53 
	`exô
 (
EXIT_SUCCESS
);

54 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch9/predcs_name.c

25 
	#_GNU_SOURCE


	)

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°rög.h
>

29 
	~<uni°d.h
>

30 
	~<î∫o.h
>

31 
	~<sys/ty≥s.h
>

32 
	~"../comm⁄.h
"

34 
	$maö
(
¨gc
, **
¨gv
)

36 *
îr
;

38 i‡(
¨gc
 < 2 ||árgc > 3) {

39 
	`Ârötf
(
°dîr
, "Usage: %s {successor_name} [do-it-right]\n",

40 
¨gv
[0]);

41 
	`exô
(
EXIT_FAILURE
);

44 i‡(
	`ac˚ss
(
¨gv
[1], 
R_OK
 | 
X_OK
) < 0) {

45 i‡(
î∫o
 =
ENOENT
)

46 
îr
 = "is missing;Ölease build itándÑetry.";

47 i‡(
î∫o
 =
EACCES
)

48 
îr
 =

51 
îr
 = ": [otherÉrror]";

52 
	`FATAL
("Suc˚ss‹ fûê\"%s\" %s\n", 
¨gv
[1], 
îr
);

67 i‡(
¨gc
 == 2) {

68 i‡(
	`exe˛
("./suc˚ss‹_£äm", 
¨gv
[1],árgv[1],

70 
	`FATAL
("execl \"successor_setnm\" 1 failed\n");

71 } i‡(
¨gc
 == 3) {

72 i‡(
	`exe˛
("./suc˚ss‹_£äm", 
¨gv
[2],árgv[1],

73 
¨gv
[2], (*)0) == -1)

74 
	`FATAL
("execl \"successor_setnm\" 2 failed\n");

76 
	`exô
(
EXIT_SUCCESS
);

77 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/ch9/successor_setnm.c

25 
	#_GNU_SOURCE


	)

26 
	~<°dio.h
>

27 
	~<°dlib.h
>

28 
	~<°rög.h
>

29 
	~<uni°d.h
>

30 
	~<sys/ty≥s.h
>

31 
	~<sys/¥˘l.h
>

32 
	~"../comm⁄.h
"

34 
	$maö
(
¨gc
, **
¨gv
)

36 
i
;

38 i‡(
¨gc
 < 2 ||árgc > 3) {

39 
	`Ârötf
(
°dîr
, "Usage: %s {successor_name}"

40 " [do-ô-right-∑øm]\n", 
¨gv
[0]);

41 
	`exô
(
EXIT_FAILURE
);

44 
	`¥ötf
("%s:∑ømëî†ª˚ived:\n", 
¨gv
[0]);

45 
i
=0; i<
¨gc
; i++)

46 
	`¥ötf
("¨gv[%d]=%s\n", 
i
, 
¨gv
[i]);

48 i‡(
¨gc
 == 3) {

49 
	`¥ötf
("%s: settingÇameÅo \"%s\" viaÖrctl(2)"

50 " [Right]\n", 
¨gv
[0],árgv[2]);

51 i‡(
	`¥˘l
(
PR_SET_NAME
, 
¨gv
[2], 0, 0, 0) < 0)

52 
	`FATAL
("prctl failed\n");

54 
	`¥ötf
("%s:áttemptÅo implicitly setÇameÅo \"%s\""

56 
¨gv
[0],árgv[1]);

59 
	`¥ötf
("%s:ÖausögÇow...\n", 
¨gv
[0]);

60 
	`∑u£
();

62 
	`exô
 (
EXIT_SUCCESS
);

63 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/common.c

17 
	#_GNU_SOURCE


	)

18 
	~"comm⁄.h
"

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<sig«l.h
>

22 
	~<°d¨g.h
>

23 
	~<uni°d.h
>

24 
	~<°rög.h
>

25 
	~<î∫o.h
>

40 #i‚de‡
_TIME_H


41 
	~<time.h
>

43 
	$r_¶ìp
(
time_t
 
£c
, 
n£c
)

45 
time•ec
 
ªq
, 
ªm
;

47 
ªq
.
tv_£c
 = 
£c
;

48 
ªq
.
tv_n£c
 = 
n£c
;

49 
	`«no¶ìp
(&
ªq
, &
ªm
) == -1) {

50 i‡(
î∫o
 !
EINTR
)

52 #ifde‡
DEBUG


57 
	`Ârötf
(
°dîr
,

59 
ªm
.
tv_£c
,Ñem.
tv_n£c
);

61 
ªq
 = 
ªm
;

64 
	}
}

70 
	$show_blocked_sig«ls
()

72 
sig£t_t
 
ﬁd£t
;

73 
i
, 
n⁄e
=1;

81 
	`sigem±y£t
(&
ﬁd£t
);

82 i‡(
	`sig¥ocmask
(
SIG_UNBLOCK
, 0, &
ﬁd£t
) < 0)

84 
	`¥ötf
("[SigBlk: ");

85 
i
=1; i<=64; i++) {

86 i‡(
	`sigismembî
(&
ﬁd£t
, 
i
)) {

87 
n⁄e
=0;

88 
	`¥ötf
("%d ", 
i
);

91 
	`¥ötf
("%s\n", 
n⁄e
 ? "-none-]" : "]");

92 
	`fÊush
(
°dout
);

94 
	}
}

96 
	$h™dÀ_îr
(
Áèl
, c⁄° *
fmt
, ...)

98 
	#ERRSTRMAX
 512

	)

99 *
îr_°r
;

100 
va_li°
 
¨gp
;

102 
îr_°r
 = 
	`mÆloc
(
ERRSTRMAX
);

103 i‡(
îr_°r
 =
NULL
)

106 
	`va_°¨t
(
¨gp
, 
fmt
);

107 
	`v¢¥ötf
(
îr_°r
, 
ERRSTRMAX
-1, 
fmt
, 
¨gp
);

108 
	`va_íd
(
¨gp
);

110 
	`Ârötf
(
°dîr
, "%s", 
îr_°r
);

111 i‡(
î∫o
) {

112 
	`Ârötf
(
°dîr
, " ");

113 
	`≥º‹
("kernel says");

116 
	`‰ì
(
îr_°r
);

117 i‡(!
Áèl
)

119 
	`exô
(
Áèl
);

120 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/common.h

17 #i‚de‡
__HOLSP_COMMON_H__


18 
	#__HOLSP_COMMON_H__


	)

20 #i‚de‡
_GNU_SOURCE


21 
	#_GNU_SOURCE


	)

25 
	~<°dio.h
>

26 
	~<uni°d.h
>

27 
	~<°dlib.h
>

31 
show_blocked_sig«ls
();

32 
h™dÀ_îr
(
Áèl
, c⁄° *
fmt
, ...);

33 
r_¶ìp
(
time_t
 
£c
, 
n£c
);

37 
	#NON_FATAL
 0

	)

39 
	#WARN
(
w¨nmsg
, 
¨gs
...) do { \

40 
	`h™dÀ_îr
(
NON_FATAL
, "!WARNING! %s:%s:%d: " 
w¨nmsg
, \

41 
__FILE__
, 
__func__
, 
__LINE__
, ##
¨gs
); \

42 } 0)

	)

43 
	#FATAL
(
îrmsg
, 
¨gs
...) do { \

44 
	`h™dÀ_îr
(
EXIT_FAILURE
, "FATAL:%s:%s:%d: " 
îrmsg
, \

45 
__FILE__
, 
__func__
, 
__LINE__
, ##
¨gs
); \

46 } 0)

	)

49 
ölöe
 
	$bìp
(
wh©
)

51 
buf
[1];

52 
buf
[0] = 
wh©
;

53 ()
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1);

54 
	}
}

61 
	#HZ
 250

	)

62 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

64 
c
=0, 
m
; \

65 
f‹_ödex
,
ö√r_ödex
; \

67 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

68 
	`bìp
((
vÆ
)); \

69 
c
++; \

70 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000;inner_index++) \

71 
m
=0;m<30;m++); \

74 }

	)

75 
	#DELAY_LOOP_SILENT
(
lo›_cou¡
) \

77 
c
=0, 
m
; \

78 
f‹_ödex
,
ö√r_ödex
; \

80 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

81 
c
++; \

82 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000;inner_index++) \

83 
m
=0;m<30;m++); \

86 }

	)

93 
	#VPRINT
(
msg
, 
¨gs
...) do { \

94 i‡(
gVîbo£
) \

95 
	`¥ötf
("%s:%s:%d: " 
msg
, \

96 
__FILE__
, 
__func__
, 
__LINE__
, ##
¨gs
); \

97 } 0)

	)

110 
	#timî•ecsub
(
a
, 
b
, 
ªsu…
) \

112 (
ªsu…
)->
tv_£c
 = (
a
)->tv_£¯- (
b
)->tv_sec; \

113 (
ªsu…
)->
tv_n£c
 = (
a
)->tv_n£¯- (
b
)->tv_nsec; \

114 i‡((
ªsu…
)->
tv_n£c
 < 0) { \

115 --(
ªsu…
)->
tv_£c
; \

116 (
ªsu…
)->
tv_n£c
 += 1000000000; \

118 } 0)

	)

121 
	#LOCK_MTX
(
mtx
) do { \

122 
ªt
=0; \

123 i‡((
ªt
 = 
	`±hªad_muãx_lock
(
mtx
))) \

124 
	`FATAL
("±hªad_muãx_lock faûed! [%d]\n", 
ªt
); \

125 } 0)

	)

127 
	#UNLOCK_MTX
(
mtx
) do { \

128 
ªt
=0; \

129 i‡((
ªt
 = 
	`±hªad_muãx_u∆ock
(
mtx
))) \

130 
	`FATAL
("±hªad_muãx_u∆ock faûed! [%d]\n", 
ªt
); \

131 } 0)

	)

	@Books/Hands-on-System-Programming-with-Linux/misc/simple_feature_test_macros.c

14 
	#_GNU_SOURCE


	)

16 
	~<°dio.h
>

17 
	~<°dlib.h
>

18 
	~<uni°d.h
>

19 
	~<sig«l.h
>

20 
	~<sys/ty≥s.h
>

21 
	~"../comm⁄.h
"

23 
	$maö
(
¨gc
, **
¨gv
)

25 
	`¥ötf
("C STD = %ldL\n", 
__STDC_VERSION__
);

26 i‡(
__STDC_VERSION__
 == 201112L)

27 
	`¥ötf
(" C11 [latest verás of date]\n");

29 
	`¥ötf
("=========== Simple Feature Test Macros ===========\n");

31 #ifde‡
_POSIX_C_SOURCE


32 
	`¥ötf
("_POSIX_C_SOURCE i†deföed : vÆuê%ldL\n", 
_POSIX_C_SOURCE
);

34 
	`¥ötf
("_POSIX_C_SOURCE is undefined\n");

37 #ifde‡
_POSIX_SOURCE


38 
	`¥ötf
("_POSIX_SOURCE i†deföed : vÆuê%d\n", 
_POSIX_SOURCE
);

40 
	`¥ötf
("_POSIX_SOURCE is undefined\n");

43 #ifde‡
__STRICT_ANSI__


44 
	`¥ötf
("__STRICT_ANSI__ i†deföed : vÆuê%d\n", 
__STRICT_ANSI__
);

46 
	`¥ötf
("__STRICT_ANSI__ is undefined\n");

49 #ifde‡
_XOPEN_SOURCE


50 
	`¥ötf
("_XOPEN_SOURCE i†deföed : vÆuê%d\n", 
_XOPEN_SOURCE
);

52 
	`¥ötf
("_XOPEN_SOURCE is undefined\n");

55 #ifde‡
_XOPEN_SOURCE_EXTENDED


56 
	`¥ötf
("_XOPEN_SOURCE_EXTENDED i†deföed : vÆuê%d\n", 
_XOPEN_SOURCE_EXTENDED
);

58 
	`¥ötf
("_XOPEN_SOURCE_EXTENDED is undefined\n");

61 #ifde‡
_ISOC99_SOURCE


62 
	`¥ötf
("_ISOC99_SOURCE i†deföed : vÆuê%d\n", 
_ISOC99_SOURCE
);

64 
	`¥ötf
("_ISOC99_SOURCE is undefined\n");

67 #ifde‡
_ISOC11_SOURCE


68 
	`¥ötf
("_ISOC11_SOURCE i†deföed : vÆuê%d\n", 
_ISOC11_SOURCE
);

70 
	`¥ötf
("_ISOC11_SOURCE is undefined\n");

73 #ifde‡
_LARGEFILE64_SOURCE


74 
	`¥ötf
("_LARGEFILE64_SOURCE i†deföed : vÆuê%d\n", 
_LARGEFILE64_SOURCE
);

76 
	`¥ötf
("_LARGEFILE64_SOURCE is undefined\n");

79 #ifde‡
_LARGEFILE_SOURCE


80 
	`¥ötf
("_LARGEFILE_SOURCE i†deföed : vÆuê%d\n", 
_LARGEFILE_SOURCE
);

82 
	`¥ötf
("_LARGEFILE_SOURCE is undefined\n");

85 #ifde‡
_FILE_OFFSET_BITS


86 
	`¥ötf
("_FILE_OFFSET_BITS i†deföed : vÆuê%d\n", 
_FILE_OFFSET_BITS
);

88 
	`¥ötf
("_FILE_OFFSET_BITS is undefined\n");

91 #ifde‡
_BSD_SOURCE


92 
	`¥ötf
("_BSD_SOURCE i†deföed : vÆuê%d\n", 
_BSD_SOURCE
);

94 
	`¥ötf
("_BSD_SOURCE is undefined\n");

97 #ifde‡
_SVID_SOURCE


98 
	`¥ötf
("_SVID_SOURCE i†deföed : vÆuê%d\n", 
_SVID_SOURCE
);

100 
	`¥ötf
("_SVID_SOURCE is undefined\n");

103 #ifde‡
_DEFAULT_SOURCE


104 
	`¥ötf
("_DEFAULT_SOURCE i†deföed : vÆuê%d\n", 
_DEFAULT_SOURCE
);

106 
	`¥ötf
("_DEFAULT_SOURCE is undefined\n");

109 #ifde‡
_ATFILE_SOURCE


110 
	`¥ötf
("_ATFILE_SOURCE i†deföed : vÆuê%d\n", 
_ATFILE_SOURCE
);

112 
	`¥ötf
("_ATFILE_SOURCE is undefined\n");

115 #ifde‡
_GNU_SOURCE


116 
	`¥ötf
("_GNU_SOURCE is defined\n");

118 
	`¥ötf
("_GNU_SOURCE is undefined\n");

121 #ifde‡
_REENTRANT


122 
	`¥ötf
("[Obsﬁëe] _REENTRANT i†deföed : vÆuê%d\n", 
_REENTRANT
);

124 
	`¥ötf
("_REENTRANT is undefined\n");

127 #ifde‡
_THREAD_SAFE


128 
	`¥ötf
("[Dïªˇãd] _THREAD_SAFE i†deföed : vÆuê%d\n", 
_THREAD_SAFE
);

130 
	`¥ötf
("_THREAD_SAFE is undefined\n");

133 #ifde‡
_FORTIFY_SOURCE


134 
	`¥ötf
("_FORTIFY_SOURCE i†deföed : vÆuê%d\n", 
_FORTIFY_SOURCE
);

136 
	`¥ötf
("_FORTIFY_SOURCE is undefined\n");

139 #ifde‡
__SI_HAVE_SIGSYS


140 
	`¥ötf
("Sig«»SIGSYS i†deföed : vÆuê%d\n", 
SIGSYS
);

142 
	`¥ötf
("Signal SIGSYS is undefined\n");

145 
	`exô
 (
EXIT_SUCCESS
);

146 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/A_fileio/redirct2.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<sig«l.h
>

22 
	~<°rög.h
>

23 
	~<uni°d.h
>

24 
	~"../../comm⁄.h
"

26 
	$maö
(
¨gc
, **
¨gv
)

28 
FILE
 *
Âlog
=
NULL
, *
pÂ
=NULL, *
Â
=NULL;

29 
	#DTMAX
 256

	)

30 
dt
[
DTMAX
];

31 *
junk
="abcxyz";

33 i‡(
¨gc
 != 2) {

34 
	`Ârötf
(
°dîr
, "Ußge: %†logfûe\n", 
¨gv
[0]);

35 
	`exô
(
EXIT_FAILURE
);

39 
Âlog
 = 
	`‰e›í
(
¨gv
[1], "a", 
°dout
);

40 i‡(!
Âlog
)

41 
	`FATAL
("‰e›í stdouà⁄ %†Áûed\n", 
¨gv
[1]);

43 
Âlog
 = 
	`‰e›í
(
¨gv
[1], "a", 
°dîr
);

44 i‡(!
Âlog
)

45 
	`FATAL
("‰e›í stdî∏⁄ %†Áûed\n", 
¨gv
[1]);

48 i‡(!(
pÂ
 = 
	`p›í
("date", "r")))

49 
	`FATAL
("popen (date) failed\n");

50 i‡(!
	`fgës
(
dt
, 
DTMAX
, 
pÂ
)) {

51 
	`WARN
("fgets (date) failed\n");

52 
	`°∫˝y
(
dt
, "---", 4);

54 
dt
[
	`°æí
(dt)-1]='\0';

55 
	`p˛o£
(
pÂ
);

58 
	`¥ötf
("%s:%s:cuºíà£ekÖosôi⁄: %ld\n", 
¨gv
[0], 
dt
, 
	`·ñl
(
Âlog
));

62 
	`fÊush
(
Âlog
);

63 
	`fÊush
(
°dout
);

65 i‡(
	`fsync
(
	`fûío
(
Âlog
)) < 0)

66 
	`WARN
("fsync 1 failed\n");

67 i‡(
	`fsync
(
	`fûío
(
°dout
)) < 0)

68 
	`WARN
("fsync 2 failed\n");

71 i‡(!(
Â
 = 
	`f›í
(
junk
, "r"))) {

72 
	`Ârötf
(
°dîr
, "\n%s:%s:f›í o¿%†Áûed\n", 
¨gv
[0], 
dt
, 
junk
);

73 
	`≥º‹
(" fopen");

74 
	`f˛o£
(
Âlog
);

75 
	`exô
(
EXIT_SUCCESS
);

78 
	`f˛o£
(
Â
);

79 
	`f˛o£
(
Âlog
);

80 
	`exô
(
EXIT_SUCCESS
);

81 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch1/getreg_cr2.c

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<°dlib.h
>

23 
	tu64
;

25 
u64
 
	$gë_¸2
()

29 
__asm__
 
	`__vﬁ©ûe__
("movq %cr2, %rax");

31 
	}
}

33 
	$maö
()

35 
	`¥ötf
("Hñlo, i∆öêas£mbly:\¿[CR2] = 0x%lx\n", 
	`gë_¸2
());

36 
	`exô
(0);

37 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/fork2c.c

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

35 
	~<uni°d.h
>

36 
	~<sys/ty≥s.h
>

37 
	~<sys/waô.h
>

38 
	~"../../comm⁄.h
"

40 
	$di•œyChûdSètus
(
°©
, 
pid_t
 
˝id
)

42 
	`¥ötf
("\nChild %d just died!\n"

51 
˝id
,

52 
	`WIFEXITED
(
°©
),

53 
	`WEXITSTATUS
(
°©
),

54 
	`WIFSIGNALED
(
°©
),

55 
	`WTERMSIG
(
°©
),

56 
	`WIFSTOPPED
(
°©
),

57 
	`WSTOPSIG
(
°©
), 
	`WCOREDUMP
(°©), 
	`WIFCONTINUED
(stat)

59 
	}
}

61 
	$¸óãChûd
(
¶ìp_time
)

63 
pid_t
 
n
;

65 
n
 = 
	`f‹k
()) {

67 
	`≥º‹
("fork");

68 
	`exô
(1);

70 
	`¥ötf
("Chûd 2 PID %d sÀïög f‹ %ds...\n", 
	`gëpid
(),

71 
¶ìp_time
);

72 
	`¶ìp
(
¶ìp_time
);

73 
	`exô
(0);

76 
	}
}

78 
	$chkønge
(
num
, 
mö
, 
max
)

80 i‡(
num
 < 
mö
)

82 i‡(
num
 > 
max
)

85 
	}
}

87 
	$maö
(
¨gc
, **
¨gv
)

89 
°©
 = 0;

90 
c1_¶±m
 = 3, 
c2_¶±m
 = 7;

91 
pid_t
 
n
, 
˝id
;

93 i‡(
¨gc
 == 3) {

94 
c1_¶±m
 = 
	`©oi
(
¨gv
[1]);

95 i‡(
	`chkønge
(
c1_¶±m
, 1, 60) < 0) {

96 
	`Ârötf
(
°dîr
,

98 "Ñ™gê[1-60]\n", 
¨gv
[0], 
c1_¶±m
);

99 
	`exô
(
EXIT_FAILURE
);

101 
c2_¶±m
 = 
	`©oi
(
¨gv
[2]);

102 i‡(
	`chkønge
(
c2_¶±m
, 1, 60) < 0) {

103 
	`Ârötf
(
°dîr
,

105 "Ñ™gê[1-60]\n", 
¨gv
[0], 
c2_¶±m
);

106 
	`exô
(
EXIT_FAILURE
);

110 
n
 = 
	`f‹k
()) {

112 
	`≥º‹
("fork");

113 
	`exô
(1);

115 
	`¥ötf
("Chûd 1 PID %d sÀïög f‹ %ds...\n", 
	`gëpid
(),

116 
c1_¶±m
);

117 
	`¶ìp
(
c1_¶±m
);

118 
	`exô
(
EXIT_SUCCESS
);

120 
	`¸óãChûd
(
c2_¶±m
);

122 (
˝id
 = 
	`waô
(&
°©
)) != -1) {

123 
	`di•œyChûdSètus
(
°©
, 
˝id
);

126 
	`¥ötf
("\nParent:áll children dead,Éxiting...\n");

127 
	`exô
(
EXIT_SUCCESS
);

128 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/forkbomb.c

37 
	#_GNU_SOURCE


	)

38 
	~<°dio.h
>

39 
	~<°dlib.h
>

40 
	~<°rög.h
>

41 
	~<uni°d.h
>

42 
	~<sys/ty≥s.h
>

43 
	~<sys/time.h
>

44 
	~<sys/ªsour˚.h
>

45 
	~"../../comm⁄.h
"

47 
	#ONE_GB
 (1024*1024*1024)

	)

49 
	$£tup_æimôs
(
æim_t
 
≈rocs
,Ñlim_à
d©a£g
)

51 
æimô
 
æim_√w
, 
æim_ﬁd
;

55 
æim_√w
.
æim_cur
 =Ñlim_√w.
æim_max
 = (
æim_t
Ë
≈rocs
;

56 i‡(
	`¥limô
(0, 
RLIMIT_NPROC
, &
æim_√w
, &
æim_ﬁd
) == -1) {

57 
	`WARN
("prlimit(2):Çprocs failed\n");

60 
	`¥ötf
(

62 
æim_√w
.
æim_cur
,Ñlim_√w.
æim_max
,

63 
æim_ﬁd
.
æim_cur
,Ñlim_ﬁd.
æim_max
);

66 
æim_√w
.
æim_cur
 =Ñlim_√w.
æim_max
 = (
æim_t
Ë
d©a£g
;

67 i‡(
	`¥limô
(0, 
RLIMIT_DATA
, &
æim_√w
, &
æim_ﬁd
) == -1) {

68 
	`WARN
("prlimit(2):Çprocs failed\n");

71 
	`¥ötf
(

73 
æim_√w
.
æim_cur
,Ñlim_√w.
æim_max
,

74 
æim_ﬁd
.
æim_cur
,Ñlim_ﬁd.
æim_max
);

76 
	}
}

78 
	$maö
(
¨gc
, **
¨gv
)

80 
æim_t
 
maxèsks
=0;

81 
num
=0, 
i
 = 1, 
j
=0;

82 
pid_t
 
˝id
;

83 *
p
;

84 
size_t
 
sz
 = 8 * 
	`gë∑gesize
();

86 i‡(
¨gc
 != 3) {

87 
out_ußge
:

88 
	`Ârötf
(
°dîr
, "Usage: %s max-limit-on-tasksÇum ;\n"

91 
¨gv
[0]);

92 
	`exô
(
EXIT_FAILURE
);

95 
maxèsks
 = 
	`©oi
(
¨gv
[1]);

96 i‡(
maxèsks
 < 1)

97 
out_ußge
;

98 
num
 = 
	`©oi
(
¨gv
[1]);

99 i‡(
num
 < 1)

100 
out_ußge
;

102 
	`¥ötf
("--- P¨íàPID [%d]\n", 
	`gëpid
());

103 
	`£tup_æimôs
(
num
, 
ONE_GB
);

105 
	`¥ötf
("\n--- Children :: \n");

106 
i
 <
num
) {

107 i‡((
˝id
 = 
	`f‹k
()) < 0) {

108 i‡(
i
 == 1)

109 
	`Ârötf
(
°dîr
,

111 
	`FATAL
("f‹k(ËÁûed: i=%d\n", 
i
);

113 
p
 = 
	`mÆloc
(
sz
);

114 
	`mem£t
(
p
, 0, 
sz
);

116 
	`¥ötf
("%9d: P %9d C %9d\n", 
i
++, 
	`gëpid
(), 
˝id
);

119 
	#COLS
 80

	)

120 
j
=0;

121 i‡(
˝id
) {

122 
j
=0; j<
i
%
COLS
/2; j++)

123 
	`¥ötf
(" ");

124 
	`¥ötf
("| [i=%6d, PID %6d]\n", 
i
, 
	`gëpid
());

128 i‡(
˝id
)

129 
	`¶ìp
(2628000);

130 
i
 ++;

133 
	`exô
(
EXIT_SUCCESS
);

134 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/pdf_rdr.c

23 
	#_GNU_SOURCE


	)

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

27 
	~<uni°d.h
>

28 
	~<sys/ty≥s.h
>

29 
	~<sys/waô.h
>

30 
	~"../../comm⁄.h
"

35 c⁄° *
	gpdf_ªadî_≠p
="/usr/bin/evince";

36 
	ggVîbo£
 = 1;

39 
	$öãΩªt_waô
(
pid_t
 
chûd
, 
w°©us
)

41 
ex°©
=0;

43 
	`VPRINT
("Chûd (PID %7dË°©u†ch™ged:\n", 
chûd
);

47 i‡(
	`WIFEXITED
(
w°©us
)) {

48 
ex°©
 = 
	`WEXITSTATUS
(
w°©us
);

49 
	`VPRINT
("Ç‹mÆÅîmö©i⁄:Éxô sètus: %d\n", 
ex°©
);

50 i‡(
ex°©
 == 0)

51 
	`VPRINT
(" childÉxited with success!\n");

53 
	`VPRINT
(" chûd faûed; faûedÉxô sètu†%d\n", 
ex°©
);

55 i‡(
	`WIFSIGNALED
(
w°©us
)) {

56 
	`VPRINT
("ábnormalÅermination: killer signal: %d",

57 
	`WTERMSIG
(
w°©us
));

58 i‡(
	`WCOREDUMP
(
w°©us
))

59 
	`VPRINT
(" : core dumped\n");

61 
	`VPRINT
("\n");

63 i‡(
	`WIFSTOPPED
(
w°©us
))

64 
	`VPRINT
(" stopped: stop signal: %d\n",

65 
	`WSTOPSIG
(
w°©us
));

66 i‡(
	`WIFCONTINUED
(
w°©us
))

67 
	`VPRINT
(" (was stopped),Ñesumed (SIGCONT)\n");

68 
	}
}

70 
	$exec_pdf_ªadî_≠p
(*
pdfdoc
)

72 * c⁄° 
pdf_¨gv
[] = {"evö˚", 
pdfdoc
, 0};

74 i‡(
	`execv
(
pdf_ªadî_≠p
, 
pdf_¨gv
) < 0) {

75 
	`WARN
("execv failed\n");

79 
	}
}

81 
	$maö
(
¨gc
, **
¨gv
)

83 
w°©
=0;

84 
pid_t
 
˝id
;

86 i‡(
¨gc
 < 2) {

87 
	`Ârötf
(
°dîr
, "Usage: %s {pathname_of_doc.pdf}\n"

88 , 
¨gv
[0]);

89 
	`exô
(
EXIT_FAILURE
);

93 
	`f‹k
()) {

94 -1 : 
	`FATAL
("fork failed\n");

95 
	`exô
(
EXIT_FAILURE
);

97 
	`¥ötf
("Child %d:ÇowÉxec-ing '%s %s'\n",

98 
	`gëpid
(), 
pdf_ªadî_≠p
, 
¨gv
[1]);

99 i‡(
	`exec_pdf_ªadî_≠p
(
¨gv
[1]) < 0)

100 
	`FATAL
("execÖdf function failed\n");

102 
	`¥ötf
("Parent %d: waitingÅo clearÅhe zombie...\n",

103 
	`gëpid
());

106 i‡((
˝id
 = 
	`waô
(&
w°©
)) < 0)

107 
	`FATAL
("wait(2) failed,áborting..\n");

108 
	`öãΩªt_waô
(
˝id
, 
w°©
);

111 
	`exô
 (
EXIT_SUCCESS
);

112 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/smallbomb.c

76 
	#_GNU_SOURCE


	)

77 
	~<°dio.h
>

78 
	~<°dlib.h
>

79 
	~<uni°d.h
>

80 
	~<sys/ty≥s.h
>

81 
	~"../../comm⁄.h
"

83 
	#FORK_AND_PRINT
 do { \

84 i‡(
	`f‹k
() < 0) \

85 
	`FATAL
("PID %d: f‹k faûed\n", 
	`gëpid
()); \

86 
	`¥ötf
("PID %d\n", 
	`gëpid
()); \

87 
	`fÊush
(
°dout
); \

88 } 0)

	)

90 
	$maö
(
¨gc
, **
¨gv
)

92 
FORK_AND_PRINT
;

93 
FORK_AND_PRINT
;

94 
FORK_AND_PRINT
;

96 
	`∑u£
();

98 
	`exô
 (
EXIT_SUCCESS
);

99 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/zombie.c

52 
	~<°dio.h
>

53 
	~<uni°d.h
>

54 
	~<sys/ty≥s.h
>

55 
	~<°dlib.h
>

56 
	~"../../comm⁄.h
"

58 
	$maö
(
¨gc
, **
¨gv
)

60 
pid_t
 
p
;

62 
p
 = 
	`f‹k
();

63 
p
) {

65 
	`FATAL
("fork failed\n");

67 
¥ötf


69 
	`gëpid
(), 
p
);

70 
	`exô
(
EXIT_SUCCESS
);

72 
	`¥ötf
("ParentÖid %d :Ö=%d; sleepingÇow for 300s without"

73 "waô()-ög (ªsu…ög i¿®zombõ!)..\n", 
	`gëpid
(), 
p
);

74 
	`¶ìp
(300);

75 
	`¥ötf
("Parent: sleep done,Éxiting. Notice how (on Linux)Åhe"

77 
	`exô
(
EXIT_SUCCESS
);

79 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch11/atomic_A.c

30 
	#_GNU_SOURCE


	)

31 
	~<°dio.h
>

32 
	~<°dlib.h
>

33 
	~<uni°d.h
>

34 
	~<°rög.h
>

35 
	~<sig«l.h
>

36 
	~<sys/ty≥s.h
>

37 
	~"../../comm⁄.h
"

39 
	$foo
(
ch
)

41 
	`DELAY_LOOP
(
ch
, 220);

42 
	}
}

44 
	$maö
(
¨gc
, **
¨gv
)

46 
pid_t
 
¥o˚ssB
=0;

48 i‡(
¨gc
 != 3) {

49 
	`Ârötf
(
°dîr
, "Ußge: %†ch¨-to-emô PID-of-¥o˚ss-©omicB\n", 
¨gv
[0]);

50 
	`exô
(
EXIT_FAILURE
);

52 i‡(
	`°æí
(
¨gv
[1]) > 1) {

53 
	`Ârötf
(
°dîr
, "Usage: %s char-to-emit\n"

55 
¨gv
[0]);

56 
	`exô
(
EXIT_FAILURE
);

59 
¥o˚ssB
 = 
	`©oi
(
¨gv
[2]);

61 i‡(
	`kûl
(
¥o˚ssB
, 0) < 0)

62 
	`FATAL
("kûl: PID %d i†övÆid o∏≥rm issue,áb‹tög...\n", 
¥o˚ssB
);

64 
	`foo
(
¨gv
[1][0]);

67 i‡(
	`kûl
(
¥o˚ssB
, 
SIGUSR1
) < 0)

68 
	`FATAL
("kill: sending SIGUSR1ÅoÖrocess B failed\n");

70 
	`exô
 (
EXIT_SUCCESS
);

71 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch11/atomic_B.c

31 
	#_GNU_SOURCE


	)

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~<uni°d.h
>

35 
	~<°rög.h
>

36 
	~<sig«l.h
>

37 
	~<sys/ty≥s.h
>

38 
	~"../../comm⁄.h
"

40 
	#SLEEP_SEC
 5

	)

41 vﬁ©ûê
sig_©omic_t
 
	ggFœg
 = 0;

43 
	$h™dÀ_sigs
(
signum
, 
sigöfo_t
 * 
öfo
, * 
r°
)

45 
gFœg
 = 1;

46 
	}
}

48 
	$maö
(
¨gc
, **
¨gv
)

50 
siga˘i⁄
 
siga˘
;

52 
	`mem£t
(&
siga˘
, 0, (sigact));

53 
siga˘
.
ß_siga˘i⁄
 = 
h™dÀ_sigs
;

54 
siga˘
.
ß_Êags
 = 
SA_SIGINFO
 | 
SA_NOCLDSTOP
;

55 i‡(
	`siga˘i⁄
(
SIGUSR1
, &
siga˘
, 0) < 0)

56 
	`FATAL
("sigaction on SIGUSR1 failed");

58 
	`¥ötf
("%s:%dÅrapped SIGUSR1, blockingÇow ...\n",

59 
¨gv
[0], 
	`gëpid
());

63 
	`¥ötf
(" *%d* ", 
gFœg
);

64 
	`fÊush
(
°dout
);

65 
	`¶ìp
(
SLEEP_SEC
);

67 
	`exô
 (
EXIT_SUCCESS
);

68 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch11/donthup.c

23 
	#_GNU_SOURCE


	)

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<uni°d.h
>

27 
	~<sys/ty≥s.h
>

28 
	~<°rög.h
>

29 
	~<sig«l.h
>

30 
	~"../../comm⁄.h
"

33 
	$siggy
(
signum
)

35 c⁄° *
°r0
 = "*** siggy: handled SIGHUP ***\n";

36 c⁄° *
°r1
 = "*** siggy: handled SIGINT ***\n";

37 c⁄° *
°r2
 = "*** siggy: handled SIGQUIT ***\n";

39 
signum
) {

40 
SIGHUP
:

41 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r0
, 
	`°æí
(str0)) < 0)

42 
	`WARN
("write str0 failed!");

44 
SIGINT
:

45 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r1
, 
	`°æí
(str1)) < 0)

46 
	`WARN
("write str1 failed!");

48 
SIGQUIT
:

49 i‡(
	`wrôe
(
STDOUT_FILENO
, 
°r2
, 
	`°æí
(str2)) < 0)

50 
	`WARN
("write str2 failed!");

53 
	}
}

55 
	$maö
()

57 
i
 = 1;

58 
siga˘i⁄
 
a˘
;

64 
	`mem£t
(&
a˘
, 0, (act));

65 
a˘
.
ß_h™dÀr
 = 
siggy
;

66 i‡(
	`siga˘i⁄
(
SIGHUP
, &
a˘
, 0) < 0)

67 
	`FATAL
("sigaction on SIGINT failed");

68 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) < 0)

69 
	`FATAL
("sigaction on SIGINT failed");

70 i‡(
	`siga˘i⁄
(
SIGQUIT
, &
a˘
, 0) < 0)

71 
	`FATAL
("sigaction on SIGQUIT failed");

74 
	`¥ötf
("Lo›ög, iãøti⁄ #%02ld ...\n", 
i
++);

75 ()
	`¶ìp
(1);

78 
	`exô
(
EXIT_SUCCESS
);

79 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch12/killer.c

26 
	~<sig«l.h
>

27 
	~<°dio.h
>

28 
	~<uni°d.h
>

29 
	~<sys/ty≥s.h
>

30 
	~<sys/waô.h
>

31 
	~<°rög.h
>

32 
	~<°dlib.h
>

33 
	~"../../comm⁄.h
"

38 
	$ˇtchô
(
signo
)

40 i‡(
signo
 =
SIGINT
) {

41 
¥ötf


43 
	`gëpid
());

44 
	`exô
(0);

46 
	`¥ötf
("catchit:Érror, handler for SIGINT only\n");

47 
	}
}

49 
	$maö
(
¨gc
, **
¨gv
)

51 
pid_t
 
pid
, 
n
;

52 
siga˘i⁄
 
a˘
;

54 
	`mem£t
(&
a˘
, 0, (act));

55 
a˘
.
ß_h™dÀr
 = 
ˇtchô
;

56 
	`sigem±y£t
(&
a˘
.
ß_mask
);

57 
a˘
.
ß_Êags
 = 
SA_RESTART
;

59 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) == -1) {

60 
	`≥º‹
("killer: sigaction failed.");

61 
	`exô
(1);

64 (
pid
 = 
	`f‹k
())) {

66 
	`≥º‹
("fork failed");

67 
	`exô
(1);

69 ()
	`∑u£
();

70 
	`exô
(0);

72 
	`¥ötf
("∑ª¡ i†%d, chûd i†%d\n", 
	`gëpid
(), 
pid
);

73 ()
	`¶ìp
(1);

75 i‡(
	`kûl
(
pid
, 0) == 0) {

77 i‡(
	`kûl
(
pid
, 
SIGINT
) == -1) {

78 
	`≥º‹
("kill failed");

79 
	`exô
(1);

83 i‡((
n
 = 
	`waô
(0)) == -1) {

84 
	`≥º‹
("wait failed");

85 
	`exô
(1);

87 
	`¥ötf
("parent %d: childÖrocess fetched, wait "

88 "ªtu∫ed %d\n", 
	`gëpid
(), 
n
);

91 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch12/murder.c

19 
	#_GNU_SOURCE


	)

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<uni°d.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<°rög.h
>

25 
	~<sig«l.h
>

26 
	~<limôs.h
>

27 
	~"../../comm⁄.h
"

29 
	gvîbo£
=1;

31 
	$gë_pid_max
()

33 
FILE
 *
Â
;

34 
ªs
[16];

38 
Â
 = 
	`p›í
("cat /proc/sys/kernel/pid_max", "r");

39 i‡(!
Â
) {

40 
	`p˛o£
(
Â
);

43 i‡((
	`fgës
(
ªs
, 16, 
Â
Ë=
NULL
)) {

44 
	`p˛o£
(
Â
);

47 
	`p˛o£
(
Â
);

49  
	`°πoul
(
ªs
, 0, 10);

50 
	}
}

52 
	$maö
(
¨gc
, **
¨gv
)

54 
pid_t
 
i
;

55 
pid_max
 = 
	`gë_pid_max
();

57 i‡(!
pid_max
)

58 
pid_max
 = 32768;

60 
	`¥ötf
("!WARNING! ThisÇaughtyÖrocessÇamed %s intendsÅo\n"

62 
¨gv
[0], 
pid_max
);

63 i‡(
	`gëeuid
() == 0)

64 
	`¥ötf
("*** !!!EXTRA WARNING!!! Runningás superuser! ***\n\n");

65 
	`¥ötf
("Press [Enter]Åo continue, ^CÅoábortÇow ...\n");

66 
	`fgëc
(
°dö
);

68 i‡(
vîbo£
)

69 
	`sy°em
("ps -e");

71 
	`¥ötf
("Fair Warning given,ÖroceedingÅo murder ...\n");

72 
i
=1; i<
pid_max
; i++) {

73 i‡(
	`kûl
 (
i
, 0) < 0)

75 i‡(
vîbo£
)

76 
	`¥ötf
(" SIGKILL -> %6d : ", 
i
);

77 i‡(
	`kûl
 (
i
, 
SIGKILL
) < 0)

78 
	`¥ötf
(" [FAILED]\n");

80 i‡(
vîbo£
)

81 
	`¥ötf
(" [OK]\n");

85 
	`exô
(
EXIT_SUCCESS
);

86 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch12/segv_altstack.c

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<sig«l.h
>

26 
	~<°rög.h
>

27 
	~<sys/fûe.h
>

28 
	~"../../comm⁄.h
"

30 
	#APPNAME
 "£gv_Æt°ack"

	)

32 
	tu32
;

33 
	tu64
;

35 
	#MAX
 9

	)

36 #i‡
__x86_64__


37 
	#ADDR_TYPE
 
u64


	)

38 
	#ADDR_FMT
 "%016lx"

	)

40 
	#ADDR_TYPE
 
u32


	)

41 
	#ADDR_FMT
 "%08lx"

	)

44 vﬁ©ûê
sig_©omic_t
 
	gs
=0, 
	gt
=0;

45 vﬁ©ûê
	g°k_°¨t
=0, 
	g°k
=0;

52 *
	$°ack
()

54 i‡(
__WORDSIZE
 == 32) {

55 
	`__asm__
("movl %esp, %eax");

56 } i‡(
__WORDSIZE
 == 64) {

57 
	`__asm__
("movq %rsp, %rax");

60 
	}
}

67 
	$sighdÃ
(
signum
)

69 i‡(
t
 == 0)

70 
°k_°¨t
 = ()
	`°ack
();

72 
signum
) {

73 
SIGUSR1
:

74 
°k
 = ()
	`°ack
();

75 
s
 ++; 
t
 ++;

76 i‡(
s
 >
MAX
)

77 
s
 = 1;

78 
	`Ârötf
(
°dîr
, " s=%d ;ÅŸÆ=%d; sèck %p\n", 
s
, 
t
, 
	`°ack
());

80 
	`DELAY_LOOP_SILENT
(5);

82 
SIGUSR2
:

83 
	`Ârötf
(
°dîr
, "*** signal %d:: stack@:Å0=%lxÜast=%lx : delta=%ld ***\n",

84 
signum
, 
°k_°¨t
, 
°k
, (stk_start-stk));

87 
	}
}

89 
	$Áèl_sig_h™dÀr
(
signum
, 
sigöfo_t
 *
si
, *
uc⁄ãxt
)

91 
signum
) {

92 
SIGSEGV
:

93 
	`Ârötf
(
°dîr
,

97 
APPNAME
, 
signum
, 
°k_°¨t
, 
°k
, (°k_°¨t-°k), 
t
);

98 
	`Ârötf
(
°dîr
, " Fau…ög in¢/mem‹yáddªss: %p\n", 
si
->
si_addr
);

99 
	`Ârötf
(
°dîr
, " Origin: ");

100 
si
->
si_code
) {

101 
SEGV_MAPERR
:

102 
	`Ârötf
(
°dîr
, "SEGV_MAPERR : AddressÇot mappedÅo object.\n");

104 
SEGV_ACCERR
:

105 
	`Ârötf
(
°dîr
, "SEGV_ACCERR : InvalidÖermissions for mapped object.\n");

108 
SEGV_BNDERR
:

109 
	`Ârötf
(
°dîr
, " SEGV_BNDERR : Failedáddress bound checks..\n");

111 
SEGV_PKUERR
:

112 
	`Ârötf
(
°dîr
, " SEGV_PKUERR : Access was denied by memoryÖrotection keys.\n");

116 
	`Ârötf
(
°dîr
,

122 i‡(
	`sig«l
(
SIGSEGV
, 
SIG_DFL
Ë=
SIG_ERR
)

123 
	`FATAL
("signal -reverting SIGSEGVÅo default- failed");

124 i‡(
	`øi£
(
SIGSEGV
))

125 
	`FATAL
("raise SIGSEGV failed");

128 
	}
}

130 
	$£tup_Ætsig°ack
(
size_t
 
°ack_sz
)

132 
°ack_t
 
ss
;

134 
	`¥ötf
("A… sig«»°ack sizê%zu\n", 
°ack_sz
);

135 
ss
.
ss_•
 = 
	`mÆloc
(
°ack_sz
);

136 i‡(!
ss
.
ss_•
)

137 
	`FATAL
("mÆloc(%zuËf‹á… sig sèck faûed\n", 
°ack_sz
);

138 
ss
.
ss_size
 = 
°ack_sz
;

139 
ss
.
ss_Êags
 = 0;

140 i‡(
	`sigÆt°ack
(&
ss
, 
NULL
) == -1)

141 
	`FATAL
("sigÆt°ack f‹ sizê%zu faûed!\n", 
°ack_sz
);

142 
	}
}

144 
	$sig«l_öô
(*
°r_size
)

146 
size_t
 
Æt°acksz
=0;

147 
siga˘i⁄
 
a˘
;

149 
Æt°acksz
 = 
	`©oi
(
°r_size
)*1024;

150 
	`£tup_Ætsig°ack
(
Æt°acksz
);

152 
	`mem£t
(&
a˘
, 0, (act));

153 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

154 
a˘
.
ß_Êags
 = 
SA_NODEFER
 | 
SA_ONSTACK
 | 
SA_RESTART
;

160 
	`sigfûl£t
(&
a˘
.
ß_mask
);

162 i‡(
	`siga˘i⁄
(
SIGUSR1
, &
a˘
, 0) == -1)

163 
	`FATAL
("sigaction SIGUSR1 failed\n");

166 
	`mem£t
(&
a˘
, 0, (act));

167 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

168 
a˘
.
ß_Êags
 = 
SA_RESTART
;

169 
	`sigfûl£t
(&
a˘
.
ß_mask
);

170 i‡(
	`siga˘i⁄
(
SIGUSR2
, &
a˘
, 0) == -1)

171 
	`FATAL
("sigaction SIGUSR2 failed\n");

177 
	`mem£t
(&
a˘
, 0, (act));

178 
a˘
.
ß_siga˘i⁄
 = 
Áèl_sig_h™dÀr
;

179 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_ONSTACK
 | 
SA_SIGINFO
;

180 
	`sigfûl£t
(&
a˘
.
ß_mask
);

181 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1)

182 
	`FATAL
("sigaction SIGSEGV failed\n");

183 
	}
}

185 
	$bug1
()

187 
ADDR_TYPE
 *
±r
 = &
bug1
;

188 
	`¥ötf
("%s:%s: bug1=%p\n"

190 
__FILE__
, 
__func__
, 
bug1
);

191 *(
±r
) = 0x2A;

192 
	}
}

194 
	$maö
(
¨gc
, **
¨gv
)

196 i‡(
¨gc
 != 2) {

197 
	`Ârötf
(
°dîr
, "Usage: %s {alternate-signal-stack-size-in-KB}\n",

198 
¨gv
[0]);

199 
	`exô
(
EXIT_FAILURE
);

201 
	`sig«l_öô
(
¨gv
[1]);

204 
	`¥ötf
("Processáwaiting signals ...\n");

206 ()
	`∑u£
();

207 
	`exô
(
EXIT_SUCCESS
);

208 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch12/sigtmwtinfo.c

22 
	#_GNU_SOURCE


	)

23 
	~<°dio.h
>

24 
	~<°dlib.h
>

25 
	~<uni°d.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<°rög.h
>

28 
	~<sig«l.h
>

29 
	~<î∫o.h
>

30 
	~"../../comm⁄.h
"

32 
	#APPNAME
 "sigtmwtöfo"

	)

34 
	$Áèl_sig_h™dÀr
(
signum
, 
sigöfo_t
 *
si
, *
uc⁄ãxt
)

36 
signum
) {

37 
SIGSEGV
:

38 
	`Ârötf
(
°dîr
,

40 
APPNAME
);

41 
	`Ârötf
(
°dîr
, " *** FATAL sig«»%d :: \n", 
signum
);

42 
	`Ârötf
(
°dîr
, " Fau…ög in¢/mem‹yáddªss: %p\n", 
si
->
si_addr
);

43 
	`Ârötf
(
°dîr
, " Origin: ");

44 
si
->
si_code
) {

45 
SEGV_MAPERR
:

46 
	`Ârötf
(
°dîr
, "SEGV_MAPERR : AddressÇot mappedÅo object.\n");

48 
SEGV_ACCERR
:

49 
	`Ârötf
(
°dîr
, "SEGV_ACCERR : InvalidÖermissions for mapped object.\n");

52 
SEGV_BNDERR
:

53 
	`Ârötf
(
°dîr
, " SEGV_BNDERR : Failedáddress bound checks..\n");

55 
SEGV_PKUERR
:

56 
	`Ârötf
(
°dîr
, " SEGV_PKUERR : Access was denied by memoryÖrotection keys.\n");

60 
	`Ârötf
(
°dîr
, "%s: Ab‹tög ...\n", 
APPNAME
);

61 
	`Ârötf
(
°dîr
,

68 i‡(
	`sig«l
(
SIGSEGV
, 
SIG_DFL
Ë=
SIG_ERR
)

69 
	`FATAL
("signal -reverting SIGSEGVÅo default- failed");

70 i‡(
	`øi£
(
SIGSEGV
))

71 
	`FATAL
("raise SIGSEGV failed");

74 
	}
}

77 
	$buggy
()

79 *
i
 = 
NULL
;

80 *
i
 = 0;

81 
	}
}

83 
	$maö
(
¨gc
, **
¨gv
)

85 
siga˘i⁄
 
a˘
;

86 
sig£t_t
 
£t
;

87 
sig
=0;

88 
time•ec
 
tm
;

89 
sigöfo_t
 
si
;

91 i‡(
¨gc
 != 2 ) {

92 
	`Ârötf
(
°dîr
, "Usage: %s 0|1\n"

95 , 
¨gv
[0]);

96 
	`exô
(
EXIT_FAILURE
);

98 
	`sigfûl£t
(&
£t
);

104 
	`¥ötf
("%s:Ñemovög SIGFPEánd SIGSEGV fromÅhêsig«»mask...\n", 
¨gv
[0]);

105 
	`sigdñ£t
(&
£t
, 
SIGFPE
);

106 
	`sigdñ£t
(&
£t
, 
SIGSEGV
);

113 
	`mem£t
(&
a˘
, 0, (act));

114 
a˘
.
ß_siga˘i⁄
 = 
Áèl_sig_h™dÀr
;

115 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

116 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) < 0)

117 
	`FATAL
("sigaction on SIGSEGV failed");

118 i‡(
	`siga˘i⁄
(
SIGFPE
, &
a˘
, 0) < 0)

119 
	`FATAL
("sigaction on SIGFPE failed");

120 
	`¥ötf
("%s: All signals blocked (exceptÅhat SIGSEGVánd SIGFPE caught w/ sigaction)\n"

121 , 
¨gv
[0]);

126 i‡(
	`sig¥ocmask
(
SIG_BLOCK
, &
£t
, 0) < 0)

127 
	`FATAL
("sigprocmask -to block- failed\n");

128 i‡(
	`show_blocked_sig«ls
() < 0)

129 
	`WARN
("sigprocmask -query- failed\n");

131 
tm
.
tv_£c
 = 1;

132 
tm
.
tv_n£c
 = 100000000;

133 
	`¥ötf
("%s: waiting upon signalsÇow (bugginess setting is %s)...\n",

134 
¨gv
[0], 
	`©oi
(argv[1]) == 1?"Y":"N");

136 i‡((
sig
 = 
	`sigtimedwaô
(&
£t
, &
si
, &
tm
)) < 0) {

137 i‡(
î∫o
 =
EAGAIN
) {

138 
	`¥ötf
("<timeout>!Ñetrying ...\n");

139 i‡(
	`©oi
(
¨gv
[1]) == 1)

140 
	`buggy
();

143 
	`FATAL
("sigtimedwait failed\n");

145 
	`¥ötf
("Re˚ived sig«l# %2d\n", 
sig
);

147 
	`exô
(
EXIT_SUCCESS
);

148 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch13/3intv.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<sig«l.h
>

22 
	~<°rög.h
>

23 
	~<uni°d.h
>

24 
	~<time.h
>

25 
	~<sys/time.h
>

26 
	~<î∫o.h
>

27 
	~"../../comm⁄.h
"

29 
	$¥oÁÃm
(
signum
)

31 
	`¥ötf
("In %s:%d sig=%d\n",

32 
__func__
, 
__LINE__
, 
signum
);

33 
	}
}

34 
	$vúèÃm
(
signum
)

36 
	`¥ötf
("In %s:%d sig=%d\n",

37 
__func__
, 
__LINE__
, 
signum
);

38 
	}
}

39 
	$ticktock
(
signum
)

41 
tm°amp
[128];

42 
time•ec
 
tm
;

43 
myî∫o
 = 
î∫o
, 
›t
=0;

47 i‡(
	`˛ock_gëtime
(
CLOCK_REALTIME
, &
tm
) < 0)

48 
	`FATAL
("clock_gettime failed\n");

49 i‡(
	`˘ime_r
(&
tm
.
tv_£c
, &
tm°amp
[0]Ë=
NULL
)

50 
	`FATAL
("ctime_r failed\n");

52 i‡(
›t
 == 0) {

53 i‡(
	`wrôe
(
STDOUT_FILENO
, 
tm°amp
, 
	`°æí
(tmstamp)) < 0)

54 
	`FATAL
("write failed\n");

55 } i‡(
›t
 == 1) {

60 
tm°amp
[
	`°æí
(tmstamp) - 1] = '\0';

61 
	`¥ötf
("\r%s", 
tm°amp
);

62 
	`fÊush
(
°dout
);

64 
î∫o
 = 
myî∫o
;

65 
	}
}

67 
	$maö
(
¨gc
, **
¨gv
)

69 
siga˘i⁄
 
a˘
;

70 
ôimîvÆ
 
t1
, 
t2
, 
t3
;

73 
	`mem£t
(&
a˘
, 0, (act));

74 
a˘
.
ß_h™dÀr
 = 
ticktock
;

75 
	`sigfûl£t
(&
a˘
.
ß_mask
);

84 i‡(
	`siga˘i⁄
(
SIGALRM
, &
a˘
, 0) < 0)

85 
	`FATAL
("sigaction on SIGALRM failed");

88 
	`mem£t
(&
a˘
, 0, (act));

89 
a˘
.
ß_h™dÀr
 = 
vúèÃm
;

90 
	`sigfûl£t
(&
a˘
.
ß_mask
);

91 i‡(
	`siga˘i⁄
(
SIGVTALRM
, &
a˘
, 0) < 0)

92 
	`FATAL
("sigaction on SIGALRM failed");

95 
	`mem£t
(&
a˘
, 0, (act));

96 
a˘
.
ß_h™dÀr
 = 
¥oÁÃm
;

97 
	`sigfûl£t
(&
a˘
.
ß_mask
);

98 i‡(
	`siga˘i⁄
(
SIGPROF
, &
a˘
, 0) < 0)

99 
	`FATAL
("sigaction on SIGALRM failed");

102 
	`mem£t
(&
t1
, 0, (
ôimîvÆ
));

103 
t1
.
ô_vÆue
.
tv_£c
 = 1;

104 
t1
.
ô_öãrvÆ
.
tv_£c
 = 1;

105 i‡(
	`£tôimî
(
ITIMER_REAL
, &
t1
, 0) < 0)

106 
	`FATAL
("setitimer failed\n");

109 
	`mem£t
(&
t2
, 0, (
ôimîvÆ
));

110 
t2
.
ô_vÆue
.
tv_£c
 = 0;

111 
t2
.
ô_vÆue
.
tv_u£c
 = 70000;

112 
t2
.
ô_öãrvÆ
.
tv_£c
 = 0;

113 
t2
.
ô_öãrvÆ
.
tv_u£c
 = 30000;

114 i‡(
	`£tôimî
(
ITIMER_VIRTUAL
, &
t2
, 0) < 0)

115 
	`FATAL
("setitimer failed\n");

118 
	`mem£t
(&
t3
, 0, (
ôimîvÆ
));

119 
t3
.
ô_vÆue
.
tv_£c
 = 0;

120 
t3
.
ô_vÆue
.
tv_u£c
 = 10000;

121 
t3
.
ô_öãrvÆ
.
tv_£c
 = 0;

122 
t3
.
ô_öãrvÆ
.
tv_u£c
 = 10000;

123 i‡(
	`£tôimî
(
ITIMER_PROF
, &
t3
, 0) < 0)

124 
	`FATAL
("setitimer failed\n");

127 
	`DELAY_LOOP_SILENT
(20);

129 ()
	`∑u£
();

131 
	`exô
(
EXIT_SUCCESS
);

132 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/named_threads.c

20 
	~"../../comm⁄.h
"

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<uni°d.h
>

24 
	~<°rög.h
>

25 
	~<±hªad.h
>

27 *
	$w‹kî
(*
d©a
)

29 
d©um
 = ()
d©a
;

30 
	`¥ötf
("W‹kîÅhªad #%5ld:ÖausögÇow...\n", 
d©um
);

31 ()
	`∑u£
();

32 
	`¥ötf
(" #%5ld: w‹k d⁄e,ÉxôögÇow\n", 
d©um
);

33 
	`±hªad_exô
(
NULL
);

34 
	}
}

36 
	$maö
(
¨gc
, **
¨gv
)

38 
i
;

39 
ªt
;

40 
±hªad_t
 
tid
;

41 
numthrds
 = 0;

42 
	#MAXLEN
 11

	)

43 
nm
[
MAXLEN
];

45 i‡(
¨gc
 != 3) {

46 
	`Ârötf
(
°dîr
,

48 
¨gv
[0]);

49 
	`exô
(
EXIT_FAILURE
);

52 
numthrds
 = 
	`©ﬁ
(
¨gv
[2]);

53 i‡(
numthrds
 <= 0) {

54 
	`Ârötf
(
°dîr
,

56 
¨gv
[0]);

57 
	`exô
(
EXIT_FAILURE
);

59 i‡(
	`°æí
(
¨gv
[1]Ë>
MAXLEN
-3) {

60 
	`Ârötf
(
°dîr
, "%s:Åhread-name-prefix \"%s\" isÅooÜong (max %d bytes)\n",

61 
¨gv
[0],árgv[1], 
MAXLEN
-4);

62 
	`exô
(
EXIT_FAILURE
);

66 
i
 = 0; i < 
numthrds
; i++) {

67 
ªt
 = 
	`±hªad_¸óã
(&
tid
, 
NULL
, 
w‹kî
, (*)
i
);

68 i‡(
ªt
)

69 
	`FATAL
("±hªad_¸óã(Ë#%d faûed! [%d]\n", 
i
,

70 
ªt
);

74 
	`mem£t
(
nm
, 0, 
MAXLEN
);

75 
	`¢¥ötf
(
nm
, 
MAXLEN
, "%s_%ld", 
¨gv
[1], 
i
);

76 i‡((
ªt
 = 
	`±hªad_£äame_≈
(
tid
, 
nm
)))

77 
	`FATAL
("pthread_setname_np (%d) failed! [%d]\n",

78 
i
, 
ªt
);

80 
	`±hªad_exô
(
NULL
);

81 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/pthreads_joiner3.c

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<±hªad.h
>

26 
	~"../../comm⁄.h
"

28 
	#NTHREADS
 3

	)

30 
	s∑ssô
 {

31 
	mthrdnum
;

32 
	m¶ì±m
;

35 * 
	$w‹kî
(*
d©a
)

37 
∑ssô
 *
¨g
 = (∑ssô *)
d©a
;

38 
¶±m
 = 
¨g
->
¶ì±m
 -árg->
thrdnum
;

40 
	`¥ötf
("***********árg->thrdnum=%dárg->¶ì±m=%d\n", 
¨g
->
thrdnum
,árg->
¶ì±m
);

41 
	`¥ötf
(" w‹kî #%d: wû»¶ì∞f‹ %d†now ...\n", 
¨g
->
thrdnum
, 
¶±m
);

42 
	`¶ìp
(
¶±m
);

43 
	`¥ötf
(" w‹kî #%d: w‹k (eyîﬁlËd⁄e,ÉxôögÇow\n", 
¨g
->
thrdnum
);

47 
	`±hªad_exô
((*)0);

48 
	}
}

50 
	$maö
(
¨gc
, **
¨gv
)

52 
i
, 
j
, 
ªt
, 
°©
=0, 
¶ì±m
=0;

53 
±hªad_t
 
tid
[
NTHREADS
];

54 
±hªad_©å_t
 
©å
;

55 
∑ssô
 *
∑s°his
[
NTHREADS
];

59 i‡(
¨gc
 != 2) {

60 
	`Ârötf
(
°dîr
, "Usage: %sÇum-seconds-to-have-workers-sleep\n"

62 
¨gv
[0], 
NTHREADS
);

63 
	`exô
(
EXIT_FAILURE
);

66 
¶ì±m
 = 
	`©oi
(
¨gv
[1]);

67 i‡(
¶ì±m
 <
NTHREADS
-1) {

68 
	`Ârötf
(
°dîr
, "Usage: %sÇum-seconds-to-have-workers-sleep\n"

70 
¨gv
[0], 
NTHREADS
);

71 
	`exô
(
EXIT_FAILURE
);

75 
	`±hªad_©å_öô
(&
©å
);

77 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

80 
i
 = 0; i < 
NTHREADS
; i++) {

81 
	`¥ötf
("maö: cª©ögÅhªad #%d ...\n", 
i
);

83 
∑s°his
[
i
] = 
	`ˇŒoc
(1, (
∑ssô
));

84 i‡(!
∑s°his
[
i
])

85 
	`FATAL
("ˇŒo¯%d faûed!\n", 
i
);

86 
∑s°his
[
i
]->
thrdnum
 = i;

87 
∑s°his
[
i
]->
¶ì±m
 = sleeptm;

89 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)
∑s°his
[i]);

90 i‡(
ªt
) {

91 
	`‰ì
((*)
∑s°his
[
i
]);

92 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

95 
	`±hªad_©å_de°roy
(&
©å
);

98 
j
 = 0; j < 
NTHREADS
; j++) {

99 
	`¥ötf
("maö: joöög (waôögËup⁄Åhªad #%d ...\n", 
j
);

100 
ªt
 = 
	`±hªad_joö
(
tid
[
j
], (**)&
°©
);

101 i‡(
ªt
)

102 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

103 
	`¥ötf
("Thread #%d successfully joined; itÅerminated with "

104 "°©us=%d\n", 
j
, 
°©
);

105 
	`‰ì
((*)
∑s°his
[
j
]);

108 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

109 
	`±hªad_exô
(
NULL
);

110 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/pthreads_joiner4.c

21 
	~"../../comm⁄.h
"

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<uni°d.h
>

25 
	~<±hªad.h
>

26 
	~<time.h
>

27 
	~<î∫o.h
>

29 
	#NTHREADS
 3

	)

31 
	s∑ssô
 {

32 
	mthrdnum
;

33 
	m¶ì±m
;

36 * 
	$w‹kî
(*
d©a
)

38 
∑ssô
 *
¨g
 = (∑ssô *)
d©a
;

39 
¶±m
 = 
¨g
->
¶ì±m
 -árg->
thrdnum
;

41 
	`¥ötf
(" w‹kî #%d: wû»¶ì∞f‹ %d†now ...\n", 
¨g
->
thrdnum
, 
¶±m
);

42 
	`¶ìp
(
¶±m
);

43 
	`¥ötf
(" w‹kî #%d: w‹k (eyîﬁlËd⁄e,ÉxôögÇow\n", 
¨g
->
thrdnum
);

47 
	`±hªad_exô
((*)0);

48 
	}
}

50 
	$maö
(
¨gc
, **
¨gv
)

52 
i
, 
j
, 
ªt
, 
°©
=0, 
¶ì±m
=0, 
joö_tmout
=0;

53 
±hªad_t
 
tid
[
NTHREADS
];

54 
±hªad_©å_t
 
©å
;

55 
∑ssô
 *
∑s°his
[
NTHREADS
];

59 i‡(
¨gc
 != 3) {

60 
	`Ârötf
(
°dîr
, "Usage: %sÇum-seconds-to-have-workers-sleepÇum-seconds-to-join-for-max\n"

62 
¨gv
[0], 
NTHREADS
);

63 
	`exô
(
EXIT_FAILURE
);

66 
¶ì±m
 = 
	`©oi
(
¨gv
[1]);

67 
joö_tmout
 = 
	`©oi
(
¨gv
[2]);

68 i‡((
¶ì±m
 <
NTHREADS
-1) ||

69 (
joö_tmout
 <
NTHREADS
-1)) {

70 
	`Ârötf
(
°dîr
, "Usage: %sÇum-seconds-to-have-workers-sleepÇum-seconds-to-join-for-max\n"

72 
¨gv
[0], 
NTHREADS
);

73 
	`exô
(
EXIT_FAILURE
);

77 
	`±hªad_©å_öô
(&
©å
);

79 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

82 
i
 = 0; i < 
NTHREADS
; i++) {

83 
	`¥ötf
("maö: cª©ögÅhªad #%d ...\n", 
i
);

85 
∑s°his
[
i
] = 
	`ˇŒoc
(1, (
∑ssô
));

86 i‡(!
∑s°his
[
i
])

87 
	`FATAL
("ˇŒo¯%d faûed!\n", 
i
);

88 
∑s°his
[
i
]->
thrdnum
 = i;

89 
∑s°his
[
i
]->
¶ì±m
 = sleeptm;

91 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)
∑s°his
[i]);

92 i‡(
ªt
) {

93 
	`‰ì
((*)
∑s°his
[
i
]);

94 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

97 
	`±hªad_©å_de°roy
(&
©å
);

100 
j
 = 0; j < 
NTHREADS
; j++) {

101 
time•ec
 
tm•ec
;

103 
	`¥ötf
("=== main: joining (waiting) uponÅhread #%d [for max %ds] ...\n",

104 
j
, 
joö_tmout
);

107 i‡(
	`˛ock_gëtime
(
CLOCK_REALTIME
, &
tm•ec
) < 0)

108 
	`FATAL
("˛ock_gëtime(2Ë%d faûed\n", 
j
);

109 
tm•ec
.
tv_£c
 +
joö_tmout
;

110 
ªt
 = 
	`±hªad_timedjoö_≈
(
tid
[
j
], (**)&
°©
, &
tm•ec
);

111 i‡(
ªt
) {

112 
	`WARN
("***Öthªad_timedjoö_≈(ËÁûed [%d] ***\n", 
ªt
);

113 i‡(
ªt
 =
ETIMEDOUT
)

114 
	`Ârötf
(
°dîr
, "Ñeason:Åimeout\n");

117 
	`¥ötf
("Thread #%d successfully joined; itÅerminated with "

118 "°©us=%d\n", 
j
, 
°©
);

123 
	`‰ì
((*)
∑s°his
[
j
]);

127 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

128 
	`±hªad_exô
(
NULL
);

137 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/pthreads_joiner_BUGGY_3.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<±hªad.h
>

22 
	~"../../comm⁄.h
"

24 
	#NTHREADS
 3

	)

26 
	s∑ssô
 {

27 
	mthrdnum
;

28 
	m¶ì±m
;

31 * 
	$w‹kî
(*
d©a
)

33 
∑ssô
 *
¨g
 = (∑ssô *)
d©a
;

34 
¶±m
 = 
¨g
->
¶ì±m
 -árg->
thrdnum
;

36 
	`¥ötf
("***********árg->thrdnum=%dárg->¶ì±m=%d\n", 
¨g
->
thrdnum
,árg->
¶ì±m
);

37 
	`¥ötf
(" w‹kî #%d: wû»¶ì∞f‹ %d†now ...\n", 
¨g
->
thrdnum
, 
¶±m
);

38 
	`¶ìp
(
¶±m
);

39 
	`¥ötf
(" w‹kî #%d: w‹k (eyîﬁlËd⁄e,ÉxôögÇow\n", 
¨g
->
thrdnum
);

43 
	`±hªad_exô
((*)0);

44 
	}
}

46 
	$maö
(
¨gc
, **
¨gv
)

48 
i
, 
j
;

49 
ªt
, 
°©
=0;

50 
±hªad_t
 
tid
[
NTHREADS
];

51 
±hªad_©å_t
 
©å
;

52 vﬁ©ûê
∑ssô
 *
∑s°his
;

53 
¶ì±m
=0;

55 i‡(
¨gc
 != 2) {

56 
	`Ârötf
(
°dîr
, "Usage: %sÇum-seconds-to-wait-for-workers-max\n"

58 
¨gv
[0], 
NTHREADS
);

59 
	`exô
(
EXIT_FAILURE
);

62 
¶ì±m
 = 
	`©oi
(
¨gv
[1]);

63 i‡(
¶ì±m
 <
NTHREADS
-1) {

64 
	`Ârötf
(
°dîr
, "Usage: %sÇum-seconds-to-wait-for-workers-max\n"

66 
¨gv
[0], 
NTHREADS
);

67 
	`exô
(
EXIT_FAILURE
);

69 
∑s°his
 = 
	`ˇŒoc
(1, (
∑ssô
));

70 i‡(!
∑s°his
)

71 
	`FATAL
("calloc failed!\n");

74 
	`±hªad_©å_öô
(&
©å
);

76 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

79 
i
 = 0; i < 
NTHREADS
; i++) {

80 
	`¥ötf
("maö: cª©ögÅhªad #%d ...\n", 
i
);

86 
∑s°his
->
thrdnum
 = 
i
;

87 
∑s°his
->
¶ì±m
 = sleeptm;

88 
	`¥ötf
("***********Öassthis->thrdnum=%dÖassthis->sleeptm=%d\n",

89 
∑s°his
->
thrdnum
,Öas°his->
¶ì±m
);

90 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)
∑s°his
);

91 i‡(
ªt
) {

92 
	`‰ì
((*)
∑s°his
);

93 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

96 
	`±hªad_©å_de°roy
(&
©å
);

99 
j
 = 0; j < 
NTHREADS
; j++) {

101 
ªt
 = 
	`±hªad_joö
(
tid
[
j
], (**)&
°©
);

102 i‡(
ªt
)

103 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

108 
	`‰ì
((*)
∑s°his
);

109 
	`¥ötf
("\nmain:Çow dying... <Dramatic!> Farewell!\n");

110 
	`±hªad_exô
(
NULL
);

111 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/see_tid.c

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<uni°d.h
>

31 
	~<±hªad.h
>

32 
	~<sys/sysˇŒ.h
>

33 
	~"../../comm⁄.h
"

35 *
	$w‹kî
(*
d©a
)

37 
d©um
 = ()
d©a
;

38 
	`¥ötf
("WorkerÅhread #%5ld [PID %d * TID %ld *]:ÖausingÇow...\n",

39 
d©um
, 
	`gëpid
(), 
	`sysˇŒ
(
SYS_gëtid
));

40 ()
	`∑u£
();

41 
	`¥ötf
(" #%ld: w‹k d⁄e,ÉxôögÇow\n", 
d©um
);

42 
	`±hªad_exô
(
NULL
);

43 
	}
}

45 
	$maö
(
¨gc
, **
¨gv
)

47 
i
;

48 
ªt
;

49 
±hªad_t
 
tid
;

50 
numthrds
 = 0;

52 i‡(
¨gc
 != 2) {

53 
	`Ârötf
(
°dîr
, "Usage: %sÇumber-of-threads-to-create\n",

54 
¨gv
[0]);

55 
	`exô
(
EXIT_FAILURE
);

57 
numthrds
 = 
	`©ﬁ
(
¨gv
[1]);

58 i‡(
numthrds
 <= 0) {

59 
	`Ârötf
(
°dîr
, "Usage: %sÇumber-of-threads-to-create\n",

60 
¨gv
[0]);

61 
	`exô
(
EXIT_FAILURE
);

64 
i
 = 0; i < 
numthrds
; i++) {

65 
ªt
 = 
	`±hªad_¸óã
(&
tid
, 
NULL
, 
w‹kî
, (*)
i
);

66 i‡(
ªt
)

67 
FATAL


69 
	`gëpid
(), 
i
, 
ªt
);

71 
	`±hªad_exô
(
NULL
);

72 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch15/bankacc.c

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<uni°d.h
>

24 
	~<±hªad.h
>

25 
	~"../../comm⁄.h
"

27 
	#NTHREADS
 2

	)

29 
	ggLockög
=1;

30 
	ggBÆ™˚
 = 12000;

31 c⁄° 
	ggCB_MöCªdô
 = 500, 
	ggCB_HiBÆ™˚
 = 1000000;

32 
±hªad_muãx_t
 
	gmylock
;

34 
	$dïosô
(
thrdnum
, 
amt
)

36 i‡(
amt
 <= 0)

38 
	`¥ötf
(" [thrd#%2d +] Dïosô : %12ld\n", 
thrdnum
, 
amt
);

39 
gBÆ™˚
 +
amt
;

40 i‡(
gBÆ™˚
 >
gCB_HiBÆ™˚
)

41 
	`¥ötf
("*** Circuit Breaker *** High Balance\n");

42 
	`¥ötf
(" [thrd#%2d] CuºíàBÆ™˚: %12ld\n", 
thrdnum
, 
gBÆ™˚
);

43 
	}
}

44 
	$wôhdøw
(
thrdnum
, 
amt
)

46 i‡((
gBÆ™˚
 - 
amt
Ë< 
gCB_MöCªdô
) {

47 
	`¥ötf
("*** Circuit Breaker *** Min Credit hit! Failing withdawal...\n");

50 
	`¥ötf
(" [thrd#%2d -] WôhdøwÆ : %12ld\n", 
thrdnum
, 
amt
);

51 
gBÆ™˚
 -
amt
;

52 
	`¥ötf
(" [thrd#%2d] CuºíàBÆ™˚: %12ld\n", 
thrdnum
, 
gBÆ™˚
);

53 
	}
}

55 
	#LOCK
(
mtx
) do { \

56 
ªt
=0; \

57 i‡(
gLockög
) { \

58 i‡((
ªt
 = 
	`±hªad_muãx_lock
(
mtx
))) \

59 
	`FATAL
("±hªad_muãx_lock faûed! [%d]\n", 
ªt
); \

61 } 0)

	)

63 
	#UNLOCK
(
mtx
) do { \

64 
ªt
=0; \

65 i‡(
gLockög
) { \

66 i‡((
ªt
 = 
	`±hªad_muãx_u∆ock
(
mtx
))) \

67 
	`FATAL
("±hªad_muãx_u∆ock faûed! [%d]\n", 
ªt
); \

69 } 0)

	)

77 * 
	$w‹kî
(*
d©a
)

79 
thªadnum
 = ()
d©a
 + 1;

81 
thªadnum
) {

83 
	`LOCK
(&
mylock
);

84 
	`dïosô
(
thªadnum
, 3000);

85 
	`wôhdøw
(
thªadnum
, 250);

86 
	`UNLOCK
(&
mylock
);

89 
	`LOCK
(&
mylock
);

90 
	`wôhdøw
(
thªadnum
, 9000);

91 
	`dïosô
(
thªadnum
, 1000);

92 
	`UNLOCK
(&
mylock
);

94 : 
	`WARN
("thªadnum = %ld ! [shouldÇevî occur]!\n", 
thªadnum
);

99 
	`±hªad_exô
((*)0);

100 
	}
}

102 
ölöe
 
	$ußge
(*
«me
)

104 
	`Ârötf
(
°dîr
, "Usage: %sÜock-or-not\n"

106 " 1 : dÿlock (c‹ª˘)\n", 
«me
);

107 
	}
}

109 
	$maö
(
¨gc
, **
¨gv
)

111 
i
;

112 
ªt
, 
°©
=0;

113 
±hªad_t
 
tid
[
NTHREADS
];

114 
±hªad_©å_t
 
©å
;

116 i‡(
¨gc
 != 2) {

117 
	`ußge
(
¨gv
[0]);

118 
	`exô
(
EXIT_FAILURE
);

120 i‡(
	`©oi
(
¨gv
[1]) == 0)

121 
gLockög
 = 0;

122 i‡(
	`©oi
(
¨gv
[1]) == 1)

123 
gLockög
 = 1;

125 
	`ußge
(
¨gv
[0]);

126 
	`exô
(
EXIT_FAILURE
);

130 
	`±hªad_©å_öô
(&
©å
);

132 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

134 
	`¥ötf
("Lockög : %s\n", (
gLockög
 == 1?"ON":"OFF"));

135 i‡(
gLockög
) {

136 i‡((
ªt
 = 
	`±hªad_muãx_öô
(&
mylock
, 
NULL
)))

137 
	`FATAL
("±hªad_muãx_öô(ËÁûed! [%d]\n", 
ªt
);

139 
	`¥ötf
("O≥nög BÆ™˚ : %6ld\n", 
gBÆ™˚
);

142 
i
 = 0; i < 
NTHREADS
; i++) {

143 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
, 
w‹kî
, (*)i);

144 i‡(
ªt
)

145 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

147 
	`±hªad_©å_de°roy
(&
©å
);

150 
i
 = 0; i < 
NTHREADS
; i++) {

151 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

152 i‡(
ªt
)

153 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

156 i‡(
gLockög
) {

157 i‡((
ªt
 = 
	`±hªad_muãx_de°roy
(&
mylock
)))

158 
	`FATAL
("±hªad_muãx_de°roy(ËÁûed! [%d]\n", 
ªt
);

160 
	`¥ötf
("Closög BÆ™˚ : %6ld\n", 
gBÆ™˚
);

162 
	`±hªad_exô
(
NULL
);

163 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch16/mt_primes1.c

26 
	~<°dio.h
>

27 
	~<uni°d.h
>

28 
	~<sys/ty≥s.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

31 
	~<as£π.h
>

32 
	~<±hªad.h
>

33 
	~"../../comm⁄.h
"

35 
	#NTHREADS
 3

	)

36 
	#MEM_SIZE
 100000

	)

50 
size_t
 
	$sim∂e_¥imegí
(
°¨t
, 
limô
, *
buf
)

52 
i
, 
j
, 
i•rime
=0;

53 
size_t
 
num_¥imes
 = 0;

54 
	#LEN
 128

	)

55 
tmpbuf
[
LEN
];

57 
	`as£π
(
°¨t
 <
limô
);

58 
	`as£π
(
buf
);

60 
i
 = 
°¨t
; i <
limô
; i++) {

61 
i•rime
 = 1;

62 
j
 = 2; j < 
limô
 / 2; j++) {

63 i‡((
i
 !
j
) && (i % j == 0)) {

64 
i•rime
 = 0;

68 i‡(
i•rime
) {

69 
num_¥imes
 ++;

71 
	`¢¥ötf
(
tmpbuf
, 
LEN
, "%6d, ", 
i
);

72 
	`°∫ˇt
(
buf
, 
tmpbuf
, 
LEN
);

75  
num_¥imes
;

76 
	}
}

78 
	s°ToThªad
 {

79 
	mthrdnum
;

80 
	m°¨t_num
, 
	míd_num
;

81 *
	miobuf
;

83 
°ToThªad
 *
	gToThªad
[
NTHREADS
];

85 
	$di•_the_¥imes
(
°ToThªad
 * 
p°ToThrd
)

87 
	`as£π
(
p°ToThrd
->
iobuf
);

88 
	`¥ötf
("\n===\n%s\n===\n", 
p°ToThrd
->
iobuf
);

89 
	}
}

91 *
	$w‹kî
(*
msg
)

93 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

94 
	`as£π
(
p°ToThªad
);

96 
	`¥ötf
(" Worker #%2d : GenerateÖrimes from %9dÅo %9d : "

98 
p°ToThªad
->
thrdnum
,Ö°ToThªad->
°¨t_num
,

99 
p°ToThªad
->
íd_num
,

100 
	`sim∂e_¥imegí
(
p°ToThªad
->
°¨t_num
,Ö°ToThªad->
íd_num
,

101 
p°ToThªad
->
iobuf
));

102 
	`±hªad_exô
((*)0);

103 
	}
}

106 
	$maö
(
¨gc
, **
¨gv
)

108 
i
, 
ªt
;

109 
±hªad_t
 
tid
[
NTHREADS
];

110 
±hªad_©å_t
 
©å
;

111 *
°©
=0;

113 
¥ime_ønge
[
NTHREADS
][2] = {

120 
	`±hªad_©å_öô
(&
©å
);

121 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

124 
i
 = 0; i < 
NTHREADS
; i++) {

125 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

126 i‡(!
ToThªad
[
i
])

127 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

129 
ToThªad
[
i
]->
thrdnum
 = i;

130 
ToThªad
[
i
]->
°¨t_num
 = 
¥ime_ønge
[i][0];

131 
ToThªad
[
i
]->
íd_num
 = 
¥ime_ønge
[i][1];

132 
ToThªad
[
i
]->
iobuf
 = 
	`ˇŒoc
(
MEM_SIZE
, 1);

133 i‡(!
ToThªad
[
i
]->
iobuf
)

134 
	`FATAL
("calloc MEM_SIZE failed!\n");

135 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

136 
w‹kî
, (*)
ToThªad
[
i
]);

137 i‡(
ªt
)

138 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

140 
	`±hªad_©å_de°roy
(&
©å
);

143 
i
 = 0; i < 
NTHREADS
; i++) {

144 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

145 i‡(
ªt
)

146 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

148 
	`¥ötf
(" Thread #%d successfully joined; it "

149 "ãrmö©ed wôh sètus=%ld\n", 
i
, ()
°©
);

150 i‡(
°©
 =
PTHREAD_CANCELED
)

151 
	`¥ötf
(" : was CANCELED\n");

154 
	`di•_the_¥imes
(
ToThªad
[
i
]);

156 
	`‰ì
(
ToThªad
[
i
]->
iobuf
);

157 
	`‰ì
(
ToThªad
[
i
]);

160 
	`±hªad_exô
(
NULL
);

161 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch16/mt_primes2.c

42 
	~<°dio.h
>

43 
	~<uni°d.h
>

44 
	~<°dlib.h
>

45 
	~<°rög.h
>

46 
	~<as£π.h
>

47 
	~<±hªad.h
>

48 
	~<sys/ty≥s.h
>

49 
	~<sys/°©.h
>

50 
	~<f˙é.h
>

51 
	~"../../comm⁄.h
"

53 
	#PRM_DATAFILE
 "¥imes.d©"

	)

54 
	#NTHREADS
 3

	)

55 
	#MEM_SIZE
 100000

	)

62 
±hªad_muãx_t
 
	gmylock
 = 
PTHREAD_MUTEX_INITIALIZER
;

63 
	ggC™˚ÀdThªad
 = 0;

73 
size_t
 
	$sim∂e_¥imegí
(
°¨t
, 
limô
, *
buf
)

75 
i
, 
j
, 
i•rime
=0;

76 
size_t
 
num_¥imes
 = 0;

77 
	#LEN
 128

	)

78 
tmpbuf
[
LEN
];

80 
	`as£π
(
°¨t
 <
limô
);

81 
	`as£π
(
buf
);

83 
i
 = 
°¨t
; i <
limô
; i++) {

84 
i•rime
 = 1;

85 
j
 = 2; j < 
limô
 / 2; j++) {

86 i‡((
i
 !
j
) && (i % j == 0)) {

87 
i•rime
 = 0;

91 i‡(
i•rime
) {

92 
num_¥imes
 ++;

94 
	`¢¥ötf
(
tmpbuf
, 
LEN
, "%6d, ", 
i
);

95 
	`°∫ˇt
(
buf
, 
tmpbuf
, 
LEN
);

98  
num_¥imes
;

99 
	}
}

101 
	s°ToThªad
 {

102 
	mthrdnum
;

103 
	m°¨t_num
, 
	míd_num
;

104 *
	miobuf
;

105 
	mfd
;

107 
°ToThªad
 *
	gToThªad
[
NTHREADS
];

109 
	$wrôe_the_¥imes
(
°ToThªad
 **
p°ToThrd
)

111 
i
, 
Àn
;

113 
i
 = 0; i < 
NTHREADS
; i++) {

114 i‡(
i
 =
gC™˚ÀdThªad
)

116 
	`as£π
(
p°ToThrd
[
i
]->
iobuf
);

119 
Àn
 = 
	`°æí
(
p°ToThrd
[
i
]->
iobuf
);

120 i‡(
	`wrôe
(
p°ToThrd
[
i
]->
fd
,Ö°ToThrd[i]->
iobuf
, 
Àn
) < 0)

121 
	`WARN
("thread #%d; write(2) of iobufÅoÅhe data file failed.\n",

122 
p°ToThrd
[
i
]->
thrdnum
);

124 
	}
}

126 
	$˛ónup_h™dÀr
(*
¨g
)

128 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
¨g
;

131 
	`LOCK_MTX
(&
mylock
);

132 
gC™˚ÀdThªad
 = 
p°ToThªad
->
thrdnum
;

133 
	`UNLOCK_MTX
(&
mylock
);

134 
	`¥ötf
("+++ In cleanup func %s (thread #%d canceled!) +++\n",

135 
__func__
, 
p°ToThªad
->
thrdnum
);

136 
	`‰ì
(
p°ToThªad
->
iobuf
);

137 
	`‰ì
(
p°ToThªad
);

138 
	}
}

140 *
	$w‹kî
(*
msg
)

142 
Àn
;

143 
size_t
 
num¥imes
=0;

144 
tmp
[256];

145 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

146 
	`as£π
(
p°ToThªad
);

149 
	`±hªad_˛ónup_push
(
˛ónup_h™dÀr
, 
p°ToThªad
);

151 i‡(
p°ToThªad
->
thrdnum
 == 2)

152 
	`r_¶ìp
(0, 5000000);

153 
num¥imes
 = 
	`sim∂e_¥imegí
(
p°ToThªad
->
°¨t_num
,Ö°ToThªad->
íd_num
,

154 
p°ToThªad
->
iobuf
);

155 
	`¢¥ötf
(
tmp
, 255, " Worker #%2d : GenerateÖrimes from %9dÅo %9d : "

157 
p°ToThªad
->
thrdnum
,Ö°ToThªad->
°¨t_num
,

158 
p°ToThªad
->
íd_num
, 
num¥imes
);

159 
	`¥ötf
("%s", 
tmp
);

162 
Àn
 = 
	`°æí
(
p°ToThªad
->
iobuf
);

163 
	`¥ötf
("À¿%d\n", 
Àn
);

169 
	`±hªad_˛ónup_p›
(0);

170 
	`±hªad_exô
((*)0);

171 
	}
}

174 
	$maö
(
¨gc
, **
¨gv
)

176 
i
, 
ªt
, 
fd
;

177 
±hªad_t
 
tid
[
NTHREADS
];

178 
±hªad_©å_t
 
©å
;

179 *
°©
=0;

181 
¥ime_ønge
[
NTHREADS
][2] = {

188 i‡((
fd
 = 
	`›í
(
PRM_DATAFILE
, 
O_CREAT
|
O_WRONLY
, 0644)) < 0)

189 
	`FATAL
("O≥nög d©®fûê\"%s\" faûed\n", 
PRM_DATAFILE
);

192 
	`±hªad_©å_öô
(&
©å
);

193 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

196 
i
 = 0; i < 
NTHREADS
; i++) {

197 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

198 i‡(!
ToThªad
[
i
])

199 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

201 
ToThªad
[
i
]->
thrdnum
 = i;

202 
ToThªad
[
i
]->
°¨t_num
 = 
¥ime_ønge
[i][0];

203 
ToThªad
[
i
]->
íd_num
 = 
¥ime_ønge
[i][1];

204 
ToThªad
[
i
]->
iobuf
 = 
	`ˇŒoc
(
MEM_SIZE
, 1);

205 i‡(!
ToThªad
[
i
]->
iobuf
)

206 
	`FATAL
("calloc MEM_SIZE failed!\n");

207 
ToThªad
[
i
]->
fd
 = fd;

209 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

210 
w‹kî
, (*)
ToThªad
[
i
]);

211 i‡(
ªt
)

212 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

214 
	`±hªad_©å_de°roy
(&
©å
);

216 i‡(
¨gc
 >2 && 
	`©oi
(
¨gv
[1]) == 1) {

218 
	`¥ötf
("%s: sending CANCEL REQUESTÅo workerÅhread 2Çow ...\n",

219 
__func__
);

220 
ªt
 = 
	`±hªad_ˇn˚l
(
tid
[2]);

221 i‡(
ªt
)

222 
	`FATAL
("±hªad_ˇn˚l—hªad 2ËÁûed! [%d]\n", 
ªt
);

226 
i
 = 0; i < 
NTHREADS
; i++) {

227 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

228 i‡(
ªt
)

229 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

231 
	`¥ötf
(" Thread #%d successfully joined; it "

232 "ãrmö©ed wôh sètus=%ld\n", 
i
, ()
°©
);

233 i‡(
°©
 =
PTHREAD_CANCELED
)

234 
	`¥ötf
(" : was CANCELED\n");

238 
	`wrôe_the_¥imes
(
ToThªad
);

241 
i
 = 0; i < 
NTHREADS
; i++) {

243 i‡(
i
 =
gC™˚ÀdThªad
)

245 
	`‰ì
(
ToThªad
[
i
]->
iobuf
);

246 
	`‰ì
(
ToThªad
[
i
]);

248 
	`˛o£
 (
fd
);

249 
	`±hªad_exô
(
NULL
);

250 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch17/assgn2.c

74 
	#_GNU_SOURCE


	)

75 
	~<°dio.h
>

76 
	~<uni°d.h
>

77 
	~<°dlib.h
>

78 
	~<°rög.h
>

79 
	~<as£π.h
>

80 
	~<sys/ty≥s.h
>

81 
	~<±hªad.h
>

82 
	~"../../comm⁄.h
"

83 
	~<sched.h
>

85 
	#NTHREADS
 3

	)

87 
	s°ToThªad
 {

88 
	mthrdnum
;

91 
°ToThªad
 *
	gToThªad
[
NTHREADS
];

93 
±hªad_t
 
	gtid
[
NTHREADS
];

94 
pid_t
 
	gçid
[
NTHREADS
];

96 
	~<sys/sysˇŒ.h
>

97 
pid_t
 
	$gëtid
()

99  
	`sysˇŒ
(
SYS_gëtid
);

100 
	}
}

102 
	$˛ónup_h™dÀr
(*
¨g
)

104 
	`¥ötf
("+++ I¿%†+++\n", 
__func__
);

106 
	}
}

108 *
	$w‹kî
(*
msg
)

110 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

111 
i
;

113 
	`as£π
(
p°ToThªad
);

115 
çid
[
p°ToThªad
->
thrdnum
] = 
	`gëtid
();

118 
	`±hªad_˛ónup_push
(
˛ónup_h™dÀr
, 
p°ToThªad
);

123 
	`¥ötf
("*** W‹kî Thªad #%d ***\n", 
p°ToThªad
->
thrdnum
);

124 
i
 = 0; i < 30; i++) {

125 
	`DELAY_LOOP_SILENT
(25);

126 
	`¥ötf
("%d ", 
p°ToThªad
->
thrdnum
);

127 
	`fÊush
(
°dout
);

128 
	`r_¶ìp
(0, 100000000);

131 
	`¥ötf
("\n");

137 
	`±hªad_˛ónup_p›
(0);

138 
	`±hªad_exô
((*)0);

139 
	}
}

153 #i‡
deföed
 (
__löux__
Ë&& !deföed(
HAVE_SCHED_SETATTR
)

154 
	~<sys/sysˇŒ.h
>

158 #i‡
deföed
 (
__löux__
Ë&& !deföed(
SYS_sched_£èâr
Ë&& deföed(
__NR_sched_£èâr
)

159 
	#SYS_sched_£èâr
 
__NR_sched_£èâr


	)

162 #i‡
deföed
 (
__löux__
Ë&& !deföed(
SYS_sched_gë©å
Ë&& deföed(
__NR_sched_gë©å
)

163 
	#SYS_sched_gë©å
 
__NR_sched_gë©å


	)

166 #i‡
deföed
 (
__löux__
Ë&& !deföed(
HAVE_SCHED_SETATTR
Ë&& deföed(
SYS_sched_£èâr
)

167 
	#HAVE_SCHED_SETATTR


	)

169 
	töt32_t
;

170 
	tuöt32_t
;

171 
	tuöt64_t
;

173 
	ssched_©å
 {

174 
uöt32_t
 
	msize
;

175 
uöt32_t
 
	msched_pﬁicy
;

176 
uöt64_t
 
	msched_Êags
;

179 
öt32_t
 
	msched_ni˚
;

182 
uöt32_t
 
	msched_¥i‹ôy
;

185 
uöt64_t
 
	msched_ru¡ime
;

186 
uöt64_t
 
	msched_dódlöe
;

187 
uöt64_t
 
	msched_≥riod
;

190 
	$sched_£èâr
(
pid_t
 
pid
, c⁄° 
sched_©å
 *
©å
,

191 
Êags
)

193  
	`sysˇŒ
(
SYS_sched_£èâr
, 
pid
, 
©å
, 
Êags
);

194 
	}
}

196 
	$sched_gë©å
(
pid_t
 
pid
, 
sched_©å
 *
©å
, 
size
,

197 
Êags
)

199  
	`sysˇŒ
(
SYS_sched_gë©å
, 
pid
, 
©å
, 
size
, 
Êags
);

200 
	}
}

204 
	$gë_show_sched
(
thrdnum
, 
pid_t
 
thªadid
)

206 
sched_©å
 
schd©å
;

208 
schd©å
.
size
 = (
sched_©å
);

209 i‡(
	`sched_gë©å
(
thªadid
, &
schd©å
, (
sched_©å
), 0) <

211 
	`WARN
("sched_getattr(2) onÅhread %d failed;Éxited?\n",

212 
thªadid
);

214 
	`¥ötf
("[Thread #%d] %-16s ",

215 
thrdnum
,

216 (
schd©å
.
sched_pﬁicy
 =
SCHED_FIFO
) ? "SCHED_FIFO" :

217 (
schd©å
.
sched_pﬁicy
 =
SCHED_RR
) ? "SCHED_RR" :

218 (
schd©å
.
sched_pﬁicy
 =
SCHED_OTHER
) ? "SCHED_OTHER" :

219 (
schd©å
.
sched_pﬁicy
 =
SCHED_DEADLINE
) ? "SCHED_DEADLINE" :

220 (
schd©å
.
sched_pﬁicy
 =
SCHED_BATCH
) ? "SCHED_BATCH" :

222 
	`¥ötf
(" %2d %2d 0x%lx",

223 
schd©å
.
sched_¥i‹ôy
,

224 
schd©å
.
sched_ni˚
, schd©å.
sched_Êags
);

225 
	`¥ötf
("\n");

226 
	}
}

228 
	~<î∫o.h
>

229 
	$£t_sched
(
thrdnum
, 
pﬁicy
, 
π¥io
)

231 
sched_©å
 
schd©å
;

233 
schd©å
.
size
 = (
sched_©å
);

234 
schd©å
.
sched_pﬁicy
 = 
pﬁicy
;

235 
schd©å
.
sched_¥i‹ôy
 = 
π¥io
;

237 i‡(
çid
[
thrdnum
]) {

238 i‡(
	`sched_£èâr
(
çid
[
thrdnum
], &
schd©å
, 0) < 0)

239 
	`WARN
("sched_setattr(2) onÅhread #%d failed: "

241 "áÃódyÉxôed\n", 
thrdnum
);

243 
	}
}

245 
	$ch™ge_sched_pﬁicy_¥io
(
thrdnum
, 
thrd2ch™ge
, 
pﬁicy
,

246 
π¥io
)

248 i‡(
çid
[
thrdnum
])

249 
	`gë_show_sched
(
thrdnum
, 
çid
[thrdnum]);

252 i‡(
thrdnum
 =
thrd2ch™ge
) {

253 
¥ötf


255 
thrd2ch™ge
,

256 (
pﬁicy
 == 0) ? "SCHED_OTHER"

257 : (
pﬁicy
 == 1) ? "SCHED_FIFO"

258 : (
pﬁicy
 =2Ë? "SCHED_RR" : "<unknown>", 
π¥io
);

260 
	`£t_sched
(
thrd2ch™ge
, 
pﬁicy
, 
π¥io
);

261 
	`gë_show_sched
(
thrd2ch™ge
, 
çid
[thrd2change]);

263 
	}
}

265 
ölöe
 
	$ußge
(*
nm
)

267 
	`Ârötf
(
°dîr
,

274 
nm
, 
	`sched_gë_¥i‹ôy_mö
(
SCHED_FIFO
),

275 
	`sched_gë_¥i‹ôy_max
(
SCHED_FIFO
)

277 
	}
}

279 
	#ARGS_FAIL
(
∑øm
) do { \

280 i‡(
∑øm
 != -1) \

281 
	`Ârötf
(
°dîr
, "### %s: (atÜeast)Öarameter %d is invalid,Öl correct &Ñetry.\n\n", \

282 
¨gv
[0], 
∑øm
); \

283 
	`ußge
(
¨gv
[0]); \

284 
	`exô
 (
EXIT_FAILURE
); \

285 } 0)

	)

287 
	$maö
(
¨gc
, **
¨gv
)

289 
thrdnum
, 
pﬁicy
, 
π¥io
;

290 
i
, 
ªt
;

291 
±hªad_©å_t
 
©å
;

292 *
°©
 = 0;

295 i‡(
¨gc
 != 4)

296 
	`ARGS_FAIL
(-1);

298 
thrdnum
 = 
	`©oi
(
¨gv
[1]);

299 i‡(
thrdnum
 < 0 ||Åhrdnum >
NTHREADS
)

300 
	`ARGS_FAIL
(1);

302 
pﬁicy
 = 
	`©oi
(
¨gv
[2]);

303 i‡(
pﬁicy
 < 0 ||Öolicy >= 3)

304 
	`ARGS_FAIL
(2);

306 
π¥io
 = 
	`©oi
(
¨gv
[3]);

307 i‡(
π¥io
 < 
	`sched_gë_¥i‹ôy_mö
(
SCHED_FIFO
)

308 || 
π¥io
 > 
	`sched_gë_¥i‹ôy_max
(
SCHED_FIFO
))

309 
	`ARGS_FAIL
(3);

312 
	`±hªad_©å_öô
(&
©å
);

313 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

316 
i
 = 0; i < 
NTHREADS
; i++) {

317 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

318 i‡(!
ToThªad
[
i
])

319 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

321 
ToThªad
[
i
]->
thrdnum
 = i;

322 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

323 
w‹kî
, (*)
ToThªad
[
i
]);

324 i‡(
ªt
)

325 
	`FATAL
("±hªad_¸óã(ËÁûed! [%d]\n", 
ªt
);

327 
	`±hªad_©å_de°roy
(&
©å
);

329 
	`¶ìp
(1);

330 
	`¥ötf
("Scheduling\n"

333 
i
 = 0; i < 
NTHREADS
; i++)

334 
	`ch™ge_sched_pﬁicy_¥io
(
i
, 
thrdnum
, 
pﬁicy
, 
π¥io
);

338 i‡(
¨gc
 >2 && 
	`©oi
(
¨gv
[1]) == 1) {

340 
	`¥ötf
("%s: sending CANCEL REQUESTÅo workerÅhread 0 ...\n",

341 
__func__
);

342 
ªt
 = 
	`±hªad_ˇn˚l
(
tid
[0]);

343 i‡(
ªt
)

344 
	`FATAL
("±hªad_ˇn˚l—hªad 0ËÁûed! [%d]\n", 
ªt
);

349 
i
 = 0; i < 
NTHREADS
; i++) {

350 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

351 i‡(
ªt
)

352 
	`WARN
("±hªad_joö(ËÁûed! [%d]\n", 
ªt
);

354 
	`¥ötf
(" Thread #%d successfully joined; it "

355 "ãrmö©ed wôh sètus=%ld\n", 
i
, ()
°©
);

356 i‡(
°©
 =
PTHREAD_CANCELED
)

357 
	`¥ötf
(" : was CANCELED\n");

359 
	`‰ì
(
ToThªad
[
i
]);

362 
	`±hªad_exô
(
NULL
);

363 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch18/mt_copy.c

72 
	#_GNU_SOURCE


	)

73 
	~<°dio.h
>

74 
	~<°dlib.h
>

75 
	~<°rög.h
>

76 
	~<uni°d.h
>

77 
	~<sys/ty≥s.h
>

78 
	~<sys/°©.h
>

79 
	~<f˙é.h
>

80 
	~<as£π.h
>

81 
	~<±hªad.h
>

82 
	~"../../comm⁄.h
"

84 
	#MIN_THRDS
 2

	)

85 
	#MAX_THRDS
 5

	)

87 
	s°ToThªad
 {

89 
	mthrdnum
, 
	mthrdtŸÆ
;

91 
	mfd_§c
, 
	mfd_de°
;

93 
off_t
 
	m°¨t_off£t
;

94 
size_t
 
	mÀn
;

96 
	mªm
;

98 
°ToThªad
 *
	gToThªad
[
MAX_THRDS
];

99 
	ggVîbo£
 = 0;

107 
	$fd_ªad
(
fd
, *
dbuf
, 
size_t
 
n
, 
off_t
 
off
)

109 
ssize_t
 
rd
 = 0;

110 
size_t
 
å
 = 0;

113 
rd
 = 
	`¥ód
(
fd
, 
dbuf
, 
n
, 
off
);

114 i‡(
rd
 < 0)

116 i‡(
rd
 == 0)

118 
å
 +
rd
;

119 #ifde‡
DEBUG


120 
	`¥ötf
("Ñeque°ed=%9lu,á˘uÆrd=%9zu,ÅŸÆrd=%9zu\n", 
n
, 
rd
,

121 
å
);

123 } 
å
 < 
n
);

124  
å
;

125 
	}
}

127 
	$fd_wrôe
(
fd
, *
sbuf
, 
size_t
 
n
, 
off_t
 
off
)

129 
ssize_t
 
wr
 = 0;

130 
size_t
 
tw
 = 0;

133 
wr
 = 
	`pwrôe
(
fd
, 
sbuf
, 
n
, 
off
);

134 i‡(
wr
 < 0)

136 
tw
 +
wr
;

137 #ifde‡
DEBUG


138 
	`¥ötf
("Ñeque°ed=%9zu,á˘uÆwr=%9zu,ÅŸÆwr=%9lu\n", 
n
, 
wr
,

139 
tw
);

141 } 
tw
 < 
n
);

142  
tw
;

143 
	}
}

149 
	$__do_mt_c›y
(
fd_§c
, 
fd_de°
, 
off_t
 
°¨t_off£t
, 
size_t
 
Àn
)

151 *
buf
 = 
NULL
;

152 
ssize_t
 
ƒ
 = 0, 
nw
 = 0;

154 
	`VPRINT
("\n*** sèπ off:À¿:: {%zu:%lu} ***\n", 
°¨t_off£t
, 
Àn
);

160 
buf
 = 
	`mÆloc
(
Àn
);

161 i‡(!
buf
) {

162 
	`WARN
("mÆlo¯(%ldËÁûed!\n", 
Àn
);

166 
ƒ
 = 
	`fd_ªad
(
fd_§c
, 
buf
, 
Àn
, 
°¨t_off£t
);

167 
	`VPRINT
("Ñód %9ld ", 
ƒ
);

168 i‡(
ƒ
 < 0) {

169 
	`WARN
("read on src file failed\n");

170 
	`‰ì
(
buf
);

172 } i‡(
ƒ
 == 0)

175 
nw
 = 
	`fd_wrôe
(
fd_de°
, 
buf
, 
ƒ
, 
°¨t_off£t
);

176 
	`VPRINT
("wrŸê%9ld\n", 
nw
);

177 i‡(
nw
 < 0) {

178 
	`WARN
("write on dest file failed\n");

179 
	`‰ì
(
buf
);

183 
	`‰ì
(
buf
);

185 
	}
}

187 
	$˛ónup_h™dÀr
(*
¨g
)

189 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
¨g
;

190 
	`as£π
(
p°ToThªad
);

192 
	`¥ötf
("+++ I¿%s():thrd #%d +++\n", 
__func__
, 
p°ToThªad
->
thrdnum
);

194 
	}
}

196 *
	$w‹kî
(*
msg
)

198 
°ToThªad
 *
p°ToThªad
 = (°ToThªad *)
msg
;

199 
	`as£π
(
p°ToThªad
);

202 
	`±hªad_˛ónup_push
(
˛ónup_h™dÀr
, 
p°ToThªad
);

205 
	`VPRINT
("%s():thrd #%d: copy from offset %zu for %lu bytes (rem=%d)\n",

206 
__func__
,

207 
p°ToThªad
->
thrdnum
,

208 
p°ToThªad
->
°¨t_off£t
,

209 
p°ToThªad
->
Àn
,

210 
p°ToThªad
->
ªm


212 
	`__do_mt_c›y
(
p°ToThªad
->
fd_§c
,Ö°ToThªad->
fd_de°
,

213 
p°ToThªad
->
°¨t_off£t
,Ö°ToThªad->
Àn
);

217 i‡(
p°ToThªad
->
ªm
 &&

218 
p°ToThªad
->
thrdnum
 =p°ToThªad->
thrdtŸÆ
-1) {

219 
	`VPRINT
(" @@@ÜastÅhrd #%d,Ñem = %d bytes\n",

220 
p°ToThªad
->
thrdnum
,Ö°ToThªad->
ªm
);

221 
	`__do_mt_c›y
(
p°ToThªad
->
fd_§c
,Ö°ToThªad->
fd_de°
,

222 
p°ToThªad
->
°¨t_off£t
 +Ö°ToThªad->
Àn
,

223 
p°ToThªad
->
ªm
);

230 
	`±hªad_˛ónup_p›
(0);

231 
	`±hªad_exô
((*)0);

232 
	}
}

238 
	$do_mt_c›y
(
numthrds
, 
fd_§c
, 
fd_de°
, 
off_t
 
fsize
)

240 
i
, 
ªt
;

241 
±hªad_t
 
tid
[
MAX_THRDS
];

242 
±hªad_©å_t
 
©å
;

243 *
°©
=0;

244 
ªm
 = 
fsize
%
numthrds
;

247 
	`±hªad_©å_öô
(&
©å
);

248 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

251 
i
 = 0; i < 
numthrds
; i++) {

252 
ToThªad
[
i
] = 
	`ˇŒoc
(1, (
°ToThªad
));

253 i‡(!
ToThªad
[
i
])

254 
	`FATAL
("ˇŒo¯°ToThªad[%d] faûed!\n", 
i
);

258 
ToThªad
[
i
]->
thrdnum
 = i;

259 
ToThªad
[
i
]->
thrdtŸÆ
 = 
numthrds
;

261 
ToThªad
[
i
]->
fd_§c
 = fd_src;

262 
ToThªad
[
i
]->
fd_de°
 = fd_dest;

265 
ToThªad
[
i
]->
°¨t_off£t
 = i*(
fsize
/
numthrds
);

276 
ToThªad
[
i
]->
Àn
 = 
fsize
/
numthrds
;

279 
ToThªad
[
i
]->
ªm
 =Ñem;

281 
ªt
 = 
	`±hªad_¸óã
(&
tid
[
i
], &
©å
,

282 
w‹kî
, (*)
ToThªad
[
i
]);

283 i‡(
ªt
)

284 
	`FATAL
("[%d]Öthªad_¸óã(ËÁûed! [%d]\n", 
i
, 
ªt
);

285 
	`VPRINT
("Thªad #%d suc˚ssfuŒy cª©ed\n", 
i
);

287 
	`±hªad_©å_de°roy
(&
©å
);

291 i‡(
¨gc
 >2 && 
	`©oi
(
¨gv
[1]) == 1) {

293 
	`¥ötf
("%s: sending CANCEL REQUESTÅo workerÅhread 0 ...\n",

294 
__func__
);

295 
ªt
 = 
	`±hªad_ˇn˚l
(
tid
[0]);

296 i‡(
ªt
)

297 
	`FATAL
("±hªad_ˇn˚l—hªad 0ËÁûed! [%d]\n", 
ªt
);

302 
i
 = 0; i < 
numthrds
; i++) {

303 
ªt
 = 
	`±hªad_joö
(
tid
[
i
], (**)&
°©
);

304 i‡(
ªt
)

305 
	`WARN
("[%d]Öthªad_joö(ËÁûed! [%d]\n", 
i
, 
ªt
);

307 
	`VPRINT
(" Thread #%d successfully joined; it "

308 "ãrmö©ed wôh sètus=%ld\n", 
i
, ()
°©
);

309 i‡(
°©
 =
PTHREAD_CANCELED
)

310 
	`VPRINT
(" : was CANCELED\n");

312 
	`‰ì
(
ToThªad
[
i
]);

316 
	}
}

318 
	$maö
(
¨gc
, **
¨gv
)

320 
numthrds
, 
fdr
, 
fdw
, 
ªt
 = 0;

321 
°©
 
sb
;

323 i‡(
¨gc
 < 4) {

324 
	`Ârötf
(
°dîr
, "Usage: %s source-file destination-file"

325 "Çumbî-of-thªad†[1 f‹ vîbo£-mode]\n", 
¨gv
[0]);

326 
	`exô
(
EXIT_FAILURE
);

328 
numthrds
 = 
	`©oi
(
¨gv
[3]);

329 i‡(
numthrds
 < 
MIN_THRDS
 ||Çumthrd†> 
MAX_THRDS
) {

330 
	`Ârötf
(
°dîr
, "Usage: %s source-file destination-file"

331 "Çumbî-of-thªad†[1 f‹ vîbo£-mode]\n", 
¨gv
[0]);

332 
	`Ârötf
(
°dîr
, "Çumber-of-threads invalid; should be in"

333 "Åhêøngê{%d,%d}\n", 
MIN_THRDS
, 
MAX_THRDS
);

334 
	`exô
(
EXIT_FAILURE
);

336 i‡(
¨gc
 =5 && (!
	`°rcmp
(
¨gv
[4], "1")))

337 
gVîbo£
 = 1;

340 
fdr
 = 
	`›í
(
¨gv
[1], 
O_RDONLY
);

341 i‡(
fdr
 < 0)

342 
	`FATAL
("open on source file \"%s\" failed,áborting.\n",

343 
¨gv
[1]);

346 i‡(
	`°©
(
¨gv
[1], &
sb
) < 0)

347 
	`FATAL
("°© o¿%†Áûed\n", 
¨gv
[1]);

348 
	`VPRINT
("Source file \"%s\" mode=0%o size=%lu bytes\n",

349 
¨gv
[1], 
sb
.
°_mode
 & 
ACCESSPERMS
, sb.
°_size
);

353 
fdw
 = 
	`›í
(
¨gv
[2], 
O_CREAT
 | 
O_WRONLY
, 
sb
.
°_mode
 & 
ACCESSPERMS
);

354 i‡(
fdw
 < 0)

355 
	`FATAL
("open on destination file \"%s\" failed,áborting.\n",

356 
¨gv
[2]);

358 
	`VPRINT
("# o‡thªad†tÿ•awn: %d\n", 
numthrds
);

359 i‡((
ªt
 = 
	`do_mt_c›y
(
numthrds
, 
fdr
, 
fdw
, 
sb
.
°_size
)) < 0) {

360 
	`˛o£
(
fdr
);

361 
	`˛o£
(
fdw
);

362 
	`FATAL
("doc›y(ËÁûed: (°©=%d)\n", 
ªt
);

364 i‡(
gVîbo£
 == 1)

365 
	`¥ötf
("\n");

367 
	`˛o£
(
fdr
);

368 
	`˛o£
(
fdw
);

370 
	`exô
(
EXIT_SUCCESS
);

371 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch3/segflt_nocore.c

26 
	#_GNU_SOURCE


	)

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<uni°d.h
>

30 
	~<°rög.h
>

31 
	~<î∫o.h
>

32 
	~<sys/time.h
>

33 
	~<sys/ªsour˚.h
>

34 
	~"../../comm⁄.h
"

42 
	$maö
(
¨gc
, **
¨gv
)

44 
æimô
 
æim
;

45 *
p
;

48 
	`¥ötf
("%s: sëtög c‹êfûêªsour˚ÜimôÅÿ0 ...\n", 
¨gv
[0]);

49 
	`mem£t
(&
æim
, 0, (
æimô
));

50 i‡(
	`¥limô
(0, 
RLIMIT_CORE
, &
æim
, 0) < 0)

51 
	`FATAL
("prlimit(2) on core failed\n");

53 
p
 = 
	`mÆloc
(500);

54 i‡(!
p
)

55 
	`FATAL
("malloc 500 failed!\n");

56 
	`¥ötf
("\n0.Ö=mÆloc(500);Ö = %p\n", 
p
+100);

58 
	`¥ötf
("\n1. Doög: *’+100Ë = 'a'; i.e. [%p]='a'; should w‹k\n", 
p
+100);

59 *(
p
 + 100) = 'a';

61 
	`¥ötf
("\n2. Doög: *’+4000Ë = 'b'; i.e. [%p]='b'; should NŸ w‹k\n", 
p
+4000);

62 *(
p
 + 4000) = 'b';

63 
	`¥ötf
("... but it does!\n"

64 "Why? beˇu£Åhêa˘uÆ cuºíà¥ogøm bªak i†%p\n", 
	`sbrk
(0));

67 
	`¥ötf
("\n3. Doög: *’+40000Ë'c'; i.e. [%p]='b'; should NŸ w‹k\n", 
p
+40000);

68 *(
p
 + 40000) = 'c';

69 
	`¥ötf
("... but it does!\n"

70 "Why? beˇu£Åhêa˘uÆ cuºíà¥ogøm bªak i†%p\n", 
	`sbrk
(0));

72 
	`¥ötf
("\n4. Doög: *’+800000Ë'c'; i.e. [%p]='b'; should NŸ w‹k\n", 
p
+800000);

73 *(
p
 + 800000) = 'c';

75 
	`exô
(
EXIT_SUCCESS
);

76 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch4/memprot.c

20 
	#_GNU_SOURCE


	)

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<uni°d.h
>

24 
	~<sys/ty≥s.h
>

25 
	~<sys/mm™.h
>

27 
	ggPgsz
;

29 
	$maö
(
¨gc
, **
¨gv
)

31 *
±r
 = 
NULL
;

33 
gPgsz
 = 
	`gë∑gesize
();

36 
	`posix_memÆign
(&
±r
, 
gPgsz
, 2*gPgsz);

37 i‡(!
±r
) {

38 
	`Ârötf
(
°dîr
,"posix_memÆign(f‹ %u byãsËÁûed\n", 4*
gPgsz
);

39 
	`exô
(1);

43 
	`¥ötf
("Aâem±ögÅÿ£àmem‹yÖrŸe˘i⁄†o‡%∞tÿ[r-x]...\n", 
±r
);

44 i‡(
	`m¥Ÿe˘
((*)
±r
, 
gPgsz
, 
PROT_READ
|
PROT_EXEC
) == -1)

45 
	`Ârötf
(
°dîr
," *** mprotect(r-x) failed\n");

47 
	`¥ötf
(" [r-x] successful\n");

58 
	`¥ötf
("Aâem±ögÅÿ£àmem‹yÖrŸe˘i⁄†o‡%∞tÿ[r--]...\n", 
±r
+
gPgsz
);

59 i‡(
	`m¥Ÿe˘
((*)
±r
+
gPgsz
, gPgsz, 
PROT_READ
) == -1)

60 
	`Ârötf
(
°dîr
," *** mprotect(r--) failed\n");

62 
	`¥ötf
(" [r--] successful\n");

65 
	`‰ì
(
±r
);

66 
	`exô
 (
EXIT_SUCCESS
);

67 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch7/query_creds.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<sys/ty≥s.h
>

23 
	~"../../comm⁄.h
"

25 
	#SHOW_CREDS
() do { \

26 
	`¥ötf
("RUID=%d EUID=%d\n" \

28 
	`gëuid
(), 
	`gëeuid
(), \

29 
	`gëgid
(), 
	`gëegid
()); \

30 } 0)

	)

32 
	$maö
(
¨gc
, **
¨gv
)

34 
	`SHOW_CREDS
();

35 i‡(
	`gëeuid
() == 0) {

36 
	`¥ötf
("%†nowÉf„˘ivñyÑu¬ögá†roŸ! ...\n", 
¨gv
[0]);

37 
	`¶ìp
(1);

39 
	`exô
 (
EXIT_SUCCESS
);

40 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch8/assgn1.c

48 
	#_GNU_SOURCE


	)

49 
	~<°dio.h
>

50 
	~<°dlib.h
>

51 
	~<uni°d.h
>

52 
	~<sys/ty≥s.h
>

53 
	~"../../comm⁄.h
"

55 
	#SHOW_CREDS
() do { \

56 
	`¥ötf
("RUID=%d EUID=%d\n" \

58 
	`gëuid
(), 
	`gëeuid
(), \

59 
	`gëgid
(), 
	`gëegid
()); \

60 } 0)

	)

62 
	$maö
(
¨gc
, **
¨gv
)

64 
	`SHOW_CREDS
();

65 i‡(
	`gëeuid
() == 0) {

66 
	`¥ötf
("%†nowÉf„˘ivñyÑu¬ögá†roŸ! ...\n", 
¨gv
[0]);

67 
	`¶ìp
(1);

69 i‡(
	`chown
(
¨gv
[0], 0, -1) < 0)

70 
	`FATAL
("chown(2) failed\n");

71 
	`exô
 (
EXIT_SUCCESS
);

72 
	}
}

	@Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch9/exec_pid_poc.c

18 
	#_GNU_SOURCE


	)

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<°rög.h
>

22 
	~<uni°d.h
>

23 
	~<sys/ty≥s.h
>

39 
	$maö
(
¨gc
, **
¨gv
)

41 
	`¥ötf
("Pªde˚ss‹ [%s]: PID i†%d\n", 
¨gv
[0], 
	`gëpid
());

42 i‡(
	`exe˛p
("ps", "ps", (*)0) == -1) {

43 
	`≥º‹
("execl(ps) failed");

44 
	`exô
 (
EXIT_FAILURE
);

46 
	`exô
 (
EXIT_SUCCESS
);

47 
	}
}

	@Books/Linux-Kernel-Debugging/ch10/kthread_stuck/kthread_stuck.c

22 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

24 
	~<löux/öô.h
>

25 
	~<löux/moduÀ.h
>

26 
	~<löux/sched.h
>

27 
	~<löux/sched/èsk.h
>

28 
	~<löux/sched/sig«l.h
>

29 
	~<löux/sig«l.h
>

30 
	~<löux/kthªad.h
>

31 
	~<asm/©omic.h
>

32 
	~<löux/•ölock.h
>

33 
	~"../../c⁄víõ¡.h
"

35 
	#KTHREAD_NAME
 "kt_°uck"

	)

36 
	#DO_SOFT_LOCKUP
 1

	)

37 
	#DO_HARD_LOCKUP
 2

	)

39 
MODULE_AUTHOR
("[insertÇame]");

40 
MODULE_DESCRIPTION
("a simple LKMÅo demoÅhe kernel softlockup detector!");

41 
MODULE_LICENSE
("Dual MIT/GPL");

42 
MODULE_VERSION
("0.1");

44 
	glockup_ty≥
 = 
DO_SOFT_LOCKUP
;

45 
moduÀ_∑øm
(
lockup_ty≥
, , 0);

46 
MODULE_PARM_DESC
(
lockup_ty≥
, "specifyÅheÜockupÅype;Öass 1 for softÜockup (default), 2 for hardÜockup");

48 
èsk_°ru˘
 *
	ggkthrd_ts
;

49 
•ölock_t
 
	g•ölock
;

52 
	$sim∂e_kthªad
(*
¨g
)

54 
u64
 
i
 = 0;

56 
	`PRINT_CTX
();

57 i‡(!
cuºít
->
mm
)

58 
	`¥_öfo
("mm field NULL, weáreá kernelÅhread!\n");

64 
	`Ælow_sig«l
(
SIGINT
);

65 
	`Ælow_sig«l
(
SIGQUIT
);

67 !
	`kthªad_should_°›
()) {

69 
	`¥_öfo
("DELIBERATELY spinning on CPU coreÇow...\n");

71 i‡(
lockup_ty≥
 =
DO_SOFT_LOCKUP
)

72 
	`•ö_lock
(&
•ölock
);

74 
	`•ö_lock_úq
(&
•ölock
);

76 
i
 < 10000000000) {

77 
i
 ++;

78 i‡(!(
i
%50000000))

79 
	`PRINT_CTX
();

82 i‡(
lockup_ty≥
 =
DO_SOFT_LOCKUP
)

83 
	`•ö_u∆ock
(&
•ölock
);

85 
	`•ö_u∆ock_úq
(&
•ölock
);

88 
	`¥_öfo
("FYI, I, kernelÅhread PID %d,ám goingÅo sleepÇow...\n",

89 
cuºít
->
pid
);

90 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

91 
	`scheduÀ
();

95 i‡(
	`sig«l_≥ndög
(
cuºít
))

100 
	`£t_cuºít_°©e
(
TASK_RUNNING
);

101 
	`¥_öfo
("FYI, I, kernelÅhread PID %d, have beenÑudelyáwoken; I shall"

102 "ÇowÉxô... Good day Sú!\n", 
cuºít
->
pid
);

105 
	}
}

107 
	$kthªad_sim∂e_öô
()

109 
ªt
=0;

111 i‡(
lockup_ty≥
 !
DO_SOFT_LOCKUP
 &&Üockup_ty≥ !
DO_HARD_LOCKUP
) {

112 
	`¥_öfo
("passÖarameterÜockup_type correctly\n");

113  -
EINVAL
;

115 
	`¥_öfo
("locku∞ty≥Åÿã°: %s\n", 
lockup_ty≥
 =
DO_HARD_LOCKUP
 ? "hard":"soft");

117 
	`•ö_lock_öô
(&
•ölock
);

118 
	`¥_öfo
("LetsÇow createá kernelÅhread...\n");

126 
gkthrd_ts
 = 
	`kthªad_run
(
sim∂e_kthªad
, 
NULL
, "lkd/%s", 
KTHREAD_NAME
);

127 i‡(
	`IS_ERR
(
gkthrd_ts
)) {

128 
ªt
 = 
	`PTR_ERR
(
gkthrd_ts
);

129 
	`¥_îr
("kthªad cª©i⁄ faûed (%d)\n", 
ªt
);

130  
ªt
;

132 
	`gë_èsk_°ru˘
(
gkthrd_ts
);

136 
	`¥_öfo
("Initialized, kernelÅhreadÅaskÖtr is 0x%pK (actual=0x%px)\n"

138 
gkthrd_ts
, gkthrd_ts, 
KTHREAD_NAME
);

141 
	}
}

143 
	$kthªad_sim∂e_exô
()

145 
	`kthªad_°›
(
gkthrd_ts
);

150 
	`¥_öfo
("kthread stopped,ánd LKMÑemoved.\n");

151 
	}
}

153 
moduÀ_öô
(
kthªad_sim∂e_öô
);

154 
moduÀ_exô
(
kthªad_sim∂e_exô
);

	@Books/Linux-Kernel-Debugging/ch10/letspanic/letspanic.c

18 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

24 
MODULE_AUTHOR
("<insert yourÇame here>");

25 
MODULE_DESCRIPTION
("LKD book:ch10/letspanic: deliberately causeá kernelÖanic");

26 
MODULE_LICENSE
("Dual MIT/GPL");

27 
MODULE_VERSION
("0.1");

29 
	gmyglobÆ°©e
 = 0xeee;

30 
__öô
 
	$Àt•™ic_öô
()

32 
	`¥_w¨n
("Hello,Öanic world (yay!)\n");

33 
	`∑nic
("whﬂ,á kî√»∑nic! myglobÆ°©ê0x%x", 
myglobÆ°©e
);

36 
	}
}

37 
moduÀ_öô
(
Àt•™ic_öô
);

41 
__exô
 
	$Àt•™ic_exô
()

43 
	`¥_öfo
("Goodbye,Öanic world\n");

44 
	}
}

45 
moduÀ_exô
(
Àt•™ic_exô
);

	@Books/Linux-Kernel-Debugging/ch10/panic_notifier/panic_notifier_lkm.c

21 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

22 
	~<löux/öô.h
>

23 
	~<löux/moduÀ.h
>

24 
	~<löux/dñay.h
>

27 
	~<löux/vîsi⁄.h
>

28 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(5, 14, 0)

29 
	~<löux/∑nic_nŸifõr.h
>

31 
	~<löux/nŸifõr.h
>

35 
MODULE_LICENSE
("Dual MIT/GPL");

40 
	$dev_rög_Æ¨m
()

42 
	`¥_emîg
("!!! ALARM !!!\n");

43 
	}
}

45 
	$my∑nic_h™dÀr
(
nŸifõr_block
 *
nb
, 
vÆ
, *
d©a
)

47 
	`¥_emîg
("\n************ P™i¯: SOUNDING ALARM ************\n\
 = %lu\n\
(°rË\"%s\"\n", 
vÆ
, (*)
d©a
);

50 
	`dev_rög_Æ¨m
();

52  
NOTIFY_OK
;

53 
	}
}

55 
nŸifõr_block
 
	gmy∑nic_nb
 = {

56 .
nŸifõr_ˇŒ
 = 
my∑nic_h™dÀr
,

60 
__öô
 
	$∑nic_nŸifõr_lkm_öô
()

62 
	`©omic_nŸifõr_chaö_ªgi°î
(&
∑nic_nŸifõr_li°
, &
my∑nic_nb
);

63 
	`¥_öfo
("RegisteredÖanicÇotifier\n");

71 
	`mdñay
(500);

72 
	`∑nic
("Linux Kernel Debugging!");

76 
	}
}

78 
__exô
 
	$∑nic_nŸifõr_lkm_exô
()

80 
	`©omic_nŸifõr_chaö_uƒegi°î
(&
∑nic_nŸifõr_li°
, &
my∑nic_nb
);

81 
	`¥_öfo
("UnregisteredÖanicÇotifier\n");

82 
	}
}

84 
moduÀ_öô
(
∑nic_nŸifõr_lkm_öô
);

85 
moduÀ_exô
(
∑nic_nŸifõr_lkm_exô
);

	@Books/Linux-Kernel-Debugging/ch10/workq_stall/workq_stall.c

35 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

37 
	~<löux/öô.h
>

38 
	~<löux/kî√l.h
>

39 
	~<löux/moduÀ.h
>

40 
	~<löux/w‹kqueue.h
>

41 
	~<löux/timî.h
>

42 
	~<löux/dñay.h
>

43 
	~"../../c⁄víõ¡.h
"

45 
	#INITIAL_VALUE
 3

	)

47 
MODULE_AUTHOR
("[insertÇame]");

48 
MODULE_DESCRIPTION
("a LKMÅo demoá simple workqueue stall");

49 
MODULE_LICENSE
("Dual MIT/GPL");

50 
MODULE_VERSION
("0.1");

52 
	s°_˘x
 {

53 
w‹k_°ru˘
 
	mw‹k
;

54 
timî_li°
 
	mtmr
;

55 
	md©a
;

56 } 
	g˘x
;

57 
	gexp_ms
 = 420;

58 
u64
 
	gt1
, 
	gt2
;

63 
	$dög
(
timî_li°
 *
timî
)

65 
°_˘x
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
tmr
);

67 
	`¥_öfo
("timed out... d©a=%d\n", 
¥iv
->
d©a
);

68 
¥iv
->
d©a
--;

69 
	`PRINT_CTX
();

72 i‡(
¥iv
->
d©a
)

73 
	`mod_timî
(&
¥iv
->
tmr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
));

76 i‡(!
	`scheduÀ_w‹k
(&
¥iv
->
w‹k
)) {

77 
	`¥_nŸi˚
("notádded work itemás it'sálready onÅhe kernel-global workqueue!\n");

80 
t1
 = 
	`ktime_gë_ªÆ_ns
();

81 
	}
}

86 
	$w‹k_func
(
w‹k_°ru˘
 *
w‹k
)

88 
°_˘x
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, st_ctx, work);

89 
u64
 
i
 = 0;

91 
t2
 = 
	`ktime_gë_ªÆ_ns
();

92 
	`¥_öfo
("I¿ou∏w‹kq fun˘i⁄: d©a=%d\n", 
¥iv
->
d©a
);

93 
	`PRINT_CTX
();

94 
	`SHOW_DELTA
(
t2
, 
t1
);

99 
	`¥_öfo
("DeliberatelyÜocking upÅhe cpuÇow!\n");

101 
i
 += 3;

102 
	}
}

104 
__öô
 
	$w‹kq_sim∂e_öô
()

106 
u64
 
i
 = 0;

108 
	`¥_öfo
("DeliberatelyÜocking upÅhe cpuÇow!\n");

110 
i
 ++;

113 
˘x
.
d©a
 = 
INITIAL_VALUE
;

116 
	`INIT_WORK
(&
˘x
.
w‹k
, 
w‹k_func
);

119 
˘x
.
tmr
.
expúes
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
);

120 
˘x
.
tmr
.
Êags
 = 0;

121 
	`timî_£tup
(&
˘x
.
tmr
, 
dög
, 0);

123 
	`¥_öfo
("W‹k queuêöôülized,Åimî sëÅÿexpúêö %ld ms\n", 
exp_ms
);

124 
	`add_timî
(&
˘x
.
tmr
);

127 
	}
}

129 
__exô
 
	$w‹kq_sim∂e_exô
()

132 i‡(
	`ˇn˚l_w‹k_sync
(&
˘x
.
w‹k
))

133 
	`¥_öfo
("yes,Åhere was indeed someÖending work;Çow done...\n");

138 
	`dñ_timî_sync
(&
˘x
.
tmr
);

139 
	`¥_öfo
("removed\n");

140 
	}
}

142 
moduÀ_öô
(
w‹kq_sim∂e_öô
);

143 
moduÀ_exô
(
w‹kq_sim∂e_exô
);

	@Books/Linux-Kernel-Debugging/ch11/kgdb_try/kgdb_try.c

17 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

19 
	~<löux/öô.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/kî√l.h
>

22 
	~<löux/¶ab.h
>

23 
	~<löux/øndom.h
>

24 
	~<löux/w‹kqueue.h
>

25 
	~<löux/dñay.h
>

26 
	~"../../c⁄víõ¡.h
"

28 
MODULE_AUTHOR
("<insert yourÇame here>");

29 
MODULE_DESCRIPTION
("LKD book:ch11/kgdb_try: support forá simple demo using KGDB oná module");

30 
MODULE_LICENSE
("Dual MIT/GPL");

31 
MODULE_VERSION
("0.1");

33 
	#NUM
 32

	)

34 
u8
 
	ggd©a
[
NUM
];

36 
do_the_w‹k
(
w‹k_°ru˘
 *);

37 
DECLARE_DELAYED_WORK
(
my_w‹k
, 
do_the_w‹k
);

42 
	$do_the_w‹k
(
w‹k_°ru˘
 *
w‹k
)

44 
u8
 
buf
[10];

45 
i
;

47 
	`¥_öfo
("In our workq function\n");

48 
i
=0; i <=10; i++)

49 
buf
[
i
] = (
u8
)i;

50 
	`¥öt_hex_dump_byãs
("", 
DUMP_PREFIX_OFFSET
, 
buf
, 10);

61 
	`¥_öfo
("done\n");

62 
	}
}

64 
__öô
 
	$kgdb_åy_öô
()

66 
	`¥_öfo
("Generating Oops via kernel bug iná delayed workqueue function\n");

67 
	`INIT_DELAYED_WORK
(&
my_w‹k
, 
do_the_w‹k
);

68 
	`scheduÀ_dñayed_w‹k
(&
my_w‹k
, 
	`m£cs_to_jiffõs
(2500));

71 
	}
}

73 
__exô
 
	$kgdb_åy_exô
()

75 
	`ˇn˚l_dñayed_w‹k_sync
(&
my_w‹k
);

76 
	`¥_öfo
("Goodbye\n");

77 
	}
}

79 
moduÀ_öô
(
kgdb_åy_öô
);

80 
moduÀ_exô
(
kgdb_åy_exô
);

	@Books/Linux-Kernel-Debugging/ch3/miscdrv_rdwr/miscdrv_rdwr.c

34 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

36 
	~<löux/öô.h
>

37 
	~<löux/moduÀ.h
>

38 
	~<löux/miscdevi˚.h
>

39 
	~<löux/¶ab.h
>

40 
	~<löux/mm.h
>

41 
	~<löux/fs.h
>

42 
	~<löux/sched.h
>

45 
	~<löux/vîsi⁄.h
>

46 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

47 
	~<löux/uac˚ss.h
>

49 
	~<asm/uac˚ss.h
>

52 
	~"../../c⁄víõ¡.h
"

54 
	#OURMODNAME
 "miscdrv_rdwr"

	)

55 
MODULE_AUTHOR
("Kaiwan N Billimoria");

56 
MODULE_DESCRIPTION
("LKD book:ch5/miscdrv_rdwr: simple misc char driver with"

58 
MODULE_LICENSE
("Dual MIT/GPL");

59 
MODULE_VERSION
("0.1");

61 
	gga
, 
	ggb
 = 1;

67 
	sdrv_˘x
 {

68 
devi˚
 *
	mdev
;

69 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
;

70 
u32
 
	mc⁄fig1
, 
	mc⁄fig2
;

71 
u64
 
	mc⁄fig3
;

72 
	#MAXBYTES
 128

	)

74 
	mour£¸ë
[
MAXBYTES
];

76 
drv_˘x
 *
	g˘x
;

89 
	$›í_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

91 
devi˚
 *
dev
 = 
˘x
->dev;

92 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

94 i‡(
	`u∆ikñy
(!
buf
))

95  -
ENOMEM
;

97 
	`PRINT_CTX
();

98 
ga
++;

99 
gb
--;

100 
	`dev_dbg
(
dev
, " opening \"%s\"Çow; wrt open file: f_flags = 0x%x\n",

101 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
), fûp->
f_Êags
);

102 
	`k‰ì
(
buf
);

104  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

105 
	}
}

116 
ssize_t
 
	$ªad_miscdrv_rdwr
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

117 
size_t
 
cou¡
, 
loff_t
 *
off
)

119 
ªt
 = 
cou¡
, 
£¸ë_Àn
 = 
	`°∫Àn
(
˘x
->
our£¸ë
, 
MAXBYTES
);

120 
devi˚
 *
dev
 = 
˘x
->dev;

121 
èsknm
[
TASK_COMM_LEN
];

123 
	`PRINT_CTX
();

124 
	`dev_dbg
(
dev
, "%†w™t†tÿªad (u±oË%zu byãs\n", 
	`gë_èsk_comm
(
èsknm
, 
cuºít
), 
cou¡
);

126 
ªt
 = -
EINVAL
;

127 i‡(
cou¡
 < 
MAXBYTES
) {

128 
	`dev_w¨n
(
dev
, "request # of bytes (%zu) is <Ñequired size"

129 " (%d),áb‹tögÑód\n", 
cou¡
, 
MAXBYTES
);

130 
out_nŸok
;

132 i‡(
£¸ë_Àn
 <= 0) {

133 
	`dev_w¨n
(
dev
, "whoops, something's wrong,Åhe 'secret' isn't"

135 
out_nŸok
;

149 
ªt
 = -
EFAULT
;

150 i‡(
	`c›y_to_u£r
(
ubuf
, 
˘x
->
our£¸ë
, 
£¸ë_Àn
)) {

151 
	`dev_w¨n
(
dev
, "copy_to_user() failed\n");

152 
out_nŸok
;

154 
ªt
 = 
£¸ë_Àn
;

157 
˘x
->
tx
 +
£¸ë_Àn
;

158 
	`dev_dbg
(
dev
, " %d bytesÑead,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

159 
£¸ë_Àn
, 
˘x
->
tx
, ctx->
rx
);

160 
out_nŸok
:

161  
ªt
;

162 
	}
}

173 
ssize_t
 
	$wrôe_miscdrv_rdwr
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

174 
size_t
 
cou¡
, 
loff_t
 *
off
)

176 
ªt
 = 
cou¡
;

177 *
kbuf
 = 
NULL
;

178 
devi˚
 *
dev
 = 
˘x
->dev;

179 
èsknm
[
TASK_COMM_LEN
];

181 
	`PRINT_CTX
();

182 i‡(
	`u∆ikñy
(
cou¡
 > 
MAXBYTES
)) {

183 
	`dev_w¨n
(
dev
, "count %zuÉxceeds max # of bytesállowed, "

184 "ab‹tög wrôe\n", 
cou¡
);

185 
out_nomem
;

187 
	`dev_dbg
(
dev
, "%†w™t†tÿwrôê%zu byãs\n", 
	`gë_èsk_comm
(
èsknm
, 
cuºít
), 
cou¡
);

189 
ªt
 = -
ENOMEM
;

190 
kbuf
 = 
	`kvmÆloc
(
cou¡
, 
GFP_KERNEL
);

191 i‡(
	`u∆ikñy
(!
kbuf
))

192 
out_nomem
;

193 
	`mem£t
(
kbuf
, 0, 
cou¡
);

202 
ªt
 = -
EFAULT
;

203 i‡(
	`c›y_‰om_u£r
(
kbuf
, 
ubuf
, 
cou¡
)) {

204 
	`dev_w¨n
(
dev
, "copy_from_user() failed\n");

205 
out_cfu
;

213 
	`°æ˝y
(
˘x
->
our£¸ë
, 
kbuf
, (
cou¡
 > 
MAXBYTES
 ? MAXBYTES : count));

216 
	`¥öt_hex_dump_byãs
("˘x ", 
DUMP_PREFIX_OFFSET
,

217 
˘x
, (
drv_˘x
));

220 
˘x
->
rx
 +
cou¡
;

222 
ªt
 = 
cou¡
;

223 
	`dev_dbg
(
dev
, " %zu bytes written,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

224 
cou¡
, 
˘x
->
tx
, ctx->
rx
);

225 
out_cfu
:

226 
	`kv‰ì
(
kbuf
);

227 
out_nomem
:

228  
ªt
;

229 
	}
}

237 
	$˛o£_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

239 
devi˚
 *
dev
 = 
˘x
->dev;

240 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

242 i‡(
	`u∆ikñy
(!
buf
))

243  -
ENOMEM
;

245 
	`PRINT_CTX
();

246 
ga
--;

247 
gb
++;

248 
	`dev_dbg
(
dev
, " fûíame: \"%s\"\n", 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
));

249 
	`k‰ì
(
buf
);

252 
	}
}

255 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

256 .
›í
 = 
›í_miscdrv_rdwr
,

257 .
	gªad
 = 
ªad_miscdrv_rdwr
,

258 .
	gwrôe
 = 
wrôe_miscdrv_rdwr
,

259 .
	gŒ£ek
 = 
no_Œ£ek
,

260 .
	gªÀa£
 = 
˛o£_miscdrv_rdwr
,

271 
miscdevi˚
 
	gŒkd_miscdev
 = {

272 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

273 .
	g«me
 = "llkd_miscdrv_rdwr",

276 .
	gmode
 = 0666,

277 .
	gf›s
 = &
Œkd_misc_f›s
,

280 
__öô
 
	$miscdrv_rdwr_öô
()

282 
ªt
 = 0;

283 
devi˚
 *
dev
;

285 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

286 i‡(
ªt
) {

287 
	`¥_nŸi˚
("%s: mis¯devi˚Ñegi°øti⁄ faûed,áb‹tög\n", 
OURMODNAME
);

288  
ªt
;

291 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

293 
	`¥_öfo
("LLKD misc driver (major # 10)Ñegistered, minor# = %d,"

294 " devÇodêi†/dev/%s\n", 
Œkd_miscdev
.
mö‹
,Ülkd_miscdev.
«me
);

302 
˘x
 = 
	`devm_kzÆloc
(
dev
, (
drv_˘x
), 
GFP_KERNEL
);

303 i‡(
	`u∆ikñy
(!
˘x
))

304  -
ENOMEM
;

306 
˘x
->
dev
 = dev;

308 
	`°æ˝y
(
˘x
->
our£¸ë
, "initmsg", 8);

309 
	`dev_dbg
(
˘x
->
dev
, "A sampleÖrint viaÅhe dev_dbg(): driver initialized\n");

312 
	}
}

314 
__exô
 
	$miscdrv_rdwr_exô
()

316 
	`misc_dîegi°î
(&
Œkd_miscdev
);

317 
	`¥_öfo
("LLKD misc (rdwr) driver deregistered, bye\n");

318 
	}
}

320 
moduÀ_öô
(
miscdrv_rdwr_öô
);

321 
moduÀ_exô
(
miscdrv_rdwr_exô
);

	@Books/Linux-Kernel-Debugging/ch3/miscdrv_rdwr/rdwr_test_secret.c

23 
	~<°dio.h
>

24 
	~<uni°d.h
>

25 
	~<°rög.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<limôs.h
>

28 
	~<sys/°©.h
>

29 
	~<f˙é.h
>

30 
	~<°dlib.h
>

32 
	#MAXBYTES
 128

	)

34 
	g°ay_Æive
;

36 
ölöe
 
	$ußge
(*
¥g
)

38 
	`Ârötf
(
°dîr
,

42 " (max %d byãs)\n", 
¥g
, 
MAXBYTES
);

43 
	}
}

45 
	$maö
(
¨gc
, **
¨gv
)

47 
›t
 = 'r';

48 
fd
, 
Êags
 = 
O_RDONLY
;

49 
ssize_t
 
n
;

50 *
buf
 = 
NULL
;

51 
size_t
 
num
 = 0;

53 i‡(
¨gc
 < 3) {

54 
	`ußge
(
¨gv
[0]);

55 
	`exô
(
EXIT_FAILURE
);

58 
›t
 = 
¨gv
[1][0];

59 i‡(
›t
 != 'r' && opt != 'w') {

60 
	`ußge
(
¨gv
[0]);

61 
	`exô
(
EXIT_FAILURE
);

63 i‡((
›t
 ='w' && 
¨gc
 != 4) || (opt == 'r' &&árgc != 3)) {

64 
	`ußge
(
¨gv
[0]);

65 
	`exô
(
EXIT_FAILURE
);

67 i‡('w' =
›t
 && 
	`°∫Àn
(
¨gv
[3], 
MAXBYTES
) > MAXBYTES) {

68 
	`Ârötf
(
°dîr
, "%s:Åoo bigá secret (%zu bytes);ÖlÑestrict"

69 "Åÿ%d byã†max\n", 
¨gv
[0], 
	`°∫Àn
(argv[3],

70 
MAXBYTES
),

71 
MAXBYTES
);

72 
	`exô
(
EXIT_FAILURE
);

75 i‡('w' =
›t
)

76 
Êags
 = 
O_WRONLY
;

77 
fd
 = 
	`›í
(
¨gv
[2], 
Êags
, 0);

78 i‡(
fd
 == -1) {

79 
	`Ârötf
(
°dîr
, "%s: o≥n(2Ë⁄ %†Áûed\n", 
¨gv
[0],árgv[2]);

80 
	`≥º‹
("open");

81 
	`exô
(
EXIT_FAILURE
);

83 
	`¥ötf
("Device file %s opened (in %s mode): fd=%d\n",

84 
¨gv
[2], (
Êags
 =
O_RDONLY
 ? "ªad-⁄ly" : "wrôe-⁄ly"), 
fd
);

86 i‡('w' =
›t
) {

87 
num
 = 
	`°∫Àn
(
¨gv
[3], 
MAXBYTES
) + 1;

88 i‡(
num
 > 
MAXBYTES
)

89 
num
 = 
MAXBYTES
;

91 
num
 = 
MAXBYTES
;

93 
buf
 = 
	`mÆloc
(
num
);

94 i‡(!
buf
) {

95 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!\n", 
¨gv
[0]);

96 
	`˛o£
(
fd
);

97 
	`exô
(
EXIT_FAILURE
);

100 i‡('r' =
›t
) {

101 
n
 = 
	`ªad
(
fd
, 
buf
, 
num
);

102 i‡(
n
 < 0) {

103 
	`≥º‹
("read failed");

104 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

105 
	`‰ì
(
buf
);

106 
	`˛o£
(
fd
);

107 
	`exô
(
EXIT_FAILURE
);

109 
	`¥ötf
("%s:Ñód %zd byã†‰om %s\n", 
¨gv
[0], 
n
,árgv[2]);

110 
	`¥ötf
("Thê'£¸ë' is:\¿\"%.*s\"\n", ()
n
, 
buf
);

112 
	`°∫˝y
(
buf
, 
¨gv
[3], 
num
);

113 
n
 = 
	`wrôe
(
fd
, 
buf
, 
num
);

114 i‡(
n
 < 0) {

115 
	`≥º‹
("write failed");

116 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

117 
	`‰ì
(
buf
);

118 
	`˛o£
(
fd
);

119 
	`exô
(
EXIT_FAILURE
);

121 
	`¥ötf
("%s: wrŸê%zd byã†tÿ%s\n", 
¨gv
[0], 
n
,árgv[2]);

124 i‡(
°ay_Æive
) {

125 
	`¥ötf
("%s:%d: sèyö'álivê(öÖau£()Ë... \n", 
¨gv
[0],

126 
	`gëpid
());

127 
	`∑u£
();

130 
	`‰ì
(
buf
);

131 
	`˛o£
(
fd
);

132 
	`exô
(
EXIT_SUCCESS
);

133 
	}
}

	@Books/Linux-Kernel-Debugging/ch3/printk_loglevels/printk_loglevels.c

21 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

23 
	~<löux/öô.h
>

24 
	~<löux/moduÀ.h
>

25 
	~<löux/kî√l.h
>

27 
MODULE_AUTHOR
("<insert yourÇame here>");

28 
MODULE_DESCRIPTION
("LKD book:ch5/printk_loglevels:ÖrintátÉach kernelÜogÜevel");

29 
MODULE_LICENSE
("Dual MIT/GPL");

30 
MODULE_VERSION
("0.1");

32 
__öô
 
	$¥ötk_logÀvñs_öô
()

34 
	`¥_emîg
("Hñlo, debug w‹ld @Üog-Àvñ KERN_EMERG [%d]\n", 
LOGLEVEL_EMERG
);

35 
	`¥_Æît
("Hñlo, debug w‹ld @Üog-Àvñ KERN_ALERT [%d]\n", 
LOGLEVEL_ALERT
);

36 
	`¥_¸ô
("Hñlo, debug w‹ld @Üog-Àvñ KERN_CRIT [%d]\n", 
LOGLEVEL_CRIT
);

37 
	`¥_îr
("Hñlo, debug w‹ld @Üog-Àvñ KERN_ERR [%d]\n", 
LOGLEVEL_ERR
);

38 
	`¥_w¨n
("Hñlo, debug w‹ld @Üog-Àvñ KERN_WARNING [%d]\n", 
LOGLEVEL_WARNING
);

39 
	`¥_nŸi˚
("Hñlo, debug w‹ld @Üog-Àvñ KERN_NOTICE [%d]\n", 
LOGLEVEL_NOTICE
);

40 
	`¥_öfo
("Hñlo, debug w‹ld @Üog-Àvñ KERN_INFO [%d]\n", 
LOGLEVEL_INFO
);

41 
	`¥_debug
("Hñlo, debug w‹ld @Üog-Àvñ KERN_DEBUG [%d]\n", 
LOGLEVEL_DEBUG
);

42 
	`¥_devñ
("Hñlo, debug w‹ld vüÅhê¥_devñ(Ëma¸ÿ”f‡@KERN_DEBUGË[%d]\n", 
LOGLEVEL_DEBUG
);

45 
	}
}

47 
__exô
 
	$¥ötk_logÀvñs_exô
()

49 
	`¥_öfo
("Goodbye, debug w‹ld @Üog-Àvñ KERN_INFO [%d]\n", 
LOGLEVEL_INFO
);

50 
	}
}

52 
moduÀ_öô
(
¥ötk_logÀvñs_öô
);

53 
moduÀ_exô
(
¥ötk_logÀvñs_exô
);

	@Books/Linux-Kernel-Debugging/ch3/ratelimit_test/ratelimit_test.c

20 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

22 
	~<löux/öô.h
>

23 
	~<löux/moduÀ.h
>

24 
	~<löux/kî√l.h
>

25 
	~<löux/dñay.h
>

27 
MODULE_AUTHOR
("<insert yourÇame here>");

28 
MODULE_DESCRIPTION
("LKD book:ch5/ratelimit_test:Örintá burstÅoÅestÑate-limiting");

29 
MODULE_LICENSE
("Dual MIT/GPL");

30 
MODULE_VERSION
("0.1");

32 
	gnum_bur°_¥öts
 = 7;

33 
moduÀ_∑øm
(
num_bur°_¥öts
, , 0644);

34 
MODULE_PARM_DESC
(
num_bur°_¥öts
,

37 
__öô
 
	$øãlimô_ã°_öô
()

39 
i
;

41 
	`¥_öfo
("num_burst_prints=%d. AttemptingÅoÉmit %dÖrintk's iná burst:\n",

42 
num_bur°_¥öts
,Çum_burst_prints);

44 
i
 = 0; i < 
num_bur°_¥öts
; i++) {

45 
	`¥_öfo_øãlimôed
("[%d]Ñ©ñimôedÖrötk @ KERN_INFO [%d]\n", 
i
,

46 
LOGLEVEL_INFO
);

47 
	`mdñay
(100);

52 
	}
}

54 
__exô
 
	$øãlimô_ã°_exô
()

56 
	`¥_öfo_øãlimôed
("Goodbye,ÑatelimitedÖrintk @Üog-level KERN_INFO [%d]\n",

57 
LOGLEVEL_INFO
);

58 
	}
}

60 
moduÀ_öô
(
øãlimô_ã°_öô
);

61 
moduÀ_exô
(
øãlimô_ã°_exô
);

	@Books/Linux-Kernel-Debugging/ch4/kprobes/1_kprobe/1_kprobe.c

19 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/öô.h
>

24 
	~<löux/¶ab.h
>

25 
	~<löux/öãºu±.h
>

26 
	~<löux/•ölock.h
>

27 
	~<löux/k¥obes.h
>

28 
	~<löux/±ø˚.h
>

29 
	~<löux/uac˚ss.h
>

30 
	~"../../../c⁄víõ¡.h
"

32 
MODULE_AUTHOR
("<insert yourÇame here>");

33 
MODULE_DESCRIPTION
("LKD book:ch4/kprobes/1_kprobe: simple Kprobes 1st demo module");

34 
MODULE_LICENSE
("Dual MIT/GPL");

35 
MODULE_VERSION
("0.1");

37 
•ölock_t
 
	glock
;

38 
k¥obe
 
	gkpb
;

39 
u64
 
	gtm_°¨t
, 
	gtm_íd
;

44 
	$h™dÀr_¥e
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
)

46 
	`PRINT_CTX
();

48 
	`•ö_lock
(&
lock
);

49 
tm_°¨t
 = 
	`ktime_gë_ªÆ_ns
();

50 
	`•ö_u∆ock
(&
lock
);

53 
	}
}

58 
	$h™dÀr_po°
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
, 
Êags
)

60 
	`•ö_lock
(&
lock
);

61 
tm_íd
 = 
	`ktime_gë_ªÆ_ns
();

62 
	`PRINT_CTX
();

63 
	`SHOW_DELTA
(
tm_íd
, 
tm_°¨t
);

64 
	`•ö_u∆ock
(&
lock
);

65 
	`¥_debug
("\n");

66 
	}
}

73 
	$h™dÀr_Áu…
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
, 
å≠ƒ
)

75 
	`¥_öfo
("Áu…_h™dÀr:Ö->add∏0x%p,Åø∞#%dn", 
p
->
addr
, 
å≠ƒ
);

78 
	}
}

79 
NOKPROBE_SYMBOL
(
h™dÀr_Áu…
);

81 
__öô
 
	$k¥obe_lkm_öô
()

84 
kpb
.
¥e_h™dÀr
 = 
h™dÀr_¥e
;

85 
kpb
.
po°_h™dÀr
 = 
h™dÀr_po°
;

86 
kpb
.
Áu…_h™dÀr
 = 
h™dÀr_Áu…
;

87 
kpb
.
symbﬁ_«me
 = "do_sys_open";

88 i‡(
	`ªgi°î_k¥obe
(&
kpb
)) {

89 
	`¥_Æît
("register_kprobe on do_sys_open() failed!\n");

90  -
EINVAL
;

92 
	`¥_öfo
("registering kernelÖrobe @ 'do_sys_open()'\n");

93 
	`•ö_lock_öô
(&
lock
);

96 
	}
}

98 
__exô
 
	$k¥obe_lkm_exô
()

100 
	`uƒegi°î_k¥obe
(&
kpb
);

101 
	`¥_öfo
("bye, unregistering kernelÖrobe @ 'do_sys_open()'\n");

102 
	}
}

104 
moduÀ_öô
(
k¥obe_lkm_öô
);

105 
moduÀ_exô
(
k¥obe_lkm_exô
);

	@Books/Linux-Kernel-Debugging/ch4/kprobes/2_kprobe/2_kprobe.c

20 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

22 
	~<löux/moduÀ.h
>

23 
	~<löux/kî√l.h
>

24 
	~<löux/öô.h
>

25 
	~<löux/¶ab.h
>

26 
	~<löux/öãºu±.h
>

27 
	~<löux/•ölock.h
>

28 
	~<löux/k¥obes.h
>

29 
	~<löux/±ø˚.h
>

30 
	~<löux/uac˚ss.h
>

31 
	~"../../../c⁄víõ¡.h
"

33 
MODULE_AUTHOR
("<insert yourÇame here>");

34 
MODULE_DESCRIPTION
("LKD book:ch6/2_kprobes/2_kprobe: simple Kprobes demo module with modparam");

35 
MODULE_LICENSE
("Dual MIT/GPL");

36 
MODULE_VERSION
("0.1");

39 
	#SKIP_IF_NOT_VI


	)

41 
•ölock_t
 
	glock
;

42 
k¥obe
 
	gkpb
;

43 
u64
 
	gtm_°¨t
, 
	gtm_íd
;

45 
	#MAX_FUNCNAME_LEN
 64

	)

46 
	gk¥obe_func
[
MAX_FUNCNAME_LEN
];

47 
moduÀ_∑øm_°rög
(
k¥obe_func
, kprobe_func, (kprobe_func), 0);

48 
MODULE_PARM_DESC
(
k¥obe_func
, "functionÇameÅoáttachá kprobeÅo");

50 
	gvîbo£
;

51 
moduÀ_∑øm
(
vîbo£
, , 0644);

52 
MODULE_PARM_DESC
(
vîbo£
, "SetÅo 1Åo get verboseÖrintk's (defaultsÅo 0).");

59 
	$h™dÀr_¥e
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
)

61 #ifde‡
SKIP_IF_NOT_VI


65 i‡(
	`°∫cmp
(
cuºít
->
comm
, "vi", 2))

69 
	`PRINT_CTX
();

70 
	`•ö_lock
(&
lock
);

71 
tm_°¨t
 = 
	`ktime_gë_ªÆ_ns
();

72 
	`•ö_u∆ock
(&
lock
);

75 
	}
}

80 
	$h™dÀr_po°
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
, 
Êags
)

82 #ifde‡
SKIP_IF_NOT_VI


83 i‡(
	`°∫cmp
(
cuºít
->
comm
, "vi", 2))

87 
	`•ö_lock
(&
lock
);

88 
tm_íd
 = 
	`ktime_gë_ªÆ_ns
();

90 i‡(
vîbo£
)

91 
	`PRINT_CTX
();

93 
	`SHOW_DELTA
(
tm_íd
, 
tm_°¨t
);

94 
	`•ö_u∆ock
(&
lock
);

95 
	}
}

102 
	$h™dÀr_Áu…
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
, 
å≠ƒ
)

104 
	`¥_öfo
("Áu…_h™dÀr:Ö->add∏0x%p,Åø∞#%dn", 
p
->
addr
, 
å≠ƒ
);

107 
	}
}

108 
NOKPROBE_SYMBOL
(
h™dÀr_Áu…
);

110 
__öô
 
	$k¥obe_lkm_öô
()

115 i‡(
k¥obe_func
[0] == '\0') {

116 
	`¥_w¨n
("expectá valid kprobe_func=<func_name> moduleÖarameter");

117  -
EINVAL
;

127 
kpb
.
¥e_h™dÀr
 = 
h™dÀr_¥e
;

128 
kpb
.
po°_h™dÀr
 = 
h™dÀr_po°
;

129 
kpb
.
Áu…_h™dÀr
 = 
h™dÀr_Áu…
;

130 
kpb
.
symbﬁ_«me
 = 
k¥obe_func
;

131 i‡(
	`ªgi°î_k¥obe
(&
kpb
)) {

132 
	`¥_Æît
("ªgi°î_k¥obêÁûed!\n\
: i†fun˘i⁄ '%s' invÆid, sètic, i∆öe; o∏bœckli°ed:áâribuã-m¨ked '__k¥obes'\n\
Çok¥obe_ölöe, o∏i†m¨ked wôhÅhêNOKPROBE_SYMBOL ma¸o?\n", 
k¥obe_func
);

135  -
EINVAL
;

137 
	`¥_öfo
("ªgi°îög kî√»¥obê@ '%s'\n", 
k¥obe_func
);

138 #ifde‡
SKIP_IF_NOT_VI


139 
	`¥_öfo
("NOTE: Skipping ifÇot vi ...\n");

141 
	`•ö_lock_öô
(&
lock
);

144 
	}
}

146 
__exô
 
	$k¥obe_lkm_exô
()

148 
	`uƒegi°î_k¥obe
(&
kpb
);

149 
	`¥_öfo
("bye, uƒegi°îög kî√»¥obê@ '%s'\n", 
k¥obe_func
);

150 
	}
}

152 
moduÀ_öô
(
k¥obe_lkm_öô
);

153 
moduÀ_exô
(
k¥obe_lkm_exô
);

	@Books/Linux-Kernel-Debugging/ch4/kprobes/3_kprobe/3_kprobe.c

22 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

24 
	~<löux/moduÀ.h
>

25 
	~<löux/kî√l.h
>

26 
	~<löux/öô.h
>

27 
	~<löux/¶ab.h
>

28 
	~<löux/öãºu±.h
>

29 
	~<löux/•ölock.h
>

30 
	~<löux/k¥obes.h
>

31 
	~<löux/±ø˚.h
>

32 
	~<löux/uac˚ss.h
>

33 
	~"../../../c⁄víõ¡.h
"

35 
MODULE_AUTHOR
("<insert yourÇame here>");

36 
MODULE_DESCRIPTION
("LKD book:ch6/kprobes/3_kprobe: simple Kprobes demo module with fname displayed");

37 
MODULE_LICENSE
("Dual MIT/GPL");

38 
MODULE_VERSION
("0.1");

40 
•ölock_t
 
	glock
;

41 
k¥obe
 
	gkpb
;

42 
u64
 
	gtm_°¨t
, 
	gtm_íd
;

43 *
	g‚ame
;

45 
	#MAX_FUNCNAME_LEN
 64

	)

46 
	gk¥obe_func
[
MAX_FUNCNAME_LEN
];

47 
moduÀ_∑øm_°rög
(
k¥obe_func
, kprobe_func, (kprobe_func), 0);

48 
MODULE_PARM_DESC
(
k¥obe_func
, "functionÇameÅoáttachá kprobeÅo");

50 
	gvîbo£
;

51 
moduÀ_∑øm
(
vîbo£
, , 0644);

52 
MODULE_PARM_DESC
(
vîbo£
, "SetÅo 1Åo get verboseÖrintk's (defaultsÅo 0).");

54 
	gskù_if_nŸ_vi
 = 1;

55 
moduÀ_∑øm
(
skù_if_nŸ_vi
, , 0644);

56 
MODULE_PARM_DESC
(
skù_if_nŸ_vi
, "SetÅo 1Åo ONLY seeÖrintk's when viÑunsánd opens files (default=1).");

65 
	$h™dÀr_¥e
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
)

67 *
∑øm_‚ame_ªg
;

69 i‡(
skù_if_nŸ_vi
) {

73 i‡(
	`°∫cmp
(
cuºít
->
comm
, "vi", 2))

77 #ifde‡
CONFIG_X86


78 
∑øm_‚ame_ªg
 = (
__u£r
 *)
ªgs
->
si
;

80 #ifde‡
CONFIG_ARM


87 
∑øm_‚ame_ªg
 = (
__u£r
 *)
ªgs
->
ARM_r1
;

89 #ifde‡
CONFIG_ARM64


96 
∑øm_‚ame_ªg
 = (
__u£r
 *)
ªgs
->regs[1];

99 
	`PRINT_CTX
();

123 i‡(!
	`°∫˝y_‰om_u£r
(
‚ame
, 
∑øm_‚ame_ªg
, 
PATH_MAX
))

127 i‡(!
	`c›y_‰om_u£r
(
‚ame
, (c⁄° 
__u£r
 *)
ªgs
->
si
,

128 
	`°∫Àn_u£r
((c⁄° 
__u£r
 *)
ªgs
->
si
, 
PATH_MAX
)))

130  -
EFAULT
;

132 
	`¥_öfo
("FILE being opened:Ñeg:0x%px fname:%s\n",

133 (*)
∑øm_‚ame_ªg
, 
‚ame
);

135 
	`•ö_lock
(&
lock
);

136 
tm_°¨t
 = 
	`ktime_gë_ªÆ_ns
();

137 
	`•ö_u∆ock
(&
lock
);

140 
	}
}

145 
	$h™dÀr_po°
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
, 
Êags
)

147 i‡(
skù_if_nŸ_vi
) {

151 i‡(
	`°∫cmp
(
cuºít
->
comm
, "vi", 2))

155 
	`•ö_lock
(&
lock
);

156 
tm_íd
 = 
	`ktime_gë_ªÆ_ns
();

158 i‡(
vîbo£
)

159 
	`PRINT_CTX
();

161 
	`SHOW_DELTA
(
tm_íd
, 
tm_°¨t
);

162 
	`•ö_u∆ock
(&
lock
);

163 
	}
}

170 
	$h™dÀr_Áu…
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
, 
å≠ƒ
)

172 
	`¥_öfo
("Áu…_h™dÀr:Ö->add∏0x%p,Åø∞#%dn", 
p
->
addr
, 
å≠ƒ
);

175 
	}
}

177 
NOKPROBE_SYMBOL
(
h™dÀr_Áu…
);

179 
__öô
 
	$k¥obe_lkm_öô
()

184 i‡(
k¥obe_func
[0] == '\0') {

185 
	`¥_w¨n
("expectá valid kprobe_func=<func_name> moduleÖarameter");

186  -
EINVAL
;

188 
	`¥_öfo
("FYI, skù_if_nŸ_vòi†%s, vîbo£=%d\n", (
skù_if_nŸ_vi
==1?"⁄":"off"), 
vîbo£
);

196 
‚ame
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_ATOMIC
);

197 i‡(
	`u∆ikñy
(!
‚ame
))

198  -
ENOMEM
;

201 
kpb
.
¥e_h™dÀr
 = 
h™dÀr_¥e
;

202 
kpb
.
po°_h™dÀr
 = 
h™dÀr_po°
;

203 
kpb
.
Áu…_h™dÀr
 = 
h™dÀr_Áu…
;

204 
kpb
.
symbﬁ_«me
 = 
k¥obe_func
;

205 i‡(
	`ªgi°î_k¥obe
(&
kpb
)) {

206 
	`¥_Æît
("ªgi°î_k¥obêÁûed!\n\
: i†fun˘i⁄ '%s' invÆid, sètic, i∆öe; o∏bœckli°ed:áâribuã-m¨ked '__k¥obes'\n\
Çok¥obe_ölöe, o∏i†m¨ked wôhÅhêNOKPROBE_SYMBOL ma¸o?\n", 
k¥obe_func
);

209  -
EINVAL
;

211 
	`¥_öfo
("ªgi°îög kî√»¥obê@ '%s'\n", 
k¥obe_func
);

212 
	`•ö_lock_öô
(&
lock
);

215 
	}
}

217 
__exô
 
	$k¥obe_lkm_exô
()

219 
	`k‰ì
(
‚ame
);

220 
	`uƒegi°î_k¥obe
(&
kpb
);

221 
	`¥_öfo
("bye, uƒegi°îög kî√»¥obê@ '%s'\n", 
k¥obe_func
);

222 
	}
}

224 
moduÀ_öô
(
k¥obe_lkm_öô
);

225 
moduÀ_exô
(
k¥obe_lkm_exô
);

	@Books/Linux-Kernel-Debugging/ch4/kprobes/4_kprobe_helper/helper_kp.c

32 
	~<löux/moduÀ.h
>

33 
	~<löux/kî√l.h
>

34 
	~<löux/öô.h
>

35 
	~<löux/öãºu±.h
>

36 
	~<löux/•ölock.h
>

37 
	~<löux/k¥obes.h
>

38 
	~<löux/±ø˚.h
>

39 
	~"../../../../c⁄víõ¡.h
"

41 
	#MODULE_VER
 "0.1"

	)

43 *
	gfun˙ame
;

47 
moduÀ_∑øm
(
fun˙ame
, 
ch¨p
, 0);

48 
MODULE_PARM_DESC
(
fun˙ame
,

51 
	gvîbo£
;

52 
moduÀ_∑øm
(
vîbo£
, , 0644);

53 
MODULE_PARM_DESC
(
vîbo£
, "SetÅo 1Åo get verboseÖrintk's (defaultsÅo 0).");

55 
	gshow_°ack
;

56 
moduÀ_∑øm
(
show_°ack
, , 0644);

57 
MODULE_PARM_DESC
(
show_°ack
, "SetÅo 1Åo dumpÅhe kernel-mode stack; defaultsÅo 0).");

59 
k¥obe
 
	gkpb
;

60 
u64
 
	gtm_°¨t
 = 0, 
	gtm_íd
 = 0;

61 
	gru¬ög_avg
=0;

62 
•ölock_t
 
	glock
;

67 
	$h™dÀr_¥e
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
)

69 
	`•ö_lock
(&
lock
);

70 
tm_°¨t
 = 
	`ktime_gë_ªÆ_ns
();

71 
	`•ö_u∆ock
(&
lock
);

73 i‡(
vîbo£
) {

74 
	`¥_debug_øãlimôed
("%s:%s():Pª '%s'.\n", 
KBUILD_MODNAME
, 
__func__
, 
fun˙ame
);

75 
	`PRINT_CTX
();

77 i‡(
show_°ack
)

78 
	`dump_°ack
();

81 
	}
}

86 
	$h™dÀr_po°
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
,

87 
Êags
)

89 
	`•ö_lock
(&
lock
);

90 
tm_íd
 = 
	`ktime_gë_ªÆ_ns
();

92 i‡(
vîbo£
) {

93 
	`¥_debug_øãlimôed
("%s:%s():%s:%d. Post '%s'.\n",

94 
KBUILD_MODNAME
, 
__func__
, 
cuºít
->
comm
, cuºít->
pid
, 
fun˙ame
);

97 
	`SHOW_DELTA
(
tm_íd
, 
tm_°¨t
);

98 
	`•ö_u∆ock
(&
lock
);

99 
	}
}

101 
__öô
 
	$hñ≥r_kp_öô_moduÀ
()

103 i‡(!
fun˙ame
) {

104 
	`¥_öfo
("%s:%s():Mu°Öas†fun˙amêa†®moduÀÖ¨amëî\n", 
KBUILD_MODNAME
, 
__func__
);

105  -
EINVAL
;

107 
	`•ö_lock_öô
(&
lock
);

108 
	`¥_öfo
("%s:%s():kprobe'ing function %s, verbose mode? %s, show stack? %s\n",

109 
KBUILD_MODNAME
, 
__func__
, 
fun˙ame
, (
vîbo£
==1?"Y":"N"), (
show_°ack
==1?"Y":"N"));

116 
kpb
.
¥e_h™dÀr
 = 
h™dÀr_¥e
;

117 
kpb
.
po°_h™dÀr
 = 
h™dÀr_po°
;

118 
kpb
.
symbﬁ_«me
 = 
fun˙ame
;

119 i‡(
	`ªgi°î_k¥obe
(&
kpb
)) {

120 
	`¥_Æît
("%s:%s():register_kprobe failed!\n"

122 
KBUILD_MODNAME
, 
__func__
, 
fun˙ame
);

123  -
EINVAL
;

125 
	`¥_öfo
("%s:%s():ªgi°îed k¥obêf‹ fun˘i⁄ %s\n", 
KBUILD_MODNAME
, 
__func__
, 
fun˙ame
);

127 
	}
}

129 
	$hñ≥r_kp_˛ónup_moduÀ
()

131 
	`uƒegi°î_k¥obe
(&
kpb
);

132 
	`¥_öfo
("%s:%s():uƒegi°îed k¥obê@ fun˘i⁄ %s\n", 
KBUILD_MODNAME
, 
__func__
, 
fun˙ame
);

133 
	}
}

135 
moduÀ_öô
(
hñ≥r_kp_öô_moduÀ
);

136 
moduÀ_exô
(
hñ≥r_kp_˛ónup_moduÀ
);

138 
MODULE_AUTHOR
("Kaiwan N Billimoria");

139 
MODULE_DESCRIPTION
("Helper Kprobe module;Ñegistersá kprobeÅoÅheÖassed function");

140 
MODULE_LICENSE
("Dual MIT/GPL");

	@Books/Linux-Kernel-Debugging/ch5/kmembugs_test/debugfs_kmembugs.c

34 
	~<löux/öô.h
>

35 
	~<löux/kî√l.h
>

36 
	~<löux/moduÀ.h
>

37 
	~<löux/¶ab.h
>

38 
	~<löux/debugfs.h
>

39 
	~<löux/vîsi⁄.h
>

40 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4, 11, 0)

41 
	~<löux/uac˚ss.h
>

42 
	~<löux/sched/sig«l.h
>

44 
	~<asm/uac˚ss.h
>

48 
umr
();

49 *
u¨
();

50 
Àak_sim∂e1
();

51 *
Àak_sim∂e2
();

52 
Àak_sim∂e3
();

54 
globÆ_mem_oob_right
(
mode
, *
p
);

55 
globÆ_mem_oob_À·
(
mode
, *
p
);

56 
dy«mic_mem_oob_right
(
mode
);

57 
dy«mic_mem_oob_À·
(
mode
);

59 
uaf
();

60 
doubÀ_‰ì
();

63 
ã°_ubßn_add_ovîÊow
();

64 
ã°_ubßn_sub_ovîÊow
();

65 
ã°_ubßn_mul_ovîÊow
();

66 
ã°_ubßn_√g©e_ovîÊow
();

67 
ã°_ubßn_divªm_ovîÊow
();

68 
ã°_ubßn_shi·_out_of_bounds
();

69 
ã°_ubßn_out_of_bounds
();

70 
ã°_ubßn_lﬂd_övÆid_vÆue
();

71 
ã°_ubßn_mißlig√d_ac˚ss
();

72 
ã°_ubßn_obje˘_size_mism©ch
();

74 
noölöe
 
oob_c›y_u£r_ã°
();

75 
umr_¶ub
();

78 
díåy
 *
	gg∑ª¡
;

79 
EXPORT_SYMBOL
(
g∑ª¡
);

81 
globÆ_¨r1
[], 
globÆ_¨r2
[], 
globÆ_¨r3
[];

83 
	#MAXUPASS
 5

	)

84 
ssize_t
 
	$dbgfs_run_ã°ˇ£
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
, 
size_t
 
cou¡
,

85 
loff_t
 *
Âos
)

87 
ud©a
[
MAXUPASS
];

88 vﬁ©ûê*
ªs1
 = 
NULL
, *
ªs2
 = NULL;

90 i‡(
cou¡
 > 
MAXUPASS
) {

91 
	`¥_w¨n
("too much dataáttemptedÅo beÖassed from userspaceÅo here\n");

92  -
ENOSPC
;

94 i‡(
	`c›y_‰om_u£r
(
ud©a
, 
ubuf
, 
cou¡
))

95  -
EIO
;

96 
ud©a
[
cou¡
 - 1] = '\0';

97 
	`¥_debug
("ã°ˇ£Åÿrun: %s\n", 
ud©a
);

103 i‡(!
	`°∫cmp
(
ud©a
, "1", 2))

104 
	`umr
();

105 i‡(!
	`°∫cmp
(
ud©a
, "2", 2)) {

106 
ªs1
 = 
	`u¨
();

107 
	`¥_öfo
("testcase 2: UAR:Ñes1 = \"%s\"\n",

108 
ªs1
 =
NULL
 ? "<whoops, it's NULL; UAR!>" : (*)res1);

109 } i‡(!
	`°∫cmp
(
ud©a
, "3.1", 4))

110 
	`Àak_sim∂e1
();

111 i‡(!
	`°∫cmp
(
ud©a
, "3.2", 4)) {

112 
ªs2
 = (*)
	`Àak_sim∂e2
();

113 
	`¥_öfo
("Ñes2 = \"%s\"\n",

114 
ªs2
 =
NULL
 ? "<whoops, it's NULL>" : (*)res2);

116 
	`k‰ì
((*)
ªs2
);

117 } i‡(!
	`°∫cmp
(
ud©a
, "3.3", 4))

118 
	`Àak_sim∂e3
();

119 i‡(!
	`°∫cmp
(
ud©a
, "4.1", 4))

120 
	`globÆ_mem_oob_right
(
READ
, 
globÆ_¨r2
);

121 i‡(!
	`°∫cmp
(
ud©a
, "4.2", 4))

122 
	`globÆ_mem_oob_right
(
WRITE
, 
globÆ_¨r2
);

123 i‡(!
	`°∫cmp
(
ud©a
, "4.3", 4))

124 
	`globÆ_mem_oob_À·
(
READ
, 
globÆ_¨r2
);

125 i‡(!
	`°∫cmp
(
ud©a
, "4.4", 4))

126 
	`globÆ_mem_oob_À·
(
WRITE
, 
globÆ_¨r2
);

127 i‡(!
	`°∫cmp
(
ud©a
, "5.1", 4))

128 
	`dy«mic_mem_oob_right
(
READ
);

129 i‡(!
	`°∫cmp
(
ud©a
, "5.2", 4))

130 
	`dy«mic_mem_oob_right
(
WRITE
);

131 i‡(!
	`°∫cmp
(
ud©a
, "5.3", 4))

132 
	`dy«mic_mem_oob_À·
(
READ
);

133 i‡(!
	`°∫cmp
(
ud©a
, "5.4", 4))

134 
	`dy«mic_mem_oob_À·
(
WRITE
);

135 i‡(!
	`°∫cmp
(
ud©a
, "6", 2))

136 
	`uaf
();

137 i‡(!
	`°∫cmp
(
ud©a
, "7", 2))

138 
	`doubÀ_‰ì
();

139 i‡(!
	`°∫cmp
(
ud©a
, "8.1", 4))

140 
	`ã°_ubßn_add_ovîÊow
();

141 i‡(!
	`°∫cmp
(
ud©a
, "8.2", 4))

142 
	`ã°_ubßn_sub_ovîÊow
();

143 i‡(!
	`°∫cmp
(
ud©a
, "8.3", 4))

144 
	`ã°_ubßn_mul_ovîÊow
();

145 i‡(!
	`°∫cmp
(
ud©a
, "8.4", 4))

146 
	`ã°_ubßn_√g©e_ovîÊow
();

147 i‡(!
	`°∫cmp
(
ud©a
, "8.4", 4))

148 
	`ã°_ubßn_divªm_ovîÊow
();

149 i‡(!
	`°∫cmp
(
ud©a
, "8.5", 4))

150 
	`ã°_ubßn_shi·_out_of_bounds
();

151 i‡(!
	`°∫cmp
(
ud©a
, "8.6", 4))

152 
	`ã°_ubßn_out_of_bounds
();

153 i‡(!
	`°∫cmp
(
ud©a
, "8.7", 4))

154 
	`ã°_ubßn_lﬂd_övÆid_vÆue
();

155 i‡(!
	`°∫cmp
(
ud©a
, "8.8", 4))

156 
	`ã°_ubßn_mißlig√d_ac˚ss
();

157 i‡(!
	`°∫cmp
(
ud©a
, "8.9", 4))

158 
	`ã°_ubßn_obje˘_size_mism©ch
();

159 i‡(!
	`°∫cmp
(
ud©a
, "9", 2))

160 
	`oob_c›y_u£r_ã°
();

161 i‡(!
	`°∫cmp
(
ud©a
, "10", 3))

162 
	`umr_¶ub
();

164 
	`¥_w¨n
("InvÆidÅe°ˇ£ # (%sË∑s£d\n", 
ud©a
);

166  
cou¡
;

167 
	}
}

169 c⁄° 
fûe_›î©i⁄s
 
	gdbgfs_f›s
 = {

170 .
wrôe
 = 
dbgfs_run_ã°ˇ£
,

173 
	$debugfs_sim∂e_ötf_öô
()

175 
°©
 = 0;

176 
díåy
 *
fûe1
;

178 i‡(!
	`IS_ENABLED
(
CONFIG_DEBUG_FS
)) {

179 
	`¥_w¨n
("debugfs unsupported! Aborting ...\n");

180  -
EINVAL
;

185 
g∑ª¡
 = 
	`debugfs_¸óã_dú
(
KBUILD_MODNAME
, 
NULL
);

186 i‡(!
g∑ª¡
) {

187 
	`¥_öfo
("debugfs_create_dir failed,áborting...\n");

188 
°©
 = 
	`PTR_ERR
(
g∑ª¡
);

189 
out_Áû_1
;

195 
	#DBGFS_FILE
 "lkd_dbgfs_run_ã°ˇ£"

	)

196 
fûe1
 = 
	`debugfs_¸óã_fûe
(
DBGFS_FILE
, 0200, 
g∑ª¡
, 
NULL
, &
dbgfs_f›s
);

197 i‡(!
fûe1
) {

198 
	`¥_öfo
("debugfs_create_file failed,áborting...\n");

199 
°©
 = 
	`PTR_ERR
(
fûe1
);

200 
out_Áû_2
;

202 
	`¥_debug
("debugfs file 1 <debugfs_mountpt>/%s/%s created\n",

203 
KBUILD_MODNAME
, 
DBGFS_FILE
);

205 
	`¥_öfo
("debugfsÉntry initialized\n");

208 
out_Áû_2
:

209 
	`debugfs_ªmove_ªcursive
(
g∑ª¡
);

210 
out_Áû_1
:

211  
°©
;

212 
	}
}

	@Books/Linux-Kernel-Debugging/ch5/kmembugs_test/kmembugs_test.c

34 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

35 
	~<löux/öô.h
>

36 
	~<löux/kî√l.h
>

37 
	~<löux/moduÀ.h
>

38 
	~<löux/¶ab.h
>

39 
	~<löux/vmÆloc.h
>

40 
	~<löux/mm.h
>

41 
	~<löux/úq_w‹k.h
>

42 
	~<löux/debugfs.h
>

43 
	~"../../c⁄víõ¡.h
"

45 
MODULE_AUTHOR
("Kaiwan N Billimoria");

46 
MODULE_DESCRIPTION
("kmembugs_test:á fewádditionalÅest cases for KASAN/UBSAN");

47 
MODULE_LICENSE
("Dual MIT/GPL");

48 
MODULE_VERSION
("0.1");

50 #ifde‡
CONFIG_KASAN


51 
boﬁ
 
	gkaßn_mu…ishŸ
;

54 
debugfs_sim∂e_ötf_öô
();

55 
díåy
 *
g∑ª¡
;

56 
úq_w‹k
 
	gúqw‹k
;

65 
	$umr
()

67 vﬁ©ûê
x
, 
y
;

79 
	`¥_öfo
("ã°ˇ£ 1: UMR (vÆ=%d)\n", 
x
);

80 
y
 = 
x
;

82  
x
;

83 
	}
}

86 
	$umr_¶ub
()

88 vﬁ©ûê*
q
 = 
NULL
;

90 
	`¥_öfo
("testcase 10: simple UMR on slab memory\n");

91 
q
 = 
	`kmÆloc
(32, 
GFP_KERNEL
);

92 i‡(
	`u∆ikñy
(!
q
))

93  -
ENOMEM
;

94 
	`¥_öfo
("q[3] i†0x%x\n", 
q
[3]);

95 
	`¥öt_hex_dump_byãs
("q: ", 
DUMP_PREFIX_OFFSET
, (*)
q
, 32);

96 
	`k‰ì
((*)
q
);

99 
	}
}

102 *
	$u¨
()

104 
	#NUM_ALLOC
 64

	)

105 vﬁ©ûê
«me
[
NUM_ALLOC
];

106 vﬁ©ûê
i
;

108 
	`¥_öfo
("testcase 2: UAR:\n");

109 
i
 = 0; i < 
NUM_ALLOC
 - 1; i++)

110 
«me
[
i
] = 'x';

111 
«me
[
i
] = '\0';

113  (*)
«me
;

119 
	}
}

122 
	$Àak_sim∂e1
()

124 vﬁ©ûê*
p
 = 
NULL
;

126 
	`¥_öfo
("testcase 3.1: simple memoryÜeakÅestcase 1\n");

127 
p
 = 
	`kzÆloc
(1520, 
GFP_KERNEL
);

128 i‡(
	`u∆ikñy
(!
p
))

130 
	`¥_öfo
("kzÆloc(1520Ë0x%px\n", 
p
);

132 
	`k‰ì
((*)
p
);

134 #i‚de‡
CONFIG_MODULES


135 
	`¥_öfo
("kmem_cache_alloc(task_struct) = 0x%px\n",

136 
	`kmem_ˇche_Æloc
(
èsk_°ru˘
, 
GFP_KERNEL
));

138 
	`¥_öfo
("vmÆloc(5*1024Ë0x%px\n", 
	`vmÆloc
(5*1024));

139 
	}
}

145 *
	$Àak_sim∂e2
()

147 vﬁ©ûê*
q
 = 
NULL
;

148 vﬁ©ûê
i
;

149 vﬁ©ûê
hìhì
[] = "leaky!!";

151 
	`¥_öfo
("testcase 3.2: simple memoryÜeakÅestcase 2\n");

152 
	#NUM_ALLOC2
 8

	)

153 
q
 = 
	`kmÆloc
(
NUM_ALLOC2
, 
GFP_KERNEL
);

154 
i
 = 0; i < 
NUM_ALLOC2
 - 1; i++)

155 
q
[
i
] = 
hìhì
[i];

156 
q
[
i
] = '\0';

158  (*)
q
;

159 
	}
}

165 
	$úq_w‹k_Àaky
(
úq_w‹k
 *
úqwk
)

167 
w™t_¶ìp_ö_©omic_bug
 = 0;

169 
	`PRINT_CTX
();

170 i‡(
w™t_¶ìp_ö_©omic_bug
 == 1)

171 
	`¥_debug
("kzÆloc(129Ë0x%px\n", 
	`kzÆloc
(129, 
GFP_KERNEL
));

173 
	`¥_debug
("kzÆloc(129Ë0x%px\n", 
	`kzÆloc
(129, 
GFP_ATOMIC
));

174 
	}
}

176 
	$Àak_sim∂e3
()

178 
	`¥_öfo
("testcase 3.3: simple memoryÜeakÅestcase 3\n");

179 
	`úq_w‹k_queue
(&
úqw‹k
);

180 
	}
}

183 
	#READ
 0

	)

184 
	#WRITE
 1

	)

194 
	#ARRSZ
 10

	)

195 
	gglobÆ_¨r1
[
ARRSZ
];

196 
	gglobÆ_¨r2
[
ARRSZ
];

197 
	gglobÆ_¨r3
[
ARRSZ
];

207 
	$globÆ_mem_oob_right
(
mode
, *
p
)

209 vﬁ©ûê
w
, 
x
, 
y
, 
z
;

210 vﬁ©ûê
loˇl_¨r
[20];

211 *vﬁ©ûê
±r
 = 
p
 + 
ARRSZ
 + 3;

213 i‡(
mode
 =
READ
) {

214 
w
 = *(vﬁ©ûê*)
±r
;

215 
±r
 = 
p
 + 3;

216 
x
 = *(vﬁ©ûê*)
±r
;

218 
y
 = 
loˇl_¨r
[
	`ARRAY_SIZE
(local_arr) - 5];

219 
z
 = 
loˇl_¨r
[
	`ARRAY_SIZE
(local_arr) + 5];

220 } i‡(
mode
 =
WRITE
) {

221 *(vﬁ©ûê*)
±r
 = 'x';

223 
p
[
ARRSZ
 - 3] = 'w';

224 
p
[
ARRSZ
 + 3] = 'x';

226 
loˇl_¨r
[
	`ARRAY_SIZE
(local_arr) - 5] = 'y';

227 
loˇl_¨r
[
	`ARRAY_SIZE
(local_arr) + 5] = 'z';

230 
	}
}

240 
	$globÆ_mem_oob_À·
(
mode
, *
p
)

242 vﬁ©ûê
w
, 
x
, 
y
, 
z
;

243 vﬁ©ûê
loˇl_¨r
[20];

244 *vﬁ©ûê
±r
 = 
p
 - 3;

246 i‡(
mode
 =
READ
) {

248 
w
 = *(vﬁ©ûê*)
±r
;

254 
x
 = 
p
[-3];

256 
y
 = 
loˇl_¨r
[-5];

257 
z
 = 
loˇl_¨r
[5];

258 } i‡(
mode
 =
WRITE
) {

260 *(vﬁ©ûê*)
±r
 = 'w';

266 
±r
[0] = 'w';

267 
±r
[5] = 'x';

269 
loˇl_¨r
[-5] = 'y';

270 
loˇl_¨r
[5] = 'z';

273 
	}
}

276 
	$dy«mic_mem_oob_right
(
mode
)

278 vﬁ©ûê*
k±r
, 
ch
 = 0;

279 *vﬁ©ûê
±r
;

280 
size_t
 
sz
 = 32;

282 
k±r
 = 
	`kmÆloc
(
sz
, 
GFP_KERNEL
);

283 i‡(
	`u∆ikñy
(!
k±r
))

284  -
ENOMEM
;

285 
±r
 = (*)
k±r
 + 
sz
 + 3;

287 i‡(
mode
 =
READ
) {

289 
ch
 = *(vﬁ©ûê*)
±r
;

293 
ch
 = 
k±r
[
sz
 + 3];

294 } i‡(
mode
 =
WRITE
) {

296 *(vﬁ©ûê*)
±r
 = 'x';

300 
k±r
[
sz
] = 'x';

303 
	`k‰ì
((*)
k±r
);

305 
	}
}

308 
	$dy«mic_mem_oob_À·
(
mode
)

310 vﬁ©ûê*
k±r
, *
±r
, 
ch
 = 'x';

311 
size_t
 
sz
 = 32;

313 
k±r
 = (*)
	`kmÆloc
(
sz
, 
GFP_KERNEL
);

314 i‡(
	`u∆ikñy
(!
k±r
))

315  -
ENOMEM
;

316 
±r
 = 
k±r
 - 1;

318 i‡(
mode
 =
READ
)

319 
ch
 = *(vﬁ©ûê*)
±r
;

320 i‡(
mode
 =
WRITE
)

321 *(vﬁ©ûê*)
±r
 = 
ch
;

323 
	`k‰ì
((*)
k±r
);

325 
	}
}

328 
	$uaf
()

330 vﬁ©ûê*
k±r
, *
±r
;

331 
size_t
 
sz
 = 32;

333 
k±r
 = (*)
	`kmÆloc
(
sz
, 
GFP_KERNEL
);

334 i‡(
	`u∆ikñy
(!
k±r
))

335  -
ENOMEM
;

336 
±r
 = 
k±r
 + 3;

338 *(vﬁ©ûê*)
±r
 = 'x';

339 
	`k‰ì
((*)
k±r
);

340 
±r
 = 
k±r
 + 8;

341 *(vﬁ©ûê*)
±r
 = 'y';

344 
	}
}

347 
	$doubÀ_‰ì
()

349 vﬁ©ûê*
k±r
, *
±r
;

350 
size_t
 
sz
 = 32;

352 
k±r
 = (*)
	`kmÆloc
(
sz
, 
GFP_KERNEL
);

353 i‡(
	`u∆ikñy
(!
k±r
))

354  -
ENOMEM
;

355 
±r
 = 
k±r
 + 3;

357 *(vﬁ©ûê*)
±r
 = 'x';

358 
	`k‰ì
((*)
k±r
);

360 
	`k‰ì
((*)
k±r
);

363 
	}
}

369 
	$ã°_ubßn_add_ovîÊow
()

371 vﬁ©ûê
vÆ
 = 
INT_MAX
;

373 
vÆ
 += 2;

374 
	}
}

376 
	$ã°_ubßn_sub_ovîÊow
()

378 vﬁ©ûê
vÆ
 = 
INT_MIN
;

379 vﬁ©ûê
vÆ2
 = 2;

381 
vÆ
 -
vÆ2
;

382 
	}
}

384 
	$ã°_ubßn_mul_ovîÊow
()

386 vﬁ©ûê
vÆ
 = 
INT_MAX
 / 2;

388 
vÆ
 *= 3;

389 
	}
}

391 
	$ã°_ubßn_√g©e_ovîÊow
()

393 vﬁ©ûê
vÆ
 = 
INT_MIN
;

395 
vÆ
 = -val;

396 
	}
}

398 
	$ã°_ubßn_divªm_ovîÊow
()

400 vﬁ©ûê
vÆ
 = 16;

401 vﬁ©ûê
vÆ2
 = 0;

403 
vÆ
 /
vÆ2
;

404 
	}
}

406 
	$ã°_ubßn_shi·_out_of_bounds
()

408 vﬁ©ûê
vÆ
 = -1;

409 
vÆ2
 = 10;

411 
vÆ2
 <<
vÆ
;

412 
	}
}

414 
	$ã°_ubßn_out_of_bounds
()

416 vﬁ©ûê
i
 = 4, 
j
 = 5;

417 vﬁ©ûê
¨r
[4];

419 
¨r
[
j
] = 
i
;

420 
	}
}

422 
	$ã°_ubßn_lﬂd_övÆid_vÆue
()

424 vﬁ©ûê*
d°
, *
§c
;

425 
boﬁ
 
vÆ
, 
vÆ2
, *
±r
;

426 
c
 = 4;

428 
d°
 = (*)&
vÆ
;

429 
§c
 = &
c
;

430 *
d°
 = *
§c
;

432 
±r
 = &
vÆ2
;

433 
vÆ2
 = 
vÆ
;

434 
	}
}

436 
	$ã°_ubßn_nuŒ_±r_dîef
()

438 vﬁ©ûê*
±r
 = 
NULL
;

439 
vÆ
;

441 
vÆ
 = *
±r
;

442 
	}
}

444 
	$ã°_ubßn_mißlig√d_ac˚ss
()

446 vﬁ©ûê
¨r
[5] 
	`__Æig√d
(4) = { 1, 2, 3, 4, 5 };

447 vﬁ©ûê*
±r
, 
vÆ
 = 6;

449 
±r
 = (*)(
¨r
 + 1);

450 *
±r
 = 
vÆ
;

451 
	}
}

453 
	$ã°_ubßn_obje˘_size_mism©ch
()

456 vﬁ©ûê
vÆ
 
	`__Æig√d
(8) = 4;

457 vﬁ©ûê*
±r
, 
vÆ2
;

459 
±r
 = (*)&
vÆ
;

460 
vÆ2
 = *
±r
;

461 
	}
}

469 
	~<u≠i/asm-gíîic/mm™-comm⁄.h
>

470 
	~<u≠i/löux/mm™.h
>

471 
	#KASAN_SHADOW_SCALE_SIZE
 3

	)

477 
	#OOB_TAG_OFF
 (
	`IS_ENABLED
(
CONFIG_KASAN_GENERIC
Ë? 0 : 
KASAN_SHADOW_SCALE_SIZE
)

	)

478 
noölöe
 
	$oob_c›y_u£r_ã°
()

480 *
kmem
;

481 
__u£r
 *
u£rmem
;

482 
size_t
 
size
 = 10;

483 
unu£d
;

485 
kmem
 = 
	`kmÆloc
(
size
, 
GFP_KERNEL
);

486 i‡(
	`u∆ikñy
(!
kmem
))

489 
u£rmem
 = (
__u£r
 *)
	`vm_mm≠
(
NULL
, 0, 
PAGE_SIZE
,

490 
PROT_READ
 | 
PROT_WRITE
 | 
PROT_EXEC
,

491 
MAP_ANONYMOUS
 | 
MAP_PRIVATE
, 0);

492 i‡(
	`IS_ERR
(
u£rmem
)) {

493 
	`¥_îr
("FailedÅoállocate user memory\n");

494 
	`k‰ì
(
kmem
);

507 
	`¥_öfo
("out-of-bounds in copy_from_user()\n");

508 
unu£d
 = 
	`c›y_‰om_u£r
(
kmem
, 
u£rmem
, 
size
 + 1 + 
OOB_TAG_OFF
);

511 
	`¥_öfo
("out-of-bounds in copy_to_user()\n");

512 
unu£d
 = 
	`c›y_to_u£r
(
u£rmem
, 
kmem
, 
size
 + 1 + 
OOB_TAG_OFF
);

515 
	`¥_öfo
("out-of-bounds in __copy_from_user()\n");

516 
unu£d
 = 
	`__c›y_‰om_u£r
(
kmem
, 
u£rmem
, 
size
 + 1 + 
OOB_TAG_OFF
);

518 
	`¥_öfo
("out-of-bounds in __copy_to_user()\n");

519 
unu£d
 = 
	`__c›y_to_u£r
(
u£rmem
, 
kmem
, 
size
 + 1 + 
OOB_TAG_OFF
);

521 
	`¥_öfo
("out-of-bounds in __copy_from_user_inatomic()\n");

522 
unu£d
 = 
	`__c›y_‰om_u£r_ö©omic
(
kmem
, 
u£rmem
, 
size
 + 1 + 
OOB_TAG_OFF
);

524 
	`¥_öfo
("out-of-bounds in __copy_to_user_inatomic()\n");

525 
unu£d
 = 
	`__c›y_to_u£r_ö©omic
(
u£rmem
, 
kmem
, 
size
 + 1 + 
OOB_TAG_OFF
);

527 
	`¥_öfo
("out-of-bounds in strncpy_from_user()\n");

528 
unu£d
 = 
	`°∫˝y_‰om_u£r
(
kmem
, 
u£rmem
, 
size
 + 1 + 
OOB_TAG_OFF
);

530 
	`vm_munm≠
(()
u£rmem
, 
PAGE_SIZE
);

531 
	`k‰ì
(
kmem
);

532 
	}
}

534 
	#CHKCONF
(
›ti⁄
) do { \

535 i‡(
	`IS_ENABLED
(
›ti⁄
)) \

536 
	`¥_öfo
("%s configured\n", #option); \

538 
	`¥_öfo
("%s NOT configured\n", #option); \

539 } 0)

	)

541 
__öô
 
	$kmembugs_ã°_öô
()

543 
°©
;

550 #ifde‡
CONFIG_KASAN_GENERIC


551 
kaßn_mu…ishŸ
 = 
	`kaßn_ßve_íabÀ_mu…i_shŸ
();

552 
	`¥_öfo
("KASAN configured\n");

554 
	`¥_öfo
("KASAN NOT configured\n");

556 
	`CHKCONF
(
CONFIG_UBSAN
);

557 
	`CHKCONF
(
CONFIG_DEBUG_KMEMLEAK
);

559 
	`öô_úq_w‹k
(&
úqw‹k
, 
úq_w‹k_Àaky
);

561 
°©
 = 
	`debugfs_sim∂e_ötf_öô
();

562 i‡(
°©
 < 0)

563  
°©
;

566 
	}
}

568 
__exô
 
	$kmembugs_ã°_exô
()

570 #ifde‡
CONFIG_KASAN_GENERIC


571 
	`kaßn_ª°‹e_mu…i_shŸ
(
kaßn_mu…ishŸ
);

573 
	`debugfs_ªmove_ªcursive
(
g∑ª¡
);

574 
	`¥_öfo
("removed\n");

575 
	}
}

577 
moduÀ_öô
(
kmembugs_ã°_öô
);

578 
moduÀ_exô
(
kmembugs_ã°_exô
);

	@Books/Linux-Kernel-Debugging/ch7/oops_inirqv3/oops_inirqv3.c

17 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

19 
	~<löux/öô.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/kî√l.h
>

22 
	~<löux/úq_w‹k.h
>

23 
	~"../../c⁄víõ¡.h
"

25 
MODULE_AUTHOR
("<insert yourÇame here>");

26 
MODULE_DESCRIPTION
("LKD book:ch7/oops_inirqv3: generatesá kernel Oops! while in interrupt context");

27 
MODULE_LICENSE
("Dual MIT/GPL");

28 
MODULE_VERSION
("0.1");

30 
úq_w‹k
 
	gúqw‹k
;

35 
	$úq_w‹k
(
úq_w‹k
 *
úqwk
)

37 
w™t_o›s
 = 1;

39 
	`PRINT_CTX
();

40 i‡(!!
w™t_o›s
)

43 
	}
}

45 
__öô
 
	$åy_o›s_öô
()

47 
	`öô_úq_w‹k
(&
úqw‹k
, 
úq_w‹k
);

48 
	`úq_w‹k_queue
(&
úqw‹k
);

51 
	}
}

53 
__exô
 
	$åy_o›s_exô
()

55 
	`¥_öfo
("Goodbye, from Oops in irqÅry v3\n");

56 
	}
}

58 
moduÀ_öô
(
åy_o›s_öô
);

59 
moduÀ_exô
(
åy_o›s_exô
);

	@Books/Linux-Kernel-Debugging/ch7/oops_tryv1/oops_tryv1.c

17 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

19 
	~<löux/öô.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/kî√l.h
>

23 
MODULE_AUTHOR
("<insert yourÇame here>");

24 
MODULE_DESCRIPTION
("LKD book:ch7/oops_tryv1: generatesá kernel Oops!á kernel bug");

25 
MODULE_LICENSE
("Dual MIT/GPL");

26 
MODULE_VERSION
("0.1");

28 
boﬁ
 
	gåy_ªadög
;

29 
moduÀ_∑øm
(
åy_ªadög
, 
boﬁ
, 0644);

30 
MODULE_PARM_DESC
(
åy_ªadög
,

33 
__öô
 
	$åy_o›s_öô
()

35 
size_t
 
vÆ
 = 0x0;

37 
	`¥_öfo
("Lets Oops!\nNowáttemptingÅo %s something %sÅhe NULLáddress 0x%p\n",

38 !!
åy_ªadög
 ? "read" : "write",

39 !!
åy_ªadög
 ? "from" : "to",

40 
NULL
);

41 i‡(!!
åy_ªadög
) {

42 
vÆ
 = *(*)0x0;

50 
	`¥_öfo
("vÆ = 0x%zu\n", 
vÆ
);

58 *(*)
vÆ
 = 'x';

61 
	}
}

63 
__exô
 
	$åy_o›s_exô
()

65 
	`¥_öfo
("Goodbye, from OopsÅry v1\n");

66 
	}
}

68 
moduÀ_öô
(
åy_o›s_öô
);

69 
moduÀ_exô
(
åy_o›s_exô
);

	@Books/Linux-Kernel-Debugging/ch7/oops_tryv2/oops_tryv2.c

17 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

19 
	~<löux/öô.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/kî√l.h
>

22 
	~<löux/¶ab.h
>

23 
	~<löux/øndom.h
>

24 
	~<löux/w‹kqueue.h
>

25 
	~<löux/dñay.h
>

26 
	~"../../c⁄víõ¡.h
"

28 
MODULE_AUTHOR
("<insert yourÇame here>");

29 
MODULE_DESCRIPTION
("LKD book:ch7/oops_tryv2: generatesá kernel Oops!á kernel bug in different ways");

30 
MODULE_LICENSE
("Dual MIT/GPL");

31 
MODULE_VERSION
("0.1");

33 
	gmp_øndaddr
;

34 
moduÀ_∑øm
(
mp_øndaddr
, 
ul⁄g
, 0644);

35 
MODULE_PARM_DESC
(
mp_øndaddr
,

38 
boﬁ
 
	gbug_ö_w‹kq
;

39 
moduÀ_∑øm
(
bug_ö_w‹kq
, 
boﬁ
, 0644);

40 
MODULE_PARM_DESC
(
bug_ö_w‹kq
, "Triggerán Oops-generating bug in our workqueue function");

42 
	gbad_kva
;

43 
u64
 
	gt1
, 
	gt2
;

44 
	s°_˘x
 {

45 
	mx
, 
	my
, 
	mz
;

46 
w‹k_°ru˘
 
	mw‹k
;

47 
u8
 
	md©a
;

48 } *
	gg˘x
, *
	go›sõ
;

53 
	$do_the_w‹k
(
w‹k_°ru˘
 *
w‹k
)

55 
°_˘x
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, st_ctx, work);

57 
	`¥_öfo
("I¿ou∏w‹kq fun˘i⁄: d©a=%d\n", 
¥iv
->
d©a
);

58 
t2
 = 
	`ktime_gë_ªÆ_ns
();

59 
	`SHOW_DELTA
(
t2
, 
t1
);

60 i‡(!!
bug_ö_w‹kq
) {

61 
	`¥_öfo
("Generating Oops byáttemptingÅo writeÅoán invalid kernel memoryÖointer\n");

62 
o›sõ
->
d©a
 = 'x';

64 
	`k‰ì
(
g˘x
);

65 
	}
}

67 
	$£tup_w‹k
()

69 
g˘x
 = 
	`kzÆloc
((
°_˘x
), 
GFP_KERNEL
);

70 i‡(!
g˘x
)

71  -
ENOMEM
;

72 
g˘x
->
d©a
 = 'C';

75 
	`INIT_WORK
(&
g˘x
->
w‹k
, 
do_the_w‹k
);

77 
	`scheduÀ_w‹k
(&
g˘x
->
w‹k
);

80 
	}
}

82 
__öô
 
	$åy_o›s_öô
()

84 
∑ge0_ønd±r
 = 0x0;

86 i‡(!!
bug_ö_w‹kq
) {

87 
	`¥_öfo
("Generating Oops via kernel bug in workqueue function\n");

88 
t1
 = 
	`ktime_gë_ªÆ_ns
();

89 
	`£tup_w‹k
();

91 } i‡(
mp_øndaddr
) {

92 
	`¥_öfo
("Generating Oops byáttemptingÅo writeÅoÅhe invalid kerneláddressÖassed\n");

93 
bad_kva
 = 
mp_øndaddr
;

95 
	`¥_öfo
("Generating Oops byáttemptingÅo writeÅoáÑandom invalid kerneláddress in NULLÅrapÖage\n");

96 
	`gë_øndom_byãs
(&
∑ge0_ønd±r
, ());

97 
bad_kva
 = (
∑ge0_ønd±r
 %
PAGE_SIZE
);

99 
	`¥_öfo
("bad_kv®0x%lx;Çow wrôögÅÿô...\n", 
bad_kva
);

100 *(*)
bad_kva
 = 0xdead;

103 
	}
}

105 
__exô
 
	$åy_o›s_exô
()

107 
	`¥_öfo
("Goodbye, from OopsÅry v2\n");

108 
	}
}

110 
moduÀ_öô
(
åy_o›s_öô
);

111 
moduÀ_exô
(
åy_o›s_exô
);

	@Books/Linux-Kernel-Debugging/ch8/kcsan_datarace/kcsan_datarace.c

20 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

22 
	~<löux/öô.h
>

23 
	~<löux/moduÀ.h
>

24 
	~<löux/kî√l.h
>

25 
	~<löux/¶ab.h
>

26 
	~<löux/øndom.h
>

27 
	~<löux/w‹kqueue.h
>

28 
	~<löux/dñay.h
>

29 
	~"../../c⁄víõ¡.h
"

31 
MODULE_AUTHOR
("<insert yourÇame here>");

32 
MODULE_DESCRIPTION
("LKD book:ch8/kcsan_datarace: deliberately generatesá dataÑace; KCSAN should catch it!");

33 
MODULE_LICENSE
("Dual MIT/GPL");

34 
MODULE_VERSION
("0.1");

36 
boﬁ
 
	gø˚_2∂aö_w
;

37 
moduÀ_∑øm
(
ø˚_2∂aö_w
, 
boﬁ
, 0644);

38 
MODULE_PARM_DESC
(
ø˚_2∂aö_w
, "Triggerá dataÑace dueÅoÖlain writes on sameáddress");

40 
	gôî1
 = 10000;

41 
moduÀ_∑øm
(
ôî1
, , 0644);

42 
MODULE_PARM_DESC
(
ôî1
, "# ofÅimesÅoÜoop in workfunc 1");

44 
	gôî2
 = 10000;

45 
moduÀ_∑øm
(
ôî2
, , 0644);

46 
MODULE_PARM_DESC
(
ôî2
, "# ofÅimesÅoÜoop in workfunc 2");

48 
	s°_˘x
 {

49 
w‹k_°ru˘
 
	mw‹k1
, 
	mw‹k2
;

50 
u64
 
	mx
, 
	my
, 
	mz
, 
	md©a
;

51 } *
	gg˘x
;

56 
	$do_the_w‹k1
(
w‹k_°ru˘
 *
w‹k1
)

58 
i
;

59 
u64
 
bogus
 = 32000;

61 
	`PRINT_CTX
();

62 i‡(
ø˚_2∂aö_w
) {

63 
	`¥_öfo
("dataÑace: 2Ölain writes:\n");

64 
i
=0; i<
ôî1
; i++)

65 
g˘x
->
d©a
 = 
bogus
 + 
i
;

67 
	}
}

72 
	$do_the_w‹k2
(
w‹k_°ru˘
 *
w‹k2
)

74 
i
;

75 
u64
 
bogus
 = 98000;

77 
	`PRINT_CTX
();

78 i‡(
ø˚_2∂aö_w
) {

79 
	`¥_öfo
("dataÑace: 2Ölain writes:\n");

80 
i
=0; i<
ôî2
; i++)

81 
g˘x
->
d©a
 = 
bogus
 - 
i
;

83 
	}
}

85 
	$£tup_w‹k
()

87 
	`¥_öfo
("globÆ d©®ôemáddªss: 0x%px\n", &
g˘x
->
d©a
);

90 
	`INIT_WORK
(&
g˘x
->
w‹k1
, 
do_the_w‹k1
);

91 
	`scheduÀ_w‹k
(&
g˘x
->
w‹k1
);

94 
	`INIT_WORK
(&
g˘x
->
w‹k2
, 
do_the_w‹k2
);

95 
	`scheduÀ_w‹k
(&
g˘x
->
w‹k2
);

98 
	}
}

100 
__öô
 
	$kcßn_d©¨a˚_öô
()

102 i‡(!
ø˚_2∂aö_w
) {

103 
	`¥_öfo
("nothingÅo do (you'reÉxpectedÅo setÅhe moduleÖaramÑace_2plain_wÅo True!)\n");

104  -
EINVAL
;

107 
g˘x
 = 
	`kzÆloc
((
°_˘x
), 
GFP_KERNEL
);

108 i‡(!
g˘x
)

109  -
ENOMEM
;

111 
g˘x
->
d©a
 = 1;

112 
	`¥_öfo
("Setting upá deliberate dataÑace via our workqueue functions:\n");

113 i‡(
ø˚_2∂aö_w
 == 1)

114 
	`¥_öfo
("2Öœö wrôes; #lo›†ö w‹kfunc1:%d w‹kfunc2:%d\n", 
ôî1
, 
ôî2
);

116 
	`£tup_w‹k
();

118 
	}
}

120 
__exô
 
	$kcßn_d©¨a˚_exô
()

122 
	`k‰ì
(
g˘x
);

123 
	`¥_öfo
("Goodbye\n");

124 
	}
}

126 
moduÀ_öô
(
kcßn_d©¨a˚_öô
);

127 
moduÀ_exô
(
kcßn_d©¨a˚_exô
);

	@Books/Linux-Kernel-Debugging/convenient.h

16 #i‚de‡
__LKD_CONVENIENT_H__


17 
	#__LKD_CONVENIENT_H__


	)

19 
	~<asm/∑øm.h
>

20 
	~<löux/sched.h
>

22 #ifde‡
__KERNEL__


23 
	~<löux/øãlimô.h
>

52 #unde‡
USE_FTRACE_BUFFER


54 #ifde‡
USE_FTRACE_BUFFER


55 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

56 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

58 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

59 
USE_RATELIMITING
 = 1; \

60 i‡(
USE_RATELIMITING
) { \

61 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

64 
	`¥_öfo
(
°rög
, ##
¨gs
); \

65 } 0)

	)

70 #ifde‡
DEBUG


71 #ifde‡
__KERNEL__


72 
	#MSG
(
°rög
, 
¨gs
...) do { \

73 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

74 } 0)

	)

76 
	#MSG
(
°rög
, 
¨gs
...) do { \

77 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

78 } 0)

	)

81 #ifde‡
__KERNEL__


82 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

83 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

84 } 0)

	)

86 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

87 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

88 } 0)

	)

92 
	#QP
 
	`MSG
("\n")

	)

94 #ifde‡
__KERNEL__


95 #i‚de‡
USE_FTRACE_BUFFER


96 
	#QPDS
 do { \

97 
	`MSG
("\n"); \

98 
	`dump_°ack
(); \

99 } 0)

	)

101 
	#QPDS
 do { \

102 
	`MSG
("\n"); \

103 
	`åa˚_dump_°ack
(); \

104 } 0)

	)

108 #ifde‡
__KERNEL__


109 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

110 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

111 } 0)

	)

114 
	#MSG
(
°rög
, 
¨gs
...)

	)

115 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

116 
	#QP


	)

117 
	#QPDS


	)

125 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

126 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

127 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

128 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

129 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

131 #ifde‡
__KERNEL__


157 
	~<löux/sched.h
>

158 
	~<löux/öãºu±.h
>

160 
	#PRINT_CTX
() do { \

161 
PRINTCTX_SHOWHDR
 = 0; \

162 
öå
 = '.'; \

163 i‡(!
	`ö_èsk
()) { \

164 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

165 
öå
 = 'H'; \

166 i‡(
	`ö_úq
()) \

167 
öå
 = 'h'; \

168 i‡(
	`ö_so·úq
()) \

169 
öå
 = 's'; \

172 
öå
 = '.'; \

174 i‡(
PRINTCTX_SHOWHDR
 == 1) \

175 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

176 
	`¥_debug
( \

180 , 
	`øw_smp_¥o˚ss‹_id
(), \

181 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

182 (
	`úqs_dißbÀd
()?'d':'.'), \

183 (
	`√ed_ªsched
()?'N':'.'), \

184 
öå
, \

185 (
	`¥ìm±_cou¡
() && 0xff), \

186 
__func__
 \

188 } 0)

	)

220 #ifde‡
__KERNEL__


221 
	#as£π
(
ex¥
) do { \

222 i‡(!(
ex¥
)) { \

223 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

224 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

226 } 0)

	)

230 
ölöe
 
	$bìp
(
wh©
)

232 #ifde‡
__KERNEL__


233 
	`¥_öfo
("%c", ()
wh©
);

235 
	~<uni°d.h
>

236 
buf
 = ()
wh©
;

237 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

239 
	}
}

248 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

250 
c
 = 0, 
m
; \

251 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

253 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

254 
	`bìp
((
vÆ
)); \

255 
c
++; \

256 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

257 
m
 = 0; m < 50; m++); \

258 
x
 = 
ö√r_ödex
 / 2; \

262 }

	)

265 #ifde‡
__KERNEL__


266 
dñay_£c
();

278 
	$dñay_£c
(
vÆ
)

280 
	`asm
 ("");

281 i‡(
	`ö_èsk
()) {

282 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

283 i‡(
vÆ
 == -1)

284 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

286 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

288 
	}
}

291 #ifde‡
__KERNEL__


299 
	~<löux/jiffõs.h
>

300 
	~<löux/ktime.h
>

301 
	#SHOW_DELTA
(
œãr
, 
óæõr
) do { \

302 i‡(
	`time_a·î
(()
œãr
, ()
óæõr
)) { \

303 
s64
 
dñè_ns
 = 
	`ktime_to_ns
(
	`ktime_sub
(
œãr
, 
óæõr
)); \

304 
	`¥_öfo
("dñè: %ŒdÇs", 
dñè_ns
); \

305 i‡(
dñè_ns
/1000 >= 1) \

306 
	`¥_c⁄t
(" (~ %Œd us", 
dñè_ns
/1000); \

307 i‡(
dñè_ns
/1000000 >= 1) \

308 
	`¥_c⁄t
(" ~ %Œd ms", 
dñè_ns
/1000000); \

309 i‡(
dñè_ns
/1000 >= 1) \

310 
	`¥_c⁄t
(")\n"); \

312 
	`¥_w¨n
("SHOW_DELTA(): *invalid*Éarlier >Üater? (check order ofÖarams)\n"); \

313 } 0)

	)

	@Books/Linux-Kernel-Programming-Part-2/ch1/bad_miscdrv/bad_miscdrv.c

34 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

36 
	~<löux/öô.h
>

37 
	~<löux/moduÀ.h
>

38 
	~<löux/miscdevi˚.h
>

39 
	~<löux/¶ab.h
>

40 
	~<löux/mm.h
>

41 
	~<löux/fs.h
>

44 
	~<löux/vîsi⁄.h
>

45 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

46 
	~<löux/uac˚ss.h
>

48 
	~<asm/uac˚ss.h
>

51 
	~<löux/¸ed.h
>

52 
	~"../../c⁄víõ¡.h
"

54 
	#OURMODNAME
 "bad_miscdrv"

	)

55 
MODULE_AUTHOR
("Kaiwan N Billimoria");

56 
MODULE_DESCRIPTION
("LKP-2 book:ch1/bad_miscdrv_rdwr: simple misc char driver"

58 
MODULE_LICENSE
("Dual MIT/GPL");

59 
MODULE_VERSION
("0.1");

61 
	gga
, 
	ggb
 = 1;

67 
	sdrv_˘x
 {

68 
devi˚
 *
	mdev
;

69 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
;

70 
u32
 
	mc⁄fig1
, 
	mc⁄fig2
;

71 
u64
 
	mc⁄fig3
;

72 
	#MAXBYTES
 128

	)

74 
	mour£¸ë
[
MAXBYTES
];

76 
drv_˘x
 *
	g˘x
;

87 
	$›í_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

89 
devi˚
 *
dev
 = 
˘x
->dev;

90 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

92 i‡(
	`u∆ikñy
(!
buf
))

93  -
ENOMEM
;

95 
	`PRINT_CTX
();

96 
ga
++;

97 
gb
--;

98 
	`dev_öfo
(
dev
, " opening \"%s\"Çow; wrt open file: f_flags = 0x%x\n",

99 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
), fûp->
f_Êags
);

100 
	`k‰ì
(
buf
);

102  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

103 
	}
}

114 
ssize_t
 
	$ªad_miscdrv_rdwr
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

115 
size_t
 
cou¡
, 
loff_t
 *
off
)

117 
ªt
 = 
cou¡
, 
£¸ë_Àn
 = 
	`°∫Àn
(
˘x
->
our£¸ë
, 
MAXBYTES
);

118 
devi˚
 *
dev
 = 
˘x
->dev;

119 *
kbuf
 = 
NULL
;

120 *
√w_de°
 = 
NULL
;

122 
	`PRINT_CTX
();

123 
	`dev_öfo
(
dev
, "%†w™t†tÿªad (u±oË%zd byãs\n", 
cuºít
->
comm
, 
cou¡
);

125 
ªt
 = -
EINVAL
;

126 i‡(
cou¡
 < 
MAXBYTES
) {

127 
	`dev_w¨n
(
dev
, "request # of bytes (%zd) is <Ñequired size (%d),ábortingÑead\n",

128 
cou¡
, 
MAXBYTES
);

129 
out_nŸok
;

131 i‡(
£¸ë_Àn
 <= 0) {

132 
	`dev_w¨n
(
dev
, "whoops, something's wrong,Åhe 'secret' isn't"

134 
out_nŸok
;

137 
ªt
 = -
ENOMEM
;

138 
kbuf
 = 
	`kvmÆloc
(
cou¡
, 
GFP_KERNEL
);

139 i‡(
	`u∆ikñy
(!
kbuf
))

140 
out_nomem
;

155 
	#READ_BUG


	)

157 #ifde‡
READ_BUG


163 
√w_de°
 = 
ubuf
+(512*1024);

165 
√w_de°
 = 
ubuf
;

167 
ªt
 = -
EFAULT
;

168 
	`dev_öfo
(
dev
, "de°ádd∏%px\n", 
√w_de°
);

170 i‡(
	`c›y_to_u£r
(
√w_de°
, 
˘x
->
our£¸ë
, 
£¸ë_Àn
)) {

171 
	`dev_w¨n
(
dev
, "copy_to_user() failed\n");

172 
out_˘u
;

174 
ªt
 = 
£¸ë_Àn
;

177 
˘x
->
tx
 +
£¸ë_Àn
;

178 
	`dev_öfo
(
dev
, " %d bytesÑead,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

179 
£¸ë_Àn
, 
˘x
->
tx
, ctx->
rx
);

180 
out_˘u
:

181 
	`kv‰ì
(
kbuf
);

182 
out_nomem
:

183 
out_nŸok
:

184  
ªt
;

185 
	}
}

196 
ssize_t
 
	$wrôe_miscdrv_rdwr
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

197 
size_t
 
cou¡
, 
loff_t
 *
off
)

199 
ªt
 = 
cou¡
;

200 
devi˚
 *
dev
 = 
˘x
->dev;

201 *
kbuf
 = 
NULL
;

202 *
√w_de°
 = 
NULL
;

204 
	`PRINT_CTX
();

205 i‡(
	`u∆ikñy
(
cou¡
 > 
MAXBYTES
)) {

206 
	`dev_w¨n
(
dev
, "count %zdÉxceeds max # of bytesállowed, "

207 "ab‹tög wrôe\n", 
cou¡
);

208 
out_nomem
;

210 
	`dev_öfo
(
dev
, "%s wantsÅo write %zd bytesÅo (original) ubuf = %px\n",

211 
cuºít
->
comm
, 
cou¡
, 
ubuf
);

213 
ªt
 = -
ENOMEM
;

214 
kbuf
 = 
	`kvmÆloc
(
cou¡
, 
GFP_KERNEL
);

215 i‡(
	`u∆ikñy
(!
kbuf
))

216 
out_nomem
;

217 
	`mem£t
(
kbuf
, 0, 
cou¡
);

219 
	#DANGER_GETROOT_BUG


	)

221 #ifde‡
DANGER_GETROOT_BUG


229 
√w_de°
 = &
cuºít
->
¸ed
->
uid
;

230 
cou¡
 = 4;

231 
	`dev_öfo
(
dev
, " [cuºít->¸ed=%px]\n", 
cuºít
->
¸ed
);

233 
√w_de°
 = 
kbuf
;

243 
	`dev_öfo
(
dev
, "de°ádd∏%px cou¡=%zd\n", 
√w_de°
, 
cou¡
);

245 
ªt
 = -
EFAULT
;

246 i‡(
	`c›y_‰om_u£r
(
√w_de°
, 
ubuf
, 
cou¡
)) {

247 
	`dev_w¨n
(
dev
, "copy_from_user() failed\n");

248 
out_cfu
;

256 
	`°æ˝y
(
˘x
->
our£¸ë
, 
kbuf
, (
cou¡
 > 
MAXBYTES
 ? MAXBYTES : count));

259 
	`¥öt_hex_dump_byãs
("˘x ", 
DUMP_PREFIX_OFFSET
,

260 
˘x
, (
drv_˘x
));

263 
˘x
->
rx
 +
cou¡
;

265 
ªt
 = 
cou¡
;

266 
	`dev_öfo
(
dev
, " %zd bytes written,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

267 
cou¡
, 
˘x
->
tx
, ctx->
rx
);

268 
out_cfu
:

269 
	`kv‰ì
(
kbuf
);

270 
out_nomem
:

271  
ªt
;

272 
	}
}

280 
	$˛o£_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

282 
devi˚
 *
dev
 = 
˘x
->dev;

283 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

285 i‡(
	`u∆ikñy
(!
buf
))

286  -
ENOMEM
;

288 
	`PRINT_CTX
();

289 
ga
--; 
gb
++;

290 
	`dev_öfo
(
dev
, " fûíame: \"%s\"\n", 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
));

291 
	`k‰ì
(
buf
);

294 
	}
}

297 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

298 .
›í
 = 
›í_miscdrv_rdwr
,

299 .
	gªad
 = 
ªad_miscdrv_rdwr
,

300 .
	gwrôe
 = 
wrôe_miscdrv_rdwr
,

301 .
	gŒ£ek
 = 
no_Œ£ek
,

302 .
	gªÀa£
 = 
˛o£_miscdrv_rdwr
,

310 
miscdevi˚
 
	gŒkd_miscdev
 = {

311 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

312 .
	g«me
 = "bad_miscdrv",

315 .
	gmode
 = 0666,

316 .
	gf›s
 = &
Œkd_misc_f›s
,

319 
__öô
 
	$bad_miscdrv_öô
()

321 
ªt
;

322 
devi˚
 *
dev
;

324 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

325 i‡(
ªt
) {

326 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

327  
ªt
;

329 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

330 
	`dev_öfo
(
dev
, "LLKD 'bad' misc driver (major # 10)Ñegistered, minor# = %d\n",

331 
Œkd_miscdev
.
mö‹
);

339 
˘x
 = 
	`devm_kzÆloc
(
dev
, (
drv_˘x
), 
GFP_KERNEL
);

340 i‡(
	`u∆ikñy
(!
˘x
))

341  -
ENOMEM
;

344 
˘x
->
dev
 = 
Œkd_miscdev
.
this_devi˚
;

346 
	`°æ˝y
(
˘x
->
our£¸ë
, "initmsg", 8);

347 
	`dev_dbg
(
˘x
->
dev
, "A sampleÖrint viaÅhe dev_dbg(): (bad) driver initialized\n");

350 
	}
}

352 
__exô
 
	$bad_miscdrv_exô
()

354 
	`misc_dîegi°î
(&
Œkd_miscdev
);

355 
	`¥_öfo
("LLKD (bad) misc driver deregistered, bye\n");

356 
	}
}

358 
moduÀ_öô
(
bad_miscdrv_öô
);

359 
moduÀ_exô
(
bad_miscdrv_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch1/bad_miscdrv/rdwr_test_hackit.c

29 
	~<°dio.h
>

30 
	~<uni°d.h
>

31 
	~<°rög.h
>

32 
	~<sys/ty≥s.h
>

33 
	~<limôs.h
>

34 
	~<sys/°©.h
>

35 
	~<f˙é.h
>

36 
	~<°dlib.h
>

38 
	#MAXBYTES
 128

	)

40 
	g°ay_Æive
;

42 
ölöe
 
	$ußge
(*
¥g
)

44 
	`Ârötf
(
°dîr
, "Usage: %s opt=read/write device_file [\"secret-msg\"]\n"

48 
¥g
, 
MAXBYTES
);

49 
	}
}

51 
	$maö
(
¨gc
, **
¨gv
)

53 
›t
 = 'r';

54 
fd
, 
Êags
 = 
O_RDONLY
;

55 
ssize_t
 
n
;

56 *
buf
 = 
NULL
;

57 
size_t
 
num
 = 0;

59 
	#HACKIT


	)

62 #ifde‡
HACKIT


63 i‡(
	`gëuid
() == 0) {

64 
	`¥ötf
("%s: D⁄'àru¿thi†a†roŸ.\n", 
¨gv
[0]);

65 
	`exô
(
EXIT_FAILURE
);

68 i‡(
¨gc
 < 3) {

69 
	`ußge
(
¨gv
[0]);

70 
	`exô
(
EXIT_FAILURE
);

73 
›t
 = 
¨gv
[1][0];

74 i‡(
›t
 != 'r' && opt != 'w') {

75 
	`ußge
(
¨gv
[0]);

76 
	`exô
(
EXIT_FAILURE
);

78 i‡((
›t
 ='w' && 
¨gc
 != 4) ||

79 (
›t
 ='r' && 
¨gc
 != 3)) {

80 
	`ußge
(
¨gv
[0]);

81 
	`exô
(
EXIT_FAILURE
);

83 i‡('w' =
›t
 && 
	`°æí
(
¨gv
[3]Ë> 
MAXBYTES
) {

84 
	`Ârötf
(
°dîr
, "%s:Åoo bigá secret (%zu bytes);ÖlÑestrict"

85 "Åÿ%d byã†max\n", 
¨gv
[0], 
	`°æí
◊rgv[3]), 
MAXBYTES
);

86 
	`exô
(
EXIT_FAILURE
);

89 i‡('w' =
›t
)

90 
Êags
 = 
O_WRONLY
;

91 
fd
 = 
	`›í
(
¨gv
[2], 
Êags
, 0);

92 i‡(
fd
 == -1) {

93 
	`Ârötf
(
°dîr
, "%s: o≥n(2Ë⁄ %†Áûed\n", 
¨gv
[0],árgv[2]);

94 
	`≥º‹
("open");

95 
	`exô
(
EXIT_FAILURE
);

97 
	`¥ötf
("Device file %s opened (in %s mode): fd=%d\n",

98 
¨gv
[2], (
Êags
 =
O_RDONLY
 ? "ªad-⁄ly" : "wrôe-⁄ly"), 
fd
);

100 i‡('w' =
›t
)

101 
num
 = 
	`°æí
(
¨gv
[3])+1;

103 
num
 = 
MAXBYTES
;

105 
buf
 = 
	`mÆloc
(
num
);

106 i‡(!
buf
) {

107 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!\n", 
¨gv
[0]);

108 
	`˛o£
(
fd
);

109 
	`exô
(
EXIT_FAILURE
);

112 i‡('r' =
›t
) {

113 
	`¥ötf
("%s: de° bu‡add∏%p\n", 
¨gv
[0], 
buf
);

114 
n
 = 
	`ªad
(
fd
, 
buf
, 
num
);

115 i‡(
n
 < 0) {

116 
	`≥º‹
("read failed");

117 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

118 
	`‰ì
(
buf
); 
	`˛o£
(
fd
);

119 
	`exô
(
EXIT_FAILURE
);

121 
	`¥ötf
("%s:Ñód %zd byã†‰om %s\n", 
¨gv
[0], 
n
,árgv[2]);

122 
	`¥ötf
("Thê'£¸ë' is:\¿\"%.*s\"\n", ()
n
, 
buf
);

125 #i‚de‡
HACKIT


126 
	`°∫˝y
(
buf
, 
¨gv
[3], 
num
);

128 
	`¥ötf
("%s:áâem±ögÅÿgëÑoŸ ...\n", 
¨gv
[0]);

134 
	`mem£t
(
buf
, 0, 
num
);

136 
n
 = 
	`wrôe
(
fd
, 
buf
, 
num
);

137 i‡(
n
 < 0) {

138 
	`≥º‹
("write failed");

139 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

140 
	`‰ì
(
buf
); 
	`˛o£
(
fd
);

141 
	`exô
(
EXIT_FAILURE
);

143 
	`¥ötf
("%s: wrŸê%zd byã†tÿ%s\n", 
¨gv
[0], 
n
,árgv[2]);

144 #ifde‡
HACKIT


145 i‡(
	`gëuid
() == 0) {

146 
	`¥ötf
(" !Pw√d! uid==%d\n", 
	`gëuid
());

148 
	`exe˛
("/bö/sh", "sh", (*)
NULL
);

153 i‡(
°ay_Æive
) {

154 
	`¥ötf
("%s:%d: sèyö'álivê(öÖau£()Ë...\n", 
¨gv
[0], 
	`gëpid
());

155 
	`∑u£
();

158 
	`‰ì
(
buf
);

159 
	`˛o£
(
fd
);

160 
	`exô
(
EXIT_SUCCESS
);

161 
	}
}

	@Books/Linux-Kernel-Programming-Part-2/ch1/miscdrv/miscdrv.c

20 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

22 
	~<löux/öô.h
>

23 
	~<löux/kî√l.h
>

24 
	~<löux/moduÀ.h
>

25 
	~<löux/miscdevi˚.h
>

26 
	~<löux/fs.h
>

27 
	~<löux/¶ab.h
>

28 
	~"../../c⁄víõ¡.h
"

30 
	#OURMODNAME
 "miscdrv"

	)

32 
MODULE_AUTHOR
("Kaiwan N Billimoria");

33 
MODULE_DESCRIPTION
("LKP-2 book:ch1/miscdrv: simple 'skeleton' misc char driver");

34 
MODULE_LICENSE
("Dual MIT/GPL");

35 
MODULE_VERSION
("0.1");

47 
	$›í_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

49 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

51 i‡(
	`u∆ikñy
(!
buf
))

52  -
ENOMEM
;

53 
	`PRINT_CTX
();

55 
	`¥_öfo
(" opening \"%s\"Çow; wrt open file: f_flags = 0x%x\n",

56 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
), fûp->
f_Êags
);

58 
	`k‰ì
(
buf
);

59  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

60 
	}
}

70 
ssize_t
 
	$ªad_miscdrv
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
off
)

72 
	`¥_öfo
("tÿªad %zd byãs\n", 
cou¡
);

73  
cou¡
;

74 
	}
}

84 
ssize_t
 
	$wrôe_miscdrv
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

85 
size_t
 
cou¡
, 
loff_t
 *
off
)

87 
	`¥_öfo
("tÿwrôê%zd byãs\n", 
cou¡
);

88  
cou¡
;

89 
	}
}

98 
	$˛o£_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

100 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

102 i‡(
	`u∆ikñy
(!
buf
))

103  -
ENOMEM
;

104 
	`¥_öfo
("˛osög \"%s\"\n", 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
));

105 
	`k‰ì
(
buf
);

108 
	}
}

110 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

111 .
›í
 = 
›í_miscdrv
,

112 .
	gªad
 = 
ªad_miscdrv
,

113 .
	gwrôe
 = 
wrôe_miscdrv
,

114 .
	gªÀa£
 = 
˛o£_miscdrv
,

115 .
	gŒ£ek
 = 
no_Œ£ek
,

118 
miscdevi˚
 
	gŒkd_miscdev
 = {

119 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

120 .
	g«me
 = "llkd_miscdrv",

123 .
	gmode
 = 0666,

124 .
	gf›s
 = &
Œkd_misc_f›s
,

127 
__öô
 
	$miscdrv_öô
()

129 
ªt
;

130 
devi˚
 *
dev
;

132 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

133 i‡(
ªt
 != 0) {

134 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

135  
ªt
;

139 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

140 
	`¥_öfo
("LLKD misc driver (major # 10)Ñegistered, minor# = %d,"

141 " devÇodêi†/dev/%s\n", 
Œkd_miscdev
.
mö‹
,Ülkd_miscdev.
«me
);

143 
	`dev_öfo
(
dev
, "ßm∂êdev_öfo(): mö‹# = %d\n", 
Œkd_miscdev
.
mö‹
);

146 
	}
}

148 
__exô
 
	$miscdrv_exô
()

150 
	`misc_dîegi°î
(&
Œkd_miscdev
);

151 
	`¥_öfo
("LLKD misc driver deregistered, bye\n");

152 
	}
}

154 
moduÀ_öô
(
miscdrv_öô
);

155 
moduÀ_exô
(
miscdrv_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch1/miscdrv/rdwr_test.c

20 
	~<°dio.h
>

21 
	~<uni°d.h
>

22 
	~<sys/ty≥s.h
>

23 
	~<limôs.h
>

24 
	~<sys/°©.h
>

25 
	~<f˙é.h
>

26 
	~<°dlib.h
>

28 
	#READ_OPT
 'r'

	)

29 
	#WRITE_OPT
 'w'

	)

31 
	g°ay_Æive
;

33 
ölöe
 
	$ußge
(*
¥g
)

35 
	`Ârötf
(
°dîr
, "Usage: %sÑ|w device_fileÇum_bytes\n"

37 " 'w' => wrôênum_byã†byã†tÿthêdevi˚Çodêdevi˚_fûe\n", 
¥g
);

38 
	}
}

40 
	$maö
(
¨gc
, **
¨gv
)

42 
fd
, 
Êags
 = 
O_RDONLY
;

43 
ssize_t
 
n
;

44 
›t
, *
buf
 = 
NULL
;

45 
size_t
 
num
 = 0;

47 i‡(
¨gc
 != 4) {

48 
	`ußge
(
¨gv
[0]);

49 
	`exô
(
EXIT_FAILURE
);

52 
›t
 = 
¨gv
[1][0];

53 i‡(
›t
 != 'r' && opt != 'w') {

54 
	`ußge
(
¨gv
[0]);

55 
	`exô
(
EXIT_FAILURE
);

57 i‡(
›t
 =
WRITE_OPT
)

58 
Êags
 = 
O_WRONLY
;

60 
fd
 = 
	`›í
(
¨gv
[2], 
Êags
, 0);

61 i‡(
fd
 == -1) {

62 
	`≥º‹
("open");

63 
	`exô
(
EXIT_FAILURE
);

65 
	`¥ötf
("Device file \"%s\" opened (in %s mode): fd=%d\n",

66 
¨gv
[2], (
Êags
 =
O_RDONLY
 ? "ªad-⁄ly" : "wrôe-⁄ly"), 
fd
);

68 
num
 = 
	`©oi
(
¨gv
[3]);

75 i‡(
num
 > 
INT_MAX
) {

76 
	`Ârötf
(
°dîr
, "%s:Çumbî o‡byã†'%zu' invÆid.\n", 
¨gv
[0], 
num
);

77 
	`˛o£
(
fd
);

78 
	`exô
(
EXIT_FAILURE
);

81 
buf
 = 
	`ˇŒoc
(
num
, 1);

82 i‡(!
buf
) {

83 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!\n", 
¨gv
[0]);

84 
	`˛o£
(
fd
);

85 
	`exô
(
EXIT_FAILURE
);

88 i‡(
›t
 =
READ_OPT
) {

89 
n
 = 
	`ªad
(
fd
, 
buf
, 
num
);

90 i‡(
n
 < 0) {

91 
	`≥º‹
("read failed");

92 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

93 
	`‰ì
(
buf
);

94 
	`˛o£
(
fd
);

95 
	`exô
(
EXIT_FAILURE
);

97 
	`¥ötf
("%s:Ñód %zd byã†‰om %s\n", 
¨gv
[0], 
n
,árgv[2]);

98 
	`¥ötf
(" D©®ªad:\n\"%.*s\"\n", ()
n
, 
buf
);

102 
off_t
 
ªt
 = 
	`l£ek
(
fd
, 100, 
SEEK_CUR
);

103 i‡(
ªt
 =(
off_t
)-1)

104 
	`Ârötf
(
°dîr
, "%s:Ü£ek o¿devi˚ faûed\n", 
¨gv
[0]);

107 
n
 = 
	`wrôe
(
fd
, 
buf
, 
num
);

108 i‡(
n
 < 0) {

109 
	`≥º‹
("write failed");

110 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

111 
	`‰ì
(
buf
);

112 
	`˛o£
(
fd
);

113 
	`exô
(
EXIT_FAILURE
);

115 
	`¥ötf
("%s: wrŸê%ld byã†tÿ%s\n", 
¨gv
[0], 
n
,árgv[2]);

118 i‡(
°ay_Æive
 == 1) {

119 
	`¥ötf
("%s:%d: sèyö'álivê(öÖau£()Ë...\n", 
¨gv
[0], 
	`gëpid
());

120 
	`∑u£
();

123 
	`‰ì
(
buf
);

124 
	`˛o£
(
fd
);

125 
	`exô
(
EXIT_SUCCESS
);

126 
	}
}

	@Books/Linux-Kernel-Programming-Part-2/ch1/miscdrv_rdwr/miscdrv_rdwr.c

28 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

30 
	~<löux/öô.h
>

31 
	~<löux/moduÀ.h
>

32 
	~<löux/miscdevi˚.h
>

33 
	~<löux/¶ab.h
>

34 
	~<löux/mm.h
>

35 
	~<löux/fs.h
>

36 
	~<löux/sched.h
>

39 
	~<löux/vîsi⁄.h
>

40 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

41 
	~<löux/uac˚ss.h
>

43 
	~<asm/uac˚ss.h
>

46 
	~"../../c⁄víõ¡.h
"

48 
	#OURMODNAME
 "miscdrv_rdwr"

	)

49 
MODULE_AUTHOR
("Kaiwan N Billimoria");

50 
MODULE_DESCRIPTION
("LKP-2 book:ch1/miscdrv_rdwr: simple misc char driver with"

52 
MODULE_LICENSE
("Dual MIT/GPL");

53 
MODULE_VERSION
("0.1");

55 
	gga
, 
	ggb
 = 1;

61 
	sdrv_˘x
 {

62 
devi˚
 *
	mdev
;

63 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
;

64 
u32
 
	mc⁄fig1
, 
	mc⁄fig2
;

65 
u64
 
	mc⁄fig3
;

66 
	#MAXBYTES
 128

	)

68 
	mour£¸ë
[
MAXBYTES
];

70 
drv_˘x
 *
	g˘x
;

83 
	$›í_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

85 
devi˚
 *
dev
 = 
˘x
->dev;

86 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

88 i‡(
	`u∆ikñy
(!
buf
))

89  -
ENOMEM
;

91 
	`PRINT_CTX
();

92 
ga
++;

93 
gb
--;

94 
	`dev_öfo
(
dev
, " opening \"%s\"Çow; wrt open file: f_flags = 0x%x\n",

95 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
), fûp->
f_Êags
);

96 
	`k‰ì
(
buf
);

98  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

99 
	}
}

110 
ssize_t
 
	$ªad_miscdrv_rdwr
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

111 
size_t
 
cou¡
, 
loff_t
 *
off
)

113 
ªt
 = 
cou¡
, 
£¸ë_Àn
 = 
	`°∫Àn
(
˘x
->
our£¸ë
, 
MAXBYTES
);

114 
devi˚
 *
dev
 = 
˘x
->dev;

115 
èsknm
[
TASK_COMM_LEN
];

117 
	`PRINT_CTX
();

118 
	`dev_öfo
(
dev
, "%†w™t†tÿªad (u±oË%zu byãs\n", 
	`gë_èsk_comm
(
èsknm
, 
cuºít
), 
cou¡
);

120 
ªt
 = -
EINVAL
;

121 i‡(
cou¡
 < 
MAXBYTES
) {

122 
	`dev_w¨n
(
dev
, "request # of bytes (%zu) is <Ñequired size"

123 " (%d),áb‹tögÑód\n", 
cou¡
, 
MAXBYTES
);

124 
out_nŸok
;

126 i‡(
£¸ë_Àn
 <= 0) {

127 
	`dev_w¨n
(
dev
, "whoops, something's wrong,Åhe 'secret' isn't"

129 
out_nŸok
;

143 
ªt
 = -
EFAULT
;

144 i‡(
	`c›y_to_u£r
(
ubuf
, 
˘x
->
our£¸ë
, 
£¸ë_Àn
)) {

145 
	`dev_w¨n
(
dev
, "copy_to_user() failed\n");

146 
out_nŸok
;

148 
ªt
 = 
£¸ë_Àn
;

151 
˘x
->
tx
 +
£¸ë_Àn
;

152 
	`dev_öfo
(
dev
, " %d bytesÑead,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

153 
£¸ë_Àn
, 
˘x
->
tx
, ctx->
rx
);

154 
out_nŸok
:

155  
ªt
;

156 
	}
}

167 
ssize_t
 
	$wrôe_miscdrv_rdwr
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

168 
size_t
 
cou¡
, 
loff_t
 *
off
)

170 
ªt
 = 
cou¡
;

171 *
kbuf
 = 
NULL
;

172 
devi˚
 *
dev
 = 
˘x
->dev;

173 
èsknm
[
TASK_COMM_LEN
];

175 
	`PRINT_CTX
();

176 i‡(
	`u∆ikñy
(
cou¡
 > 
MAXBYTES
)) {

177 
	`dev_w¨n
(
dev
, "count %zuÉxceeds max # of bytesállowed, "

178 "ab‹tög wrôe\n", 
cou¡
);

179 
out_nomem
;

181 
	`dev_öfo
(
dev
, "%†w™t†tÿwrôê%zu byãs\n", 
	`gë_èsk_comm
(
èsknm
, 
cuºít
), 
cou¡
);

183 
ªt
 = -
ENOMEM
;

184 
kbuf
 = 
	`kvmÆloc
(
cou¡
, 
GFP_KERNEL
);

185 i‡(
	`u∆ikñy
(!
kbuf
))

186 
out_nomem
;

187 
	`mem£t
(
kbuf
, 0, 
cou¡
);

196 
ªt
 = -
EFAULT
;

197 i‡(
	`c›y_‰om_u£r
(
kbuf
, 
ubuf
, 
cou¡
)) {

198 
	`dev_w¨n
(
dev
, "copy_from_user() failed\n");

199 
out_cfu
;

207 
	`°æ˝y
(
˘x
->
our£¸ë
, 
kbuf
, (
cou¡
 > 
MAXBYTES
 ? MAXBYTES : count));

210 
	`¥öt_hex_dump_byãs
("˘x ", 
DUMP_PREFIX_OFFSET
,

211 
˘x
, (
drv_˘x
));

214 
˘x
->
rx
 +
cou¡
;

216 
ªt
 = 
cou¡
;

217 
	`dev_öfo
(
dev
, " %zu bytes written,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

218 
cou¡
, 
˘x
->
tx
, ctx->
rx
);

219 
out_cfu
:

220 
	`kv‰ì
(
kbuf
);

221 
out_nomem
:

222  
ªt
;

223 
	}
}

231 
	$˛o£_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

233 
devi˚
 *
dev
 = 
˘x
->dev;

234 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

236 i‡(
	`u∆ikñy
(!
buf
))

237  -
ENOMEM
;

239 
	`PRINT_CTX
();

240 
ga
--;

241 
gb
++;

242 
	`dev_öfo
(
dev
, " fûíame: \"%s\"\n", 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
));

243 
	`k‰ì
(
buf
);

246 
	}
}

249 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

250 .
›í
 = 
›í_miscdrv_rdwr
,

251 .
	gªad
 = 
ªad_miscdrv_rdwr
,

252 .
	gwrôe
 = 
wrôe_miscdrv_rdwr
,

253 .
	gŒ£ek
 = 
no_Œ£ek
,

254 .
	gªÀa£
 = 
˛o£_miscdrv_rdwr
,

265 
miscdevi˚
 
	gŒkd_miscdev
 = {

266 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

267 .
	g«me
 = "llkd_miscdrv_rdwr",

270 .
	gmode
 = 0666,

271 .
	gf›s
 = &
Œkd_misc_f›s
,

274 
__öô
 
	$miscdrv_rdwr_öô
()

276 
ªt
 = 0;

277 
devi˚
 *
dev
;

279 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

280 i‡(
ªt
) {

281 
	`¥_nŸi˚
("%s: mis¯devi˚Ñegi°øti⁄ faûed,áb‹tög\n", 
OURMODNAME
);

282  
ªt
;

285 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

287 
	`¥_öfo
("LLKD misc driver (major # 10)Ñegistered, minor# = %d,"

288 " devÇodêi†/dev/%s\n", 
Œkd_miscdev
.
mö‹
,Ülkd_miscdev.
«me
);

296 
˘x
 = 
	`devm_kzÆloc
(
dev
, (
drv_˘x
), 
GFP_KERNEL
);

297 i‡(
	`u∆ikñy
(!
˘x
))

298  -
ENOMEM
;

300 
˘x
->
dev
 = dev;

302 
	`°æ˝y
(
˘x
->
our£¸ë
, "initmsg", 8);

303 
	`dev_dbg
(
˘x
->
dev
, "A sampleÖrint viaÅhe dev_dbg(): driver initialized\n");

306 
	}
}

308 
__exô
 
	$miscdrv_rdwr_exô
()

310 
	`misc_dîegi°î
(&
Œkd_miscdev
);

311 
	`¥_öfo
("LLKD misc (rdwr) driver deregistered, bye\n");

312 
	}
}

314 
moduÀ_öô
(
miscdrv_rdwr_öô
);

315 
moduÀ_exô
(
miscdrv_rdwr_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch1/miscdrv_rdwr/rdwr_test_secret.c

23 
	~<°dio.h
>

24 
	~<uni°d.h
>

25 
	~<°rög.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<limôs.h
>

28 
	~<sys/°©.h
>

29 
	~<f˙é.h
>

30 
	~<°dlib.h
>

32 
	#MAXBYTES
 128

	)

34 
	g°ay_Æive
;

36 
ölöe
 
	$ußge
(*
¥g
)

38 
	`Ârötf
(
°dîr
,

42 " (max %d byãs)\n", 
¥g
, 
MAXBYTES
);

43 
	}
}

45 
	$maö
(
¨gc
, **
¨gv
)

47 
›t
 = 'r';

48 
fd
, 
Êags
 = 
O_RDONLY
;

49 
ssize_t
 
n
;

50 *
buf
 = 
NULL
;

51 
size_t
 
num
 = 0;

53 i‡(
¨gc
 < 3) {

54 
	`ußge
(
¨gv
[0]);

55 
	`exô
(
EXIT_FAILURE
);

58 
›t
 = 
¨gv
[1][0];

59 i‡(
›t
 != 'r' && opt != 'w') {

60 
	`ußge
(
¨gv
[0]);

61 
	`exô
(
EXIT_FAILURE
);

63 i‡((
›t
 ='w' && 
¨gc
 != 4) || (opt == 'r' &&árgc != 3)) {

64 
	`ußge
(
¨gv
[0]);

65 
	`exô
(
EXIT_FAILURE
);

67 i‡('w' =
›t
 && 
	`°∫Àn
(
¨gv
[3], 
MAXBYTES
) > MAXBYTES) {

68 
	`Ârötf
(
°dîr
, "%s:Åoo bigá secret (%zu bytes);ÖlÑestrict"

69 "Åÿ%d byã†max\n", 
¨gv
[0], 
	`°∫Àn
(argv[3],

70 
MAXBYTES
),

71 
MAXBYTES
);

72 
	`exô
(
EXIT_FAILURE
);

75 i‡('w' =
›t
)

76 
Êags
 = 
O_WRONLY
;

77 
fd
 = 
	`›í
(
¨gv
[2], 
Êags
, 0);

78 i‡(
fd
 == -1) {

79 
	`Ârötf
(
°dîr
, "%s: o≥n(2Ë⁄ %†Áûed\n", 
¨gv
[0],árgv[2]);

80 
	`≥º‹
("open");

81 
	`exô
(
EXIT_FAILURE
);

83 
	`¥ötf
("Device file %s opened (in %s mode): fd=%d\n",

84 
¨gv
[2], (
Êags
 =
O_RDONLY
 ? "ªad-⁄ly" : "wrôe-⁄ly"), 
fd
);

86 i‡('w' =
›t
) {

87 
num
 = 
	`°∫Àn
(
¨gv
[3], 
MAXBYTES
) + 1;

88 i‡(
num
 > 
MAXBYTES
)

89 
num
 = 
MAXBYTES
;

91 
num
 = 
MAXBYTES
;

93 
buf
 = 
	`mÆloc
(
num
);

94 i‡(!
buf
) {

95 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!\n", 
¨gv
[0]);

96 
	`˛o£
(
fd
);

97 
	`exô
(
EXIT_FAILURE
);

100 i‡('r' =
›t
) {

101 
n
 = 
	`ªad
(
fd
, 
buf
, 
num
);

102 i‡(
n
 < 0) {

103 
	`≥º‹
("read failed");

104 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

105 
	`‰ì
(
buf
);

106 
	`˛o£
(
fd
);

107 
	`exô
(
EXIT_FAILURE
);

109 
	`¥ötf
("%s:Ñód %zd byã†‰om %s\n", 
¨gv
[0], 
n
,árgv[2]);

110 
	`¥ötf
("Thê'£¸ë' is:\¿\"%.*s\"\n", ()
n
, 
buf
);

112 
	`°∫˝y
(
buf
, 
¨gv
[3], 
num
);

113 
n
 = 
	`wrôe
(
fd
, 
buf
, 
num
);

114 i‡(
n
 < 0) {

115 
	`≥º‹
("write failed");

116 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

117 
	`‰ì
(
buf
);

118 
	`˛o£
(
fd
);

119 
	`exô
(
EXIT_FAILURE
);

121 
	`¥ötf
("%s: wrŸê%zd byã†tÿ%s\n", 
¨gv
[0], 
n
,árgv[2]);

124 i‡(
°ay_Æive
) {

125 
	`¥ötf
("%s:%d: sèyö'álivê(öÖau£()Ë... \n", 
¨gv
[0],

126 
	`gëpid
());

127 
	`∑u£
();

130 
	`‰ì
(
buf
);

131 
	`˛o£
(
fd
);

132 
	`exô
(
EXIT_SUCCESS
);

133 
	}
}

	@Books/Linux-Kernel-Programming-Part-2/ch2/debugfs_simple_intf/debugfs_simple_intf.c

18 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/sched.h
>

24 
	~<löux/debugfs.h
>

25 
	~<löux/¶ab.h
>

26 
	~<löux/vîsi⁄.h
>

27 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4, 11, 0)

28 
	~<löux/uac˚ss.h
>

29 
	~<löux/sched/sig«l.h
>

31 
	~<asm/uac˚ss.h
>

33 
	~"../../c⁄víõ¡.h
"

35 
	#OURMODNAME
 "dbgfs_sim∂e_ötf"

	)

37 
MODULE_AUTHOR
("Kaiwan N Billimoria");

38 
MODULE_DESCRIPTION
(

40 
MODULE_LICENSE
("Dual MIT/GPL");

41 
MODULE_VERSION
("0.1");

44 
	gˇu£_™_o›s
;

45 
moduÀ_∑øm
(
ˇu£_™_o›s
, , 0644);

46 
MODULE_PARM_DESC
(
ˇu£_™_o›s
,

51 
díåy
 *
	gg∑ª¡
;

54 
DEFINE_MUTEX
(
mtx
);

60 
	sdrv_˘x
 {

61 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
, 
	mpowî
;

62 
u32
 
	mc⁄fig1
;

63 
u32
 
	mc⁄fig2
;

64 
u64
 
	mc⁄fig3
;

65 
	#MAXBYTES
 128

	)

66 
	mour£¸ë
[
MAXBYTES
];

68 
drv_˘x
 *
	ggdrv˘x
;

69 
	gdebug_Àvñ
;

72 
ssize_t
 
	$dbgfs_show_drv˘x
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

73 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

75 
drv_˘x
 *
d©a
 = (drv_˘x *)
fûp
->
f_öode
->
i_¥iv©e
;

77 
	#MAXUPASS
 256

78 
locbuf
[
MAXUPASS
];

	)

80 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

81  -
ERESTARTSYS
;

87 
d©a
->
c⁄fig3
 = 
jiffõs
;

88 
	`¢¥ötf
(
locbuf
, 
MAXUPASS
 - 1,

93 
OURMODNAME
,

94 
d©a
->
tx
, d©a->
rx
, d©a->
îr
, d©a->
myw‹d
, d©a->
powî
,

95 
d©a
->
c⁄fig1
, d©a->
c⁄fig2
, d©a->
c⁄fig3
, data->config3,

96 
d©a
->
our£¸ë
);

98 
	`muãx_u∆ock
(&
mtx
);

99  
	`sim∂e_ªad_‰om_buf„r
(
ubuf
, 
MAXUPASS
, 
Âos
, 
locbuf
,

100 
	`°æí
(
locbuf
));

101 
	}
}

103 c⁄° 
fûe_›î©i⁄s
 
	gdbgfs_drv˘x_f›s
 = {

104 .
ªad
 = 
dbgfs_show_drv˘x
,

107 
drv_˘x
 *
	$Æloc_öô_drv˘x
()

109 
drv_˘x
 *
drv˘x
 = 
NULL
;

111 
drv˘x
 = 
	`kzÆloc
((
drv_˘x
), 
GFP_KERNEL
);

112 i‡(!
drv˘x
)

113  
	`ERR_PTR
(-
ENOMEM
);

114 
drv˘x
->
c⁄fig1
 = 0x0;

115 
drv˘x
->
c⁄fig2
 = 0x48524a5f;

116 
drv˘x
->
c⁄fig3
 = 
jiffõs
;

117 
drv˘x
->
powî
 = 1;

118 
	`°∫˝y
(
drv˘x
->
our£¸ë
, "AhA yyy", 8);

120 
	`¥_öfo
("allocatedánd initÅhe driver context structure\n");

121  
drv˘x
;

122 
	}
}

124 
__öô
 
	$debugfs_sim∂e_ötf_öô
()

126 
°©
 = 0;

127 
díåy
 *
fûe1
, *
fûe2
;

129 i‡(!
	`IS_ENABLED
(
CONFIG_DEBUG_FS
)) {

130 
	`¥_w¨n
("debugfs unsupported! Aborting ...\n");

131  -
EINVAL
;

136 
g∑ª¡
 = 
	`debugfs_¸óã_dú
(
OURMODNAME
, 
NULL
);

137 i‡(!
g∑ª¡
) {

138 
	`¥_öfo
("debugfs_create_dir failed,áborting...\n");

139 
°©
 = 
	`PTR_ERR
(
g∑ª¡
);

140 
out_Áû_1
;

149 
gdrv˘x
 = 
	`Æloc_öô_drv˘x
();

150 i‡(
	`IS_ERR
(
gdrv˘x
)) {

151 
	`¥_öfo
("drv ctxálloc failed,áborting...\n");

152 
°©
 = 
	`PTR_ERR
(
gdrv˘x
);

153 
out_Áû_2
;

160 
	#DBGFS_FILE1
 "Œkd_dbgfs_show_drv˘x"

	)

161 
fûe1
 =

162 
	`debugfs_¸óã_fûe
(
DBGFS_FILE1
, 0440, 
g∑ª¡
, (*)
gdrv˘x
,

163 &
dbgfs_drv˘x_f›s
);

164 i‡(!
fûe1
) {

165 
	`¥_öfo
("debugfs_create_file failed,áborting...\n");

166 
°©
 = 
	`PTR_ERR
(
fûe1
);

167 
out_Áû_3
;

169 
	`¥_debug
("debugfs file 1 <debugfs_mountpt>/%s/%s created\n",

170 
OURMODNAME
, 
DBGFS_FILE1
);

176 
	#DBGFS_FILE2
 "Œkd_dbgfs_debug_Àvñ"

	)

177 #i‡
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(5, 7, 0)

178 
	`debugfs_¸óã_u32
(
DBGFS_FILE2
, 0644, 
g∑ª¡
, &
debug_Àvñ
);

180 
fûe2
 = 
	`debugfs_¸óã_u32
(
DBGFS_FILE2
, 0644, 
g∑ª¡
, &
debug_Àvñ
);

181 i‡(!
fûe2
) {

182 
	`¥_öfo
("debugfs_create_u32 failed,áborting...\n");

183 
°©
 = 
	`PTR_ERR
(
fûe2
);

184 
out_Áû_3
;

187 
	`¥_debug
("debugf†fûê2 <debugfs_mou¡±>/%s/%†¸óãd\n", 
OURMODNAME
, 
DBGFS_FILE2
);

189 
	`¥_öfo
("initialized (fyi, our 'causeán Oops' setting is currently %s)\n",

190 
ˇu£_™_o›s
 == 1 ? "On" : "Off");

193 
out_Áû_3
:

194 
	`k‰ì
(
gdrv˘x
);

195 
out_Áû_2
:

196 
	`debugfs_ªmove_ªcursive
(
g∑ª¡
);

197 
out_Áû_1
:

198  
°©
;

199 
	}
}

201 
__exô
 
	$debugfs_sim∂e_ötf_˛ónup
()

203 
	`k‰ì
(
gdrv˘x
);

204 i‡(!
ˇu£_™_o›s
)

205 
	`debugfs_ªmove_ªcursive
(
g∑ª¡
);

206 
	`¥_öfo
("removed\n");

207 
	}
}

209 
moduÀ_öô
(
debugfs_sim∂e_ötf_öô
);

210 
moduÀ_exô
(
debugfs_sim∂e_ötf_˛ónup
);

	@Books/Linux-Kernel-Programming-Part-2/ch2/debugfs_simple_intf/debugfs_simple_intf2.c

18 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/sched.h
>

24 
	~<löux/debugfs.h
>

25 
	~<löux/¶ab.h
>

26 
	~<löux/vîsi⁄.h
>

27 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4, 11, 0)

28 
	~<löux/uac˚ss.h
>

29 
	~<löux/sched/sig«l.h
>

31 
	~<asm/uac˚ss.h
>

33 
	~"../../c⁄víõ¡.h
"

35 
	#OURMODNAME
 "dbgfs_sim∂e_ötf"

	)

37 
MODULE_AUTHOR
("Kaiwan N Billimoria");

38 
MODULE_DESCRIPTION
(

40 
MODULE_LICENSE
("Dual MIT/GPL");

41 
MODULE_VERSION
("0.1");

44 
	gˇu£_™_o›s
;

45 
moduÀ_∑øm
(
ˇu£_™_o›s
, , 0644);

46 
MODULE_PARM_DESC
(
ˇu£_™_o›s
,

51 
díåy
 *
	gg∑ª¡
;

54 
DEFINE_MUTEX
(
mtx
);

60 
	sdrv_˘x
 {

61 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
, 
	mpowî
;

62 
u32
 
	mc⁄fig1
;

63 
u32
 
	mc⁄fig2
;

64 
u64
 
	mc⁄fig3
;

65 
	#MAXBYTES
 128

	)

66 
	mour£¸ë
[
MAXBYTES
];

68 
drv_˘x
 *
	ggdrv˘x
;

69 
	gdebug_Àvñ
;

72 
ssize_t
 
	$dbgfs_show_drv˘x
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

73 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

75 
drv_˘x
 *
d©a
 = (drv_˘x *)
fûp
->
f_öode
->
i_¥iv©e
;

77 
	#MAXUPASS
 256

78 
locbuf
[
MAXUPASS
];

	)

80 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

81  -
ERESTARTSYS
;

87 
d©a
->
c⁄fig3
 = 
jiffõs
;

88 
	`¢¥ötf
(
locbuf
, 
MAXUPASS
 - 1,

93 
OURMODNAME
,

94 
d©a
->
tx
, d©a->
rx
, d©a->
îr
, d©a->
myw‹d
, d©a->
powî
,

95 
d©a
->
c⁄fig1
, d©a->
c⁄fig2
, d©a->
c⁄fig3
, data->config3,

96 
d©a
->
our£¸ë
);

98 
	`muãx_u∆ock
(&
mtx
);

99  
	`sim∂e_ªad_‰om_buf„r
(
ubuf
, 
MAXUPASS
, 
Âos
, 
locbuf
,

100 
	`°æí
(
locbuf
));

101 
	}
}

103 c⁄° 
fûe_›î©i⁄s
 
	gdbgfs_drv˘x_f›s
 = {

104 .
ªad
 = 
dbgfs_show_drv˘x
,

107 
drv_˘x
 *
	$Æloc_öô_drv˘x
()

109 
drv_˘x
 *
drv˘x
 = 
NULL
;

111 
drv˘x
 = 
	`kzÆloc
((
drv_˘x
), 
GFP_KERNEL
);

112 i‡(!
drv˘x
)

113  
	`ERR_PTR
(-
ENOMEM
);

114 
drv˘x
->
c⁄fig1
 = 0x0;

115 
drv˘x
->
c⁄fig2
 = 0x48524a5f;

116 
drv˘x
->
c⁄fig3
 = 
jiffõs
;

117 
drv˘x
->
powî
 = 1;

118 
	`°∫˝y
(
drv˘x
->
our£¸ë
, "AhA yyy", 8);

120 
	`¥_öfo
("allocatedánd initÅhe driver context structure\n");

121  
drv˘x
;

122 
	}
}

124 
	$debugfs_sim∂e_ötf_öô
()

126 
°©
 = 0;

127 
díåy
 *
fûe1
, *
fûe2
;

129 i‡(!
	`IS_ENABLED
(
CONFIG_DEBUG_FS
)) {

130 
	`¥_w¨n
("debugfs unsupported! Aborting ...\n");

131  -
EINVAL
;

136 
g∑ª¡
 = 
	`debugfs_¸óã_dú
(
OURMODNAME
, 
NULL
);

137 i‡(!
g∑ª¡
) {

138 
	`¥_öfo
("debugfs_create_dir failed,áborting...\n");

139 
°©
 = 
	`PTR_ERR
(
g∑ª¡
);

140 
out_Áû_1
;

149 
gdrv˘x
 = 
	`Æloc_öô_drv˘x
();

150 i‡(
	`IS_ERR
(
gdrv˘x
)) {

151 
	`¥_öfo
("drv ctxálloc failed,áborting...\n");

152 
°©
 = 
	`PTR_ERR
(
gdrv˘x
);

153 
out_Áû_2
;

160 
	#DBGFS_FILE1
 "Œkd_dbgfs_show_drv˘x"

	)

161 
fûe1
 =

162 
	`debugfs_¸óã_fûe
(
DBGFS_FILE1
, 0440, 
g∑ª¡
, (*)
gdrv˘x
,

163 &
dbgfs_drv˘x_f›s
);

164 i‡(!
fûe1
) {

165 
	`¥_öfo
("debugfs_create_file failed,áborting...\n");

166 
°©
 = 
	`PTR_ERR
(
fûe1
);

167 
out_Áû_3
;

169 
	`¥_debug
("debugfs file 1 <debugfs_mountpt>/%s/%s created\n",

170 
OURMODNAME
, 
DBGFS_FILE1
);

176 
	#DBGFS_FILE2
 "Œkd_dbgfs_debug_Àvñ"

	)

177 
	`debugfs_¸óã_u32
(
DBGFS_FILE2
, 0644, 
g∑ª¡
, &
debug_Àvñ
);

183 
	`¥_debug
("debugf†fûê2 <debugfs_mou¡±>/%s/%†¸óãd\n", 
OURMODNAME
, 
DBGFS_FILE2
);

185 
	`¥_öfo
("initialized (fyi, our 'causeán Oops' setting is currently %s)\n",

186 
ˇu£_™_o›s
 == 1 ? "On" : "Off");

189 
out_Áû_3
:

190 
	`k‰ì
(
gdrv˘x
);

191 
out_Áû_2
:

192 
	`debugfs_ªmove_ªcursive
(
g∑ª¡
);

193 
out_Áû_1
:

194  
°©
;

195 
	}
}

197 
	$debugfs_sim∂e_ötf_˛ónup
()

199 
	`k‰ì
(
gdrv˘x
);

200 i‡(!
ˇu£_™_o›s
)

201 
	`debugfs_ªmove_ªcursive
(
g∑ª¡
);

202 
	`¥_öfo
("removed\n");

203 
	}
}

205 
moduÀ_öô
(
debugfs_sim∂e_ötf_öô
);

206 
moduÀ_exô
(
debugfs_sim∂e_ötf_˛ónup
);

	@Books/Linux-Kernel-Programming-Part-2/ch2/ioctl_intf/ioctl_llkd.h

27 
	#IOCTL_LLKD_MAGIC
 0xA8

	)

29 
	#IOCTL_LLKD_MAXIOCTL
 3

	)

38 
	#IOCTL_LLKD_IOCRESET
 
	`_IO
(
IOCTL_LLKD_MAGIC
, 0)

	)

41 
	#IOCTL_LLKD_IOCQPOWER
 
	`_IOR
(
IOCTL_LLKD_MAGIC
, 1, )

	)

44 
	#IOCTL_LLKD_IOCSPOWER
 
	`_IOW
(
IOCTL_LLKD_MAGIC
, 2, )

	)

	@Books/Linux-Kernel-Programming-Part-2/ch2/ioctl_intf/kerneldrv_ioctl/ioctl_llkd_kdrv.c

23 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

25 
	~<löux/moduÀ.h
>

26 
	~<löux/kî√l.h
>

27 
	~<löux/öô.h
>

28 
	~<löux/fs.h
>

29 
	~<löux/io˘l.h
>

32 
	~<löux/vîsi⁄.h
>

33 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

34 
	~<löux/uac˚ss.h
>

36 
	~<asm/uac˚ss.h
>

39 
	~"../io˘l_Œkd.h
"

40 
	~"../../../c⁄víõ¡.h
"

42 
	#OURMODNAME
 "io˘l_Œkd_kdrv"

	)

43 
MODULE_AUTHOR
("Kaiwan N Billimoria");

44 
MODULE_DESCRIPTION
(

46 
MODULE_LICENSE
("Dual MIT/GPL");

47 
MODULE_VERSION
("0.1");

49 
	gio˘l_ötf_maj‹
,

50 
	gpowî
 = 1;

57 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2, 6, 36)

58 
	$io˘l_ötf_io˘l
(
fûe
 *
fûp
, 
cmd
, 
¨g
)

60 
	$io˘l_ötf_io˘l
(
öode
 *
öo
, 
fûe
 *
fûp
, 
cmd
,

61 
¨g
)

64 
ªtvÆ
 = 0;

66 
	`¥_debug
("I¿io˘»mëhod, cmd=%d\n", 
	`_IOC_NR
(
cmd
));

69 i‡(
	`_IOC_TYPE
(
cmd
Ë!
IOCTL_LLKD_MAGIC
) {

70 
	`¥_öfo
("ioctl fail; magic # mismatch\n");

71  -
ENOTTY
;

73 i‡(
	`_IOC_NR
(
cmd
Ë> 
IOCTL_LLKD_MAXIOCTL
) {

74 
	`¥_öfo
("ioctl fail; invalid cmd?\n");

75  -
ENOTTY
;

78 
cmd
) {

79 
IOCTL_LLKD_IOCRESET
:

80 
	`¥_debug
("In ioctl cmd option: IOCTL_LLKD_IOCRESET\n");

84 
IOCTL_LLKD_IOCQPOWER
:

85 
	`¥_debug
("In ioctl cmd option: IOCTL_LLKD_IOCQPOWER\n"

86 "¨g=0x%x (drvËpowî=%d\n", ()
¨g
, 
powî
);

87 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

88  -
EPERM
;

93 
ªtvÆ
 = 
	`__put_u£r
(
powî
, (
__u£r
 *)
¨g
);

95 
IOCTL_LLKD_IOCSPOWER
:

96 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

97  -
EPERM
;

98 
powî
 = 
¨g
;

102 
	`¥_debug
("In ioctl cmd option: IOCTL_LLKD_IOCSPOWER\n"

103 "powî=%dÇow.\n", 
powî
);

106  -
ENOTTY
;

108  
ªtvÆ
;

109 
	}
}

111 c⁄° 
fûe_›î©i⁄s
 
	gio˘l_ötf_f›s
 = {

112 .
Œ£ek
 = 
no_Œ£ek
,

113 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2, 6, 36)

114 .
	gu∆ocked_io˘l
 = 
io˘l_ötf_io˘l
,

116 .
	gio˘l
 = 
io˘l_ötf_io˘l
,

120 
	$io˘l_ötf_›í
(
öode
 *öode, 
fûe
 *
fûp
)

122 
	`¥_debug
("Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

124 
	`imö‹
(
öode
)) {

126 
fûp
->
f_›
 = &
io˘l_ötf_f›s
;

129  -
ENXIO
;

131 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

132  
fûp
->
f_›
->
	`›í
(
öode
, filp);

135 
	}
}

138 
fûe_›î©i⁄s
 
	gio˘l_ötf_›í_f›s
 = {

139 .
›í
 = 
io˘l_ötf_›í
,

142 
__öô
 
	$io˘l_Œkd_kdrv_öô
()

144 
ªsu…
;

146 
	`¥_debug
("io˘l_ötf_maj‹=%d\n", 
io˘l_ötf_maj‹
);

152 
ªsu…
 = 
	`ªgi°î_chrdev
(
io˘l_ötf_maj‹
, 
OURMODNAME
, &
io˘l_ötf_›í_f›s
);

153 i‡(
ªsu…
 < 0) {

154 
	`¥_öfo
("ªgi°î_chrdev(ËÁûedÅryögÅÿgë io˘l_ötf_maj‹=%d\n", 
io˘l_ötf_maj‹
);

155  
ªsu…
;

158 i‡(
io˘l_ötf_maj‹
 == 0)

159 
io˘l_ötf_maj‹
 = 
ªsu…
;

160 
	`¥_debug
("ªgi°îed:: io˘l_ötf_maj‹=%d\n", 
io˘l_ötf_maj‹
);

162 
	`¥_öfo
("initialized\n");

164 
	}
}

166 
	$io˘l_Œkd_kdrv_˛ónup
()

168 
	`uƒegi°î_chrdev
(
io˘l_ötf_maj‹
, 
OURMODNAME
);

169 
	`¥_öfo
("removed\n");

170 
	}
}

172 
moduÀ_öô
(
io˘l_Œkd_kdrv_öô
);

173 
moduÀ_exô
(
io˘l_Œkd_kdrv_˛ónup
);

	@Books/Linux-Kernel-Programming-Part-2/ch2/ioctl_intf/userspace_ioctl/ioctl_llkd_userspace.c

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<sys/ty≥s.h
>

22 
	~<sys/°©.h
>

23 
	~<f˙é.h
>

24 
	~<sig«l.h
>

25 
	~<°dlib.h
>

26 
	~<sys/io˘l.h
>

27 
	~"../io˘l_Œkd.h
"

29 
	$maö
(
¨gc
, **
¨gv
)

31 
fd
, 
powî
;

33 i‡(
¨gc
 < 2) {

34 
	`Ârötf
(
°dîr
, "Ußge: %†devi˚_fûe\n\
 devi˚_fûêd€†nŸÉxi°, cª©êô usög mknod(1Ë◊†roŸ)\n", 
¨gv
[0]);

36 
	`exô
(
EXIT_FAILURE
);

39 i‡((
fd
 = 
	`›í
(
¨gv
[1], 
O_RDWR
, 0)) == -1) {

40 
	`≥º‹
("open");

41 
	`exô
(
EXIT_FAILURE
);

43 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

45 
¥ötf


48 
IOCTL_LLKD_IOCRESET
, ()
IOCTL_LLKD_IOCQPOWER
,

49 ()
IOCTL_LLKD_IOCSPOWER
);

53 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_IOCRESET
, 0) == -1) {

54 
	`≥º‹
("ioctl IOCTL_LLKD_IOCRESET failed");

55 
	`˛o£
(
fd
);

56 
	`exô
(
EXIT_FAILURE
);

58 
	`¥ötf
("%s: devi˚Ñe£t.\n", 
¨gv
[0]);

61 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_IOCQPOWER
, &
powî
) == -1) {

62 
	`≥º‹
("ioctl IOCTL_LLKD_IOCQPOWER failed");

63 
	`˛o£
(
fd
);

64 
	`exô
(
EXIT_FAILURE
);

66 
	`¥ötf
("%s:Öowî=%d\n", 
¨gv
[0], 
powî
);

69 i‡(0 =
powî
) {

70 
	`¥ötf
("%s: Devi˚ OFF,Öowîög iàO¿now ...\n", 
¨gv
[0]);

71 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_IOCSPOWER
, 1) == -1) {

72 
	`≥º‹
("ioctl IOCTL_LLKD_IOCSPOWER failed");

73 
	`˛o£
(
fd
);

74 
	`exô
(
EXIT_FAILURE
);

76 
	`¥ötf
("%s:Öowî i†ONÇow.\n", 
¨gv
[0]);

77 } i‡(1 =
powî
) {

78 
	`¥ötf
("%s: Devi˚ ON,Öowîög iàOFF i¿3†...\n", 
¨gv
[0]);

79 
	`¶ìp
(3);

80 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_IOCSPOWER
, 0) == -1) {

81 
	`≥º‹
("ioctl IOCTL_LLKD_IOCSPOWER failed");

82 
	`˛o£
(
fd
);

83 
	`exô
(
EXIT_FAILURE
);

85 
	`¥ötf
("%s:Öowî OFF ok,Éxôög..\n", 
¨gv
[0]);

88 
	`˛o£
(
fd
);

89 
	`exô
(
EXIT_SUCCESS
);

90 
	}
}

	@Books/Linux-Kernel-Programming-Part-2/ch2/netlink_simple_intf/kernelspace_netlink/netlink_simple_intf.c

19 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

21 
	~<löux/öô.h
>

22 
	~<löux/moduÀ.h
>

23 
	~<löux/kî√l.h
>

24 
	~<√t/sock.h
>

25 
	~<löux/√éök.h
>

26 
	~<löux/skbuff.h
>

27 
	~"../../../c⁄víõ¡.h
"

29 
MODULE_AUTHOR
("<insert yourÇame here>");

30 
MODULE_DESCRIPTION
("ch2/netlink_simple_intf: simpleÇetlinkÑecv/send demo kernel module");

31 
MODULE_LICENSE
("Dual MIT/GPL");

32 
MODULE_VERSION
("0.1");

34 
	#OURMODNAME
 "√éök_sim∂e_ötf"

	)

35 
	#NETLINK_MY_UNIT_PROTO
 31

	)

37 
	#NLSPACE
 1024

	)

39 
sock
 *
	g∆sock
;

50 
	$√éök_ªcv_™d_ª∂y
(
sk_buff
 *
skb
)

52 
∆msghdr
 *
∆h
;

53 
sk_buff
 *
skb_tx
;

54 *
ª∂y
 = "Reply from kernelÇetlink";

55 
pid
, 
msgsz
, 
°©
;

59 
	`PRINT_CTX
();

61 
∆h
 = (
∆msghdr
 *)
skb
->
d©a
;

62 
pid
 = 
∆h
->
∆msg_pid
;

63 
	`¥_öfo
("received from PID %d:\n"

64 "\"%s\"\n", 
pid
, (*)
	`NLMSG_DATA
(
∆h
));

67 
msgsz
 = 
	`°∫Àn
(
ª∂y
, 
NLSPACE
);

68 
skb_tx
 = 
	`∆msg_√w
(
msgsz
, 0);

69 i‡(!
skb_tx
) {

70 
	`¥_w¨n
("skbálloc failed!\n");

75 
∆h
 = 
	`∆msg_put
(
skb_tx
, 0, 0, 
NLMSG_DONE
, 
msgsz
, 0);

76 
	`NETLINK_CB
(
skb_tx
).
d°_group
 = 0;

78 
	`°∫˝y
(
	`∆msg_d©a
(
∆h
), 
ª∂y
, 
msgsz
);

81 
°©
 = 
	`∆msg_uniˇ°
(
∆sock
, 
skb_tx
, 
pid
);

82 i‡(
°©
 < 0)

83 
	`¥_w¨n
("∆msg_uniˇ°(ËÁûed (îr=%d)\n", 
°©
);

84 
	`¥_öfo
("reply sent\n");

85 
	}
}

87 
√éök_kî√l_cfg
 
	g∆_kî√l_cfg
 = {

88 .
öput
 = 
√éök_ªcv_™d_ª∂y
,

91 
__öô
 
	$√éök_sim∂e_ötf_öô
()

93 
	`¥_öfo
("creating kernelÇetlink socket\n");

98 
∆sock
 = 
	`√éök_kî√l_¸óã
(&
öô_√t
, 
NETLINK_MY_UNIT_PROTO
,

99 &
∆_kî√l_cfg
);

100 i‡(!
∆sock
) {

101 
	`¥_w¨n
("netlink_kernel_create failed\n");

102  
	`PTR_ERR
(
∆sock
);

105 
	`¥_öfo
("inserted\n");

107 
	}
}

109 
__exô
 
	$√éök_sim∂e_ötf_exô
()

111 
	`√éök_kî√l_ªÀa£
(
∆sock
);

112 
	`¥_öfo
("removed\n");

113 
	}
}

115 
moduÀ_öô
(
√éök_sim∂e_ötf_öô
);

116 
moduÀ_exô
(
√éök_sim∂e_ötf_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch2/netlink_simple_intf/userapp_netlink/netlink_userapp.c

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

21 
	~<uni°d.h
>

22 
	~<°rög.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/sockë.h
>

25 
	~<löux/√éök.h
>

27 
	#NETLINK_MY_UNIT_PROTO
 31

	)

29 
	#NLSPACE
 1024

	)

31 c⁄° *
	gthed©a
 = "sample user dataÅo sendÅo kernel viaÇetlink";

33 
	$maö
(
¨gc
, **
¨gv
)

35 
sd
;

36 
sockaddr_∆
 
§c_∆
, 
de°_∆
;

37 
∆msghdr
 *
∆hdr
;

38 
iovec
 
iov
;

39 
msghdr
 
msg
;

40 
ssize_t
 
n£¡
, 
ƒecv
;

43 
sd
 = 
	`sockë
(
PF_NETLINK
, 
SOCK_RAW
, 
NETLINK_MY_UNIT_PROTO
);

44 i‡(
sd
 < 0) {

45 
	`≥º‹
("netlink_u:Çetlink socket creation failed");

46 
	`exô
(
EXIT_FAILURE
);

48 
	`¥ötf
("%s:PID %d:Çëlök sockë cª©ed\n", 
¨gv
[0], 
	`gëpid
());

51 
	`mem£t
(&
§c_∆
, 0, (src_nl));

52 
§c_∆
.
∆_Ámûy
 = 
AF_NETLINK
;

56 
§c_∆
.
∆_pid
 = 
	`gëpid
();

57 
§c_∆
.
∆_groups
 = 0x0;

58 i‡(
	`böd
(
sd
, (
sockaddr
 *)&
§c_∆
, (src_nl)) < 0) {

59 
	`≥º‹
("netlink_u: bind failed");

60 
	`exô
(
EXIT_FAILURE
);

62 
	`¥ötf
("%s: böd d⁄e\n", 
¨gv
[0]);

65 
	`mem£t
(&
de°_∆
, 0, (dest_nl));

66 
de°_∆
.
∆_Ámûy
 = 
AF_NETLINK
;

67 
de°_∆
.
∆_groups
 = 0x0;

68 
de°_∆
.
∆_pid
 = 0;

71 
∆hdr
 = (
∆msghdr
 *)
	`mÆloc
(
	`NLMSG_SPACE
(
NLSPACE
));

72 i‡(!
∆hdr
) {

73 
	`Ârötf
(
°dîr
, "netlink_u: mallocÇlhdr failed");

74 
	`exô
(
EXIT_FAILURE
);

76 
	`mem£t
(
∆hdr
, 0, 
	`NLMSG_SPACE
(
NLSPACE
));

77 
∆hdr
->
∆msg_Àn
 = 
	`NLMSG_SPACE
(
NLSPACE
);

78 
∆hdr
->
∆msg_pid
 = 
	`gëpid
();

81 
	`°∫˝y
(
	`NLMSG_DATA
(
∆hdr
), 
thed©a
, 
	`°∫Àn
—hed©a, 
NLSPACE
)+1);

82 
	`¥ötf
("%s: de°ö©i⁄ såu˘,Çëlök hdr,Öaylﬂd sëup\n", 
¨gv
[0]);

85 
	`mem£t
(&
iov
, 0, (
iovec
));

86 
iov
.
iov_ba£
 = (*)
∆hdr
;

87 
iov
.
iov_Àn
 = 
∆hdr
->
∆msg_Àn
;

88 
	`¥ötf
("%s: inôülized iov såu˘uª (∆ hódî fﬁded in)\n", 
¨gv
[0]);

91 
	`mem£t
(&
msg
, 0, (
msghdr
));

92 
msg
.
msg_«me
 = (*)&
de°_∆
;

93 
msg
.
msg_«mñí
 = (
de°_∆
);

94 
msg
.
msg_iov
 = &
iov
;

95 
msg
.
msg_iovÀn
 = 1;

96 
	`¥ötf
("%s: inôülized msghd∏°ru˘uª (iov fﬁded in)\n", 
¨gv
[0]);

99 
n£¡
 = 
	`£ndmsg
(
sd
, &
msg
, 0);

100 i‡(
n£¡
 < 0) {

101 
	`≥º‹
("netlink_u: sendmsg(2) failed");

102 
	`‰ì
(
∆hdr
);

103 
	`exô
(
EXIT_FAILURE
);

104 } i‡(
n£¡
 == 0) {

105 
	`¥ötf
(" 0 bytes sent\n");

106 
	`‰ì
(
∆hdr
);

107 
	`exô
(
EXIT_FAILURE
);

109 
	`¥ötf
("%s:sendmsg(): *** success, sent %ld bytesáll-inclusive\n"

110 " (£êkî√»log f‹ dé)\n", 
¨gv
[0], 
n£¡
);

111 
	`fÊush
(
°dout
);

114 
	`¥ötf
("%s:Çow blockög o¿kî√»√éök msg vüÑecvmsg(Ë...\n", 
¨gv
[0]);

115 
ƒecv
 = 
	`ªcvmsg
(
sd
, &
msg
, 0);

116 i‡(
ƒecv
 < 0) {

117 
	`≥º‹
("netlink_u:Ñecvmsg(2) failed");

118 
	`‰ì
(
∆hdr
);

119 
	`exô
(
EXIT_FAILURE
);

121 
	`¥ötf
("%s:recvmsg(): *** success,Ñeceived %ld bytes:"

123 
¨gv
[0], 
ƒecv
, (*)
	`NLMSG_DATA
(
∆hdr
));

126 
	`‰ì
(
∆hdr
);

127 
	`˛o£
(
sd
);

128 
	`exô
(
EXIT_SUCCESS
);

129 
	}
}

	@Books/Linux-Kernel-Programming-Part-2/ch2/procfs_simple_intf/procfs_simple_intf.c

56 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

58 
	~<löux/öô.h
>

59 
	~<löux/moduÀ.h
>

60 
	~<löux/kî√l.h
>

61 
	~<löux/muãx.h
>

62 
	~<löux/sched.h
>

63 
	~<löux/¶ab.h
>

64 
	~<löux/¥oc_fs.h
>

65 
	~<löux/£q_fûe.h
>

68 
	~<löux/vîsi⁄.h
>

69 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

70 
	~<löux/uac˚ss.h
>

72 
	~<asm/uac˚ss.h
>

75 
MODULE_AUTHOR
("Kaiwan N Billimoria");

76 
MODULE_DESCRIPTION
("LKP-2 book:user_kernel_comm/procfs_simple_intf: simpleÖrocfs interfacing demo");

77 
MODULE_LICENSE
("Dual MIT/GPL");

78 
MODULE_VERSION
("0.1");

80 
	#OURMODNAME
 "¥ocfs_sim∂e_ötf"

	)

81 
	#PROC_FILE1
 "Œkd¥oc_debug_Àvñ"

	)

82 
	#PROC_FILE1_PERMS
 0644

	)

83 
	#PROC_FILE2
 "Œkd¥oc_show_pgoff"

	)

84 
	#PROC_FILE2_PERMS
 0444

	)

85 
	#PROC_FILE3
 "Œkd¥oc_show_drv˘x"

	)

86 
	#PROC_FILE3_PERMS
 0440

	)

87 
	#PROC_FILE4
 "Œkd¥oc_c⁄fig1"

	)

88 
	#PROC_FILE4_PERMS
 0644

	)

91 
DEFINE_MUTEX
(
mtx
);

97 
	sdrv_˘x
 {

98 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
, 
	mpowî
;

99 
u32
 
	mc⁄fig1
;

100 
u32
 
	mc⁄fig2
;

101 
u64
 
	mc⁄fig3
;

102 
	#MAXBYTES
 128

	)

103 
	mour£¸ë
[
MAXBYTES
];

105 
drv_˘x
 *
	ggdrv˘x
;

106 
	gdebug_Àvñ
;

110 
	$¥oc_show_c⁄fig1
(
£q_fûe
 *
£q
, *
v
)

112 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

113  -
ERESTARTSYS
;

114 
	`£q_¥ötf
(
£q
, "%s:config1:%d,0x%x\n",

115 
OURMODNAME
, 
gdrv˘x
->
c⁄fig1
, gdrvctx->config1);

116 
	`muãx_u∆ock
(&
mtx
);

118 
	}
}

122 
ssize_t
 
	$my¥oc_wrôe_c⁄fig1
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

123 
size_t
 
cou¡
, 
loff_t
 *
off
)

125 
buf
[8];

126 
ªt
 = 
cou¡
;

127 
c⁄figvÆ
 = 0;

129 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

130  -
ERESTARTSYS
;

131 i‡(
cou¡
 =0 || cou¡ > (
buf
)) {

132 
ªt
 = -
EINVAL
;

133 
out
;

135 i‡(
	`c›y_‰om_u£r
(
buf
, 
ubuf
, 
cou¡
)) {

136 
ªt
 = -
EFAULT
;

137 
out
;

139 
buf
[
cou¡
 - 1] = '\0';

140 
	`¥_debug
("u£∏£¡: bu‡%s\n", 
buf
);

141 
ªt
 = 
	`k°πoul
(
buf
, 0, &
c⁄figvÆ
);

142 i‡(
ªt
)

143 
out
;

144 
gdrv˘x
->
c⁄fig1
 = 
c⁄figvÆ
;

146 
debug_Àvñ
 = 
c⁄figvÆ
;

147 
ªt
 = 
cou¡
;

148 
out
:

149 
	`muãx_u∆ock
(&
mtx
);

150  
ªt
;

151 
	}
}

153 
	$my¥oc_›í_c⁄fig1
(
öode
 *öode, 
fûe
 *file)

155  
	`sögÀ_›í
(
fûe
, 
¥oc_show_c⁄fig1
, 
NULL
);

156 
	}
}

158 c⁄° 
fûe_›î©i⁄s
 
	gf›s_rdwr_c⁄fig1
 = {

159 .
ow√r
 = 
THIS_MODULE
,

160 .
	g›í
 = 
my¥oc_›í_c⁄fig1
,

161 .
	gªad
 = 
£q_ªad
,

162 .
	gwrôe
 = 
my¥oc_wrôe_c⁄fig1
,

163 .
	gŒ£ek
 = 
£q_l£ek
,

164 .
	gªÀa£
 = 
sögÀ_ªÀa£
,

169 
	$¥oc_show_drv˘x
(
£q_fûe
 *
£q
, *
v
)

171 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

172  -
ERESTARTSYS
;

173 
	`£q_¥ötf
(
£q
, "prodname:%s\n"

177 
OURMODNAME
,

178 
gdrv˘x
->
tx
, gdrv˘x->
rx
, gdrv˘x->
îr
, gdrv˘x->
myw‹d
, gdrv˘x->
powî
,

179 
gdrv˘x
->
c⁄fig1
, gdrv˘x->
c⁄fig2
, gdrv˘x->
c⁄fig3
,

180 
gdrv˘x
->
our£¸ë
);

181 
	`muãx_u∆ock
(&
mtx
);

183 
	}
}

185 
	$my¥oc_›í_drv˘x
(
öode
 *öode, 
fûe
 *file)

187  
	`sögÀ_›í
(
fûe
, 
¥oc_show_drv˘x
, 
NULL
);

188 
	}
}

190 c⁄° 
fûe_›î©i⁄s
 
	gf›s_show_drv˘x
 = {

191 .
ow√r
 = 
THIS_MODULE
,

192 .
	g›í
 = 
my¥oc_›í_drv˘x
,

193 .
	gªad
 = 
£q_ªad
,

194 .
	gŒ£ek
 = 
£q_l£ek
,

195 .
	gªÀa£
 = 
sögÀ_ªÀa£
,

198 
drv_˘x
 *
	$Æloc_öô_drv˘x
()

200 
drv_˘x
 *
drv˘x
 = 
NULL
;

202 
drv˘x
 = 
	`kzÆloc
((
drv_˘x
), 
GFP_KERNEL
);

203 i‡(!
drv˘x
)

204  
	`ERR_PTR
(-
ENOMEM
);

206 
drv˘x
->
c⁄fig1
 = 0x0;

207 
drv˘x
->
c⁄fig2
 = 0x48524a5f;

208 
drv˘x
->
c⁄fig3
 = 0x424c0a52;

209 
drv˘x
->
powî
 = 1;

210 
	`°∫˝y
(
drv˘x
->
our£¸ë
, "AhA xxx", 8);

212 
	`¥_debug
("allocatedánd initÅhe driver context structure\n");

213  
drv˘x
;

214 
	}
}

218 
	$¥oc_show_pgoff
(
£q_fûe
 *
£q
, *
v
)

220 
	`£q_¥ötf
(
£q
, "%s:PAGE_OFFSET:0x%px\n", 
OURMODNAME
, 
PAGE_OFFSET
);

222 
	}
}

225 
	#DEBUG_LEVEL_MIN
 0

	)

226 
	#DEBUG_LEVEL_MAX
 2

	)

227 
	#DEBUG_LEVEL_DEFAULT
 
DEBUG_LEVEL_MIN


	)

231 
ssize_t
 
	$my¥oc_wrôe_debug_Àvñ
(

232 
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
, 
size_t
 
cou¡
,

233 
loff_t
 *
off
)

235 
buf
[12];

236 
ªt
 = 
cou¡
;

238 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

239  -
ERESTARTSYS
;

240 i‡(
cou¡
 == 0 || count > 12) {

241 
ªt
 = -
EINVAL
;

242 
out
;

245 i‡(
	`c›y_‰om_u£r
(
buf
, 
ubuf
, 
cou¡
)) {

246 
ªt
 = -
EFAULT
;

247 
out
;

249 
buf
[
cou¡
 - 1] = '\0';

250 
	`¥_debug
("u£∏£¡: bu‡%s\n", 
buf
);

251 
ªt
 = 
	`k°πoöt
(
buf
, 0, &
debug_Àvñ
);

252 i‡(
ªt
)

253 
out
;

254 i‡(
debug_Àvñ
 < 
DEBUG_LEVEL_MIN
 || debug_Àvñ > 
DEBUG_LEVEL_MAX
) {

255 
	`¥_öfo
("tryingÅo set invalid value for debug_level\n"

256 " [ÆlowedÑ™ge: %d-%d]\n", 
DEBUG_LEVEL_MIN
, 
DEBUG_LEVEL_MAX
);

257 
debug_Àvñ
 = 
DEBUG_LEVEL_DEFAULT
;

258 
ªt
 = -
EFAULT
;

259 
out
;

267 
gdrv˘x
->
c⁄fig1
 = 
debug_Àvñ
;

268 
ªt
 = 
cou¡
;

269 
out
:

270 
	`muãx_u∆ock
(&
mtx
);

271  
ªt
;

272 
	}
}

275 
	$¥oc_show_debug_Àvñ
(
£q_fûe
 *
£q
, *
v
)

277 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

278  -
ERESTARTSYS
;

279 
	`£q_¥ötf
(
£q
, "debug_Àvñ:%d\n", 
debug_Àvñ
);

280 
	`muãx_u∆ock
(&
mtx
);

282 
	}
}

284 
	$my¥oc_›í_dbg_Àvñ
(
öode
 *öode, 
fûe
 *file)

286  
	`sögÀ_›í
(
fûe
, 
¥oc_show_debug_Àvñ
, 
NULL
);

287 
	}
}

289 c⁄° 
fûe_›î©i⁄s
 
	gf›s_rdwr_dbg_Àvñ
 = {

290 .
ow√r
 = 
THIS_MODULE
,

291 .
	g›í
 = 
my¥oc_›í_dbg_Àvñ
,

292 .
	gªad
 = 
£q_ªad
,

293 .
	gwrôe
 = 
my¥oc_wrôe_debug_Àvñ
,

294 .
	gŒ£ek
 = 
£q_l£ek
,

295 .
	gªÀa£
 = 
sögÀ_ªÀa£
,

299 
¥oc_dú_íåy
 *
	gg¥ocdú
;

301 
__öô
 
	$¥ocfs_sim∂e_ötf_öô
()

303 
°©
 = 0;

305 i‡(
	`u∆ikñy
(!
	`IS_ENABLED
(
CONFIG_PROC_FS
))) {

306 
	`¥_w¨n
("procfs unsupported! Aborting ...\n");

307  -
EINVAL
;

311 
g¥ocdú
 = 
	`¥oc_mkdú
(
OURMODNAME
, 
NULL
);

312 i‡(!
g¥ocdú
) {

313 
	`¥_w¨n
("proc_mkdir failed,áborting...\n");

314 
°©
 = -
ENOMEM
;

315 
out_Áû_1
;

317 
	`¥_debug
("¥o¯dú (/¥oc/%sË¸óãd\n", 
OURMODNAME
);

326 i‡(!
	`¥oc_¸óã
(
PROC_FILE1
, 
PROC_FILE1_PERMS
, 
g¥ocdú
,

327 &
f›s_rdwr_dbg_Àvñ
)) {

328 
	`¥_w¨n
("proc_create [1] failed,áborting...\n");

329 
°©
 = -
ENOMEM
;

330 
out_Áû_1
;

332 
	`¥_debug
("¥o¯fûê1 (/¥oc/%s/%sË¸óãd\n", 
OURMODNAME
, 
PROC_FILE1
);

344 i‡(!
	`¥oc_¸óã_sögÀ_d©a
(
PROC_FILE2
, 
PROC_FILE2_PERMS
,

345 
g¥ocdú
, 
¥oc_show_pgoff
, 0)) {

346 
	`¥_w¨n
("proc_create [2] failed,áborting...\n");

347 
°©
 = -
ENOMEM
;

348 
out_Áû_2
;

350 
	`¥_debug
("¥o¯fûê2 (/¥oc/%s/%sË¸óãd\n", 
OURMODNAME
, 
PROC_FILE2
);

358 
gdrv˘x
 = 
	`Æloc_öô_drv˘x
();

359 i‡(
	`IS_ERR
(
gdrv˘x
)) {

360 
	`¥_w¨n
("drv ctxálloc failed,áborting...\n");

361 
°©
 = 
	`PTR_ERR
(
gdrv˘x
);

362 
out_Áû_2
;

364 i‡(!
	`¥oc_¸óã
(
PROC_FILE3
, 
PROC_FILE3_PERMS
, 
g¥ocdú
,

365 &
f›s_show_drv˘x
)) {

366 
	`¥_w¨n
("proc_create [3] failed,áborting...\n");

367 
°©
 = -
ENOMEM
;

368 
out_Áû_3
;

370 
	`¥_debug
("¥o¯fûê3 (/¥oc/%s/%sË¸óãd\n", 
OURMODNAME
, 
PROC_FILE3
);

376 i‡(!
	`¥oc_¸óã
(
PROC_FILE4
, 
PROC_FILE4_PERMS
, 
g¥ocdú
, &
f›s_rdwr_c⁄fig1
)) {

377 
	`¥_w¨n
("proc_create [4] failed,áborting...\n");

378 
°©
 = -
ENOMEM
;

379 
out_Áû_3
;

381 
	`¥_debug
("¥o¯fûê4 (/¥oc/%s/%sË¸óãd\n", 
OURMODNAME
, 
PROC_FILE4
);

383 
	`¥_öfo
("initialized\n");

386 
out_Áû_3
:

387 
	`kz‰ì
(
gdrv˘x
);

388 
out_Áû_2
:

389 
	`ªmove_¥oc_subåì
(
OURMODNAME
, 
NULL
);

390 
out_Áû_1
:

391  
°©
;

392 
	}
}

394 
__exô
 
	$¥ocfs_sim∂e_ötf_˛ónup
()

396 
gdrv˘x
->
powî
 = 0;

397 
	`ªmove_¥oc_subåì
(
OURMODNAME
, 
NULL
);

398 
	`kz‰ì
(
gdrv˘x
);

399 
	`¥_öfo
("removed\n");

400 
	}
}

402 
moduÀ_öô
(
¥ocfs_sim∂e_ötf_öô
);

403 
moduÀ_exô
(
¥ocfs_sim∂e_ötf_˛ónup
);

	@Books/Linux-Kernel-Programming-Part-2/ch2/sysfs_simple_intf/sysfs_simple_intf.c

49 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

51 
	~<löux/öô.h
>

52 
	~<löux/moduÀ.h
>

53 
	~<löux/kî√l.h
>

54 
	~<löux/fs.h
>

55 
	~<löux/∂©f‹m_devi˚.h
>

56 
	~<löux/muãx.h
>

59 
	~<löux/vîsi⁄.h
>

60 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

61 
	~<löux/uac˚ss.h
>

63 
	~<asm/uac˚ss.h
>

66 
MODULE_AUTHOR
("Kaiwan N Billimoria");

67 
MODULE_DESCRIPTION
("LKP-2 book:ch2/sysfs_simple_intf: simple sysfs interfacing demo");

74 
MODULE_LICENSE
("Dual MIT/GPL");

75 
MODULE_VERSION
("0.1");

77 
	#OURMODNAME
 "sysfs_sim∂e_ötf"

	)

78 
	#SYSFS_FILE1
 
Œkdsysfs_debug_Àvñ


	)

79 
	#SYSFS_FILE2
 
Œkdsysfs_pgoff


	)

80 
	#SYSFS_FILE3
 
Œkdsysfs_¥essuª


	)

83 
DEFINE_MUTEX
(
mtx
);

85 
	gdebug_Àvñ
;

86 
u32
 
	gg¥essuª
;

88 
∂©f‹m_devi˚
 *
	gsysfs_demo_∂©dev
;

107 
ssize_t
 
	$Œkdsysfs_¥essuª_show
(
devi˚
 *
dev
,

108 
devi˚_©åibuã
 *
©å
, *
buf
)

110 
n
;

112 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

113  -
ERESTARTSYS
;

114 
	`¥_debug
("I¿thê'show' mëhod:Öªssuª=%u\n", 
g¥essuª
);

115 
n
 = 
	`¢¥ötf
(
buf
, 25, "%u", 
g¥essuª
);

116 
	`muãx_u∆ock
(&
mtx
);

117  
n
;

118 
	}
}

124 
DEVICE_ATTR_RO
(
Œkdsysfs_¥essuª
);

128 
ssize_t
 
	$Œkdsysfs_pgoff_show
(
devi˚
 *
dev
,

129 
devi˚_©åibuã
 *
©å
, *
buf
)

131 
n
;

133 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

134  -
ERESTARTSYS
;

135 
	`¥_debug
("I¿thê'show' mëhod: PAGE_OFFSET=0x%px\n", (*)
PAGE_OFFSET
);

136 
n
 = 
	`¢¥ötf
(
buf
, 25, "0x%px", (*)
PAGE_OFFSET
);

137 
	`muãx_u∆ock
(&
mtx
);

138  
n
;

139 
	}
}

145 
DEVICE_ATTR_RO
(
Œkdsysfs_pgoff
);

148 
	#DEBUG_LEVEL_MIN
 0

	)

149 
	#DEBUG_LEVEL_MAX
 2

	)

152 
ssize_t
 
	$Œkdsysfs_debug_Àvñ_show
(
devi˚
 *
dev
,

153 
devi˚_©åibuã
 *
©å
,

154 *
buf
)

156 
n
;

158 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

159  -
ERESTARTSYS
;

160 
	`¥_debug
("I¿thê'show' mëhod:Çame: %s, debug_Àvñ=%d\n", 
dev
->
kobj
.
«me
,

161 
debug_Àvñ
);

162 
n
 = 
	`¢¥ötf
(
buf
, 25, "%d\n", 
debug_Àvñ
);

163 
	`muãx_u∆ock
(&
mtx
);

164  
n
;

165 
	}
}

168 
ssize_t
 
	$Œkdsysfs_debug_Àvñ_°‹e
(
devi˚
 *
dev
,

169 
devi˚_©åibuã
 *
©å
,

170 c⁄° *
buf
, 
size_t
 
cou¡
)

172 
ªt
 = ()
cou¡
, 
¥ev_dbgÀvñ
;

174 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx
))

175  -
ERESTARTSYS
;

177 
¥ev_dbgÀvñ
 = 
debug_Àvñ
;

178 
	`¥_debug
("InÅhe 'store' method:\ncount=%zu, buf=0x%px count=%zu\n"

179 "Buf„∏c⁄ã¡s: \"%.*s\"\n", 
cou¡
, 
buf
, count, ()count, buf);

180 i‡(
cou¡
 == 0 || count > 12) {

181 
ªt
 = -
EINVAL
;

182 
out
;

185 
ªt
 = 
	`k°πoöt
(
buf
, 0, &
debug_Àvñ
);

186 i‡(
ªt
)

187 
out
;

188 i‡(
debug_Àvñ
 < 
DEBUG_LEVEL_MIN
 || debug_Àvñ > 
DEBUG_LEVEL_MAX
) {

189 
	`¥_öfo
("tryingÅo set invalid value (%d) for debug_level\n"

191 
debug_Àvñ
, 
DEBUG_LEVEL_MIN
, 
DEBUG_LEVEL_MAX
, 
¥ev_dbgÀvñ
);

192 
debug_Àvñ
 = 
¥ev_dbgÀvñ
;

193 
ªt
 = -
EFAULT
;

194 
out
;

197 
ªt
 = 
cou¡
;

198 
out
:

199 
	`muãx_u∆ock
(&
mtx
);

200  
ªt
;

201 
	}
}

208 
DEVICE_ATTR_RW
(
SYSFS_FILE1
);

227 
__öô
 
	$sysfs_sim∂e_ötf_öô
()

229 
°©
 = 0;

231 i‡(
	`u∆ikñy
(!
	`IS_ENABLED
(
CONFIG_SYSFS
))) {

232 
	`¥_w¨n
("sysfs unsupported! Aborting ...\n");

233  -
EINVAL
;

243 
	#PLAT_NAME
 "Œkd_sysfs_sim∂e_ötf_devi˚"

	)

244 
sysfs_demo_∂©dev
 = 
	`∂©f‹m_devi˚_ªgi°î_sim∂e
(
PLAT_NAME
, -1, 
NULL
, 0);

245 i‡(
	`IS_ERR
(
sysfs_demo_∂©dev
)) {

246 
°©
 = 
	`PTR_ERR
(
sysfs_demo_∂©dev
);

247 
	`¥_öfo
("îr‹ (%dËªgi°îög ou∏∂©f‹m devi˚,áb‹tög\n", 
°©
);

248 
out1
;

260 
°©
 = 
	`devi˚_¸óã_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_SYSFS_FILE1
);

274 i‡(
°©
) {

275 
	`¥_öfo
("devi˚_¸óã_fûê[1] faûed (%d),áb‹tögÇow\n", 
°©
);

276 
out2
;

278 
	`¥_debug
("sysfs file [1] (/sys/devices/platform/%s/%s) created\n",

279 
PLAT_NAME
, 
	`__°rögify
(
SYSFS_FILE1
));

282 
°©
 = 
	`devi˚_¸óã_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_Œkdsysfs_pgoff
);

289 i‡(
°©
) {

290 
	`¥_öfo
("devi˚_¸óã_fûê[2] faûed (%d),áb‹tögÇow\n", 
°©
);

291 
out3
;

293 
	`¥_debug
("sysfs file [2] (/sys/devices/platform/%s/%s) created\n",

294 
PLAT_NAME
, 
	`__°rögify
(
SYSFS_FILE2
));

297 
g¥essuª
 = 25;

298 
°©
 = 
	`devi˚_¸óã_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_Œkdsysfs_¥essuª
);

305 i‡(
°©
) {

306 
	`¥_öfo
("devi˚_¸óã_fûê[3] faûed (%d),áb‹tögÇow\n", 
°©
);

307 
out4
;

309 
	`¥_debug
("sysfs file [3] (/sys/devices/platform/%s/%s) created\n",

310 
PLAT_NAME
, 
	`__°rögify
(
SYSFS_FILE3
));

312 
	`¥_öfo
("initialized\n");

314 
out4
:

315 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_Œkdsysfs_pgoff
);

316 
out3
:

317 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_SYSFS_FILE1
);

318 
out2
:

319 
	`∂©f‹m_devi˚_uƒegi°î
(
sysfs_demo_∂©dev
);

320 
out1
:

321  
°©
;

322 
	}
}

324 
__exô
 
	$sysfs_sim∂e_ötf_˛ónup
()

327 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_Œkdsysfs_¥essuª
);

328 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_Œkdsysfs_pgoff
);

329 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_SYSFS_FILE1
);

332 
	`∂©f‹m_devi˚_uƒegi°î
(
sysfs_demo_∂©dev
);

333 
	`¥_öfo
("removed\n");

334 
	}
}

336 
moduÀ_öô
(
sysfs_sim∂e_ötf_öô
);

337 
moduÀ_exô
(
sysfs_sim∂e_ötf_˛ónup
);

	@Books/Linux-Kernel-Programming-Part-2/ch5/delays_sleeps/delays_sleeps.c

21 
	~<löux/öô.h
>

22 
	~<löux/moduÀ.h
>

23 
	~<löux/kî√l.h
>

24 
	~<löux/dñay.h
>

25 
	~<löux/ktime.h
>

27 
	#OURMODNAME
 "dñays_¶ìps"

	)

29 
MODULE_AUTHOR
("Kaiwan N Billimoria");

30 
MODULE_DESCRIPTION
("a simple LKMÅo demo delaysánd sleeps inÅhe kernel");

31 
MODULE_LICENSE
("Dual MIT/GPL");

32 
MODULE_VERSION
("0.1");

41 
	#DILLY_DALLY
(
code_°r
, 
run_this
) do { \

42 
u64
 
t1
, 
t2
; \

43 
t1
 = 
	`ktime_gë_ªÆ_ns
(); \

44 
run_this
; \

45 
t2
 = 
	`ktime_gë_ªÆ_ns
(); \

46 
	`¥_öfo
(
code_°r
 "->áctual: %11lluÇs = %7llu us = %4llu ms\n", \

47 (
t2
-
t1
), (t2-t1)/1000, (t2-t1)/1000000);\

48 } 0)

	)

50 
__öô
 
	$dñays_¶ìps_öô
()

52 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

55 
	`¥_öfo
("\n1. *delay() functions (atomic, iná delayÜoop):\n");

56 
	`DILLY_DALLY
("ndñay(Ëf‹ 10Çs", 
	`ndñay
(10));

58 
	`DILLY_DALLY
("udñay(Ëf‹ 10,000Çs", 
	`udñay
(10));

59 
	`DILLY_DALLY
("mdñay(Ëf‹ 10,000,000Çs", 
	`mdñay
(10));

62 
	`¥_öfo
("\n2. *sleep() functions (process ctx, sleeps/schedule()'s out):\n");

64 
	`DILLY_DALLY
("u¶ìp_ønge(10,10Ëf‹ 10,000Çs", 
	`u¶ìp_ønge
(10, 10));

66 
	`DILLY_DALLY
("m¶ìp(10Ëf‹ 10,000,000Çs", 
	`m¶ìp
(10));

67 
	`DILLY_DALLY
("m¶ìp_öãºu±ibÀ(10Ë ", 
	`m¶ìp_öãºu±ibÀ
(10));

69 
	`DILLY_DALLY
("s¶ìp(1Ë ", 
	`s¶ìp
(1));

72 
	}
}

74 
__exô
 
	$dñays_¶ìps_exô
()

76 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

77 
	}
}

79 
moduÀ_öô
(
dñays_¶ìps_öô
);

80 
moduÀ_exô
(
dñays_¶ìps_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch5/kthread_simple/kthread_simple.c

18 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/sched.h
>

23 
	~<löux/sched/èsk.h
>

24 
	~<löux/sched/sig«l.h
>

25 
	~<löux/sig«l.h
>

26 
	~<löux/kthªad.h
>

27 
	~<asm/©omic.h
>

28 
	~"../../c⁄víõ¡.h
"

30 
	#OURMODNAME
 "kthªad_sim∂e"

	)

31 
	#KTHREAD_NAME
 "kt_sim∂e"

	)

33 
MODULE_AUTHOR
("Kaiwan N Billimoria");

34 
MODULE_DESCRIPTION
("a simple LKMÅo demo delaysánd sleeps inÅhe kernel");

35 
MODULE_LICENSE
("Dual MIT/GPL");

36 
MODULE_VERSION
("0.1");

38 
èsk_°ru˘
 *
	ggkthrd_ts
;

41 
	$sim∂e_kthªad
(*
¨g
)

43 
	`PRINT_CTX
();

44 i‡(!
cuºít
->
mm
)

45 
	`¥_öfo
("mm field NULL, weáreá kernelÅhread!\n");

51 
	`Ælow_sig«l
(
SIGINT
);

52 
	`Ælow_sig«l
(
SIGQUIT
);

54 !
	`kthªad_should_°›
()) {

55 
	`¥_öfo
("FYI, I, kernelÅhread PID %d,ám goingÅo sleepÇow...\n",

56 
cuºít
->
pid
);

57 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

58 
	`scheduÀ
();

62 i‡(
	`sig«l_≥ndög
(
cuºít
))

67 
	`£t_cuºít_°©e
(
TASK_RUNNING
);

68 
	`¥_öfo
("FYI, I, kernelÅhread PID %d, have beenÑudelyáwoken; I shall"

69 "ÇowÉxô... Good day Sú!\n", 
cuºít
->
pid
);

72 
	}
}

74 
	$kthªad_sim∂e_öô
()

76 
ªt
=0;

78 
	`¥_öfo
("LetsÇow createá kernelÅhread...\n");

86 
gkthrd_ts
 = 
	`kthªad_run
(
sim∂e_kthªad
, 
NULL
, "Œkd/%s", 
KTHREAD_NAME
);

87 i‡(
	`IS_ERR
(
gkthrd_ts
)) {

88 
ªt
 = 
	`PTR_ERR
(
gkthrd_ts
);

89 
	`¥_îr
("kthªad cª©i⁄ faûed (%d)\n", 
ªt
);

90  
ªt
;

92 
	`gë_èsk_°ru˘
(
gkthrd_ts
);

97 
	`¥_öfo
("Initialized, kernelÅhreadÅaskÖtr is 0x%pK (actual=0x%px)\n"

99 
gkthrd_ts
, gkthrd_ts, 
KTHREAD_NAME
);

102 
	}
}

104 
	$kthªad_sim∂e_exô
()

106 
	`kthªad_°›
(
gkthrd_ts
);

111 
	`¥_öfo
("kthread stopped,ánd LKMÑemoved.\n");

112 
	}
}

114 
moduÀ_öô
(
kthªad_sim∂e_öô
);

115 
moduÀ_exô
(
kthªad_sim∂e_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch5/sed1/sed1_driver/sed1_drv.c

39 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

41 
	~<löux/öô.h
>

42 
	~<löux/kî√l.h
>

43 
	~<löux/moduÀ.h
>

44 
	~<löux/sched.h
>

45 
	~<löux/fs.h
>

46 
	~<löux/¶ab.h
>

47 
	~<löux/devi˚.h
>

48 
	~<löux/miscdevi˚.h
>

49 
	~<löux/timî.h
>

50 
	~<löux/dñay.h
>

51 
	~<asm/©omic.h
>

54 
	~<löux/vîsi⁄.h
>

55 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

56 
	~<löux/uac˚ss.h
>

58 
	~<asm/uac˚ss.h
>

61 
	~"../£d_comm⁄.h
"

62 
	~"../../../c⁄víõ¡.h
"

64 
	#DRVNAME
 "£d1_drv"

	)

65 
	#TIMER_EXPIRE_MS
 1

	)

67 
	gMODULE_DESCRIPTION


69 
MODULE_AUTHOR
("Kaiwan N Billimoria");

70 
MODULE_LICENSE
("Dual MIT/GPL");

71 
MODULE_VERSION
("0.1");

74 
	gmake_ô_Áû
;

75 
moduÀ_∑øm
(
make_ô_Áû
, , 0660);

76 
MODULE_PARM_DESC
(
make_ô_Áû
,

83 
	s°MyCtx
 {

84 
devi˚
 *
	mdev
;

85 
	mÁke
;

86 
©omic_t
 
	mtimed_out
;

87 
timî_li°
 
	mtimr
;

89 
°MyCtx
 *
	gg¥iv
;

91 
	$timesup
(
timî_li°
 *
timî
)

93 
°MyCtx
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
timr
);

95 
	`©omic_£t
(&
¥iv
->
timed_out
, 1);

96 
	`¥_nŸi˚
("*** TimerÉxpired! ***\n");

97 
	`PRINT_CTX
();

98 
	}
}

100 
	#WORK_IS_ENCRYPT
 1

	)

101 
	#WORK_IS_DECRYPT
 2

	)

102 
	#CRYPT_OFFSET
 63

	)

114 
	$í¸y±_de¸y±_∑ylﬂd
(
w‹k
, 
£d_ds
 *
kd
, £d_d†*
kdªt
)

116 
i
;

117 
ktime_t
 
t1
, 
t2
;

118 
°MyCtx
 *
¥iv
 = 
g¥iv
;

120 
	`¥_debug
("startingÅimer +ÖrocessingÇow ...\n");

124 
	`mod_timî
(&
¥iv
->
timr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
TIMER_EXPIRE_MS
));

126 
t1
 = 
	`ktime_gë_ªÆ_ns
();

129 
	`mem˝y
(
kdªt
, 
kd
, (
£d_ds
));

130 i‡(
w‹k
 =
WORK_IS_ENCRYPT
) {

131 
i
 = 0; i < 
kd
->
Àn
; i++) {

132 
kdªt
->
d©a
[
i
] ^
CRYPT_OFFSET
;

133 
kdªt
->
d©a
[
i
] +
CRYPT_OFFSET
;

135 } i‡(
w‹k
 =
WORK_IS_DECRYPT
) {

136 
i
 = 0; i < 
kd
->
Àn
; i++) {

137 
kdªt
->
d©a
[
i
] -
CRYPT_OFFSET
;

138 
kdªt
->
d©a
[
i
] ^
CRYPT_OFFSET
;

141 
kdªt
->
Àn
 = 
kd
->len;

144 i‡(
make_ô_Áû
 == 1) {

147 
	`m¶ìp
(
TIMER_EXPIRE_MS
 + 1);

149 
	`mdñay
(
TIMER_EXPIRE_MS
 + 10);

152 
t2
 = 
	`ktime_gë_ªÆ_ns
();

155 i‡(
	`dñ_timî
(&
¥iv
->
timr
) == 0)

156 
	`¥_debug
("cancelledÅheÅimer while it's inactive! (deadline missed?)\n");

158 
	`¥_debug
("processing complete,Åimeout cancelled\n");

160 
	`SHOW_DELTA
(
t2
, 
t1
);

161 
	}
}

166 
	$¥o˚ss_ô
(
£d_ds
 *
kd
, £d_d†*
kdªt
)

169 
kd
->
d©a_xf‹m
) {

170 
XF_NONE
:

171 
	`¥_debug
("dataÅransformÅype: XF_NONE\n");

174 
XF_ENCRYPT
:

175 
	`¥_debug
("dataÅransformÅype: XF_ENCRYPT\n");

176 
	`í¸y±_de¸y±_∑ylﬂd
(
WORK_IS_ENCRYPT
, 
kd
, 
kdªt
);

178 
XF_DECRYPT
:

179 
	`¥_debug
("dataÅransformÅype: XF_DECRYPT\n");

180 
	`í¸y±_de¸y±_∑ylﬂd
(
WORK_IS_DECRYPT
, 
kd
, 
kdªt
);

183 
	}
}

197 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2, 6, 36)

198 
	$io˘l_miscdrv
(
fûe
 *
fûp
, 
cmd
, 
¨g
)

200 
	$io˘l_miscdrv
(
öode
 *
öo
, 
fûe
 *
fûp
, 
cmd
,

201 
¨g
)

204 
ªt
 = 0;

205 
£d_ds
 *
kd
, *
kdªt
;

206 
°MyCtx
 *
¥iv
 = 
g¥iv
;

213 i‡(
	`_IOC_TYPE
(
cmd
Ë!
IOCTL_LLKD_SED_MAGIC
) {

214 
	`¥_w¨n
("ioctl fail; magic # mismatch\n");

215  -
ENOTTY
;

217 i‡(
	`_IOC_NR
(
cmd
Ë> 
IOCTL_LLKD_SED_MAXIOCTL
) {

218 
	`¥_w¨n
("ioctl fail; invalid cmd?\n");

219  -
ENOTTY
;

222 
ªt
 = -
ENOMEM
;

223 
kd
 = 
	`kzÆloc
((
£d_ds
), 
GFP_KERNEL
);

224 i‡(!
kd
)

225 
out_mem1
;

226 
kdªt
 = 
	`kzÆloc
((
£d_ds
), 
GFP_KERNEL
);

227 i‡(!
kdªt
)

228 
out_mem2
;

230 
cmd
) {

231 
IOCTL_LLKD_SED_IOC_ENCRYPT_MSG
:

232 
IOCTL_LLKD_SED_IOC_DECRYPT_MSG
:

233 
	`¥_debug
("In ioctl cmd option: %s\narg=0x%lx\n",

234 (
cmd
 =
IOCTL_LLKD_SED_IOC_ENCRYPT_MSG
 ? "í¸y±" : "de¸y±"), 
¨g
);

236 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

237  -
EPERM
;

239 
ªt
 = -
EFAULT
;

240 i‡(
	`c›y_‰om_u£r
(
kd
, (
£d_ds
 *)
¨g
, (sed_ds))) {

241 
	`¥_w¨n
("copy_from_user() failed\n");

242 
out_c·u
;

244 
	`¥_debug
("xf‹m=%d,Üí=%d\n", 
kd
->
d©a_xf‹m
, kd->
Àn
);

245 
	`¥öt_hex_dump_byãs
("∑ylﬂd: ", 
DUMP_PREFIX_OFFSET
, 
kd
->
d©a
, kd->
Àn
);

246 
	`¥o˚ss_ô
(
kd
, 
kdªt
);

247 i‡(
	`©omic_ªad
(&
¥iv
->
timed_out
) == 1) {

248 
kdªt
->
timed_out
 = 1;

249 
	`¥_debug
("**Åimed out **\n");

251 
	`¥öt_hex_dump_byãs
("ªà∑ylﬂd: ", 
DUMP_PREFIX_OFFSET
, 
kdªt
->
d©a
,

252 
kdªt
->
Àn
);

255 
ªt
 = -
EFAULT
;

256 i‡(
	`c›y_to_u£r
((
£d_ds
 *)
¨g
, (£d_d†*)
kdªt
, (sed_ds))) {

257 
	`¥_w¨n
("copy_to_user() failed\n");

258 
out_c·u
;

262 
	`k‰ì
(
kdªt
);

263 
	`k‰ì
(
kd
);

264  -
ENOTTY
;

267 
ªt
 = 0;

268 
out_c·u
:

269 
	`k‰ì
(
kdªt
);

270 
out_mem2
:

271 
	`k‰ì
(
kd
);

272 
out_mem1
:

273  
ªt
;

274 
	}
}

279 
	$›í_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

281 
	`PRINT_CTX
();

282 
	`¥_öfo
("›íög \"%s\"Çow\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
);

284  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

285 
	}
}

287 
ssize_t
 
	$ªad_miscdrv
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
off
)

289 
	`¥_öfo
("tÿªad %zd byãs\n", 
cou¡
);

290  
cou¡
;

291 
	}
}

293 
ssize_t
 
	$wrôe_miscdrv
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

294 
size_t
 
cou¡
, 
loff_t
 *
off
)

296 
	`¥_öfo
("tÿwrôê%zd byãs\n", 
cou¡
);

297  
cou¡
;

298 
	}
}

300 
	$˛o£_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

302 
	`¥_öfo
("˛osög \"%s\"\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
);

304 
	}
}

310 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

311 .
›í
 = 
›í_miscdrv
,

312 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2, 6, 36)

313 .
	gu∆ocked_io˘l
 = 
io˘l_miscdrv
,

315 .
	gio˘l
 = 
io˘l_miscdrv
,

317 .
	gªad
 = 
ªad_miscdrv
,

318 .
	gwrôe
 = 
wrôe_miscdrv
,

319 .
	gŒ£ek
 = 
no_Œ£ek
,

320 .
	gªÀa£
 = 
˛o£_miscdrv
,

323 
miscdevi˚
 
	gŒkd_miscdev
 = {

324 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

325 .
	g«me
 = 
DRVNAME
,

328 .
	gmode
 = 0666,

329 .
	gf›s
 = &
Œkd_misc_f›s
,

332 
__öô
 
	$£d1_drv_öô
()

334 
ªt
 = 0;

335 
devi˚
 *
dev
;

336 
°MyCtx
 *
¥iv
 = 
NULL
;

339 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

340 i‡(
ªt
) {

341 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

342  
ªt
;

344 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

346 
	`dev_öfo
(
dev
, "LLKD %s misc driver (major # 10)Ñegistered, minor# = %d,\n"

347 "devÇodêi†/dev/%s\n", 
DRVNAME
, 
Œkd_miscdev
.
mö‹
, DRVNAME);

360 
g¥iv
 = 
¥iv
 = 
	`devm_kzÆloc
(
dev
, (
°MyCtx
), 
GFP_KERNEL
);

361 i‡(!
¥iv
)

362  -
ENOMEM
;

363 
¥iv
->
dev
 = 
Œkd_miscdev
.
this_devi˚
;

364 
	`©omic_£t
(&
¥iv
->
timed_out
, 0);

367 
	`timî_£tup
(&
¥iv
->
timr
, 
timesup
, 0);

369 
	`¥_öfo
("öô d⁄ê(make_ô_Áû i†%s)\n", 
make_ô_Áû
 == 1 ? "*on*" : "off");

370 
	`dev_dbg
(
dev
, "loaded.\n");

371  
ªt
;

372 
	}
}

374 
__exô
 
	$£d1_drv_exô
()

376 
°MyCtx
 *
¥iv
 = 
g¥iv
;

378 
	`dev_dbg
(
¥iv
->
dev
, "unloading\n");

379 
	`dñ_timî_sync
(&
¥iv
->
timr
);

380 
	`misc_dîegi°î
(&
Œkd_miscdev
);

381 
	}
}

383 
moduÀ_öô
(
£d1_drv_öô
);

384 
moduÀ_exô
(
£d1_drv_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch5/sed1/sed_common.h

16 #i‚de‡
__LLKD_SED_COMMON_H__


17 
	~"../../c⁄víõ¡.h
"

25 
	#IOCTL_LLKD_SED_MAGIC
 0xA9

	)

26 
	#IOCTL_LLKD_SED_MAXIOCTL
 2

	)

35 
	#IOCTL_LLKD_SED_IOC_ENCRYPT_MSG
 
	`_IOR
(
IOCTL_LLKD_SED_MAGIC
, 1, )

	)

38 
	#IOCTL_LLKD_SED_IOC_DECRYPT_MSG
 
	`_IOR
(
IOCTL_LLKD_SED_MAGIC
, 2, )

	)

41 
	#MAX_DATA
 512

	)

43 
	tu8
;

44 
	s£d_ds
 {

45 
	md©a_xf‹m
;

46 
	mÀn
;

47 
	mtimed_out
;

48 
	md©a
[
MAX_DATA
];

51 
	exf‹m
 { 
	mXF_NONE
, 
	mXF_DECRYPT
, 
	mXF_ENCRYPT
 };

53 
	#SHOW_TIME
() do { \

54 
	`¥_debug
("%ŒdÇs", 
	`ktime_gë_ªÆ_ns
()); \

55 } 0)

	)

	@Books/Linux-Kernel-Programming-Part-2/ch5/sed1/userapp_sed/userapp_sed1.c

4 
	~<°dio.h
>

5 
	~<uni°d.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

9 
	~<sig«l.h
>

10 
	~<°dlib.h
>

11 
	~<sys/io˘l.h
>

12 
	~<°rög.h
>

13 
	~"../£d_comm⁄.h
"

21 
	$de¸y±_msg
(
fd
, *
msg
, *
¥g
)

23 
£d_ds
 *
kd
;

26 
kd
 = 
	`ˇŒoc
((
£d_ds
), 1);

27 i‡(!
kd
) {

28 
	`Ârötf
(
°dîr
, "%s: cÆloc(Ëkd faûed!\n", 
¥g
);

29 
	`exô
(
EXIT_FAILURE
);

32 
kd
->
d©a_xf‹m
 = 
XF_DECRYPT
;

33 
kd
->
Àn
 = 
	`°æí
(
msg
);

34 
	`mem˝y
(
kd
->
d©a
, 
msg
, 
	`°æí
(msg));

39 
	`¥ötf
("msg bef‹êde¸y±: %s\n", 
msg
);

40 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_SED_IOC_DECRYPT_MSG
, 
kd
) == -1) {

41 
	`≥º‹
("ioctl IOCTL_LLKD_SED_IOC_DECRYPT_MSG failed");

42 
	`‰ì
(
kd
);

43 
	`˛o£
(
fd
);

44 
	`exô
(
EXIT_FAILURE
);

46 i‡(
kd
->
timed_out
 == 1) {

47 
	`Ârötf
(
°dîr
, "*** Operation Timed Out ***\n");

48 
	`mem£t
(
kd
, 0, (
£d_ds
));

49 
	`exô
(
EXIT_FAILURE
);

52 
	`¥ötf
("io˘»IOCTL_LLKD_SED_IOC_DECRYPT_MSG d⁄e;Üí=%d\n", 
kd
->
Àn
);

55 
i
;

56 
i
 = 0; i < 
kd
->
Àn
; i++)

57 
	`¥ötf
("kd->d©a[%d] = %¯(0x%x)\n", 
i
, 
kd
->
d©a
[i],

58 
kd
->
d©a
[
i
] & 0xff);

61 
	`mem˝y
(
msg
, 
kd
->
d©a
, kd->
Àn
);

62 
	`‰ì
(
kd
);

63 
	}
}

71 
	$í¸y±_msg
(
fd
, *
msg
, *
¥g
)

73 
£d_ds
 *
kd
;

75 
kd
 = 
	`ˇŒoc
((
£d_ds
), 1);

76 i‡(!
kd
) {

77 
	`Ârötf
(
°dîr
, "%s: cÆloc(Ëkd faûed!\n", 
¥g
);

78 
	`exô
(
EXIT_FAILURE
);

81 
kd
->
d©a_xf‹m
 = 
XF_ENCRYPT
;

82 
kd
->
Àn
 = 
	`°æí
(
msg
);

83 
	`mem˝y
(
kd
->
d©a
, 
msg
, 
	`°æí
(msg));

88 
	`¥ötf
("msg bef‹êí¸y±: %s\n", 
msg
);

89 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_SED_IOC_ENCRYPT_MSG
, 
kd
) == -1) {

90 
	`≥º‹
("ioctl IOCTL_LLKD_SED_IOC_ENCRYPT_MSG failed");

91 
	`‰ì
(
kd
);

92 
	`˛o£
(
fd
);

93 
	`exô
(
EXIT_FAILURE
);

95 i‡(
kd
->
timed_out
 == 1) {

96 
	`Ârötf
(
°dîr
, "*** Operation Timed Out ***\n");

97 
	`mem£t
(
kd
, 0, (
£d_ds
));

98 
	`exô
(
EXIT_FAILURE
);

101 
	`¥ötf
("io˘»IOCTL_LLKD_SED_IOC_ENCRYPT_MSG d⁄e;Üí=%d\n", 
kd
->
Àn
);

104 
i
;

105 
i
 = 0; i < 
kd
->
Àn
; i++)

106 
	`¥ötf
("kd->d©a[%d] = %¯(0x%x)\n", 
i
, 
kd
->
d©a
[i],

107 
kd
->
d©a
[
i
] & 0xff);

111 
	`mem˝y
(
msg
, 
kd
->
d©a
, kd->
Àn
);

112 
	`‰ì
(
kd
);

113 
	}
}

115 
	$maö
(
¨gc
, **
¨gv
)

117 
fd
;

118 
buf
[
MAX_DATA
];

120 i‡(
¨gc
 < 3) {

121 
	`Ârötf
(
°dîr
, "Ußge: %†devi˚_fûêmesßge\n", 
¨gv
[0]);

122 
	`exô
(
EXIT_FAILURE
);

124 i‡(
	`°æí
(
¨gv
[2]Ë<0 || såÀn◊rgv[2]Ë> 
MAX_DATA
) {

125 
	`Ârötf
(
°dîr
, "%s: invÆid mesßge\n", 
¨gv
[0]);

126 
	`exô
(
EXIT_FAILURE
);

128 
	`mem˝y
(
buf
, 
¨gv
[2], 
MAX_DATA
);

130 
fd
 = 
	`›í
(
¨gv
[1], 
O_RDWR
, 0);

131 i‡(
fd
 == -1) {

132 
	`≥º‹
("open");

133 
	`exô
(
EXIT_FAILURE
);

135 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

137 
	`í¸y±_msg
(
fd
, 
buf
, 
¨gv
[0]);

138 
	`¥ötf
("msgá·îÉn¸y±: %s\n\n", 
buf
);

139 
	`¶ìp
(1);

140 
	`de¸y±_msg
(
fd
, 
buf
, 
¨gv
[0]);

141 
	`¥ötf
("msgá·î de¸y±: %s\n", 
buf
);

143 
	`˛o£
(
fd
);

144 
	`exô
(
EXIT_SUCCESS
);

145 
	}
}

	@Books/Linux-Kernel-Programming-Part-2/ch5/sed2/sed2_driver/sed2_drv.c

72 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

74 
	~<löux/öô.h
>

75 
	~<löux/kî√l.h
>

76 
	~<löux/moduÀ.h
>

77 
	~<löux/sched.h
>

78 
	~<löux/fs.h
>

79 
	~<löux/¶ab.h
>

80 
	~<löux/devi˚.h
>

81 
	~<löux/miscdevi˚.h
>

82 
	~<löux/timî.h
>

83 
	~<löux/dñay.h
>

84 
	~<asm/©omic.h
>

85 
	~<löux/kthªad.h
>

86 
	~<löux/sched/èsk.h
>

87 
	~<löux/sched/sig«l.h
>

90 
	~<löux/vîsi⁄.h
>

91 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

92 
	~<löux/uac˚ss.h
>

94 
	~<asm/uac˚ss.h
>

97 
	~"../£d_comm⁄.h
"

98 
	~"../../../c⁄víõ¡.h
"

100 
	#DRVNAME
 "£d2_drv"

	)

101 
	#TIMER_EXPIRE_MS
 10

102 
	#KTHREAD_NAME
 "w‹kî"

	)

104 
MODULE_DESCRIPTION
(

106 
MODULE_AUTHOR
("Kaiwan N Billimoria");

107 
MODULE_LICENSE
("Dual MIT/GPL");

108 
MODULE_VERSION
("0.1");

111 
	gmake_ô_Áû
;

112 
moduÀ_∑øm
(
make_ô_Áû
, , 0660);

113 
MODULE_PARM_DESC
(
make_ô_Áû
,

122 
	s°MyCtx
 {

123 
devi˚
 *
	mdev
;

124 
©omic_t
 
	mmsg_°©e
;

125 
©omic_t
 
	mw‹k_d⁄e
;

126 
©omic_t
 
	mtimed_out
;

127 
timî_li°
 
	mtimr
;

128 
èsk_°ru˘
 *
	mkthrd_w‹k
;

129 
£d_ds
 *
	mkd©a
;

130 
ktime_t
 
	mt1
, 
	mt2
;

132 
°MyCtx
 *
	gg¥iv
;

134 
	$timesup
(
timî_li°
 *
timî
)

136 
°MyCtx
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
timr
);

138 
	`©omic_£t
(&
¥iv
->
timed_out
, 1);

139 
	`¥_nŸi˚
("*** TimerÉxpired! ***\n");

140 
	`PRINT_CTX
();

141 
	}
}

143 
	#WORK_IS_ENCRYPT
 1

	)

144 
	#WORK_IS_DECRYPT
 2

	)

145 
	#CRYPT_OFFSET
 0x3F

146 

	)

157 
	$í¸y±_de¸y±_∑ylﬂd
(
w‹k
, 
£d_ds
 *
kd
)

159 
i
;

161 
	`¥öt_hex_dump_byãs
("kd©a->shmem: ", 
DUMP_PREFIX_OFFSET
, 
kd
->
shmem
, kd->
Àn
);

165 i‡(
w‹k
 =
WORK_IS_ENCRYPT
) {

166 
i
 = 0; i < 
kd
->
Àn
; i++) {

167 
kd
->
shmem
[
i
] ^
CRYPT_OFFSET
;

168 
kd
->
shmem
[
i
] +
CRYPT_OFFSET
;

170 } i‡(
w‹k
 =
WORK_IS_DECRYPT
) {

171 
i
 = 0; i < 
kd
->
Àn
; i++) {

172 
kd
->
shmem
[
i
] -
CRYPT_OFFSET
;

173 
kd
->
shmem
[
i
] ^
CRYPT_OFFSET
;

176 
	}
}

181 
	$w‹kî_kthªad
(*
¨g
)

183 
°MyCtx
 *
¥iv
 = 
g¥iv
;

185 !
	`kthªad_should_°›
()) {

186 
	`¥_debug
("startingÅimer +ÖrocessingÇow ...\n");

188 i‡(
	`mod_timî
(&
¥iv
->
timr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
TIMER_EXPIRE_MS
)))

189 
	`¥_Æît
("timerálreadyáctive?\n");

191 
¥iv
->
t1
 = 
	`ktime_gë_ªÆ_ns
();

194 
	`¥_debug
("[%d] w‹kî kthªadÑódyÅÿexecuã w‹k!\n", 
	`èsk_pid_ƒ
(
cuºít
));

195 
	`PRINT_CTX
();

197 
	`©omic_£t
(&
¥iv
->
w‹k_d⁄e
, 0);

198 
¥iv
->
kd©a
->
d©a_xf‹m
) {

199 
XF_NONE
:

200 
	`¥_debug
("dataÅransformÅype: XF_NONE\n");

203 
XF_ENCRYPT
:

204 
	`¥_debug
("dataÅransformÅype: XF_ENCRYPT\n");

205 
	`í¸y±_de¸y±_∑ylﬂd
(
WORK_IS_ENCRYPT
, 
¥iv
->
kd©a
);

206 
	`©omic_£t
(&
¥iv
->
msg_°©e
, 
XF_ENCRYPT
);

208 
XF_DECRYPT
:

209 
	`¥_debug
("dataÅransformÅype: XF_DECRYPT\n");

210 
	`í¸y±_de¸y±_∑ylﬂd
(
WORK_IS_DECRYPT
, 
¥iv
->
kd©a
);

211 
	`©omic_£t
(&
¥iv
->
msg_°©e
, 
XF_DECRYPT
);

214 
	`¥_w¨n
("unknow¿å™sf‹mÖas£d (%d)\n", 
¥iv
->
kd©a
->
d©a_xf‹m
);

216 
	`©omic_£t
(&
¥iv
->
w‹k_d⁄e
, 1);

218 i‡(
make_ô_Áû
 == 1)

219 
	`m¶ìp
(
TIMER_EXPIRE_MS
 + 10);

222 
¥iv
->
t2
 = 
	`ktime_gë_ªÆ_ns
();

224 i‡(
	`dñ_timî
(&
¥iv
->
timr
) == 0)

225 
	`¥_öfo
("cancelledÅheÅimer while it's inactive! (deadline missed?)\n");

227 
	`¥_öfo
("processing complete,Åimeout cancelled\n");

228 
	`SHOW_DELTA
(
¥iv
->
t2
,Öriv->
t1
);

230 
	`¥_öfo
("[%d] FYI, work done, goingÅo sleepÇow...\n",

231 
	`èsk_pid_ƒ
(
cuºít
));

232 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

233 
	`scheduÀ
();

240 
	`£t_cuºít_°©e
(
TASK_RUNNING
);

244 
	}
}

251 
	#POLL_ON_WORK_DONE
(
¶ìp_ms
) do { \

252 
	`©omic_ªad
(&
¥iv
->
w‹k_d⁄e
) == 0) \

253 
	`m¶ìp_öãºu±ibÀ
(
¶ìp_ms
); \

254 } 0)

	)

268 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2, 6, 36)

269 
	$io˘l_miscdrv
(
fûe
 *
fûp
, 
cmd
, 
¨g
)

271 
	$io˘l_miscdrv
(
öode
 *
öo
, 
fûe
 *
fûp
, 
cmd
,

272 
¨g
)

275 
°MyCtx
 *
¥iv
 = 
g¥iv
;

278 i‡(
	`_IOC_TYPE
(
cmd
Ë!
IOCTL_LLKD_SED_MAGIC
) {

279 
	`¥_w¨n
("ioctl fail; magic # mismatch\n");

280  -
ENOTTY
;

282 i‡(
	`_IOC_NR
(
cmd
Ë> 
IOCTL_LLKD_SED_MAXIOCTL
) {

283 
	`¥_w¨n
("ioctl fail; invalid cmd?\n");

284  -
ENOTTY
;

287 
cmd
) {

288 
IOCTL_LLKD_SED_IOC_ENCRYPT_MSG
:

289 
	`¥_debug
("I¿io˘»'í¸y±' cmd o±i⁄;árg=0x%lx\n", 
¨g
);

293 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

294  -
EPERM
;

296 i‡(
	`©omic_ªad
(&
¥iv
->
msg_°©e
Ë=
XF_ENCRYPT
) {

297 
	`¥_nŸi˚
("encrypt op: message is currentlyÉncrypted;áborting op...\n");

298  -
EBADRQC
;

300 i‡(
	`c›y_‰om_u£r
(
¥iv
->
kd©a
, (
£d_ds
 *)
¨g
, (sed_ds))) {

301 
	`¥_w¨n
("copy_from_user() failed\n");

302  -
EFAULT
;

304 
	`¥_debug
("xf‹m=%d,Üí=%d\n", 
¥iv
->
kd©a
->
d©a_xf‹m
,Öriv->kd©a->
Àn
);

305 i‡(
¥iv
->
kd©a
->
Àn
 == 0) {

306 
	`¥_w¨n
("no dataÖassed (len is 0)\n");

307  -
EINVAL
;

309 
	`¥öt_hex_dump_byãs
("∑ylﬂd: ", 
DUMP_PREFIX_OFFSET
, 
¥iv
->
kd©a
->
shmem
,Öriv->kd©a->
Àn
);

311 
	`POLL_ON_WORK_DONE
(1);

313 i‡(!
	`wake_up_¥o˚ss
(
¥iv
->
kthrd_w‹k
))

314 
	`¥_w¨n
("worker kthreadálreadyÑunning whenáwoken?\n");

326 
IOCTL_LLKD_SED_IOC_DECRYPT_MSG
:

327 
	`¥_debug
("In ioctl 'decrypt' cmd option\n");

328 i‡(
	`©omic_ªad
(&
¥iv
->
msg_°©e
Ë=
XF_DECRYPT
) {

329 
	`¥_nŸi˚
("decrypt op: message is currently decrypted;áborting op...\n");

330  -
EBADRQC
;

332 
¥iv
->
kd©a
->
d©a_xf‹m
 = 
XF_DECRYPT
;

334 
	`POLL_ON_WORK_DONE
(1);

336 i‡(!
	`wake_up_¥o˚ss
(
¥iv
->
kthrd_w‹k
))

337 
	`¥_w¨n
("worker kthreadálreadyÑunning whenáwoken?\n");

340 
IOCTL_LLKD_SED_IOC_RETRIEVE_MSG
:

341 
	`¥_debug
("I¿io˘»'ªåõve' cmd o±i⁄;árg=0x%lx\n", 
¨g
);

342 i‡(
	`©omic_ªad
(&
¥iv
->
timed_out
) == 1) {

343 
	`¥_debug
("theÉncrypt op hadÅimed out!Ñetruning -ETIMEDOUT\n");

344  -
ETIMEDOUT
;

346 i‡(
	`c›y_to_u£r
((
£d_ds
 *)
¨g
, (£d_d†*)
¥iv
->
kd©a
, (sed_ds))) {

347 
	`¥_w¨n
("copy_to_user() failed\n");

348  -
EFAULT
;

351 
IOCTL_LLKD_SED_IOC_DESTROY_MSG
:

352 
	`¥_debug
("In ioctl 'destroy' cmd option\n");

353 
	`mem£t
(
¥iv
->
kd©a
, 0, (
£d_ds
));

354 
	`©omic_£t
(&
¥iv
->
msg_°©e
, 0);

355 
	`©omic_£t
(&
¥iv
->
w‹k_d⁄e
, 1);

356 
	`©omic_£t
(&
¥iv
->
timed_out
, 0);

357 
¥iv
->
t1
 =Öriv->
t2
 = 0;

360  -
ENOTTY
;

363 
	}
}

368 
	$›í_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

370 
	`PRINT_CTX
();

371 
	`¥_öfo
("›íög \"%s\"Çow\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
);

373  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

374 
	}
}

376 
ssize_t
 
	$ªad_miscdrv
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
off
)

378 
	`¥_öfo
("tÿªad %zd byãs\n", 
cou¡
);

379  
cou¡
;

380 
	}
}

382 
ssize_t
 
	$wrôe_miscdrv
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

383 
size_t
 
cou¡
, 
loff_t
 *
off
)

385 
	`¥_öfo
("tÿwrôê%zd byãs\n", 
cou¡
);

386  
cou¡
;

387 
	}
}

389 
	$˛o£_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

391 
	`¥_öfo
("˛osög \"%s\"\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
);

393 
	}
}

399 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

400 .
›í
 = 
›í_miscdrv
,

401 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2, 6, 36)

402 .
	gu∆ocked_io˘l
 = 
io˘l_miscdrv
,

404 .
	gio˘l
 = 
io˘l_miscdrv
,

406 .
	gªad
 = 
ªad_miscdrv
,

407 .
	gwrôe
 = 
wrôe_miscdrv
,

408 .
	gŒ£ek
 = 
no_Œ£ek
,

409 .
	gªÀa£
 = 
˛o£_miscdrv
,

412 
miscdevi˚
 
	gŒkd_miscdev
 = {

413 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

414 .
	g«me
 = 
DRVNAME
,

417 .
	gmode
 = 0666,

418 .
	gf›s
 = &
Œkd_misc_f›s
,

421 
__öô
 
	$£d2_drv_öô
()

423 
ªt
 = 0;

424 
devi˚
 *
dev
;

425 
°MyCtx
 *
¥iv
 = 
NULL
;

428 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

429 i‡(
ªt
) {

430 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

431  
ªt
;

433 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

435 
	`dev_öfo
(
dev
, "LLKD %s misc driver (major # 10)Ñegistered, minor# = %d,\n"

436 "devÇodêi†/dev/%s\n", 
DRVNAME
, 
Œkd_miscdev
.
mö‹
, DRVNAME);

449 
g¥iv
 = 
¥iv
 = 
	`devm_kzÆloc
(
dev
, (
°MyCtx
), 
GFP_KERNEL
);

450 i‡(!
¥iv
)

451  -
ENOMEM
;

452 
¥iv
->
dev
 = 
Œkd_miscdev
.
this_devi˚
;

453 
	`©omic_£t
(&
¥iv
->
w‹k_d⁄e
, 1);

455 
g¥iv
->
kd©a
 = 
	`devm_kzÆloc
(
dev
, (
£d_ds
), 
GFP_KERNEL
);

456 i‡(!
g¥iv
->
kd©a
)

457  -
ENOMEM
;

466 
g¥iv
->
kthrd_w‹k
 = 
	`kthªad_¸óã
(
w‹kî_kthªad
, 
NULL
, "%s/%s", 
DRVNAME
, 
KTHREAD_NAME
);

467 i‡(
	`IS_ERR
(
g¥iv
->
kthrd_w‹k
)) {

468 
ªt
 = 
	`PTR_ERR
(
g¥iv
->
kthrd_w‹k
);

469 
	`dev_îr
(
dev
, "kthªad cª©i⁄ faûed (%d)\n", 
ªt
);

470  
ªt
;

472 
	`gë_èsk_°ru˘
(
g¥iv
->
kthrd_w‹k
);

473 
	`¥_öfo
("w‹kî kthªad cª©ed... (PID %d)\n", 
	`èsk_pid_ƒ
(
g¥iv
->
kthrd_w‹k
));

476 
	`timî_£tup
(&
¥iv
->
timr
, 
timesup
, 0);

478 
	`¥_öfo
("öô d⁄ê(make_ô_Áû i†%s)\n", 
make_ô_Áû
 == 1 ? "*on*" : "off");

479 
	`dev_dbg
(
dev
, "loaded.\n");

480  
ªt
;

481 
	}
}

483 
__exô
 
	$£d2_drv_exô
()

485 
°MyCtx
 *
¥iv
 = 
g¥iv
;

487 
	`¥_debug
("waiting for our worker kthreadÅo stop...\n");

488 
	`kthªad_°›
(
g¥iv
->
kthrd_w‹k
);

490 
	`dev_dbg
(
¥iv
->
dev
, "unloading\n");

491 
	`dñ_timî_sync
(&
¥iv
->
timr
);

492 
	`misc_dîegi°î
(&
Œkd_miscdev
);

493 
	}
}

495 
moduÀ_öô
(
£d2_drv_öô
);

496 
moduÀ_exô
(
£d2_drv_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch5/sed2/sed_common.h

16 #i‚de‡
__LLKD_SED_COMMON_H__


17 
	~"../../c⁄víõ¡.h
"

25 
	#IOCTL_LLKD_SED_MAGIC
 0xA9

	)

26 
	#IOCTL_LLKD_SED_MAXIOCTL
 4

	)

35 
	#IOCTL_LLKD_SED_IOC_ENCRYPT_MSG
 
	`_IOR
(
IOCTL_LLKD_SED_MAGIC
, 1, )

	)

37 
	#IOCTL_LLKD_SED_IOC_RETRIEVE_MSG
 
	`_IOR
(
IOCTL_LLKD_SED_MAGIC
, 2, )

	)

39 
	#IOCTL_LLKD_SED_IOC_DECRYPT_MSG
 
	`_IOR
(
IOCTL_LLKD_SED_MAGIC
, 3, )

	)

41 
	#IOCTL_LLKD_SED_IOC_DESTROY_MSG
 
	`_IOR
(
IOCTL_LLKD_SED_MAGIC
, 4, )

	)

44 
	#MAX_DATA
 512

	)

46 
	s£d_ds
 {

47 
	md©a_xf‹m
;

48 
	mÀn
;

49 
	mtimed_out
;

50 
	mshmem
[
MAX_DATA
];

53 
	exf‹m
 { 
	mXF_NONE
, 
	mXF_RETRIEVE
, 
	mXF_ENCRYPT
, 
	mXF_DECRYPT
 };

55 
	#SHOW_TIME
() do { \

56 
	`¥_debug
("%ŒdÇs", 
	`ktime_gë_ªÆ_ns
()); \

57 } 0)

	)

	@Books/Linux-Kernel-Programming-Part-2/ch5/sed2/userapp_sed/userapp_sed2.c

27 
	~<°dio.h
>

28 
	~<uni°d.h
>

29 
	~<sys/ty≥s.h
>

30 
	~<sys/°©.h
>

31 
	~<f˙é.h
>

32 
	~<sig«l.h
>

33 
	~<°dlib.h
>

34 
	~<sys/io˘l.h
>

35 
	~<°rög.h
>

36 
	~<î∫o.h
>

37 
	~<limôs.h
>

38 
	~"../£d_comm⁄.h
"

44 
	$de°roy_msg
(
fd
)

46 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_SED_IOC_DESTROY_MSG
, 
NULL
) == -1) {

47 
	`≥º‹
("ioctl IOCTL_LLKD_SED_IOC_DESTROY_MSG failed");

51 
	}
}

59 
	$de¸y±_msg
(
fd
, *
msg
, *
¥g
)

61 
£d_ds
 *
kd
;

63 
kd
 = 
	`ˇŒoc
((
£d_ds
), 1);

64 i‡(!
kd
) {

65 
	`Ârötf
(
°dîr
, "%s: cÆloc(Ëkd faûed!\n", 
¥g
);

68 
kd
->
d©a_xf‹m
 = 
XF_DECRYPT
;

73 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_SED_IOC_DECRYPT_MSG
, 
kd
) == -1) {

74 i‡(
î∫o
 =
ETIMEDOUT
) {

75 
	`Ârötf
(
°dîr
,

77 
	`mem£t
(
kd
, 0, (
£d_ds
));

79 
	`≥º‹
("ioctl IOCTL_LLKD_SED_IOC_DECRYPT_MSG failed");

80 
	`‰ì
(
kd
);

84 
	`mem˝y
(
msg
, 
kd
->
shmem
, kd->
Àn
);

85 
	`‰ì
(
kd
);

88 
	}
}

96 
	$ªåõve_msg
(
fd
, *
Àn
, *
msg
, *
¥g
)

98 
£d_ds
 *
kd
;

101 
kd
 = 
	`ˇŒoc
((
£d_ds
), 1);

102 i‡(!
kd
) {

103 
	`Ârötf
(
°dîr
, "%s: cÆloc(Ëkd faûed!\n", 
¥g
);

106 
kd
->
d©a_xf‹m
 = 
XF_RETRIEVE
;

111 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_SED_IOC_RETRIEVE_MSG
, 
kd
) == -1) {

112 i‡(
î∫o
 =
ETIMEDOUT
) {

113 
	`Ârötf
(
°dîr
,

115 
	`mem£t
(
kd
, 0, (
£d_ds
));

117 
	`≥º‹
("ioctl IOCTL_LLKD_SED_IOC_RETRIEVE_MSG failed");

118 
	`‰ì
(
kd
);

122 *
Àn
 = 
kd
->len;

123 
	`mem˝y
(
msg
, 
kd
->
shmem
, kd->
Àn
);

124 
	`‰ì
(
kd
);

127 
	}
}

134 
	$í¸y±_msg
(
fd
, *
msg
, *
¥g
)

136 
£d_ds
 *
kd
;

138 
kd
 = 
	`ˇŒoc
((
£d_ds
), 1);

139 i‡(!
kd
) {

140 
	`Ârötf
(
°dîr
, "%s: cÆloc(Ëkd faûed!\n", 
¥g
);

144 
kd
->
d©a_xf‹m
 = 
XF_ENCRYPT
;

145 
kd
->
Àn
 = 
	`°æí
(
msg
);

146 
	`mem˝y
(
kd
->
shmem
, 
msg
, 
	`°æí
(msg));

154 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_SED_IOC_ENCRYPT_MSG
, 
kd
) == -1) {

155 
	`≥º‹
("ioctl IOCTL_LLKD_SED_IOC_ENCRYPT_MSG failed");

156 
	`‰ì
(
kd
);

159 
	`‰ì
(
kd
);

162 
	}
}

169 
	#CHECK_FOR_ENCRYPT
(
fú°
) \

170 i‡(
fú°
 == 1) { \

171 
	`¥ötf
("YouÇeedÅo first EncryptÅhe message,ÅherebyÖushing itÅo" \

174 }

	)

175 
	#CHECK_FOR_DESTROYED
(
de°royed
) \

176 i‡(
de°royed
) { \

177 
	`¥ötf
("The message is Destroyed;ÖleaseÑestartÅheáppÇow ...\n"); \

179 }

	)

181 
	$míu_drive
(
fd
, *
buf
, *
¥g
)

183 
fú°
 = 1;

184 
choi˚
 = 0, 
Àn
 = 0, 
ªt
, 
de°royed
 = 0;

185 *
msg
 = 
	`ˇŒoc
(
MAX_DATA
, 1);

187 i‡(!
msg
) {

188 
	`Ârötf
(
°dîr
, "%s: cÆlo¯(msgËÁûed\n", 
¥g
);

189 
	`˛o£
(
fd
);

190 
	`exô
(
EXIT_FAILURE
);

193 
¥ötf


198 
ªt
 = 
	`ªåõve_msg
(
fd
, &
Àn
, 
msg
, 
¥g
);

199 i‡(
ªt
 =0 && 
Àn
 > 0) {

200 
	`¥ötf
("DetectedÅhatÅhe driverálready holdsá message:\n"

203 
Àn
,Üí, 
msg
);

204 
fú°
 = 0;

206 
	`¥ötf
("ThêmesßgêwêshÆ»w‹k wôh is:\n\"%s\"\n", 
buf
);

209 
	`¥ötf
("\n *** Menu ***\n\
--- Message Control ---\n\
1. EncryptÅhe message\n\
2. RetrieveÅhe message (fromÅhe driver)\n\
3. DecryptÅhe message (that wasÉncrypted in (1))\n\
4. DestroyÅhe message\n\
--- Kernel Logs ---\n\
5. ViewÅhe kernelÜog (via dmesg(1))\n\
6. ClearÅhe kernelÜog (via sudo)\n\
7. Quit\n\
> ");

220 i‡(
	`sˇnf
("%d", &
choi˚
Ë=
EOF
) {

221 
¥ötf


223 
¥g
);

227 
choi˚
) {

229 
	`CHECK_FOR_DESTROYED
(
de°royed
);

230 
ªt
 = 
	`í¸y±_msg
(
fd
, 
buf
, 
¥g
);

231 i‡(
ªt
 == -1) {

232 i‡(
î∫o
 =
EBADRQC
)

233 
	`Ârötf
(
°dîr
,

236 
	`Ârötf
(
°dîr
,

238 
¥g
);

239 
fú°
 = 1;

241 
¥ötf


244 
fú°
 = 0;

248 
	`CHECK_FOR_DESTROYED
(
de°royed
);

249 
	`CHECK_FOR_ENCRYPT
(
fú°
);

250 
ªt
 = 
	`ªåõve_msg
(
fd
, &
Àn
, 
msg
, 
¥g
);

251 i‡(
ªt
 == -1)

252 
	`Ârötf
(
°dîr
,

254 
¥g
);

256 
¥ötf


259 "Üí=%d, msg=\"%.*s\"\n", 
Àn
,Üen,

260 
msg
);

263 
	`CHECK_FOR_DESTROYED
(
de°royed
);

264 
	`CHECK_FOR_ENCRYPT
(
fú°
);

265 
ªt
 = 
	`de¸y±_msg
(
fd
, 
msg
, 
¥g
);

266 i‡(
ªt
 == -1) {

267 i‡(
î∫o
 =
EBADRQC
)

268 
	`Ârötf
(
°dîr
,

271 
	`Ârötf
(
°dîr
,

273 
¥g
);

275 
¥ötf


280 
	`CHECK_FOR_DESTROYED
(
de°royed
);

281 
	`CHECK_FOR_ENCRYPT
(
fú°
);

282 
ªt
 = 
	`de°roy_msg
(
fd
);

283 i‡(
ªt
 == -1)

284 
	`Ârötf
(
°dîr
,

286 
¥g
);

288 
¥ötf


292 
de°royed
 = 1;

296 
	`¥ötf
("---> View kernelÜog : dmesg(1) <---\n");

297 i‡(
	`sy°em
("dmesg") < 0)

298 
	`Ârötf
(
°dîr
,

300 
¥g
);

303 
	`¥ötf
("---> Clear kernelÜog : sudo dmesg -C <---\n");

304 i‡(
	`sy°em
("sudo dmesg -C") < 0)

305 
	`Ârötf
(
°dîr
,

307 
¥g
);

310 
	`¥ötf
("---> Exiting on user choice <---\n");

311 
	`‰ì
(
msg
);

312 
	`˛o£
(
fd
);

313 
	`exô
(
EXIT_SUCCESS
);

315 
	`¥ötf
("---> Unknow¿choi˚ (%dË<---\n", 
choi˚
);

316 
	`gëch¨
();

319 
	}
}

321 
	$maö
(
¨gc
, **
¨gv
)

323 
fd
;

324 
buf
[
MAX_DATA
];

326 i‡(
¨gc
 < 3) {

327 
	`Ârötf
(
°dîr
, "Usage: %s device_file message_to_encrypt\n",

328 
¨gv
[0]);

329 
	`exô
(
EXIT_FAILURE
);

331 i‡(
	`°æí
(
¨gv
[2]Ë=0 || såÀn◊rgv[2]Ë> 
MAX_DATA
) {

332 
	`Ârötf
(
°dîr
, "%s: invÆid mesßge\n", 
¨gv
[0]);

333 
	`exô
(
EXIT_FAILURE
);

335 
	`mem˝y
(
buf
, 
¨gv
[2], 
MAX_DATA
);

337 
fd
 = 
	`›í
(
¨gv
[1], 
O_RDWR
, 0);

338 i‡(
fd
 == -1) {

339 
	`≥º‹
("open");

340 
	`exô
(
EXIT_FAILURE
);

342 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

344 
	`míu_drive
(
fd
, 
buf
, 
¨gv
[0]);

345 
	`exô
(
EXIT_SUCCESS
);

346 
	}
}

	@Books/Linux-Kernel-Programming-Part-2/ch5/sed3/sed3_driver/sed3_drv.c

80 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

82 
	~<löux/öô.h
>

83 
	~<löux/kî√l.h
>

84 
	~<löux/moduÀ.h
>

85 
	~<löux/sched.h
>

86 
	~<löux/fs.h
>

87 
	~<löux/¶ab.h
>

88 
	~<löux/devi˚.h
>

89 
	~<löux/miscdevi˚.h
>

90 
	~<löux/timî.h
>

91 
	~<löux/dñay.h
>

92 
	~<asm/©omic.h
>

93 
	~<löux/w‹kqueue.h
>

94 
	~<löux/sched/èsk.h
>

95 
	~<löux/sched/sig«l.h
>

98 
	~<löux/vîsi⁄.h
>

99 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

100 
	~<löux/uac˚ss.h
>

102 
	~<asm/uac˚ss.h
>

105 
	~"../£d_comm⁄.h
"

106 
	~"../../../c⁄víõ¡.h
"

108 
	#DRVNAME
 "£d3_drv"

	)

109 
	#TIMER_EXPIRE_MS
 10

110 
	#KTHREAD_NAME
 "w‹kî"

	)

112 
MODULE_DESCRIPTION
(

114 
MODULE_AUTHOR
("Kaiwan N Billimoria");

115 
MODULE_LICENSE
("Dual MIT/GPL");

116 
MODULE_VERSION
("0.1");

119 
	gmake_ô_Áû
;

120 
moduÀ_∑øm
(
make_ô_Áû
, , 0660);

121 
MODULE_PARM_DESC
(
make_ô_Áû
,

130 
	s°MyCtx
 {

131 
devi˚
 *
	mdev
;

132 
©omic_t
 
	mmsg_°©e
;

133 
©omic_t
 
	mw‹k_d⁄e
;

134 
©omic_t
 
	mtimed_out
;

135 
timî_li°
 
	mtimr
;

136 
w‹k_°ru˘
 
	m£d_w‹k
;

137 
£d_ds
 *
	mkd©a
;

138 
ktime_t
 
	mt1
, 
	mt2
;

140 
°MyCtx
 *
	gg¥iv
;

142 
	$timesup
(
timî_li°
 *
timî
)

144 
°MyCtx
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
timr
);

146 
	`©omic_£t
(&
¥iv
->
timed_out
, 1);

147 
	`¥_nŸi˚
("*** TimerÉxpired! ***\n");

148 
	`PRINT_CTX
();

149 
	}
}

151 
	#WORK_IS_ENCRYPT
 1

	)

152 
	#WORK_IS_DECRYPT
 2

	)

153 
	#CRYPT_OFFSET
 0x3F

154 

	)

165 
	$í¸y±_de¸y±_∑ylﬂd
(
w‹k
, 
£d_ds
 *
kd
)

167 
i
;

169 
	`¥öt_hex_dump_byãs
("kd©a->shmem: ", 
DUMP_PREFIX_OFFSET
, 
kd
->
shmem
, kd->
Àn
);

173 i‡(
w‹k
 =
WORK_IS_ENCRYPT
) {

174 
i
 = 0; i < 
kd
->
Àn
; i++) {

175 
kd
->
shmem
[
i
] ^
CRYPT_OFFSET
;

176 
kd
->
shmem
[
i
] +
CRYPT_OFFSET
;

178 } i‡(
w‹k
 =
WORK_IS_DECRYPT
) {

179 
i
 = 0; i < 
kd
->
Àn
; i++) {

180 
kd
->
shmem
[
i
] -
CRYPT_OFFSET
;

181 
kd
->
shmem
[
i
] ^
CRYPT_OFFSET
;

184 
	}
}

189 
	$£d3_w‹kî
(
w‹k_°ru˘
 *
w‹k
)

191 
°MyCtx
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, °MyCtx, 
£d_w‹k
);

193 
	`¥_debug
("startingÅimer +ÖrocessingÇow ...\n");

195 i‡(
	`mod_timî
(&
¥iv
->
timr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
TIMER_EXPIRE_MS
)))

196 
	`¥_Æît
("timerálreadyáctive?\n");

197 
¥iv
->
t1
 = 
	`ktime_gë_ªÆ_ns
();

200 
	`¥_debug
("[%d] w‹kÅaskábouàtÿexecuã w‹k!\n", 
	`èsk_pid_ƒ
(
cuºít
));

201 
	`PRINT_CTX
();

203 
	`©omic_£t
(&
¥iv
->
w‹k_d⁄e
, 0);

204 
¥iv
->
kd©a
->
d©a_xf‹m
) {

205 
XF_NONE
:

206 
	`¥_debug
("dataÅransformÅype: XF_NONE\n");

209 
XF_ENCRYPT
:

210 
	`¥_debug
("dataÅransformÅype: XF_ENCRYPT\n");

211 
	`í¸y±_de¸y±_∑ylﬂd
(
WORK_IS_ENCRYPT
, 
¥iv
->
kd©a
);

212 
	`©omic_£t
(&
¥iv
->
msg_°©e
, 
XF_ENCRYPT
);

214 
XF_DECRYPT
:

215 
	`¥_debug
("dataÅransformÅype: XF_DECRYPT\n");

216 
	`í¸y±_de¸y±_∑ylﬂd
(
WORK_IS_DECRYPT
, 
¥iv
->
kd©a
);

217 
	`©omic_£t
(&
¥iv
->
msg_°©e
, 
XF_DECRYPT
);

220 
	`¥_w¨n
("unknow¿å™sf‹mÖas£d (%d)\n", 
¥iv
->
kd©a
->
d©a_xf‹m
);

222 
	`©omic_£t
(&
¥iv
->
w‹k_d⁄e
, 1);

224 i‡(
make_ô_Áû
 == 1)

225 
	`m¶ìp
(
TIMER_EXPIRE_MS
 + 10);

228 
¥iv
->
t2
 = 
	`ktime_gë_ªÆ_ns
();

230 i‡(
	`dñ_timî
(&
¥iv
->
timr
) == 0)

231 
	`¥_öfo
("cancelledÅheÅimer while it's inactive! (deadline missed?)\n");

233 
	`¥_öfo
("processing complete,Åimeout cancelled\n");

234 
	`SHOW_DELTA
(
¥iv
->
t2
,Öriv->
t1
);

236 
	`¥_öfo
("[%d] FYI, workÅask done,Üeaving...\n",

237 
	`èsk_pid_ƒ
(
cuºít
));

238 
	}
}

245 
	#POLL_ON_WORK_DONE
(
¶ìp_ms
) do { \

246 
	`©omic_ªad
(&
¥iv
->
w‹k_d⁄e
) == 0) \

247 
	`m¶ìp_öãºu±ibÀ
(
¶ìp_ms
); \

248 } 0)

	)

262 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2, 6, 36)

263 
	$io˘l_miscdrv
(
fûe
 *
fûp
, 
cmd
, 
¨g
)

265 
	$io˘l_miscdrv
(
öode
 *
öo
, 
fûe
 *
fûp
, 
cmd
,

266 
¨g
)

269 
°MyCtx
 *
¥iv
 = 
g¥iv
;

272 i‡(
	`_IOC_TYPE
(
cmd
Ë!
IOCTL_LLKD_SED_MAGIC
) {

273 
	`¥_w¨n
("ioctl fail; magic # mismatch\n");

274  -
ENOTTY
;

276 i‡(
	`_IOC_NR
(
cmd
Ë> 
IOCTL_LLKD_SED_MAXIOCTL
) {

277 
	`¥_w¨n
("ioctl fail; invalid cmd?\n");

278  -
ENOTTY
;

281 
cmd
) {

282 
IOCTL_LLKD_SED_IOC_ENCRYPT_MSG
:

283 
	`¥_debug
("I¿io˘»'í¸y±' cmd o±i⁄;árg=0x%lx\n", 
¨g
);

287 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

288  -
EPERM
;

290 i‡(
	`©omic_ªad
(&
¥iv
->
msg_°©e
Ë=
XF_ENCRYPT
) {

291 
	`¥_nŸi˚
("encrypt op: message is currentlyÉncrypted;áborting op...\n");

292  -
EBADRQC
;

294 i‡(
	`c›y_‰om_u£r
(
¥iv
->
kd©a
, (
£d_ds
 *)
¨g
, (sed_ds))) {

295 
	`¥_w¨n
("copy_from_user() failed\n");

296  -
EFAULT
;

298 
	`¥_debug
("xf‹m=%d,Üí=%d\n", 
¥iv
->
kd©a
->
d©a_xf‹m
,Öriv->kd©a->
Àn
);

299 i‡(
¥iv
->
kd©a
->
Àn
 == 0) {

300 
	`¥_w¨n
("no dataÖassed (len is 0)\n");

301  -
EINVAL
;

303 
	`¥öt_hex_dump_byãs
("∑ylﬂd: ", 
DUMP_PREFIX_OFFSET
, 
¥iv
->
kd©a
->
shmem
,Öriv->kd©a->
Àn
);

305 
	`POLL_ON_WORK_DONE
(1);

307 i‡(!
	`scheduÀ_w‹k
(&
¥iv
->
£d_w‹k
))

308 
	`¥_w¨n
("workálready onÅhe kernel-global wq?\n");

320 
IOCTL_LLKD_SED_IOC_DECRYPT_MSG
:

321 
	`¥_debug
("In ioctl 'decrypt' cmd option\n");

322 i‡(
	`©omic_ªad
(&
¥iv
->
msg_°©e
Ë=
XF_DECRYPT
) {

323 
	`¥_nŸi˚
("decrypt op: message is currently decrypted;áborting op...\n");

324  -
EBADRQC
;

326 
¥iv
->
kd©a
->
d©a_xf‹m
 = 
XF_DECRYPT
;

328 
	`POLL_ON_WORK_DONE
(1);

330 i‡(!
	`scheduÀ_w‹k
(&
¥iv
->
£d_w‹k
))

331 
	`¥_w¨n
("workálready onÅhe kernel-global wq?\n");

334 
IOCTL_LLKD_SED_IOC_RETRIEVE_MSG
:

335 
	`¥_debug
("I¿io˘»'ªåõve' cmd o±i⁄;árg=0x%lx\n", 
¨g
);

336 i‡(
	`©omic_ªad
(&
¥iv
->
timed_out
) == 1) {

337 
	`¥_debug
("theÉncrypt op hadÅimed out!Ñetruning -ETIMEDOUT\n");

338  -
ETIMEDOUT
;

340 i‡(
	`c›y_to_u£r
((
£d_ds
 *)
¨g
, (£d_d†*)
¥iv
->
kd©a
, (sed_ds))) {

341 
	`¥_w¨n
("copy_to_user() failed\n");

342  -
EFAULT
;

345 
IOCTL_LLKD_SED_IOC_DESTROY_MSG
:

346 
	`¥_debug
("In ioctl 'destroy' cmd option\n");

347 
	`mem£t
(
¥iv
->
kd©a
, 0, (
£d_ds
));

348 
	`©omic_£t
(&
¥iv
->
msg_°©e
, 0);

349 
	`©omic_£t
(&
¥iv
->
w‹k_d⁄e
, 1);

350 
	`©omic_£t
(&
¥iv
->
timed_out
, 0);

351 
¥iv
->
t1
 =Öriv->
t2
 = 0;

354  -
ENOTTY
;

357 
	}
}

362 
	$›í_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

364 
	`PRINT_CTX
();

365 
	`¥_öfo
("›íög \"%s\"Çow\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
);

367  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

368 
	}
}

370 
ssize_t
 
	$ªad_miscdrv
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
off
)

372 
	`¥_öfo
("tÿªad %zd byãs\n", 
cou¡
);

373  
cou¡
;

374 
	}
}

376 
ssize_t
 
	$wrôe_miscdrv
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

377 
size_t
 
cou¡
, 
loff_t
 *
off
)

379 
	`¥_öfo
("tÿwrôê%zd byãs\n", 
cou¡
);

380  
cou¡
;

381 
	}
}

383 
	$˛o£_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

385 
	`¥_öfo
("˛osög \"%s\"\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
);

387 
	}
}

393 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

394 .
›í
 = 
›í_miscdrv
,

395 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2, 6, 36)

396 .
	gu∆ocked_io˘l
 = 
io˘l_miscdrv
,

398 .
	gio˘l
 = 
io˘l_miscdrv
,

400 .
	gªad
 = 
ªad_miscdrv
,

401 .
	gwrôe
 = 
wrôe_miscdrv
,

402 .
	gŒ£ek
 = 
no_Œ£ek
,

403 .
	gªÀa£
 = 
˛o£_miscdrv
,

406 
miscdevi˚
 
	gŒkd_miscdev
 = {

407 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

408 .
	g«me
 = 
DRVNAME
,

411 .
	gmode
 = 0666,

412 .
	gf›s
 = &
Œkd_misc_f›s
,

415 
__öô
 
	$£d3_drv_öô
()

417 
ªt
 = 0;

418 
devi˚
 *
dev
;

419 
°MyCtx
 *
¥iv
 = 
NULL
;

422 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

423 i‡(
ªt
) {

424 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

425  
ªt
;

427 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

429 
	`dev_öfo
(
dev
, "LLKD %s misc driver (major # 10)Ñegistered, minor# = %d,\n"

430 "devÇodêi†/dev/%s\n", 
DRVNAME
, 
Œkd_miscdev
.
mö‹
, DRVNAME);

443 
g¥iv
 = 
¥iv
 = 
	`devm_kzÆloc
(
dev
, (
°MyCtx
), 
GFP_KERNEL
);

444 i‡(!
¥iv
)

445  -
ENOMEM
;

446 
¥iv
->
dev
 = 
Œkd_miscdev
.
this_devi˚
;

447 
	`©omic_£t
(&
¥iv
->
w‹k_d⁄e
, 1);

449 
g¥iv
->
kd©a
 = 
	`devm_kzÆloc
(
dev
, (
£d_ds
), 
GFP_KERNEL
);

450 i‡(!
g¥iv
->
kd©a
)

451  -
ENOMEM
;

453 
	`INIT_WORK
(&
¥iv
->
£d_w‹k
, 
£d3_w‹kî
);

454 
	`¥_öfo
("Our workÅask onÅhe kernel-global workqueue is initialized\n");

457 
	`timî_£tup
(&
¥iv
->
timr
, 
timesup
, 0);

459 
	`¥_öfo
("öô d⁄ê(make_ô_Áû i†%s)\n", 
make_ô_Áû
 == 1 ? "*on*" : "off");

460 
	`dev_dbg
(
dev
, "loaded.\n");

461  
ªt
;

462 
	}
}

464 
__exô
 
	$£d3_drv_exô
()

466 
°MyCtx
 *
¥iv
 = 
g¥iv
;

468 
	`¥_debug
("waiting for our workÅaskÅo finish...\n");

469 i‡(
	`ˇn˚l_w‹k_sync
(&
¥iv
->
£d_w‹k
))

470 
	`¥_öfo
("yes,Åhere was indeed someÖending work;Çow done...\n");

471 
	`dev_dbg
(
¥iv
->
dev
, "unloading\n");

472 
	`dñ_timî_sync
(&
¥iv
->
timr
);

473 
	`misc_dîegi°î
(&
Œkd_miscdev
);

474 
	}
}

476 
moduÀ_öô
(
£d3_drv_öô
);

477 
moduÀ_exô
(
£d3_drv_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch5/timer_simple/timer_simple.c

20 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

22 
	~<löux/öô.h
>

23 
	~<löux/kî√l.h
>

24 
	~<löux/moduÀ.h
>

25 
	~<löux/timî.h
>

26 
	~"../../c⁄víõ¡.h
"

28 
	#OURMODNAME
 "timî_sim∂e"

	)

29 
	#INITIAL_VALUE
 3

	)

31 
MODULE_AUTHOR
("Kaiwan N Billimoria");

32 
MODULE_DESCRIPTION
("a simple LKMÅo demoá (repeating) kernelÅimer");

33 
MODULE_LICENSE
("Dual MIT/GPL");

34 
MODULE_VERSION
("0.1");

36 
	s°_˘x
 {

37 
timî_li°
 
	mtmr
;

38 
	md©a
;

39 } 
	g˘x
;

40 
	gexp_ms
 = 420;

45 
	$dög
(
timî_li°
 *
timî
)

47 
°_˘x
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
tmr
);

53 
¥iv
->
d©a
--;

54 
	`¥_debug
("timed out... d©a=%d\n", 
¥iv
->
d©a
);

55 
	`PRINT_CTX
();

58 i‡(
¥iv
->
d©a
)

59 
	`mod_timî
(&
¥iv
->
tmr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
));

60 
	}
}

62 
__öô
 
	$timî_sim∂e_öô
()

64 
˘x
.
d©a
 = 
INITIAL_VALUE
;

67 
˘x
.
tmr
.
expúes
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
);

68 
˘x
.
tmr
.
Êags
 = 0;

69 
	`timî_£tup
(&
˘x
.
tmr
, 
dög
, 0);

71 
	`¥_öfo
("timî sëÅÿexpúêö %ld ms\n", 
exp_ms
);

72 
	`add_timî
(&
˘x
.
tmr
);

75 
	}
}

77 
__exô
 
	$timî_sim∂e_exô
()

80 
	`dñ_timî_sync
(&
˘x
.
tmr
);

81 
	`¥_öfo
("removed\n");

82 
	}
}

84 
moduÀ_öô
(
timî_sim∂e_öô
);

85 
moduÀ_exô
(
timî_sim∂e_exô
);

	@Books/Linux-Kernel-Programming-Part-2/ch5/workq_simple/workq_simple.c

27 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

29 
	~<löux/öô.h
>

30 
	~<löux/kî√l.h
>

31 
	~<löux/moduÀ.h
>

32 
	~<löux/w‹kqueue.h
>

33 
	~<löux/timî.h
>

34 
	~"../../c⁄víõ¡.h
"

36 
	#OURMODNAME
 "w‹kq_sim∂e"

	)

37 
	#INITIAL_VALUE
 3

	)

39 
MODULE_AUTHOR
("Kaiwan N Billimoria");

40 
MODULE_DESCRIPTION
("a LKMÅo demoá simple workqueue");

41 
MODULE_LICENSE
("Dual MIT/GPL");

42 
MODULE_VERSION
("0.1");

44 
	s°_˘x
 {

45 
w‹k_°ru˘
 
	mw‹k
;

46 
timî_li°
 
	mtmr
;

47 
	md©a
;

48 } 
	g˘x
;

49 
	gexp_ms
 = 420;

50 
u64
 
	gt1
, 
	gt2
;

55 
	$dög
(
timî_li°
 *
timî
)

57 
°_˘x
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
tmr
);

65 
	`¥_debug
("timed out... d©a=%d\n", 
¥iv
->
d©a
);

66 
¥iv
->
d©a
--;

67 
	`PRINT_CTX
();

70 i‡(
¥iv
->
d©a
)

71 
	`mod_timî
(&
¥iv
->
tmr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
));

74 i‡(!
	`scheduÀ_w‹k
(&
¥iv
->
w‹k
))

75 
	`¥_nŸi˚
("our work'sálready onÅhe kernel-global workqueue!\n");

76 
t1
 = 
	`ktime_gë_ªÆ_ns
();

77 
	}
}

82 
	$w‹k_func
(
w‹k_°ru˘
 *
w‹k
)

84 
°_˘x
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, st_ctx, work);

86 
t2
 = 
	`ktime_gë_ªÆ_ns
();

87 
	`¥_öfo
("I¿ou∏w‹kq fun˘i⁄: d©a=%d\n", 
¥iv
->
d©a
);

88 
	`PRINT_CTX
();

89 
	`SHOW_DELTA
(
t2
, 
t1
);

90 
	}
}

92 
__öô
 
	$w‹kq_sim∂e_öô
()

94 
˘x
.
d©a
 = 
INITIAL_VALUE
;

97 
	`INIT_WORK
(&
˘x
.
w‹k
, 
w‹k_func
);

100 
˘x
.
tmr
.
expúes
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
);

101 
˘x
.
tmr
.
Êags
 = 0;

102 
	`timî_£tup
(&
˘x
.
tmr
, 
dög
, 0);

104 
	`¥_öfo
("W‹k queuêöôülized,Åimî sëÅÿexpúêö %ld ms\n", 
exp_ms
);

105 
	`add_timî
(&
˘x
.
tmr
);

108 
	}
}

110 
__exô
 
	$w‹kq_sim∂e_exô
()

113 i‡(
	`ˇn˚l_w‹k_sync
(&
˘x
.
w‹k
))

114 
	`¥_öfo
("yes,Åhere was indeed someÖending work;Çow done...\n");

119 
	`dñ_timî_sync
(&
˘x
.
tmr
);

120 
	`¥_öfo
("removed\n");

121 
	}
}

123 
moduÀ_öô
(
w‹kq_sim∂e_öô
);

124 
moduÀ_exô
(
w‹kq_sim∂e_exô
);

	@Books/Linux-Kernel-Programming-Part-2/convenient.h

16 #i‚de‡
__LKP2_CONVENIENT_H__


17 
	#__LKP2_CONVENIENT_H__


	)

19 
	~<asm/∑øm.h
>

20 
	~<löux/sched.h
>

22 #ifde‡
__KERNEL__


23 
	~<löux/øãlimô.h
>

52 #unde‡
USE_FTRACE_BUFFER


54 #ifde‡
USE_FTRACE_BUFFER


55 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

56 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

58 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

59 
USE_RATELIMITING
 = 1; \

60 i‡(
USE_RATELIMITING
) { \

61 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

64 
	`¥_öfo
(
°rög
, ##
¨gs
); \

65 } 0)

	)

70 #ifde‡
DEBUG


71 #ifde‡
__KERNEL__


72 
	#MSG
(
°rög
, 
¨gs
...) do { \

73 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

74 } 0)

	)

76 
	#MSG
(
°rög
, 
¨gs
...) do { \

77 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

78 } 0)

	)

81 #ifde‡
__KERNEL__


82 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

83 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

84 } 0)

	)

86 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

87 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

88 } 0)

	)

92 
	#QP
 
	`MSG
("\n")

	)

94 #ifde‡
__KERNEL__


95 #i‚de‡
USE_FTRACE_BUFFER


96 
	#QPDS
 do { \

97 
	`MSG
("\n"); \

98 
	`dump_°ack
(); \

99 } 0)

	)

101 
	#QPDS
 do { \

102 
	`MSG
("\n"); \

103 
	`åa˚_dump_°ack
(); \

104 } 0)

	)

108 #ifde‡
__KERNEL__


109 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

110 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

111 } 0)

	)

114 
	#MSG
(
°rög
, 
¨gs
...)

	)

115 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

116 
	#QP


	)

117 
	#QPDS


	)

125 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

126 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

127 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

128 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

129 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

131 #ifde‡
__KERNEL__


152 
	~<löux/sched.h
>

153 
	~<löux/öãºu±.h
>

155 
	#PRINT_CTX
() do { \

156 
PRINTCTX_SHOWHDR
 = 0; \

157 
öå
 = '.'; \

158 i‡(!
	`ö_èsk
()) { \

159 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

160 
öå
 = 'H'; \

161 i‡(
	`ö_úq
()) \

162 
öå
 = 'h'; \

163 i‡(
	`ö_so·úq
()) \

164 
öå
 = 's'; \

167 
öå
 = '.'; \

169 i‡(
PRINTCTX_SHOWHDR
 == 1) \

170 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

171 
	`¥_debug
( \

175 , 
	`øw_smp_¥o˚ss‹_id
(), \

176 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

177 (
	`úqs_dißbÀd
()?'d':'.'), \

178 (
	`√ed_ªsched
()?'N':'.'), \

179 
öå
, \

180 (
	`¥ìm±_cou¡
() && 0xff), \

181 
__func__
 \

183 } 0)

	)

198 #ifde‡
__KERNEL__


199 
	#as£π
(
ex¥
) do { \

200 i‡(!(
ex¥
)) { \

201 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

202 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

204 } 0)

	)

208 
ölöe
 
	$bìp
(
wh©
)

210 #ifde‡
__KERNEL__


211 
	`¥_öfo
("%c", ()
wh©
);

213 
	~<uni°d.h
>

214 
buf
 = ()
wh©
;

215 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

217 
	}
}

226 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

228 
c
 = 0, 
m
; \

229 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

231 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

232 
	`bìp
((
vÆ
)); \

233 
c
++; \

234 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

235 
m
 = 0; m < 50; m++); \

236 
x
 = 
ö√r_ödex
 / 2; \

240 }

	)

243 #ifde‡
__KERNEL__


244 
dñay_£c
();

256 
	$dñay_£c
(
vÆ
)

258 
	`asm
 ("");

259 i‡(
	`ö_èsk
()) {

260 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

261 i‡(-1 =
vÆ
)

262 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

264 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

266 
	}
}

269 #ifde‡
__KERNEL__


277 
	~<löux/jiffõs.h
>

278 
	~<löux/ktime.h
>

279 
	#SHOW_DELTA
(
œãr
, 
óæõr
) do { \

280 i‡(
	`time_a·î
(()
œãr
, ()
óæõr
)) { \

281 
	`¥_öfo
("delta: %lldÇs (= %lld us = %lld ms)\n", \

282 
	`ktime_sub
(
œãr
, 
óæõr
), \

283 
	`ktime_sub
(
œãr
, 
óæõr
)/1000, \

284 
	`ktime_sub
(
œãr
, 
óæõr
)/1000000 \

287 
	`¥_w¨n
("SHOW_DELTA(): *invalid*Éarlier >Üater?\n"); \

288 } 0)

	)

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch1/misc_plat/misc_plat.c

24 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

26 
	~<löux/öô.h
>

27 
	~<löux/kî√l.h
>

28 
	~<löux/moduÀ.h
>

29 
	~<löux/sched.h
>

30 
	~<löux/fs.h
>

31 
	~<löux/¶ab.h
>

32 
	~<löux/devi˚.h
>

33 
	~<löux/miscdevi˚.h
>

34 
	~<löux/∂©f‹m_devi˚.h
>

37 
	~<löux/vîsi⁄.h
>

38 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

39 
	~<löux/uac˚ss.h
>

41 
	~<asm/uac˚ss.h
>

43 
	~"../../c⁄víõ¡.h
"

45 
	#DRVNAME
 "misc_∂©"

	)

47 
MODULE_DESCRIPTION
("Simple demo misc driver onÅheÖlatform bus");

48 
MODULE_AUTHOR
("Kaiwan N Billimoria");

49 
MODULE_LICENSE
("Dual MIT/GPL");

50 
MODULE_VERSION
("0.1");

56 
	s°MyCtx
 {

57 
devi˚
 *
	mdev
;

58 
	md©a_xf‹m
;

62 
	$›í_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

64 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

66 i‡(
	`u∆ikñy
(!
buf
))

67  -
ENOMEM
;

69 
	`PRINT_CTX
();

70 
	`¥_öfo
("›íög \"%s\"Çow\n", 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
));

71 
	`k‰ì
(
buf
);

73  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

74 
	}
}

76 
ssize_t
 
	$ªad_miscdrv
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
off
)

78 
	`¥_öfo
("tÿªad %zd byãs\n", 
cou¡
);

79  
cou¡
;

80 
	}
}

82 
ssize_t
 
	$wrôe_miscdrv
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

83 
size_t
 
cou¡
, 
loff_t
 *
off
)

85 
	`¥_öfo
("tÿwrôê%zd byãs\n", 
cou¡
);

86  
cou¡
;

87 
	}
}

89 
	$˛o£_miscdrv
(
öode
 *öode, 
fûe
 *
fûp
)

91 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

93 i‡(
	`u∆ikñy
(!
buf
))

94  -
ENOMEM
;

96 
	`¥_öfo
("˛osög \"%s\"Çow\n", 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
));

97 
	`k‰ì
(
buf
);

100 
	}
}

103 
	$∂©dev_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

105 
devi˚
 *
dev
 = &
pdev
->dev;

106 
°MyCtx
 *
¥iv
 = 
	`dev_gë_∂©d©a
(&
pdev
->
dev
);

112 
¥iv
->
d©a_xf‹m
 = 100;

113 
	`dev_dbg
(
dev
, "platform driver:Örobe method invoked\n");

115 
	}
}

117 
	$∂©dev_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

119 
°MyCtx
 *
¥iv
 = 
	`dev_gë_∂©d©a
(&
pdev
->
dev
);

120 
devi˚
 *
dev
 = &
pdev
->dev;

122 
	`dev_dbg
(
dev
, "platform driver:remove method invoked\n data_xform=%d\n",

123 
¥iv
->
d©a_xf‹m
);

125 
	}
}

127 
	$∂©0_ªÀa£
(
devi˚
 *
dev
)

129 
	`dev_dbg
(
dev
, "platform device:Ñelease method invoked\n");

130 
	}
}

136 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

137 .
›í
 = 
›í_miscdrv
,

138 .
	gªad
 = 
ªad_miscdrv
,

139 .
	gwrôe
 = 
wrôe_miscdrv
,

140 .
	gŒ£ek
 = 
no_Œ£ek
,

141 .
	gªÀa£
 = 
˛o£_miscdrv
,

151 
miscdevi˚
 
	gŒkd_miscdev
 = {

152 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

153 .
	g«me
 = 
DRVNAME
,

156 .
	gmode
 = 0666,

157 .
	gf›s
 = &
Œkd_misc_f›s
,

164 
∂©f‹m_devi˚
 
	g∂©0
 = {

169 .
«me
 = "plat",

173 .
	gdrivî_ovîride
 = 
DRVNAME
,

175 .
	g«me
 = 
DRVNAME
,

177 .
	gid
 = 0,

178 .
	gdev
 = {

179 .
∂©f‹m_d©a
 = 
NULL
,

188 .
	gªÀa£
 = 
∂©0_ªÀa£
,

192 
∂©f‹m_devi˚
 *
	g∂©demo_∂©f‹m_devi˚s
[] 
	g__öôd©a
 = {

193 &
∂©0
,

197 
∂©f‹m_drivî
 
	g∂©drv
 = {

198 .
¥obe
 = 
∂©dev_¥obe
,

199 .
	gªmove
 = 
∂©dev_ªmove
,

200 .
	gdrivî
 = {

201 .
«me
 = 
DRVNAME
,

202 .
	gow√r
 = 
THIS_MODULE
,

206 
__öô
 
	$misc_∂©_öô
()

208 
ªt
 = 0;

209 
devi˚
 *
dev
;

210 
°MyCtx
 *
¥iv
 = 
NULL
;

212 
	`¥_öfo
("InitializingÖlatform demo driverÇow...\n");

215 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

216 i‡(
ªt
) {

217 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

218  
ªt
;

220 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

222 
	`dev_öfo
(
dev
, "LLKD misc driver (major # 10)Ñegistered, minor# = %d,"

223 " devÇodêi†%s\n", 
Œkd_miscdev
.
mö‹
, 
DRVNAME
);

225 
¥iv
 = 
	`devm_kzÆloc
(
dev
, (
°MyCtx
), 
GFP_KERNEL
);

226 i‡(!
¥iv
)

227  -
ENOMEM
;

228 
¥iv
->
dev
 = 
Œkd_miscdev
.
this_devi˚
;

229 
∂©0
.
dev
.
∂©f‹m_d©a
 = 
¥iv
;

233 
ªt
 = 
	`∂©f‹m_add_devi˚s
(
∂©demo_∂©f‹m_devi˚s
,

234 
	`ARRAY_SIZE
(
∂©demo_∂©f‹m_devi˚s
));

235 i‡(
ªt
) {

236 
	`¥_Æît
("platform_add_devices failed!\n");

237 
out_Áû_∑d
;

240 
ªt
 = 
	`∂©f‹m_drivî_ªgi°î
(&
∂©drv
);

241 i‡(
ªt
) {

242 
	`¥_Æît
("platform_driver_register failed!\n");

243 
out_Áû_pdr
;

248 
	`dev_dbg
(&
∂©0
.
dev
, "loaded.\n");

249  
ªt
;

251 
out_Áû_pdr
:

252 
	`∂©f‹m_devi˚_uƒegi°î
(&
∂©0
);

253 
out_Áû_∑d
:

254  
ªt
;

255 
	}
}

257 
__exô
 
	$misc_∂©_exô
()

259 
devi˚
 *
dev
 = &
∂©0
.dev;

260 
°MyCtx
 *
¥iv
 = 
∂©0
.
dev
.
∂©f‹m_d©a
;

262 
	`dev_dbg
(
dev
, "fyi, d©a_xf‹m=%d; u∆ﬂdög\n", 
¥iv
->
d©a_xf‹m
);

263 
	`∂©f‹m_drivî_uƒegi°î
(&
∂©drv
);

264 
	`∂©f‹m_devi˚_uƒegi°î
(&
∂©0
);

265 
	}
}

267 
moduÀ_öô
(
misc_∂©_öô
);

268 
moduÀ_exô
(
misc_∂©_exô
);

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/dbgfs_showall_threads/dbgfs_showall_threads.c

33 
	~<löux/öô.h
>

34 
	~<löux/moduÀ.h
>

35 
	~<löux/kî√l.h
>

36 
	~<löux/sched.h
>

37 
	~<löux/debugfs.h
>

38 
	~<löux/vmÆloc.h
>

40 
	~<löux/vîsi⁄.h
>

41 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4,11,0)

42 
	~<löux/uac˚ss.h
>

43 
	~<löux/sched/sig«l.h
>

45 
	~<asm/uac˚ss.h
>

48 
	#OURMODNAME
 "dbgfs_showÆl_thªads"

	)

49 
MODULE_AUTHOR
("<insertÇame here>");

50 
MODULE_DESCRIPTION
(

52 
MODULE_LICENSE
("Dual MIT/GPL");

53 
MODULE_VERSION
("0.1");

55 
	#DBGFS_CREATE_ERR
(
pDíåy
, 
°r
) do { \

56 
	`¥_öfo
("%s: faûed.\n", 
°r
); \

57 i‡(
	`PTR_ERR
(
pDíåy
Ë=-
ENODEV
) \

58 
	`¥_öfo
("%s: debugfs supportÇotávailable?\n", \

59 
OURMODNAME
); \

60 
	`debugfs_ªmove_ªcursive
(
pDíåy
); \

61  
	`PTR_ERR
(
pDíåy
); \

62 } 0)

	)

64 
díåy
 *
	gg∑ª¡
;

66 
ssize_t
 
	$showÆl_thªads
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

67 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

69 
èsk_°ru˘
 *
g
, *
t
;

70 *
d©a
;

71 
	#MEM_REQD_PER_THREAD
 128

	)

72 
ƒ_thrds
 = 1, 
tŸÆ
 = 1;

73 
	#TMPMAX
 128

	)

74 
tmp
[
TMPMAX
];

75 
ssize_t
 
numthrds
 = 0, 
n
 = 0;

77 
	`do_óch_thªad
(
g
, 
t
) {

78 
numthrds
++;

79 } 
	`whûe_óch_thªad
(
g
, 
t
);

80 
	`¥_debug
("#Åhªad†Æive: %zd\n", 
numthrds
);

86 
d©a
 = 
	`vzÆloc
(
numthrds
 * 
MEM_REQD_PER_THREAD
);

87 i‡(!
d©a
) {

88 
	`¥_Æît
("%s: vzÆloc(ËÁûuª!\n", 
OURMODNAME
);

89  -
ENOMEM
;

105 
	`ªad_lock
(&
èskli°_lock
);

109 
	`¢¥ötf
(
d©a
, 
TMPMAX
, "%d,%d,0x%px,0x%px,[%s]\n",

110 
t
->
pid
,Å->pid,Å,Å->
°ack
,Å->
comm
);

112 
	`do_óch_thªad
(
g
, 
t
) {

113 
	`èsk_lock
(
t
);

115 
	`mem£t
(
tmp
, 0, (tmp));

116 
	`¢¥ötf
(
tmp
, 
TMPMAX
 - 1, "%d,%d", 
g
->
tgid
, 
t
->
pid
);

117 
	`°∫ˇt
(
d©a
, 
tmp
, 
TMPMAX
);

120 
	`¢¥ötf
(
tmp
, 
TMPMAX
 - 1, ",0x%px", 
t
);

121 
	`°∫ˇt
(
d©a
, 
tmp
, 
TMPMAX
);

122 
	`¢¥ötf
(
tmp
, 
TMPMAX
 - 1, ",0x%px", 
t
->
°ack
);

123 
	`°∫ˇt
(
d©a
, 
tmp
, 
TMPMAX
);

125 i‡(!
g
->
mm
)

132 
	`¢¥ötf
(
tmp
, 
TMPMAX
 - 1, ",[%s]", 
t
->
comm
);

134 
	`¢¥ötf
(
tmp
, 
TMPMAX
 - 1, ",%s", 
t
->
comm
);

135 
	`°∫ˇt
(
d©a
, 
tmp
, 
TMPMAX
);

144 
ƒ_thrds
 = 
	`gë_ƒ_thªads
(
g
);

145 i‡(
g
->
mm
 && (g->
tgid
 =
t
->
pid
Ë&& (
ƒ_thrds
 > 1)) {

146 
	`¢¥ötf
(
tmp
, 
TMPMAX
 - 1, ",%d", 
ƒ_thrds
);

147 
	`°∫ˇt
(
d©a
, 
tmp
, 
TMPMAX
);

150 
	`¢¥ötf
(
tmp
, 2, "\n");

151 
	`°∫ˇt
(
d©a
, 
tmp
, 2);

152 
tŸÆ
++;

153 
	`èsk_u∆ock
(
t
);

154 } 
	`whûe_óch_thªad
(
g
, 
t
);

157 
	`ªad_u∆ock
(&
èskli°_lock
);

159 
n
 = 
	`sim∂e_ªad_‰om_buf„r
(
ubuf
, 
	`°æí
(
d©a
), 
Âos
, data,

160 
	`°æí
(
d©a
));

161 
	`v‰ì
(
d©a
);

162  
n
;

163 
	}
}

165 c⁄° 
fûe_›î©i⁄s
 
	gdbg_f›s1
 = {

166 .
ªad
 = 
showÆl_thªads
,

169 
__öô
 
	$dbgfs_showÆl_thªads_öô
()

171 
g∑ª¡
 = 
	`debugfs_¸óã_dú
(
OURMODNAME
, 
NULL
);

172 i‡(!
g∑ª¡
) {

173 
	`DBGFS_CREATE_ERR
(
g∑ª¡
, "debugfs_create_dir");

176 i‡(!
	`debugfs_¸óã_fûe
(
OURMODNAME
, 0444, 
g∑ª¡
,

177 (*)0, &
dbg_f›s1
)) {

178 
	`DBGFS_CREATE_ERR
(
g∑ª¡
, "debugfs_create_file 1");

180 
¥_öfo


182 
OURMODNAME
, OURMODNAME);

183 
	`¥_öfo
("%†öôülized\n", 
OURMODNAME
);

185 
	}
}

187 
__exô
 
	$dbgfs_showÆl_thªads_˛ónup
()

189 
	`debugfs_ªmove_ªcursive
(
g∑ª¡
);

190 
	`¥_öfo
("%†ªmoved\n", 
OURMODNAME
);

191 
	}
}

193 
moduÀ_öô
(
dbgfs_showÆl_thªads_öô
);

194 
moduÀ_exô
(
dbgfs_showÆl_thªads_˛ónup
);

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/ioctl_undoc/ioctl_llkd.h

18 
	#IOCTL_LLKD_MAGIC
 0xA9

	)

20 
	#IOCTL_LLKD_MAXIOCTL
 4

	)

29 
	#IOCTL_LLKD_IOCRESET
 
	`_IO
(
IOCTL_LLKD_MAGIC
, 0)

	)

32 
	#IOCTL_LLKD_IOCQPOWER
 
	`_IOR
(
IOCTL_LLKD_MAGIC
, 1, )

	)

35 
	#IOCTL_LLKD_IOCSPOWER
 
	`_IOW
(
IOCTL_LLKD_MAGIC
, 2, )

	)

40 #i‚de‡
__KERNEL__


41 
	tu32
;

42 
	tu64
;

45 
	sdrv_˘x
 {

46 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
, 
	mpowî
;

47 
u32
 
	mc⁄fig1
;

48 
u32
 
	mc⁄fig2
;

49 
u64
 
	mc⁄fig3
;

50 
	#MAXBYTES
 128

	)

51 
	mour£¸ë
[
MAXBYTES
];

55 
	#IOCTL_LLKD_IOCQDRVSTAT
 
	`_IOR
(
IOCTL_LLKD_MAGIC
, 3, 
drv_˘x
 *)

	)

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/ioctl_undoc/kerneldrv_ioctl/ioctl_undoc_kdrv.c

27 
	~<löux/moduÀ.h
>

28 
	~<löux/kî√l.h
>

29 
	~<löux/öô.h
>

30 
	~<löux/fs.h
>

31 
	~<löux/io˘l.h
>

32 
	~<löux/¶ab.h
>

35 
	~<löux/vîsi⁄.h
>

36 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4,11,0)

37 
	~<löux/uac˚ss.h
>

39 
	~<asm/uac˚ss.h
>

42 
	~"../io˘l_Œkd.h
"

43 
	~"../../../c⁄víõ¡.h
"

45 
	#OURMODNAME
 "io˘l_undoc_kdrv"

	)

46 
MODULE_AUTHOR
("<insertÇame here>");

47 
MODULE_DESCRIPTION
(

49 
MODULE_LICENSE
("Dual MIT/GPL");

50 
MODULE_VERSION
("0.1");

52 
	gio˘l_ötf_maj‹
 = 0,

53 
	gpowî
 = 1;

60 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,36)

61 
	$io˘l_ötf_io˘l
(
fûe
 *
fûp
, 
cmd
, 
¨g
)

63 
	$io˘l_ötf_io˘l
(
öode
 *
öo
, 
fûe
 *
fûp
, 
cmd
,

64 
¨g
)

67 
ªtvÆ
 = 0;

69 
	`MSG
("I¿io˘»mëhod, cmd=%d\n", 
	`_IOC_NR
(
cmd
));

72 i‡(
	`_IOC_TYPE
(
cmd
Ë!
IOCTL_LLKD_MAGIC
) {

73 
	`MSG
("ioctl fail; magic # mismatch\n");

74  -
ENOTTY
;

76 i‡(
	`_IOC_NR
(
cmd
Ë> 
IOCTL_LLKD_MAXIOCTL
) {

77 
	`MSG
("ioctl fail; invalid cmd?\n");

78  -
ENOTTY
;

81 
cmd
) {

82 
IOCTL_LLKD_IOCRESET
:

83 
	`MSG
("In ioctl cmd option: IOCTL_LLKD_IOCRESET\n");

87 
IOCTL_LLKD_IOCQPOWER
:

88 
	`MSG
("In ioctl cmd option: IOCTL_LLKD_IOCQPOWER\n"

89 "¨g=0x%x (drvËpowî=%d\n", ()
¨g
, 
powî
);

90 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

91  -
EPERM
;

96 
ªtvÆ
 = 
	`__put_u£r
(
powî
, (
__u£r
 *)
¨g
);

98 
IOCTL_LLKD_IOCSPOWER
:

99 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

100  -
EPERM
;

101 
powî
 = 
¨g
;

105 
	`MSG
("In ioctl cmd option: IOCTL_LLKD_IOCSPOWER\n"

106 "powî=%dÇow.\n", 
powî
);

108 
IOCTL_LLKD_IOCQDRVSTAT
:

109 
	`¥_öfo
("%s:%s():Çew undo¯io˘»cmd!\n", 
OURMODNAME
, 
__func__
);

110 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

111  -
EPERM
;

114  -
ENOTTY
;

116  
ªtvÆ
;

117 
	}
}

119 
	$io˘l_ötf_mö‹_›í
(
öode
 *
öo
, 
fûe
 *
fûp
)

121 
drv_˘x
 *
drv˘x
 = 
NULL
;

123 
drv˘x
 = 
	`kzÆloc
((
drv_˘x
), 
GFP_KERNEL
);

124 i‡(!
drv˘x
) {

125 
	`¥_w¨n
("%s: kmÆlo¯Áûed\n", 
OURMODNAME
);

126  -
ENOMEM
;

128 
drv˘x
->
powî
 = 1;

131 
fûp
->
¥iv©e_d©a
 = 
drv˘x
;

133 
	`MSG
("allocatedánd initÅhe driver context structure\n");

135 
	}
}

137 
	$io˘l_ötf_mö‹_˛o£
(
öode
 *
öo
, 
fûe
 *
fûp
)

139 
	`k‰ì
(
fûp
->
¥iv©e_d©a
);

140 
	`MSG
("freedÅhe driver context structure\n");

142 
	}
}

145 
fûe_›î©i⁄s
 
	gio˘l_ötf_f›s
 = {

146 .
›í
 = 
io˘l_ötf_mö‹_›í
,

147 .
	gŒ£ek
 = 
no_Œ£ek
,

148 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,36)

149 .
	gu∆ocked_io˘l
 = 
io˘l_ötf_io˘l
,

151 .
	gio˘l
 = 
io˘l_ötf_io˘l
,

153 .
	gªÀa£
 = 
io˘l_ötf_mö‹_˛o£
,

156 
__öô
 
	$io˘l_undoc_kdrv_öô
()

158 
ªsu…
;

160 
	`MSG
("io˘l_ötf_maj‹=%d\n", 
io˘l_ötf_maj‹
);

166 
ªsu…
 = 
	`ªgi°î_chrdev
(
io˘l_ötf_maj‹
, 
OURMODNAME
, &
io˘l_ötf_f›s
);

167 i‡(
ªsu…
 < 0) {

168 
	`MSG
("register_chrdev() failedÅryingÅo get ioctl_intf_major=%d\n",

169 
io˘l_ötf_maj‹
);

170  
ªsu…
;

173 i‡(
io˘l_ötf_maj‹
 == 0)

174 
io˘l_ötf_maj‹
 = 
ªsu…
;

175 
	`MSG
("ªgi°îed:: io˘l_ötf_maj‹=%d\n", 
io˘l_ötf_maj‹
);

177 
	`¥_öfo
("%†öôülized\n", 
OURMODNAME
);

179 
	}
}

181 
	$io˘l_undoc_kdrv_˛ónup
()

183 
	`uƒegi°î_chrdev
(
io˘l_ötf_maj‹
, 
OURMODNAME
);

184 
	`¥_öfo
("%†ªmoved\n", 
OURMODNAME
);

185 
	}
}

187 
moduÀ_öô
(
io˘l_undoc_kdrv_öô
);

188 
moduÀ_exô
(
io˘l_undoc_kdrv_˛ónup
);

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/ioctl_undoc/userspace_ioctl/ioctl_llkd_userspace.c

27 
	~<°dio.h
>

28 
	~<uni°d.h
>

29 
	~<sys/ty≥s.h
>

30 
	~<sys/°©.h
>

31 
	~<f˙é.h
>

32 
	~<sig«l.h
>

33 
	~<°dlib.h
>

34 
	~<sys/io˘l.h
>

35 
	~"../io˘l_Œkd.h
"

37 
	$maö
(
¨gc
, **
¨gv
)

39 
fd
, 
powî
;

40 
drv_˘x
 *
drv˘x
 = 
NULL
;

42 i‡(
¨gc
 < 2) {

43 
	`Ârötf
(
°dîr
, "Ußge: %†devi˚_fûe\n\
 devi˚_fûêd€†nŸÉxi°, cª©êô usög mknod(1Ë◊†roŸ)\n", 
¨gv
[0]);

45 
	`exô
(
EXIT_FAILURE
);

48 i‡((
fd
 = 
	`›í
(
¨gv
[1], 
O_RDWR
, 0)) == -1) {

49 
	`≥º‹
("open");

50 
	`exô
(
EXIT_FAILURE
);

52 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

54 
¥ötf


57 
IOCTL_LLKD_IOCRESET
, ()
IOCTL_LLKD_IOCQPOWER
,

58 ()
IOCTL_LLKD_IOCSPOWER
);

62 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_IOCRESET
, 0) == -1) {

63 
	`≥º‹
("ioctl IOCTL_LLKD_IOCRESET failed");

64 
	`˛o£
(
fd
);

65 
	`exô
(
EXIT_FAILURE
);

67 
	`¥ötf
("%s: devi˚Ñe£t.\n", 
¨gv
[0]);

70 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_IOCQPOWER
, &
powî
) == -1) {

71 
	`≥º‹
("ioctl IOCTL_LLKD_IOCQPOWER failed");

72 
	`˛o£
(
fd
);

73 
	`exô
(
EXIT_FAILURE
);

75 
	`¥ötf
("%s:Öowî=%d\n", 
¨gv
[0], 
powî
);

78 
drv˘x
 = 
	`ˇŒoc
(1, (
drv_˘x
));

79 i‡(!
drv˘x
) {

80 
	`Ârötf
(
°dîr
, "%s: cÆlo¯Áûed\n", 
¨gv
[0]);

81 
	`˛o£
(
fd
);

82 
	`exô
(
EXIT_FAILURE
);

85 
	`¥ötf
("%s:Ñu¬ögÅhê'undocumíãd' io˘»cmd IOCQDRVSTATÇow...\n", 
¨gv
[0]);

86 i‡(
	`io˘l
(
fd
, 
IOCTL_LLKD_IOCQDRVSTAT
, 
drv˘x
) == -1) {

87 
	`≥º‹
("ioctl IOCTL_LLKD_IOCSPOWER failed");

88 
	`‰ì
(
drv˘x
);

89 
	`˛o£
(
fd
);

90 
	`exô
(
EXIT_FAILURE
);

92 
	`¥ötf
("%s: 'driver context' details:\n"

95 , 
¨gv
[0], 
drv˘x
->
powî
, drv˘x->
tx
, drv˘x->
rx
);

97 
	`‰ì
(
drv˘x
);

98 
	`˛o£
(
fd
);

99 
	`exô
(
EXIT_SUCCESS
);

100 
	}
}

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/sysfs_addrxlate/sysfs_addrxlate.c

27 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

29 
	~<löux/öô.h
>

30 
	~<löux/moduÀ.h
>

31 
	~<löux/kî√l.h
>

32 
	~<löux/ty≥s.h
>

33 
	~<löux/∂©f‹m_devi˚.h
>

34 
	~<löux/muãx.h
>

35 
	~<löux/mm.h
>

36 
	~<asm/io.h
>

39 
	~<löux/vîsi⁄.h
>

40 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

41 
	~<löux/uac˚ss.h
>

43 
	~<asm/uac˚ss.h
>

46 
MODULE_AUTHOR
("Kaiwan N Billimoria");

47 
	gMODULE_DESCRIPTION


55 
MODULE_LICENSE
("Dual MIT/GPL");

56 
MODULE_VERSION
("0.1");

58 
	#OURMODNAME
 "sysfs_addrxœã"

	)

59 
	#SYSFS_FILE1
 
addrxœã_kva2∑


	)

60 
	#SYSFS_FILE2
 
addrxœã_∑2kva


	)

63 
DEFINE_MUTEX
(
mtx1
);

64 
DEFINE_MUTEX
(
mtx2
);

65 
∂©f‹m_devi˚
 *
	gsysfs_demo_∂©dev
;

82 
	#MANUALLY


	)

83 
	#ADDR_MAXLEN
 20

	)

84 
phys_addr_t
 
	ggxœãd_addr_kva2∑
;

86 
size_t
 
	ggxœãd_addr_∑2kva
;

91 
ssize_t
 
	$addrxœã_∑2kva_show
(
devi˚
 *
dev
,

92 
devi˚_©åibuã
 *
©å
, *
buf
)

94 
n
;

96 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx2
))

97  -
ERESTARTSYS
;

98 
	`¥_debug
("InÅhe 'show' method\n");

99 
n
 = 
	`¢¥ötf
(
buf
, 
ADDR_MAXLEN
, "0x%px\n", (*)
gxœãd_addr_∑2kva
);

100 
	`muãx_u∆ock
(&
mtx2
);

102  
n
;

103 
	}
}

106 
ssize_t
 
	$addrxœã_∑2kva_°‹e
(
devi˚
 *
dev
,

107 
devi˚_©åibuã
 *
©å
,

108 c⁄° *
buf
, 
size_t
 
cou¡
)

110 
ªt
 = ()
cou¡
;

111 
s_addr
[
ADDR_MAXLEN
];

112 
phys_addr_t
 
∑
 = 0x0;

114 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx2
))

115  -
ERESTARTSYS
;

117 
	`mem£t
(
s_addr
, 0, 
ADDR_MAXLEN
);

118 
	`°∫˝y
(
s_addr
, 
buf
, 
ADDR_MAXLEN
);

119 
s_addr
[
	`°∫Àn
(s_addr, 
ADDR_MAXLEN
) - 1] = '\0';

120 i‡(
cou¡
 =0 || cou¡ > 
ADDR_MAXLEN
) {

121 
ªt
 = -
EINVAL
;

122 
out
;

125 #if(
BITS_PER_LONG
 == 32)

126 
ªt
 = 
	`k°πoul
(
s_addr
, 0, (*)&
∑
);

128 
ªt
 = 
	`k°πouŒ
(
s_addr
, 0, &
∑
);

130 i‡(
ªt
 < 0) {

131 
	`muãx_u∆ock
(&
mtx2
);

132 
	`¥_w¨n
("kstrtoul failed!\n");

133  
ªt
;

139 i‡(
∑
 > 
PAGE_OFFSET
) {

140 
	`muãx_u∆ock
(&
mtx1
);

141 
	`¥_öfo
("övÆidÖhysiˇ»addªs†(0x%∑)?\n",&
∑
);

142  -
EFAULT
;

146 
gxœãd_addr_∑2kva
 = (
size_t
)
	`phys_to_vút
(
∑
);

147 
	`¥_debug
("Ö®0x%∑ = KVA 0x%px\n", &
∑
, (*)
gxœãd_addr_∑2kva
);

149 #ifde‡
MANUALLY


151 
	`¥_öfo
("manually:Öa 0x%pa = KVA 0x%px\n",

152 &
∑
, (*)’®+ 
PAGE_OFFSET
));

154 
ªt
 = 
cou¡
;

155 
out
:

156 
	`muãx_u∆ock
(&
mtx2
);

157  
ªt
;

158 
	}
}

160 
DEVICE_ATTR_RW
(
SYSFS_FILE2
);

165 
ssize_t
 
	$addrxœã_kva2∑_show
(
devi˚
 *
dev
,

166 
devi˚_©åibuã
 *
©å
, *
buf
)

168 
n
;

170 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx1
))

171  -
ERESTARTSYS
;

172 
	`¥_debug
("InÅhe 'show' method\n");

173 
n
 = 
	`¢¥ötf
(
buf
, 
ADDR_MAXLEN
, "0x%px\n", (*)
gxœãd_addr_kva2∑
);

175 
	`muãx_u∆ock
(&
mtx1
);

177  
n
;

178 
	}
}

181 
ssize_t
 
	$addrxœã_kva2∑_°‹e
(
devi˚
 *
dev
,

182 
devi˚_©åibuã
 *
©å
,

183 c⁄° *
buf
, 
size_t
 
cou¡
)

185 
ªt
 = ()
cou¡
, 
vÆid
 = 1;

186 
s_addr
[
ADDR_MAXLEN
];

187 
size_t
 
kva
 = 0x0;

190 i‡(
	`muãx_lock_öãºu±ibÀ
(&
mtx1
))

191  -
ERESTARTSYS
;

193 
	`mem£t
(
s_addr
, 0, 
ADDR_MAXLEN
);

194 
	`°∫˝y
(
s_addr
, 
buf
, 
ADDR_MAXLEN
);

196 
s_addr
[
	`°∫Àn
(s_addr, 
ADDR_MAXLEN
) - 1] = '\0';

197 i‡(
cou¡
 =0 || cou¡ > 
ADDR_MAXLEN
) {

198 
	`¥_öfo
("övÆidádd∏Àngth (cou¡=%ld)\n", 
cou¡
);

199 
ªt
 = -
EINVAL
;

200 
out
;

203 #if(
BITS_PER_LONG
 == 32)

204 
ªt
 = 
	`k°πoul
(
s_addr
, 0, (*)&
kva
);

206 
ªt
 = 
	`k°πouŒ
(
s_addr
, 0, &
kva
);

208 i‡(
ªt
 < 0) {

209 
	`muãx_u∆ock
(&
mtx1
);

210 
	`¥_w¨n
("kstrtoul failed!\n");

211  
ªt
;

219 #ifde‡
CONFIG_X86


220 i‡(!
	`vút_addr_vÆid
(
kva
))

221 
vÆid
 = 0;

224 i‡((
kva
 < 
PAGE_OFFSET
Ë|| (kv®> (
size_t
)
high_mem‹y
))

225 
vÆid
 = 0;

227 i‡(!
vÆid
) {

228 
	`muãx_u∆ock
(&
mtx1
);

229 
	`¥_öfo
("invalid virtualáddress (0x%px),"

232 (*)
kva
);

233  -
EFAULT
;

237 
gxœãd_addr_kva2∑
 = 
	`vút_to_phys
((vﬁ©ûê*)
kva
);

238 
	`¥_debug
("KVA 0x%px =Ö®0x%∑\n", (*)
kva
, &
gxœãd_addr_kva2∑
);

240 #ifde‡
MANUALLY


242 
	`¥_öfo
("%s: manually: KVA 0x%px =Öa 0x%px\n",

243 
OURMODNAME
, (*)
kva
, (*)(kv®- 
PAGE_OFFSET
));

245 
ªt
 = 
cou¡
;

246 
out
:

247 
	`muãx_u∆ock
(&
mtx1
);

248  
ªt
;

249 
	}
}

254 
DEVICE_ATTR_RW
(
SYSFS_FILE1
);

273 
__öô
 
	$sysfs_addrxœã_öô
()

275 
°©
 = 0;

277 i‡(!
	`IS_ENABLED
(
CONFIG_SYSFS
)) {

278 
	`¥_w¨n
("sysfs unsupported! Aborting ...\n");

279  -
EINVAL
;

286 
	#PLAT_NAME
 "Œkd_sysfs_addrxœã"

	)

287 
sysfs_demo_∂©dev
 =

288 
	`∂©f‹m_devi˚_ªgi°î_sim∂e
(
PLAT_NAME
, -1, 
NULL
, 0);

289 i‡(
	`IS_ERR
(
sysfs_demo_∂©dev
)) {

290 
°©
 = 
	`PTR_ERR
(
sysfs_demo_∂©dev
);

291 
	`¥_öfo
("îr‹ (%dËªgi°îög ou∏∂©f‹m devi˚,áb‹tög\n", 
°©
);

292 
out1
;

301 
°©
 =

302 
	`devi˚_¸óã_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_SYSFS_FILE1
);

303 i‡(
°©
) {

304 
	`¥_öfo
 ("devi˚_¸óã_fûê[1] faûed (%d),áb‹tögÇow\n", 
°©
);

305 
out2
;

307 
	`¥_öfo
("sysfs file [1] (/sys/devices/platform/%s/%s) created\n",

308 
PLAT_NAME
, 
	`__°rögify
(
SYSFS_FILE1
));

311 
°©
 =

312 
	`devi˚_¸óã_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_SYSFS_FILE2
);

313 i‡(
°©
) {

314 
	`¥_öfo
 ("devi˚_¸óã_fûê[2] faûed (%d),áb‹tögÇow\n", 
°©
);

315 
out3
;

317 
	`¥_öfo
("sysfs file [2] (/sys/devices/platform/%s/%s) created\n",

318 
PLAT_NAME
, 
	`__°rögify
(
SYSFS_FILE2
));

320 
	`¥_öfo
("initialized\n");

323 
out3
:

324 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_SYSFS_FILE1
);

325 
out2
:

326 
	`∂©f‹m_devi˚_uƒegi°î
(
sysfs_demo_∂©dev
);

327 
out1
:

328  
°©
;

329 
	}
}

331 
__exô
 
	$sysfs_addrxœã_˛ónup
()

334 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_SYSFS_FILE2
);

335 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_SYSFS_FILE1
);

337 
	`∂©f‹m_devi˚_uƒegi°î
(
sysfs_demo_∂©dev
);

338 
	`¥_öfo
("removed\n");

339 
	}
}

341 
moduÀ_öô
(
sysfs_addrxœã_öô
);

342 
moduÀ_exô
(
sysfs_addrxœã_˛ónup
);

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch5/timer_simple_check/timer_simple_check.c

18 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

20 
	~<löux/öô.h
>

21 
	~<löux/kî√l.h
>

22 
	~<löux/moduÀ.h
>

23 
	~<löux/timî.h
>

24 
	~<löux/ktime.h
>

25 
	~"../../c⁄víõ¡.h
"

27 
	#OURMODNAME
 "timî_sim∂e_check"

	)

28 
	#INITIAL_VALUE
 3

	)

30 
MODULE_AUTHOR
("Kaiwan N Billimoria");

31 
MODULE_DESCRIPTION
("sample solution: solutions_to_assgn/ch5/timer_simple_check/");

32 
MODULE_LICENSE
("Dual MIT/GPL");

33 
MODULE_VERSION
("0.1");

35 
	s°_˘x
 {

36 
timî_li°
 
	mtmr
;

37 
	md©a
;

38 } 
	g˘x
;

39 
	gexp_ms
 = 420;

40 
u64
 
	gt1
, 
	gt2
;

42 
	$dög
(
timî_li°
 *
timî
)

44 
°_˘x
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
tmr
);

46 
t2
 = 
	`ktime_gë_ªÆ_ns
();

48 
	`¥_debug
("timed out... d©a=%d\n", 
¥iv
->
d©a
--);

54 i‡(
	`time_a·î
(()
t2
, ()
t1
))

55 
	`¥_öfo
("->áctual: %11lluÇs = %7llu us = %4llu ms\n",

56 (
t2
-
t1
), (t2-t1)/1000, (t2-t1)/1000000);

57 
	`PRINT_CTX
();

60 i‡(
¥iv
->
d©a
) {

61 
	`mod_timî
(&
¥iv
->
tmr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
));

62 
t1
 = 
t2
;

64 
	}
}

66 
__öô
 
	$timî_sim∂e_check_öô
()

68 
˘x
.
d©a
 = 
INITIAL_VALUE
;

69 
˘x
.
tmr
.
expúes
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
);

70 
˘x
.
tmr
.
Êags
 = 0;

71 
	`timî_£tup
(&
˘x
.
tmr
, 
dög
, 0);

73 
	`¥_öfo
("timî sëÅÿexpúêö %ld ms\n", 
exp_ms
);

74 
t1
 = 
	`ktime_gë_ªÆ_ns
();

75 
	`add_timî
(&
˘x
.
tmr
);

78 
	}
}

80 
__exô
 
	$timî_sim∂e_check_exô
()

82 
	`¥_debug
("wait forÖossibleÅimeoutsÅo complete...\n");

83 
	`dñ_timî_sync
(&
˘x
.
tmr
);

84 
	`¥_öfo
("removed\n");

85 
	}
}

87 
moduÀ_öô
(
timî_sim∂e_check_öô
);

88 
moduÀ_exô
(
timî_sim∂e_check_exô
);

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch5/workq_delayed/workq_delayed.c

23 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

25 
	~<löux/öô.h
>

26 
	~<löux/kî√l.h
>

27 
	~<löux/moduÀ.h
>

28 
	~<löux/w‹kqueue.h
>

29 
	~<löux/timî.h
>

30 
	~"../../c⁄víõ¡.h
"

32 
	#OURMODNAME
 "w‹kq_sim∂e2"

	)

33 
	#INITIAL_VALUE
 3

	)

35 
MODULE_AUTHOR
("Kaiwan N Billimoria");

36 
MODULE_DESCRIPTION
("solution: ch5:a LKMÅo demoá workqueue with 2 functions");

37 
MODULE_LICENSE
("Dual MIT/GPL");

38 
MODULE_VERSION
("0.1");

40 
	gw‹k_dñay_ms
 = 500;

41 
moduÀ_∑øm
(
w‹k_dñay_ms
, 
uöt
, 0440);

42 
MODULE_PARM_DESC
(
w‹k_dñay_ms
,

45 
	s°_˘x
 {

46 
w‹k_°ru˘
 
	mw‹k1
;

47 
w‹k_°ru˘
 
	mw‹k2
;

48 
timî_li°
 
	mtmr
;

49 
	md©a
;

50 
u64
 
	mt1s
, 
	mt1e
, 
	mt2s
, 
	mt2e
;

52 
u64
 
	mtd1
, 
	mtd2
;

53 
dñayed_w‹k
 
	mdw‹k
;

54 } 
	g˘x
;

55 
	gexp_ms
 = 420;

60 
	$dög
(
timî_li°
 *
timî
)

62 
°_˘x
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
tmr
);

64 
	`¥_debug
("timed out... d©a=%d\n", 
¥iv
->
d©a
--);

65 
	`PRINT_CTX
();

68 i‡(
¥iv
->
d©a
)

69 
	`mod_timî
(&
¥iv
->
tmr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
));

72 i‡(!
	`scheduÀ_w‹k
(&
¥iv
->
w‹k1
))

73 
	`¥_nŸi˚
("work1: our work'sálready onÅhe kernel-global workqueue!\n");

74 
¥iv
->
t1s
 = 
	`ktime_gë_ªÆ_ns
();

75 i‡(!
	`scheduÀ_w‹k
(&
¥iv
->
w‹k2
))

76 
	`¥_nŸi˚
("work2: our work'sálready onÅhe kernel-global workqueue!\n");

77 
¥iv
->
t2s
 = 
	`ktime_gë_ªÆ_ns
();

78 
	}
}

83 
	$w‹k_func1
(
w‹k_°ru˘
 *
w‹k
)

85 
°_˘x
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, °_˘x, 
w‹k1
);

87 
¥iv
->
t1e
 = 
	`ktime_gë_ªÆ_ns
();

88 
	`¥_öfo
("I¿ou∏w‹kq #1 fun˘i⁄: d©a=%d\n", 
¥iv
->
d©a
);

89 
	`PRINT_CTX
();

90 
	`SHOW_DELTA
(
¥iv
->
t1e
,Öriv->
t1s
);

91 
	}
}

95 
	$w‹k_func2
(
w‹k_°ru˘
 *
w‹k
)

97 
°_˘x
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, °_˘x, 
w‹k2
);

99 
¥iv
->
t2e
 = 
	`ktime_gë_ªÆ_ns
();

100 
	`¥_öfo
("I¿ou∏w‹kq #2 fun˘i⁄: d©a=%d\n", 
¥iv
->
d©a
);

101 
	`PRINT_CTX
();

102 
	`SHOW_DELTA
(
¥iv
->
t2e
,Öriv->
t2s
);

103 
	}
}

107 
	$w‹k_func_dñayed
(
w‹k_°ru˘
 *
w‹k
)

109 
°_˘x
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, °_˘x, 
dw‹k
.work);

114 
¥iv
->
td2
 = 
	`ktime_gë_ªÆ_ns
();

115 
	`¥_öfo
("I¿ou∏w‹kq dñayed #3 fun˘i⁄: d©a=%d\n", 
¥iv
->
d©a
);

116 
	`PRINT_CTX
();

117 
	`SHOW_DELTA
(
¥iv
->
td2
,Öriv->
td1
);

118 
	}
}

120 
__öô
 
	$w‹kq_dñayed_öô
()

122 
	`mem£t
(&
˘x
, 0, (
°_˘x
));

123 
˘x
.
d©a
 = 
INITIAL_VALUE
;

126 
	`INIT_WORK
(&
˘x
.
w‹k1
, 
w‹k_func1
);

127 
	`INIT_WORK
(&
˘x
.
w‹k2
, 
w‹k_func2
);

130 
˘x
.
tmr
.
expúes
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
);

131 
˘x
.
tmr
.
Êags
 = 0;

132 
	`timî_£tup
(&
˘x
.
tmr
, 
dög
, 0);

134 
	`¥_öfo
("W‹k queuêöôülized,Åimî sëÅÿexpúêö %ld ms\n", 
exp_ms
);

135 
	`add_timî
(&
˘x
.
tmr
);

137 
	`INIT_DELAYED_WORK
(&
˘x
.
dw‹k
, 
w‹k_func_dñayed
);

138 i‡(!
	`scheduÀ_dñayed_w‹k
(&
˘x
.
dw‹k
, 
	`m£cs_to_jiffõs
(
w‹k_dñay_ms
)))

139 
	`¥_nŸi˚
("dwork: our work'sálready onÅhe kernel-global workqueue!\n");

141 
	`¥_öfo
("Dñayed w‹kÅask scheduÀdÅÿexecuã i¿%u ms\n", 
w‹k_dñay_ms
);

142 
˘x
.
td1
 = 
	`ktime_gë_ªÆ_ns
();

145 
	}
}

147 
__exô
 
	$w‹kq_dñayed_exô
()

150 i‡(
	`ˇn˚l_w‹k_sync
(&
˘x
.
w‹k1
))

151 
	`¥_öfo
("work1: yes,Åhere was indeed someÖending work;Çow done...\n");

152 i‡(
	`ˇn˚l_w‹k_sync
(&
˘x
.
w‹k2
))

153 
	`¥_öfo
("work2: yes,Åhere was indeed someÖending work;Çow done...\n");

156 i‡(
	`ˇn˚l_dñayed_w‹k_sync
(&
˘x
.
dw‹k
))

157 
	`¥_öfo
("dwork: yes,Åhere was indeed someÖending work;Çow done...\n");

160 
	`dñ_timî_sync
(&
˘x
.
tmr
);

161 
	`¥_öfo
("removed\n");

162 
	}
}

164 
moduÀ_öô
(
w‹kq_dñayed_öô
);

165 
moduÀ_exô
(
w‹kq_dñayed_exô
);

	@Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch5/workq_simple2/workq_simple2.c

21 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

23 
	~<löux/öô.h
>

24 
	~<löux/kî√l.h
>

25 
	~<löux/moduÀ.h
>

26 
	~<löux/w‹kqueue.h
>

27 
	~<löux/timî.h
>

28 
	~"../../c⁄víõ¡.h
"

30 
	#OURMODNAME
 "w‹kq_sim∂e2"

	)

31 
	#INITIAL_VALUE
 3

	)

33 
MODULE_AUTHOR
("Kaiwan N Billimoria");

34 
MODULE_DESCRIPTION
("solution: ch5:a LKMÅo demoá workqueue with 2 functions");

35 
MODULE_LICENSE
("Dual MIT/GPL");

36 
MODULE_VERSION
("0.1");

38 
	s°_˘x
 {

39 
w‹k_°ru˘
 
	mw‹k1
;

40 
w‹k_°ru˘
 
	mw‹k2
;

41 
timî_li°
 
	mtmr
;

42 
	md©a
;

43 
u64
 
	mt1s
, 
	mt1e
, 
	mt2s
, 
	mt2e
;

44 } 
	g˘x
;

45 
	gexp_ms
 = 420;

50 
	$dög
(
timî_li°
 *
timî
)

52 
°_˘x
 *
¥iv
 = 
	`‰om_timî
’riv, 
timî
, 
tmr
);

54 
	`¥_debug
("timed out... d©a=%d\n", 
¥iv
->
d©a
--);

55 
	`PRINT_CTX
();

58 i‡(
¥iv
->
d©a
)

59 
	`mod_timî
(&
¥iv
->
tmr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
));

62 i‡(!
	`scheduÀ_w‹k
(&
¥iv
->
w‹k1
))

63 
	`¥_nŸi˚
("work1: our work'sálready onÅhe kernel-global workqueue!\n");

64 
¥iv
->
t1s
 = 
	`ktime_gë_ªÆ_ns
();

65 i‡(!
	`scheduÀ_w‹k
(&
¥iv
->
w‹k2
))

66 
	`¥_nŸi˚
("work2: our work'sálready onÅhe kernel-global workqueue!\n");

67 
¥iv
->
t2s
 = 
	`ktime_gë_ªÆ_ns
();

68 
	}
}

73 
	$w‹k_func1
(
w‹k_°ru˘
 *
w‹k
)

75 
°_˘x
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, °_˘x, 
w‹k1
);

77 
¥iv
->
t1e
 = 
	`ktime_gë_ªÆ_ns
();

78 
	`¥_öfo
("I¿ou∏w‹kq #1 fun˘i⁄: d©a=%d\n", 
¥iv
->
d©a
);

79 
	`PRINT_CTX
();

80 
	`SHOW_DELTA
(
¥iv
->
t1e
,Öriv->
t1s
);

81 
	}
}

85 
	$w‹k_func2
(
w‹k_°ru˘
 *
w‹k
)

87 
°_˘x
 *
¥iv
 = 
	`c⁄èöî_of
(
w‹k
, °_˘x, 
w‹k2
);

89 
¥iv
->
t2e
 = 
	`ktime_gë_ªÆ_ns
();

90 
	`¥_öfo
("I¿ou∏w‹kq #2 fun˘i⁄: d©a=%d\n", 
¥iv
->
d©a
);

91 
	`PRINT_CTX
();

92 
	`SHOW_DELTA
(
¥iv
->
t2e
,Öriv->
t2s
);

93 
	}
}

95 
__öô
 
	$w‹kq_sim∂e2_öô
()

97 
˘x
.
d©a
 = 
INITIAL_VALUE
;

100 
	`INIT_WORK
(&
˘x
.
w‹k1
, 
w‹k_func1
);

101 
	`INIT_WORK
(&
˘x
.
w‹k2
, 
w‹k_func2
);

104 
˘x
.
tmr
.
expúes
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
);

105 
˘x
.
tmr
.
Êags
 = 0;

106 
	`timî_£tup
(&
˘x
.
tmr
, 
dög
, 0);

108 
	`¥_öfo
("W‹k queuêöôülized,Åimî sëÅÿexpúêö %ld ms\n", 
exp_ms
);

109 
	`add_timî
(&
˘x
.
tmr
);

112 
	}
}

114 
__exô
 
	$w‹kq_sim∂e2_exô
()

117 i‡(
	`ˇn˚l_w‹k_sync
(&
˘x
.
w‹k1
))

118 
	`¥_öfo
("work1: yes,Åhere was indeed someÖending work;Çow done...\n");

119 i‡(
	`ˇn˚l_w‹k_sync
(&
˘x
.
w‹k2
))

120 
	`¥_öfo
("work2: yes,Åhere was indeed someÖending work;Çow done...\n");

125 
	`dñ_timî_sync
(&
˘x
.
tmr
);

126 
	`¥_öfo
("removed\n");

127 
	}
}

129 
moduÀ_öô
(
w‹kq_sim∂e2_öô
);

130 
moduÀ_exô
(
w‹kq_sim∂e2_exô
);

	@Books/Linux-Kernel-Programming/ch11/cpu_affinity/userspc_cpuaffinity.c

20 
	#_GNU_SOURCE


	)

22 
	~<°dio.h
>

23 
	~<°dlib.h
>

24 
	~<°rög.h
>

25 
	~<uni°d.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<sched.h
>

29 
	gnumc‹es
;

31 
ölöe
 
	$¥öt_ruÀr
(
Àn
)

33 
i
;

35 
	`¥ötf
(" +");

36 
i
=1; i<=
Àn
*3; i++) {

37 i‡((
i
%3) == 0)

38 
	`¥ötf
("+");

40 
	`¥ötf
("-");

42 
	`¥ötf
("\n");

43 
	}
}

50 
	$di•_˝umask
(
pid_t
 
pid
, 
˝u_£t_t
 *
˝umask
, 
nc‹es
)

52 
i
;

53 
tmpbuf
[128];

55 
	`¥ötf
("CPUáfföôy mask f‹ PID %d:\n", 
pid
);

56 
	`¢¥ötf
(
tmpbuf
, 127, "p†-A |awk '$1 =%d {¥öà$0}'", 
pid
);

57 i‡(
	`sy°em
(
tmpbuf
) == -1)

58 
	`Ârötf
(
°dîr
, "Warning: %s():system(3) (to showÖs output)"

59 " faûed\n", 
__func__
);

61 
	`¥öt_ruÀr
(
nc‹es
);

63 
	`¥ötf
("core# |");

64 
i
=
nc‹es
-1; i>=0; i--)

65 
	`¥ötf
("%2d|", 
i
);

66 
	`¥ötf
("\n");

67 
	`¥öt_ruÀr
(
nc‹es
);

69 
	`¥ötf
("cpumask|");

70 
i
=
nc‹es
-1; i>=0; i--)

71 
	`¥ötf
("%2u|", 
	`CPU_ISSET
(
i
, 
˝umask
));

72 
	`¥ötf
("\n");

73 
	`¥öt_ruÀr
(
nc‹es
);

74 
	}
}

76 
	$quîy_˝u_afföôy
(
pid_t
 
pid
)

78 
˝u_£t_t
 
˝umask
;

80 
	`CPU_ZERO
(&
˝umask
);

81 i‡(
	`sched_gëafföôy
(
pid
, (
˝u_£t_t
), &
˝umask
) < 0) {

82 
	`≥º‹
("sched_getaffinity() failed");

85 
	`di•_˝umask
(
pid
, &
˝umask
, 
numc‹es
);

88 
	}
}

90 
	$£t_˝u_afföôy
(
pid_t
 
pid
, 
bômask
)

92 
˝u_£t_t
 
˝umask
;

93 
i
;

95 
	`¥ötf
("\nSëtög CPUáfföôy mask f‹ PID %dÇow...\n", 
pid
);

96 
	`CPU_ZERO
(&
˝umask
);

99 
i
=0; i<()*8; i++) {

101 i‡((
bômask
 >> 
i
) & 1)

102 
	`CPU_SET
(
i
, &
˝umask
);

105 i‡(
	`sched_£èfföôy
(
pid
, (
˝u_£t_t
), &
˝umask
) < 0) {

106 
	`≥º‹
("sched_setaffinity() failed");

109 
	`di•_˝umask
(
pid
, &
˝umask
, 
numc‹es
);

112 
	}
}

114 
	$maö
 (
¨gc
, **
¨gv
)

116 
FILE
 *
Â
;

117 
s
[9];

118 
pid_t
 
pid
 = 
	`gëpid
();

119 
√w_˝umask
 = 0x0;

121 i‡(
¨gc
 > 1 &&

122 ((!
	`°∫cmp
(
¨gv
[1], "--help", 6)) || (!strncmp(argv[1], "-h", 2)))) {

123 
	`Ârötf
(
°dîr
, "Usage: %s [PID] [new-CPU-mask]\n"

126 "Çew-CPU-mask i†∑s£d)\n", 
¨gv
[0]);

127 
	`exô
(
EXIT_SUCCESS
);

130 
Â
 = 
	`p›í
("nproc", "r");

131 i‡(!
Â
) {

132 
	`Ârötf
(
°dîr
, "%s:Ö›í faûed; c™'àdëe˘ # c‹es,áb‹tög...\n", 
¨gv
[0]);

133 
	`exô
(
EXIT_FAILURE
);

135 i‡(!
	`fgës
(
s
, (s), 
Â
)) {

136 
	`Ârötf
(
°dîr
, "%s: fgë†ÁûedÅÿªad d©a; c™'àdëe˘ # c‹es,áb‹tög...\n", 
¨gv
[0]);

137 
	`exô
(
EXIT_FAILURE
);

139 
numc‹es
 = 
	`©oi
(
s
);

140 
	`¥ötf
("Dëe˘ed %d CPU c‹e†[f‹Åhi†¥o˚s†%s:%d]\n", 
numc‹es
, 
¨gv
[0], 
	`gëpid
());

142 i‡(
¨gc
 >= 2)

143 
pid
 = 
	`©oi
(
¨gv
[1]);

145 
	`quîy_˝u_afföôy
(
pid
);

146 i‡(
¨gc
 == 3) {

147 
√w_˝umask
 = 
	`°πoul
(
¨gv
[2], 0, 0);

148 
	`£t_˝u_afföôy
(
pid
, 
√w_˝umask
);

151 
	`exô
(
EXIT_SUCCESS
);

152 
	}
}

	@Books/Linux-Kernel-Programming/ch12/1_miscdrv_rdwr_mutexlock/miscdrv_rdwr_mutexlock.c

24 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

26 
	~<löux/öô.h
>

27 
	~<löux/moduÀ.h
>

28 
	~<löux/miscdevi˚.h
>

29 
	~<löux/¶ab.h
>

30 
	~<löux/mm.h
>

31 
	~<löux/fs.h
>

34 
	~<löux/vîsi⁄.h
>

35 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

36 
	~<löux/uac˚ss.h
>

38 
	~<asm/uac˚ss.h
>

41 
	~<löux/muãx.h
>

42 
	~"../../c⁄víõ¡.h
"

44 
	#OURMODNAME
 "miscdrv_rdwr_muãxlock"

	)

46 
MODULE_AUTHOR
("Kaiwan N Billimoria");

47 
	gMODULE_DESCRIPTION


49 
MODULE_LICENSE
("Dual MIT/GPL");

50 
MODULE_VERSION
("0.1");

52 
	gga
, 
	ggb
 = 1;

53 
DEFINE_MUTEX
(
lock1
);

59 
	sdrv_˘x
 {

60 
devi˚
 *
	mdev
;

61 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
;

62 
u32
 
	mc⁄fig1
, 
	mc⁄fig2
;

63 
u64
 
	mc⁄fig3
;

64 
	#MAXBYTES
 128

	)

65 
	mour£¸ë
[
MAXBYTES
];

66 
muãx
 
	mlock
;

68 
drv_˘x
 *
	g˘x
;

79 
	$›í_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

81 
devi˚
 *
dev
 = 
˘x
->dev;

83 
	`PRINT_CTX
();

85 
	`muãx_lock
(&
lock1
);

86 
ga
++; 
gb
--;

87 
	`muãx_u∆ock
(&
lock1
);

89 
	`dev_öfo
(
dev
, " filename: \"%s\"\n"

91 " g®%d, gb = %d\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
, fûp->
f_Êags
, 
ga
, 
gb
);

94 
	}
}

105 
ssize_t
 
	$ªad_miscdrv_rdwr
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

106 
size_t
 
cou¡
, 
loff_t
 *
off
)

108 
ªt
 = 
cou¡
, 
£¸ë_Àn
;

109 
devi˚
 *
dev
 = 
˘x
->dev;

111 
	`muãx_lock
(&
˘x
->
lock
);

112 
£¸ë_Àn
 = 
	`°æí
(
˘x
->
our£¸ë
);

113 
	`muãx_u∆ock
(&
˘x
->
lock
);

115 
	`PRINT_CTX
();

116 
	`dev_öfo
(
dev
, "%†w™t†tÿªad (u±oË%zu byãs\n", 
cuºít
->
comm
, 
cou¡
);

118 
ªt
 = -
EINVAL
;

119 i‡(
cou¡
 < 
MAXBYTES
) {

120 
	`dev_w¨n
(
dev
, "request # of bytes (%zu) is <Ñequired size"

121 " (%d),áb‹tögÑód\n", 
cou¡
, 
MAXBYTES
);

122 
out_nŸok
;

124 i‡(
£¸ë_Àn
 <= 0) {

125 
	`dev_w¨n
(
dev
, "whoops, something's wrong,Åhe 'secret' isn't"

127 
out_nŸok
;

141 
ªt
 = -
EFAULT
;

142 
	`muãx_lock
(&
˘x
->
lock
);

143 i‡(
	`c›y_to_u£r
(
ubuf
, 
˘x
->
our£¸ë
, 
£¸ë_Àn
)) {

144 
	`dev_w¨n
(
dev
, "copy_to_user() failed\n");

145 
out_˘u
;

147 
ªt
 = 
£¸ë_Àn
;

150 
˘x
->
tx
 +
£¸ë_Àn
;

151 
	`dev_öfo
(
dev
, " %d bytesÑead,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

152 
£¸ë_Àn
, 
˘x
->
tx
, ctx->
rx
);

153 
out_˘u
:

154 
	`muãx_u∆ock
(&
˘x
->
lock
);

155 
out_nŸok
:

156  
ªt
;

157 
	}
}

168 
ssize_t
 
	$wrôe_miscdrv_rdwr
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

169 
size_t
 
cou¡
, 
loff_t
 *
off
)

171 
ªt
;

172 *
kbuf
 = 
NULL
;

173 
devi˚
 *
dev
 = 
˘x
->dev;

175 
	`PRINT_CTX
();

176 
	`dev_öfo
(
dev
, "%†w™t†tÿwrôê%zu byãs\n", 
cuºít
->
comm
, 
cou¡
);

178 
ªt
 = -
ENOMEM
;

179 
kbuf
 = 
	`kvmÆloc
(
cou¡
, 
GFP_KERNEL
);

180 i‡(
	`u∆ikñy
(!
kbuf
)) {

181 
	`dev_w¨n
(
dev
, "kvmalloc() failed!\n");

182 
out_nomem
;

184 
	`mem£t
(
kbuf
, 0, 
cou¡
);

193 
ªt
 = -
EFAULT
;

194 i‡(
	`c›y_‰om_u£r
(
kbuf
, 
ubuf
, 
cou¡
)) {

195 
	`dev_w¨n
(
dev
, "copy_from_user() failed\n");

196 
out_cfu
;

205 
	`muãx_lock
(&
˘x
->
lock
);

206 
	`°rs˝y
(
˘x
->
our£¸ë
, 
kbuf
, (
cou¡
 > 
MAXBYTES
 ? MAXBYTES : count));

208 
	`¥öt_hex_dump_byãs
("˘x ", 
DUMP_PREFIX_OFFSET
, 
˘x
, (
drv_˘x
));

211 
˘x
->
rx
 +
cou¡
;

213 
ªt
 = 
cou¡
;

214 
	`dev_öfo
(
dev
, " %zu bytes written,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

215 
cou¡
, 
˘x
->
tx
, ctx->
rx
);

216 
	`muãx_u∆ock
(&
˘x
->
lock
);

218 
out_cfu
:

219 
	`kv‰ì
(
kbuf
);

220 
out_nomem
:

221  
ªt
;

222 
	}
}

230 
	$˛o£_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

232 
devi˚
 *
dev
 = 
˘x
->dev;

234 
	`PRINT_CTX
();

236 
	`muãx_lock
(&
lock1
);

237 
ga
--; 
gb
++;

238 
	`muãx_u∆ock
(&
lock1
);

240 
	`dev_öfo
(
dev
, "filename: \"%s\"\n ga = %d, gb = %d\n",

241 
fûp
->
f_∑th
.
díåy
->
d_öame
, 
ga
, 
gb
);

244 
	}
}

247 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

248 .
›í
 = 
›í_miscdrv_rdwr
,

249 .
	gªad
 = 
ªad_miscdrv_rdwr
,

250 .
	gwrôe
 = 
wrôe_miscdrv_rdwr
,

251 .
	gŒ£ek
 = 
no_Œ£ek
,

252 .
	gªÀa£
 = 
˛o£_miscdrv_rdwr
,

263 
miscdevi˚
 
	gŒkd_miscdev
 = {

264 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

265 .
	g«me
 = "llkd_miscdrv_rdwr_mutexlock",

267 .
	gmode
 = 0666,

268 .
	gf›s
 = &
Œkd_misc_f›s
,

271 
__öô
 
	$miscdrv_öô_muãxlock
()

273 
ªt
;

275 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

276 i‡(
ªt
 < 0) {

277 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

278  
ªt
;

280 
	`¥_öfo
("LLKD misc driver (major # 10)Ñegistered, minor# = %d,"

281 " devÇodêi†/dev/%s", 
Œkd_miscdev
.
mö‹
,Ülkd_miscdev.
«me
);

289 
˘x
 = 
	`kzÆloc
((
drv_˘x
), 
GFP_KERNEL
);

290 i‡(
	`u∆ikñy
(!
˘x
))

291  -
ENOMEM
;

293 
	`muãx_öô
(&
˘x
->
lock
);

296 
˘x
->
dev
 = 
Œkd_miscdev
.
this_devi˚
;

299 
	`°rs˝y
(
˘x
->
our£¸ë
, "initmsg", 8);

308 
	`dev_dbg
(
˘x
->
dev
, "A sampleÖrint viaÅhe dev_dbg(): driver initialized\n");

310 
	}
}

312 
__exô
 
	$miscdrv_exô_muãxlock
()

314 
	`muãx_de°roy
(&
lock1
);

315 
	`muãx_de°roy
(&
˘x
->
lock
);

316 
	`misc_dîegi°î
(&
Œkd_miscdev
);

317 
	`¥_öfo
("LLKD mis¯drivî %†dîegi°îed, bye\n", 
Œkd_miscdev
.
«me
);

318 
	}
}

320 
moduÀ_öô
(
miscdrv_öô_muãxlock
);

321 
moduÀ_exô
(
miscdrv_exô_muãxlock
);

	@Books/Linux-Kernel-Programming/ch12/2_miscdrv_rdwr_spinlock/miscdrv_rdwr_spinlock.c

22 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

24 
	~<löux/öô.h
>

25 
	~<löux/moduÀ.h
>

26 
	~<löux/miscdevi˚.h
>

27 
	~<löux/¶ab.h
>

28 
	~<löux/mm.h
>

29 
	~<löux/fs.h
>

32 
	~<löux/vîsi⁄.h
>

33 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

34 
	~<löux/uac˚ss.h
>

36 
	~<asm/uac˚ss.h
>

39 
	~<löux/muãx.h
>

40 
	~<löux/•ölock.h
>

41 
	~"../../c⁄víõ¡.h
"

43 
	#OURMODNAME
 "miscdrv_rdwr_•ölock"

	)

45 
MODULE_AUTHOR
("Kaiwan N Billimoria");

46 
MODULE_DESCRIPTION
(

48 
MODULE_LICENSE
("Dual MIT/GPL");

49 
MODULE_VERSION
("0.1");

51 
	gbuggy
;

52 
moduÀ_∑øm
(
buggy
, , 0600);

53 
MODULE_PARM_DESC
(
buggy
,

56 
	gga
, 
	ggb
 = 1;

57 
DEFINE_SPINLOCK
(
lock1
);

62 
	sdrv_˘x
 {

63 
devi˚
 *
	mdev
;

64 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
;

65 
u32
 
	mc⁄fig1
, 
	mc⁄fig2
;

66 
u64
 
	mc⁄fig3
;

67 
	#MAXBYTES
 128

	)

68 
	mour£¸ë
[
MAXBYTES
];

69 
muãx
 
	mmuãx
;

70 
•ölock_t
 
	m•ölock
;

72 
drv_˘x
 *
	g˘x
;

74 
ölöe
 
	$di•œy_°©s
(
show_°©s
)

76 
devi˚
 *
dev
 = 
˘x
->dev;

78 i‡(1 =
show_°©s
) {

79 
	`•ö_lock
(&
˘x
->
•ölock
);

80 
	`dev_öfo
(
dev
, "°©s:Åx=%d,Ñx=%d\n", 
˘x
->
tx
, ctx->
rx
);

81 
	`•ö_u∆ock
(&
˘x
->
•ölock
);

83 
	}
}

94 
	$›í_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

96 
devi˚
 *
dev
 = 
˘x
->dev;

98 
	`PRINT_CTX
();

100 
	`•ö_lock
(&
lock1
);

101 
ga
++; 
gb
--;

102 
	`•ö_u∆ock
(&
lock1
);

104 
	`dev_öfo
(
dev
, " filename: \"%s\"\n"

106 " g®%d, gb = %d\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
, fûp->
f_Êags
, 
ga
, 
gb
);

108 
	`di•œy_°©s
(1);

110 
	}
}

121 
ssize_t
 
	$ªad_miscdrv_rdwr
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

122 
size_t
 
cou¡
, 
loff_t
 *
off
)

124 
ªt
 = 
cou¡
, 
£¸ë_Àn
, 
îr_∑th
 = 0;

125 
devi˚
 *
dev
 = 
˘x
->dev;

127 
	`•ö_lock
(&
˘x
->
•ölock
);

128 
£¸ë_Àn
 = 
	`°æí
(
˘x
->
our£¸ë
);

129 
	`•ö_u∆ock
(&
˘x
->
•ölock
);

131 
	`PRINT_CTX
();

132 
	`dev_öfo
(
dev
, "%†w™t†tÿªad (u±oË%zu byãs\n", 
cuºít
->
comm
, 
cou¡
);

134 
ªt
 = -
EINVAL
;

135 i‡(
cou¡
 < 
MAXBYTES
) {

136 
	`dev_w¨n
(
dev
, "request # of bytes (%zu) is <Ñequired size"

137 " (%d),áb‹tögÑód\n", 
cou¡
, 
MAXBYTES
);

138 
îr_∑th
 = 1;

139 
out_nŸok
;

141 i‡(
£¸ë_Àn
 <= 0) {

142 
	`dev_w¨n
(
dev
, "whoops, something's wrong,Åhe 'secret' isn't"

144 
îr_∑th
 = 1;

145 
out_nŸok
;

159 
ªt
 = -
EFAULT
;

160 
	`muãx_lock
(&
˘x
->
muãx
);

167 i‡(
	`c›y_to_u£r
(
ubuf
, 
˘x
->
our£¸ë
, 
£¸ë_Àn
)) {

168 
	`dev_w¨n
(
dev
, "copy_to_user() failed\n");

169 
îr_∑th
 = 1;

170 
out_˘u
;

172 
ªt
 = 
£¸ë_Àn
;

175 
˘x
->
tx
 +
£¸ë_Àn
;

176 
	`dev_öfo
(
dev
, " %d bytesÑead,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

177 
£¸ë_Àn
, 
˘x
->
tx
, ctx->
rx
);

178 
out_˘u
:

179 
	`muãx_u∆ock
(&
˘x
->
muãx
);

180 
	`di•œy_°©s
(
îr_∑th
);

181 
out_nŸok
:

182  
ªt
;

183 
	}
}

194 
ssize_t
 
	$wrôe_miscdrv_rdwr
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

195 
size_t
 
cou¡
, 
loff_t
 *
off
)

197 
ªt
, 
îr_∑th
 = 0;

198 *
kbuf
 = 
NULL
;

199 
devi˚
 *
dev
 = 
˘x
->dev;

201 
	`PRINT_CTX
();

202 
	`dev_öfo
(
dev
, "%†w™t†tÿwrôê%zu byãs\n", 
cuºít
->
comm
, 
cou¡
);

204 
ªt
 = -
ENOMEM
;

205 
kbuf
 = 
	`kvmÆloc
(
cou¡
, 
GFP_KERNEL
);

206 i‡(
	`u∆ikñy
(!
kbuf
)) {

207 
	`dev_w¨n
(
dev
, "kvmalloc() failed!\n");

208 
îr_∑th
 = 1;

209 
out_nomem
;

211 
	`mem£t
(
kbuf
, 0, 
cou¡
);

220 
ªt
 = -
EFAULT
;

221 i‡(
	`c›y_‰om_u£r
(
kbuf
, 
ubuf
, 
cou¡
)) {

222 
	`dev_w¨n
(
dev
, "copy_from_user() failed\n");

223 
îr_∑th
 = 1;

224 
out_cfu
;

233 
	`•ö_lock
(&
˘x
->
•ölock
);

234 
	`°rs˝y
(
˘x
->
our£¸ë
, 
kbuf
, (
cou¡
 > 
MAXBYTES
 ? MAXBYTES : count));

236 
	`¥öt_hex_dump_byãs
("˘x ", 
DUMP_PREFIX_OFFSET
,

237 
˘x
, (
drv_˘x
));

240 
˘x
->
rx
 +
cou¡
;

242 
ªt
 = 
cou¡
;

243 
	`dev_öfo
(
dev
, " %zu bytes written,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

244 
cou¡
, 
˘x
->
tx
, ctx->
rx
);

246 i‡(1 =
buggy
) {

248 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

249 
	`scheduÀ_timeout
(1*
HZ
);

253 
	`•ö_u∆ock
(&
˘x
->
•ölock
);

254 
out_cfu
:

255 
	`kv‰ì
(
kbuf
);

256 
	`di•œy_°©s
(
îr_∑th
);

257 
out_nomem
:

258  
ªt
;

259 
	}
}

267 
	$˛o£_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

269 
devi˚
 *
dev
 = 
˘x
->dev;

271 
	`PRINT_CTX
();

273 
	`•ö_lock
(&
lock1
);

274 
ga
--; 
gb
++;

275 
	`•ö_u∆ock
(&
lock1
);

277 
	`dev_öfo
(
dev
, "filename: \"%s\"\n ga = %d, gb = %d\n",

278 
fûp
->
f_∑th
.
díåy
->
d_öame
, 
ga
, 
gb
);

279 
	`di•œy_°©s
(1);

282 
	}
}

285 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

286 .
›í
 = 
›í_miscdrv_rdwr
,

287 .
	gªad
 = 
ªad_miscdrv_rdwr
,

288 .
	gwrôe
 = 
wrôe_miscdrv_rdwr
,

289 .
	gŒ£ek
 = 
no_Œ£ek
,

290 .
	gªÀa£
 = 
˛o£_miscdrv_rdwr
,

301 
miscdevi˚
 
	gŒkd_miscdev
 = {

302 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

303 .
	g«me
 = "llkd_miscdrv_rdwr_spinlock",

305 .
	gmode
 = 0666,

306 .
	gf›s
 = &
Œkd_misc_f›s
,

309 
__öô
 
	$miscdrv_öô_•ölock
()

311 
ªt
;

313 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

314 i‡(
ªt
 < 0) {

315 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

316  
ªt
;

318 
	`¥_öfo
("LLKD misc driver (major # 10)Ñegistered, minor# = %d,"

319 " devÇodêi†%s\n", 
Œkd_miscdev
.
mö‹
,Ülkd_miscdev.
«me
);

327 
˘x
 = 
	`kzÆloc
((
drv_˘x
), 
GFP_KERNEL
);

328 i‡(
	`u∆ikñy
(!
˘x
))

329  -
ENOMEM
;

331 
	`muãx_öô
(&
˘x
->
muãx
);

332 
	`•ö_lock_öô
(&
˘x
->
•ölock
);

335 
˘x
->
dev
 = 
Œkd_miscdev
.
this_devi˚
;

337 
	`°rs˝y
(
˘x
->
our£¸ë
, "initmsg", 8);

346 
	`dev_dbg
(
˘x
->
dev
, "A sampleÖrint viaÅhe dev_dbg(): driver initialized\n");

348 
	}
}

350 
__exô
 
	$miscdrv_exô_•ölock
()

352 
	`muãx_de°roy
(&
˘x
->
muãx
);

353 
	`misc_dîegi°î
(&
Œkd_miscdev
);

354 
	`¥_öfo
("LLKD mis¯drivî %†dîegi°îed, bye\n", 
Œkd_miscdev
.
«me
);

355 
	}
}

357 
moduÀ_öô
(
miscdrv_öô_•ölock
);

358 
moduÀ_exô
(
miscdrv_exô_•ölock
);

	@Books/Linux-Kernel-Programming/ch13/1_rmw_atomic_bitops/rmw_atomic_bitops.c

21 
	~<löux/öô.h
>

22 
	~<löux/moduÀ.h
>

23 
	~<löux/•ölock.h
>

24 
	~<löux/©omic.h
>

25 
	~<löux/bô›s.h
>

26 
	~"../../c⁄víõ¡.h
"

28 
	#OURMODNAME
 "2_rmw_©omic_bô›s"

	)

30 
MODULE_AUTHOR
("Kaiwan N Billimoria");

31 
MODULE_DESCRIPTION
(

33 
MODULE_LICENSE
("Dual MIT/GPL");

34 
MODULE_VERSION
("0.1");

36 
	#SHOW
(
n
, 
p
, 
msg
) do { \

37 
	`¥_öfo
("%2d:%27s: mem : %3ld = 0x%02lx\n", 
n
, 
msg
, 
p
,Ö); \

38 } 0)

	)

40 
	gmem
;

41 
u64
 
	gt1
, 
	gt2
;

42 
	gMSB
 = 
BITS_PER_BYTE
 - 1;

43 
DEFINE_SPINLOCK
(
¶ock
);

46 
ölöe
 
	$£tmsb_›timÆ
(
i
)

48 
t1
 = 
	`ktime_gë_ªÆ_ns
();

49 
	`£t_bô
(
MSB
, &
mem
);

50 
t2
 = 
	`ktime_gë_ªÆ_ns
();

51 
	`SHOW
(
i
, 
mem
, "set_bit(7,&mem)");

52 
	`SHOW_DELTA
(
t2
, 
t1
);

53 
	}
}

57 
ölöe
 
	$£tmsb_sub›timÆ
(
i
)

59 
u8
 
tmp
;

61 
t1
 = 
	`ktime_gë_ªÆ_ns
();

62 
	`•ö_lock
(&
¶ock
);

64 
tmp
 = 
mem
;

65 
tmp
 |= 0x80;

66 
mem
 = 
tmp
;

67 
	`•ö_u∆ock
(&
¶ock
);

68 
t2
 = 
	`ktime_gë_ªÆ_ns
();

70 
	`SHOW
(
i
, 
mem
, "set msb suboptimal: 7,&mem");

71 
	`SHOW_DELTA
(
t2
, 
t1
);

72 
	}
}

74 
__öô
 
	$©omic_rmw_bô›s_öô
()

76 
i
 = 1, 
ªt
;

78 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

80 
	`SHOW
(
i
++, 
mem
, "at init");

82 
	`£tmsb_›timÆ
(
i
++);

83 
	`£tmsb_sub›timÆ
(
i
++);

85 
	`˛ór_bô
(
MSB
, &
mem
);

86 
	`SHOW
(
i
++, 
mem
, "clear_bit(7,&mem)");

88 
	`ch™ge_bô
(
MSB
, &
mem
);

89 
	`SHOW
(
i
++, 
mem
, "change_bit(7,&mem)");

91 
ªt
 = 
	`ã°_™d_£t_bô
(0, &
mem
);

92 
	`SHOW
(
i
++, 
mem
, "test_and_set_bit(0,&mem)");

93 
	`¥_öfo
("Ñë = %d\n", 
ªt
);

95 
ªt
 = 
	`ã°_™d_˛ór_bô
(0, &
mem
);

96 
	`SHOW
(
i
++, 
mem
, "test_and_clear_bit(0,&mem)");

97 
	`¥_öfo
("Ñë (¥ev vÆuêo‡bô 0Ë%d\n", 
ªt
);

99 
ªt
 = 
	`ã°_™d_ch™ge_bô
(1, &
mem
);

100 
	`SHOW
(
i
++, 
mem
, "test_and_change_bit(1,&mem)");

101 
	`¥_öfo
("Ñë (¥ev vÆuêo‡bô 1Ë%d\n", 
ªt
);

103 
	`¥_öfo
("%2d:Åe°_bô(%d-0,&mem):\n", 
i
, 
MSB
);

104 
i
 = 
MSB
; i >= 0; i--)

105 
	`¥_öfo
(" bô %d (0x%02lxË: %s\n", 
i
, 
	`BIT
(i), 
	`ã°_bô
(i, &
mem
)?"set":"cleared");

108 
	}
}

110 
__exô
 
	$©omic_rmw_bô›s_exô
()

112 
mem
 = 0x0;

113 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

114 
	}
}

116 
moduÀ_öô
(
©omic_rmw_bô›s_öô
);

117 
moduÀ_exô
(
©omic_rmw_bô›s_exô
);

	@Books/Linux-Kernel-Programming/ch13/2_percpu/percpu_var.c

17 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

19 
	~<löux/öô.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/sched.h
>

22 
	~<löux/sched/èsk.h
>

23 
	~<löux/≥r˝u.h
>

24 
	~<löux/kthªad.h
>

25 
	~<löux/˝umask.h
>

26 
	~<löux/kÆlsyms.h
>

27 
	~<löux/¸ed.h
>

28 
	~<löux/dñay.h
>

29 
	~"../../c⁄víõ¡.h
"

31 
	#OURMODNAME
 "≥r˝u_v¨"

	)

33 
MODULE_AUTHOR
("Kaiwan N Billimoria");

34 
MODULE_DESCRIPTION
("LKP book:ch13/2_percpu: demo of usingÖercpu variables");

35 
MODULE_LICENSE
("Dual MIT/GPL");

36 
MODULE_VERSION
("0.1");

38 
	#SHOW_CPU_CTX
() do { \

39 
	`¥_öfo
("*** kthread PID %d on cpu %dÇow ***\n",\

40 
cuºít
->
pid
, 
	`smp_¥o˚ss‹_id
()); \

41 } 0)

	)

43 
	#MAX_KTHRDS
 2

	)

44 
	#THRD0_ITERS
 3

	)

45 
	#THRD1_ITERS
 3

	)

47 (*
±r_sched_£èfföôy
)(
pid_t
, c⁄° 
˝umask
 *);

48 
èsk_°ru˘
 *
¨r_tsk
[
MAX_KTHRDS
];

52 
	`DEFINE_PER_CPU
(, 
p˝a
);

55 
	sdrv_˘x
 {

56 
tx
, 
rx
;

58 
îr
, 
myw‹d
;

59 
u32
 
c⁄fig1
, 
c⁄fig2
;

60 
u64
 
c⁄fig3
;

61 } *
p˝_˘x
;

64 
ölöe
 
	$di•_v¨s
()

66 
i
, 
vÆ
, 
rx
, 
tx
;

68 
	`PRINT_CTX
();

69 
	`f‹_óch_⁄löe_˝u
(
i
) {

70 
vÆ
 = 
	`≥r_˝u
(
p˝a
, 
i
);

71 
rx
 = 
	`≥r_˝u_±r
(
p˝_˘x
, 
i
)->rx;

72 
tx
 = 
	`≥r_˝u_±r
(
p˝_˘x
, 
i
)->tx;

73 
	`¥_öfo
(" cpu %2d:Öcpa = %+d,Ñx = %5d,Åx = %5d\n",

74 
i
, 
vÆ
, 
rx
, 
tx
);

76 
	}
}

78 
	$£t_˝uafföôy
(
˝u
)

80 
˝umask
 
mask
;

81 
ªt
 = 0;

82 
euid
 = 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_euid
());

83 
¸ed
 *
√w
;

89 i‡(
	`u∆ikñy
(
euid
)) {

90 
	`¥_öfo
("%s(): before commit_creds(): uid=%uÉuid=%u\n",

91 
__func__
, 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_uid
()),

92 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_euid
()));

94 
√w
 = 
	`¥ï¨e_¸eds
();

95 i‡(!
√w
)

96  -
ENOMEM
;

98 
√w
->
fsuid
 =Çew->
uid
 =Çew->
euid
 = 
	`make_kuid
(
	`cuºít_u£r_ns
(), 0);

99 i‡(!
	`uid_vÆid
(
√w
->
uid
))

101 
	`commô_¸eds
(
√w
);

102 
	`¥_öfo
("after commit_creds(): uid=%uÉuid=%u\n",

103 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_uid
()),

104 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_euid
()));

108 
	`˝umask_˛ór
(&
mask
);

109 
	`˝umask_£t_˝u
(
˝u
, &
mask
);

113 
ªt
 = (*
±r_sched_£èfföôy
)(0, &
mask
);

115  
ªt
;

116 
	}
}

119 
	$thrd_w‹k
(*
¨g
)

121 
i
, 
vÆ
;

122 
thrd
 = ()
¨g
;

123 
drv_˘x
 *
˘x
;

125 i‡(
thrd
 != 0 &&Åhrd != 1) {

126 
	`¥_îr
("'thrd' vÆuêövÆid (thrd=%ld)\n", 
thrd
);

127  -
EINVAL
;

131 i‡(
	`£t_˝uafföôy
(
thrd
) < 0) {

132 
	`¥_îr
("£âög cpuáfföôy mask f‹ ou∏kthªad %ld faûed\n", 
thrd
);

133  -
ENOSYS
;

135 
	`SHOW_CPU_CTX
();

137 i‡(
thrd
 == 0) {

138 
i
=0; i<
THRD0_ITERS
; i++) {

140 
vÆ
 = ++ 
	`gë_˝u_v¨
(
p˝a
);

141 
	`¥_öfo
("Åhrd_0/˝u0:Ö˝®%+d\n", 
vÆ
);

142 
	`put_˝u_v¨
(
p˝a
);

145 
˘x
 = 
	`gë_˝u_±r
(
p˝_˘x
);

146 
˘x
->
tx
 += 100;

147 
	`¥_öfo
("Åhrd_0/cpu0:Öcp ctx:Åx = %5d,Ñx = %5d\n",

148 
˘x
->
tx
, ctx->
rx
);

149 
	`put_˝u_±r
(
p˝_˘x
);

151 } i‡(
thrd
 == 1) {

152 
i
=0; i<
THRD1_ITERS
; i++) {

154 
vÆ
 = -- 
	`gë_˝u_v¨
(
p˝a
);

155 
	`¥_öfo
("Åhrd_1/˝u1:Ö˝®%+d\n", 
vÆ
);

156 
	`put_˝u_v¨
(
p˝a
);

159 
˘x
 = 
	`gë_˝u_±r
(
p˝_˘x
);

160 
˘x
->
rx
 += 200;

161 
	`¥_öfo
("Åhrd_1/cpu1:Öcp ctx:Åx = %5d,Ñx = %5d\n",

162 
˘x
->
tx
, ctx->
rx
);

163 
	`put_˝u_±r
(
p˝_˘x
);

167 
	`di•_v¨s
();

168 
	`¥_öfo
("Ou∏kî√»thªad #%ldÉxôögÇow...\n", 
thrd
);

170 
	}
}

178 
	$run_kthrd
(*
k«me
, 
thrdnum
)

181 
¨r_tsk
[
thrdnum
] = 
	`kthªad_run
(
thrd_w‹k
, (*)thrdnum,

182 "%s/%ld", 
k«me
, 
thrdnum
);

183 i‡(!
¨r_tsk
[
thrdnum
]) {

184 
	`¥_îr
(" kthªad_run(Ëf‹ ou∏kthªad %ld faûed\n", 
thrdnum
);

187 
	`gë_èsk_°ru˘
(
¨r_tsk
[
thrdnum
]);

191 
	}
}

193 
__öô
 
	$öô_≥r˝u_v¨
()

195 
ªt
 = 0;

197 
	`¥_öfo
("inserted\n");

207 
ªt
 = -
ENOSYS
;

208 
±r_sched_£èfföôy
 = (*)
	`kÆlsyms_lookup_«me
("sched_setaffinity");

209 i‡(!
±r_sched_£èfföôy
) {

210 
	`¥_w¨n
("%s: couldn't obtain sched_setaffinity()áddr via "

211 "kÆlsyms_lookup_«me(),áb‹tög ...\n", 
OURMODNAME
);

212  
ªt
;

216 
ªt
 = -
ENOMEM
;

217 
p˝_˘x
 = (
drv_˘x
 
__≥r˝u
 *Ë
	`Æloc_≥r˝u
(drv_ctx);

218 i‡(!
p˝_˘x
) {

219 
	`¥_öfo
("alloc_percpu() failed,áborting...\n");

220 
out1
;

224 
ªt
 = -
ENOMEM
;

225 i‡(
	`run_kthrd
("thrd_0", 0) < 0) {

226 
	`¥_öfo
("kthreadÅhrd #0Çot created,áborting...\n");

227 
out2
;

229 i‡(
	`run_kthrd
("thrd_1", 1) < 0) {

230 
	`¥_öfo
("kthreadÅhrd #1Çot created,áborting...\n");

231 
out3
;

236 
out3
:

237 
	`kthªad_°›
(
¨r_tsk
[0]);

238 
out2
:

239 
	`‰ì_≥r˝u
(
p˝_˘x
);

240 
out1
:

241  
ªt
;

242 
	}
}

244 
__exô
 
	$exô_≥r˝u_v¨
()

246 
	`kthªad_°›
(
¨r_tsk
[0]);

247 
	`kthªad_°›
(
¨r_tsk
[1]);

248 
	`di•_v¨s
();

249 
	`‰ì_≥r˝u
(
p˝_˘x
);

250 
	`¥_öfo
("removed.\n");

251 
	}
}

253 
moduÀ_öô
(
öô_≥r˝u_v¨
);

254 
moduÀ_exô
(
exô_≥r˝u_v¨
);

	@Books/Linux-Kernel-Programming/ch13/3_lockdep/buggy_thrdshow_eg/thrd_showall_buggy.c

27 
	~<löux/kî√l.h
>

28 
	~<löux/moduÀ.h
>

29 
	~<löux/sched.h
>

30 
	~<löux/vîsi⁄.h
>

31 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 10, 0)

32 
	~<löux/sched/sig«l.h
>

35 
	#OURMODNAME
 "thrd_showÆl_buggy"

	)

37 
MODULE_AUTHOR
("Kaiwan N Billimoria");

38 
MODULE_DESCRIPTION
("LKP book: ch13/3_lockdep/buggy_thrdshow_eg:"

40 
MODULE_LICENSE
("Dual MIT/GPL");

41 
MODULE_VERSION
("0.1");

43 
	$showthrds_buggy
()

45 
èsk_°ru˘
 *
g
, *
t
;

46 
ƒ_thrds
 = 1, 
tŸÆ
 = 0;

47 
	#BUFMAX
 256

	)

48 
	#TMPMAX
 128

	)

49 
buf
[
BUFMAX
], 
tmp
[
TMPMAX
], 
èsknm
[
TASK_COMM_LEN
];

50 c⁄° 
hdr
[] =

55 
	`¥_öfo
("%s", 
hdr
);

60 
	`ªad_lock
(&
èskli°_lock
);

62 
	`do_óch_thªad
(
g
, 
t
) {

63 
	`èsk_lock
(
t
);

65 
	`¢¥ötf
(
buf
, 
BUFMAX
-1, "%6d %6d ", 
g
->
tgid
, 
t
->
pid
);

68 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " 0x%px", 
t
);

69 
	`°∫ˇt
(
buf
, 
tmp
, 
TMPMAX
);

70 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " 0x%px", 
t
->
°ack
);

71 
	`°∫ˇt
(
buf
, 
tmp
, 
TMPMAX
);

73 
	`gë_èsk_comm
(
èsknm
, 
t
);

75 i‡(!
g
->
mm
)

76 
	`¢¥ötf
(
tmp
, (
èsknm
)+3, " [%16s]",Åasknm);

78 
	`¢¥ötf
(
tmp
, (
èsknm
)+3, " %16s ",Åasknm);

79 
	`°∫ˇt
(
buf
, 
tmp
, 
TMPMAX
);

88 
ƒ_thrds
 = 
	`gë_ƒ_thªads
(
g
);

89 i‡(
g
->
mm
 && (g->
tgid
 =
t
->
pid
Ë&& (
ƒ_thrds
 > 1)) {

90 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " %3d", 
ƒ_thrds
);

91 
	`°∫ˇt
(
buf
, 
tmp
, 
TMPMAX
);

94 
	`¢¥ötf
(
tmp
, 2, "\n");

95 
	`°∫ˇt
(
buf
, 
tmp
, 2);

96 
	`¥_öfo
("%s", 
buf
);

98 
tŸÆ
++;

99 
	`mem£t
(
buf
, 0, (buf));

100 
	`mem£t
(
tmp
, 0, (tmp));

101 
	`èsk_u∆ock
(
t
);

102 } 
	`whûe_óch_thªad
(
g
, 
t
);

105 
	`ªad_u∆ock
(&
èskli°_lock
);

108  
tŸÆ
;

109 
	}
}

111 
__öô
 
	$thrd_showÆl_buggy_öô
()

113 
tŸÆ
;

115 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

116 
tŸÆ
 = 
	`showthrds_buggy
();

117 
	`¥_öfo
("%s:Åotal # ofÅhreads onÅhe system: %d\n",

118 
OURMODNAME
, 
tŸÆ
);

121 
	}
}

123 
__exô
 
	$thrd_showÆl_buggy_exô
()

125 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

126 
	}
}

128 
moduÀ_öô
(
thrd_showÆl_buggy_öô
);

129 
moduÀ_exô
(
thrd_showÆl_buggy_exô
);

	@Books/Linux-Kernel-Programming/ch13/3_lockdep/deadlock_eg_AB-BA/deadlock_eg_AB-BA.c

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/sched.h
>

23 
	~<löux/sched/èsk.h
>

24 
	~<löux/•ölock.h
>

25 
	~<löux/kthªad.h
>

26 
	~<löux/˝umask.h
>

27 
	~<löux/kÆlsyms.h
>

28 
	~<löux/¸ed.h
>

29 
	~"../../../c⁄víõ¡.h
"

31 
	#OURMODNAME
 "dódlock_eg_AB-BA"

	)

33 
MODULE_AUTHOR
("Kaiwan N Billimoria");

34 
MODULE_DESCRIPTION
("LKP book:ch13/3_lockdep/deadlock_eg_AB-BA: small demo of "

36 
MODULE_LICENSE
("Dual MIT/GPL");

37 
MODULE_VERSION
("0.1");

40 
	glock_ooo
;

41 
moduÀ_∑øm
(
lock_ooo
, , 0644);

42 
MODULE_PARM_DESC
(
lock_ooo
, "setÅo 1ÅoÖerform out-of-order (ooo)Üocking (defaultsÅo 0)");

44 
	#SHOW_CPU_CTX
() do { \

45 
	`¥_öfo
("%s():%d: ***Åhread PID %d on cpu %dÇow ***\n", \

46 
__func__
, 
__LINE__
, 
cuºít
->
pid
, 
	`smp_¥o˚ss‹_id
()); \

47 } 0)

	)

49 
	#MAX_KTHRDS
 2

	)

50 
	#THRD0_ITERS
 1

	)

51 
	#THRD1_ITERS
 1

	)

54 
DEFINE_SPINLOCK
(
lockA
);

55 
DEFINE_SPINLOCK
(
lockB
);

58 (*
±r_sched_£èfföôy
)(
pid_t
, c⁄° 
˝umask
 *);

59 
èsk_°ru˘
 *
¨r_tsk
[
MAX_KTHRDS
];

61 
	$£t_˝uafföôy
(
˝u
)

63 
˝umask
 
mask
;

64 
ªt
 = 0;

65 
euid
 = 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_euid
());

66 
¸ed
 *
√w
;

69 i‡(
	`u∆ikñy
(
euid
)) {

70 
	`¥_öfo
("%s(): before commit_creds(): uid=%uÉuid=%u\n",

71 
__func__
, 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_uid
()),

72 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_euid
()));

74 
√w
 = 
	`¥ï¨e_¸eds
();

75 i‡(!
√w
)

76  -
ENOMEM
;

78 
√w
->
fsuid
 =Çew->
uid
 =Çew->
euid
 = 
	`make_kuid
(
	`cuºít_u£r_ns
(), 0);

79 i‡(!
	`uid_vÆid
(
√w
->
uid
))

81 
	`commô_¸eds
(
√w
);

82 
	`¥_öfo
("%s():áfter commit_creds(): uid=%uÉuid=%u\n",

83 
__func__
, 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_uid
()),

84 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_euid
()));

88 
	`˝umask_˛ór
(&
mask
);

89 
	`˝umask_£t_˝u
(
˝u
, &
mask
);

93 
ªt
 = (*
±r_sched_£èfföôy
)(0, &
mask
);

95  
ªt
;

96 
	}
}

99 
	$thrd_w‹k
(*
¨g
)

101 
i
=0;

102 
thrd
 = ()
¨g
;

104 i‡(
thrd
 != 0 &&Åhrd != 1) {

105 
	`¥_îr
("%s: 'thrd' vÆuêövÆid (thrd=%ld)\n", 
OURMODNAME
, 
thrd
);

106  -
EINVAL
;

110 i‡(
	`£t_˝uafföôy
(
thrd
) < 0) {

111 
	`¥_îr
("%s: setting cpuáffinity mask for our kthread"

112 " %ld faûed\n", 
OURMODNAME
, 
thrd
);

113  -
ENOSYS
;

115 
	`SHOW_CPU_CTX
();

119 i‡(
thrd
 == 0) {

120 
	`¥_öfo
(" Thread #%ld:Üocking: we do:"

121 "ÜockA -->ÜockB\n", 
thrd
);

123 
i
 = 0; i < 
THRD0_ITERS
; i ++) {

126 
	`¥_öfo
(" iãøti⁄ #%d o¿˝u #%ld\n", 
i
, 
thrd
);

128 
	`•ö_lock
(&
lockA
);

129 
	`DELAY_LOOP
('A', 3);

130 
	`•ö_lock
(&
lockB
);

131 
	`DELAY_LOOP
('B', 2);

132 
	`•ö_u∆ock
(&
lockB
);

133 
	`•ö_u∆ock
(&
lockA
);

135 } i‡(
thrd
 == 1) {

137 
i
 = 0; i < 
THRD1_ITERS
; i ++) {

140 
	`¥_öfo
(" iãøti⁄ #%d o¿˝u #%ld\n", 
i
, 
thrd
);

142 i‡(
lock_ooo
 == 1) {

143 
	`¥_öfo
(" Thªad #%ld:Üockög: wêdo:ÜockB -->ÜockA\n",
thrd
);

144 
	`•ö_lock
(&
lockB
);

145 
	`DELAY_LOOP
('B', 2);

146 
	`•ö_lock
(&
lockA
);

147 
	`DELAY_LOOP
('A', 3);

148 
	`•ö_u∆ock
(&
lockA
);

149 
	`•ö_u∆ock
(&
lockB
);

150 } i‡(
lock_ooo
 == 0) {

151 
	`¥_öfo
(" Thªad #%ld:Üockög: wêdo:ÜockA -->ÜockB\n",
thrd
);

152 
	`•ö_lock
(&
lockA
);

153 
	`DELAY_LOOP
('B', 2);

154 
	`•ö_lock
(&
lockB
);

155 
	`DELAY_LOOP
('A', 3);

156 
	`•ö_u∆ock
(&
lockB
);

157 
	`•ö_u∆ock
(&
lockA
);

161 
	`¥_öfo
("Ou∏kî√»thªad #%ldÉxôögÇow...\n", 
thrd
);

162 
	`do_exô
(0);

163 
	}
}

171 
	$run_kthrd
(*
k«me
, 
thrdnum
)

174 
¨r_tsk
[
thrdnum
] = 
	`kthªad_run
(
thrd_w‹k
, (*)thrdnum,

175 "%s/%ld", 
k«me
, 
thrdnum
);

176 i‡(!
¨r_tsk
[
thrdnum
]) {

177 
	`¥_îr
(" kthªad_¸óã(Ëf‹ ou∏kthªad %ld faûed\n", 
thrdnum
);

180 
	`gë_èsk_°ru˘
(
¨r_tsk
[
thrdnum
]);

184 
	}
}

186 
__öô
 
	$dódlock_eg_AB_BA_öô
()

188 
	`¥_öfo
("%s: in£πed (∑øm:Üock_ooo=%d)\n", 
OURMODNAME
, 
lock_ooo
);

203 
±r_sched_£èfföôy
 = (*)
	`kÆlsyms_lookup_«me
("sched_setaffinity");

204 i‡(!
±r_sched_£èfföôy
) {

205 
	`¥_w¨n
("%s: couldn't obtain sched_setaffinity()áddr via "

206 "kÆlsyms_lookup_«me(),áb‹tög ...\n", 
OURMODNAME
);

207  -
ENOSYS
;

211 i‡(
	`run_kthrd
("thrd_0", 0) < 0) {

212 
	`¥_öfo
("%s: kthreadÅhrd #0Çot created,áborting...\n",

213 
OURMODNAME
);

214  -
ENOMEM
;

216 i‡(
	`run_kthrd
("thrd_1", 1) < 0) {

217 
	`¥_öfo
("%s: kthreadÅhrd #1Çot created,áborting...\n",

218 
OURMODNAME
);

219 
	`kthªad_°›
(
¨r_tsk
[0]);

220  -
ENOMEM
;

224 
	}
}

226 
__exô
 
	$dódlock_eg_AB_BA_exô
()

228 
	`kthªad_°›
(
¨r_tsk
[0]);

229 
	`kthªad_°›
(
¨r_tsk
[1]);

230 
	`¥_öfo
("%s:Ñemoved.\n", 
OURMODNAME
);

231 
	}
}

233 
moduÀ_öô
(
dódlock_eg_AB_BA_öô
);

234 
moduÀ_exô
(
dódlock_eg_AB_BA_exô
);

	@Books/Linux-Kernel-Programming/ch13/3_lockdep/fixed_thrdshow_eg/thrd_showall_fixed.c

25 
	~<löux/kî√l.h
>

26 
	~<löux/moduÀ.h
>

27 
	~<löux/sched.h
>

28 
	~<löux/vîsi⁄.h
>

29 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 10, 0)

30 
	~<löux/sched/sig«l.h
>

33 
	#OURMODNAME
 "thrd_showÆl_fixed"

	)

35 
MODULE_AUTHOR
("Kaiwan N Billimoria");

36 
MODULE_DESCRIPTION
("LKP book: ch13/3_lockdep/fixed_thrdshow_eg:"

38 
MODULE_LICENSE
("Dual MIT/GPL");

39 
MODULE_VERSION
("0.1");

41 
	$showthrds_fixed
()

43 
èsk_°ru˘
 *
g
, *
t
;

44 
ƒ_thrds
 = 1, 
tŸÆ
 = 0;

45 
	#BUFMAX
 256

	)

46 
	#TMPMAX
 128

	)

47 
buf
[
BUFMAX
], 
tmp
[
TMPMAX
], 
èsknm
[
TASK_COMM_LEN
];

48 c⁄° 
hdr
[] =

53 
	`¥_öfo
("%s", 
hdr
);

58 
	`ªad_lock
(&
èskli°_lock
);

60 
	`do_óch_thªad
(
g
, 
t
) {

61 
	`èsk_lock
(
t
);

63 
	`¢¥ötf
(
buf
, 
BUFMAX
-1, "%6d %6d ", 
g
->
tgid
, 
t
->
pid
);

66 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " 0x%016lx", ()
t
);

67 
	`°∫ˇt
(
buf
, 
tmp
, 
TMPMAX
);

68 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " 0x%016lx", ()
t
->
°ack
);

69 
	`°∫ˇt
(
buf
, 
tmp
, 
TMPMAX
);

78 
	`èsk_u∆ock
(
t
);

79 
	`gë_èsk_comm
(
èsknm
, 
t
);

80 
	`èsk_lock
(
t
);

82 i‡(!
g
->
mm
)

83 
	`¢¥ötf
(
tmp
, (
èsknm
)+4, " [%16s]",Åasknm);

85 
	`¢¥ötf
(
tmp
, (
èsknm
)+4, " %16s ",Åasknm);

86 
	`°∫ˇt
(
buf
, 
tmp
, 
TMPMAX
);

95 
ƒ_thrds
 = 
	`gë_ƒ_thªads
(
g
);

96 i‡(
g
->
mm
 && (g->
tgid
 =
t
->
pid
Ë&& (
ƒ_thrds
 > 1)) {

97 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " %3d", 
ƒ_thrds
);

98 
	`°∫ˇt
(
buf
, 
tmp
, 
TMPMAX
);

101 
	`¢¥ötf
(
tmp
, 2, "\n");

102 
	`°∫ˇt
(
buf
, 
tmp
, 2);

103 
	`¥_öfo
("%s", 
buf
);

105 
tŸÆ
++;

106 
	`mem£t
(
buf
, 0, (buf));

107 
	`mem£t
(
tmp
, 0, (tmp));

108 
	`èsk_u∆ock
(
t
);

109 } 
	`whûe_óch_thªad
(
g
, 
t
);

112 
	`ªad_u∆ock
(&
èskli°_lock
);

115  
tŸÆ
;

116 
	}
}

118 
__öô
 
	$thrd_showÆl_fixed_öô
()

120 
tŸÆ
;

122 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

123 
tŸÆ
 = 
	`showthrds_fixed
();

124 
	`¥_öfo
("%s:Åotal # ofÅhreads onÅhe system: %d\n",

125 
OURMODNAME
, 
tŸÆ
);

128 
	}
}

130 
__exô
 
	$thrd_showÆl_fixed_exô
()

132 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

133 
	}
}

135 
moduÀ_öô
(
thrd_showÆl_fixed_öô
);

136 
moduÀ_exô
(
thrd_showÆl_fixed_exô
);

	@Books/Linux-Kernel-Programming/ch4/helloworld_lkm/helloworld_lkm.c

20 
	~<löux/öô.h
>

21 
	~<löux/kî√l.h
>

22 
	~<löux/moduÀ.h
>

24 
MODULE_AUTHOR
("<insert yourÇame here>");

25 
MODULE_DESCRIPTION
("LKP book:ch4/helloworld_lkm: hello, world, our first LKM");

26 
MODULE_LICENSE
("Dual MIT/GPL");

27 
MODULE_VERSION
("0.1");

29 
__öô
 
	$hñlow‹ld_lkm_öô
()

31 
	`¥ötk
(
KERN_INFO
 "Hello, world\n");

33 
	}
}

35 
__exô
 
	$hñlow‹ld_lkm_exô
()

37 
	`¥ötk
(
KERN_INFO
 "Goodbye, world\n");

38 
	}
}

40 
moduÀ_öô
(
hñlow‹ld_lkm_öô
);

41 
moduÀ_exô
(
hñlow‹ld_lkm_exô
);

	@Books/Linux-Kernel-Programming/ch4/printk_loglvl/printk_loglvl.c

21 
	~<löux/öô.h
>

22 
	~<löux/moduÀ.h
>

23 
	~<löux/kî√l.h
>

25 
MODULE_AUTHOR
("<insert yourÇame here>");

26 
MODULE_DESCRIPTION
("LKP book:ch4/printk_loglvl:ÖrintátÉach kernelÜogÜevel");

27 
MODULE_LICENSE
("Dual MIT/GPL");

28 
MODULE_VERSION
("0.1");

30 
__öô
 
	$¥ötk_loglvl_öô
()

32 
	`¥_emîg
("Hello, world @Üog-level KERN_EMERG [0]\n");

33 
	`¥_Æît
("Hello, world @Üog-level KERN_ALERT [1]\n");

34 
	`¥_¸ô
("Hello, world @Üog-level KERN_CRIT [2]\n");

35 
	`¥_îr
("Hello, world @Üog-level KERN_ERR [3]\n");

36 
	`¥_w¨n
("Hello, world @Üog-level KERN_WARNING [4]\n");

37 
	`¥_nŸi˚
("Hello, world @Üog-level KERN_NOTICE [5]\n");

38 
	`¥_öfo
("Hello, world @Üog-level KERN_INFO [6]\n");

39 
	`¥_debug
("Hello, world @Üog-level KERN_DEBUG [7]\n");

40 
	`¥_devñ
("Hello, world viaÅheÖr_devel() macro"

44 
	}
}

46 
__exô
 
	$¥ötk_loglvl_exô
()

48 
	`¥_öfo
("Goodbye, world @Üog-level KERN_INFO [6]\n");

49 
	}
}

51 
moduÀ_öô
(
¥ötk_loglvl_öô
);

52 
moduÀ_exô
(
¥ötk_loglvl_exô
);

	@Books/Linux-Kernel-Programming/ch5/cross/helloworld_lkm.c

24 
	~<löux/öô.h
>

25 
	~<löux/moduÀ.h
>

26 
	~<löux/kî√l.h
>

28 
MODULE_AUTHOR
("Kaiwan N Billimoria");

29 
MODULE_DESCRIPTION
("LKP book:ch5/cross: hello, world, our first Raspberry Pi LKM");

30 
MODULE_LICENSE
("Dual MIT/GPL");

31 
MODULE_VERSION
("0.1");

33 
__öô
 
	$hñlo_LLKD_öô
()

35 
	`¥_öfo
("Hello, Raspberry Pi world\n");

37 
	}
}

39 
__exô
 
	$hñlo_LLKD_exô
()

41 
	`¥_öfo
("Goodbye, Raspberry Pi world\n");

42 
	}
}

44 
moduÀ_öô
(
hñlo_LLKD_öô
);

45 
moduÀ_exô
(
hñlo_LLKD_exô
);

	@Books/Linux-Kernel-Programming/ch5/fp_in_lkm/fp_in_lkm.c

19 
	~<löux/öô.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/kî√l.h
>

22 
	~<asm/Âu/≠i.h
>

24 
	#OURMODNAME
 "Â_ö_lkm"

	)

26 
MODULE_AUTHOR
("<insert yourÇame here>");

27 
MODULE_DESCRIPTION
("LKP book:ch5/fp_in_lkm:ÇoÖerforming FP \
(floatingÖoint)árithmetic in kernel mode");

29 
MODULE_LICENSE
("Dual MIT/GPL");

30 
MODULE_VERSION
("0.1");

32 
	gnum
 = 22.0, 
	gdí
 = 7.0, 
	gmypi
;

34 
__öô
 
	$Â_ö_lkm_öô
()

36 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

38 
	`kî√l_Âu_begö
();

39 
mypi
 = 
num
 / 
dí
;

40 
	`kî√l_Âu_íd
();

42 
	`¥_öfo
("%s: PI = %.4‡%.4f\n", 
OURMODNAME
, 
mypi
, 
num
 / 
dí
);

46 
	}
}

48 
__exô
 
	$Â_ö_lkm_exô
()

50 
	`kî√l_Âu_begö
();

51 
	`¥_öfo
("%s: mypò%f\n", 
OURMODNAME
, 
mypi
);

52 
	`kî√l_Âu_íd
();

54 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

55 
	}
}

57 
moduÀ_öô
(
Â_ö_lkm_öô
);

58 
moduÀ_exô
(
Â_ö_lkm_exô
);

	@Books/Linux-Kernel-Programming/ch5/lkm_template/lkm_template.c

20 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

22 
	~<löux/öô.h
>

23 
	~<löux/moduÀ.h
>

24 
	~<löux/kî√l.h
>

26 
	#OURMODNAME
 "lkm_ãm∂©e"

	)

28 
MODULE_AUTHOR
("Kaiwan N Billimoria");

29 
MODULE_DESCRIPTION
("a simple LKMÅemplate; doÑeferÅoÅhe (better) Makefileás well");

30 
MODULE_LICENSE
("Dual MIT/GPL");

31 
MODULE_VERSION
("0.1");

33 
__öô
 
	$lkm_ãm∂©e_öô
()

35 
	`¥_öfo
("inserted\n");

37 
	}
}

39 
__exô
 
	$lkm_ãm∂©e_exô
()

41 
	`¥_öfo
("removed\n");

42 
	}
}

44 
moduÀ_öô
(
lkm_ãm∂©e_öô
);

45 
moduÀ_exô
(
lkm_ãm∂©e_exô
);

	@Books/Linux-Kernel-Programming/ch5/min_sysinfo/min_sysinfo.c

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/limôs.h
>

25 
	#MYMODNAME
 "mö_sysöfo"

	)

26 
MODULE_AUTHOR
("Kaiwan N Billimoria");

27 
MODULE_DESCRIPTION
("LKP book:ch5/min_sysinfo:Örint some minimal system info");

28 
MODULE_LICENSE
("Dual MIT/GPL");

29 
MODULE_VERSION
("0.1");

35 
	$show_sizeof
()

37 
	`¥_öfo
("sizeof: (bytes)\n"

44 
	}
}

51 
	$Œkd_sysöfo2
()

53 
	#MSGLEN
 128

	)

54 
msg
[
MSGLEN
];

56 
	`mem£t
(
msg
, 0, 
MSGLEN
);

57 
	`¢¥ötf
(
msg
, 48, "%s(): möimÆ Pœtf‹m Info:\nCPU: ", 
__func__
);

62 #ifde‡
CONFIG_X86


63 #i‡(
BITS_PER_LONG
 == 32)

64 
	`°æˇt
(
msg
, "x86_32, ", 
MSGLEN
);

66 
	`°æˇt
(
msg
, "x86_64, ", 
MSGLEN
);

69 #ifde‡
CONFIG_ARM


70 
	`°æˇt
(
msg
, "ARM-32, ", 
MSGLEN
);

72 #ifde‡
CONFIG_ARM64


73 
	`°æˇt
(
msg
, "A¨ch64, ", 
MSGLEN
);

75 #ifde‡
CONFIG_MIPS


76 
	`°æˇt
(
msg
, "MIPS, ", 
MSGLEN
);

78 #ifde‡
CONFIG_PPC


79 
	`°æˇt
(
msg
, "PowîPC, ", 
MSGLEN
);

81 #ifde‡
CONFIG_S390


82 
	`°æˇt
(
msg
, "IBM S390, ", 
MSGLEN
);

85 #ifde‡
__BIG_ENDIAN


86 
	`°æˇt
(
msg
, "big-ídün; ", 
MSGLEN
);

88 
	`°æˇt
(
msg
, "lôée-ídün; ", 
MSGLEN
);

91 #i‡(
BITS_PER_LONG
 == 32)

92 
	`°æˇt
(
msg
, "32-bô OS.\n", 
MSGLEN
);

93 #ñif(
BITS_PER_LONG
 == 64)

94 
	`°æˇt
(
msg
, "64-bô OS.\n", 
MSGLEN
);

96 
	`¥_öfo
("%s", 
msg
);

98 
	`show_sizeof
();

101 
¥_öfo


110 #i‡(
BITS_PER_LONG
 == 32)

115 , 
U8_MAX
, U8_MAX, 
S8_MAX
, S8_MAX, 
S8_MIN
, S8_MIN,

116 
U16_MAX
, U16_MAX, 
S16_MAX
, S16_MAX, 
S16_MIN
, S16_MIN,

117 
U32_MAX
, U32_MAX, 
S32_MAX
, S32_MAX, 
S32_MIN
, S32_MIN,

118 
U64_MAX
, U64_MAX, 
S64_MAX
, S64_MAX, 
S64_MIN
, S64_MIN

119 , 
PHYS_ADDR_MAX
, (*)PHYS_ADDR_MAX);

120 
	}
}

121 
EXPORT_SYMBOL
(
Œkd_sysöfo2
);

123 
	$Œkd_sysöfo
()

125 
msg
[128];

127 
	`mem£t
(
msg
, 0, 
	`°æí
(msg));

128 
	`¢¥ötf
(
msg
, 47, "%s(): möimÆ Pœtf‹m Info:\nCPU: ", 
__func__
);

133 #ifde‡
CONFIG_X86


134 #i‡(
BITS_PER_LONG
 == 32)

135 
	`°∫ˇt
(
msg
, "x86_32, ", 9);

137 
	`°∫ˇt
(
msg
, "x86_64, ", 9);

140 #ifde‡
CONFIG_ARM


141 
	`°∫ˇt
(
msg
, "ARM-32, ", 9);

143 #ifde‡
CONFIG_ARM64


144 
	`°∫ˇt
(
msg
, "Aarch64, ", 10);

146 #ifde‡
CONFIG_MIPS


147 
	`°∫ˇt
(
msg
, "MIPS, ", 7);

149 #ifde‡
CONFIG_PPC


150 
	`°∫ˇt
(
msg
, "PowerPC, ", 10);

152 #ifde‡
CONFIG_S390


153 
	`°∫ˇt
(
msg
, "IBM S390, ", 11);

156 #ifde‡
__BIG_ENDIAN


157 
	`°∫ˇt
(
msg
, "big-endian; ", 13);

159 
	`°∫ˇt
(
msg
, "little-endian; ", 16);

162 #i‡(
BITS_PER_LONG
 == 32)

163 
	`°∫ˇt
(
msg
, "32-bit OS.\n", 12);

164 #ñif(
BITS_PER_LONG
 == 64)

165 
	`°∫ˇt
(
msg
, "64-bit OS.\n", 12);

167 
	`¥_öfo
("%s", 
msg
);

168 
	}
}

169 
EXPORT_SYMBOL
(
Œkd_sysöfo
);

171 
__öô
 
	$mö_sysöfo_öô
()

173 
	`¥_öfo
("%s: in£πed\n", 
MYMODNAME
);

174 
	`Œkd_sysöfo
();

175 
	`Œkd_sysöfo2
();

177 
	}
}

179 
__exô
 
	$mö_sysöfo_exô
()

181 
	`¥_öfo
("%s:Ñemoved\n", 
MYMODNAME
);

182 
	}
}

184 
moduÀ_öô
(
mö_sysöfo_öô
);

185 
moduÀ_exô
(
mö_sysöfo_exô
);

	@Books/Linux-Kernel-Programming/ch5/modparams/modparams1/modparams1.c

17 
	~<löux/öô.h
>

18 
	~<löux/moduÀ.h
>

19 
	~<löux/kî√l.h
>

21 
	#OUR_MODNAME
 "mod∑øms1"

	)

22 
MODULE_AUTHOR
("Kaiwan N Billimoria");

23 
MODULE_DESCRIPTION
("LKP book:ch5/modparams/modparams1: moduleÖarameters demo LKM #1");

24 
MODULE_LICENSE
("Dual MIT/GPL");

25 
MODULE_VERSION
("0.1");

28 
	gmp_debug_Àvñ
;

29 
moduÀ_∑øm
(
mp_debug_Àvñ
, , 0660);

30 
MODULE_PARM_DESC
(
mp_debug_Àvñ
,

33 *
	gmp_°Ω¨am
 = "My stringÖaram";

34 
moduÀ_∑øm
(
mp_°Ω¨am
, 
ch¨p
, 0660);

35 
MODULE_PARM_DESC
(
mp_°Ω¨am
, "A demo stringÖarameter");

37 
__öô
 
	$mod∑øms1_öô
()

39 
	`¥_öfo
("%s: in£πed\n", 
OUR_MODNAME
);

40 
	`¥_öfo
("moduleÖarametersÖassed: mp_debug_level=%d mp_strparam=%s\n",

41 
mp_debug_Àvñ
, 
mp_°Ω¨am
);

43 
	}
}

45 
__exô
 
	$mod∑øms1_exô
()

47 
	`¥_öfo
("moduleÖarametersÖassed: mp_debug_level=%d mp_strparam=%s\n",

48 
mp_debug_Àvñ
, 
mp_°Ω¨am
);

49 
	`¥_öfo
("%s:Ñemoved\n", 
OUR_MODNAME
);

50 
	}
}

52 
moduÀ_öô
(
mod∑øms1_öô
);

53 
moduÀ_exô
(
mod∑øms1_exô
);

	@Books/Linux-Kernel-Programming/ch5/modparams/modparams2/modparams2.c

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

24 
	#OUR_MODNAME
 "mod∑øms2"

	)

25 
MODULE_AUTHOR
("Kaiwan N Billimoria");

26 
MODULE_DESCRIPTION
("LKP book:ch5/modparams/modparams2: moduleÖarameters");

27 
MODULE_LICENSE
("Dual MIT/GPL");

28 
MODULE_VERSION
("0.1");

31 
	gmp_debug_Àvñ
;

32 
moduÀ_∑øm
(
mp_debug_Àvñ
, , 0660);

33 
MODULE_PARM_DESC
(
mp_debug_Àvñ
,

36 *
	gmp_°Ω¨am
 = "My stringÖaram";

37 
moduÀ_∑øm
(
mp_°Ω¨am
, 
ch¨p
, 0660);

38 
MODULE_PARM_DESC
(
mp_°Ω¨am
, "A demo stringÖarameter");

40 
	gc⁄åﬁ_‰ók
;

41 
moduÀ_∑øm
(
c⁄åﬁ_‰ók
, , 0660);

42 
MODULE_PARM_DESC
(
c⁄åﬁ_‰ók
, "SetÅoÅheÖroject's controlÜevel [1-5]. MANDATORY");

44 
__öô
 
	$mod∑øms2_öô
()

46 
	`¥_öfo
("%s: in£πed\n", 
OUR_MODNAME
);

47 i‡(
mp_debug_Àvñ
 > 0)

48 
	`¥_öfo
("moduleÖarametersÖassed: "

50 
mp_debug_Àvñ
, 
mp_°Ω¨am
, 
c⁄åﬁ_‰ók
);

56 i‡((
c⁄åﬁ_‰ók
 < 1) || (control_freak > 5)) {

57 
	`¥_w¨n
("%s: MustÖassálong moduleÖarameter"

59 
OUR_MODNAME
);

60  -
EINVAL
;

63 
	}
}

65 
__exô
 
	$mod∑øms2_exô
()

67 i‡(
mp_debug_Àvñ
 > 0)

68 
	`¥_öfo
("moduleÖarametersÖassed: mp_debug_level=%d mp_strparam=%s\n",

69 
mp_debug_Àvñ
, 
mp_°Ω¨am
);

70 
	`¥_öfo
("%s:Ñemoved\n", 
OUR_MODNAME
);

71 
	}
}

73 
moduÀ_öô
(
mod∑øms2_öô
);

74 
moduÀ_exô
(
mod∑øms2_exô
);

	@Books/Linux-Kernel-Programming/ch5/modstacking/core_lkm.c

23 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

25 
	~<löux/öô.h
>

26 
	~<löux/moduÀ.h
>

27 
	~<löux/kî√l.h
>

29 
	#MODNAME
 "c‹e_lkm"

	)

30 
	#THE_ONE
 0x„dÁ˚

	)

31 
MODULE_LICENSE
("Dual MIT/GPL");

33 
	gexp_öt
 = 200;

34 
EXPORT_SYMBOL_GPL
(
exp_öt
);

44 
	$Œkd_sysöfo2
()

46 
	#MSGLEN
 128

	)

47 
msg
[
MSGLEN
];

49 
	`mem£t
(
msg
, 0, 
MSGLEN
);

50 
	`¢¥ötf
(
msg
, 48, "%s(): möimÆ Pœtf‹m Info:\nCPU: ", 
__func__
);

55 #ifde‡
CONFIG_X86


56 #i‡(
BITS_PER_LONG
 == 32)

57 
	`°æˇt
(
msg
, "x86_32, ", 
MSGLEN
);

59 
	`°æˇt
(
msg
, "x86_64, ", 
MSGLEN
);

62 #ifde‡
CONFIG_ARM


63 
	`°æˇt
(
msg
, "ARM-32, ", 
MSGLEN
);

65 #ifde‡
CONFIG_ARM64


66 
	`°æˇt
(
msg
, "A¨ch64, ", 
MSGLEN
);

68 #ifde‡
CONFIG_MIPS


69 
	`°æˇt
(
msg
, "MIPS, ", 
MSGLEN
);

71 #ifde‡
CONFIG_PPC


72 
	`°æˇt
(
msg
, "PowîPC, ", 
MSGLEN
);

74 #ifde‡
CONFIG_S390


75 
	`°æˇt
(
msg
, "IBM S390, ", 
MSGLEN
);

78 #ifde‡
__BIG_ENDIAN


79 
	`°æˇt
(
msg
, "big-ídün; ", 
MSGLEN
);

81 
	`°æˇt
(
msg
, "lôée-ídün; ", 
MSGLEN
);

84 #i‡(
BITS_PER_LONG
 == 32)

85 
	`°æˇt
(
msg
, "32-bô OS.\n", 
MSGLEN
);

86 #ñif(
BITS_PER_LONG
 == 64)

87 
	`°æˇt
(
msg
, "64-bô OS.\n", 
MSGLEN
);

89 
	`¥_öfo
("%s", 
msg
);

90 
	}
}

91 
EXPORT_SYMBOL
(
Œkd_sysöfo2
);

93 #i‡(
BITS_PER_LONG
 == 32)

94 
u32
 
	$gë_skey
(
p
)

96 
u64
 
	$gë_skey
(
p
)

99 #i‡(
BITS_PER_LONG
 == 32)

100 
u32
 
£¸ë
 = 0x567def;

102 
u64
 
£¸ë
 = 0x123abc567def;

104 
	`¥_öfo
("%s:%d: I'vêbì¿ˇŒed\n", 
__FILE__
, 
__LINE__
);

105 i‡(
p
 =
THE_ONE
)

106  
£¸ë
;

108 
	}
}

109 
EXPORT_SYMBOL
(
gë_skey
);

111 
__öô
 
	$c‹e_lkm_öô
()

113 
	`¥_öfo
("inserted\n");

115 
	}
}

117 
__exô
 
	$c‹e_lkm_exô
()

119 
	`¥_öfo
("bids youádieu\n");

120 
	}
}

122 
moduÀ_öô
(
c‹e_lkm_öô
);

123 
moduÀ_exô
(
c‹e_lkm_exô
);

	@Books/Linux-Kernel-Programming/ch5/modstacking/user_lkm.c

23 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

25 
	~<löux/öô.h
>

26 
	~<löux/moduÀ.h
>

27 
	~<löux/kî√l.h
>

29 
	#MODNAME
 "u£r_lkm"

	)

31 
MODULE_LICENSE
("Dual MIT/GPL");

33 
MODULE_LICENSE
("MIT");

36 
Œkd_sysöfo2
();

37 
gë_skey
();

38 
exp_öt
;

41 
__öô
 
	$u£r_lkm_öô
()

43 
	#THE_ONE
 0x„dÁ˚

	)

44 
	`¥_öfo
("inserted\n");

45 
u64
 
sk
 = 
	`gë_skey
(
THE_ONE
);

47 
	`¥_debug
("CÆÀd gë_skey(),Ñë = 0x%Œx = %Œu\n", 
sk
, sk);

48 
	`¥_debug
("exp_öà%d\n", 
exp_öt
);

49 
	`Œkd_sysöfo2
();

52 
	}
}

54 
__exô
 
	$u£r_lkm_exô
()

56 
	`¥_öfo
("bids youádieu\n");

57 
	}
}

59 
moduÀ_öô
(
u£r_lkm_öô
);

60 
moduÀ_exô
(
u£r_lkm_exô
);

	@Books/Linux-Kernel-Programming/ch6/current_affairs/current_affairs.c

17 
	~<löux/öô.h
>

18 
	~<löux/moduÀ.h
>

19 
	~<löux/kî√l.h
>

20 
	~<löux/sched.h
>

21 
	~<löux/¥ìm±.h
>

22 
	~<löux/¸ed.h
>

23 
	~<löux/uidgid.h
>

25 
	#OURMODNAME
 "cuºít_afÁús"

	)

27 
MODULE_AUTHOR
("Kaiwan N Billimoria");

28 
MODULE_DESCRIPTION
("LKP book:ch6/current_affairs: displayá few members of"

30 
MODULE_LICENSE
("Dual MIT/GPL");

31 
MODULE_VERSION
("0.1");

33 
ölöe
 
	$show_˘x
(*
nm
)

36 
uid
 = 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_uid
());

37 
euid
 = 
	`‰om_kuid
(&
öô_u£r_ns
, 
	`cuºít_euid
());

39 
	`¥_öfo
("%s:%s():%d ", 
nm
, 
__func__
, 
__LINE__
);

40 i‡(
	`likñy
(
	`ö_èsk
())) {

41 
	`¥_öfo
("%s: inÖrocess context ::\n"

49 " sèck sèπ : 0x%pK (0x%px)\n", 
nm
,

51 
	`èsk_pid_ƒ
(
cuºít
), 
	`èsk_tgid_ƒ
(current),

55 
uid
, 
euid
,

56 (
euid
 == 0 ? "have" : "don't have"),

57 
cuºít
->
comm
,

58 
cuºít
, current,

59 
cuºít
->
°ack
, current->stack);

61 
	`¥_Æît
("%s: i¿öãºu± c⁄ãxà[Should NOT H≠≥¿hîe!]\n", 
nm
);

62 
	}
}

64 
__öô
 
	$cuºít_afÁús_öô
()

66 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

67 
	`¥_öfo
(" sizeof(°ru˘Åask_°ru˘)=%zd\n", (
èsk_°ru˘
));

68 
	`show_˘x
(
OURMODNAME
);

70 
	}
}

72 
__exô
 
	$cuºít_afÁús_exô
()

74 
	`show_˘x
(
OURMODNAME
);

75 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

76 
	}
}

78 
moduÀ_öô
(
cuºít_afÁús_öô
);

79 
moduÀ_exô
(
cuºít_afÁús_exô
);

	@Books/Linux-Kernel-Programming/ch6/ebpf_stacktrace_eg/helloworld.c

20 
	~<°dio.h
>

21 
	~<uni°d.h
>

22 
	~<°dlib.h
>

24 
	$maö
()

27 
	`¥ötf
("Hñlo, w‹ld! PID = %d\n", 
	`gëpid
());

28 
	`u¶ìp
(10000);

30 
	`exô
(
EXIT_SUCCESS
);

31 
	}
}

	@Books/Linux-Kernel-Programming/ch6/foreach/prcs_showall/prcs_showall.c

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/sched.h
>

25 
	~<löux/vîsi⁄.h
>

26 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 10, 0)

27 
	~<löux/sched/sig«l.h
>

29 
	~<löux/fs.h
>

30 
	~<löux/¶ab.h
>

31 
	~<löux/uac˚ss.h
>

32 
	~<löux/kÆlsyms.h
>

34 
	#OURMODNAME
 "¥cs_showÆl"

	)

36 
MODULE_AUTHOR
("Kaiwan N Billimoria");

37 
MODULE_DESCRIPTION
("LKP book:ch6/foreach/prcs_showall: "

39 
MODULE_LICENSE
("Dual MIT/GPL");

40 
MODULE_VERSION
("0.1");

42 
	$show_¥cs_ö_èskli°
()

44 
èsk_°ru˘
 *
p
;

45 
	#MAXLEN
 128

	)

46 
tmp
[
MAXLEN
];

47 
numªad
 = 0, 
n
 = 0, 
tŸÆ
 = 0;

48 
hdr
[] = " Name | TGID | PID | RUID | EUID";

50 
	`¥_öfo
("%s\n", &
hdr
[0]);

65 
	`rcu_ªad_lock
();

66 
	`f‹_óch_¥o˚ss
(
p
) {

67 
	`mem£t
(
tmp
, 0, 128);

68 
n
 = 
	`¢¥ötf
(
tmp
, 128, "%-16s|%8d|%8d|%7u|%7u\n", 
p
->
comm
,Ö->
tgid
,Ö->
pid
,

73 
	`__kuid_vÆ
(
p
->
¸ed
->
uid
), __kuid_vÆ’->¸ed->
euid
)

75 
numªad
 +
n
;

76 
	`¥_öfo
("%s", 
tmp
);

79 
	`c⁄d_ªsched
();

80 
tŸÆ
++;

82 
	`rcu_ªad_u∆ock
();

84  
tŸÆ
;

85 
	}
}

87 
__öô
 
	$¥cs_showÆl_öô
()

89 
tŸÆ
;

91 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

92 
tŸÆ
 = 
	`show_¥cs_ö_èskli°
();

93 
	`¥_öfo
("%s:ÅŸÆ # o‡¥o˚s£†⁄ sy°em: %d\n", 
OURMODNAME
, 
tŸÆ
);

96 
	}
}

98 
__exô
 
	$¥cs_showÆl_exô
()

100 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

101 
	}
}

103 
moduÀ_öô
(
¥cs_showÆl_öô
);

104 
moduÀ_exô
(
¥cs_showÆl_exô
);

	@Books/Linux-Kernel-Programming/ch6/foreach/thrd_showall/thrd_showall.c

21 
	~<löux/öô.h
>

22 
	~<löux/moduÀ.h
>

23 
	~<löux/kî√l.h
>

24 
	~<löux/sched.h
>

25 
	~<löux/vîsi⁄.h
>

26 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 10, 0)

27 
	~<löux/sched/sig«l.h
>

30 
	#OURMODNAME
 "thrd_showÆl"

	)

32 
MODULE_AUTHOR
("Kaiwan N Billimoria");

33 
MODULE_DESCRIPTION
("LKP book:ch6/foreach/thrd_showall:"

35 
MODULE_LICENSE
("Dual MIT/GPL");

36 
MODULE_VERSION
("0.1");

43 
ölöe
 
	$di•_idÀ_thªad
()

45 
èsk_°ru˘
 *
t
 = &
öô_èsk
;

48 
	`¥_öfo
("%8d %8d 0x%px 0x%px [%16s]\n",

49 
t
->
pid
,Å->pid,Å,Å->
°ack
,Å->
comm
);

50 
	}
}

52 
	$showthrds
()

54 
èsk_°ru˘
 *
g
 = 
NULL
, *
t
 = NULL;

55 
ƒ_thrds
 = 1, 
tŸÆ
 = 1;

56 
	#BUFMAX
 256

	)

57 
	#TMPMAX
 128

	)

58 
buf
[
BUFMAX
], 
tmp
[
TMPMAX
];

59 c⁄° 
hdr
[] =

64 
	`¥_öfo
("%s", 
hdr
);

65 
	`di•_idÀ_thªad
();

82 
	`rcu_ªad_lock
();

83 
	`do_óch_thªad
(
g
, 
t
) {

84 
	`èsk_lock
(
t
);

86 
	`¢¥ötf
(
buf
, 
BUFMAX
-1, "%8d %8d ", 
g
->
tgid
, 
t
->
pid
);

89 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " 0x%px", 
t
);

98 
	`¢¥ötf
(
buf
, 
BUFMAX
-1, "%s%† 0x%px", buf, 
tmp
, 
t
->
°ack
);

100 i‡(!
g
->
mm
) {

106 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " [%16s]", 
t
->
comm
);

108 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " %16†", 
t
->
comm
);

110 
	`¢¥ötf
(
buf
, 
BUFMAX
-1, "%s%s", buf, 
tmp
);

119 
ƒ_thrds
 = 
	`gë_ƒ_thªads
(
g
);

120 i‡(
g
->
mm
 && (g->
tgid
 =
t
->
pid
Ë&& (
ƒ_thrds
 > 1)) {

121 
	`¢¥ötf
(
tmp
, 
TMPMAX
-1, " %3d", 
ƒ_thrds
);

122 
	`¢¥ötf
(
buf
, 
BUFMAX
-1, "%s%s", buf, 
tmp
);

125 
	`¢¥ötf
(
buf
, 
BUFMAX
-1, "%s\n", buf);

126 
	`¥_öfo
("%s", 
buf
);

128 
tŸÆ
++;

129 
	`mem£t
(
buf
, 0, (buf));

130 
	`mem£t
(
tmp
, 0, (tmp));

131 
	`èsk_u∆ock
(
t
);

132 } 
	`whûe_óch_thªad
(
g
, 
t
);

133 
	`rcu_ªad_u∆ock
();

135  
tŸÆ
;

136 
	}
}

138 
__öô
 
	$thrd_showÆl_öô
()

140 
tŸÆ
;

142 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

143 
tŸÆ
 = 
	`showthrds
();

144 
	`¥_öfo
("%s:Åotal # ofÅhreads onÅhe system: %d\n",

145 
OURMODNAME
, 
tŸÆ
);

148 
	}
}

150 
__exô
 
	$thrd_showÆl_exô
()

152 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

153 
	}
}

155 
moduÀ_öô
(
thrd_showÆl_öô
);

156 
moduÀ_exô
(
thrd_showÆl_exô
);

	@Books/Linux-Kernel-Programming/ch7/show_kernel_seg/kernel_seg.c

29 
	~<löux/öô.h
>

30 
	~<löux/moduÀ.h
>

31 
	~<löux/kî√l.h
>

32 
	~<löux/sched.h
>

33 
	~<löux/mm.h
>

34 
	~<löux/highmem.h
>

35 
	~<löux/¶ab.h
>

36 
	~<löux/vmÆloc.h
>

37 
	~<löux/vîsi⁄.h
>

38 
	~<asm/pgèbÀ.h
>

39 
	~<asm/fixm≠.h
>

40 
	~"../../klib_Œkd.h
"

41 
	~"../../c⁄víõ¡.h
"

43 
	#OURMODNAME
 "show_kî√l_£g"

	)

45 
MODULE_AUTHOR
("Kaiwan N Billimoria");

46 
MODULE_DESCRIPTION
("LKP book:ch7/kernel_seg: display some kernel segment details");

47 
MODULE_LICENSE
("Dual MIT/GPL");

48 
MODULE_VERSION
("0.1");

51 
	gshow_u£rvas
;

52 
moduÀ_∑øm
(
show_u£rvas
, , 0660);

53 
MODULE_PARM_DESC
(
show_u£rvas
, "Show some user space VAS details; 0 =Ço (default), 1 = show");

55 
	#ELLPS
 "| [ . . . ] |\n"

	)

57 
Œkd_mösysöfo
();

69 
	$show_u£r•a˚_öfo
()

71 
	`¥_öfo
("+------------ Above is kernel-seg; below, user VAS ----------+\n"

72 
ELLPS


84 
ELLPS


86 
	`SHOW_DELTA_b
(
cuºít
->
mm
->
ív_°¨t
, cuºít->mm->
ív_íd
),

87 
	`SHOW_DELTA_b
(
cuºít
->
mm
->
¨g_°¨t
, cuºít->mm->
¨g_íd
),

88 
cuºít
->
mm
->
°¨t_°ack
,

89 
	`SHOW_DELTA_K
(
cuºít
->
mm
->
°¨t_brk
, cuºít->mm->
brk
),

90 
	`SHOW_DELTA_b
(
cuºít
->
mm
->
°¨t_d©a
, cuºít->mm->
íd_d©a
),

91 
	`SHOW_DELTA_K
(
cuºít
->
mm
->
°¨t_code
, cuºít->mm->
íd_code
)

94 
	`¥_öfo
(

95 #i‡(
BITS_PER_LONG
 == 64)

101 #i‡(
BITS_PER_LONG
 == 64)

102 
TASK_SIZE
, (TASK_SIZE >> 30),

104 
TASK_SIZE
, (TASK_SIZE >> 20),

106 
cuºít
->
mm
->
m≠_cou¡
);

108 #ifde‡
DEBUG


109 
	`¥_öfo
(" Above statisticsáre wrt 'current'Åhread (see below):\n");

110 
	`PRINT_CTX
();

112 
	}
}

126 
	$show_kî√l£g_öfo
()

128 
	`¥_öfo
("\nSome Kernel Details [by decreasingáddress]\n"

130 #ifde‡
CONFIG_ARM


132 #i‡
LINUX_VERSION_CODE
 > 
	`KERNEL_VERSION
(4, 11, 0)

133 
	`¥_öfo
("|vectorÅable: "

135 
	`SHOW_DELTA_K
(
VECTORS_BASE
, VECTORS_BASE + 
PAGE_SIZE
));

140 
	`¥_öfo
(
ELLPS


143 #ifde‡
CONFIG_ARM


144 
	`SHOW_DELTA_M
(
FIXADDR_START
, 
FIXADDR_END
));

146 
	`SHOW_DELTA_M
(
FIXADDR_START
, (FIXADDR_START+
FIXADDR_SIZE
)));

155 #i‡(
BITS_PER_LONG
 == 64)

156 
	`¥_öfo
("|moduleÑegion: "

158 
	`SHOW_DELTA_M
(
MODULES_VADDR
, 
MODULES_END
));

161 #ifde‡
CONFIG_KASAN


162 
	`¥_öfo
("|KASAN shadow: "

164 
	`SHOW_DELTA_G
(
KASAN_SHADOW_START
, 
KASAN_SHADOW_END
));

168 
	`¥_öfo
("|vmallocÑegion: "

170 
	`SHOW_DELTA_MG
(
VMALLOC_START
, 
VMALLOC_END
));

173 
	`¥_öfo
("|lowmemÑegion: "

175 #i‡(
BITS_PER_LONG
 == 32)

180 
	`SHOW_DELTA_MG
(()
PAGE_OFFSET
, ()
high_mem‹y
));

183 #ifde‡
CONFIG_HIGHMEM


184 
	`¥_öfo
("|HIGHMEMÑegion: "

186 
	`SHOW_DELTA_M
(
PKMAP_BASE
, (PKMAP_BASEË+ (
LAST_PKMAP
 * 
PAGE_SIZE
)));

199 #i‡(
BITS_PER_LONG
 == 32)

200 
	`¥_öfo
("|moduleÑegion: "

202 
	`SHOW_DELTA_M
(
MODULES_VADDR
, 
MODULES_END
));

204 
	`¥_öfo
(
ELLPS
);

205 
	}
}

207 
__öô
 
	$kî√l_£g_öô
()

209 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

216 
	`Œkd_mösysöfo
();

217 
	`show_kî√l£g_öfo
();

219 i‡(
show_u£rvas
)

220 
	`show_u£r•a˚_öfo
();

222 
	`¥_öfo
("+-------------------------------------------------------------+\n");

223 
	`¥_öfo
("%s: skùpög show u£r•a˚...\n", 
OURMODNAME
);

227 
	}
}

229 
__exô
 
	$kî√l_£g_exô
()

231 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

232 
	}
}

234 
moduÀ_öô
(
kî√l_£g_öô
);

235 
moduÀ_exô
(
kî√l_£g_exô
);

	@Books/Linux-Kernel-Programming/ch8/lowlevel_mem/lowlevel_mem.c

30 
	~<löux/öô.h
>

31 
	~<löux/moduÀ.h
>

32 
	~<löux/kî√l.h
>

33 
	~<löux/mm.h
>

34 
	~"../../klib_Œkd.h
"

36 
	#OURMODNAME
 "lowÀvñ_mem"

	)

38 
MODULE_DESCRIPTION
("ch8: demo kernel moduleÅoÉxerciseÉssentialÖageállocator APIs");

39 
MODULE_AUTHOR
("Kaiwan N Billimoria");

40 
MODULE_LICENSE
("Dual MIT/GPL");

42 c⁄° *
	gg±r1
, *
	gg±r2
, *
	gg±r3
, *
	gg±r4
, *
	gg±r5
;

43 
	gbß_Æloc_‹dî
 = 3;

44 
moduÀ_∑øm_«med
(
‹dî
, 
bß_Æloc_‹dî
, , 0660);

45 
MODULE_PARM_DESC
(
‹dî
, "order ofÅheállocation (power-to-raise-2-to)");

51 
	$bß_Æloc
()

53 
°©
 = -
ENOMEM
;

54 
u64
 
numpg2Æloc
 = 0;

55 c⁄° 
∑ge
 *
pg_±r1
;

60 
	`¥_öfo
("%s: 0. Show identity mapping: RAMÖage frames : kernel virtualÖages :: 1:1\n",

61 
OURMODNAME
);

69 
	`show_phy_∑ges
((*)
PAGE_OFFSET
, 5 * 
PAGE_SIZE
, 1);

72 
g±r1
 = (*)
	`__gë_‰ì_∑ge
(
GFP_KERNEL
);

73 i‡(!
g±r1
) {

74 
	`¥_w¨n
("%s: __gë_‰ì_∑ge(ËÁûed!\n", 
OURMODNAME
);

82 
out1
;

84 
	`¥_öfo
("%s: 1. __get_free_page()álloc'ed 1Öage fromÅhe BSA @ %pK (%px)\n",

85 
OURMODNAME
, 
g±r1
, gptr1);

88 
numpg2Æloc
 = 
	`powîof
(2, 
bß_Æloc_‹dî
);

89 
g±r2
 = (*)
	`__gë_‰ì_∑ges
(
GFP_KERNEL
 | 
__GFP_ZERO
, 
bß_Æloc_‹dî
);

90 i‡(!
g±r2
) {

92 
out2
;

94 
	`¥_öfo
("%s: 2. __get_free_pages()álloc'ed 2^%d = %lldÖage(s) = %lld bytes\n"

96 
OURMODNAME
, 
bß_Æloc_‹dî
, 
	`powîof
(2, bsa_alloc_order),

97 
numpg2Æloc
 * 
PAGE_SIZE
, 
g±r2
, gptr2);

98 
	`¥_öfo
(" (PAGE_SIZE = %ld byãs)\n", 
PAGE_SIZE
);

99 
	`show_phy_∑ges
(
g±r2
, 
numpg2Æloc
 * 
PAGE_SIZE
, 1);

102 
g±r3
 = (*)
	`gë_zî€d_∑ge
(
GFP_KERNEL
);

103 i‡(!
g±r3
)

104 
out3
;

105 
	`¥_öfo
("%s: 3. get_zeroed_page()álloc'ed 1Öage fromÅhe BSA @ %pK (%px)\n",

106 
OURMODNAME
, 
g±r3
, gptr3);

115 
pg_±r1
 = 
	`Æloc_∑ge
(
GFP_KERNEL
);

116 i‡(!
pg_±r1
)

117 
out4
;

118 
g±r4
 = 
	`∑ge_addªss
(
pg_±r1
);

119 
	`¥_öfo
("%s: 4.álloc_page()álloc'ed 1Öage fromÅhe BSA @ %pK (%px)\n"

121 
OURMODNAME
, (*)
g±r4
, (*)g±r4, 
pg_±r1
,Ög_ptr1);

126 
g±r5
 = 
	`∑ge_addªss
(
	`Æloc_∑ges
(
GFP_KERNEL
, 5));

127 i‡(!
g±r5
)

128 
out5
;

129 
	`¥_öfo
("%s: 5.álloc_pages()álloc'ed %lldÖages fromÅhe BSA @ %pK (%px)\n",

130 
OURMODNAME
, 
	`powîof
(2, 5), (*)
g±r5
, (*)gptr5);

133 
out5
:

134 
	`‰ì_∑ge
(()
g±r4
);

135 
out4
:

136 
	`‰ì_∑ge
(()
g±r3
);

137 
out3
:

138 
	`‰ì_∑ges
(()
g±r2
, 
bß_Æloc_‹dî
);

139 
out2
:

140 
	`‰ì_∑ge
(()
g±r1
);

141 
out1
:

142  
°©
;

143 
	}
}

145 
__öô
 
	$lowÀvñ_mem_öô
()

147  
	`bß_Æloc
();

148 
	}
}

150 
__exô
 
	$lowÀvñ_mem_exô
()

152 
	`¥_öfo
("%s: fªe-ög u∞thêBSA mem‹y chunks...\n", 
OURMODNAME
);

156 
	`‰ì_∑ges
(()
g±r5
, 3);

157 
	`‰ì_∑ge
(()
g±r4
);

158 
	`‰ì_∑ge
(()
g±r3
);

159 
	`‰ì_∑ges
(()
g±r2
, 
bß_Æloc_‹dî
);

160 
	`‰ì_∑ge
(()
g±r1
);

161 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

162 
	}
}

164 
moduÀ_öô
(
lowÀvñ_mem_öô
);

165 
moduÀ_exô
(
lowÀvñ_mem_exô
);

	@Books/Linux-Kernel-Programming/ch8/page_exact_loop/page_exact_loop.c

21 
	~<löux/öô.h
>

22 
	~<löux/moduÀ.h
>

23 
	~<löux/kî√l.h
>

24 
	~<löux/dñay.h
>

26 
	#OURMODNAME
 "∑ge_exa˘_lo›"

	)

28 
MODULE_AUTHOR
("Kaiwan N Billimoria");

29 
	gMODULE_DESCRIPTION


31 
MODULE_LICENSE
("Dual MIT/GPL");

32 
MODULE_VERSION
("0.1");

34 
	#MAXTIMES
 3

	)

37 
show_phy_∑ges
(c⁄° *
kaddr
, 
size_t
 
Àn
, 
boﬁ
 
c⁄tiguôy_check
);

39 *
	gg±r
[
MAXTIMES
];

43 
size_t
 
	ggsz
 = 33*1024;

45 
__öô
 
	$∑ge_exa˘_lo›_öô
()

47 
i
, 
j
;

49 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

51 
i
 = 0; i < 
MAXTIMES
; i++) {

52 
g±r
[
i
] = 
	`Æloc_∑ges_exa˘
(
gsz
, 
GFP_KERNEL
);

53 i‡(!
g±r
[
i
]) {

54 
	`¥_w¨n
("%s:álloc_pages_exact() failed! (loop index %d)\n",

55 
OURMODNAME
, 
i
);

57 
j
 = 
i
; j >= 0; j--)

58 
	`‰ì_∑ges_exa˘
(
g±r
[
j
], 
gsz
);

59  -
ENOMEM
;

61 
	`¥_öfo
("%s:%d:álloc_pages_exact()álloc'ed %zu bytes memory (%zuÖages +Ñem %u bytes)"

63 
OURMODNAME
, 
i
, 
gsz
, gsz / 
PAGE_SIZE
, gsz % PAGE_SIZE, 
g±r
[i], gptr[i]);

65 
	`mem£t
(
g±r
[
i
], 'x', 
gsz
);

67 
	`show_phy_∑ges
(
g±r
[
i
], 
gsz
, 1);

68 
	`m¶ìp
(100);

72 
	}
}

74 
__exô
 
	$∑ge_exa˘_lo›_exô
()

76 
i
;

78 
i
 = 0; i < 
MAXTIMES
; i++)

79 
	`‰ì_∑ges_exa˘
(
g±r
[
i
], 
gsz
);

80 
	`¥_öfo
("%s: mem fªed,Ñemoved\n", 
OURMODNAME
);

81 
	}
}

83 
moduÀ_öô
(
∑ge_exa˘_lo›_öô
);

84 
moduÀ_exô
(
∑ge_exa˘_lo›_exô
);

	@Books/Linux-Kernel-Programming/ch8/slab1/slab1.c

17 
	~<löux/öô.h
>

18 
	~<löux/moduÀ.h
>

19 
	~<löux/¶ab.h
>

21 
	#OURMODNAME
 "¶ab1"

	)

23 
MODULE_AUTHOR
("Kaiwan N Billimoria");

24 
MODULE_DESCRIPTION
("LKP book:ch8/slab1: k[m|z]alloc, kfree, basic demo");

25 
MODULE_LICENSE
("Dual MIT/GPL");

26 
MODULE_VERSION
("0.1");

28 *
	ggk±r
;

29 
	smy˘x
 {

30 
u32
 
	müº
[100];

31 
u64
 
	mu¨r
[100];

32 
	mu«me
[128], 
	m∑sswd
[16], 
	mc⁄fig
[16];

34 
my˘x
 *
	g˘x
;

36 
__öô
 
	$¶ab1_öô
()

39 
gk±r
 = 
	`kmÆloc
(1024, 
GFP_KERNEL
);

40 i‡(!
gk±r
) {

41 
	`WARN_ONCE
(1, "%s: kmÆloc(ËÁûed!\n", 
OURMODNAME
);

48 
out_Áû1
;

50 
	`¥_öfo
("kmÆloc(Ësuc˚eds, (a˘uÆ KVAËªàvÆuê%px\n", 
gk±r
);

52 
	`¥öt_hex_dump_byãs
("gk±∏bef‹êmem£t: ", 
DUMP_PREFIX_OFFSET
, 
gk±r
, 32);

53 
	`mem£t
(
gk±r
, 'm', 1024);

54 
	`¥öt_hex_dump_byãs
(" gk±∏a·î mem£t: ", 
DUMP_PREFIX_OFFSET
, 
gk±r
, 32);

57 
˘x
 = 
	`kzÆloc
((
my˘x
), 
GFP_KERNEL
);

58 i‡(!
˘x
)

59 
out_Áû2
;

60 
	`¥_öfo
("%s: context structálloc'edánd initialized (actual KVAÑet = %px)\n",

61 
OURMODNAME
, 
˘x
);

62 
	`¥öt_hex_dump_byãs
("˘x: ", 
DUMP_PREFIX_OFFSET
, 
˘x
, 32);

66 
out_Áû2
:

67 
	`k‰ì
(
gk±r
);

68 
out_Áû1
:

69  -
ENOMEM
;

70 
	}
}

72 
__exô
 
	$¶ab1_exô
()

74 
	`k‰ì
(
˘x
);

75 
	`k‰ì
(
gk±r
);

76 
	`¥_öfo
("%s: fªed sœb mem‹y,Ñemoved\n", 
OURMODNAME
);

77 
	}
}

79 
moduÀ_öô
(
¶ab1_öô
);

80 
moduÀ_exô
(
¶ab1_exô
);

	@Books/Linux-Kernel-Programming/ch8/slab2_buggy/slab2_buggy.c

23 
	~<löux/öô.h
>

24 
	~<löux/moduÀ.h
>

25 
	~<löux/¶ab.h
>

27 
	#OURMODNAME
 "¶ab2_buggy"

	)

29 
MODULE_AUTHOR
("Kaiwan N Billimoria");

30 
MODULE_DESCRIPTION
("LKP book:ch8/slab2_buggy: kmalloc/kfree bug demo");

31 
MODULE_LICENSE
("Dual MIT/GPL");

32 
MODULE_VERSION
("0.1");

34 
__öô
 
	$¶ab2_buggy_öô
()

36 
i
 = 0;

37 *
k±r
 = 
NULL
;

39 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

41 
	#BUGGY
 0

	)

43 ++
i
 < 4) {

44 #i‡(
BUGGY
 == 1)

45 i‡(
k±r
 =
NULL
)

47 
k±r
 = 
	`kmÆloc
(1024, 
GFP_KERNEL
);

48 i‡(!
k±r
) {

49 
	`¥_w¨n
("%s: kmÆlo¯Áûed!\n", 
OURMODNAME
);

53  -
ENOMEM
;

55 
	`mem£t
(
k±r
, 
i
 - 1 + 0x61, 1024);

56 
	`¥öt_hex_dump_byãs
("k±r: ", 
DUMP_PREFIX_OFFSET
, 
k±r
, 16);

57 
	`k‰ì
(
k±r
);

58 #i‡(
BUGGY
 == 1)

59 
	`¥_öfo
(" %d: k‰ì o¿%pK\n", 
i
, 
k±r
);

64 
	}
}

66 
__exô
 
	$¶ab2_buggy_exô
()

68 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

69 
	}
}

71 
moduÀ_öô
(
¶ab2_buggy_öô
);

72 
moduÀ_exô
(
¶ab2_buggy_exô
);

	@Books/Linux-Kernel-Programming/ch8/slab3_maxsize/slab3_maxsize.c

17 
	~<löux/öô.h
>

18 
	~<löux/moduÀ.h
>

19 
	~<löux/¶ab.h
>

21 
	#OURMODNAME
 "¶ab3_maxsize"

	)

23 
MODULE_AUTHOR
("Kaiwan N Billimoria");

24 
MODULE_DESCRIPTION
("LKP book:ch8/slab3_maxsize:Åest maxállocÜimit from k[m|z]alloc()");

25 
MODULE_LICENSE
("Dual MIT/GPL");

26 
MODULE_VERSION
("0.1");

28 
	g°ïsz
 = 200000;

29 
moduÀ_∑øm
(
°ïsz
, , 0644);

30 
MODULE_PARM_DESC
(
°ïsz
,

33 
	$ã°_maxÆlocsz
()

35 
size_t
 
size2Æloc
 = 0;

38 *
p
 = 
	`kmÆloc
(
size2Æloc
, 
GFP_KERNEL
);

39 i‡(!
p
) {

40 
	`¥_Æît
("kmÆlo¯Áû, size2Æloc=%zu\n", 
size2Æloc
);

42  -
ENOMEM
;

44 
	`¥_öfo
("kmÆloc(%7zuË0x%pK\n", 
size2Æloc
, 
p
);

45 
	`k‰ì
(
p
);

46 
size2Æloc
 +
°ïsz
;

49 
	}
}

51 
__öô
 
	$¶ab3_maxsize_öô
()

53 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

54  
	`ã°_maxÆlocsz
();

55 
	}
}

57 
__exô
 
	$¶ab3_maxsize_exô
()

59 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

60 
	}
}

62 
moduÀ_öô
(
¶ab3_maxsize_öô
);

63 
moduÀ_exô
(
¶ab3_maxsize_exô
);

	@Books/Linux-Kernel-Programming/ch8/slab4_actualsize/slab4_actualsize.c

19 
	~<löux/öô.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/¶ab.h
>

23 
	#OURMODNAME
 "¶ab4_a˘uÆsize"

	)

25 
MODULE_AUTHOR
("Kaiwan N Billimoria");

26 
MODULE_DESCRIPTION
("LKP book:ch8/slab4_actualsize:Åest slabálloc withÅhe ksize()");

27 
MODULE_LICENSE
("Dual MIT/GPL");

28 
MODULE_VERSION
("0.1");

30 
	g°ïsz
 = 200000;

31 
moduÀ_∑øm
(
°ïsz
, , 0644);

32 
MODULE_PARM_DESC
(
°ïsz
,

35 
	$ã°_maxÆlocsz
()

39 
size_t
 
size2Æloc
 = 100, 
a˘uÆ_Ælo˚d
;

40 *
p
;

42 
	`¥_öfo
("kmalloc(Ç) : Actual : Wastage : Waste %%\n");

44 
p
 = 
	`kmÆloc
(
size2Æloc
, 
GFP_KERNEL
);

45 i‡(!
p
) {

46 
	`¥_Æît
("kmÆlo¯Áû, size2Æloc=%zu\n", 
size2Æloc
);

47  -
ENOMEM
;

49 
a˘uÆ_Ælo˚d
 = 
	`ksize
(
p
);

54 
	`¥_öfo
("kmalloc(%7zu) : %7zu : %7zu : %3zu%%\n",

55 
size2Æloc
, 
a˘uÆ_Ælo˚d
, (actual_alloced - size2alloc),

56 (((
a˘uÆ_Ælo˚d
 - 
size2Æloc
) * 100) / size2alloc));

57 
	`k‰ì
(
p
);

58 
size2Æloc
 +
°ïsz
;

61 
	}
}

63 
__öô
 
	$¶ab4_a˘uÆsize_öô
()

65 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

66  
	`ã°_maxÆlocsz
();

67 
	}
}

69 
__exô
 
	$¶ab4_a˘uÆsize_exô
()

71 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

72 
	}
}

74 
moduÀ_öô
(
¶ab4_a˘uÆsize_öô
);

75 
moduÀ_exô
(
¶ab4_a˘uÆsize_exô
);

	@Books/Linux-Kernel-Programming/ch8/slab4_actualsz_wstg_plot/slab4_actualsz_wstg_plot.c

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/¶ab.h
>

24 
	#OURMODNAME
 "¶ab4_a˘uÆsz_w°g_∂Ÿ"

	)

26 
MODULE_AUTHOR
("Kaiwan N Billimoria");

27 
	gMODULE_DESCRIPTION


29 
MODULE_LICENSE
("Dual MIT/GPL");

30 
MODULE_VERSION
("0.1");

32 
	g°ïsz
 = 20000;

33 
moduÀ_∑øm
(
°ïsz
, , 0644);

34 
MODULE_PARM_DESC
(
°ïsz
,

37 
	$ã°_maxÆlocsz
()

42 
size_t
 
size2Æloc
 = 100, 
a˘uÆ_Ælo˚d
;

43 *
p
;

46 
p
 = 
	`kmÆloc
(
size2Æloc
, 
GFP_KERNEL
);

47 i‡(!
p
) {

48 
	`¥_Æît
("kmÆlo¯Áû, size2Æloc=%zu\n", 
size2Æloc
);

49  -
ENOMEM
;

51 
a˘uÆ_Ælo˚d
 = 
	`ksize
(
p
);

53 
	`¥_öfo
("%zu %3zu\n",

54 
size2Æloc
, (((
a˘uÆ_Ælo˚d
 - size2alloc) * 100) / size2alloc));

55 
	`k‰ì
(
p
);

56 
size2Æloc
 +
°ïsz
;

59 
	}
}

61 
__öô
 
	$¶ab4_a˘uÆsz_w°g_∂Ÿ_öô
()

63 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

64  
	`ã°_maxÆlocsz
();

65 
	}
}

67 
__exô
 
	$¶ab4_a˘uÆsz_w°g_∂Ÿ_exô
()

69 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

70 
	}
}

72 
moduÀ_öô
(
¶ab4_a˘uÆsz_w°g_∂Ÿ_öô
);

73 
moduÀ_exô
(
¶ab4_a˘uÆsz_w°g_∂Ÿ_exô
);

	@Books/Linux-Kernel-Programming/ch9/oom_killer_try/oom_killer_try.c

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<uni°d.h
>

30 
	~<°rög.h
>

32 
	#BLK
 (
	`gë∑gesize
()*2)

	)

34 
	gf‹˚_∑ge_Áu…
 = 0;

36 
	$maö
(
¨gc
, **
¨gv
)

38 *
p
;

39 
i
 = 0, 
j
 = 1, 
°ïvÆ
 = 5000, 
vîbo£
 = 0;

41 i‡(
¨gc
 < 3) {

42 
	`Ârötf
(
°dîr
,

44 
¨gv
[0]);

45 
	`exô
(
EXIT_FAILURE
);

48 i‡(
	`©oi
(
¨gv
[2]) == 1)

49 
f‹˚_∑ge_Áu…
 = 1;

51 i‡(
¨gc
 >= 4) {

52 i‡(
	`©oi
(
¨gv
[3]) == 1)

53 
vîbo£
 = 1;

56 
	`¥ötf
("%s: PID %d (verbose mode: %s)\n",

57 
¨gv
[0], 
	`gëpid
(), (
vîbo£
==1?"on":"off"));

59 
p
 = (*)
	`mÆloc
(
BLK
);

60 i‡(!
p
) {

61 
	`Ârötf
(
°dîr
, "%s:Üoop #%d: malloc failure.\n",

62 
¨gv
[0], 
i
);

75 i‡(
f‹˚_∑ge_Áu…
) {

76 
p
[1103] &= 0x0b;

77 
p
[5227] |= 0xaa;

79 i‡(!(
i
 % 
°ïvÆ
)) {

80 i‡(!
vîbo£
) {

81 i‡(!(
j
%5))

82 
	`¥ötf
(". ");

84 
	`¥ötf
(".");

85 
	`fÊush
(
°dout
);

86 
j
++;

88 
	`¥ötf
("%06d\taddrÖ = %p break = %p\n",

89 
i
, (*)
p
, (*)
	`sbrk
(0));

92 
i
++;

93 } 
p
 && (
i
 < 
	`©oi
(
¨gv
[1])));

95 
	`exô
(
EXIT_SUCCESS
);

96 
	}
}

	@Books/Linux-Kernel-Programming/ch9/poison_test/poison_test.c

21 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

23 
	~<löux/öô.h
>

24 
	~<löux/moduÀ.h
>

25 
	~<löux/kî√l.h
>

26 
	~<löux/¶ab.h
>

27 
	~<löux/vîsi⁄.h
>

28 
	~<löux/sched.h
>

30 
	#OURMODNAME
 "pois⁄_ã°"

	)

31 
	#OURCACHENAME
 "pois⁄_ã°"

	)

33 
	gu£_˘‹
;

34 
moduÀ_∑øm
(
u£_˘‹
, 
uöt
, 0);

35 
MODULE_PARM_DESC
(
u£_˘‹
, "if setÅo 1, our custom ctorÑoutine"

38 
MODULE_AUTHOR
("Kaiwan N Billimoria");

39 
MODULE_DESCRIPTION
("LKP book:ch9/poison_test: simple demo of creatingá custom slab cache");

40 
MODULE_LICENSE
("Dual MIT/GPL");

41 
MODULE_VERSION
("0.1");

47 
	smy˘x
 {

48 
u32
 
	müº
[10];

49 
u64
 
	mu¨r
[6];

50 
	mc⁄fig
[64];

52 
kmem_ˇche
 *
	gg˘x_ˇchï
;

53 
my˘x
 *
	gobj
;

55 
	$u£_the_obje˘
(*
s
, 
u8
 
c
, 
size_t
 
n
)

57 
	`mem£t
(
s
, 
c
, 
n
);

58 
	`¥_öfo
(" --------------á·î mem£às, '%c', %zu : ------------\n", 
c
, 
n
);

59 
	`¥öt_hex_dump_byãs
("obj: ", 
DUMP_PREFIX_ADDRESS
, 
s
, (
my˘x
));

60 
	}
}

62 
	$u£_our_ˇche
()

65 #i‡
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2, 6, 39)

66 
	`¥_debug
("Cachê«mêi†%s\n", 
	`kmem_ˇche_«me
(
g˘x_ˇchï
));

68 
	`¥_debug
("[ker ver > 2.6.38 cacheÇame deprecated...]\n");

71 
obj
 = 
	`kmem_ˇche_Æloc
(
g˘x_ˇchï
, 
GFP_KERNEL
);

72 i‡(!
obj
) {

73 
	`¥_w¨n
("kmem_cache_alloc() failed\n");

76 
	`¥_öfo
("Our cache object (@ 0x%pK,áctual=0x%px) size is %u bytes; ksize=%zu\n",

77 
obj
, obj, 
	`kmem_ˇche_size
(
g˘x_ˇchï
), 
	`ksize
(obj));

78 
	`¥öt_hex_dump_byãs
("obj: ", 
DUMP_PREFIX_OFFSET
, 
obj
, (
my˘x
));

80 
	`u£_the_obje˘
(
obj
, 'z', 16);

81 
	}
}

87 
	$our_˘‹
(*
√w
)

89 
my˘x
 *
˘x
 = 
√w
;

90 
èsk_°ru˘
 *
p
 = 
cuºít
;

92 
	`¥_öfo
("ö ct‹: ju°áŒo˚d mem obje˘ i†@ 0x%px\n", 
˘x
);

93 
	`mem£t
(
˘x
, 0, (
my˘x
));

98 
	`¢¥ötf
(
˘x
->
c⁄fig
, 6 * (
u64
) + 5, "%d.%d,%ld.%ld,%ld,%ld",

99 
p
->
tgid
,Ö->
pid
,Ö->
nvcsw
,Ö->
nivcsw
,Ö->
mö_Êt
,Ö->
maj_Êt
);

100 
	}
}

102 
	$¸óã_our_ˇche
()

104 
ªt
 = 0;

105 *
˘‹_‚
 = 
NULL
;

107 i‡(
u£_˘‹
 == 1)

108 
˘‹_‚
 = 
our_˘‹
;

110 
	`¥_öfo
("sizeof our ctx structure is %zu bytes\n"

112 (
my˘x
), 
u£_˘‹
 == 1 ? "yes" : "no");

118 
g˘x_ˇchï
 = 
	`kmem_ˇche_¸óã
(
OURCACHENAME
,

119 (
my˘x
),

121 
SLAB_POISON
 |

122 
SLAB_RED_ZONE
 |

123 
SLAB_HWCACHE_ALIGN
,

124 
˘‹_‚
);

125 i‡(!
g˘x_ˇchï
) {

130 
	`¥_w¨n
("kmem_cache_create() failed\n");

131 i‡(
	`IS_ERR
(
g˘x_ˇchï
))

132 
ªt
 = 
	`PTR_ERR
(
g˘x_ˇchï
);

135  
ªt
;

136 
	}
}

138 
__öô
 
	$¶ab_cu°om_öô
()

140 
	`¥_öfo
("inserted\n");

141 
	`¸óã_our_ˇche
();

142 
	`u£_our_ˇche
();

144 
	}
}

146 
__exô
 
	$¶ab_cu°om_exô
()

148 
	`kmem_ˇche_‰ì
(
g˘x_ˇchï
, 
obj
);

149 
	`u£_the_obje˘
(
obj
, '!', 10);

151 
	`kmem_ˇche_de°roy
(
g˘x_ˇchï
);

152 
	`¥_öfo
("custom cache destroyed;Ñemoved\n");

153 
	}
}

155 
moduÀ_öô
(
¶ab_cu°om_öô
);

156 
moduÀ_exô
(
¶ab_cu°om_exô
);

	@Books/Linux-Kernel-Programming/ch9/slab_custom/slab_custom.c

19 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

21 
	~<löux/öô.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/moduÀ.h
>

24 
	~<löux/¶ab.h
>

25 
	~<löux/vîsi⁄.h
>

26 
	~<löux/sched.h
>

28 
	#OURMODNAME
 "¶ab_cu°om"

	)

29 
	#OURCACHENAME
 "our_˘x"

	)

31 
	gu£_˘‹
 = 1;

32 
moduÀ_∑øm
(
u£_˘‹
, 
uöt
, 0);

33 
MODULE_PARM_DESC
(
u£_˘‹
, "if setÅo 1 (default), our custom ctorÑoutine"

36 
MODULE_AUTHOR
("Kaiwan N Billimoria");

37 
MODULE_DESCRIPTION
("LKP book:ch9/slab_custom: simple demo of creatingá custom slab cache");

38 
MODULE_LICENSE
("Dual MIT/GPL");

39 
MODULE_VERSION
("0.1");

45 
	smy˘x
 {

46 
u32
 
	müº
[10];

47 
u64
 
	mu¨r
[10];

48 
	mu«me
[128], 
	m∑sswd
[16], 
	mc⁄fig
[64];

50 
kmem_ˇche
 *
	gg˘x_ˇchï
;

52 
	$u£_our_ˇche
()

54 
my˘x
 *
obj
 = 
NULL
;

56 #i‡
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2, 6, 39)

57 
	`¥_debug
("Cachê«mêi†%s\n", 
	`kmem_ˇche_«me
(
g˘x_ˇchï
));

59 
	`¥_debug
("[ker ver > 2.6.38 cacheÇame deprecated...]\n");

62 
obj
 = 
	`kmem_ˇche_Æloc
(
g˘x_ˇchï
, 
GFP_KERNEL
);

63 i‡(!
obj
) {

64 
	`¥_w¨n
("kmem_cache_alloc() failed\n");

65  -
ENOMEM
;

68 
	`¥_öfo
("Our cache object (@ %pK,áctual=%px) size is %u bytes;áctual ksize=%zu\n",

69 
obj
, obj, 
	`kmem_ˇche_size
(
g˘x_ˇchï
), 
	`ksize
(obj));

70 
	`¥öt_hex_dump_byãs
("obj: ", 
DUMP_PREFIX_OFFSET
, 
obj
, (
my˘x
));

73 
	`kmem_ˇche_‰ì
(
g˘x_ˇchï
, 
obj
);

75 
	}
}

81 
	$our_˘‹
(*
√w
)

83 
my˘x
 *
˘x
 = 
√w
;

84 
èsk_°ru˘
 *
p
 = 
cuºít
;

90 
	`¥_öfo
("ö ct‹: ju°áŒo˚d mem obje˘ i†@ 0x%px\n", 
˘x
);

91 
	`mem£t
(
˘x
, 0, (
my˘x
));

96 
	`¢¥ötf
(
˘x
->
c⁄fig
, 6 * (
u64
) + 5, "%d.%d,%ld.%ld,%ld,%ld",

97 
p
->
tgid
,Ö->
pid
,Ö->
nvcsw
,Ö->
nivcsw
,Ö->
mö_Êt
,Ö->
maj_Êt
);

98 
	}
}

100 
	$¸óã_our_ˇche
()

102 
ªt
 = 0;

103 *
˘‹_‚
 = 
NULL
;

105 i‡(
u£_˘‹
 == 1)

106 
˘‹_‚
 = 
our_˘‹
;

108 
	`¥_öfo
("sizeof our ctx structure is %zu bytes\n"

110 (
my˘x
), 
u£_˘‹
 == 1 ? "yes" : "no");

116 
g˘x_ˇchï
 = 
	`kmem_ˇche_¸óã
(
OURCACHENAME
,

117 (
my˘x
),

119 
SLAB_POISON
 |

120 
SLAB_RED_ZONE
 |

121 
SLAB_HWCACHE_ALIGN
,

122 
˘‹_‚
);

123 i‡(!
g˘x_ˇchï
) {

128 
	`¥_w¨n
("kmem_cache_create() failed\n");

129 i‡(
	`IS_ERR
(
g˘x_ˇchï
))

130 
ªt
 = 
	`PTR_ERR
(
g˘x_ˇchï
);

133  
ªt
;

134 
	}
}

136 
__öô
 
	$¶ab_cu°om_öô
()

138 
	`¥_öfo
("inserted\n");

139 
	`¸óã_our_ˇche
();

140 
	`u£_our_ˇche
();

142 
	}
}

144 
__exô
 
	$¶ab_cu°om_exô
()

146 
	`kmem_ˇche_de°roy
(
g˘x_ˇchï
);

147 
	`¥_öfo
("custom cache destroyed;Ñemoved\n");

148 
	}
}

150 
moduÀ_öô
(
¶ab_cu°om_öô
);

151 
moduÀ_exô
(
¶ab_cu°om_exô
);

	@Books/Linux-Kernel-Programming/ch9/vmalloc_demo/vmalloc_demo.c

18 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

20 
	~<löux/öô.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/mm.h
>

24 
	~<löux/¶ab.h
>

25 
	~<löux/vmÆloc.h
>

27 
	#OURMODNAME
 "vmÆloc_demo"

	)

29 
MODULE_AUTHOR
("Kaiwan N Billimoria");

30 
MODULE_DESCRIPTION
("LKP book:ch9/vmalloc_demo/: simple vmalloc()ánd friends demoÜkm");

31 
MODULE_LICENSE
("Dual MIT/GPL");

32 
MODULE_VERSION
("0.1");

34 
	gkvnum
 = 5 * 1024 * 1024;

35 
moduÀ_∑øm
(
kvnum
, , 0644);

36 
MODULE_PARM_DESC
(
kvnum
, "number of bytesÅoállocate withÅhe kvmalloc(); (defaultsÅo 5 MB)");

38 
	#KVN_MIN_BYTES
 16

	)

39 
	#DISP_BYTES
 16

	)

41 *
	gv±r_∫dm
, *
	gv±r_öô
, *
	gkv
, *
	gkv¨r
, *
	gvrx
;

43 
	$vmÆloc_åy
()

46 
v±r_∫dm
 = 
	`vmÆloc
(10000);

47 i‡(!
v±r_∫dm
) {

51 
	`¥_w¨n
("vmalloc failed\n");

52 
îr_out1
;

54 
	`¥_öfo
("1. vmalloc(): vptr_rndm = 0x%pK (actual=0x%px)\n",

55 
v±r_∫dm
, vptr_rndm);

56 
	`¥öt_hex_dump_byãs
(" c⁄ã¡: ", 
DUMP_PREFIX_NONE
, 
v±r_∫dm
, 
DISP_BYTES
);

59 
v±r_öô
 = 
	`vzÆloc
(10000);

60 i‡(!
v±r_öô
) {

61 
	`¥_w¨n
("vzalloc failed\n");

62 
îr_out2
;

64 
	`¥_öfo
("2. vzalloc(): vptr_init = 0x%pK (actual=0x%px)\n",

65 
v±r_öô
, vptr_init);

66 
	`¥öt_hex_dump_byãs
(" c⁄ã¡: ", 
DUMP_PREFIX_NONE
, 
v±r_öô
, 
DISP_BYTES
);

72 
kv
 = 
	`kvmÆloc
(
kvnum
, 
GFP_KERNEL
);

73 i‡(!
kv
) {

74 
	`¥_w¨n
("kvmalloc failed\n");

75 
îr_out3
;

77 
	`¥_öfo
("3. kvmalloc() : kv = 0x%pK (actual=0x%px)\n"

78 " (f‹ %d byãs)\n", 
kv
, kv, 
kvnum
);

79 
	`¥öt_hex_dump_byãs
(" c⁄ã¡: ", 
DUMP_PREFIX_NONE
, 
kv
, 
KVN_MIN_BYTES
);

83 
kv¨r
 = 
	`kˇŒoc
(1000, (
u64
), 
GFP_KERNEL
);

84 i‡(!
kv¨r
) {

85 
	`¥_w¨n
("kcalloc failed\n");

86 
îr_out4
;

88 
	`¥_öfo
("4. kˇŒoc(Ë: kv¨∏0x%pK (a˘uÆ=0x%px)\n", 
kv¨r
, kvarr);

89 
	`¥öt_hex_dump_byãs
(" c⁄ã¡: ", 
DUMP_PREFIX_NONE
, 
kv¨r
, 
DISP_BYTES
);

92 #unde‡
WR2ROMEM_BUG


96 
vrx
 = 
	`__vmÆloc
(42 * 
PAGE_SIZE
, 
GFP_KERNEL
, 
PAGE_KERNEL_RO
);

97 i‡(!
vrx
) {

98 
	`¥_w¨n
("__vmalloc failed\n");

99 
îr_out5
;

101 
	`¥_öfo
("5. __vmÆloc(): vrx = 0x%pK (a˘uÆ=0x%px)\n", 
vrx
, vrx);

104 
	`¥öt_hex_dump_byãs
(" c⁄ã¡: ", 
DUMP_PREFIX_NONE
, 
vrx
, 
DISP_BYTES
);

105 #ifde‡
WR2ROMEM_BUG


108 *(
u64
 *Ë(
vrx
 + 4) = 0xba;

111 
îr_out5
:

112 
	`v‰ì
(
kv¨r
);

113 
îr_out4
:

114 
	`v‰ì
(
kv
);

115 
îr_out3
:

116 
	`v‰ì
(
v±r_öô
);

117 
îr_out2
:

118 
	`v‰ì
(
v±r_∫dm
);

119 
îr_out1
:

120  -
ENOMEM
;

121 
	}
}

123 
__öô
 
	$vmÆloc_demo_öô
()

125 i‡(
kvnum
 < 
KVN_MIN_BYTES
) {

126 
	`¥_öfo
("kvnum mu° bê>%d byã†(cuº it'†%d byãs)\n", 
KVN_MIN_BYTES
, 
kvnum
);

127  -
EINVAL
;

129 
	`¥_öfo
("inserted\n");

131  
	`vmÆloc_åy
();

132 
	}
}

134 
__exô
 
	$vmÆloc_demo_exô
()

136 
	`v‰ì
(
vrx
);

137 
	`kv‰ì
(
kv¨r
);

138 
	`kv‰ì
(
kv
);

139 
	`v‰ì
(
v±r_öô
);

140 
	`v‰ì
(
v±r_∫dm
);

141 
	`¥_öfo
("removed\n");

142 
	}
}

144 
moduÀ_öô
(
vmÆloc_demo_öô
);

145 
moduÀ_exô
(
vmÆloc_demo_exô
);

	@Books/Linux-Kernel-Programming/convenient.h

16 #i‚de‡
__LKP_CONVENIENT_H__


17 
	#__LKP_CONVENIENT_H__


	)

19 
	~<asm/∑øm.h
>

20 
	~<löux/sched.h
>

22 #ifde‡
__KERNEL__


23 
	~<löux/øãlimô.h
>

52 #unde‡
USE_FTRACE_BUFFER


54 #ifde‡
USE_FTRACE_BUFFER


55 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

56 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

58 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

59 
USE_RATELIMITING
 = 1; \

60 i‡(
USE_RATELIMITING
) { \

61 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

64 
	`¥_öfo
(
°rög
, ##
¨gs
); \

65 } 0)

	)

70 #ifde‡
DEBUG


71 #ifde‡
__KERNEL__


72 
	#MSG
(
°rög
, 
¨gs
...) do { \

73 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

74 } 0)

	)

76 
	#MSG
(
°rög
, 
¨gs
...) do { \

77 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

78 } 0)

	)

81 #ifde‡
__KERNEL__


82 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

83 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

84 } 0)

	)

86 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

87 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

88 } 0)

	)

92 
	#QP
 
	`MSG
("\n")

	)

94 #ifde‡
__KERNEL__


95 #i‚de‡
USE_FTRACE_BUFFER


96 
	#QPDS
 do { \

97 
	`MSG
("\n"); \

98 
	`dump_°ack
(); \

99 } 0)

	)

101 
	#QPDS
 do { \

102 
	`MSG
("\n"); \

103 
	`åa˚_dump_°ack
(); \

104 } 0)

	)

108 #ifde‡
__KERNEL__


109 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

110 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

111 } 0)

	)

114 
	#MSG
(
°rög
, 
¨gs
...)

	)

115 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

116 
	#QP


	)

117 
	#QPDS


	)

125 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

126 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

127 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

128 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

129 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

131 #ifde‡
__KERNEL__


152 
	~<löux/sched.h
>

153 
	~<löux/öãºu±.h
>

155 
	#PRINT_CTX
() do { \

156 
PRINTCTX_SHOWHDR
 = 0; \

157 
öå
 = '.'; \

158 i‡(!
	`ö_èsk
()) { \

159 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

160 
öå
 = 'H'; \

161 i‡(
	`ö_úq
()) \

162 
öå
 = 'h'; \

163 i‡(
	`ö_so·úq
()) \

164 
öå
 = 's'; \

167 
öå
 = '.'; \

169 i‡(
PRINTCTX_SHOWHDR
 == 1) \

170 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

171 
	`¥_debug
( \

175 , 
	`øw_smp_¥o˚ss‹_id
(), \

176 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

177 (
	`úqs_dißbÀd
()?'d':'.'), \

178 (
	`√ed_ªsched
()?'N':'.'), \

179 
öå
, \

180 (
	`¥ìm±_cou¡
() && 0xff), \

181 
__func__
 \

183 } 0)

	)

198 #ifde‡
__KERNEL__


199 
	#as£π
(
ex¥
) do { \

200 i‡(!(
ex¥
)) { \

201 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

202 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

204 } 0)

	)

208 
ölöe
 
	$bìp
(
wh©
)

210 #ifde‡
__KERNEL__


211 
	`¥_öfo
("%c", ()
wh©
);

213 
	~<uni°d.h
>

214 
buf
 = ()
wh©
;

215 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

217 
	}
}

226 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

228 
c
 = 0, 
m
; \

229 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

231 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

232 
	`bìp
((
vÆ
)); \

233 
c
++; \

234 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

235 
m
 = 0; m < 50; m++); \

236 
x
 = 
ö√r_ödex
 / 2; \

240 }

	)

243 #ifde‡
__KERNEL__


244 
dñay_£c
();

256 
	$dñay_£c
(
vÆ
)

258 
	`asm
 ("");

259 i‡(
	`ö_èsk
()) {

260 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

261 i‡(-1 =
vÆ
)

262 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

264 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

266 
	}
}

269 #ifde‡
__KERNEL__


277 
	~<löux/jiffõs.h
>

278 
	~<löux/ktime.h
>

279 
	#SHOW_DELTA
(
œãr
, 
óæõr
) do { \

280 i‡(
	`time_a·î
(()
œãr
, ()
óæõr
)) { \

281 
	`¥_öfo
("delta: %lldÇs (= %lld us = %lld ms)\n", \

282 
	`ktime_sub
(
œãr
, 
óæõr
), \

283 
	`ktime_sub
(
œãr
, 
óæõr
)/1000, \

284 
	`ktime_sub
(
œãr
, 
óæõr
)/1000000 \

287 
	`¥_w¨n
("SHOW_DELTA(): *invalid*Éarlier >Üater?\n"); \

288 } 0)

	)

	@Books/Linux-Kernel-Programming/klib_llkd.c

18 
	~"klib_Œkd.h
"

29 
	$Œkd_mösysöfo
()

31 
	#MSGLEN
 128

	)

32 
msg
[
MSGLEN
];

34 
	`mem£t
(
msg
, 0, 
MSGLEN
);

35 
	`¢¥ötf
(
msg
, 48, "%s(): möimÆÖœtf‹m info:\nCPU: ", 
__func__
);

39 #ifde‡
CONFIG_X86


40 #if(
BITS_PER_LONG
 == 32)

41 
	`°æˇt
(
msg
, "x86_32, ", 
MSGLEN
);

43 
	`°æˇt
(
msg
, "x86_64, ", 
MSGLEN
);

46 #ifde‡
CONFIG_ARM


47 
	`°æˇt
(
msg
, "ARM-32, ", 
MSGLEN
);

49 #ifde‡
CONFIG_ARM64


50 
	`°æˇt
(
msg
, "A¨ch64, ", 
MSGLEN
);

52 #ifde‡
CONFIG_MIPS


53 
	`°æˇt
(
msg
, "MIPS, ", 
MSGLEN
);

55 #ifde‡
CONFIG_PPC


56 
	`°æˇt
(
msg
, "PowîPC, ", 
MSGLEN
);

58 #ifde‡
CONFIG_S390


59 
	`°æˇt
(
msg
, "IBM S390, ", 
MSGLEN
);

62 #ifde‡
__BIG_ENDIAN


63 
	`°æˇt
(
msg
, "big-ídün; ", 
MSGLEN
);

65 
	`°æˇt
(
msg
, "lôée-ídün; ", 
MSGLEN
);

68 #if(
BITS_PER_LONG
 == 32)

69 
	`°æˇt
(
msg
, "32-bô OS.\n", 
MSGLEN
);

70 #ñif(
BITS_PER_LONG
 == 64)

71 
	`°æˇt
(
msg
, "64-bô OS.\n", 
MSGLEN
);

73 
	`¥_öfo
("%s", 
msg
);

74 
	}
}

93 
	$show_phy_∑ges
(c⁄° *
kaddr
, 
size_t
 
Àn
, 
boﬁ
 
c⁄tiguôy_check
)

95 *
vaddr
 = 
kaddr
;

96 #if(
BITS_PER_LONG
 == 64)

97 c⁄° *
hdr
 = "-pg#- -------va------- --------pa-------- --PFN--\n";

99 c⁄° *
hdr
 = "-pg#- ----va---- --------pa-------- -PFN-\n";

101 
phys_addr_t
 
∑
;

102 
lo›s
 = 
Àn
/
PAGE_SIZE
, 
i
;

103 
p‚
, 
¥ev_p‚
 = 1;

105 #ifde‡
CONFIG_X86


106 i‡(!
	`vút_addr_vÆid
(
vaddr
)) {

107 
	`¥_öfo
("%s(): invÆid vútuÆáddªs†(0x%px)\n", 
__func__
, 
vaddr
);

115 
	`¥_öfo
("%s(): start kaddr %px,Üen %zu, contiguity_check is %s\n",

116 
__func__
, 
vaddr
, 
Àn
, 
c⁄tiguôy_check
?"on":"off");

117 
	`¥_öfo
("%s", 
hdr
);

118 i‡(
Àn
 % 
PAGE_SIZE
)

119 
lo›s
++;

120 
i
 = 0; i < 
lo›s
; i++) {

121 
∑
 = 
	`vút_to_phys
(
vaddr
+(
i
*
PAGE_SIZE
));

122 
p‚
 = 
	`PHYS_PFN
(
∑
);

124 i‡(!!
c⁄tiguôy_check
) {

129 i‡(
i
 && 
p‚
 !
¥ev_p‚
 + 1) {

130 
	`¥_nŸi˚
(" ***Öhysiˇ»NON-c⁄tiguôy dëe˘ed (i=%dË***\n", 
i
);

139 
	`¥_öfo
("%05d 0x%px %pa %ld\n",

140 
i
, 
vaddr
+(i*
PAGE_SIZE
), &
∑
, 
p‚
);

141 i‡(!!
c⁄tiguôy_check
)

142 
¥ev_p‚
 = 
p‚
;

144 
	}
}

152 
u64
 
	$powîof
(
ba£
, 
exp⁄ít
)

154 
u64
 
ªs
 = 1;

156 i‡(
ba£
 == 0)

158 i‡(
ba£
 <0 || 
exp⁄ít
 < 0)

160 i‡(
exp⁄ít
 == 0)

162 
exp⁄ít
--)

163 
ªs
 *
ba£
;

164  
ªs
;

165 
	}
}

171 
	$show_sizeof
()

173 #i‚de‡
__KERNEL__


174 
	`¥ötf
(

176 
	`¥_öfo
(

185 
	}
}

	@Books/Linux-Kernel-Programming/klib_llkd.h

18 #i‚de‡
__KLIB_LKP_H__


19 
	#__KLIB_LKP_H__


	)

21 
	~<löux/öô.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/moduÀ.h
>

24 
	~<asm/io.h
>

26 
Œkd_mösysöfo
();

27 
u64
 
powîof
(
ba£
, 
exp⁄ít
);

28 
show_phy_∑ges
(c⁄° *
kaddr
, 
size_t
 
Àn
, 
boﬁ
 
c⁄tiguôy_check
);

29 
show_sizeof
();

	@Books/Linux-Kernel-Programming/solutions_to_assgn/ch13/miscdrv_rdwr_refcount/miscdrv_rdwr_refcount.c

22 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

24 
	~<löux/öô.h
>

25 
	~<löux/moduÀ.h
>

26 
	~<löux/miscdevi˚.h
>

27 
	~<löux/¶ab.h
>

28 
	~<löux/mm.h
>

29 
	~<löux/fs.h
>

32 
	~<löux/vîsi⁄.h
>

33 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

34 
	~<löux/uac˚ss.h
>

36 
	~<asm/uac˚ss.h
>

39 
	~<löux/muãx.h
>

40 
	~<löux/•ölock.h
>

41 
	~<löux/ªfcou¡.h
>

42 
	~"../../c⁄víõ¡.h
"

44 
	#OURMODNAME
 "miscdrv_rdwr_ªfcou¡"

	)

46 
MODULE_AUTHOR
("Kaiwan N Billimoria");

47 
MODULE_DESCRIPTION
(

49 
MODULE_LICENSE
("Dual MIT/GPL");

50 
MODULE_VERSION
("0.1");

52 
ªfcou¡_t
 
	gga
 = 
REFCOUNT_INIT
(5);

53 
ªfcou¡_t
 
	ggb
 = 
REFCOUNT_INIT
(5);

58 
	sdrv_˘x
 {

59 
devi˚
 *
	mdev
;

60 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
;

61 
u32
 
	mc⁄fig1
, 
	mc⁄fig2
;

62 
u64
 
	mc⁄fig3
;

63 
	#MAXBYTES
 128

	)

64 
	mour£¸ë
[
MAXBYTES
];

65 
muãx
 
	mmuãx
;

66 
•ölock_t
 
	m•ölock
;

68 
drv_˘x
 *
	g˘x
;

70 
ölöe
 
	$di•œy_°©s
(
show_°©s
)

72 
devi˚
 *
dev
 = 
˘x
->dev;

74 i‡(1 =
show_°©s
) {

75 
	`•ö_lock
(&
˘x
->
•ölock
);

76 
	`dev_öfo
(
dev
, "°©s:Åx=%d,Ñx=%d\n", 
˘x
->
tx
, ctx->
rx
);

77 
	`•ö_u∆ock
(&
˘x
->
•ölock
);

79 
	}
}

90 
	$›í_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

92 
devi˚
 *
dev
 = 
˘x
->dev;

94 
	`PRINT_CTX
();

96 
	`ªfcou¡_öc
(&
ga
);

97 
	`ªfcou¡_dec
(&
gb
);

99 
	`dev_öfo
(
dev
, " filename: \"%s\"\n"

101 " g®%d, gb = %d\n", 
fûp
->
f_∑th
.
díåy
->
d_öame
, fûp->
f_Êags
,

102 
	`ªfcou¡_ªad
(&
ga
),Ñefcou¡_ªad(&
gb
));

104 
	`di•œy_°©s
(1);

106 
	}
}

117 
ssize_t
 
	$ªad_miscdrv_rdwr
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

118 
size_t
 
cou¡
, 
loff_t
 *
off
)

120 
ªt
 = 
cou¡
, 
£¸ë_Àn
, 
îr_∑th
 = 0;

121 
devi˚
 *
dev
 = 
˘x
->dev;

123 
	`•ö_lock
(&
˘x
->
•ölock
);

124 
£¸ë_Àn
 = 
	`°æí
(
˘x
->
our£¸ë
);

125 
	`•ö_u∆ock
(&
˘x
->
•ölock
);

127 
	`PRINT_CTX
();

128 
	`dev_öfo
(
dev
, "%†w™t†tÿªad (u±oË%zu byãs\n", 
cuºít
->
comm
, 
cou¡
);

130 
ªt
 = -
EINVAL
;

131 i‡(
cou¡
 < 
MAXBYTES
) {

132 
	`dev_w¨n
(
dev
, "request # of bytes (%zu) is <Ñequired size"

133 " (%d),áb‹tögÑód\n", 
cou¡
, 
MAXBYTES
);

134 
îr_∑th
 = 1;

135 
out_nŸok
;

137 i‡(
£¸ë_Àn
 <= 0) {

138 
	`dev_w¨n
(
dev
, "whoops, something's wrong,Åhe 'secret' isn't"

140 
îr_∑th
 = 1;

141 
out_nŸok
;

155 
ªt
 = -
EFAULT
;

156 
	`muãx_lock
(&
˘x
->
muãx
);

163 i‡(
	`c›y_to_u£r
(
ubuf
, 
˘x
->
our£¸ë
, 
£¸ë_Àn
)) {

164 
	`dev_w¨n
(
dev
, "copy_to_user() failed\n");

165 
îr_∑th
 = 1;

166 
out_˘u
;

168 
ªt
 = 
£¸ë_Àn
;

171 
˘x
->
tx
 +
£¸ë_Àn
;

172 
	`dev_öfo
(
dev
, " %d bytesÑead,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

173 
£¸ë_Àn
, 
˘x
->
tx
, ctx->
rx
);

174 
out_˘u
:

175 
	`muãx_u∆ock
(&
˘x
->
muãx
);

176 
	`di•œy_°©s
(
îr_∑th
);

177 
out_nŸok
:

178  
ªt
;

179 
	}
}

190 
ssize_t
 
	$wrôe_miscdrv_rdwr
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

191 
size_t
 
cou¡
, 
loff_t
 *
off
)

193 
ªt
, 
îr_∑th
 = 0;

194 *
kbuf
 = 
NULL
;

195 
devi˚
 *
dev
 = 
˘x
->dev;

197 
	`PRINT_CTX
();

198 
	`dev_öfo
(
dev
, "%†w™t†tÿwrôê%zu byãs\n", 
cuºít
->
comm
, 
cou¡
);

200 
ªt
 = -
ENOMEM
;

201 
kbuf
 = 
	`kvmÆloc
(
cou¡
, 
GFP_KERNEL
);

202 i‡(
	`u∆ikñy
(!
kbuf
)) {

203 
	`dev_w¨n
(
dev
, "kvmalloc() failed!\n");

204 
îr_∑th
 = 1;

205 
out_nomem
;

207 
	`mem£t
(
kbuf
, 0, 
cou¡
);

216 
ªt
 = -
EFAULT
;

217 i‡(
	`c›y_‰om_u£r
(
kbuf
, 
ubuf
, 
cou¡
)) {

218 
	`dev_w¨n
(
dev
, "copy_from_user() failed\n");

219 
îr_∑th
 = 1;

220 
out_cfu
;

229 
	`•ö_lock
(&
˘x
->
•ölock
);

230 
	`°æ˝y
(
˘x
->
our£¸ë
, 
kbuf
, (
cou¡
 > 
MAXBYTES
 ? MAXBYTES : count));

232 
	`¥öt_hex_dump_byãs
("˘x ", 
DUMP_PREFIX_OFFSET
,

233 
˘x
, (
drv_˘x
));

236 
˘x
->
rx
 +
cou¡
;

238 
ªt
 = 
cou¡
;

239 
	`dev_öfo
(
dev
, " %zu bytes written,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

240 
cou¡
, 
˘x
->
tx
, ctx->
rx
);

242 
	`•ö_u∆ock
(&
˘x
->
•ölock
);

243 
out_cfu
:

244 
	`kv‰ì
(
kbuf
);

245 
	`di•œy_°©s
(
îr_∑th
);

246 
out_nomem
:

247  
ªt
;

248 
	}
}

256 
	$˛o£_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

258 
devi˚
 *
dev
 = 
˘x
->dev;

260 
	`PRINT_CTX
();

262 
	`ªfcou¡_dec
(&
ga
);

263 
	`ªfcou¡_öc
(&
gb
);

265 
	`dev_öfo
(
dev
, "filename: \"%s\"\n ga = %d, gb = %d\n",

266 
fûp
->
f_∑th
.
díåy
->
d_öame
,

267 
	`ªfcou¡_ªad
(&
ga
),Ñefcou¡_ªad(&
gb
));

268 
	`di•œy_°©s
(1);

271 
	}
}

274 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

275 .
›í
 = 
›í_miscdrv_rdwr
,

276 .
	gªad
 = 
ªad_miscdrv_rdwr
,

277 .
	gwrôe
 = 
wrôe_miscdrv_rdwr
,

278 .
	gŒ£ek
 = 
no_Œ£ek
,

279 .
	gªÀa£
 = 
˛o£_miscdrv_rdwr
,

287 
miscdevi˚
 
	gŒkd_miscdev
 = {

288 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

289 .
	g«me
 = "llkd_miscdrv_rdwr_refcount",

291 .
	gmode
 = 0666,

292 .
	gf›s
 = &
Œkd_misc_f›s
,

295 
__öô
 
	$miscdrv_öô_ªfcou¡
()

297 
ªt
;

299 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

300 i‡(
ªt
 < 0) {

301 
	`¥_nŸi˚
("misc deviceÑegistration failed,áborting\n");

302  
ªt
;

304 
	`¥_öfo
("LLKD misc driver (major # 10)Ñegistered, minor# = %d,"

305 " devÇodêi†%s\n", 
Œkd_miscdev
.
mö‹
,Ülkd_miscdev.
«me
);

313 
˘x
 = 
	`kzÆloc
((
drv_˘x
), 
GFP_KERNEL
);

314 i‡(
	`u∆ikñy
(!
˘x
))

315  -
ENOMEM
;

317 
	`muãx_öô
(&
˘x
->
muãx
);

318 
	`•ö_lock_öô
(&
˘x
->
•ölock
);

321 
˘x
->
dev
 = 
Œkd_miscdev
.
this_devi˚
;

323 
	`°æ˝y
(
˘x
->
our£¸ë
, "initmsg", 8);

332 
	`dev_dbg
(
˘x
->
dev
, "A sampleÖrint viaÅhe dev_dbg(): driver initialized\n");

334 
	}
}

336 
__exô
 
	$miscdrv_exô_ªfcou¡
()

338 
	`muãx_de°roy
(&
˘x
->
muãx
);

339 
	`misc_dîegi°î
(&
Œkd_miscdev
);

340 
	`¥_öfo
("%s: LLKD mis¯drivî dîegi°îed, bye\n", 
OURMODNAME
);

341 
	}
}

343 
moduÀ_öô
(
miscdrv_öô_ªfcou¡
);

344 
moduÀ_exô
(
miscdrv_exô_ªfcou¡
);

	@Books/Linux-Kernel-Programming/solutions_to_assgn/ch5/libtest/mycaller.c

23 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

25 
	~<löux/öô.h
>

26 
	~<löux/moduÀ.h
>

27 
	~<löux/kî√l.h
>

29 
	#OURMODNAME
 "libã°"

	)

31 
MODULE_AUTHOR
("<insert yourÇame here>");

32 
MODULE_DESCRIPTION
("LKP bookássignment : ch5/libtest");

33 
MODULE_LICENSE
("Dual MIT/GPL");

34 
MODULE_VERSION
("0.1");

36 
¥odöt
(, );

38 
__öô
 
	$myˇŒî_öô
()

40 
a
 = 500, 
b
 = 900, 
ªs
;

42 
	`¥_öfo
("inserted\n");

44 
	`¥_öfo
("ˇŒögÖrodu˘(%d,%dËnow...\n", 
a
, 
b
);

45 
ªs
 = 
	`¥odöt
(
a
, 
b
);

46 
	`¥_öfo
("Ñe†%d\n", 
ªs
);

48 
a
 = 10000; 
b
 = 250000;

49 
	`¥_öfo
("ˇŒögÖrodu˘(%d,%dËnow...\n", 
a
, 
b
);

50 
ªs
 = 
	`¥odöt
(
a
, 
b
);

51 
	`¥_öfo
("Ñe†%d\n", 
ªs
);

54 
	}
}

56 
__exô
 
	$myˇŒî_exô
()

58 
	`¥_öfo
("removed\n");

59 
	}
}

61 
moduÀ_öô
(
myˇŒî_öô
);

62 
moduÀ_exô
(
myˇŒî_exô
);

	@Books/Linux-Kernel-Programming/solutions_to_assgn/ch5/libtest/mylib.c

22 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

24 
	~<löux/öô.h
>

25 
	~<löux/moduÀ.h
>

26 
	~<löux/kî√l.h
>

29 
	$¥odu˘
(
a
, 
b
)

31 
	`¥_debug
("I¿%s()\n", 
__func__
);

32  (
a
*
b
);

33 
	}
}

51 
	$¥odöt
(
a
, 
b
)

53 i‡((
a
 > 0 && (
b
 > 
INT_MAX
/®|| b < 
INT_MIN
/a)) ||

54 (
a
 < -1 && (
b
 > 
INT_MIN
/®|| b < 
INT_MAX
/a)) ||

55 (
a
 =-1 && 
b
 =
INT_MIN
)) {

56 
	`¥_w¨n
("signed integer multiplication overflow detected!\n");

59  (
a
*
b
);

60 
	}
}

	@Books/Linux-Kernel-Programming/solutions_to_assgn/ch8/slab_ptr_array/slab_ptr_array.c

32 
	~<löux/öô.h
>

33 
	~<löux/moduÀ.h
>

34 
	~<löux/kî√l.h
>

35 
	~<löux/¶ab.h
>

37 
	#OURMODNAME
 "¶ab_±r_¨øy"

	)

38 
	#SLAB_MAXLOOP
 5

	)

40 
MODULE_AUTHOR
("Kaiwan N Billimoria");

41 
MODULE_DESCRIPTION
("LKDC book:solutions_to_assgn/ch8/slab_ptr_array/:ássignment solution");

42 
MODULE_LICENSE
("Dual MIT/GPL");

43 
MODULE_VERSION
("0.1");

45 *
	ggk±r
[
SLAB_MAXLOOP
];

47 
__öô
 
	$¶ab_±r_¨øy_öô
()

49 
i
 = 0, 
j
;

51 
	`¥_öfo
("%s: in£πed\n", 
OURMODNAME
);

53 
i
 < 
SLAB_MAXLOOP
) {

54 
gk±r
[
i
] = 
	`kmÆloc
(1024, 
GFP_KERNEL
);

55 i‡(!
gk±r
[
i
]) {

57 
	`¥_w¨n
("%s: kmÆlo¯ôî %d faûed!\n", 
OURMODNAME
, 
i
);

61 
˛ónup
;

63 
	`mem£t
(
gk±r
[
i
], i+0x61, 1024);

64 
	`¥öt_hex_dump_byãs
("gk±r: ", 
DUMP_PREFIX_NONE
, 
gk±r
[
i
], 16);

65 
i
++;

69 
˛ónup
:

70 
j
 = 
i
; j > 0; j--) {

71 
	`¥_debug
(" fªeög gk±r[%d]\n", 
j
);

72 
	`k‰ì
(
gk±r
[
j
]);

74  -
ENOMEM
;

75 
	}
}

77 
__exô
 
	$¶ab_±r_¨øy_˛ónup
()

79 
i
;

81 
i
 = 0; i < 
SLAB_MAXLOOP
; i++) {

82 
	`¥_debug
("%s:%s(): freeing gkptr[%d]\n",

83 
OURMODNAME
, 
__func__
, 
i
);

84 
	`k‰ì
(
gk±r
[
i
]);

86 
	`¥_öfo
("%s: fªed mem‹y,Ñemoved\n", 
OURMODNAME
);

87 
	}
}

89 
moduÀ_öô
(
¶ab_±r_¨øy_öô
);

90 
moduÀ_exô
(
¶ab_±r_¨øy_˛ónup
);

	@Books/Linux-Kernel-Programming/solutions_to_assgn/ch9/slab_custom_mult/slab_custom_mult.c

40 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

42 
	~<löux/öô.h
>

43 
	~<löux/moduÀ.h
>

44 
	~<löux/kî√l.h
>

45 
	~<löux/¶ab.h
>

46 
	~<löux/vîsi⁄.h
>

48 
	#OURMODNAME
 "¶ab_cu°om_mu…"

	)

49 
	#OURCACHENAME
 "our_¶ab"

	)

51 
	#ASSERT_HELPER
(
ex¥
) do { \

52 i‡(!(
ex¥
)) { \

53 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

54 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

56 } 0)

	)

58 
MODULE_AUTHOR
("Kaiwan N Billimoria");

59 
MODULE_DESCRIPTION
("LKDC book:solutions_to_assgn/ch9/slab_custom_mult:ássigment solution");

60 
MODULE_LICENSE
("Dual MIT/GPL");

61 
MODULE_VERSION
("0.1");

63 
	#OURMAX_CACHES
 100

	)

64 
	#MAX_ALLOW
 1*1024*1024

	)

66 
	gxÁ˘‹
 = 300;

67 
moduÀ_∑øm
(
xÁ˘‹
, , 0644);

68 
MODULE_PARM_DESC
(
xÁ˘‹
, "multiplier factor by which custom cache size increases [def=300]");

71 
kmem_ˇche
 *
	gour_Œkd_ˇchï
[
OURMAX_CACHES
];

73 
	$u£_our_ˇche
(
idx
)

75 *
obj
 = 
NULL
;

77 #i‡
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,39)

78 
	`¥_öfo
("Cachê«mêi†%s\n", 
	`kmem_ˇche_«me
(
our_Œkd_ˇchï
[
idx
]));

80 
	`¥_öfo
("idx %d: our cache object size is %u bytes\n",

81 
idx
, 
	`kmem_ˇche_size
(
our_Œkd_ˇchï
[idx]));

83 
obj
 = 
	`kmem_ˇche_Æloc
(
our_Œkd_ˇchï
[
idx
], 
GFP_KERNEL
);

84 i‡(!
obj
) {

85 
	`¥_w¨n
("kmem_ˇche_Æloc(ËÁûed, index %d\n", 
idx
);

89 
	`kmem_ˇche_‰ì
(
our_Œkd_ˇchï
[
idx
], 
obj
);

90 
	}
}

92 
	$¸óã_cu°_Œkd_ˇche
(
idx
, 
size_t
 
sz
)

94 
îr
 = 0;

95 
nm
[128];

97 i‡(!(
idx
 % 30))

98 
	`¥_öfo
("idx %d:Ñequúed sizêi†%zu byãs\n", 
idx
, 
sz
);

104 
	`mem£t
(
nm
, 0, 128);

105 
	`¢¥ötf
(
nm
, 127, "%s-%d", 
OURCACHENAME
, 
idx
);

106 
our_Œkd_ˇchï
[
idx
] = 
	`kmem_ˇche_¸óã
(
nm
, 
sz
, 0,

107 
SLAB_POISON
 | 
SLAB_RED_ZONE
 | 
SLAB_HWCACHE_ALIGN
,

108 
NULL
);

109 i‡(!
our_Œkd_ˇchï
[
idx
]) {

110 
	`¥_w¨n
("kmem_ˇche_¸óã(Ë⁄ index %d faûed\n", 
idx
);

111 i‡(
	`IS_ERR
(
our_Œkd_ˇchï
[
idx
]))

112 
îr
 = 
	`PTR_ERR
(
our_Œkd_ˇchï
[
idx
]);

113  
îr
;

117 
	}
}

119 
	$¸óã_our_Œkd_ˇches
()

121 
i
;

122 
size_t
 
sz
;

124 
i
 = 0; i < 
OURMAX_CACHES
; i++) {

125 
sz
 = (
i
+1)*
xÁ˘‹
;

126 
	`ASSERT_HELPER
(
sz
 > 0 && sz < 
MAX_ALLOW
);

127 i‡(
	`¸óã_cu°_Œkd_ˇche
(
i
, 
sz
) < 0)

128  -
i
;

131 
	}
}

133 
__öô
 
	$¶ab_cu°om_mu…_öô
()

135 
i
, 
ªt
;

137 
	`¥_öfo
("# custom cachesÅo create = %d, xfactor=%d, MAX_ALLOW=%d\n",

138 
OURMAX_CACHES
, 
xÁ˘‹
, 
MAX_ALLOW
);

139 i‡((
OURMAX_CACHES
*
xÁ˘‹
Ë>
MAX_ALLOW
) {

140 
	`¥_öfo
("overflow (xfactor isÖrobablyÅoo big)\n");

141  -
EINVAL
;

144 i‡((
ªt
 = 
	`¸óã_our_Œkd_ˇches
()) < 0) {

145 
	`¥_w¨n
("custom slab cache creation failedát idx %d! Freeing up...\n",

146 -1*
ªt
);

147 
i
 = (-1*
ªt
)-1; i >= 0; i--)

148 
	`kmem_ˇche_de°roy
(
our_Œkd_ˇchï
[
i
]);

149  -
ENOMEM
;

152 
i
 = 0; i < 
OURMAX_CACHES
; i++)

153 
	`u£_our_ˇche
(
i
);

156 
	}
}

158 
__exô
 
	$¶ab_cu°om_mu…_exô
()

160 
i
;

162 
	`¥_öfo
("‰ìög cu°om cache†‰om 0Åÿ%d ...\n", 
OURMAX_CACHES
-1);

163 
i
 = 0; i < 
OURMAX_CACHES
; i++)

164 
	`kmem_ˇche_de°roy
(
our_Œkd_ˇchï
[
i
]);

165 
	`¥_öfo
("removed\n");

166 
	}
}

168 
moduÀ_öô
(
¶ab_cu°om_mu…_öô
);

169 
moduÀ_exô
(
¶ab_cu°om_mu…_exô
);

	@Training/L1_sysprg_trg/0_Makefile_template/killer/killer.c

13 
	~<sig«l.h
>

14 
	~<°dio.h
>

15 
	~<uni°d.h
>

16 
	~<sys/ty≥s.h
>

17 
	~<sys/waô.h
>

18 
	~<°rög.h
>

19 
	~<°dlib.h
>

21 
	#SIG2SEND
 
SIGUSR1


	)

26 
	$ˇtchô
(
signo
)

28 i‡(
signo
 =
SIG2SEND
) {

29 
¥ötf


31 
	`gëpid
(), 
SIG2SEND
);

32 
	`exô
(0);

34 
	`¥ötf
("%s:Éº‹, h™dÀ∏f‹ %d o∆y\n", 
__func__
, 
SIG2SEND
);

35 
	}
}

37 
	$maö
(
¨gc
, **
¨gv
)

39 
pid_t
 
pid
, 
n
;

40 
siga˘i⁄
 
a˘
;

41 
	#MAXTRIES
 3

	)

42 
åy
 = 0;

44 
	`mem£t
(&
a˘
, 0, (act));

45 
a˘
.
ß_h™dÀr
 = 
ˇtchô
;

46 
	`sigem±y£t
(&
a˘
.
ß_mask
);

47 
a˘
.
ß_Êags
 = 
SA_RESTART
;

49 i‡(
	`siga˘i⁄
(
SIG2SEND
, &
a˘
, 0) == -1) {

50 
	`≥º‹
("killer: sigaction failed.");

51 
	`exô
(1);

54 (
pid
 = 
	`f‹k
())) {

56 
	`≥º‹
("fork failed");

57 
	`exô
(1);

59 ()
	`∑u£
();

61 
	`¥ötf
("chûd %d dyögÇow\n", 
	`gëpid
());

62 
	`exô
(0);

64 
	`¥ötf
("∑ª¡ i†%d, chûd i†%d\n", 
	`gëpid
(), 
pid
);

66 
	`kûl
(
pid
, 0) < 0) {

67 
	`¥ötf
(".");

68 
	`fÊush
(
°dout
);

69 i‡(
åy
 >
MAXTRIES
) {

70 
	`Ârötf
(
°dîr
,

72 
¨gv
[0]);

73 
	`exô
(1);

75 ()
	`¶ìp
(1);

76 
åy
++;

78 
	`¥ötf
("\nSending signal #%dÅo childÖrocess (%d)Çow...\n",

79 
SIG2SEND
, 
pid
);

80 i‡(
	`kûl
(
pid
, 
SIG2SEND
) < 0) {

81 
	`≥º‹
("kill(2) failed");

82 
	`exô
(1);

85 
n
 = 
	`waô
(0);

86 i‡(
n
 == -1) {

87 
	`≥º‹
("wait failed");

88 
	`exô
(1);

90 
	`¥ötf
("parent %d: childÖrocess fetched, wait "

91 "ªtu∫ed %d\n", 
	`gëpid
(), 
n
);

94 
	}
}

	@Training/L1_sysprg_trg/assert_try/assert_try.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	~<as£π.h
>

4 
	~<°dlib.h
>

6 
	g¨r
[5];

8 
	$foo
(
num
)

10 
i
;

11 
	`as£π
(
num
 =(
¨r
));

13 
i
=0; i<=
num
; i++)

14 
¨r
[
i
] = 'x';

15 
	}
}

17 
	$maö
()

19 
loc
;

21 
	`¥ötf
("Hello,ássert world\n");

22 
	`as£π
(
loc
 == 0);

23 
	`foo
(6);

24 
	`exô
(0);

25 
	}
}

	@Training/L1_sysprg_trg/assert_try/assert_try2.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	~<as£π.h
>

5 
	$foo
()

8 
r
, 
q
;

10 
r
 = 3.14, 
q
;

12 
Á˘‹x
 = 3;

16 
	`as£π
(
r
 == 3.14);

18 
q
 = 
r
*
Á˘‹x
;

20 
	`¥ötf
("r=%.2f, q=%.2f\n", 
r
, 
q
);

21 
	}
}

23 
	$maö
()

25 
	`foo
();

27 
	}
}

	@Training/L1_sysprg_trg/common.c

7 
	#_GNU_SOURCE


	)

8 
	~<°dio.h
>

9 
	~<°dlib.h
>

10 
	~<°d¨g.h
>

11 
	~<uni°d.h
>

12 
	~<°rög.h
>

13 
	~<î∫o.h
>

14 
	~"comm⁄.h
"

16 
	$h™dÀ_îr
(
Áèl
, c⁄° *
fmt
, ...)

18 
	#ERRSTRMAX
 512

	)

19 *
îr_°r
;

20 
va_li°
 
¨gp
;

22 
îr_°r
 = 
	`mÆloc
(
ERRSTRMAX
);

23 i‡(
îr_°r
 =
NULL
)

26 
	`va_°¨t
(
¨gp
, 
fmt
);

27 
	`v¢¥ötf
(
îr_°r
, 
ERRSTRMAX
-1, 
fmt
, 
¨gp
);

28 
	`va_íd
(
¨gp
);

30 
	`Ârötf
(
°dîr
, "%s", 
îr_°r
);

31 i‡(
î∫o
)

32 
	`≥º‹
("perror says");

34 
	`‰ì
(
îr_°r
);

35 i‡(!
Áèl
)

37 
	`exô
(
Áèl
);

38 
	}
}

43 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

44 
timevÆ
 *
y
)

47 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

48 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

49 
y
->
tv_u£c
 -1000000 * 
n£c
;

50 
y
->
tv_£c
 +
n£c
;

52 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

53 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

54 
y
->
tv_u£c
 +1000000 * 
n£c
;

55 
y
->
tv_£c
 -
n£c
;

60 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

61 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

64  
x
->
tv_£c
 < 
y
->tv_sec;

65 
	}
}

76 
	$dec2bö
(
decimÆ
, *
bö¨y
)

78 
k
 = 0, 
n
 = 0;

79 
√g_Êag
 = 0;

80 
ªmaö
;

90 #unde‡
TESTMODE


92 #ifde‡
TESTMODE


93 
ﬁd_decimÆ
;

95 
ãmp
[80];

98 i‡(
decimÆ
 < 0) {

99 
decimÆ
 = -decimal;

100 
√g_Êag
 = 1;

103 #ifde‡
TESTMODE


104 
ﬁd_decimÆ
 = 
decimÆ
;

106 
ªmaö
 = 
decimÆ
 % 2;

108 
decimÆ
 = decimal / 2;

110 #ifde‡
TESTMODE


111 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

112 
ªmaö
);

115 
ãmp
[
k
++] = 
ªmaö
 + '0';

116 } 
decimÆ
 > 0);

118 i‡(
√g_Êag
)

119 
ãmp
[
k
++] = '-';

121 
ãmp
[
k
++] = ' ';

124 
k
 >= 0)

125 
bö¨y
[
n
++] = 
ãmp
[--
k
];

127 
bö¨y
[
n
 - 1] = 0;

128 
	}
}

136 #i‚de‡
_TIME_H


137 
	~<time.h
>

139 
	$r_¶ìp
(
time_t
 
£c
, 
n£c
)

141 
time•ec
 
ªq
, 
ªm
;

143 
ªq
.
tv_£c
 = 
£c
;

144 
ªq
.
tv_n£c
 = 
n£c
;

145 
	`«no¶ìp
(&
ªq
, &
ªm
) == -1) {

146 i‡(
î∫o
 !
EINTR
)

152 #ifde‡
DEBUG


153 
	`Ârötf
(
°dîr
,

155 
ªm
.
tv_£c
,Ñem.
tv_n£c
);

157 
ªq
 = 
ªm
;

160 
	}
}

168 
	$hex_dump
(*
d©a
, 
size
, *
ˇ±i⁄
, 
vîbo£
)

170 
i
;

171 
j
;

172 
ãmp
[16];

173 
buf„r
[128];

174 *
ascii
;

176 
	`mem£t
(
buf„r
, 0, 128);

178 i‡(
vîbo£
 && 
ˇ±i⁄
)

179 
	`¥ötf
("---------> %†<--------- (%d byã†‰om %p)\n", 
ˇ±i⁄
,

180 
size
, 
d©a
);

183 
¥ötf


188 
ascii
 = 
buf„r
 + 58;

189 
	`mem£t
(
buf„r
, ' ', 58 + 16);

190 
buf„r
[58 + 16] = '\n';

191 
buf„r
[58 + 17] = '\0';

192 
buf„r
[0] = '+';

193 
buf„r
[1] = '0';

194 
buf„r
[2] = '0';

195 
buf„r
[3] = '0';

196 
buf„r
[4] = '0';

197 
i
 = 0, 
j
 = 0; i < 
size
; i++, j++) {

198 i‡(
j
 == 16) {

199 
	`¥ötf
("%s", 
buf„r
);

200 
	`mem£t
(
buf„r
, ' ', 58 + 16);

202 
	`•rötf
(
ãmp
, "+%04x", 
i
);

203 
	`mem˝y
(
buf„r
, 
ãmp
, 5);

205 
j
 = 0;

208 
	`•rötf
(
ãmp
, "%02x", 0xf‡& 
d©a
[
i
]);

209 
	`mem˝y
(
buf„r
 + 8 + (
j
 * 3), 
ãmp
, 2);

210 i‡((
d©a
[
i
] > 31) && (data[i] < 127))

211 
ascii
[
j
] = 
d©a
[
i
];

213 
ascii
[
j
] = '.';

216 i‡(
j
 != 0)

217 
	`¥ötf
("%s", 
buf„r
);

218 
	}
}

220 
	$D¥öt
(c⁄° *
fmt
, ...)

222 
va_li°
 
≠
;

223 #ifde‡
DEBUG


224 
	`va_°¨t
(
≠
, 
fmt
);

225 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

226 
	`va_íd
(
≠
);

228 
	}
}

	@Training/L1_sysprg_trg/common.h

7 #i‚de‡
_COMMON_H_


8 
	#_COMMON_H_


	)

10 #i‚de‡
_GNU_SOURCE


11 
	#_GNU_SOURCE


	)

15 
	~<°dio.h
>

16 
	~<°rög.h
>

17 
	~<°d¨g.h
>

18 
	~<uni°d.h
>

19 
	~<°dlib.h
>

22 
	#NON_FATAL
 0

	)

23 
h™dÀ_îr
(
Áèl
, c⁄° *
fmt
, ...);

24 
D¥öt
(c⁄° *
fmt
, ...);

26 
	#WARN
(
w¨nmsg
, 
¨gs
...) do { \

27 
	`h™dÀ_îr
(
NON_FATAL
, "!WARNING! %s:%s:%d: " 
w¨nmsg
, \

28 
__FILE__
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

29 } 0)

	)

30 
	#FATAL
(
îrmsg
, 
¨gs
...) do { \

31 
	`h™dÀ_îr
(
EXIT_FAILURE
, "FATAL:%s:%s:%d: " 
îrmsg
, \

32 
__FILE__
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

33 } 0)

	)

36 
ölöe
 
	$bìp
(
wh©
)

38 
buf
[1];

39 
buf
[0] = 
wh©
;

40 ()
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1);

41 
	}
}

48 
	#HZ
 250

	)

49 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

51 
c
=0, 
m
; \

52 
f‹_ödex
,
ö√r_ödex
; \

54 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

55 
	`bìp
((
vÆ
)); \

56 
c
++; \

57 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000;inner_index++) \

58 
m
=0;m<50;m++); \

61 }

	)

	@Training/L1_sysprg_trg/convenient.h

11 #i‚de‡
__CONVENIENT_H__


12 
	#__CONVENIENT_H__


	)

14 
	~<asm/∑øm.h
>

15 
	~<löux/sched.h
>

17 #ifde‡
__KERNEL__


18 
	~<löux/øãlimô.h
>

44 #unde‡
USE_FTRACE_PRINT


46 #ifde‡
USE_FTRACE_PRINT


47 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

48 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
)

	)

50 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

51 
USE_RATELIMITING
 = 0; \

52 i‡(
USE_RATELIMITING
) { \

53 
	`¥_öfo_øãlimôed
(
	`¥_fmt
(
°rög
), ##
¨gs
); \

56 
	`¥_öfo
(
	`¥_fmt
(
°rög
), ##
¨gs
); \

57 } 0)

	)

62 #ifde‡
DEBUG


63 #ifde‡
__KERNEL__


64 
	#MSG
(
°rög
, 
¨gs
...) \

65 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
)

	)

67 
	#MSG
(
°rög
, 
¨gs
...) \

68 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
)

	)

71 #ifde‡
__KERNEL__


72 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

73 
	`DBGPRINT
(
°rög
, ##
¨gs
)

	)

75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

76 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
)

	)

80 
	#QP
 
	`MSG
("\n")

	)

82 #ifde‡
__KERNEL__


83 
	#QPDS
 do { \

84 
	`MSG
("\n"); \

85 
	`dump_°ack
(); \

86 } 0)

	)

89 #ifde‡
__KERNEL__


90 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

91 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
) \

92 } 0)

	)

95 
	#MSG
(
°rög
, 
¨gs
...)

	)

96 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

97 
	#QP


	)

98 
	#QPDS


	)

101 #ifde‡
__KERNEL__


123 
	~<löux/sched.h
>

124 
	~<löux/öãºu±.h
>

126 #i‚de‡
USE_FTRACE_PRINT


127 
	#PRINT_CTX
() do { \

128 
£p
 = '|', 
öå
 = '.'; \

130 i‡(
	`ö_öãºu±
()) { \

131 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

132 
öå
 = 'H'; \

133 i‡(
	`ö_úq
()) \

134 
öå
 = 'h'; \

135 i‡(
	`ö_so·úq
()) \

136 
öå
 = 's'; \

139 
öå
 = '.'; \

141 
	`DBGPRINT
( \

145 , 
	`smp_¥o˚ss‹_id
(), \

146 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

147 (
	`úqs_dißbÀd
()?'d':'.'), \

148 (
	`√ed_ªsched
()?'N':'.'), \

149 
öå
, \

150 (
	`¥ìm±_cou¡
() && 0xff) \

152 } 0)

	)

154 
	#PRINT_CTX
() do { \

155 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, \

156 
cuºít
->
pid
); \

157 i‡(!
	`ö_öãºu±
()) { \

158 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

159 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!current->mm?']':' '), \

160 
cuºít
->
pid
); \

162 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

164 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

165 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

167 } 0)

	)

183 #ifde‡
__KERNEL__


184 
	#as£π
(
ex¥
) do { \

185 i‡(!(
ex¥
)) { \

186 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

187 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

189 } 0)

	)

193 
ölöe
 
	$bìp
(
wh©
)

195 #ifde‡
__KERNEL__


196 
	`DBGPRINT
("%c", ()
wh©
);

198 
buf
 = ()
wh©
;

199 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

210 
c
 = 0, 
m
; \

211 
f‹_ödex
, 
ö√r_ödex
; \

213 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++; \

216 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
*1000*8; inner_index++) \

217 
m
 = 0; m < 50; m++) \

221 }

	)

224 #ifde‡
__KERNEL__


229 
	#DELAY_SEC
(
vÆ
) \

231 i‡(!
	`ö_öãºu±
()) { \

232 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
); \

233 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
); \

235 }

	)

	@Training/L1_sysprg_trg/exec/1_exec_poc/exec_poc.c

11 
	~<°dio.h
>

12 
	~<uni°d.h
>

13 
	~<°dlib.h
>

15 
	$maö
(
¨gc
, **
¨gv
)

17 
	`¥ötf
("Pªde˚ss‹ \"%s\": PID i†%d\n", 
¨gv
[0], 
	`gëpid
());

18 
	`¥ötf
("%s: wû»exe¯\"ps\"Çow..\n", 
¨gv
[0]);

27 i‡(
	`exe˛
("/bin/ps", "ps", (*)0) == -1) {

28 
	`≥º‹
("execl failed");

29 
	`exô
(1);

32 
	`exô
(0);

33 
	}
}

	@Training/L1_sysprg_trg/exec/2_exec_envp/envp.c

8 
	~<°dio.h
>

9 
	~<uni°d.h
>

10 
	~<°rög.h
>

11 
	~<°dlib.h
>

13 **
ívú⁄
;

14 
	#MAXENV
 4096

	)

16 
	$maö
(
¨gc
, **
¨gv
)

18 
i
, 
j
;

19 *
ívp
[
MAXENV
];

20 *
s
 = "TERM=dialup";

22 
i
 = 0; 
ívú⁄
[i] !
NULL
; i++)

23 
ívp
[
i
] = 
ívú⁄
[i];

24 
ívp
[
i
] = 
NULL
;

30 
j
 = 0;

31 (
j
 < (
i
 - 1)Ë&& (
	`°∫cmp
("TERM=", 
ívp
[j], 5) != 0))

32 
j
++;

33 i‡(
j
 >(
i
 - 1)) {

34 
	`Ârötf
(
°dîr
, "%s:Énv variable TERMÇot found. Aborting..\n",

35 
¨gv
[0]);

36 
	`exô
(1);

38 
ívp
[
j
] = 
s
;

48 i‡(
	`exe˛e
("/u§/bö/¥öãnv", "¥öãnv", (*)0, 
ívp
) < 0) {

49 
	`≥º‹
(
¨gv
[0]);

50 
	`exô
(1);

52 
	`exô
(0);

54 
	}
}

	@Training/L1_sysprg_trg/exec/3_exec_a_script/exec_a_script.c

10 
	~<°dio.h
>

11 
	~<uni°d.h
>

12 
	~<°dlib.h
>

14 
	$maö
(
¨gc
, **
¨gv
)

16 *
s¸ùt
 = "./tiny_script.sh";

18 
	`¥ötf
("Pªde˚ss‹ \"%s\": PID i†%d\n", 
¨gv
[0], 
	`gëpid
());

19 
	`¥ötf
("%s: wû»exe¯thêbash s¸ùà\"%s\"Çow..\n", 
¨gv
[0], 
s¸ùt
);

21 i‡(
	`exe˛
("/bö/bash", "bash", "-c", 
s¸ùt
, (*)0) == -1) {

22 
	`≥º‹
("execl failed");

23 
	`exô
(1);

26 
	`exô
(0);

27 
	}
}

	@Training/L1_sysprg_trg/fork/fork2c/fork2c.c

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/waô.h
>

11 
	$di•œyChûdSètus
(
°©
, 
pid_t
 
˝id
)

13 
	`¥ötf
("\nChild %d just died!\n"

22 
˝id
,

23 
	`WIFEXITED
(
°©
),

24 
	`WEXITSTATUS
(
°©
),

25 
	`WIFSIGNALED
(
°©
),

26 
	`WTERMSIG
(
°©
),

27 
	`WIFSTOPPED
(
°©
),

28 
	`WSTOPSIG
(
°©
), 
	`WCOREDUMP
(°©), 
	`WIFCONTINUED
(stat)

30 
	}
}

32 
	$¸óãChûd
(
¶ìp_time
)

34 
pid_t
 
n
;

36 
n
 = 
	`f‹k
()) {

38 
	`≥º‹
("fork");

39 
	`exô
(1);

41 
	`¥ötf
("Chûd 2 PID %d sÀïög f‹ %ds...\n", 
	`gëpid
(),

42 
¶ìp_time
);

43 
	`¶ìp
(
¶ìp_time
);

44 
	`exô
(0);

48 
	}
}

50 
	$chkønge
(
num
, 
mö
, 
max
)

52 i‡(
num
 < 
mö
)

54 i‡(
num
 > 
max
)

57 
	}
}

59 
	$maö
(
¨gc
, **
¨gv
)

61 
°©
 = 0;

62 
c1_¶±m
 = 3, 
c2_¶±m
 = 7;

63 
pid_t
 
n
, 
˝id
;

65 i‡(
¨gc
 == 3) {

66 
c1_¶±m
 = 
	`©oi
(
¨gv
[1]);

67 i‡(
	`chkønge
(
c1_¶±m
, 1, 60) < 0) {

68 
	`Ârötf
(
°dîr
,

70 "Ñ™gê[1-60]\n", 
¨gv
[0], 
c1_¶±m
);

71 
	`exô
(1);

73 
c2_¶±m
 = 
	`©oi
(
¨gv
[2]);

74 i‡(
	`chkønge
(
c2_¶±m
, 1, 60) < 0) {

75 
	`Ârötf
(
°dîr
,

77 "Ñ™gê[1-60]\n", 
¨gv
[0], 
c2_¶±m
);

78 
	`exô
(1);

82 
n
 = 
	`f‹k
()) {

84 
	`≥º‹
("fork");

85 
	`exô
(1);

87 
	`¥ötf
("Chûd 1 PID %d sÀïög f‹ %ds...\n", 
	`gëpid
(),

88 
c1_¶±m
);

89 
	`¶ìp
(
c1_¶±m
);

90 
	`exô
(0);

92 
	`¸óãChûd
(
c2_¶±m
);

93 (
˝id
 = 
	`waô
(&
°©
)) != -1)

94 
	`di•œyChûdSètus
(
°©
, 
˝id
);

96 
	`¥ötf
("\nParent:áll children dead,Éxiting...\n");

97 
	`exô
(0);

98 
	}
}

	@Training/L1_sysprg_trg/fork/fork_data_addr/fork_data_addr.c

15 
	~<°dio.h
>

16 
	~<uni°d.h
>

17 
	~<°dlib.h
>

18 
	~<°rög.h
>

19 
	~<sys/waô.h
>

21 
	#FEW
 16

	)

22 *
	gp
;

24 
	#PR
(
pi
, 
pj
) do { \

25 
	`¥ötf
 (" i=%d j=%d\n" \

26 " &i=%∞&j=%p\n", 
pi
, 
pj
, (*)&pi, (*)&pj); \

27 } 0)

	)

29 
	$maö
(
¨gc
, **
¨gv
)

31 
pid_t
 
ªt
 = 0;

32 
i
 = 5, 
j
 = 6, 
pgsz
 = 
	`gë∑gesize
();

34 
p
 = 
	`mÆloc
(
pgsz
);

35 i‡(!
p
) {

36 
	`¥ötf
("malloc failed,áborting!\n");

37 
	`exô
(1);

40 
ªt
 = 
	`f‹k
()) {

42 
	`≥º‹
("fork failed");

43 
	`exô
(1);

45 
	`¥ötf
("\nChild: before var update: ");

46 
	`PR
(
i
, 
j
);

47 
i
--;

48 
j
++;

49 
	`¥ötf
("Child:áfter var update: ");

50 
	`PR
(
i
, 
j
);

52 
	`mem£t
(
p
, 'c', 
pgsz
);

53 
	`¥ötf
("\nChûd: mÆlo¯ªt: %p\n", 
p
);

55 
k
;

57 
k
 = 0; k < 
FEW
; k++)

58 
	`¥ötf
("%¯", 
p
[
k
]);

59 
	`¥ötf
("\n");

61 
	`∑u£
();

63 
	`‰ì
(
p
);

65 
	`exô
(0);

69 
	`¥ötf
("\nParent: before var update: ");

70 
	`PR
(
i
, 
j
);

71 
	`¥ötf
("\nParent:áfter var update: ");

72 
i
++;

73 
j
--;

74 
	`PR
(
i
, 
j
);

76 
	`mem£t
(
p
, 'p', 
pgsz
);

77 
	`¥ötf
("\nP¨ít: mÆlo¯ªt: %p\n", 
p
);

79 
k
;

81 
k
 = 0; k < 
FEW
; k++)

82 
	`¥ötf
("%¯", 
p
[
k
]);

83 
	`¥ötf
("\n");

85 
	`∑u£
();

86 
	`‰ì
(
p
);

94 
	`∑u£
();

95 
	`exô
(0);

96 
	}
}

	@Training/L1_sysprg_trg/fork/fork_ret.c

2 
	~<°dio.h
>

3 
	~<uni°d.h
>

4 
	~<°dlib.h
>

5 
	~<sys/waô.h
>

7 
	$maö
(
¨gc
, **
¨gv
)

9 
pid_t
 
ªt
 = 0;

11 
ªt
 = 
	`f‹k
()) {

14 
	`≥º‹
("fork failed");

15 
	`exô
(1);

17 
	`¥ötf
("Chûd: PID = %d,Ñëu∫ vÆuê%d\n", 
	`gëpid
(), 
ªt
);

19 
	`exô
(0);

21 
	`¥ötf
("P¨ít: PID = %d,Ñëu∫ vÆuê%d\n", 
	`gëpid
(), 
ªt
);

22 
	`waô
(0);

26 
	`exô
(0);

27 
	}
}

	@Training/L1_sysprg_trg/fork/forkbomb1.c

2 
	~"../comm⁄.h
"

3 
	~<°dio.h
>

4 
	~<°dlib.h
>

5 
	~<°rög.h
>

6 
	~<uni°d.h
>

7 
	~<sys/time.h
>

8 
	~<sys/ªsour˚.h
>

10 c⁄° 
	gBLK_MMAP
 = 512 * 1024;

11 c⁄° 
	gBLK_HEAP
 = 5 * 1024;

13 
	$maö
(
¨gc
, **
¨gv
)

15 
æimô
 
æim
;

16 
°ªss
=0, 
i
;

17 *
pmm≠
, *
phóp
;

19 i‡(
¨gc
 != 3) {

20 
	`Ârötf
(
°dîr
, "Ußge: %†{num-times-to-f‹k} {°ªss-ô [0|1]}\n", 
¨gv
[0]);

21 
	`exô
(1);

23 i‡(
	`©oi
(
¨gv
[2]) == 1)

24 
°ªss
=1;

26 i‡(
	`¥limô
(0, 
RLIMIT_NPROC
, 0, &
æim
) == -1)

27 
	`FATAL
("prlimit failed\n");

28 
	`¥ötf
("ResourceÜimit RLIMIT_NPROC :: hard: %ld soft: %ld\n",

29 
æim
.
æim_max
,Ñlim.
æim_cur
);

31 
i
 = 0; i < 
	`©oi
(
¨gv
[1]); i++) {

32 
	`f‹k
()) {

33 -1 : 
	`FATAL
("f‹k faûed: iãøti⁄ #%d\n", 
i
);

35 
pmm≠
 = 
	`mÆloc
(
BLK_MMAP
);

36 
phóp
 = 
	`mÆloc
(
BLK_HEAP
);

37 i‡(
°ªss
) {

38 
	`mem£t
(
pmm≠
, 0xff, 
BLK_MMAP
);

39 
	`mem£t
(
phóp
, 0xì, 
BLK_HEAP
);

42 
	`∑u£
();

44 i‡(
i
 && !(i%1000))

45 
	`¥ötf
("%6d ...\n", 
i
);

48 
	`exô
(0);

49 
	}
}

	@Training/L1_sysprg_trg/fork/mysh/mysh.c

13 
	~<°dio.h
>

14 
	~<°d¨g.h
>

15 
	~<uni°d.h
>

16 
	~<°rög.h
>

17 
	~<°dlib.h
>

18 
	~<sys/waô.h
>

19 
	~<sys/time.h
>

20 
	~<sys/ªsour˚.h
>

22 
	#LEN
 128

	)

23 
	#MAXARGS
 1024

	)

24 
	#PROMPT
 "mysh> "

	)

25 
	#SEP
 " "

	)

27 
	#ON
 1

	)

28 
	#OFF
 0

	)

30 
	gMYDEBUG
 = 
OFF
;

31 
	#SHOWARGS
() do { \

32 
i
; \

33 i‡(
MYDEBUG
) { \

34 
i
 = 0; i < 
MAXARGS
; i++) \

35 
	`¥ötf
("newargs[%d]=%p\n \
_newargs[%d]=%p\n", \

37 
i
, 
√w¨gs
[i],\

38 
i
, 
‹ig_√w¨gs
[i]); \

40 } 0)

	)

42 
	$D¥öt
(c⁄° *
fmt
, ...)

44 
va_li°
 
≠
;

46 i‡(
MYDEBUG
 =
OFF
)

48 
	`va_°¨t
(
≠
, 
fmt
);

49 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

50 
	`va_íd
(
≠
);

51 
	}
}

53 
ölöe
 
	$‰ì_¨gs
(**
¨gs
)

55 
i
;

57 
i
 = 0; i < 
MAXARGS
; i++) {

58 i‡(
¨gs
[
i
])

59 
	`‰ì
(
¨gs
[
i
]);

61 
	}
}

63 
	$di•œyChûdSètus
(
°©
, 
pid_t
 
˝id
)

65 
	`¥ötf
("\nChûd %d ju° dõd!\n", 
˝id
);

66 i‡(
	`WIFEXITED
(
°©
))

67 
	`¥ötf
("ÉxitedÇormally,Éxit status: %d\n",

68 
	`WEXITSTATUS
(
°©
));

69 i‡(
	`WIFSIGNALED
(
°©
))

70 
	`¥ötf
("Éxitedábnormally, signal killed with: %d\n",

71 
	`WTERMSIG
(
°©
));

72 i‡(
	`WIFSTOPPED
(
°©
))

73 
	`¥ötf
(" st›≥d; st› sig«l: %d\n", 
	`WSTOPSIG
(
°©
));

74 i‡(
	`WCOREDUMP
(
°©
))

75 
	`¥ötf
(" dumped core.\n");

76 i‡(
	`WIFCONTINUED
(
°©
))

77 
	`¥ötf
(" continued.\n");

78 
	}
}

80 
	$show_ªsußge
(c⁄° 
rußge
 *rusage)

83 
	`¥ötf
("Resource usage stats ::\n"

93 
rußge
->
ru_utime
.
tv_£c
,

94 
rußge
->
ru_utime
.
tv_u£c
,Ñußge->
ru_°ime
.
tv_£c
,

95 
rußge
->
ru_°ime
.
tv_u£c
,Ñußge->
ru_maxrss
,Ñußge->
ru_möÊt
,

96 
rußge
->
ru_majÊt
,Ñußge->
ru_öblock
,Ñußge->
ru_oublock
,

97 
rußge
->
ru_nvcsw
,Ñußge->
ru_nivcsw
);

98 
	}
}

100 
	$maö
(
¨gc
, **
¨gv
)

102 
cmd
[
LEN
];

123 *
√w¨gs
[
MAXARGS
];

124 *
‹ig_√w¨gs
[
MAXARGS
];

125 
i
, 
°©
 = 0;

126 *
exô_°r
 = "q";

127 
pid_t
 
˝id
;

128 
rußge
 *rußgê
	`mÆloc
((rusage));

130 i‡((
¨gc
 > 1Ë&& (
	`°rcmp
(
¨gv
[1], "-D") == 0))

131 
MYDEBUG
 = 
ON
;

133 
i
 = 0; i < 
MAXARGS
; i++) {

134 
√w¨gs
[
i
] = 
	`mÆloc
(
LEN
);

135 i‡(
√w¨gs
[
i
] =
NULL
) {

136 
	`Ârötf
(
°dîr
, "%s:Ço memory forÇewargs[%d]..",

137 
¨gv
[0], 
i
);

138 
	`exô
(1);

140 
‹ig_√w¨gs
[
i
] = 
√w¨gs
[i];

142 
	`SHOWARGS
();

145 
	`SHOWARGS
();

147 
	`¥ötf
("%s", 
PROMPT
);

148 
	`fÊush
(
°dout
);

151 i‡(!
	`fgës
(
cmd
, 
LEN
, 
°dö
))

153 
cmd
[
	`°æí
(cmd) - 1] = '\0';

154 
	`D¥öt
("cmd:Üí=%d cmd=%s\n", 
	`°æí
(
cmd
), cmd);

156 i‡(
cmd
[0] == 0)

159 i‡(
	`°∫cmp
(
cmd
, 
exô_°r
, 
	`°æí
(cmd)) == 0) {

160 
	`¥ötf
("qÖressed.\n");

161 
	`‰ì_¨gs
(
‹ig_√w¨gs
);

162 
	`exô
(0);

168 
√w¨gs
[0] = 
	`°πok
(
cmd
, 
SEP
);

169 
i
 = 1;

170 (
√w¨gs
[
i
++] = 
	`°πok
(
NULL
, 
SEP
)));

172 i‡((
i
 - 2Ë> 
MAXARGS
) {

174 
	`Ârötf
(
°dîr
,

176 
¨gv
[0], 
MAXARGS
);

180 i‡(
MYDEBUG
) {

181 
i
 = 0;

182 
√w¨gs
[
i
]) {

183 
	`¥ötf
("\¬ew¨gs[%d]=%s\n", 
i
, 
√w¨gs
[i]);

184 
i
++;

186 
	`¥ötf
("\n");

189 
	`f‹k
()) {

191 
	`≥º‹
("fork failed");

194 
	`‰ì_¨gs
(
‹ig_√w¨gs
);

195 i‡(
	`execvp
(
√w¨gs
[0],Çewargs) == -1) {

196 
	`≥º‹
("exec failure");

197 
	`exô
(1);

206 
˝id
 = 
	`waô3
(&
°©
, 
WUNTRACED
, 
rußge
);

207 i‡(
˝id
 == -1) {

208 
	`≥º‹
("wait");

209 
	`exô
(1);

213 
	`di•œyChûdSètus
(
°©
, 
˝id
);

214 
	`show_ªsußge
(
rußge
);

220 
	}
}

	@Training/L1_sysprg_trg/fork/mysh_simple/mysh_simple.c

11 
	~<°dio.h
>

12 
	~<uni°d.h
>

13 
	~<°rög.h
>

14 
	~<°dlib.h
>

15 
	~<sys/ty≥s.h
>

16 
	~<sys/waô.h
>

17 
	~<°d¨g.h
>

19 
	#LEN
 128

	)

20 
	#PROMPT
 "mysh> "

	)

21 
	#ON
 1

	)

22 
	#OFF
 0

	)

24 
	gMYDEBUG
 = 
OFF
;

26 
	$D¥öt
(c⁄° *
fmt
, ...)

28 
va_li°
 
≠
;

30 i‡(
MYDEBUG
 =
OFF
)

32 
	`va_°¨t
(
≠
, 
fmt
);

33 
	`vÂrötf
(
°dîr
, 
fmt
, 
≠
);

34 
	`va_íd
(
≠
);

35 
	}
}

37 
	$maö
(
¨gc
, **
¨gv
)

39 
cmd
[
LEN
];

40 *
exô_°r
 = "q";

42 i‡((
¨gc
 > 1Ë&& (
	`°rcmp
(
¨gv
[1], "-d") == 0))

43 
MYDEBUG
 = 
ON
;

46 
	`¥ötf
("%s", 
PROMPT
);

47 
	`fÊush
(
°dout
);

50 i‡(!
	`fgës
(
cmd
, 
LEN
, 
°dö
))

52 
cmd
[
	`°æí
(cmd) - 1] = '\0';

53 
	`D¥öt
("cmd:Üí=%d, cmd=%s\n", 
	`°æí
(
cmd
), cmd);

55 i‡(
cmd
[0] == 0)

58 i‡(
	`°∫cmp
(
cmd
, 
exô_°r
, 
	`°æí
(cmd)) == 0) {

59 
	`¥ötf
("qÖressed.\n");

60 
	`exô
(0);

63 
	`f‹k
()) {

65 
	`≥º‹
("fork failed");

68 i‡(
	`exe˛p
(
cmd
, cmd, (*)0) == -1) {

69 
	`≥º‹
("exec failure");

70 
	`exô
(1);

77 i‡(
	`waô
(0) == -1)

78 
	`≥º‹
("waô"), 
	`exô
(1);

82 
	}
}

	@Training/L1_sysprg_trg/fork/orphan/orphan.c

24 
	~<°dio.h
>

25 
	~<uni°d.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<°dlib.h
>

29 
	$maö
(
¨gc
, **
¨gv
)

31 
pid_t
 
p
;

33 
p
 = 
	`f‹k
();

34 
p
) {

36 
	`≥º‹
("f‹k faûed"), 
	`exô
(1);

38 
	`¥ötf
("ChildÖid %d :Ö=%d; sleepingÇow for 10s..\n",

39 
	`gëpid
(), 
p
);

40 
	`¶ìp
(10);

41 
	`¥ötf
("Child: sleep done,Éxiting.\n");

42 
	`exô
(0);

44 
	`¥ötf
("P¨íàpid %d :Ö=%d;ÉxôögÇow \
‘esu…ög i¿™ oΩh™ed chûd)..\n", 
	`gëpid
(), 
p
);

46 
	`exô
(0);

48 
	}
}

	@Training/L1_sysprg_trg/fork/wait_fail.c

8 
	~<°dio.h
>

9 
	~<°dlib.h
>

10 
	~<uni°d.h
>

11 
	~<sys/ty≥s.h
>

12 
	~<sys/waô.h
>

13 
	~<î∫o.h
>

15 
	$maö
(
¨gc
, **
¨gv
)

17 
	`¥ötf
("Issuing wait()...\n");

18 i‡(
	`waô
(0) == -1) {

19 
	`¥ötf
("waôÑë -1;Éºnÿ%d\n", 
î∫o
);

20 
	`≥º‹
("wait failed");

21 
	`exô
(1);

23 
	`exô
(0);

24 
	}
}

	@Training/L1_sysprg_trg/fork/zombie/zombie.c

10 
	~<°dio.h
>

11 
	~<uni°d.h
>

12 
	~<sys/ty≥s.h
>

13 
	~<°dlib.h
>

15 
	$maö
(
¨gc
, **
¨gv
)

17 
pid_t
 
p
;

19 
p
 = 
	`f‹k
();

20 
p
) {

22 
	`≥º‹
("f‹k faûed"), 
	`exô
(1);

24 
¥ötf


26 
	`gëpid
(), 
p
);

27 
	`exô
(0);

30 
	`waô
(0);

32 
	`¥ötf
("P¨íàpid %d :Ö=%d; sÀïögÇow f‹ 300†wôhouàwaô()-ög \
‘esu…ög i¿™ oΩh™ed chûd)..\n", 
	`gëpid
(),

34 
p
);

35 
	`¶ìp
(300);

37 
	`¥ötf
("Parent: sleep done,Éxiting. Notice how (on Linux)Åhe \
 isÇow cleared!\n");

39 
	`exô
(0);

41 
	}
}

	@Training/L1_sysprg_trg/gdb/.correct.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<time.h
>

21 
	~<sys/°©.h
>

23 
	$maö
(
¨gc
, **
¨gv
)

25 
°©
 
°©buf
;

27 i‡(
¨gc
 != 2) {

28 
	`Ârötf
 (
°dîr
, "Ußge: %†fûíame\n", 
¨gv
[0]);

29 
	`exô
 (1);

33 
	`°©
(
¨gv
[1], &
°©buf
);

44 
	`¥ötf
("%s:\n"

48 
¨gv
[1], 
°©buf
.
°_öo
,

49 
°©buf
.
°_size
, 
	`˘ime
(&°©buf.
°_mtime
),

50 
°©buf
.
°_uid
, sètbuf.
°_gid
,

51 
°©buf
.
°_blksize
, sètbuf.
°_blocks
);

53 
	`exô
(0);

54 
	}
}

	@Training/L1_sysprg_trg/gdb/1_buggy.c

18 
	~<°dio.h
>

19 
	~<time.h
>

20 
	~<sys/°©.h
>

22 
	$maö
(
¨gc
, **
¨gv
)

24 
°©
 
°©buf
;

25 
cmd
[128];

27 i‡(
¨gc
 != 2) {

28 
	`Ârötf
(
°dîr
, "Usage: %s filename\n");

29 
	`exô
 (1);

33 
	`°©
(
¨gv
[1], &
°©buf
);

44 
	`¥ötf
("%s:\n"

48 
¨gv
[1], 
°©buf
.
°_öo
,

49 
°©buf
.
°_size
, 
	`˘ime
(°©buf.
°_mtime
),

50 
°©buf
.
°_uid
, sètbuf.
°_gid
,

51 
°©buf
.
°_blksize
, sètbuf.
°_blocks
);

53 
	`exô
(0);

54 
	}
}

	@Training/L1_sysprg_trg/gdb/gdb_2part_solution/1_buggy.c

18 
	~<°dio.h
>

19 
	~<time.h
>

20 
	~<sys/°©.h
>

22 
	$maö
(
¨gc
, **
¨gv
)

24 
°©
 
°©buf
;

26 i‡(
¨gc
 != 2) {

27 
	`Ârötf
 (
°dîr
, "Usage: %s filename\n");

28 
	`exô
 (1);

32 
	`°©
 (
¨gv
[1], &
°©buf
);

40 
	`¥ötf
 ("%s:\ninodeÇumber: %d : size (bytes): %d : mtime: %s\n",

41 
¨gv
[1], 
°©buf
.
°_öo
,

42 
°©buf
.
°_size
, 
	`˘ime
(°©buf.
°_mtime
));

44 
	`exô
 (0);

45 
	}
}

	@Training/L1_sysprg_trg/gdb/hxdump_buggy/hxdump_buggy.c

85 
	~<°dio.h
>

86 
	~<uni°d.h
>

87 
	~<löux/limôs.h
>

88 
	~<°dlib.h
>

89 
	~<°rög.h
>

90 
	~<sys/ty≥s.h
>

91 
	~<sys/°©.h
>

92 
	~<f˙é.h
>

94 
	#MAXCOL
 20

	)

96 
	$maö
–
¨gc
, **
¨gv
)

98 
FILE
 *
Â
;

99 *
∑th
, *
buf
;

100 
fd
, 
n
, 
j
, 
Àn
;

102 i‡(
¨gc
 != 3) {

103 
	`Ârötf
 (
°dîr
, "Ußge: %†∑th«mes_d©afûênum\n\
\äum:Çumbî o‡byã†tÿdi•œy from BOF i¿hexadecimÆ\n", 
¨gv
[0]);

105 
	`exô
 (1);

107 
Àn
 = 
	`©oi
(
¨gv
[2]);

108 i‡(
Àn
 <=0) {

109 
	`Ârötf
 (
°dîr
, "%s: InvalidÇumber of bytesÅoÑead : %d\n",

110 
¨gv
[0], 
Àn
);

111 
	`exô
 (1);

114 
Â
 = 
	`f›í
 (
¨gv
[1], "r");

115 i‡(!
Â
) {

116 
	`≥º‹
 ("fopen failed");

117 
	`exô
 (1);

120 i‡(!(
∑th
 = 
	`mÆloc
 (
PATH_MAX
))) {

121 
	`≥º‹
 ("malloc");

122 
	`f˛o£
 (
Â
);

123 
	`exô
 (1);

127 
	`fgës
(
∑th
, 
PATH_MAX
, 
Â
)) {

128 i‡((
fd
 = 
	`›í
 (
∑th
, 
O_RDONLY
)) == -1) {

129 
	`‰ì
 (
∑th
);

130 
	`f˛o£
 (
Â
);

131 
	`exô
 (1);

134 i‡(!(
buf
 = 
	`mÆloc
 (
Àn
))) {

135 
	`≥º‹
 ("malloc");

136 
	`˛o£
 (
fd
);

137 
	`‰ì
 (
∑th
);

138 
	`f˛o£
 (
Â
);

139 
	`exô
 (1);

142 
	`¥ötf
 ("\
-----------------------------------------------------------------------\n\
 %s...\n\
-----------------------------------------------------------------------\n",

146 
∑th
);

149 (
n
=
	`ªad
 (
fd
, 
buf
, 
Àn
))) {

150 i‡(
n
 == -1) {

151 
	`≥º‹
 ("open");

152 
	`˛o£
 (
fd
);

153 
	`‰ì
 (
∑th
);

154 
	`f˛o£
 (
Â
);

155 
	`exô
 (1);

157 i‡(
n
 >
Àn
)

160 
	`˛o£
 (
fd
);

163 
j
=0; j<
Àn
; j++) {

164 
	`¥ötf
 ("%02x ", ()
buf
[
j
]);

170 i‡(
j
 && !(j%
MAXCOL
))

171 
	`¥ötf
("\n");

173 
	`¥ötf
("\n");

174 
	`‰ì
 (
buf
);

177 
	`‰ì
 (
∑th
);

178 i‡(
	`f˛o£
 (
Â
)) {

179 
	`≥º‹
 ("fclose failed");

180 
	`exô
 (1);

182 
	`exô
 (0);

183 
	}
}

	@Training/L1_sysprg_trg/gdb/vaddr.c

2 
	~<°dio.h
>

3 
	~<°dlib.h
>

4 
	~<uni°d.h
>

7 #unde‡
BITS_32


9 #ifde‡
BITS_32


10 
	#FMTSPC
 "%08x"

	)

11 
	#TYPECST
 

	)

13 
	#FMTSPC
 "%16lx"

	)

14 
	#TYPECST
 

	)

16 
	tu32
;

18 *
ívú⁄
;

19 
	ggi
=5, 
	ggu
;

21 
	$maö
(
¨gc
, **
¨gv
)

23 
loˇl
=0xff, *
hópmem
;

24 
i
=1, 
j
=2, 
k
=3;

26 
hópmem
 = 
	`mÆloc
(1024);

27 
	`¥ötf
 ("[pid %d]:\nva: &maö = 0x" 
FMTSPC
 " &gi = 0x" FMTSPC " &gu = 0x" FMTSPC " &heapmem = 0x" \

28 
FMTSPC
 " &local = 0x" FMTSPC " &environ = 0x" FMTSPC "\n",

29 
	`gëpid
(), (
TYPECST
Ë&
maö
, (TYPECSTË&
gi
, (TYPECSTË&
gu
,

30 (
TYPECST
Ë
hópmem
, (TYPECSTË&
loˇl
, (TYPECST)
ívú⁄
);

32 
	`∑u£
();

33 
	`‰ì
 (
hópmem
);

34 
	`exô
 (0);

35 
	}
}

	@Training/L1_sysprg_trg/helloworld/helloworld.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	$maö
()

5 
	`¥ötf
("Hello, world\n");

7 
	`∑u£
();

8 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/mq/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=1; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
°rög
, ##
¨gs
); \

58 
	`¥ötk
 (
KERN_INFO
 
°rög
, ##
¨gs
); \

59 } 0)

	)

64 #ifde‡
DEBUG


65 #ifde‡
__KERNEL__


66 
	#MSG
(
°rög
, 
¨gs
...) do { \

67 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

68 } 0)

	)

70 
	#MSG
(
°rög
, 
¨gs
...) do { \

71 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

72 } 0)

	)

75 #ifde‡
__KERNEL__


76 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

77 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

78 } 0)

	)

80 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

81 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

82 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

127 
	~<löux/sched.h
>

128 
	~<löux/öãºu±.h
>

130 #i‚de‡
USE_FTRACE_PRINT


131 
	#PRINT_CTX
() do { \

132 
£p
='|', 
öå
='.'; \

134 i‡(
	`ö_öãºu±
()) { \

135 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

136 
öå
='H'; \

137 i‡(
	`ö_úq
()) \

138 
öå
='h'; \

139 i‡(
	`ö_so·úq
()) \

140 
öå
='s'; \

143 
öå
='.'; \

145 
	`DBGPRINT
( \

149 , 
	`smp_¥o˚ss‹_id
(), \

150 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

151 (
	`úqs_dißbÀd
()?'d':'.'), \

152 (
	`√ed_ªsched
()?'N':'.'), \

153 
öå
, \

154 (
	`¥ìm±_cou¡
() && 0xff) \

156 } 0)

	)

158 
	#PRINT_CTX
() do { \

159 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

160 i‡(!
	`ö_öãºu±
()) { \

161 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

162 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

164 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

166 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

167 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

169 } 0)

	)

186 #ifde‡
__KERNEL__


187 
	#as£π
(
ex¥
) do { \

188 i‡(!(
ex¥
)) { \

189 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

190 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

192 } 0)

	)

196 
ölöe
 
	$bìp
(
wh©
)

198 #ifde‡
__KERNEL__


199 
	`DBGPRINT
("%c", ()
wh©
 );

201 ()
	`¥ötf
("%c", ()
wh©
 );

203 
	}
}

210 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

212 
c
=0, 
m
;\

213 
f‹_ödex
,
ö√r_ödex
; \

215 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

216 
	`bìp
((
vÆ
)); \

217 
c
++;\

218 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

219 
m
=0;m<50;m++); \

222 }

	)

225 #ifde‡
__KERNEL__


230 
	#DELAY_SEC
(
vÆ
) \

232 i‡(!
	`ö_öãºu±
()) { \

233 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

234 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

236 }

	)

243 
timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
, timevÆ *
y
);

247 
__©åibuã__
 ((
unu£d
))

248 
	$timevÆ_subåa˘
 (
timevÆ
 *
ªsu…
, timevÆ *
x
, timevÆ *
y
)

251 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

252 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

253 
y
->
tv_u£c
 -1000000 * 
n£c
;

254 
y
->
tv_£c
 +
n£c
;

256 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

257 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

258 
y
->
tv_u£c
 +1000000 * 
n£c
;

259 
y
->
tv_£c
 -
n£c
;

264 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

265 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

268  
x
->
tv_£c
 < 
y
->tv_sec;

269 
	}
}

280 
__©åibuã__
 ((
unu£d
))

281 
	$dec2bö
(
decimÆ
, *
bö¨y
)

283 
k
 = 0, 
n
 = 0;

284 
√g_Êag
 = 0;

285 
ªmaö
;

295 #unde‡
TESTMODE


297 #ifde‡
TESTMODE


298 
ﬁd_decimÆ
;

300 
ãmp
[80];

303 i‡(
decimÆ
 < 0)

305 
decimÆ
 = -decimal;

306 
√g_Êag
 = 1;

310 #ifde‡
TESTMODE


311 
ﬁd_decimÆ
 = 
decimÆ
;

313 
ªmaö
 = 
decimÆ
 % 2;

315 
decimÆ
 = decimal / 2;

317 #ifde‡
TESTMODE


318 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
, 
ªmaö
);

321 
ãmp
[
k
++] = 
ªmaö
 + '0';

322 } 
decimÆ
 > 0);

324 i‡(
√g_Êag
)

325 
ãmp
[
k
++] = '-';

327 
ãmp
[
k
++] = ' ';

330 
k
 >= 0)

331 
bö¨y
[
n
++] = 
ãmp
[--
k
];

333 
bö¨y
[
n
-1] = 0;

334 
	}
}

337 #i‚de‡
__KERNEL__


339 
	#MSG
(
°rög
, 
¨gs
...) do { \

340 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

341 } 0)

	)

343 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

344 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

345 } 0)

	)

347 
	#QP
 
	`MSG
("\n")

	)

350 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

352 i‡(
vîbo£
) \

353 
	`¥ötf
(
°r
, ##
¨gs
); \

354 } 0)

	)

356 
ölöe
 
	$îr_exô
(*
¥g
, * 
îr
, 
exôcode
)

358 
îr_°r
[512];

360 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

361 
	`≥º‹
(
îr_°r
);

362 
	`exô
(
exôcode
);

363 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/mq/mqapp.h

8 
	~<°dio.h
>

9 
	~<sys/ty≥s.h
>

10 
	~<sys/ùc.h
>

11 
	~<sys/msg.h
>

12 
	~<î∫o.h
>

13 
	~<°rög.h
>

14 
	~<°dlib.h
>

15 
	~<uni°d.h
>

17 
	#KEY_VAL
 154326

	)

18 
	#MSGSZ_MAX
 180

	)

21 
	smsgbuf
 {

22 
	mmty≥
;

24 
	mmãxt
[
MSGSZ_MAX
];

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/mq/msg1_r.c

8 
	~"mq≠p.h
"

13 
ssize_t
 
	$msgrcv_r
(
msqid
, *
msgp
, 
size_t
 
msgsz
, 
msgtyp
,

14 
msgÊg
)

16 
ssize_t
 
n
=0;

17  ((
n
=(
	`msgrcv
(
msqid
, 
msgp
, 
msgsz
, 
msgtyp
, 
msgÊg
))Ë=-1Ë&& (
î∫o
 =
EINTR
)) ;

27  
n
;

28 
	}
}

30 
	$maö
–
¨gc
, **
¨gv
 )

32 
id
, 
n
=0;

33 
pid_t
 
pid
=
	`gëpid
();

34 
msgbuf
 
msg
;

37 
id
=
	`msggë
(
KEY_VAL
, 0);

38 if–-1 =
id
 )

39 
	`≥º‹
("msggë"), 
	`exô
(1);

40 
	`¥ötf
("%†[%d]: id=%d\n", 
¨gv
[0], 
pid
, 
id
);

46 if–(
n
=(
	`msgrcv_r
(
id
, &
msg
, 
MSGSZ_MAX
, 0, 0)))== -1 )

47 
	`≥º‹
("msgrcv"), 
	`exô
(1);

48 
	`¥ötf
("%s [%d]: Type 0 msgÑead of %d bytes; Type %ld: Msg: \"%.*s\"\n",

49 
¨gv
[0], 
pid
, 
n
, 
msg
.
mty≥
,Ç, msg.
mãxt
);

52 if–(
n
=(
	`msgrcv_r
(
id
, &
msg
, 
MSGSZ_MAX
, 5, 0)))== -1 )

53 
	`≥º‹
("msgrcv"), 
	`exô
(1);

54 
	`¥ötf
("%s [%d]: Type 5 msgÑead of %d bytes; Type %ld: Msg: \"%.*s\"\n",

55 
¨gv
[0], 
pid
, 
n
, 
msg
.
mty≥
,Ç, msg.
mãxt
);

61 
	`¥ötf
("%†[%d]: Ród Ty≥ 2 msg f‹ 10 byãs\n", 
¨gv
[0], 
pid
);

62 
n
=
	`msgrcv_r
(
id
, &
msg
, 10, 2, 
MSG_NOERROR
);

63 if–-1 =
n
 )

64 
	`≥º‹
("msgrcv"), 
	`exô
(1);

65 
	`¥ötf
("%s [%d]: Type 2 msgÑead for 10 bytes; %d bytesáctuallyÑead; \
 %ld: Msg: \"%.*s\"\n",

67 
¨gv
[0], 
pid
, 
n
, 
msg
.
mty≥
,Ç, msg.
mãxt
);

69 
	`exô
(0);

70 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/mq/msg1_w.c

7 
	~"mq≠p.h
"

9 
	$maö
–
¨gc
, **
¨gv
 )

11 
id
=0,
n
=0;

12 
pid_t
 
pid
=
	`gëpid
();

13 
msgbuf
 
msg
;

23 if–(
id
 = 
	`msggë
(
KEY_VAL
, 
IPC_CREAT
|
IPC_EXCL
|0600 ))== -1 ) {

24 i‡(
EEXIST
 =
î∫o
) {

25 
	`¥ötf
("MQÉxists,ÅryÅo fetch it...\n");

27 
id
=
	`msggë
(
KEY_VAL
, 0);

28 if–-1 =
id
 )

29 
	`≥º‹
("msggë faûuª"),
	`exô
(1);

32 
	`≥º‹
("msggë faûuª"),
	`exô
(1);

35 
	`¥ötf
("%†[%d] : MQ id=%d\n", 
¨gv
[0], 
pid
, 
id
);

38 
msg
.
mty≥
=2;

40 
	`°∫˝y
(
msg
.
mãxt
, "Mesßgêo‡ty≥ 2", 
MSGSZ_MAX
);

41 
n
=
	`msg¢d
(
id
, &
msg
, 
	`°æí
(msg.
mãxt
), 0);

42 if–-1 =
n
 )

43 
	`≥º‹
("msg¢d"), 
	`exô
(1);

44 
	`¥ötf
("%†[%d] :Åy≥ 2 msg sít\n", 
¨gv
[0], 
pid
);

47 
msg
.
mty≥
=5;

49 
	`°∫˝y
(
msg
.
mãxt
, "Mesßgêo‡ty≥ 5!", 
MSGSZ_MAX
);

50 
n
=
	`msg¢d
(
id
, &
msg
, 
	`°æí
(msg.
mãxt
), 0);

51 if–-1 =
n
 )

52 
	`≥º‹
("msg¢d"), 
	`exô
(1);

53 
	`¥ötf
("%†[%d] :Åy≥ 5 msg sít\n", 
¨gv
[0], 
pid
);

55 
	`exô
(0);

57 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/beej/semdemo.c

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~<î∫o.h
>

9 
	~<sys/ty≥s.h
>

10 
	~<sys/ùc.h
>

11 
	~<sys/£m.h
>

13 
	#MAX_RETRIES
 10

	)

15 
	u£mun
 {

16 
	mvÆ
;

17 
£mid_ds
 *
	mbuf
;

18 
ush‹t
 *
	m¨øy
;

25 
	$öô£m
(
key_t
 
key
, 
n£ms
)

27 
i
;

28 
£mun
 
¨g
;

29 
£mid_ds
 
buf
;

30 
£mbuf
 
sb
;

31 
£mid
;

33 
£mid
 = 
	`£mgë
(
key
, 
n£ms
, 
IPC_CREAT
 | 
IPC_EXCL
 | 0666);

35 i‡(
£mid
 >= 0) {

36 
sb
.
£m_›
 = 1; sb.
£m_Êg
 = 0;

37 
¨g
.
vÆ
 = 1;

39 
	`¥ötf
("öô£m:Öro˚s†%d (usËhîêfú°\n", 
	`gëpid
());

41 
sb
.
£m_num
 = 0; sb.£m_num < 
n£ms
; sb.sem_num++) {

44 i‡(
	`£m›
(
£mid
, &
sb
, 1) == -1) {

45 
e
 = 
î∫o
;

46 
	`£m˘l
(
£mid
, 0, 
IPC_RMID
);

47 
î∫o
 = 
e
;

52 } i‡(
î∫o
 =
EEXIST
) {

53 
ªady
 = 0;

54 
	`¥ötf
("SemaphoreálreadyÉxisting; fetch & wait for creatorÅo init sem \
(inÜoop)\n");

56 
£mid
 = 
	`£mgë
(
key
, 
n£ms
, 0);

57 i‡(
£mid
 < 0)  semid;

60 
¨g
.
buf
 = &buf;

61 
i
 = 0; i < 
MAX_RETRIES
 && !
ªady
; i++) {

62 
	`£m˘l
(
£mid
, 
n£ms
-1, 
IPC_STAT
, 
¨g
);

63 i‡(
¨g
.
buf
->
£m_Ÿime
 != 0) {

64 
ªady
 = 1;

66 
	`¶ìp
(1);

69 i‡(!
ªady
) {

70 
î∫o
 = 
ETIME
;

74  
£mid
;

77  
£mid
;

78 
	}
}

80 
	$maö
()

82 
key_t
 
key
;

83 
£mid
;

84 
£mbuf
 
sb
;

86 
sb
.
£m_num
 = 0;

87 
sb
.
£m_›
 = -1;

88 
sb
.
£m_Êg
 = 
SEM_UNDO
;

90 i‡((
key
 = 
	`·ok
("semdemo.c", 'J')) == -1) {

91 
	`≥º‹
("ftok");

92 
	`exô
(1);

96 i‡((
£mid
 = 
	`öô£m
(
key
, 1)) == -1) {

97 
	`≥º‹
("initsem");

98 
	`exô
(1);

101 
	`¥ötf
("PressÑeturnÅoÜock: ");

102 
	`gëch¨
();

103 
	`¥ötf
("TryingÅoÜock...\n");

105 i‡(
	`£m›
(
£mid
, &
sb
, 1) == -1) {

106 
	`≥º‹
("semop");

107 
	`exô
(1);

110 
	`¥ötf
("Locked.\n");

111 
	`¥ötf
("PressÑeturnÅo unlock: ");

112 
	`gëch¨
();

114 
sb
.
£m_›
 = 1;

115 i‡(
	`£m›
(
£mid
, &
sb
, 1) == -1) {

116 
	`≥º‹
("semop");

117 
	`exô
(1);

120 
	`¥ötf
("Unlocked\n");

123 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/beej/semrm.c

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<î∫o.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/ùc.h
>

10 
	~<sys/£m.h
>

12 
	$maö
()

14 
key_t
 
key
;

15 
£mid
;

17 i‡((
key
 = 
	`·ok
("semdemo.c", 'J')) == -1) {

18 
	`≥º‹
("ftok");

19 
	`exô
(1);

23 i‡((
£mid
 = 
	`£mgë
(
key
, 1, 0)) == -1) {

24 
	`≥º‹
("semget");

25 
	`exô
(1);

29 i‡(
	`£m˘l
(
£mid
, 0, 
IPC_RMID
) == -1) {

30 
	`≥º‹
("semctl");

31 
	`exô
(1);

35 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/sem1.c

20 
	~<î∫o.h
>

22 
	~<°dio.h
>

23 
	~<uni°d.h
>

24 
	~<f˙é.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

27 
	~<î∫o.h
>

28 
	~<sig«l.h
>

29 
	~<sys/fûe.h
>

30 
	~<sys/ty≥s.h
>

31 
	~<sys/°©.h
>

32 
	~<sys/ùc.h
>

33 
	~<sys/£m.h
>

34 
	~"£m_lib.h
"

36 
	#SEM_PERMS
 (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IROTH
)

37 
	#FILE_PERMS
 
SEM_PERMS


	)

38 
	#MY_KEY
 0x123654L

	)

39 
	#SLEEP_TIME
 10

40 

	)

41 
	#APPNAME
 "Sem1"

	)

42 
	#INFO
(
°rög
, 
¨gs
...) \

43 
	`Ârötf
(
°dîr
, "%s:[%ld]: " 
°rög
, 
APPNAME
, ()
	`gëpid
(), ##
¨gs
)

	)

48 
	$¥öãº‹
 (*
¥g
, *
msg
, 
îr‹
)

50 
	`Ârötf
 (
°dîr
, "%s:[%ld]:%s:%s\n",

51 
¥g
, ()
	`gëpid
(), 
msg
, 
	`°ªº‹
 (
îr‹
));

52 
	}
}

72 
	$sigfunc
 (
signum
)

75 
	`INFO
 ("**Sig«»%d i¡îru±i⁄!**\n", 
signum
);

76 
	}
}

78 
	$maö
–
¨gc
, *
¨gv
[] )

80 
id
 = -1, 
fd
=-1, 
n
=0;

81 
siga˘i⁄
 
a˘
;

82 
FILE
 * 
Â
;

83 
buf
[255], 
dtbuf
[80];

84 
buf2
[] = "This isÅhe sampleÑecord writtenÅoÉnd of file by Sem1";

85 
£mbuf
 
£mlock
[2], 
£mu∆ock
;

87 if–
¨gc
 != 2 ) {

88 
	`Ârötf
–
°dîr
, "Ußge: %†fûe_to_[un]lock\n\
\n***NOTE*** Thêfûêwû»bêwrôã¿to.\n", 
¨gv
[0] );

90 
	`exô
( 2 );

94 
a˘
.
ß_h™dÀr
 = 
sigfunc
;

95 
	`sigem±y£t
 (&
a˘
.
ß_mask
);

96 
a˘
.
ß_Êags
 = 
SA_RESTART
;

98 i‡(
	`siga˘i⁄
 (
SIGINT
, &
a˘
, 0) ||

99 
	`siga˘i⁄
 (
SIGQUIT
, &
a˘
, 0) == -1) {

100 
	`¥öãº‹
(
¨gv
[0], "siga˘i⁄ faûuª", 
î∫o
);

101 
	`exô
(1);

105 i‡((
id
 = 
	`£mgë
–
MY_KEY
, 0, 0 )) == -1 ) {

107 i‡–((
id
 = 
	`£mgë
 (
MY_KEY
, 1, 
IPC_CREAT
|
IPC_EXCL
|
SEM_PERMS
)) == -1) &&

108 
î∫o
 =
EEXIST
) {

109 i‡((
id
 = 
	`£mgë
–
MY_KEY
, 0, 0 )) == -1 ) {

110 
	`¥öãº‹
 (
¨gv
[0], "£mgë faûuª 1", 
î∫o
);

111 
	`exô
 (1);

114 
	`¥öãº‹
 (
¨gv
[0], "£mgë faûuª 2", 
î∫o
);

115 
	`exô
 (1);

119 
	`INFO
 ("Fëched sem≠h‹êID (f‹ key 0x%xËi†%d\n", ()
MY_KEY
, 
id
 );

123 i‡(
	`öôñemít
 (
id
, 0, 1) == -1) {

124 
	`¥öãº‹
 (
¨gv
[0], "öôñemíà(£m˘lË£m≠h‹êöô faûuª", 
î∫o
);

125 i‡(
	`ªmove£m
(
id
) == -1)

126 
	`¥öãº‹
 (
¨gv
[0],

127 "ªmove£m (£m˘lËÁûed sem≠h‹êdñëi⁄ faûuª", 
î∫o
);

128 
	`exô
 (1);

130 
	`INFO
 ("Semaphore initialized...\n");

142 
	`£t£mbuf
 (&
£mlock
[0], 0, 0, 0);

143 
	`£t£mbuf
 (&
£mlock
[1], 0, 1, 
SEM_UNDO
);

144 
	`£t£mbuf
 (&
£mu∆ock
, 0, -1, 
IPC_NOWAIT
|
SEM_UNDO
);

151 
	`INFO
–"(Aâem±ögÅoËLockÑesour˚ (fûê%sËnow...\n", 
¨gv
[1] );

152 if–
	`r_£m›
 (
id
, &
£mlock
[0], 2) < 0 ) {

153 
	`¥öãº‹
 (
¨gv
[0], "£m≠h‹êlockög faûuª", 
î∫o
);

154 
	`exô
 (1);

156 
	`INFO
("FileÜocked..\n");

166 
	`INFO
( "FileÖrocessing isÅakingÖlaceÇow..\n");

167 if–(
fd
 = 
	`›í
–
¨gv
[1], 
O_RDWR
|
O_APPEND
|
O_CREAT
, 
FILE_PERMS
 )) == -1 ) {

168 
	`¥öãº‹
 (
¨gv
[0], "Fûê›í faûuª", 
î∫o
);

169 
	`exô
( 1 );

176 
buf
[0] = 
dtbuf
[0] = '\0';

177 i‡((
Â
 = 
	`p›í
–"d©e", "r" )Ë=
NULL
)

178 
	`¥öãº‹
 (
¨gv
[0], "p›í faûuª", 
î∫o
);

179 i‡(
	`fgës
–
dtbuf
, 80, 
Â
 ) =
NULL
)

180 
	`¥öãº‹
 (
¨gv
[0], "fgë†Áûuª", 
î∫o
);

181 i‡(
	`p˛o£
–
Â
 ) == -1)

182 
	`¥öãº‹
 (
¨gv
[0], "p˛o£ faûuª", 
î∫o
);

183 
	`¢¥ötf
 (
buf
, 128, "\n%s:[%ld]: %s: %s.%ld",

184 
APPNAME
, ()
	`gëpid
(), 
dtbuf
, 
buf2
, ()getpid());

186 if–(
n
 = 
	`wrôe
–
fd
, 
buf
, 
	`°æí
(buf)) ) == -1 ) {

187 
	`¥öãº‹
 (
¨gv
[0], "FûêwrôêÁûed,áb‹tög..", 
î∫o
);

188 
	`˛o£
–
fd
 );

189 if–
	`r_£m›
–
id
, &
£mu∆ock
, 1 ) < 0 ) {

190 
	`¥öãº‹
 (
¨gv
[0], "£m≠h‹êu∆ockög faûuª", 
î∫o
);

191 
	`exô
 (1);

193 
	`exô
( 1 );

197 
	`¶ìp
–
SLEEP_TIME
 );

199 
	`˛o£
–
fd
 );

200 
	`INFO
("Pro˚ssög d⁄ê- Wrôêo‡%d byãs\n", 
n
 );

203 if–
	`r_£m›
–
id
, &
£mu∆ock
, 1 ) < 0 ) {

204 
	`¥öãº‹
 (
¨gv
[0], "£m≠h‹êu∆ockög faûuª", 
î∫o
);

205 
	`exô
 (1);

208 
	`INFO
( "File (semaphore) unlocked. Exiting..\n" );

209 
	`exô
( 0 );

210 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/sem2.c

20 
	~<î∫o.h
>

22 
	~<°dio.h
>

23 
	~<uni°d.h
>

24 
	~<f˙é.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

27 
	~<î∫o.h
>

28 
	~<sig«l.h
>

29 
	~<sys/fûe.h
>

30 
	~<sys/ty≥s.h
>

31 
	~<sys/°©.h
>

32 
	~<sys/ùc.h
>

33 
	~<sys/£m.h
>

34 
	~"£m_lib.h
"

36 
	#SEM_PERMS
 (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IROTH
)

	)

37 
	#MAX_TRIES
 10

	)

38 
	#FILE_PERMS
 
SEM_PERMS


	)

39 
	#MY_KEY
 0x123654L

	)

40 
	#SLEEP_TIME
 10

41 

	)

42 
	#APPNAME
 "Sem1"

	)

43 
	#INFO
(
°rög
, 
¨gs
...) \

44 
	`Ârötf
(
°dîr
, "%s:[%ld]: " 
°rög
, 
APPNAME
, ()
	`gëpid
(), ##
¨gs
)

	)

46 
	göôÊag
;

51 
ölöe
 
	$¥öãº‹
 (*
¥g
, *
msg
, 
îr‹
)

53 
	`Ârötf
 (
°dîr
, "%s:[%ld]:%s:%s\n",

54 
¥g
, ()
	`gëpid
(), 
msg
, 
	`°ªº‹
 (
îr‹
));

55 
	}
}

75 
	$sigfunc
 (
signum
)

78 
	`INFO
 ("**Sig«»%d i¡îru±i⁄!**\n", 
signum
);

79 
	}
}

81 
	$maö
–
¨gc
, *
¨gv
[] )

83 
id
 = -1, 
fd
=-1, 
i
, 
n
=0;

84 
siga˘i⁄
 
a˘
;

85 
FILE
 * 
Â
;

86 
buf
[255], 
dtbuf
[80];

87 
buf2
[] = "This isÅhe sampleÑecord writtenÅoÉnd of file by Sem1";

89 
£mbuf
 
£mlock
[2], 
£mu∆ock
;

90 
£mid_ds
 
£möfo
;

109 
	u£mun
 {

110 
vÆ
;

111 
£mid_ds
 *
buf
;

112 *
¨øy
;

113 
£möfo
 *
__buf
;

114 } 
¨g
;

116 if–
¨gc
 != 2 ) {

117 
	`Ârötf
–
°dîr
, "Ußge: %†fûe_to_[un]lock\n\
\n***NOTE*** Thêfûêwû»bêwrôã¿to.\n", 
¨gv
[0] );

119 
	`exô
( 2 );

123 
a˘
.
ß_h™dÀr
 = 
sigfunc
;

124 
	`sigem±y£t
 (&
a˘
.
ß_mask
);

125 
a˘
.
ß_Êags
 = 
SA_RESTART
;

126 i‡(
	`siga˘i⁄
 (
SIGINT
, &
a˘
, 0) ||

127 
	`siga˘i⁄
 (
SIGQUIT
, &
a˘
, 0) == -1) {

128 
	`¥öãº‹
(
¨gv
[0], "siga˘i⁄ faûuª", 
î∫o
);

129 
	`exô
(1);

150 i‡(
öôÊag
 == 0) {

151 i‡((
id
 = 
	`£mgë
 (
MY_KEY
, 1, 
IPC_CREAT
|
IPC_EXCL
|
SEM_PERMS
)) >= 0) {

154 i‡(
	`öôñemít
 (
id
, 0, 1) == -1) {

155 
	`¥öãº‹
 (
¨gv
[0],

156 "öôñemíà(£m˘lË£m≠h‹êöô faûuª", 
î∫o
);

158 
	`INFO
("Thi†¥o˚s†[%d] fú°Åÿöôülizê£m...\n", 
	`gëpid
());

159 } i‡(
î∫o
 =
EEXIST
) {

161 
id
 = 
	`£mgë
 (
MY_KEY
, 1, 
SEM_PERMS
);

162 
¨g
.
vÆ
 = 1;

169 i‡(
	`£m˘l
 (
id
, 0, 
IPC_STAT
, &
¨g
) == -1) {

170 
	`¥öãº‹
 (
¨gv
[0],

171 "£m˘»£m≠h‹êöô faûuª", 
î∫o
);

173 
	`INFO
("Attempting initializationÜoopÇow...\n");

174 
¨g
.
buf
 = &
£möfo
;

175 
i
=0; i<
MAX_TRIES
; i++) {

176 i‡(
	`£m˘l
 (
id
, 0, 
IPC_STAT
, 
¨g
) == -1) {

177 
	`¥öãº‹
 (
¨gv
[0],

178 "öÜo›:£m˘»£m≠h‹êöô faûuª", 
î∫o
);

180 i‡(
¨g
.
buf
->
£m_Ÿime
 != 0)

181 
öô
;

182 
	`¶ìp
 (1);

184 
	`¥öãº‹
 (
¨gv
[0], "semget succeeded but semÇot initialized",

185 
î∫o
);

186 
	`exô
 (1);

188 
	`¥öãº‹
 (
¨gv
[0], "£mgë faûed.", 
î∫o
);

189 
	`exô
 (1);

191 
öô
:

192 
öôÊag
 = 1;

202 i‡((
id
 = 
	`£mgë
–
MY_KEY
, 0, 0 )) == -1 ) {

204 i‡–((
id
 = 
	`£mgë
 (
MY_KEY
, 1, 
IPC_CREAT
|
IPC_EXCL
|
SEM_PERMS
)) == -1) &&

205 
î∫o
 =
EEXIST
) {

206 i‡((
id
 = 
	`£mgë
–
MY_KEY
, 0, 0 )) == -1 ) {

207 
	`¥öãº‹
 (
¨gv
[0], "£mgë faûuª 1", 
î∫o
);

208 
	`exô
 (1);

211 
	`¥öãº‹
 (
¨gv
[0], "£mgë faûuª 2", 
î∫o
);

212 
	`exô
 (1);

217 
	`INFO
 ("Fetched (and initialized) semaphore ID (for key 0x%x) is %d\n",

218 ()
MY_KEY
, 
id
 );

222 i‡(
	`öôñemít
 (
id
, 0, 1) == -1) {

223 
	`¥öãº‹
 (
¨gv
[0], "öôñemíà(£m˘lË£m≠h‹êöô faûuª", 
î∫o
);

224 i‡(
	`ªmove£m
(
id
) == -1)

225 
	`¥öãº‹
 (
¨gv
[0],

226 "ªmove£m (£m˘lËÁûed sem≠h‹êdñëi⁄ faûuª", 
î∫o
);

227 
	`exô
 (1);

229 
	`INFO
 ("Semaphore initialized...\n");

236 
	`£t£mbuf
 (&
£mlock
[0], 0, 0, 0);

237 
	`£t£mbuf
 (&
£mlock
[1], 0, 1, 
SEM_UNDO
);

238 
	`£t£mbuf
 (&
£mu∆ock
, 0, -1, 
IPC_NOWAIT
|
SEM_UNDO
);

245 
	`INFO
–"(Aâem±ögÅoËLockÑesour˚ (fûê%sËnow...\n", 
¨gv
[1] );

246 if–
	`r_£m›
 (
id
, &
£mlock
[0], 2) < 0 ) {

247 
	`¥öãº‹
 (
¨gv
[0], "£m≠h‹êlockög faûuª", 
î∫o
);

248 
	`exô
 (1);

250 
	`INFO
("FileÜocked..\n");

262 
	`INFO
( "FileÖrocessing isÅakingÖlaceÇow..\n");

263 if–(
fd
 = 
	`›í
–
¨gv
[1], 
O_RDWR
|
O_APPEND
|
O_CREAT
, 
FILE_PERMS
 )) == -1 ) {

264 
	`¥öãº‹
 (
¨gv
[0], "Fûê›í faûuª", 
î∫o
);

265 
	`exô
( 1 );

272 
buf
[0] = 
dtbuf
[0] = '\0';

273 i‡((
Â
 = 
	`p›í
–"d©e", "r" )Ë=
NULL
)

274 
	`¥öãº‹
 (
¨gv
[0], "p›í faûuª", 
î∫o
);

275 i‡(
	`fgës
–
dtbuf
, 80, 
Â
 ) =
NULL
)

276 
	`¥öãº‹
 (
¨gv
[0], "fgë†Áûuª", 
î∫o
);

277 i‡(
	`p˛o£
–
Â
 ) == -1)

278 
	`¥öãº‹
 (
¨gv
[0], "p˛o£ faûuª", 
î∫o
);

279 
	`¢¥ötf
 (
buf
, 128, "\n%s:[%ld]: %s: %s.%ld",

280 
APPNAME
, ()
	`gëpid
(), 
dtbuf
, 
buf2
, ()getpid());

282 if–(
n
 = 
	`wrôe
–
fd
, 
buf
, 
	`°æí
(buf)) ) == -1 ) {

283 
	`¥öãº‹
 (
¨gv
[0], "FûêwrôêÁûed,áb‹tög..", 
î∫o
);

284 
	`˛o£
–
fd
 );

285 if–
	`r_£m›
–
id
, &
£mu∆ock
, 1 ) < 0 ) {

286 
	`¥öãº‹
 (
¨gv
[0], "£m≠h‹êu∆ockög faûuª", 
î∫o
);

287 
	`exô
 (1);

289 
	`exô
( 1 );

294 
	`r_¶ìp
–
SLEEP_TIME
 );

296 
	`˛o£
–
fd
 );

297 
	`INFO
("Pro˚ssög d⁄ê- Wrôêo‡%d byãs\n", 
n
 );

300 if–
	`r_£m›
–
id
, &
£mu∆ock
, 1 ) < 0 ) {

301 
	`¥öãº‹
 (
¨gv
[0], "£m≠h‹êu∆ockög faûuª", 
î∫o
);

302 
	`exô
 (1);

305 
	`INFO
( "File (semaphore) unlocked. Exiting..\n" );

306 
	`exô
( 0 );

307 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/sem_lib.h

8 #i‚de‡
__SEMLIB_H__


9 
	#__SEMLIB_H__


	)

11 #i‚de‡
_ASSERT_H


12 
	~<as£π.h
>

27 
	$öôñemít
 (
£mid
, 
£mnum
, 
£mvÆue
)

29 
	u£mnum
 {

30 
vÆ
;

31 
£mid_ds
 *
buf
;

32 *
¨øy
;

33 } 
¨g
;

35 
¨g
.
vÆ
 = 
£mvÆue
;

36  
	`£m˘l
 (
£mid
, 
£mnum
, 
SETVAL
, 
¨g
);

37 
	}
}

52 
	$£t£mbuf
 (
£mbuf
 *
s
, 
num
, 
›
, 
Êg
)

54 
	`as£π
(
s
!=
NULL
);

56 
s
->
£m_num
 = ()
num
;

57 
s
->
£m_›
 = ()
›
;

58 
s
->
£m_Êg
 = ()
Êg
;

60 
	}
}

70 
	$r_£m›
 (
£mid
, 
£mbuf
 *
s›s
, 
size_t
 
ns›s
)

72 
	`£m›
 (
£mid
, 
s›s
, 
ns›s
) == -1) {

73 i‡(
î∫o
 !
EINTR
)

77 
	}
}

89 
	$ªmove£m
 (
£mid
)

91  
	`£m˘l
 (
£mid
, 0, 
IPC_RMID
);

92 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/simple/sem1.c

16 
	~<î∫o.h
>

18 
	~<°dio.h
>

19 
	~<uni°d.h
>

20 
	~<f˙é.h
>

21 
	~<°dlib.h
>

22 
	~<°rög.h
>

23 
	~<î∫o.h
>

24 
	~<sys/fûe.h
>

25 
	~<sys/ty≥s.h
>

26 
	~<sys/°©.h
>

27 
	~<sys/ùc.h
>

28 
	~<sys/£m.h
>

30 
	#MY_KEY
 123654L

	)

31 
	#SLEEP_TIME
 5

32 

	)

33 
£mbuf
 
	g£m›_lock
[2] = {

36 {0, 1, 
SEM_UNDO
}

39 
£mbuf
 
	g£m›_u∆ock
[1] = {

41 {0, -1, (
IPC_NOWAIT
 | 
SEM_UNDO
)}

44 
	gid
 = -1;

46 
	$maö
–
¨gc
, *
¨gv
[] )

48 
fd
=-1, 
n
=0;

49 
FILE
 * 
Â
;

50 
buf
[255], 
dtbuf
[80];

51 
buf2
[] = "This isÅhe sampleÑecord writtenÅoÉnd of file by sem1.";

53 if–
¨gc
 != 2 ) {

54 
	`Ârötf
–
°dîr
, "Ußge: %†fûíame\n", 
¨gv
[0] );

55 
	`exô
( 2 );

59 if–
	`ac˚ss
–
¨gv
[1], 
F_OK
 ) == -1 ) {

60 
	`≥º‹
( "FileÉxistence check" );

61 
	`exô
( 1 );

65 
id
 = 
	`£mgë
–
MY_KEY
, 1, 
IPC_CREAT
 | 
IPC_EXCL
 | 0666 );

66 if–
id
 == -1 ) {

67 
	`≥º‹
( "Semaphore create" );

68 if–
î∫o
 !
EEXIST
 ) {

69 
	`≥º‹
("semget failure");

70 
	`exô
(1);

72 
id
 = 
	`£mgë
–
MY_KEY
, 1, 0 );

73 if–
id
 == -1 )

74 
	`≥º‹
–"Sem≠h‹ê¸óã" ),
	`exô
(1);

76 
	`¥ötf
–"\nSem1: Fëched sem≠h‹e..id = %d\n", 
id
 );

80 
	`¥ötf
–"\nSem1: LockögÑesour˚ (fûê%s)...", 
¨gv
[1] );

82 if–
	`£m›
–
id
, &
£m›_lock
[0], 2 ) < 0 )

83 
	`≥º‹
–"£mÜockÉº‹" ), 
	`exô
( 1 );

84 
	`¥ötf
("\nSem1: FileÜocked.." );

93 
	`¥ötf
( "\nSem1: FileÖrocessing isÅakingÖlaceÇow.." );

94 
	`fÊush
–
°dout
 );

95 if–(
fd
 = 
	`›í
–
¨gv
[1], 
O_RDWR
|
O_CREAT
|
O_APPEND
, 0644 )) == -1 ) {

96 
	`≥º‹
( "File open failure" );

97 
	`exô
( 1 );

103 
Â
 = 
	`p›í
( "date", "r" );

104 i‡(!
	`fgës
–
dtbuf
, 80, 
Â
 )) {

105 
	`Ârötf
(
°dîr
, "%s: fgë†Áûed!\n", 
¨gv
[0]);

106 
	`£m›
–
id
, &
£m›_u∆ock
[0], 2 );

107 
	`p˛o£
–
Â
 );

108 
	`˛o£
 (
fd
);

109 
	`exô
 (1);

111 
	`p˛o£
–
Â
 );

112 
	`•rötf
–
buf
, "\n---\nSem1: PID %d: %s: %s\n", 
	`gëpid
(), 
dtbuf
, 
buf2
 );

114 if–(
n
 = 
	`wrôe
–
fd
, 
buf
, 
	`°æí
(buf)) ) == -1 ) {

115 
	`≥º‹
( "File write failed" );

116 
	`˛o£
–
fd
 );

117 if–
	`£m›
–
id
, &
£m›_u∆ock
[0], 1 ) < 0 )

118 
	`≥º‹
–"£m u∆ockÉº‹" ), 
	`exô
( 1 );

119 
	`exô
( 1 );

123 
	`¶ìp
–
SLEEP_TIME
 );

124 
	`˛o£
–
fd
 );

125 
	`¥ötf
("\nSem1: Pro˚ssög d⁄ê- Wrôêo‡%d byãs\n", 
n
 );

128 if–
	`£m›
–
id
, &
£m›_u∆ock
[0], 1 ) < 0 )

129 
	`≥º‹
–"£m u∆ockÉº‹" ), 
	`exô
( 1 );

130 
	`¥ötf
( "\nSem1: File (semaphore) unlocked\nSem1Éxiting.." );

132 
	`exô
( 0 );

133 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/shm/hdr_shm.h

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<sys/ùc.h
>

12 
	~<sys/shm.h
>

13 
	~<sys/waô.h
>

14 
	~<°dlib.h
>

15 
	~<°rög.h
>

16 
	~<löux/limôs.h
>

18 
	#PROJECT_ID
 0

	)

20 
	#SHMSZ_OUR_MAX
 (100*1024*1024)

22 
	#MODE
 0600

	)

23 
	#LINELENGTH
 132

	)

24 
	#NUM
 10

	)

31 
key_t
 
	$gë_key
()

33 *
∑thmem
 = 
NULL
, *
∑th
 = NULL;

34 
key_t
 
key
 = 0L;

39 i‡((
∑thmem
 = 
	`mÆloc
(
PATH_MAX
)Ë=
NULL
) {

40 
	`Ârötf
(
°dîr
, "get_key() failure: malloc failed\n");

41 
	`exô
(1);

43 
∑th
 = 
∑thmem
;

44 
∑th
 = 
	`gëív
("PROJM_SHM_PATH");

45 i‡(
∑th
 =
NULL
) {

46 
	`Ârötf
(
°dîr
, "SetÉnvironment variable PROJM_SHM_PATHÅo \
 of shmÖath file..\n");

48 
	`‰ì
(
∑thmem
);

49 
	`exô
(1);

52 
key
 = 
	`·ok
(
∑th
, 
PROJECT_ID
);

53 
	`‰ì
(
∑thmem
);

54  
key
;

55 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/shm/shm1_r.c

9 
	~"hdr_shm.h
"

10 
	~<sig«l.h
>

12 
	$sighdÃ
(
signum
)

14 
	`¥ötf
("-- I¿sighdÃ, sig #%d\n", 
signum
);

15 
	}
}

17 
	$maö
(
¨gc
, **
¨gv
)

19 
shm_id
;

20 
key_t
 
shm_key
;

21 *
shm_addr
;

22 *
√xt
;

23 
n
;

24 
ö¸
;

25 
rv
;

27 
siga˘i⁄
 
a˘
;

31 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

32 
	`sigem±y£t
(&
a˘
.
ß_mask
);

33 
a˘
.
ß_Êags
 = 
SA_RESTART
;

34 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) == -1) {

35 
	`≥º‹
(
¨gv
[0]);

36 
	`exô
(1);

40 
shm_key
 = 
	`gë_key
();

41 i‡(
shm_key
 == -1) {

42 
	`Ârötf
(
°dîr
, "%s: ftok() failed, cannot get key value\n",

43 
¨gv
[0]);

44 
	`exô
(1);

48 
shm_id
 = 
	`shmgë
(
shm_key
, 0, 0);

49 i‡(
shm_id
 < 0) {

50 
	`≥º‹
("shmget failed");

51 
	`exô
(1);

53 
	`¥ötf
("%s: shmem segment successfully created /áccessed. ID=%d\n",

54 
¨gv
[0], 
shm_id
);

56 
shm_addr
 = 
	`shm©
(
shm_id
, 0, 0);

57 i‡(
shm_addr
 == (*)-1) {

58 
	`≥º‹
("shmat failed");

59 
	`exô
(1);

61 
	`¥ötf
("%s: Attached successfullyÅo shmem segmentát %p\n",

62 
¨gv
[0], 
shm_addr
);

65 
√xt
 = 
shm_addr
;

66 
n
 = 0;Ç < 
NUM
;Ç++) {

67 
	`puts
(
√xt
);

68 
ö¸
 = 
	`°æí
(
√xt
) + 1;

69 
√xt
 +
ö¸
;

73 
	`¥ötf
("%s: Pausög ...Öªs†^CÅÿc⁄töue... \n", 
¨gv
[0]);

74 
	`∑u£
();

78 
rv
 = 
	`shmdt
(
shm_addr
);

79 i‡(
rv
 < 0) {

80 
	`≥º‹
("shmdt failed");

81 
	`exô
(1);

84 
rv
 = 
	`shm˘l
(
shm_id
, 
IPC_RMID
, 0);

85 i‡(
rv
 < 0) {

86 
	`¥ötf
("%s: c™nŸ dñëêsh¨ed mem‹y\n", 
¨gv
[0]);

87 
	`exô
(1);

89 
	`¥ötf
("%s: dñëed shmem segmít.\n", 
¨gv
[0]);

91 
	`exô
(0);

92 
	}
}

	@Training/L1_sysprg_trg/ipc/SYS_V_ipc/shm/shm1_w.c

11 
	~"hdr_shm.h
"

12 
	#FORK_SHMEM_DEMO
 0

	)

14 
	$maö
(
¨gc
, **
¨gv
)

16 
shm_id
;

17 
key_t
 
shm_key
;

18 *
shm_addr
;

19 
n
;

20 
ö¸
;

21 
shmsz
 = 0;

23 i‡(
¨gc
 != 2) {

24 
	`Ârötf
(
°dîr
, "Ußge: %†shmem-£g-size-KB\n", 
¨gv
[0]);

25 
	`exô
(1);

27 
shmsz
 = 
	`°πoul
(
¨gv
[1], 0, 0);

28 
shmsz
 *= 1024;

29 i‡((
shmsz
 <0Ë|| (shmsz > 
SHMSZ_OUR_MAX
)) {

30 
	`Ârötf
(
°dîr
, "%s: specified shmem seg size [%lu] invalid..\n"

31 "[fyi, ou∏max i†%d MB]\n", 
¨gv
[0], 
shmsz
,

32 (
SHMSZ_OUR_MAX
 / (1024 * 1024)));

33 
	`exô
(1);

37 
shm_key
 = 
	`gë_key
();

38 i‡(
shm_key
 == -1) {

39 
	`Ârötf
(
°dîr
, "%s: ftok() failed, cannot get key value\n",

40 
¨gv
[0]);

41 
	`exô
(1);

43 
	`¥ötf
("%s: key=%d, size=%lu\n", 
¨gv
[0], 
shm_key
, 
shmsz
);

46 
shm_id
 = 
	`shmgë
(
shm_key
, 
shmsz
, (
IPC_CREAT
 | 
IPC_EXCL
 | 
MODE
));

47 i‡(
shm_id
 < 0) {

48 i‡(
î∫o
 =
EEXIST
) {

49 
	`¥ötf
("%s: shmem segmíàÆªadyÉxi°s, wû»©ãm± \
ác˚s†ô...\n", 
¨gv
[0]);

51 
shm_id
 = 
	`shmgë
(
shm_key
, 0, 0);

52 i‡(
shm_id
 < 0) {

53 
	`≥º‹
("shm1: shmget failed");

54 
	`exô
(1);

58 
	`¥ötf
("%s: shmem segment successfully created /áccessed. ID=%d\n",

59 
¨gv
[0], 
shm_id
);

64 
shm_addr
 = 
	`shm©
(
shm_id
, 0, 0);

65 i‡(
shm_addr
 == (*)-1) {

66 
	`≥º‹
("shmat failed");

67 
	`exô
(1);

69 
	`¥ötf
("%s: Attached successfullyÅo shmem segmentát %p\n",

70 
¨gv
[0], (*)
shm_addr
);

73 
n
 = 0;Ç < 
NUM
;Ç++) {

74 
	`¥ötf
("%02d: E¡îá såög : ", 
n
);

75 i‡(
	`fgës
(
shm_addr
, 
LINELENGTH
, 
°dö
Ë=
NULL
)

76 
	`Ârötf
(
°dîr
, "%s: !WARNING! fgets() failed.\n",

77 
¨gv
[0]);

78 
shm_addr
[
	`°æí
(shm_addr) - 1] = '\0';

79 
ö¸
 = 
	`°æí
(
shm_addr
) + 1;

80 
shm_addr
 +
ö¸
;

83 #i‡(
FORK_SHMEM_DEMO
==1)

88 
	`¥ötf
("Before fork: Executing \"ipcs -m\" - seeÇattch..\n");

89 i‡(
	`sy°em
("ipcs -m") < 0) {

90 
	`≥º‹
("system ipcs -m failed");

91 
	`exô
(1);

94 
	`fÊush
(
°dout
);

95 
	`f‹k
()) {

97 
	`≥º‹
("f‹k faûed"), 
	`exô
(1);

99 
	`¥ötf
("CHILD:: Executing \"ipcs -m\" - seeÇattch..\n");

100 i‡(
	`sy°em
("ipcs -m") < 0) {

101 
	`≥º‹
("system ipcs -m failed");

102 
	`exô
(1);

104 
	`¶ìp
(10);

105 
	`exô
(0);

108 
	`waô
(0);

109 
	`¥ötf
("∑ª¡ %dÉxôög..\n", 
	`gëpid
());

112 
	`exô
(0);

113 
	}
}

	@Training/L1_sysprg_trg/ipc/mmap_ipc/fileio_mmap/mmap_fileio.c

14 
	~<°dio.h
>

15 
	~<°dlib.h
>

16 
	~<uni°d.h
>

17 
	~<sys/mm™.h
>

18 
	~<sys/ty≥s.h
>

19 
	~<sys/°©.h
>

20 
	~<f˙é.h
>

21 
	~"ª°¨t_lib.h
"

22 
	~"../../../c⁄víõ¡.h
"

30 
	$maö
(
¨gc
, **
¨gv
)

32 
fd_‰om
, 
fd_to
;

33 
off_t
 
Àn
;

34 
°©
 
s°©
;

35 *
d©a_§c
, *
‹ig±r
, *
d©a_de°
;

37 i‡(
¨gc
 != 3) {

38 
	`Ârötf
(
°dîr
, "Ußge: %†sour˚-fûêde°-fûe\n", 
¨gv
[0]);

39 
	`exô
(1);

42 
fd_‰om
 = 
	`r_›í2
(
¨gv
[1], 
O_RDONLY
);

43 i‡(-1 =
fd_‰om
) {

44 
	`≥º‹
("open: src file");

45 
	`exô
(1);

48 
fd_to
 = 
	`r_›í3
(
¨gv
[2], 
O_RDWR
 | 
O_CREAT
,

49 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
);

50 i‡(-1 =
fd_to
) {

51 
	`≥º‹
("open: dest file");

52 
	`exô
(1);

56 i‡(
	`°©
(
¨gv
[1], &
s°©
) == -1) {

57 
	`≥º‹
("stat");

58 
	`exô
(1);

60 
Àn
 = 
s°©
.
°_size
;

61 i‡(
Àn
 == 0) {

62 
	`Ârötf
(
°dîr
,

64 
¨gv
[0],árgv[1]);

65 
	`exô
(1);

69 
	`l£ek
 (
fd_to
, 
Àn
-1, 
SEEK_SET
);

70 i‡(
	`wrôe
 (
fd_to
, "", 1) < 0) {

71 
	`≥º‹
("write:Åo fd_to for 1 byteátÉof failed");

72 
	`exô
(1);

79 
‹ig±r
 = 
d©a_§c
 = 
	`mm≠
(0, 
Àn
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd_‰om
, 0);

80 i‡(
d©a_§c
 == (*)-1) {

81 
	`≥º‹
("mmap:Åo src file");

82 
	`exô
(1);

84 
	`MSG
("Àn=%ld d©a_§¯%p\n", 
Àn
, 
d©a_§c
);

87 
d©a_de°
 = 
	`mm≠
(0, 
Àn
, 
PROT_READ
|
PROT_WRITE
, 
MAP_SHARED
, 
fd_to
, 0);

88 i‡(
d©a_de°
 == (*)-1) {

89 
	`≥º‹
("mmap:Åo dest file");

90 
	`exô
(1);

93 
	`mem˝y
 (
d©a_de°
, 
d©a_§c
, 
Àn
);

96 i‡(
	`munm≠
(
‹ig±r
, 
Àn
) == -1) {

97 
	`≥º‹
("munmap");

98 
	`exô
(1);

100 i‡(
	`˛o£
(
fd_‰om
) == -1)

101 
	`≥º‹
 ("close/3 failed");

103 
	`munm≠
(
d©a_de°
, 
Àn
);

104 i‡(
	`˛o£
(
fd_to
) == -1)

105 
	`≥º‹
 ("close/4 failed");

107 
	`exô
(0);

108 
	}
}

	@Training/L1_sysprg_trg/ipc/mmap_ipc/fileio_mmap/restart_lib.h

13 #i‚de‡
__RESTART_LIB__


14 
	#__RESTART_LIB__


	)

16 
	~<î∫o.h
>

17 
	~<f˙é.h
>

18 
	~<limôs.h
>

19 
	~<°rög.h
>

20 
	~<sys/£À˘.h
>

21 
	~<sys/time.h
>

22 
	~<sys/waô.h
>

24 
	#BLKSIZE
 
PIPE_BUF


	)

25 
	#MILLION
 1000000L

	)

26 
	#D_MILLION
 1000000.0

	)

28 
ªadwrôe
(
‰omfd
, 
tofd
);

29 
waôfdtimed
(
fd
, 
timevÆ
 
íd
);

33 
	$gëtimeout
(
timevÆ
 
íd
, timevÆ *
timeouç
)

35 
	`gëtimeofday
(
timeouç
, 
NULL
);

36 
timeouç
->
tv_£c
 = 
íd
.tv_sec -Åimeoutp->tv_sec;

37 
timeouç
->
tv_u£c
 = 
íd
.tv_usec -Åimeoutp->tv_usec;

38 i‡(
timeouç
->
tv_u£c
 >
MILLION
) {

39 
timeouç
->
tv_£c
++;

40 
timeouç
->
tv_u£c
 -
MILLION
;

42 i‡(
timeouç
->
tv_u£c
 < 0) {

43 
timeouç
->
tv_£c
--;

44 
timeouç
->
tv_u£c
 +
MILLION
;

46 i‡((
timeouç
->
tv_£c
 < 0) ||

47 ((
timeouç
->
tv_£c
 =0Ë&& (timeouç->
tv_u£c
 == 0))) {

48 
î∫o
 = 
ETIME
;

52 
	}
}

56 
	$r_˛o£
(
fûdes
)

58 
ªtvÆ
;

59 
ªtvÆ
 = 
	`˛o£
(
fûdes
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

60  
ªtvÆ
;

61 
	}
}

63 
	$r_dup2
(
fûdes
, 
fûdes2
)

65 
ªtvÆ
;

66 
ªtvÆ
 = 
	`dup2
(
fûdes
, 
fûdes2
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

67  
ªtvÆ
;

68 
	}
}

70 
	$r_›í2
(c⁄° *
∑th
, 
oÊag
)

72 
ªtvÆ
;

73 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

74  
ªtvÆ
;

75 
	}
}

77 
	$r_›í3
(c⁄° *
∑th
, 
oÊag
, 
mode_t
 
mode
)

79 
ªtvÆ
;

80 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
, 
mode
),Ñetval == -1

81 && 
î∫o
 =
EINTR
) ;

82  
ªtvÆ
;

83 
	}
}

85 
ssize_t
 
	$r_ªad
(
fd
, *
buf
, 
size_t
 
size
)

87 
ssize_t
 
ªtvÆ
;

88 
ªtvÆ
 = 
	`ªad
(
fd
, 
buf
, 
size
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

89  
ªtvÆ
;

90 
	}
}

92 
pid_t
 
	$r_waô
(*
°©_loc
)

94 
pid_t
 
ªtvÆ
;

95 ((
ªtvÆ
 = 
	`waô
(
°©_loc
)Ë=-1Ë&& (
î∫o
 =
EINTR
)) ;

96  
ªtvÆ
;

97 
	}
}

99 
pid_t
 
	$r_waôpid
(
pid_t
 
pid
, *
°©_loc
, 
›ti⁄s
)

101 
pid_t
 
ªtvÆ
;

102 ((
ªtvÆ
 = 
	`waôpid
(
pid
, 
°©_loc
, 
›ti⁄s
)) == -1) &&

103 (
î∫o
 =
EINTR
)) ;

104  
ªtvÆ
;

105 
	}
}

107 
ssize_t
 
	$r_wrôe
(
fd
, *
buf
, 
size_t
 
size
)

109 *
buÂ
;

110 
size_t
 
byã°owrôe
;

111 
ssize_t
 
byãswrôãn
;

112 
size_t
 
tŸÆbyãs
;

114 
buÂ
 = 
buf
, 
byã°owrôe
 = 
size
, 
tŸÆbyãs
 = 0;

115 
byã°owrôe
 > 0;

116 
buÂ
 +
byãswrôãn
, 
byã°owrôe
 -= byteswritten) {

117 
byãswrôãn
 = 
	`wrôe
(
fd
, 
buÂ
, 
byã°owrôe
);

118 i‡((
byãswrôãn
Ë=-1 && (
î∫o
 !
EINTR
))

120 i‡(
byãswrôãn
 == -1)

121 
byãswrôãn
 = 0;

122 
tŸÆbyãs
 +
byãswrôãn
;

124  
tŸÆbyãs
;

125 
	}
}

129 
timevÆ
 
	$add2cuºíâime
(
£c⁄ds
)

131 
timevÆ
 
√wtime
;

133 
	`gëtimeofday
(&
√wtime
, 
NULL
);

134 
√wtime
.
tv_£c
 +()
£c⁄ds
;

135 
√wtime
.
tv_u£c
 +()((
£c⁄ds
 - ()£c⁄dsË* 
D_MILLION
 + 0.5);

136 i‡(
√wtime
.
tv_u£c
 >
MILLION
) {

137 
√wtime
.
tv_£c
++;

138 
√wtime
.
tv_u£c
 -
MILLION
;

140  
√wtime
;

141 
	}
}

143 
	$c›yfûe
(
‰omfd
, 
tofd
)

145 
byã§ód
;

146 
tŸÆbyãs
 = 0;

148 (
byã§ód
 = 
	`ªadwrôe
(
‰omfd
, 
tofd
)) > 0)

149 
tŸÆbyãs
 +
byã§ód
;

150  
tŸÆbyãs
;

151 
	}
}

153 
ssize_t
 
	$ªadblock
(
fd
, *
buf
, 
size_t
 
size
)

155 *
buÂ
;

156 
ssize_t
 
byã§ód
;

157 
size_t
 
byã°‹ód
;

158 
size_t
 
tŸÆbyãs
;

160 
buÂ
 = 
buf
, 
byã°‹ód
 = 
size
, 
tŸÆbyãs
 = 0;

161 
byã°‹ód
 > 0; 
buÂ
 +
byã§ód
, bytestoread -= bytesread) {

162 
byã§ód
 = 
	`ªad
(
fd
, 
buÂ
, 
byã°‹ód
);

163 i‡((
byã§ód
 =0Ë&& (
tŸÆbyãs
 == 0))

165 i‡(
byã§ód
 == 0) {

166 
î∫o
 = 
EINVAL
;

169 i‡((
byã§ód
Ë=-1 && (
î∫o
 !
EINTR
))

171 i‡(
byã§ód
 == -1)

172 
byã§ód
 = 0;

173 
tŸÆbyãs
 +
byã§ód
;

175  
tŸÆbyãs
;

176 
	}
}

178 
	$ªadlöe
(
fd
, *
buf
, 
nbyãs
)

180 
numªad
 = 0;

181 
ªtu∫vÆ
;

183 
numªad
 < 
nbyãs
 - 1) {

184 
ªtu∫vÆ
 = 
	`ªad
(
fd
, 
buf
 + 
numªad
, 1);

185 i‡((
ªtu∫vÆ
 =-1Ë&& (
î∫o
 =
EINTR
))

187 i‡((
ªtu∫vÆ
 =0Ë&& (
numªad
 == 0))

189 i‡(
ªtu∫vÆ
 == 0)

191 i‡(
ªtu∫vÆ
 == -1)

193 
numªad
++;

194 i‡(
buf
[
numªad
 - 1] == '\n') {

195 
buf
[
numªad
] = '\0';

196  
numªad
;

199 
î∫o
 = 
EINVAL
;

201 
	}
}

203 
ssize_t
 
	$ªadtimed
(
fd
, *
buf
, 
size_t
 
nbyã
, 
£c⁄ds
)

205 
timevÆ
 
timed⁄e
;

207 
timed⁄e
 = 
	`add2cuºíâime
(
£c⁄ds
);

208 i‡(
	`waôfdtimed
(
fd
, 
timed⁄e
) == -1)

209  (
ssize_t
) (-1);

210  
	`r_ªad
(
fd
, 
buf
, 
nbyã
);

211 
	}
}

213 
	$ªadwrôe
(
‰omfd
, 
tofd
)

215 
buf
[
BLKSIZE
];

216 
byã§ód
;

218 i‡((
byã§ód
 = 
	`r_ªad
(
‰omfd
, 
buf
, 
BLKSIZE
)) < 0)

220 i‡(
byã§ód
 == 0)

222 i‡(
	`r_wrôe
(
tofd
, 
buf
, 
byã§ód
) < 0)

224  
byã§ód
;

225 
	}
}

227 
	$ªadwrôeblock
(
‰omfd
, 
tofd
, *
buf
, 
size
)

229 
byã§ód
;

231 
byã§ód
 = 
	`ªadblock
(
‰omfd
, 
buf
, 
size
);

232 i‡(
byã§ód
 !
size
)

233  
byã§ód
;

234  
	`r_wrôe
(
tofd
, 
buf
, 
size
);

235 
	}
}

237 
	$waôfdtimed
(
fd
, 
timevÆ
 
íd
)

239 
fd_£t
 
ªad£t
;

240 
ªtvÆ
;

241 
timevÆ
 
timeout
;

243 i‡((
fd
 < 0Ë|| (fd >
FD_SETSIZE
)) {

244 
î∫o
 = 
EINVAL
;

247 
	`FD_ZERO
(&
ªad£t
);

248 
	`FD_SET
(
fd
, &
ªad£t
);

249 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

251 ((
ªtvÆ
 = 
	`£À˘
(
fd
 + 1, &
ªad£t
, 
NULL
, NULL, &
timeout
)) == -1)

252 && (
î∫o
 =
EINTR
)) {

253 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

255 
	`FD_ZERO
(&
ªad£t
);

256 
	`FD_SET
(
fd
, &
ªad£t
);

258 i‡(
ªtvÆ
 == 0) {

259 
î∫o
 = 
ETIME
;

262 i‡(
ªtvÆ
 == -1)

265 
	}
}

	@Training/L1_sysprg_trg/ipc/mmap_ipc/mmap_simple/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_PRINT


47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=1; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 
	`¥ötk
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

59 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

126 
	~<löux/sched.h
>

127 
	~<löux/öãºu±.h
>

129 #i‚de‡
USE_FTRACE_PRINT


130 
	#PRINT_CTX
() do { \

131 
£p
='|', 
öå
='.'; \

133 i‡(
	`ö_öãºu±
()) { \

134 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

135 
öå
='H'; \

136 i‡(
	`ö_úq
()) \

137 
öå
='h'; \

138 i‡(
	`ö_so·úq
()) \

139 
öå
='s'; \

142 
öå
='.'; \

144 
	`DBGPRINT
( \

148 , 
	`smp_¥o˚ss‹_id
(), \

149 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

150 (
	`úqs_dißbÀd
()?'d':'.'), \

151 (
	`√ed_ªsched
()?'N':'.'), \

152 
öå
, \

153 (
	`¥ìm±_cou¡
() && 0xff) \

155 } 0)

	)

157 
	#PRINT_CTX
() do { \

158 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

163 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

165 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

166 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

168 } 0)

	)

184 #ifde‡
__KERNEL__


185 
	#as£π
(
ex¥
) do { \

186 i‡(!(
ex¥
)) { \

187 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

188 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

190 } 0)

	)

194 
ölöe
 
	$bìp
(
wh©
)

196 #ifde‡
__KERNEL__


197 
	`DBGPRINT
("%c", ()
wh©
);

199 ()
	`¥ötf
("%c", ()
wh©
);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

210 
c
=0, 
m
;\

211 
f‹_ödex
,
ö√r_ödex
; \

213 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++;\

216 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

217 
m
=0;m<50;m++); \

220 }

	)

223 #ifde‡
__KERNEL__


228 
	#DELAY_SEC
(
vÆ
) \

230 i‡(!
	`ö_öãºu±
()) { \

231 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

232 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

234 }

	)

241 
timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

242 
timevÆ
 *
y
);

246 
__©åibuã__
 ((
unu£d
))

247 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

248 
timevÆ
 *
y
)

251 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

252 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

253 
y
->
tv_u£c
 -1000000 * 
n£c
;

254 
y
->
tv_£c
 +
n£c
;

256 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

257 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

258 
y
->
tv_u£c
 +1000000 * 
n£c
;

259 
y
->
tv_£c
 -
n£c
;

264 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

265 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

268  
x
->
tv_£c
 < 
y
->tv_sec;

269 
	}
}

280 
__©åibuã__
 ((
unu£d
))

281 
	$dec2bö
(
decimÆ
, *
bö¨y
)

283 
k
 = 0, 
n
 = 0;

284 
√g_Êag
 = 0;

285 
ªmaö
;

295 #unde‡
TESTMODE


297 #ifde‡
TESTMODE


298 
ﬁd_decimÆ
;

300 
ãmp
[80];

303 i‡(
decimÆ
 < 0) {

304 
decimÆ
 = -decimal;

305 
√g_Êag
 = 1;

308 #ifde‡
TESTMODE


309 
ﬁd_decimÆ
 = 
decimÆ
;

311 
ªmaö
 = 
decimÆ
 % 2;

313 
decimÆ
 = decimal / 2;

315 #ifde‡
TESTMODE


316 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

317 
ªmaö
);

320 
ãmp
[
k
++] = 
ªmaö
 + '0';

321 } 
decimÆ
 > 0);

323 i‡(
√g_Êag
)

324 
ãmp
[
k
++] = '-';

326 
ãmp
[
k
++] = ' ';

329 
k
 >= 0)

330 
bö¨y
[
n
++] = 
ãmp
[--
k
];

332 
bö¨y
[
n
 - 1] = 0;

333 
	}
}

335 #i‚de‡
__KERNEL__


337 
	#MSG
(
°rög
, 
¨gs
...) do { \

338 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

339 } 0)

	)

341 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

342 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

343 } 0)

	)

345 
	#QP
 
	`MSG
("\n")

	)

348 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

350 i‡(
vîbo£
) \

351 
	`¥ötf
(
°r
, ##
¨gs
); \

352 } 0)

	)

354 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

356 
îr_°r
[512];

358 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

359 
	`≥º‹
(
îr_°r
);

360 
	`exô
(
exôcode
);

361 
	}
}

	@Training/L1_sysprg_trg/ipc/mmap_ipc/mmap_simple/mmap_simple.c

14 
	~<°dio.h
>

15 
	~<°dlib.h
>

16 
	~<uni°d.h
>

17 
	~<sys/mm™.h
>

18 
	~<sys/ty≥s.h
>

19 
	~<sys/°©.h
>

20 
	~<f˙é.h
>

21 
	~"ª°¨t_lib.h
"

22 
	~"c⁄víõ¡.h
"

30 
	$hex_dump
(*
d©a
, 
off£t
, 
size
, *
ˇ±i⁄
, 
vîbo£
)

32 
i
;

33 
j
;

34 
	#MAX_NUMERALS
 20

35 
ãmp
[
MAX_NUMERALS
];

	)

36 
buf„r
[128];

37 *
ascii
;

39 
	`mem£t
(
buf„r
, 0, 128);

41 i‡(
vîbo£
 && 
ˇ±i⁄
)

42 
	`¥ötf
("---------> %†<--------- (%d byã†‰om %p)\n", 
ˇ±i⁄
,

43 
size
, 
d©a
);

46 
¥ötf


51 
ascii
 = 
buf„r
 + 58;

52 
	`mem£t
(
buf„r
, ' ', 58 + 16);

54 
	`¢¥ötf
(
ãmp
, 
MAX_NUMERALS
, "+%06d", 
off£t
);

55 
buf„r
[58 + 16] = '\n';

56 
buf„r
[58 + 17] = '\0';

57 
buf„r
[0] = '+';

60 
buf„r
[1] = 
ãmp
[1];

61 
buf„r
[2] = 
ãmp
[2];

62 
buf„r
[3] = 
ãmp
[3];

63 
buf„r
[4] = 
ãmp
[4];

64 
buf„r
[5] = 
ãmp
[5];

65 
buf„r
[6] = 
ãmp
[6];

67 
i
 = 0, 
j
 = 0; i < 
size
; i++, j++) {

68 i‡(
j
 == 16) {

69 
	`¥ötf
("%s", 
buf„r
);

70 
	`mem£t
(
buf„r
, ' ', 58 + 16);

72 
	`¢¥ötf
(
ãmp
, 
MAX_NUMERALS
, "+%06d", 
i
+
off£t
);

73 
	`mem˝y
(
buf„r
, 
ãmp
, 7);

75 
j
 = 0;

78 
	`¢¥ötf
(
ãmp
, 
MAX_NUMERALS
, "%02x", 0xf‡& 
d©a
[
i
]);

79 
	`mem˝y
(
buf„r
 + 8 + (
j
 * 3), 
ãmp
, 2);

80 i‡((
d©a
[
i
] > 31) && (data[i] < 127))

81 
ascii
[
j
] = 
d©a
[
i
];

83 
ascii
[
j
] = '.';

86 i‡(
j
 != 0)

87 
	`¥ötf
("%s", 
buf„r
);

88 
	}
}

91 
	$maö
(
¨gc
, **
¨gv
)

93 
fd_‰om
;

94 
off_t
 
fsz
, 
Àn
, 
off
 = 0;

95 
°©
 
s°©
;

96 *
d©a_§c
, *
‹ig±r
;

98 i‡(
¨gc
 != 4) {

99 
	`Ârötf
(
°dîr
, "Usage: %s source-file start_offsetÜength\n",

100 
¨gv
[0]);

101 
	`exô
(1);

104 
fd_‰om
 = 
	`r_›í2
(
¨gv
[1], 
O_RDONLY
);

105 i‡(-1 =
fd_‰om
) {

106 
	`≥º‹
("open: src file");

107 
	`exô
(1);

110 i‡(
	`f°©
(
fd_‰om
, &
s°©
) == -1) {

111 
	`≥º‹
("fstat");

112 
	`exô
(1);

114 
fsz
 = 
s°©
.
°_size
;

115 i‡(0 =
fsz
) {

116 
	`Ârötf
(
°dîr
,

118 
¨gv
[0],árgv[1]);

119 
	`exô
(1);

122 
Àn
 = 
	`©ﬁ
(
¨gv
[3]);

123 i‡(
Àn
 <= 0) {

124 
	`Ârötf
(
°dîr
,

125 "%s: invÆidÜígth %ld,áb‹tög...\n", 
¨gv
[0], 
Àn
);

126 
	`exô
(1);

128 
off
 = 
	`©ﬁ
(
¨gv
[2]);

129 i‡((
off
 < 0Ë|| ((off+
Àn
Ë> 
fsz
)) {

130 
	`Ârötf
(
°dîr
,

131 "%s: invÆid off£à‹ off£t/Àngth combö©i⁄,áb‹tög...\n", 
¨gv
[0]);

132 
	`exô
(1);

143 
‹ig±r
 = 
d©a_§c
 = 
	`mm≠
(0, 
fsz
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd_‰om
, 0);

144 i‡(
d©a_§c
 =
MAP_FAILED
) {

145 
	`≥º‹
("mmap:Åo src file");

146 
	`exô
(1);

150 
	`hex_dump
(
d©a_§c
 + 
off
, off, 
Àn
, "Data", 0);

167 i‡(
	`msync
 (
‹ig±r
, 
Àn
, 
MS_SYNC
) < 0)

168 
	`≥º‹
("mysnc");

170 i‡(
	`munm≠
(
‹ig±r
, 
Àn
) == -1) {

171 
	`≥º‹
("munmap");

172 
	`exô
(1);

174 
	`˛o£
(
fd_‰om
);

175 
	`exô
(0);

176 
	}
}

	@Training/L1_sysprg_trg/ipc/mmap_ipc/mmap_simple/restart_lib.h

13 #i‚de‡
__RESTART_LIB__


14 
	#__RESTART_LIB__


	)

16 
	~<î∫o.h
>

17 
	~<f˙é.h
>

18 
	~<limôs.h
>

19 
	~<°rög.h
>

20 
	~<sys/£À˘.h
>

21 
	~<sys/time.h
>

22 
	~<sys/waô.h
>

24 
	#BLKSIZE
 
PIPE_BUF


	)

25 
	#MILLION
 1000000L

	)

26 
	#D_MILLION
 1000000.0

	)

28 
ªadwrôe
(
‰omfd
, 
tofd
);

29 
waôfdtimed
(
fd
, 
timevÆ
 
íd
);

33 
	$gëtimeout
(
timevÆ
 
íd
, timevÆ *
timeouç
)

35 
	`gëtimeofday
(
timeouç
, 
NULL
);

36 
timeouç
->
tv_£c
 = 
íd
.tv_sec -Åimeoutp->tv_sec;

37 
timeouç
->
tv_u£c
 = 
íd
.tv_usec -Åimeoutp->tv_usec;

38 i‡(
timeouç
->
tv_u£c
 >
MILLION
) {

39 
timeouç
->
tv_£c
++;

40 
timeouç
->
tv_u£c
 -
MILLION
;

42 i‡(
timeouç
->
tv_u£c
 < 0) {

43 
timeouç
->
tv_£c
--;

44 
timeouç
->
tv_u£c
 +
MILLION
;

46 i‡((
timeouç
->
tv_£c
 < 0) ||

47 ((
timeouç
->
tv_£c
 =0Ë&& (timeouç->
tv_u£c
 == 0))) {

48 
î∫o
 = 
ETIME
;

52 
	}
}

56 
	$r_˛o£
(
fûdes
)

58 
ªtvÆ
;

59 
ªtvÆ
 = 
	`˛o£
(
fûdes
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

60  
ªtvÆ
;

61 
	}
}

63 
	$r_dup2
(
fûdes
, 
fûdes2
)

65 
ªtvÆ
;

66 
ªtvÆ
 = 
	`dup2
(
fûdes
, 
fûdes2
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

67  
ªtvÆ
;

68 
	}
}

70 
	$r_›í2
(c⁄° *
∑th
, 
oÊag
)

72 
ªtvÆ
;

73 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

74  
ªtvÆ
;

75 
	}
}

77 
	$r_›í3
(c⁄° *
∑th
, 
oÊag
, 
mode_t
 
mode
)

79 
ªtvÆ
;

80 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
, 
mode
),Ñetval == -1

81 && 
î∫o
 =
EINTR
) ;

82  
ªtvÆ
;

83 
	}
}

85 
ssize_t
 
	$r_ªad
(
fd
, *
buf
, 
size_t
 
size
)

87 
ssize_t
 
ªtvÆ
;

88 
ªtvÆ
 = 
	`ªad
(
fd
, 
buf
, 
size
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

89  
ªtvÆ
;

90 
	}
}

92 
pid_t
 
	$r_waô
(*
°©_loc
)

94 
pid_t
 
ªtvÆ
;

95 ((
ªtvÆ
 = 
	`waô
(
°©_loc
)Ë=-1Ë&& (
î∫o
 =
EINTR
)) ;

96  
ªtvÆ
;

97 
	}
}

99 
pid_t
 
	$r_waôpid
(
pid_t
 
pid
, *
°©_loc
, 
›ti⁄s
)

101 
pid_t
 
ªtvÆ
;

102 ((
ªtvÆ
 = 
	`waôpid
(
pid
, 
°©_loc
, 
›ti⁄s
)) == -1) &&

103 (
î∫o
 =
EINTR
)) ;

104  
ªtvÆ
;

105 
	}
}

107 
ssize_t
 
	$r_wrôe
(
fd
, *
buf
, 
size_t
 
size
)

109 *
buÂ
;

110 
size_t
 
byã°owrôe
;

111 
ssize_t
 
byãswrôãn
;

112 
size_t
 
tŸÆbyãs
;

114 
buÂ
 = 
buf
, 
byã°owrôe
 = 
size
, 
tŸÆbyãs
 = 0;

115 
byã°owrôe
 > 0;

116 
buÂ
 +
byãswrôãn
, 
byã°owrôe
 -= byteswritten) {

117 
byãswrôãn
 = 
	`wrôe
(
fd
, 
buÂ
, 
byã°owrôe
);

118 i‡((
byãswrôãn
Ë=-1 && (
î∫o
 !
EINTR
))

120 i‡(
byãswrôãn
 == -1)

121 
byãswrôãn
 = 0;

122 
tŸÆbyãs
 +
byãswrôãn
;

124  
tŸÆbyãs
;

125 
	}
}

129 
timevÆ
 
	$add2cuºíâime
(
£c⁄ds
)

131 
timevÆ
 
√wtime
;

133 
	`gëtimeofday
(&
√wtime
, 
NULL
);

134 
√wtime
.
tv_£c
 +()
£c⁄ds
;

135 
√wtime
.
tv_u£c
 +()((
£c⁄ds
 - ()£c⁄dsË* 
D_MILLION
 + 0.5);

136 i‡(
√wtime
.
tv_u£c
 >
MILLION
) {

137 
√wtime
.
tv_£c
++;

138 
√wtime
.
tv_u£c
 -
MILLION
;

140  
√wtime
;

141 
	}
}

143 
	$c›yfûe
(
‰omfd
, 
tofd
)

145 
byã§ód
;

146 
tŸÆbyãs
 = 0;

148 (
byã§ód
 = 
	`ªadwrôe
(
‰omfd
, 
tofd
)) > 0)

149 
tŸÆbyãs
 +
byã§ód
;

150  
tŸÆbyãs
;

151 
	}
}

153 
ssize_t
 
	$ªadblock
(
fd
, *
buf
, 
size_t
 
size
)

155 *
buÂ
;

156 
ssize_t
 
byã§ód
;

157 
size_t
 
byã°‹ód
;

158 
size_t
 
tŸÆbyãs
;

160 
buÂ
 = 
buf
, 
byã°‹ód
 = 
size
, 
tŸÆbyãs
 = 0;

161 
byã°‹ód
 > 0; 
buÂ
 +
byã§ód
, bytestoread -= bytesread) {

162 
byã§ód
 = 
	`ªad
(
fd
, 
buÂ
, 
byã°‹ód
);

163 i‡((
byã§ód
 =0Ë&& (
tŸÆbyãs
 == 0))

165 i‡(
byã§ód
 == 0) {

166 
î∫o
 = 
EINVAL
;

169 i‡((
byã§ód
Ë=-1 && (
î∫o
 !
EINTR
))

171 i‡(
byã§ód
 == -1)

172 
byã§ód
 = 0;

173 
tŸÆbyãs
 +
byã§ód
;

175  
tŸÆbyãs
;

176 
	}
}

178 
	$ªadlöe
(
fd
, *
buf
, 
nbyãs
)

180 
numªad
 = 0;

181 
ªtu∫vÆ
;

183 
numªad
 < 
nbyãs
 - 1) {

184 
ªtu∫vÆ
 = 
	`ªad
(
fd
, 
buf
 + 
numªad
, 1);

185 i‡((
ªtu∫vÆ
 =-1Ë&& (
î∫o
 =
EINTR
))

187 i‡((
ªtu∫vÆ
 =0Ë&& (
numªad
 == 0))

189 i‡(
ªtu∫vÆ
 == 0)

191 i‡(
ªtu∫vÆ
 == -1)

193 
numªad
++;

194 i‡(
buf
[
numªad
 - 1] == '\n') {

195 
buf
[
numªad
] = '\0';

196  
numªad
;

199 
î∫o
 = 
EINVAL
;

201 
	}
}

203 
ssize_t
 
	$ªadtimed
(
fd
, *
buf
, 
size_t
 
nbyã
, 
£c⁄ds
)

205 
timevÆ
 
timed⁄e
;

207 
timed⁄e
 = 
	`add2cuºíâime
(
£c⁄ds
);

208 i‡(
	`waôfdtimed
(
fd
, 
timed⁄e
) == -1)

209  (
ssize_t
) (-1);

210  
	`r_ªad
(
fd
, 
buf
, 
nbyã
);

211 
	}
}

213 
	$ªadwrôe
(
‰omfd
, 
tofd
)

215 
buf
[
BLKSIZE
];

216 
byã§ód
;

218 i‡((
byã§ód
 = 
	`r_ªad
(
‰omfd
, 
buf
, 
BLKSIZE
)) < 0)

220 i‡(
byã§ód
 == 0)

222 i‡(
	`r_wrôe
(
tofd
, 
buf
, 
byã§ód
) < 0)

224  
byã§ód
;

225 
	}
}

227 
	$ªadwrôeblock
(
‰omfd
, 
tofd
, *
buf
, 
size
)

229 
byã§ód
;

231 
byã§ód
 = 
	`ªadblock
(
‰omfd
, 
buf
, 
size
);

232 i‡(
byã§ód
 !
size
)

233  
byã§ód
;

234  
	`r_wrôe
(
tofd
, 
buf
, 
size
);

235 
	}
}

237 
	$waôfdtimed
(
fd
, 
timevÆ
 
íd
)

239 
fd_£t
 
ªad£t
;

240 
ªtvÆ
;

241 
timevÆ
 
timeout
;

243 i‡((
fd
 < 0Ë|| (fd >
FD_SETSIZE
)) {

244 
î∫o
 = 
EINVAL
;

247 
	`FD_ZERO
(&
ªad£t
);

248 
	`FD_SET
(
fd
, &
ªad£t
);

249 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

251 ((
ªtvÆ
 = 
	`£À˘
(
fd
 + 1, &
ªad£t
, 
NULL
, NULL, &
timeout
)) == -1)

252 && (
î∫o
 =
EINTR
)) {

253 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

255 
	`FD_ZERO
(&
ªad£t
);

256 
	`FD_SET
(
fd
, &
ªad£t
);

258 i‡(
ªtvÆ
 == 0) {

259 
î∫o
 = 
ETIME
;

262 i‡(
ªtvÆ
 == -1)

265 
	}
}

	@Training/L1_sysprg_trg/ipc/pipes/fifos/rd_fifo.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<f˙é.h
>

20 
	~<sys/°©.h
>

21 
	~<sys/ty≥s.h
>

22 
	~<uni°d.h
>

24 
	#MAX_BYTES
 1024

	)

26 
	$maö
(
¨gc
, **
¨gv
)

28 
fd
;

29 * 
myfifo
 = "./myfifo", 
buf
[
MAX_BYTES
];

37 
fd
 = 
	`›í
(
myfifo
, 
O_RDONLY
);

38 i‡(
fd
 == -1) {

39 
	`≥º‹
("open failed");

40 
	`exô
 (1);

42 i‡(
	`ªad
(
fd
, 
buf
, 
MAX_BYTES
) == -1) {

43 
	`≥º‹
("read failed");

44 
	`exô
 (1);

46 
	`˛o£
(
fd
);

48 
	`¥ötf
("%s: Received data:\n"

49 "%s\n", 
¨gv
[0], 
buf
);

52 
	}
}

	@Training/L1_sysprg_trg/ipc/pipes/fifos/wr_fifo.c

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<°rög.h
>

20 
	~<f˙é.h
>

21 
	~<sys/°©.h
>

22 
	~<sys/ty≥s.h
>

23 
	~<uni°d.h
>

25 
	$maö
()

27 
fd
;

28 * 
myfifo
 = "./myfifo", *
msg
="Hi FIFO, wassup";

31 
	`u∆ök
(
myfifo
);

32 i‡(
	`mkfifo
(
myfifo
, 0666) == -1) {

33 
	`≥º‹
("mkfifo failed");

34 
	`exô
 (1);

41 
fd
 = 
	`›í
(
myfifo
, 
O_WRONLY
);

42 i‡(
fd
 == -1) {

43 
	`≥º‹
("open failed");

44 
	`u∆ök
(
myfifo
);

45 
	`exô
 (1);

47 
	`wrôe
(
fd
, 
msg
, 
	`°æí
(msg));

48 
	`˛o£
(
fd
);

51 
	}
}

	@Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/no_pclose_zomb.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	~<°dlib.h
>

5 
	$maö
()

7 
FILE
 *
Â
;

8 
buf
[80];

9 
i
;

11 
i
 = 0; i < 5; i++) {

12 
Â
 = 
	`p›í
("date", "r");

13 i‡(!
Â
) {

14 
	`≥º‹
("popen");

15 
	`exô
(1);

17 
	`fgës
(
buf
, 80, 
Â
);

19 
	`p˛o£
(
Â
);

21 
	`¥ötf
("%s\n", 
buf
);

24 
	`∑u£
();

25 
	}
}

	@Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/pipe-dup2.c

6 
	~<°dio.h
>

7 
	~<uni°d.h
>

8 
	~<°dlib.h
>

10 
	$maö
 (
¨gc
, *
¨gv
[])

12 
fd
[2];

14 if–
	`pùe
(
fd
) == -1 ) {

15 
	`≥º‹
("du∞:Öùe"), 
	`exô
(1);

18  
	`f‹k
() ) {

19 -1 : 
	`≥º‹
( "dup2: fork" );

20 
	`exô
( 1 );

23 
	`˛o£
–
fd
[1] );

24 
	`dup2
–
fd
[0], 
STDIN_FILENO
 );

25 
	`˛o£
–
fd
[0] );

27 if–
	`exe˛
( "/usr/bin/wc", "wc", "-l", (*)0 )==-1) {

28 
	`≥º‹
("dup:Éxec1"), 
	`exô
(1); }

31 
	`˛o£
–
fd
[0] );

32 
	`dup2
–
fd
[1], 
STDOUT_FILENO
 );

33 
	`˛o£
–
fd
[1] );

35 if–
	`exe˛p
( "who", "who", (*)0) == -1 ) {

36 
	`≥º‹
("dup:Éxe˛p"), 
	`exô
(1); }

38 
	`exô
 (0);

39 
	}
}

	@Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/pipe1.c

6 
	~<°dio.h
>

7 
	~<°dlib.h
>

8 
	~<uni°d.h
>

9 
	~<°rög.h
>

10 
	~<sys/waô.h
>

12 
	#MAX
 80

	)

14 
	$maö
(
¨gc
, **
¨gv
)

16 
pid
;

17 
n
;

18 
fd
[2];

19 
löe
[
MAX
], 
buf„r
[MAX];

21 
	`Ârötf
(
°dîr
, "Now creatingÖipe..\n");

22 if–
	`pùe
–
fd
 ) !=0 ) {

23 
	`≥º‹
(
¨gv
[0]);

24 
	`exô
 (1);

27 
pid
=
	`f‹k
()) {

28 -1: 
	`≥º‹
(
¨gv
[0]);

29 
	`exô
 (1);

32 
	`˛o£
(
fd
[1]);

33 
n
 = 
	`ªad
–
fd
[0], 
buf„r
, 
MAX
);

34 if–
n
==-1 ) {

35 
	`≥º‹
("chûdÑód"); 
	`˛o£
(
fd
[0]); 
	`exô
(1);

37 
buf„r
[
n
] = '\0';

39 
	`¥ötf
("Chûd: you∏löêwas: \"%s\"\n", 
buf„r
);

40 
	`˛o£
(
fd
[0]);

41 
	`exô
( 0 );

44 
	`˛o£
(
fd
[0]);

45 
	`¥ötf
( "EnterÜine: " );

46 
	`fgës
(
löe
,
MAX
,
°dö
);

48 
	`¥ötf
( "Parent: Writing yourÜineÅo child withÖipe...\n" );

50 
n
=
	`wrôe
–
fd
[1], 
löe
, 
	`°æí
(line) );

51 if–
n
==-1 ) {

52 
	`≥º‹
("∑ª¡ wrôe"); 
	`˛o£
(
fd
[1]); 
	`exô
(1);

54 
	`˛o£
(
fd
[1]);

55 
	`waô
(0);

57 
	`exô
 (0);

58 
	}
}

	@Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/pipe2.c

10 
	~<°dio.h
>

11 
	~<°dlib.h
>

12 
	~<uni°d.h
>

13 
	~<°rög.h
>

14 
	~<sig«l.h
>

15 
	~<sys/waô.h
>

17 
	$pùe_broke
–
sig
 )

19 
	`¥ötf
("I¿SIGPIPE sig«»h™dÀr::pùe_broke: sig«»%d\n",
sig
);

20 
	}
}

22 
	$maö
(
¨gc
, **
¨gv
)

24 
chûd_exô_Êag
=0;

25 
siga˘i⁄
 
a˘
;

26 
pid
;

27 
n
;

28 
fd
[2];

29 
löe
[80], 
buf„r
[80];

31 i‡(
¨gc
 < 2) {

32 
	`Ârötf
(
°dîr
, "Ußge: %†chûd_exô_Êag=[0]|1\n\
 chûd_exô_Êag = 0 :Ç‹mÆÉxecuti⁄ (deÁu…)\n\
_exô_Êag = 1 : chûdÖro˚s†dõ†immd. (ªsu…ög i¿SIGPIPEÅÿ\
)\n", 
¨gv
[0]);

36 
	`exô
 (1);

38 i‡(
¨gc
 =2 && 
	`©oi
(
¨gv
[1]) == 1)

39 
chûd_exô_Êag
=1;

41 
a˘
.
ß_h™dÀr
 = 
pùe_broke
;

42 
	`sigem±y£t
 (&
a˘
.
ß_mask
);

43 
a˘
.
ß_Êags
 = 
SA_RESTART
;

44 i‡(
	`siga˘i⁄
(
SIGPIPE
, &
a˘
, 0) == -1) {

45 
	`≥º‹
("sigaction failed");

46 
	`exô
 (1);

49 
	`Ârötf
(
°dîr
, "Now creatingÖipe..\n");

50 if–
	`pùe
–
fd
 ) !=0 ) {

51 
	`≥º‹
(
¨gv
[0]);

52 
	`exô
 (1);

55 if–(
pid
=
	`f‹k
()) <0) {

56 
	`≥º‹
(
¨gv
[0]);

57 
	`exô
 (1);

60 if(
pid
 != 0) {

63 i‡(
chûd_exô_Êag
 == 1)

64 i‡(
	`waô
 (0) == -1)

65 
	`≥º‹
("∑ª¡: waô faûed"), 
	`exô
 (1);

67 
	`˛o£
(
fd
[0]);

68 
	`¥ötf
( "EnterÜine: " );

69 
	`fgës
(
löe
,80,
°dö
);

71 
	`¥ötf
( "Writing yourÜineÅo child withÖipe...\n" );

72 
n
=
	`wrôe
–
fd
[1], 
löe
, 
	`°æí
(line) );

73 if–
n
 == -1 ) {

74 
	`≥º‹
("parent:write failed");

77 
	`¥ötf
("wrôe: %d byã†wrôãn\n",
n
);

78 
	`˛o£
(
fd
[1]);

79 
	`waô
(0);

82 i‡(1 =
chûd_exô_Êag
)

87 
	`exô
( 1 );

89 
	`˛o£
(
fd
[1]);

90 
n
 = 
	`ªad
–
fd
[0], 
buf„r
, 80);

91 
buf„r
[
n
] = '\0';

93 
	`Ârötf
(
°dîr
, "Chûd: you∏löêwa†%s\n", 
buf„r
);

94 
	`˛o£
(
fd
[0]);

95 
	`exô
( 0 );

97 
	`exô
 (0);

98 
	}
}

	@Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/popen_tst.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	~<°dlib.h
>

5 
	$maö
()

7 
FILE
 *
Â
;

8 
buf
[80];

10 
Â
 = 
	`p›í
("date", "r");

11 i‡(!
Â
) {

12 
	`≥º‹
("p›í"); 
	`exô
 (1);

14 
	`fgës
(
buf
,80,
Â
);

15 
	`p˛o£
(
Â
);

16 
	`¥ötf
("%s",
buf
);

18 
	`exô
(0);

19 
	}
}

	@Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/whopipe.c

6 
	#LINELENGTH
 132

	)

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<°dlib.h
>

10 
	~<˘y≥.h
>

12 
	$maö
()

14 
buf
[
LINELENGTH
+1];

15 *
s
=
buf
;

16 
FILE
 *
Â1
, *
Â2
;

19 if–(
Â1
=
	`p›í
–"who", "r" )Ë=
NULL
 ) {

20 
	`Ârötf
(
°dîr
, "Error openingÖipe\n");

21 
	`exô
(1);

25 if–(
Â2
=
	`p›í
–"w¯-l", "w")Ë=
NULL
 ) {

26 
	`Ârötf
(
°dîr
,"Error openingÖipe\n");

27 
	`p˛o£
(
Â1
);

28 
	`exô
(1);

31  
	`fgës
(
s
,
LINELENGTH
,
Â1
Ë!
NULL
 )

32 
	`Âuts
(
s
, 
Â2
);

34 
	`p˛o£
(
Â1
);

35 
	`p˛o£
(
Â2
);

36 
	`exô
 (0);

37 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_message_queue_child.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<mÆloc.h
>

12 
	~<f˙é.h
>

13 
	~<sys/°©.h
>

14 
	~<mqueue.h
>

16 c⁄° 
	gmq«me
[] = "/posix_mq";

17 
	$maö
(
¨gc
, **
¨gv
)

19 
rc
 = 1;

20 
mqd_t
 
msgid
 = 0;

21 *
msg
 = 
NULL
;

22 
ssize_t
 
rv
 = 0;

24 
msg
 = (*)
	`mÆloc
(1024);

25 i‡(!
msg
) {

26 
	`≥º‹
("malloc");

27 
˛ónup
;

31 
msgid
 = 
	`mq_›í
(
mq«me
, 
O_RDONLY
);

32 i‡(
msgid
 < 0) {

33 
	`≥º‹
("mq_open");

34 
˛ónup
;

37 
	`¥ötf
("execve'd chûdÖid i†%d; sÀï f‹ 10s...\n", 
	`gëpid
());

38 
	`¶ìp
(10);

39 
	`¥ötf
("execve'd child waiting for message\n");

40 
rv
 = 
	`mq_ª˚ive
(
msgid
, 
msg
, 1024, 
NULL
);

41 i‡(
rv
 < 0) {

42 
	`≥º‹
("mq_receive");

43 
˛ónup
;

45 
	`¥ötf
("execve'd chûdÑe˚ived mesßgê%s\n", 
msg
);

46 
rc
 = 0;

48 
˛ónup
:

49 
	`‰ì
(
msg
);

50 i‡(
msgid
 > 0)

51 
	`mq_˛o£
(
msgid
);

52  
rc
;

53 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_message_queue_parent.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<mÆloc.h
>

12 
	~<f˙é.h
>

13 
	~<sys/°©.h
>

14 
	~<sys/ty≥s.h
>

15 
	~<sys/waô.h
>

16 
	~<mqueue.h
>

18 c⁄° 
	gmq«me
[] = "/posix_mq";

20 
	$maö
(
¨gc
, **
¨gv
)

22 
rc
 = 1;

23 
pid_t
 
˝id
 = 0;

24 
mqd_t
 
msgid
 = 0;

25 
mq_©å
 
©å
;

26 *
msg
 = 
NULL
;

27 
rv
 = 0;

28 
exec
 = 0;

30 
msg
 = (*)
	`mÆloc
(1024);

31 i‡(!
msg
) {

32 
	`≥º‹
("msg");

33 
˛ónup
;

36 
©å
.
mq_Êags
 = 
O_RDWR
;

37 
©å
.
mq_maxmsg
 = 10;

38 
©å
.
mq_msgsize
 = 1024;

39 
©å
.
mq_curmsgs
 = 0;

40 
msgid
 = 
	`mq_›í
(
mq«me
, 
O_RDWR
 | 
O_CREAT
, 0644, &
©å
);

41 i‡(
msgid
 < 0) {

42 
	`≥º‹
("mq_open");

43 
˛ónup
;

45 
	`¥ötf
("%s: cª©ed POSIX MQ undî /dev/mqueue%s\n", 
¨gv
[0], 
mq«me
);

47 
˝id
 = 
	`f‹k
();

48 i‡(
˝id
 < 0) {

49 
	`≥º‹
("fork");

50 
˛ónup
;

51 } i‡(
˝id
 == 0) {

52 
	`¥ötf
("chûdÖid i†%d\n", 
	`gëpid
());

53 
exec
 =

54 
	`exe˛
("posix_message_queue_child",

56 i‡(
exec
 < 0) {

57 
	`≥º‹
("execve");

58 
˛ónup
;

61 
	`¥ötf
("∑ª¡Öid i†%dánd chûdÖid i†%d\n", 
	`gëpid
(),

62 
˝id
);

63 
	`¶ìp
(1);

64 
	`¥ötf
("parentáboutÅo send message\n");

65 
rv
 = 
	`¢¥ötf
(
msg
, 1024, "1234");

66 i‡(
rv
 <= 0) {

67 
	`≥º‹
("snprintf");

68 
˛ónup
;

70 
rv
 = 
	`mq_£nd
(
msgid
, 
msg
, 
	`°æí
(msg), 0);

71 i‡(
rv
 < 0) {

72 
	`≥º‹
("mq_send");

73 
˛ónup
;

75 
	`¥ötf
("parent delay (canÜookup /dev/mqueue/ ...)\n");

76 
	`¶ìp
(20);

77 
	`waô
(0);

79 
rc
 = 0;

81 
˛ónup
:

82 i‡(
msgid
 > 0) {

83 
	`mq_˛o£
(
msgid
);

86  
rc
;

87 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_semaphore_child.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<f˙é.h
>

11 
	~<sys/°©.h
>

12 
	~<£m≠h‹e.h
>

14 
	$maö
(
¨gc
, **
¨gv
)

16 
rc
 = 1;

17 
£m_t
 *
£m
 = 
NULL
;

18 
rv
 = 0;

21 
£m
 = 
	`£m_›í
("/£m«me", 
O_RDWR
);

22 i‡(
£m
 =
SEM_FAILED
) {

23 
	`≥º‹
("sem_open");

24 
˛ónup
;

27 
	`¥ötf
("execve'd chûdÖid i†%d\n", 
	`gëpid
());

28 
	`¥ötf
("execve'd child waiting for semaphoreÇon-zero value\n");

29 
rv
 = 
	`£m_waô
(
£m
);

30 i‡(
rv
 < 0) {

31 
	`≥º‹
("sem_wait");

32 
˛ónup
;

34 
	`¥ötf
("execve'd child detected semaphoreÇon-zero value\n");

35 
rc
 = 0;

37 
˛ónup
:

38 i‡(
£m
 !
SEM_FAILED
)

39 
	`£m_˛o£
(
£m
);

40  
rc
;

41 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_semaphore_parent.c

17 
	~<°dio.h
>

18 
	~<uni°d.h
>

19 
	~<î∫o.h
>

20 
	~<f˙é.h
>

21 
	~<sys/°©.h
>

22 
	~<sys/ty≥s.h
>

23 
	~<sys/waô.h
>

24 
	~<£m≠h‹e.h
>

26 
	$maö
(
¨gc
, **
¨gv
)

28 
rc
 = 1;

29 
pid_t
 
˝id
 = 0;

30 
£m_t
 *
£m
 = 
NULL
;

31 
rv
 = 0;

32 
exec
 = 0;

35 
£m
 =

36 
	`£m_›í
("/£m«me", 
O_RDWR
 | 
O_CREAT
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
,

38 i‡(
£m
 =
SEM_FAILED
) {

39 
	`≥º‹
("sem_open");

40 
˛ónup
;

43 
˝id
 = 
	`f‹k
();

44 i‡(
˝id
 < 0) {

45 
	`≥º‹
("fork");

46 
˛ónup
;

47 } i‡(
˝id
 == 0) {

48 
	`¥ötf
("chûdÖid i†%d\n", 
	`gëpid
());

49 
exec
 =

50 
	`exe˛
("posix_semaphore_child", "posix_semaphore_child",

51 (*)
NULL
);

52 i‡(
exec
 < 0) {

53 
	`≥º‹
("execve");

54 
˛ónup
;

57 
	`¥ötf
("∑ª¡Öid i†%dánd chûdÖid i†%d\n", 
	`gëpid
(),

58 
˝id
);

59 
	`¶ìp
(1);

60 
	`¥ötf
("parent delay\n");

61 
	`¶ìp
(2);

62 
	`¥ötf
("parentáboutÅo increment semaphoreÅoÇon-zero\n");

63 
rv
 = 
	`£m_po°
(
£m
);

64 i‡(
rv
 < 0) {

65 
	`≥º‹
("sem_post");

66 
˛ónup
;

68 
	`waô
(0);

70 
rc
 = 0;

72 
˛ónup
:

73 i‡(
£m
 !
SEM_FAILED
) {

74 
	`£m_˛o£
(
£m
);

75 
	`£m_u∆ök
("/semname");

77  
rc
;

78 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_shared_memory_child.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<mÆloc.h
>

12 
	~<sys/mm™.h
>

13 
	~<sys/°©.h
>

14 
	~<f˙é.h
>

16 
	$maö
(
¨gc
, **
¨gv
)

18 
rc
 = 1;

19 
shmfd
 = 0;

20 *
buf„r
 = 
NULL
;

21 
size_t
 
buf„r_size
 = 4096;

22 
size
 = 0;

26 
shmfd
 = 
	`shm_›í
("/shm«me", 
O_RDWR
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

27 i‡(
shmfd
 < 0) {

28 
	`≥º‹
("shm_open");

29 
˛ónup
;

32 
buf„r
 = 
	`mm≠
(
NULL
, 
buf„r_size
, 
PROT_WRITE
, 
MAP_SHARED
, 
shmfd
, 0);

33 i‡(
buf„r
 < 0) {

34 
	`≥º‹
("mmap");

35 
˛ónup
;

38 
	`¥ötf
("execve'd chûdÖid i†%d\n", 
	`gëpid
());

39 
size
 = 
	`¢¥ötf
(
buf„r
, 
buf„r_size
, "hello fromÉxecve'd child");

40 i‡(
size
 <= 0) {

41 
	`≥º‹
("snprintf");

42 
˛ónup
;

44 
	`¥ötf
("execve'd chûd wrŸêtÿsh¨ed mem‹y buf„r: %s\n", 
buf„r
);

45 
rc
 = 0;

47 
˛ónup
:

48 i‡(
buf„r
 > 0)

49 
	`munm≠
(
buf„r
, 
buf„r_size
);

50 i‡(
shmfd
 > 0)

51 
	`˛o£
(
shmfd
);

52  
rc
;

53 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_shared_memory_parent.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<mÆloc.h
>

12 
	~<sys/mm™.h
>

13 
	~<sys/°©.h
>

14 
	~<sys/ty≥s.h
>

15 
	~<sys/waô.h
>

16 
	~<f˙é.h
>

18 
	$maö
(
¨gc
, **
¨gv
)

20 
rc
 = 1;

21 
pid_t
 
˝id
 = 0;

22 
shmfd
 = 0;

23 *
buf„r
 = 
NULL
;

24 
size_t
 
buf„r_size
 = 4096;

25 
exec
 = 0;

26 
rv
 = 0;

29 
shmfd
 =

30 
	`shm_›í
("/shm«me", 
O_RDWR
 | 
O_CREAT
, 
S_IRWXU
 | 
S_IRWXG
 | 
S_IRWXO
);

31 i‡(
shmfd
 < 0) {

32 
	`≥º‹
("shm_open");

33 
˛ónup
;

37 
rv
 = 
	`·runˇã
(
shmfd
, 
buf„r_size
);

38 i‡(
rv
 < 0) {

39 
	`≥º‹
("ftruncate");

40 
˛ónup
;

45 
buf„r
 = 
	`mm≠
(
NULL
, 
buf„r_size
, 
PROT_READ
, 
MAP_SHARED
, 
shmfd
, 0);

46 i‡(
buf„r
 < 0) {

47 
	`≥º‹
("mmap");

48 
˛ónup
;

51 
˝id
 = 
	`f‹k
();

52 i‡(
˝id
 < 0) {

53 
	`≥º‹
("fork");

54 
˛ónup
;

55 } i‡(
˝id
 == 0) {

56 
	`¥ötf
("chûdÖid i†%d\n", 
	`gëpid
());

57 
exec
 =

58 
	`exe˛
("posix_shared_memory_child",

59 "posix_sh¨ed_mem‹y_chûd", (*)
NULL
);

60 i‡(
exec
 < 0) {

61 
	`≥º‹
("execve");

62 
˛ónup
;

65 
	`¥ötf
("∑ª¡Öid i†%dánd chûdÖid i†%d\n", 
	`gëpid
(),

66 
˝id
);

67 
	`waô
(0);

68 
	`¥ötf
("Parent: child has writtenÅoÅhe shmfile under /dev/shm/shmname\n"

70 
	`¶ìp
(5);

71 
	`¥ötf
("∑ª¡Ñód from sh¨ed mem‹y buf„r: %s\n", 
buf„r
);

73 
rc
 = 0;

75 
˛ónup
:

76 i‡(
buf„r
 > 0)

77 
	`munm≠
(
buf„r
, 
buf„r_size
);

78 i‡(
shmfd
 > 0) {

79 
	`˛o£
(
shmfd
);

80 
	`shm_u∆ök
("/shmname");

82  
rc
;

83 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_message_queue_file_child.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<mÆloc.h
>

12 
	~<sys/ùc.h
>

13 
	~<sys/msg.h
>

15 
	smsgbuf
 {

16 
	mmty≥
;

17 
	mmãxt
[1];

20 
	$maö
(
¨gc
, **
¨gv
)

22 
rc
 = 1;

23 
msgid
 = 0;

24 
msgbuf
 
msg
;

25 
ssize_t
 
rv
 = 0;

26 
key_t
 
key
;

28 
key
 = 
	`·ok
("msgfile", 'R');

29 i‡(
key
 < 0) {

30 
	`≥º‹
("ftok");

31 
˛ónup
;

33 
msgid
 = 
	`msggë
(
key
, 0666);

34 i‡(
msgid
 < 0) {

35 
	`≥º‹
("msgget");

36 
˛ónup
;

38 
	`¥ötf
("execve'd chûdÖid i†%d\n", 
	`gëpid
());

39 
	`¥ötf
("execve'd child waiting for message\n");

40 
rv
 = 
	`msgrcv
(
msgid
, &
msg
, 0, 0, 0);

41 i‡(
rv
 < 0) {

42 
	`≥º‹
("msgrcv");

43 
˛ónup
;

45 
	`¥ötf
("execve'd chûdÑe˚ived mesßgêty≥ %ld\n", 
msg
.
mty≥
);

46 
rc
 = 0;

47 
˛ónup
:

48  
rc
;

49 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_message_queue_file_parent.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<mÆloc.h
>

12 
	~<sys/ùc.h
>

13 
	~<sys/msg.h
>

14 
	~<sys/ty≥s.h
>

15 
	~<sys/waô.h
>

17 
	smsgbuf
 {

18 
	mmty≥
;

19 
	mmãxt
[1];

22 
	$maö
(
¨gc
, **
¨gv
)

24 
rc
 = 1;

25 
pid_t
 
˝id
 = 0;

26 
key_t
 
key
 = 0;

27 
msgid
 = 0;

28 
msqid_ds
 
msgds
;

29 
msgbuf
 
msg
;

30 
rv
 = 0;

31 
exec
 = 0;

32 
key
 = 
	`·ok
("msgfile", 'R');

33 i‡(
key
 < 0) {

34 
	`≥º‹
("ftok");

35 
˛ónup
;

37 
msgid
 = 
	`msggë
(
key
, 
IPC_CREAT
 | 0666);

38 i‡(
msgid
 < 0) {

39 
	`≥º‹
("msgget");

40 
˛ónup
;

42 
˝id
 = 
	`f‹k
();

43 i‡(
˝id
 < 0) {

44 
	`≥º‹
("fork");

45 
˛ónup
;

46 } i‡(
˝id
 == 0) {

47 
	`¥ötf
("chûdÖid i†%d\n", 
	`gëpid
());

48 
exec
 =

49 
	`exe˛
("sysv_message_queue_file_child",

50 "sysv_mesßge_queue_fûe_chûd", (*)
NULL
);

51 i‡(
exec
 < 0) {

52 
	`≥º‹
("execve");

53 
˛ónup
;

56 
	`¥ötf
("∑ª¡Öid i†%dánd chûdÖid i†%d\n", 
	`gëpid
(),

57 
˝id
);

58 
	`¶ìp
(1);

59 
	`¥ötf
("parent delay\n");

60 
	`¶ìp
(2);

61 
	`¥ötf
("parentáboutÅo send message\n");

62 
msg
.
mty≥
 = 1234;

63 
rv
 = 
	`msg¢d
(
msgid
, &
msg
, 0, 0);

64 i‡(
rv
 < 0) {

65 
	`≥º‹
("msgsnd");

66 
˛ónup
;

68 
	`waô
(0);

70 
rc
 = 0;

71 
˛ónup
:

72 i‡(
msgid
 > 0)

73 
	`msg˘l
(
msgid
, 
IPC_RMID
, &
msgds
);

74  
rc
;

75 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_semaphore_file_child.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<mÆloc.h
>

12 
	~<sys/ùc.h
>

13 
	~<sys/£m.h
>

15 
	$maö
(
¨gc
, **
¨gv
)

17 
rc
 = 1;

18 
key_t
 
key
 = 0;

19 
£mid
 = 0;

20 
£mbuf
 
s›s
[2];

21 
rv
 = 0;

22 
key
 = 
	`·ok
("semfile", 'R');

23 i‡(
key
 < 0) {

24 
	`≥º‹
("ftok");

25 
˛ónup
;

27 
£mid
 = 
	`£mgë
(
key
, 1, 0666);

28 i‡(
£mid
 < 0) {

29 
	`≥º‹
("semget");

30 
˛ónup
;

32 
	`¥ötf
("execve'd chûdÖid i†%d\n", 
	`gëpid
());

33 
	`¥ötf
("execve'd child waiting for semaphore zero value\n");

34 
s›s
[0].
£m_num
 = 0;

35 
s›s
[0].
£m_›
 = 0;

36 
s›s
[0].
£m_Êg
 = 0;

37 
rv
 = 
	`£m›
(
£mid
, 
s›s
, 1);

38 i‡(
rv
 < 0) {

39 
	`≥º‹
("semop");

40 
˛ónup
;

42 
	`¥ötf
("execve'd child detected semaphore zero value\n");

43 
rc
 = 0;

44 
˛ónup
:

45  
rc
;

46 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_semaphore_file_parent.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<mÆloc.h
>

12 
	~<sys/ùc.h
>

13 
	~<sys/£m.h
>

14 
	~<sys/ty≥s.h
>

15 
	~<sys/waô.h
>

17 
	$maö
(
¨gc
, **
¨gv
)

19 
rc
 = 1;

20 
pid_t
 
˝id
 = 0;

21 
key_t
 
key
 = 0;

22 
£mid
 = 0;

23 
£mbuf
 
s›s
[2];

24 
rv
 = 0;

25 
exec
 = 0;

26 
key
 = 
	`·ok
("semfile", 'R');

27 i‡(
key
 < 0) {

28 
	`≥º‹
("ftok");

29 
˛ónup
;

31 
£mid
 = 
	`£mgë
(
key
, 1, 
IPC_CREAT
 | 0666);

32 i‡(
£mid
 < 0) {

33 
	`≥º‹
("semget");

34 
˛ónup
;

36 
s›s
[0].
£m_num
 = 0;

37 
s›s
[0].
£m_›
 = 1;

38 
s›s
[0].
£m_Êg
 = 0;

39 
rv
 = 
	`£m›
(
£mid
, 
s›s
, 1);

40 i‡(
rv
 < 0) {

41 
	`≥º‹
("semop");

42 
˛ónup
;

44 
˝id
 = 
	`f‹k
();

45 i‡(
˝id
 < 0) {

46 
	`≥º‹
("fork");

47 
˛ónup
;

48 } i‡(
˝id
 == 0) {

49 
	`¥ötf
("chûdÖid i†%d\n", 
	`gëpid
());

50 
exec
 =

51 
	`exe˛
("sysv_semaphore_file_child",

52 "sysv_£m≠h‹e_fûe_chûd", (*)
NULL
);

53 i‡(
exec
 < 0) {

54 
	`≥º‹
("execve");

55 
˛ónup
;

58 
	`¥ötf
("∑ª¡Öid i†%dánd chûdÖid i†%d\n", 
	`gëpid
(),

59 
˝id
);

60 
	`¶ìp
(1);

61 
	`¥ötf
("parent delay\n");

62 
	`¶ìp
(2);

63 
	`¥ötf
("parentáboutÅo decrement semaphore backÅo zero\n");

64 
s›s
[0].
£m_›
 = -1;

65 
rv
 = 
	`£m›
(
£mid
, 
s›s
, 1);

66 i‡(
rv
 < 0) {

67 
	`≥º‹
("semop");

68 
˛ónup
;

70 
	`waô
(0);

72 
rc
 = 0;

73 
˛ónup
:

74 i‡(
£mid
 > 0)

75 
	`£m˘l
(
£mid
, 1, 
IPC_RMID
);

76  
rc
;

77 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_shared_memory_file_child.c

10 
	~<°dio.h
>

11 
	~<uni°d.h
>

12 
	~<î∫o.h
>

13 
	~<°rög.h
>

14 
	~<mÆloc.h
>

15 
	~<sys/ùc.h
>

16 
	~<sys/shm.h
>

18 
	$maö
(
¨gc
, **
¨gv
)

20 
rc
 = 1;

21 
key_t
 
key
 = 0;

22 
shmid
 = 0;

23 *
buf„r
 = 
NULL
;

24 
size_t
 
buf„r_size
 = 4096;

25 
size
 = 0;

26 
key
 = 
	`·ok
("shmfile", 'R');

27 i‡(
key
 < 0) {

28 
	`≥º‹
("ftok");

29 
˛ónup
;

31 
shmid
 = 
	`shmgë
(
key
, 
buf„r_size
, 0666);

32 i‡(
shmid
 < 0) {

33 
	`≥º‹
("shmget");

34 
˛ónup
;

36 
buf„r
 = (*)
	`shm©
(
shmid
, 
NULL
, 0);

37 i‡(
buf„r
 < 0) {

38 
	`≥º‹
("shmat");

39 
˛ónup
;

41 
	`¥ötf
("execve'd chûdÖid i†%d\n", 
	`gëpid
());

42 
size
 = 
	`¢¥ötf
(
buf„r
, 
buf„r_size
, "hello fromÉxecve'd child");

43 i‡(
size
 <= 0) {

44 
	`≥º‹
("snprintf");

45 
˛ónup
;

47 
	`¥ötf
("execve'd chûd wrŸêtÿsh¨ed mem‹y buf„r: %s\n", 
buf„r
);

48 
rc
 = 0;

49 
˛ónup
:

50 i‡(
buf„r
 > 0)

51 
	`shmdt
(
buf„r
);

52  
rc
;

53 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_shared_memory_file_parent.c

10 
	~<°dio.h
>

11 
	~<uni°d.h
>

12 
	~<î∫o.h
>

13 
	~<°rög.h
>

14 
	~<mÆloc.h
>

15 
	~<sys/ùc.h
>

16 
	~<sys/shm.h
>

17 
	~<sys/ty≥s.h
>

18 
	~<sys/waô.h
>

20 
	$maö
(
¨gc
, **
¨gv
)

22 
rc
 = 1;

23 
pid_t
 
˝id
 = 0;

24 
key_t
 
key
 = 0;

25 
shmid
 = 0;

26 
shmid_ds
 
shmbuf
;

27 *
buf„r
 = 
NULL
;

28 
size_t
 
buf„r_size
 = 4096;

29 
exec
 = 0;

30 
key
 = 
	`·ok
("shmfile", 'R');

31 i‡(
key
 < 0) {

32 
	`≥º‹
("ftok");

33 
˛ónup
;

35 
shmid
 = 
	`shmgë
(
key
, 
buf„r_size
, 
IPC_CREAT
 | 0666);

36 i‡(
shmid
 < 0) {

37 
	`≥º‹
("shmget");

38 
˛ónup
;

40 
buf„r
 = (*)
	`shm©
(
shmid
, 
NULL
, 0);

41 i‡(
buf„r
 < 0) {

42 
	`≥º‹
("shmat");

43 
˛ónup
;

45 
˝id
 = 
	`f‹k
();

46 i‡(
˝id
 < 0) {

47 
	`≥º‹
("fork");

48 
˛ónup
;

49 } i‡(
˝id
 == 0) {

50 
	`¥ötf
("chûdÖid i†%d\n", 
	`gëpid
());

51 
exec
 =

52 
	`exe˛
("sysv_shared_memory_file_child",

53 "sysv_sh¨ed_mem‹y_fûe_chûd", (*)
NULL
);

54 i‡(
exec
 < 0) {

55 
	`≥º‹
("execve");

56 
˛ónup
;

59 
	`¥ötf
("∑ª¡Öid i†%dánd chûdÖid i†%d\n", 
	`gëpid
(),

60 
˝id
);

61 
	`waô
(0);

62 
	`¥ötf
("∑ª¡Ñód from sh¨ed mem‹y buf„r: %s\n", 
buf„r
);

64 
rc
 = 0;

65 
˛ónup
:

66 i‡(
buf„r
 > 0)

67 
	`shmdt
(
buf„r
);

68 i‡(
shmid
 > 0)

69 
	`shm˘l
(
shmid
, 
IPC_RMID
, &
shmbuf
);

70  
rc
;

71 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_shared_memory_private.c

11 
	~<°dio.h
>

12 
	~<uni°d.h
>

13 
	~<î∫o.h
>

14 
	~<°rög.h
>

15 
	~<mÆloc.h
>

16 
	~<sys/ùc.h
>

17 
	~<sys/shm.h
>

18 
	~<sys/ty≥s.h
>

19 
	~<sys/waô.h
>

21 
	$maö
(
¨gc
, **
¨gv
)

23 
rc
 = 1;

24 
pid_t
 
˝id
 = 0;

25 
shmid
 = 0;

26 
shmid_ds
 
shmbuf
;

27 *
buf„r
 = 
NULL
;

28 
size_t
 
buf„r_size
 = 4096;

29 
size
 = 0;

30 
shmid
 = 
	`shmgë
(
IPC_PRIVATE
, 
buf„r_size
, 
IPC_CREAT
 | 0666);

31 i‡(
shmid
 < 0) {

32 
	`≥º‹
("shmget");

33 
˛ónup
;

35 
buf„r
 = (*)
	`shm©
(
shmid
, 
NULL
, 0);

36 i‡(
buf„r
 < 0) {

37 
	`≥º‹
("shmat");

38 
˛ónup
;

40 
˝id
 = 
	`f‹k
();

41 i‡(
˝id
 < 0) {

42 
	`≥º‹
("fork");

43 
˛ónup
;

44 } i‡(
˝id
 == 0) {

45 
	`¥ötf
("chûdÖid i†%d\n", 
	`gëpid
());

46 
size
 = 
	`¢¥ötf
(
buf„r
, 
buf„r_size
, "hello from child");

47 i‡(
size
 <= 0) {

48 
	`≥º‹
("snprintf");

49 
˛ónup
;

51 
	`¥ötf
("chûd wrŸêtÿsh¨ed mem‹y buf„r: %s\n", 
buf„r
);

53 
	`¥ötf
("∑ª¡Öid i†%dánd chûdÖid i†%d\n", 
	`gëpid
(),

54 
˝id
);

55 
	`waô
(0);

56 
	`¥ötf
("∑ª¡Ñód from sh¨ed mem‹y buf„r: %s\n", 
buf„r
);

58 
rc
 = 0;

59 
˛ónup
:

60 i‡(
buf„r
 > 0)

61 
	`shmdt
(
buf„r
);

62 i‡(
shmid
 > 0)

63 
	`shm˘l
(
shmid
, 
IPC_RMID
, &
shmbuf
);

64  
rc
;

65 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/mq_posix/recv_mq.c

29 
	~<±hªad.h
>

30 
	~<mqueue.h
>

31 
	~<°dio.h
>

32 
	~<°dlib.h
>

33 
	~<uni°d.h
>

34 
	~<°rög.h
>

35 
	~<î∫o.h
>

37 
	#h™dÀ_îr‹
(
msg
) \

38 dÿ{ 
	`≥º‹
(
msg
); 
	`exô
(
EXIT_FAILURE
); } 0)

	)

39 
	#MQNAME
 "/myposixmq"

	)

41 
	$maö
(
¨gc
, **
¨gv
)

43 
mqd_t
 
mymq
;

44 
mq_©å
 
©å
;

46 
mymq
 = 
	`mq_›í
(
MQNAME
, 
O_RDWR
 | 
O_CREAT
 | 
O_EXCL
, 0644, 
NULL
);

47 i‡(
mymq
 == -1) {

48 i‡(
EEXIST
 =
î∫o
) {

49 
mymq
 = 
	`mq_›í
(
MQNAME
, 
O_RDWR
);

50 i‡(
mymq
 == -1)

51 
	`h™dÀ_îr‹
("mq_open failed");

56 i‡(
	`mq_gë©å
(
mymq
, &
©å
) == -1)

57 
	`h™dÀ_îr‹
("mq_getattr failed");

58 *
buf
 = 
	`ˇŒoc
(
©å
.
mq_msgsize
, 1);

59 i‡(!
buf
) {

60 
	`mq_˛o£
(
mymq
);

61 
	`h™dÀ_îr‹
("calloc failed");

65 
ssize_t
 
ƒ
 = 0;

66 
¥io
 = 0;

68 i‡((
ƒ
 = 
	`mq_ª˚ive
(
mymq
, 
buf
, 
©å
.
mq_msgsize
, &
¥io
)) == -1) {

69 
	`mq_˛o£
(
mymq
);

70 
	`h™dÀ_îr‹
("mq_receive failed");

72 
	`¥ötf
("%s: Re˚ived:\¿\"%s\" [%ld byãs,Öriÿ%u]\n", 
¨gv
[0],

73 
buf
, 
ƒ
, 
¥io
);

76 
	`‰ì
(
buf
);

77 
	`mq_˛o£
(
mymq
);

78 
	`exô
(0);

79 
	}
}

	@Training/L1_sysprg_trg/ipc/posix_ipc/mq_posix/sender_mq.c

40 
	~<±hªad.h
>

41 
	~<mqueue.h
>

42 
	~<°dio.h
>

43 
	~<°dlib.h
>

44 
	~<uni°d.h
>

45 
	~<°rög.h
>

46 
	~<î∫o.h
>

48 
	#h™dÀ_îr‹
(
msg
) \

49 dÿ{ 
	`≥º‹
(
msg
); 
	`exô
(
EXIT_FAILURE
); } 0)

	)

50 
	#MQNAME
 "/myposixmq"

	)

52 
	$maö
(
¨gc
, **
¨gv
)

54 
mqd_t
 
mymq
;

56 i‡(
¨gc
 != 3) {

57 
	`Ârötf
(
°dîr
, "Usage: %s \"msgÅo send\"Öriority\n",

58 
¨gv
[0]);

59 
	`exô
(1);

62 
Àn
 = 
	`°æí
(
¨gv
[1]);

63 i‡(
Àn
 <= 0) {

64 
	`Ârötf
(
°dîr
, "%s: invÆid mesßge? Ab‹tög...\n", 
¨gv
[0]);

65 
	`exô
(1);

68 
¥io
 = 
	`©oi
(
¨gv
[2]);

69 i‡((
¥io
 < 0Ë|| (¥iÿ> 
	`sysc⁄f
(
_SC_MQ_PRIO_MAX
))) {

70 
	`Ârötf
(
°dîr
, "%s: invalidÖriority value,áborting...\n",

71 
¨gv
[0]);

72 
	`exô
(1);

74 
	`¥ötf
("¥io: %d, maxÖrio: %ld\n", 
¥io
, 
	`sysc⁄f
(
_SC_MQ_PRIO_MAX
));

76 
mymq
 = 
	`mq_›í
(
MQNAME
, 
O_RDWR
 | 
O_CREAT
 | 
O_EXCL
, 0644, 
NULL
);

77 i‡(
mymq
 == -1) {

78 i‡(
EEXIST
 =
î∫o
) {

79 
mymq
 = 
	`mq_›í
(
MQNAME
, 
O_RDWR
);

80 i‡(
mymq
 == -1)

81 
	`h™dÀ_îr‹
("mq_open failed");

85 i‡(
	`mq_£nd
(
mymq
, 
¨gv
[1], 
Àn
, 
¥io
) == -1) {

86 
	`mq_˛o£
(
mymq
);

87 
	`h™dÀ_îr‹
("mq_send failed");

90 
	`mq_˛o£
(
mymq
);

91 
	`exô
(0);

92 
	}
}

	@Training/L1_sysprg_trg/makefile_templ/hdr_var/audio/s4.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

4 
	~"../hdr.h
"

6 
	$s4_audio
()

8 
	`¥ötf
("audio: hey i¿%s:%s(Ënow...\n", 
__FILE__
, 
__func__
);

10 
	}
}

	@Training/L1_sysprg_trg/makefile_templ/hdr_var/engine/s3.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

4 
	~"../hdr.h
"

6 
	$s3_ígöe
()

8 
	`¥ötf
("ígöe: i¿%s:%s(Ënow...\n", 
__FILE__
, 
__func__
);

9 
g
 ++;

10 
	`SHOW_VAR
(
g
);

11 
	`s4_audio
();

14 
	}
}

	@Training/L1_sysprg_trg/makefile_templ/hdr_var/hdr.h

2 #i‚de‡
__MYHDR__


3 
	#__MYHDR__


	)

5 
s2_a
();

6 
s3_ígöe
();

7 
s4_audio
();

10 
g
;

12 
	#SHOW_VAR
(
v
) do { \

13 
	`¥ötf
("&v¨=%∞v¨=%d\n", &
v
, v); \

14 } 0)

	)

	@Training/L1_sysprg_trg/makefile_templ/hdr_var/main.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

4 
	~"hdr.h
"

9 
	gg
 = 5;

11 
	$maö
(
¨gc
, **
¨gv
)

13 
	`¥ötf
("HeyÅhîe! i¿%s:%s(Ënow...\n", 
__FILE__
, 
__func__
);

14 
	`SHOW_VAR
(
g
);

15 
	`s2_a
();

17 
	`exô
(
EXIT_SUCCESS
);

18 
	}
}

	@Training/L1_sysprg_trg/makefile_templ/hdr_var/s2.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

4 
	~"hdr.h
"

6 
s3_ígöe
();

8 
	$s2_a
()

10 
	`¥ötf
("s2: i¿%s:%s(Ënow...\n", 
__FILE__
, 
__func__
);

11 
	`s3_ígöe
();

14 
	}
}

	@Training/L1_sysprg_trg/makefile_templ/simple1/audio/s4.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

5 
	$s4_audio
()

7 
	`¥ötf
("audio: hey i¿%s:%s(Ënow...\n", 
__FILE__
, 
__func__
);

9 
	}
}

	@Training/L1_sysprg_trg/makefile_templ/simple1/engine/s3.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

5 
s4_audio
();

7 
	$s3_ígöe
()

9 
	`¥ötf
("ígöe: i¿%s:%s(Ënow...\n", 
__FILE__
, 
__func__
);

10 
	`s4_audio
();

13 
	}
}

	@Training/L1_sysprg_trg/makefile_templ/simple1/main.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

6 
s2_a
();

9 
	$maö
(
¨gc
, **
¨gv
)

11 
	`¥ötf
("HeyÅhîe! i¿%s:%s(Ënow...\n", 
__FILE__
, 
__func__
);

12 
	`s2_a
();

14 
	`exô
(
EXIT_SUCCESS
);

15 
	}
}

	@Training/L1_sysprg_trg/makefile_templ/simple1/s2.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<uni°d.h
>

5 
s3_ígöe
();

7 
	$s2_a
()

9 
	`¥ötf
("s2: i¿%s:%s(Ënow...\n", 
__FILE__
, 
__func__
);

10 
	`s3_ígöe
();

13 
	}
}

	@Training/L1_sysprg_trg/memory/vaddr_process.c

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

9 #unde‡
BITS_32


11 #ifde‡
BITS_32


12 
	#FMTSPC
 "%08x"

	)

13 
	#TYPECST
 

	)

15 
	#FMTSPC
 "%016lx"

	)

16 
	#TYPECST
 

	)

18 
	tu32
;

20 *
ívú⁄
;

21 
	ggi
 = 5, 
	ggu
;

23 
	$maö
(
¨gc
, **
¨gv
)

25 
loˇl
 = 0xff, *
hópmem
;

26 
i
 = 1, 
j
 = 2, 
k
 = 3;

28 
hópmem
 = 
	`mÆloc
(1024);

29 
	`¥ötf
("PID %d: virtualáddresses:"

30 "\n&maö = 0x" 
FMTSPC


31 "\n&gò = 0x" 
FMTSPC


32 "\n&gu = 0x" 
FMTSPC


33 "\n&hópmem = 0x" 
FMTSPC


34 "\n&loˇ» = 0x" 
FMTSPC


35 "\n&ívú⁄ = 0x" 
FMTSPC
 "\n",

36 
	`gëpid
(), (
TYPECST
Ë& 
maö
, (TYPECSTË& 
gi
, (TYPECSTË& 
gu
,

37 (
TYPECST
Ë
hópmem
, (TYPECSTË& 
loˇl
, (TYPECSTË
ívú⁄
);

38 
	`¥ötf
("\n... InÖauseÇow... ^CÅoÉnd (canÑun vasu_grapher !)\n");

39 
	`∑u£
();

40 
	`‰ì
(
hópmem
);

41 
	`exô
(0);

42 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/client_any/client_any.c

7 
	~<°dio.h
>

8 
	~<°dlib.h
>

9 
	~<uni°d.h
>

10 
	~<î∫o.h
>

11 
	~<°rög.h
>

12 
	~<√tdb.h
>

13 
	~<sys/ty≥s.h
>

14 
	~<√töë/ö.h
>

15 
	~<sys/sockë.h
>

16 
	~<¨∑/öë.h
>

18 
	#MAXDATASIZE
 1024

19 

	)

21 *
	$gë_ö_addr
(
sockaddr
 *
ß
)

23 i‡(
ß
->
ß_Ámûy
 =
AF_INET
) {

24  &(((
sockaddr_ö
 *)
ß
)->
sö_addr
);

27  &(((
sockaddr_ö6
 *)
ß
)->
sö6_addr
);

28 
	}
}

30 
	$maö
(
¨gc
, *
¨gv
[])

32 
sockfd
, 
numbyãs
, 
i
 = 0;

33 
buf
[
MAXDATASIZE
];

34 
addröfo
 
höts
, *
£rvöfo
, *
p
;

35 
rv
;

36 
s
[
INET6_ADDRSTRLEN
];

38 i‡(
¨gc
 != 3) {

39 
	`Ârötf
(
°dîr
, "ußge: %†ho°«mêp‹t#\n", 
¨gv
[0]);

40 
	`exô
(1);

43 
	`mem£t
(&
höts
, 0,  hints);

44 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

47 
höts
.
ai_Êags
 = 
AI_ALL
;

70 
	`¥ötf
("%s: issuögÅhêgëaddröfÿlib APIÇow...\n", 
¨gv
[0]);

71 i‡((
rv
 = 
	`gëaddröfo
(
¨gv
[1],árgv[2], &
höts
, &
£rvöfo
)) != 0) {

72 
	`Ârötf
(
°dîr
, "gëaddröfo: %s\n", 
	`gai_°ªº‹
(
rv
));

87 
p
 = 
£rvöfo
;Ö !
NULL
;Ö =Ö->
ai_√xt
) {

88 i‡((
sockfd
 = 
	`sockë
(
p
->
ai_Ámûy
,Ö->
ai_sockty≥
,

89 
p
->
ai_¥Ÿocﬁ
)) == -1) {

90 
	`≥º‹
("client_any: socket");

93 
	`¥ötf
(" %s:Üoop iteration #%d: got socket fd [%d]..\n",

94 
¨gv
[0], ++
i
, 
sockfd
);

96 
	`¥ötf
(" %s:ÇowáttemptingÅo connectÅo %s:%d...\n",

97 
¨gv
[0],árgv[1], 
	`©oi
(argv[2]));

98 i‡(
	`c⁄√˘
(
sockfd
, 
p
->
ai_addr
,Ö->
ai_addæí
) == -1) {

99 
	`˛o£
(
sockfd
);

100 
	`≥º‹
("client_any: connect failed");

106 i‡(
p
 =
NULL
) {

107 
	`Ârötf
(
°dîr
, "client_any: failedÅo connect\n");

113 
	`öë_¡›
(
p
->
ai_Ámûy
, 
	`gë_ö_addr
((
sockaddr
 *Ì->
ai_addr
), 
s
,

114  
s
);

115 
	`¥ötf
("%s: c⁄√˘edÅÿ%s:%d,Öîf‹mög 'ªcv'Çow...\n", 
¨gv
[0], 
s
,

116 
	`©oi
(
¨gv
[2]));

118 
	`‰ìaddröfo
(
£rvöfo
);

125 i‡((
numbyãs
 = 
	`ªcv
(
sockfd
, 
buf
, 
MAXDATASIZE
 - 1, 0)) == -1) {

126 
	`≥º‹
("recv");

127 
	`exô
(1);

129 i‡(0 =
numbyãs
) {

130 
	`¥ötf
("%s:Öeer closedÅhe connection! (recvÑet 0)\n",

131 
¨gv
[0]);

132 
	`˛o£
(
sockfd
);

135 
buf
[
numbyãs
] = '\0';

136 
	`¥ötf
("%s:Ñe˚ived %d byãs, c⁄ã¡:\n'%.*s'\n", 
¨gv
[0], 
numbyãs
,

137 
numbyãs
, 
buf
);

138 
	`˛o£
(
sockfd
);

140 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/select_svr_chat/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_PRINT


47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=1; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 
	`¥ötk
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

59 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

126 
	~<löux/sched.h
>

127 
	~<löux/öãºu±.h
>

129 #i‚de‡
USE_FTRACE_PRINT


130 
	#PRINT_CTX
() do { \

131 
£p
='|', 
öå
='.'; \

133 i‡(
	`ö_öãºu±
()) { \

134 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

135 
öå
='H'; \

136 i‡(
	`ö_úq
()) \

137 
öå
='h'; \

138 i‡(
	`ö_so·úq
()) \

139 
öå
='s'; \

142 
öå
='.'; \

144 
	`DBGPRINT
( \

148 , 
	`smp_¥o˚ss‹_id
(), \

149 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

150 (
	`úqs_dißbÀd
()?'d':'.'), \

151 (
	`√ed_ªsched
()?'N':'.'), \

152 
öå
, \

153 (
	`¥ìm±_cou¡
() && 0xff) \

155 } 0)

	)

157 
	#PRINT_CTX
() do { \

158 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

163 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

165 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

166 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

168 } 0)

	)

184 #ifde‡
__KERNEL__


185 
	#as£π
(
ex¥
) do { \

186 i‡(!(
ex¥
)) { \

187 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

188 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

190 } 0)

	)

194 
ölöe
 
	$bìp
(
wh©
)

196 #ifde‡
__KERNEL__


197 
	`DBGPRINT
("%c", ()
wh©
);

199 ()
	`¥ötf
("%c", ()
wh©
);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

210 
c
=0, 
m
;\

211 
f‹_ödex
,
ö√r_ödex
; \

213 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++;\

216 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

217 
m
=0;m<50;m++); \

220 }

	)

223 #ifde‡
__KERNEL__


228 
	#DELAY_SEC
(
vÆ
) \

230 i‡(!
	`ö_öãºu±
()) { \

231 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

232 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

234 }

	)

244 
	~<sys/time.h
>

245 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

246 
timevÆ
 *
y
)

249 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

250 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

251 
y
->
tv_u£c
 -1000000 * 
n£c
;

252 
y
->
tv_£c
 +
n£c
;

254 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

255 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

256 
y
->
tv_u£c
 +1000000 * 
n£c
;

257 
y
->
tv_£c
 -
n£c
;

262 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

263 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

266  
x
->
tv_£c
 < 
y
->tv_sec;

267 
	}
}

278 
__©åibuã__
((
unu£d
))

279 
	$dec2bö
(
decimÆ
, *
bö¨y
)

281 
k
 = 0, 
n
 = 0;

282 
√g_Êag
 = 0;

283 
ªmaö
;

293 #unde‡
TESTMODE


295 #ifde‡
TESTMODE


296 
ﬁd_decimÆ
;

298 
ãmp
[80];

301 i‡(
decimÆ
 < 0) {

302 
decimÆ
 = -decimal;

303 
√g_Êag
 = 1;

306 #ifde‡
TESTMODE


307 
ﬁd_decimÆ
 = 
decimÆ
;

309 
ªmaö
 = 
decimÆ
 % 2;

311 
decimÆ
 = decimal / 2;

313 #ifde‡
TESTMODE


314 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

315 
ªmaö
);

318 
ãmp
[
k
++] = 
ªmaö
 + '0';

319 } 
decimÆ
 > 0);

321 i‡(
√g_Êag
)

322 
ãmp
[
k
++] = '-';

324 
ãmp
[
k
++] = ' ';

327 
k
 >= 0)

328 
bö¨y
[
n
++] = 
ãmp
[--
k
];

330 
bö¨y
[
n
 - 1] = 0;

331 
	}
}

333 #i‚de‡
__KERNEL__


335 
	#MSG
(
°rög
, 
¨gs
...) do { \

336 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

337 } 0)

	)

339 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

340 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

341 } 0)

	)

343 
	#QP
 
	`MSG
("\n")

	)

346 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

348 i‡(
vîbo£
) \

349 
	`¥ötf
(
°r
, ##
¨gs
); \

350 } 0)

	)

352 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

354 
îr_°r
[512];

356 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

357 
	`≥º‹
(
îr_°r
);

358 
	`exô
(
exôcode
);

359 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/select_svr_chat/selectserver.c

7 
	~<°dio.h
>

8 
	~<°dlib.h
>

9 
	~<°rög.h
>

10 
	~<uni°d.h
>

11 
	~<sys/ty≥s.h
>

12 
	~<sys/sockë.h
>

13 
	~<√töë/ö.h
>

14 
	~<¨∑/öë.h
>

15 
	~<√tdb.h
>

16 
	~"c⁄víõ¡.h
"

19 
	$hexdump
(*
§cbuf
, 
Àn
)

21 
i
;

23 
i
=0; i<
Àn
; i++) {

24 
	`¥ötf
("%02x ", 
§cbuf
[
i
]);

26 
	`¥ötf
("\n");

27 
	}
}

30 
	#PORT
 "9034"

31 

	)

32 
	gVERBOSE
=1;

35 *
	$gë_ö_addr
(
sockaddr
 *
ß
)

37 i‡(
ß
->
ß_Ámûy
 =
AF_INET
) {

38  &(((
sockaddr_ö
*)
ß
)->
sö_addr
);

40  &(((
sockaddr_ö6
*)
ß
)->
sö6_addr
);

41 
	}
}

43 
	$maö
()

45 
fd_£t
 
ma°î
;

46 
fd_£t
 
ªad_fds
;

47 
fdmax
;

49 
li°íî
;

50 
√wfd
;

51 
sockaddr_°‹age
 
ªmŸóddr
;

52 
sockÀn_t
 
addæí
;

54 
buf
[256];

55 
nbyãs
;

57 
ªmŸeIP
[
INET6_ADDRSTRLEN
];

59 
yes
=1;

60 
i
, 
j
, 
rv
;

62 
addröfo
 
höts
, *
ai
, *
p
;

64 
	`FD_ZERO
(&
ma°î
);

65 
	`FD_ZERO
(&
ªad_fds
);

68 
	`mem£t
(&
höts
, 0,  hints);

69 
höts
.
ai_Ámûy
 = 
AF_INET
;

70 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

71 
höts
.
ai_Êags
 = 
AI_PASSIVE
;

74 
	`VP
(
VERBOSE
, "Issuing getaddrinfo() syscallÇow...\n");

75 i‡((
rv
 = 
	`gëaddröfo
(
NULL
, 
PORT
, &
höts
, &
ai
)) != 0) {

76 
	`Ârötf
(
°dîr
, "£À˘£rvî: %s\n", 
	`gai_°ªº‹
(
rv
));

77 
	`exô
(1);

80 
p
 = 
ai
;Ö !
NULL
;Ö =Ö->
ai_√xt
) {

81 
	`VP
(
VERBOSE
, "Issuing socket() syscallÇow...\n");

82 
li°íî
 = 
	`sockë
(
p
->
ai_Ámûy
,Ö->
ai_sockty≥
,Ö->
ai_¥Ÿocﬁ
);

83 i‡(
li°íî
 < 0) {

88 
	`£tsock›t
(
li°íî
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
yes
, ());

90 
	`VP
(
VERBOSE
, "Issuing bind() syscallÇow: ipáddr %xÖort %s...\n",

91 ()
	`gë_ö_addr
((
sockaddr
*)&
ªmŸóddr
), 
PORT
);

93 i‡(
	`böd
(
li°íî
, 
p
->
ai_addr
,Ö->
ai_addæí
) < 0) {

94 
	`˛o£
(
li°íî
);

101 i‡(
p
 =
NULL
) {

102 
	`Ârötf
(
°dîr
, "selectserver: failedÅo bind\n");

103 
	`exô
(2);

105 
	`‰ìaddröfo
(
ai
);

108 i‡(
	`li°í
(
li°íî
, 10) == -1) {

109 
	`≥º‹
("listen");

110 
	`exô
(3);

114 
	`FD_SET
(
li°íî
, &
ma°î
);

117 
fdmax
 = 
li°íî
;

125 
	`VP
(
VERBOSE
, "Issuing select() syscallÇow...\n");

130 
ªad_fds
 = 
ma°î
;

131 i‡(
	`£À˘
(
fdmax
+1, &
ªad_fds
, 
NULL
, NULL, NULL) == -1) {

132 
	`≥º‹
("select");

133 
	`exô
(4);

136 
	`VP
(
VERBOSE
, "select() unblocked...\n");

141 
i
 = 0; i <
fdmax
; i++) {

142 i‡(
	`FD_ISSET
(
i
, &
ªad_fds
)) {

143 
	`VP
(
VERBOSE
, "GŸá c⁄√˘i⁄ (⁄Ñód fd %d), issuêac˚±(Ë...\n", 
i
);

147 i‡(
i
 =
li°íî
) {

149 
addæí
 =  
ªmŸóddr
;

150 
√wfd
 = 
	`ac˚±
(
li°íî
,

151 (
sockaddr
 *)&
ªmŸóddr
,

152 &
addæí
);

154 i‡(
√wfd
 == -1) {

155 
	`≥º‹
("accept");

157 
	`FD_SET
(
√wfd
, &
ma°î
);

158 i‡(
√wfd
 > 
fdmax
) {

159 
fdmax
 = 
√wfd
;

161 
	`¥ötf
("selectserver: +++Çew connection from %s on "

163 
	`öë_¡›
(
ªmŸóddr
.
ss_Ámûy
,

164 
	`gë_ö_addr
((
sockaddr
*)&
ªmŸóddr
),

165 
ªmŸeIP
, 
INET6_ADDRSTRLEN
), 
√wfd
);

169 
	`VP
(
VERBOSE
, "Issuêªcv(Ë(⁄Ñód fd %d)...\n", 
i
);

170 i‡((
nbyãs
 = 
	`ªcv
(
i
, 
buf
,  buf, 0)) <= 0) {

172 i‡(
nbyãs
 == 0) {

174 
	`¥ötf
("£À˘£rvî: sockë %d hung up\n", 
i
);

176 
	`≥º‹
("recv");

178 
	`˛o£
(
i
);

179 
	`FD_CLR
(
i
, &
ma°î
);

182 
	`VP
(
VERBOSE
, "Got data, broadcast itÅoáll ...\n");

183 
	`¥ötf
("D©®(%d byãs):I¿ch¨::\n", 
nbyãs
);

184 
k
=0; k<
nbyãs
; k++)

185 
	`¥ötf
("%¯", 
buf
[
k
]);

186 
	`¥ötf
("\nIn hex::\n");

188 
	`hexdump
(
buf
, 
nbyãs
);

190 
j
 = 0; j <
fdmax
; j++) {

192 i‡(
	`FD_ISSET
(
j
, &
ma°î
)) {

194 i‡(
j
 !
li°íî
 && j !
i
) {

195 i‡(
	`£nd
(
j
, 
buf
, 
nbyãs
, 0) == -1) {

196 
	`≥º‹
("send");

208 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/showip_getaddrinfo/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_PRINT


47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=1; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 
	`¥ötk
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

59 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

126 
	~<löux/sched.h
>

127 
	~<löux/öãºu±.h
>

129 #i‚de‡
USE_FTRACE_PRINT


130 
	#PRINT_CTX
() do { \

131 
£p
='|', 
öå
='.'; \

133 i‡(
	`ö_öãºu±
()) { \

134 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

135 
öå
='H'; \

136 i‡(
	`ö_úq
()) \

137 
öå
='h'; \

138 i‡(
	`ö_so·úq
()) \

139 
öå
='s'; \

142 
öå
='.'; \

144 
	`DBGPRINT
( \

148 , 
	`smp_¥o˚ss‹_id
(), \

149 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

150 (
	`úqs_dißbÀd
()?'d':'.'), \

151 (
	`√ed_ªsched
()?'N':'.'), \

152 
öå
, \

153 (
	`¥ìm±_cou¡
() && 0xff) \

155 } 0)

	)

157 
	#PRINT_CTX
() do { \

158 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

163 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

165 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

166 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

168 } 0)

	)

184 #ifde‡
__KERNEL__


185 
	#as£π
(
ex¥
) do { \

186 i‡(!(
ex¥
)) { \

187 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

188 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

190 } 0)

	)

194 
ölöe
 
	$bìp
(
wh©
)

196 #ifde‡
__KERNEL__


197 
	`DBGPRINT
("%c", ()
wh©
);

199 ()
	`¥ötf
("%c", ()
wh©
);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

210 
c
=0, 
m
;\

211 
f‹_ödex
,
ö√r_ödex
; \

213 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++;\

216 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

217 
m
=0;m<50;m++); \

220 }

	)

223 #ifde‡
__KERNEL__


228 
	#DELAY_SEC
(
vÆ
) \

230 i‡(!
	`ö_öãºu±
()) { \

231 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

232 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

234 }

	)

244 
	~<sys/time.h
>

245 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

246 
timevÆ
 *
y
)

249 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

250 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

251 
y
->
tv_u£c
 -1000000 * 
n£c
;

252 
y
->
tv_£c
 +
n£c
;

254 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

255 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

256 
y
->
tv_u£c
 +1000000 * 
n£c
;

257 
y
->
tv_£c
 -
n£c
;

262 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

263 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

266  
x
->
tv_£c
 < 
y
->tv_sec;

267 
	}
}

278 
__©åibuã__
((
unu£d
))

279 
	$dec2bö
(
decimÆ
, *
bö¨y
)

281 
k
 = 0, 
n
 = 0;

282 
√g_Êag
 = 0;

283 
ªmaö
;

293 #unde‡
TESTMODE


295 #ifde‡
TESTMODE


296 
ﬁd_decimÆ
;

298 
ãmp
[80];

301 i‡(
decimÆ
 < 0) {

302 
decimÆ
 = -decimal;

303 
√g_Êag
 = 1;

306 #ifde‡
TESTMODE


307 
ﬁd_decimÆ
 = 
decimÆ
;

309 
ªmaö
 = 
decimÆ
 % 2;

311 
decimÆ
 = decimal / 2;

313 #ifde‡
TESTMODE


314 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

315 
ªmaö
);

318 
ãmp
[
k
++] = 
ªmaö
 + '0';

319 } 
decimÆ
 > 0);

321 i‡(
√g_Êag
)

322 
ãmp
[
k
++] = '-';

324 
ãmp
[
k
++] = ' ';

327 
k
 >= 0)

328 
bö¨y
[
n
++] = 
ãmp
[--
k
];

330 
bö¨y
[
n
 - 1] = 0;

331 
	}
}

333 #i‚de‡
__KERNEL__


335 
	#MSG
(
°rög
, 
¨gs
...) do { \

336 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

337 } 0)

	)

339 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

340 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

341 } 0)

	)

343 
	#QP
 
	`MSG
("\n")

	)

346 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

348 i‡(
vîbo£
) \

349 
	`¥ötf
(
°r
, ##
¨gs
); \

350 } 0)

	)

352 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

354 
îr_°r
[512];

356 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

357 
	`≥º‹
(
îr_°r
);

358 
	`exô
(
exôcode
);

359 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/showip_getaddrinfo/showip.c

4 
	~<°dio.h
>

5 
	~<°rög.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/sockë.h
>

8 
	~<√tdb.h
>

9 
	~<¨∑/öë.h
>

11 
	$maö
(
¨gc
, *
¨gv
[])

13 
addröfo
 
höts
, *
ªs
, *
p
;

14 
°©us
;

15 
ù°r
[
INET6_ADDRSTRLEN
];

17 i‡(
¨gc
 != 3) {

18 
	`Ârötf
(
°dîr
, "usage: showip hostname service\n");

44 
	`mem£t
(&
höts
, 0, (hints));

45 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

46 
höts
.
ai_sockty≥
 = 0;

47 
höts
.
ai_Êags
 = 
AI_CANONNAME
;

48 
°©us
 = 
	`gëaddröfo
(
¨gv
[1],árgv[2], &
höts
, &
ªs
);

49 i‡(
°©us
 != 0) {

50 
	`Ârötf
(
°dîr
, "gëaddröfo: %s\n", 
	`gai_°ªº‹
(
°©us
));

62 
	`¥ötf
("IPáddªs£†f‹ %s:\n\n", 
¨gv
[1]);

64 
p
 = 
ªs
;Ö !
NULL
;Ö =Ö->
ai_√xt
) {

65 *
addr
;

66 
ö_p‹t_t
 
p‹t
;

67 *
ùvî
;

68 *
¥Ÿo
;

72 i‡(
p
->
ai_Ámûy
 =
AF_INET
) {

73 
sockaddr_ö
 *
ùv4
 =

74 (
sockaddr_ö
 *)
p
->
ai_addr
;

75 
addr
 = &(
ùv4
->
sö_addr
);

76 
p‹t
 = 
	`¡ohs
(
ùv4
->
sö_p‹t
);

77 
ùvî
 = "IPv4";

79 
sockaddr_ö6
 *
ùv6
 =

80 (
sockaddr_ö6
 *)
p
->
ai_addr
;

81 
addr
 = &(
ùv6
->
sö6_addr
);

82 
p‹t
 = 
	`¡ohs
(
ùv6
->
sö6_p‹t
);

83 
ùvî
 = "IPv6";

87 
	`öë_¡›
(
p
->
ai_Ámûy
, 
addr
, 
ù°r
, (ipstr));

88 i‡(
p
->
ai_¥Ÿocﬁ
 == 6)

89 
¥Ÿo
 = "tcp";

90 i‡(
p
->
ai_¥Ÿocﬁ
 == 17)

91 
¥Ÿo
 = "udp";

93 
	`¥ötf
(" %s: %†%s", 
ùvî
, 
ù°r
, 
¥Ÿo
);

94 i‡(
p‹t
)

95 
	`¥ötf
("Ö‹à%d\n", 
p‹t
);

97 
	`¥ötf
("\n");

98 i‡(
p
->
ai_ˇn⁄«me
)

99 
	`¥ötf
(" c™⁄«me: %s\n", 
p
->
ai_ˇn⁄«me
);

102 
	`‰ìaddröfo
(
ªs
);

104 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/showip_getaddrinfo/showip_port.c

4 
	~<°dio.h
>

5 
	~<°rög.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/sockë.h
>

8 
	~<√tdb.h
>

9 
	~<¨∑/öë.h
>

11 
	$maö
(
¨gc
, *
¨gv
[])

13 
addröfo
 
höts
, *
ªs
, *
p
;

14 
°©us
;

15 
ù°r
[
INET6_ADDRSTRLEN
];

17 i‡(
¨gc
 != 3) {

18 
	`Ârötf
(
°dîr
, "usage: showip hostnameÖort#\n");

42 
	`mem£t
(&
höts
, 0, (hints));

43 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

44 
höts
.
ai_sockty≥
 = 0;

45 
höts
.
ai_Êags
 = 
AI_CANONNAME
;

47 i‡((
°©us
 = 
	`gëaddröfo
(
¨gv
[1],árgv[2], &
höts
, &
ªs
)) != 0) {

48 
	`Ârötf
(
°dîr
, "gëaddröfo: %s\n", 
	`gai_°ªº‹
(
°©us
));

60 
	`¥ötf
("IPáddªs£†f‹ %s:\n\n", 
¨gv
[1]);

62 
p
 = 
ªs
;Ö !
NULL
;Ö =Ö->
ai_√xt
) {

63 *
addr
;

64 
ö_p‹t_t
 
p‹t
;

65 *
ùvî
;

66 *
¥Ÿo
;

70 i‡(
p
->
ai_Ámûy
 =
AF_INET
) {

71 
sockaddr_ö
 *
ùv4
 =

72 (
sockaddr_ö
 *)
p
->
ai_addr
;

73 
addr
 = &(
ùv4
->
sö_addr
);

74 
p‹t
 = 
	`¡ohs
(
ùv4
->
sö_p‹t
);

75 
ùvî
 = "IPv4";

77 
sockaddr_ö6
 *
ùv6
 =

78 (
sockaddr_ö6
 *)
p
->
ai_addr
;

79 
addr
 = &(
ùv6
->
sö6_addr
);

80 
p‹t
 = 
	`¡ohs
(
ùv6
->
sö6_p‹t
);

81 
ùvî
 = "IPv6";

85 
	`öë_¡›
(
p
->
ai_Ámûy
, 
addr
, 
ù°r
, (ipstr));

86 i‡(
p
->
ai_¥Ÿocﬁ
 == 6)

87 
¥Ÿo
 = "tcp";

88 i‡(
p
->
ai_¥Ÿocﬁ
 == 17)

89 
¥Ÿo
 = "udp";

91 
	`¥ötf
(" %s: %†%s", 
ùvî
, 
ù°r
, 
¥Ÿo
);

92 i‡(
p‹t
)

93 
	`¥ötf
("Ö‹à%d\n", 
p‹t
);

95 
	`¥ötf
("\n");

96 i‡(
p
->
ai_ˇn⁄«me
)

97 
	`¥ötf
(" c™⁄«me: %s\n", 
p
->
ai_ˇn⁄«me
);

100 
	`‰ìaddröfo
(
ªs
);

102 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/cpudtl_tstsvr/cpudtl_tstsvr.c

71 
	~<°dio.h
>

72 
	~<°rög.h
>

73 
	~<°dlib.h
>

74 
	~<uni°d.h
>

75 
	~<sys/ty≥s.h
>

76 
	~<sys/sockë.h
>

77 
	~<√töë/ö.h
>

78 
	~<¨∑/öë.h
>

79 
	~<sig«l.h
>

80 
	~<sys/waô.h
>

81 
	~<î∫o.h
>

82 
	~<pwd.h
>

85 
	~"c⁄víõ¡.h
"

93 
	#MAXBUF
 5120

	)

94 
	#RE_MAXLEN
 100+256+48+8+8+1024+4096+128

	)

96 
	#QLENGTH
 5

	)

97 
	#DBG_MUST_SLEEP
 0

	)

98 
	#DEBUG_SLEEP
 20

	)

100 
	gvîbo£
 = 0;

103 
	$sig_chûd
(
signum
)

106 
°©us
;

107 
pid
;

109 
QP
;

112 (
pid
 = 
	`waô3
(&
°©us
, 
WNOHANG
, 0)) > 0) {

113 i‡(
vîbo£
)

114 
	`¥ötf
("parent server in SIGCHLD handler;Öid=%d\n",

115 
pid
);

118 
	}
}

120 
	$EºExô
(*
¥g
, *
îr
, 
exôcode
)

122 *
îr_°r
;

124 
îr_°r
 = (*)
	`mÆloc
(300);

125 i‡(!
îr_°r
) {

126 
	`¥ötf
("\n%s: mÆlo¯Áûed f‹Éº_°r..\n", 
¥g
);

127 
	`¥ötf
("%†exôög wôhÉº‹ codê%d,Öîr‹ shows:\n", 
¥g
,

128 
exôcode
);

129 
	`≥º‹
(
¥g
);

130 
	`¥ötf
("OrigöÆÉº‹ mesßge: %s\n", 
îr
);

131 
	`exô
(
exôcode
);

134 
	`¢¥ötf
(
îr_°r
, 300, "%s: %s", 
¥g
, 
îr
);

135 
	`≥º‹
(
îr_°r
);

136 
	`‰ì
(
îr_°r
);

138 
	`exô
(
exôcode
);

139 
	}
}

142 
	$¥o˚ss_˛õ¡
(
sd
, *
¥g
)

144 
	#LINESZ
 128

	)

145 
tmpbuf
[
LINESZ
], *
ª∂y
;

146 
tŸÆ
 = 0;

147 
FILE
 *
Â
;

149 
ª∂y
 = (*)
	`mÆloc
(
MAXBUF
);

150 i‡(!
ª∂y
) {

151 
	`¥ötf
("%s:Çÿmem‹y f‹Ñïly buf„r\n", 
¥g
);

152 
	`exô
(1);

178 
	`mem£t
(
ª∂y
, 0, 
MAXBUF
);

185 
Â
 = 
	`p›í
("lscpu", "r");

186 i‡(!
Â
) {

187 
	`¥ötf
("%s:Ö›í o¿'ls˝u' faûed,Åryög vüÖrocfs\n", 
¥g
);

188 
Â
 = 
	`p›í
("cat /proc/cpuinfo", "r");

189 i‡(!
Â
) {

190 
	`‰ì
(
ª∂y
);

191 
	`exô
(1);

195 
	`fgës
(
tmpbuf
, 
LINESZ
, 
Â
)) {

196 
tŸÆ
 +
	`°æí
(
tmpbuf
);

197 i‡(
tŸÆ
 > 
MAXBUF
) {

198 
	`¥ötf
("%s: buf„∏limôÉx˚eded,áb‹tög...\n", 
¥g
);

199 
	`‰ì
(
ª∂y
);

200 
	`exô
(1);

202 
	`°∫ˇt
(
ª∂y
, 
tmpbuf
, 
LINESZ
);

206 i‡((
	`wrôe
(
sd
, 
ª∂y
, 
	`°æí
(reply))) == -1) {

207 
	`‰ì
(
ª∂y
);

208 
	`EºExô
(
¥g
, "socket writeÉrror", 6);

211 
	`‰ì
(
ª∂y
);

212 
	`˛o£
(
sd
);

215 
	}
}

217 
	$maö
(
¨gc
, *
¨gv
[])

219 
sd
, 
√wsd
;

220 
sockÀn_t
 
˛ûí
;

221 
sockaddr_ö
 
svr_addr
, 
˛i_addr
;

222 
siga˘i⁄
 
a˘
;

223 
p‹t
 = 49161;

225 i‡(
¨gc
 < 2) {

226 
	`Ârötf
(
°dîr
, "Usage: %sÖort-num [-v]\n",

227 
¨gv
[0]);

228 
	`exô
(1);

230 
p‹t
 = 
	`©oi
(
¨gv
[1]);

232 i‡((
¨gc
 =3Ë&& (
	`°rcmp
(
¨gv
[2], "-v") == 0))

233 
vîbo£
 = 1;

238 i‡(
	`sig«l
(
SIGPIPE
, 
SIG_IGN
Ë=
SIG_ERR
)

239 
	`EºExô
(
¨gv
[0], "signal", 1);

241 i‡((
sd
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

242 
	`EºExô
(
¨gv
[0], "socket creationÉrror", 1);

243 i‡(
vîbo£
)

244 
	`¥ötf
("%s:Å˝ sockë cª©ed\n", 
¨gv
[0]);

248 
svr_addr
.
sö_Ámûy
 = 
AF_INET
;

249 
svr_addr
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

250 
svr_addr
.
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

252 i‡(
	`böd
(
sd
, (
sockaddr
 *)&
svr_addr
, (svr_addr)) == -1)

253 
	`EºExô
(
¨gv
[0], "socket bindÉrror", 2);

259 c⁄° 
íabÀ
 = 1;

260 i‡(
	`£tsock›t
(
sd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
íabÀ
, ()) < 0)

261 
	`≥º‹
("Warning: setsockopt SO_REUSEADDR failed");

262 i‡(
vîbo£
)

263 
	`¥ötf
("%s: bind doneát IP %sÖort %d; SO_REUSEADDR setupás well\n",

264 
¨gv
[0], 
	`öë_¡ﬂ
(
svr_addr
.
sö_addr
), 
p‹t
);

266 i‡(
	`li°í
(
sd
, 
QLENGTH
) == -1)

267 
	`EºExô
(
¨gv
[0], "socketÜistenÉrror", 3);

268 i‡(
vîbo£
)

269 
	`¥ötf
("%s:Üi°í q së up\n", 
¨gv
[0]);

271 
	#ZOMBIES
 0

272 #if(
ZOMBIES
==0)

	)

273 
a˘
.
ß_h™dÀr
 = 
sig_chûd
;

274 
	`sigem±y£t
(&
a˘
.
ß_mask
);

278 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_NOCLDSTOP
 | 
SA_NOCLDWAIT
;

279 i‡(
	`siga˘i⁄
(
SIGCHLD
, &
a˘
, 0) == -1)

280 
	`EºExô
(
¨gv
[0], "sigactionÉrror", 4);

281 i‡(
vîbo£
)

282 
	`¥ötf
("%s: SIGCHLD h™dÀ∏£àup\n", 
¨gv
[0]);

286 i‡(
vîbo£
)

287 
	`¥ötf
("%s:Öid %d blocking onáccept()..\n",

288 
¨gv
[0], 
	`gëpid
());

289 
	`fÊush
(
°dout
);

291 
˛ûí
 = (
˛i_addr
);

292 i‡((
√wsd
 = 
	`ac˚±
(
sd
, (
sockaddr
 *)&
˛i_addr
, &
˛ûí
)) == -1)

293 
	`EºExô
(
¨gv
[0], "socketácceptÉrror", 5);

295 
	`¥ötf
("\nSîvî %s: clõ¡ c⁄√˘edÇow from IP %†\
 # %d\n", 
¨gv
[0], 
	`öë_¡ﬂ
(
˛i_addr
.
sö_addr
), 
	`¡ohs
(˛i_addr.
sö_p‹t
));

297 
	`fÊush
(
°dout
);

300 
	`f‹k
()) {

302 
	`≥º‹
("forkÉrror");

303 
	`fÊush
(
°dout
);

310 
	`MSG
("debug %s:Öid i†%d\n", 
¨gv
[0], 
	`gëpid
());

311 #if–
DBG_MUST_SLEEP
 == 1)

312 
	`MSG
("¶ìpögÇow f‹ %ds...\n", 
DEBUG_SLEEP
);

313 
	`¶ìp
(
DEBUG_SLEEP
);

316 
	`˛o£
(
sd
);

317 i‡(
vîbo£
) {

318 
	`¥ötf
("%s: child server created;Öid %d\n",

319 
¨gv
[0], 
	`gëpid
());

320 
	`fÊush
(
°dout
);

323 
	`¥o˚ss_˛õ¡
(
√wsd
, 
¨gv
[0]);

325 i‡(
vîbo£
) {

326 
	`¥ötf
("%s: child server %dÉxiting..\n",

327 
¨gv
[0], 
	`gëpid
());

328 
	`fÊush
(
°dout
);

330 
	`exô
(0);

333 
	`˛o£
(
√wsd
);

336 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/fingr_cs/cfingr.c

5 
	~"fögr.h
"

6 
îr_exô
–*
¥g
, * 
îr
, 
exôcode
 );

8 
	#TESTING
 0

	)

10 
	$maö
–
¨gc
, *
¨gv
[] )

12 
sd
, 
n
;

13 
sockaddr_ö
 
svr_addr
;

14 *
ª∂y
;

16 if–
¨gc
 != 3 )

17 
	`Ârötf
(
°dîr
,"Ußge: %†£rv-ù-addªs†u£∫ame\n",
¨gv
[0]), 
	`exô
( 1 );

19 if–(
sd
 = 
	`sockë
–
AF_INET
, 
SOCK_STREAM
, 0 )) == -1 )

20 
	`îr_exô
–
¨gv
[0], "socket creationÉrror", 1 );

24 
svr_addr
.
sö_Ámûy
 = 
AF_INET
;

25 
svr_addr
.
sö_addr
.
s_addr
 = 
	`öë_addr
–
¨gv
[1] );

26 
svr_addr
.
sö_p‹t
 = 
	`ht⁄s
–
SERV_PORT
 );

29 if–(
	`c⁄√˘
(
sd
, (
sockaddr
 *)&
svr_addr
, (svr_addr))) == -1 )

30 
	`îr_exô
–
¨gv
[0], "connectionÉrror", 2 );

32 
ª∂y
 = (*)
	`mÆloc
(
MAXBUF
);

33 if–!
ª∂y
 ) {

34 
	`¥ötf
("\n%s: mÆlo¯Áûed f‹Ñïly..",
¨gv
[0]);

35 
	`˛o£
(
sd
);

36 
	`exô
( 7 );

40 
	`¥ötf
("%s: sídögÑeque° \"%s\"Åÿ£rvî\n",
¨gv
[0],argv[2]);

41 if–((
n
=
	`wrôe
(
sd
,
¨gv
[2],
	`°æí
(argv[2]))) == -1 ))

42 
	`îr_exô
–
¨gv
[0], "socket writeÉrror", 3 );

44 if–((
n
=
	`ªad
(
sd
,
ª∂y
,
MAXBUF
)) == -1 ))

45 
	`îr_exô
–
¨gv
[0], "socketÑeadÉrror", 4 );

47 
	`¥ötf
("\n%s: Re˚ived %d byã†‰om sîvî;\n%s", 
¨gv
[0], \

48 
n
, 
ª∂y
);

50 #if(
TESTING
==1)

51 
	`¶ìp
(3);

54 
	`‰ì
(
ª∂y
);

55 
	`˛o£
–
sd
 );

56 
	`exô
( 0 );

57 
	}
}

60 
	$îr_exô
–*
¥g
, * 
îr
, 
exôcode
 )

62 *
îr_°r
;

64 
îr_°r
 = (*)
	`mÆloc
(
	`°æí
(
¥g
)+°æí(
îr
)+2);

65 if–!
îr_°r
 ) {

66 
	`¥ötf
("\n%s: mÆlo¯Áûed f‹Éº_°r..",
¥g
);

67 
	`¥ötf
("%†exôög wôhÉº‹ codê%d,Öîr‹ shows:\n", 
¥g
, 
exôcode
);

68 
	`≥º‹
–
¥g
 );

69 
	`exô
–
exôcode
 );

72 
	`•rötf
(
îr_°r
,"%s: %s", 
¥g
, 
îr
);

73 
	`≥º‹
–
îr_°r
 );

74 
	`‰ì
–
îr_°r
 );

76 
	`exô
–
exôcode
 );

77 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/fingr_cs/convenient.h

24 
	~<asm/∑øm.h
>

27 #if(
DBG
 == 1)

28 
	#MSG
(
°rög
, 
¨gs
...) \

29 
	`Ârötf
(
°dîr
, "%s:%†: " 
°rög
, 
__FILE__
, 
__FUNCTION__
, ##
¨gs
)

	)

30 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

31 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
)

	)

33 
	#MSG
(
°rög
, 
¨gs
...)

	)

34 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

39 
ölöe
 
	$bìp
(
wh©
)

41 
buf
[2];

42 
buf
[0]=()(
wh©
);

43 
buf
[1]='\0';

44 ()
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1 );

45 
	}
}

52 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

54 
c
=0, 
m
;\

55 
f‹_ödex
,
ö√r_ödex
; \

57 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

58 
	`bìp
((
vÆ
)); \

59 
c
++;\

60 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

61 
m
=0;m<50;m++); \

64 }

	)

	@Training/L1_sysprg_trg/net_sockets/inet_domain/fingr_cs/fingr.h

4 
	~<°dio.h
>

5 
	~<°rög.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/sockë.h
>

10 
	~<√töë/ö.h
>

11 
	~<¨∑/öë.h
>

12 
	~<sig«l.h
>

13 
	~<sys/waô.h
>

14 
	~<î∫o.h
>

15 
	~<pwd.h
>

16 
	~"c⁄víõ¡.h
"

21 
	#SERV_PORT
 61005

	)

22 
	#MAXBUF
 512

	)

23 
	#RE_MAXLEN
 100+256+48+8+8+1024+4096+128

	)

	@Training/L1_sysprg_trg/net_sockets/inet_domain/fingr_cs/sfingr.c

9 
	~"fögr.h
"

11 
	#QLENGTH
 5

	)

12 
	#DBG_MUST_SLEEP
 0

	)

13 
	#DEBUG_SLEEP
 20

	)

14 
	#ZOMBIES
 0

	)

16 
	gvîbo£
=0;

19 
	$sig_chûd
–
signum
 )

23 
°©us
;

24 
pid
;

26  (
pid
=
	`waô3
–&
°©us
, 
WNOHANG
, 0 )) > 0 ) {

27 if–
vîbo£
 )

28 
	`¥ötf
("∑ª¡ sîvî i¿SIGCHLD h™dÀr;Öid=%d\n",
pid
);

31 
	`¥ötf
("%s()\n", 
__func__
);

33 
	}
}

35 
	$îr_exô
–*
¥g
, * 
îr
, 
exôcode
 )

37 *
îr_°r
;

39 
îr_°r
 = (*)
	`mÆloc
(300);

40 if–!
îr_°r
 ) {

41 
	`¥ötf
("\n%s: mÆlo¯Áûed f‹Éº_°r..\n", 
¥g
);

42 
	`¥ötf
("%†exôög wôhÉº‹ codê%d,Öîr‹ shows:\n", 
¥g
, 
exôcode
);

43 
	`≥º‹
–
¥g
 );

44 
	`¥ötf
("OrigöÆÉº‹ mesßge: %s\n", 
îr
);

45 
	`exô
–
exôcode
 );

48 
	`¢¥ötf
(
îr_°r
, 300, "%s: %s", 
¥g
, 
îr
);

49 
	`≥º‹
–
îr_°r
 );

50 
	`‰ì
–
îr_°r
 );

52 
	`exô
–
exôcode
 );

53 
	}
}

56 
	$¥o˚ss_˛õ¡
–
sd
, *
¥g
 )

58 *
u£∫ame
, *
ª∂y
;

59 
ssize_t
 
n
;

60 
∑sswd
 *
p
;

62 
	`MSG
 ("_svr: inÖrocess_client()..\n");

63 
u£∫ame
 = (*)
	`mÆloc
( 32 );

64 if–!
u£∫ame
 ) {

65 
	`¥ötf
("\n%s:Çÿmem‹y f‹ u£∫amêbuf„r", 
¥g
 );

66 
	`exô
( 1 );

70 if–(
n
=
	`ªad
(
sd
,
u£∫ame
,
MAXBUF
)) == -1 )

71 
	`îr_exô
–
¥g
, "socketÑeadÉrror", 6 );

72 
u£∫ame
[
n
]='\0';

74 
ª∂y
 = (*)
	`mÆloc
–
MAXBUF
 );

75 if–!
ª∂y
 ) {

76 
	`¥ötf
("\n%s:Çÿmem‹y f‹Ñïly buf„r", 
¥g
 );

77 
	`‰ì
 (
u£∫ame
);

78 
	`exô
( 1 );

81 
p
 = 
	`gëpw«m
–
u£∫ame
 );

82 if–
p
==
NULL
 ) {

83 
	`¢¥ötf
(
ª∂y
, 256+256, "\n%†i†u«bÀÅÿgë infÿf‹ %s\n", 
¥g
, 
u£∫ame
 );

84 if–(
	`wrôe
–
sd
, 
ª∂y
, 
	`°æí
(reply) )) == -1 )

85 
	`îr_exô
–
¥g
, "socket writeÉrror", 6 );

86 
	`˛o£
–
sd
 );

87 
	`‰ì
(
ª∂y
);

88 
	`‰ì
(
u£∫ame
);

89 
	`exô
( 1 );

93 
	`¢¥ötf
–
ª∂y
, 
RE_MAXLEN
, "\tUsername: %s\n\t(encrypted)Öassword: %s\n\
\tUID: %d\n\tGID: %d\n\tComment/FullName: %s\n\tHome dir: %s\n\tShell: %s\n",

95 
p
->
pw_«me
,Ö->
pw_∑sswd
,Ö->
pw_uid
,Ö->
pw_gid
,Ö->
pw_gecos
,Ö->
pw_dú
,

96 
p
->
pw_shñl
 );

97 
	`MSG
 ("_svr: u£∫amêi†%s,Ñïly is:\n%s\n",
u£∫ame
,
ª∂y
);

99 if–(
	`wrôe
–
sd
, 
ª∂y
, 
	`°æí
(reply) )) == -1 ) {

100 
	`‰ì
–
u£∫ame
 );

101 
	`‰ì
–
ª∂y
 );

102 
	`îr_exô
–
¥g
, "socket writeÉrror", 6 );

105 
	`‰ì
–
u£∫ame
 );

106 
	`‰ì
–
ª∂y
 );

107 
	`˛o£
–
sd
 );

110 
	}
}

113 
	$maö
–
¨gc
, *
¨gv
[] )

115 
sd
, 
√wsd
;

116 
sockÀn_t
 
˛ûí
;

117 
sockaddr_ö
 
svr_addr
, 
˛i_addr
;

118 
siga˘i⁄
 
a˘
;

120 i‡(
¨gc
 < 2) {

121 
	`Ârötf
(
°dîr
, "Ußge: %†£rvî-ù-add∏[-v]\n", 
¨gv
[0]);

122 
	`exô
(1);

124 i‡((
¨gc
==2Ë&& (
	`°rcmp
(
¨gv
[1],"-v"))==0) {

125 
	`Ârötf
(
°dîr
, "Ußge: %†£rvî-ù-add∏[-v]\n", 
¨gv
[0]);

126 
	`exô
(1);

129 i‡((
¨gc
==3Ë&& (
	`°rcmp
(
¨gv
[2],"-v"))==0)

130 
vîbo£
=1;

132 if–(
sd
 = 
	`sockë
–
AF_INET
, 
SOCK_STREAM
, 0 )) == -1 )

133 
	`îr_exô
–
¨gv
[0], "socket creationÉrror", 1 );

134 if–
vîbo£
Ë
	`¥ötf
("%s:Å˝ sockë cª©ed\n",
¨gv
[0]);

138 
svr_addr
.
sö_Ámûy
 = 
AF_INET
;

141 
svr_addr
.
sö_addr
.
s_addr
 = 
	`öë_addr
–
¨gv
[1] );

145 
svr_addr
.
sö_p‹t
 = 
	`ht⁄s
–
SERV_PORT
 );

147 if–
	`böd
(
sd
, (
sockaddr
 *)&
svr_addr
,\

148 (
svr_addr
) ) == -1 )

149 
	`îr_exô
–
¨gv
[0], "socket bindÉrror", 2 );

150 if–
vîbo£
Ë
	`¥ötf
("%s: böd d⁄ê© IP %†p‹à%d\n",
¨gv
[0],argv[1],

151 
SERV_PORT
);

154 if–
	`li°í
(
sd
, 
QLENGTH
) == -1 )

155 
	`îr_exô
–
¨gv
[0], "socketÜistenÉrror", 3 );

156 if–
vîbo£
Ë
	`¥ötf
("%s:Üi°í q së up\n",
¨gv
[0]);

158 #if(
ZOMBIES
==0)

159 
a˘
.
ß_h™dÀr
=
sig_chûd
;

160 
	`sigem±y£t
(&
a˘
.
ß_mask
);

164 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_NOCLDSTOP
 | 
SA_NOCLDWAIT
;

165 if–
	`siga˘i⁄
–
SIGCHLD
, &
a˘
, 0 ) == -1 )

166 
	`îr_exô
–
¨gv
[0], "sigactionÉrror", 4 );

167 if–
vîbo£
Ë
	`¥ötf
("%s: SIGCHLD h™dÀ∏£àup\n",
¨gv
[0]);

171 if–
vîbo£
Ë
	`¥ötf
("%s:Öid %d blocking onáccept()..\n",

172 
¨gv
[0],
	`gëpid
() );

173 
	`fÊush
–
°dout
 );

175 
˛ûí
 = –
˛i_addr
 );

176 if–(
√wsd
 = 
	`ac˚±
(
sd
, (
sockaddr
 *)&
˛i_addr
,\

177 &
˛ûí
)) == -1 )

178 
	`îr_exô
–
¨gv
[0], "socketácceptÉrror", 5 );

180 
	`¥ötf
–"\nSîvî %s: clõ¡ c⁄√˘edÇow from IP %†\
 # %d\n", 
¨gv
[0], 
	`öë_¡ﬂ
(
˛i_addr
.
sö_addr
), 
	`¡ohs
(˛i_addr.
sö_p‹t
) );

182 
	`fÊush
–
°dout
 );

185  
	`f‹k
() ) {

186 -1: 
	`≥º‹
( "forkÉrror" );

187 
	`fÊush
(
°dout
);

194 
	`MSG
 ("debug %s:Öid i†%d\n",
¨gv
[0],
	`gëpid
());

195 #if–
DBG_MUST_SLEEP
 == 1)

196 
	`MSG
 ("¶ìpögÇow f‹ %ds...\n", 
DEBUG_SLEEP
);

197 
	`¶ìp
(
DEBUG_SLEEP
);

200 
	`˛o£
–
sd
 );

201 if–
vîbo£
 ) {

202 
	`¥ötf
("%s: chûd sîvî cª©ed;Öid %d\n",
¨gv
[0],
	`gëpid
());

203 
	`fÊush
(
°dout
);

206 
	`¥o˚ss_˛õ¡
–
√wsd
, 
¨gv
[0] );

208 if–
vîbo£
 ) {

209 
	`¥ötf
("%s: chûd sîvî %dÉxôög..\n",
¨gv
[0],
	`gëpid
());

210 
	`fÊush
(
°dout
);

212 
	`exô
( 0 );

215 
	`˛o£
–
√wsd
 );

219 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/mt_finger/cfingr.c

5 
	~"öë.h
"

6 
	#TESTING
 0

	)

8 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

10 *
îr_°r
;

12 
îr_°r
 = (*)
	`mÆloc
(
	`°æí
(
¥g
Ë+ såÀn(
îr
) + 2);

13 i‡(!
îr_°r
) {

14 
	`¥ötf
("\n%s: mÆlo¯Áûed f‹Éº_°r..", 
¥g
);

15 
	`¥ötf
("%†exôög wôhÉº‹ codê%d,Öîr‹ shows:\n", 
¥g
,

16 
exôcode
);

17 
	`≥º‹
(
¥g
);

18 
	`exô
(
exôcode
);

21 
	`•rötf
(
îr_°r
, "%s: %s", 
¥g
, 
îr
);

22 
	`≥º‹
(
îr_°r
);

23 
	`‰ì
(
îr_°r
);

25 
	`exô
(
exôcode
);

26 
	}
}

28 
	$maö
(
¨gc
, *
¨gv
[])

30 
sd
, 
n
;

31 
sockaddr_ö
 
svr_addr
;

32 *
ª∂y
;

34 i‡(
¨gc
 == 1)

35 
	`Ârötf
(
°dîr
, "Ußge: %†u£∫ame\n", 
¨gv
[0]), 
	`exô
(1);

37 i‡((
sd
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

38 
	`îr_exô
(
¨gv
[0], "socket creationÉrror", 1);

41 
svr_addr
.
sö_Ámûy
 = 
AF_INET
;

42 
svr_addr
.
sö_addr
.
s_addr
 = 
	`öë_addr
(
SERV_IP
);

43 
svr_addr
.
sö_p‹t
 = 
	`ht⁄s
(
SERV_PORT
);

46 i‡((
	`c⁄√˘
(
sd
, (
sockaddr
 *)&
svr_addr
, (svr_addr))) == -1)

47 
	`îr_exô
(
¨gv
[0], "connectionÉrror", 2);

49 
ª∂y
 = (*)
	`mÆloc
(
MAXBUF
);

50 i‡(!
ª∂y
) {

51 
	`¥ötf
("\n%s: mÆlo¯Áûed f‹Ñïly..", 
¨gv
[0]);

52 
	`˛o£
(
sd
);

53 
	`exô
(7);

56 
	`¥ötf
("%s: sídögÑeque° \"%s\"Åÿ£rvî\n", 
¨gv
[0],árgv[1]);

57 i‡(((
n
 = 
	`wrôe
(
sd
, 
¨gv
[1], 
	`°æí
(argv[1]))) == -1))

58 
	`îr_exô
(
¨gv
[0], "socket writeÉrror", 3);

60 i‡(((
n
 = 
	`ªad
(
sd
, 
ª∂y
, 
MAXBUF
)) == -1))

61 
	`îr_exô
(
¨gv
[0], "socketÑeadÉrror", 4);

63 
	`¥ötf
("\n%s: Re˚ived %d byã†‰om sîvî;\n%s", 
¨gv
[0], 
n
, 
ª∂y
);

65 #if(
TESTING
==1)

66 
	`¶ìp
(3);

69 
	`‰ì
(
ª∂y
);

70 
	`˛o£
(
sd
);

71 
	`exô
(0);

72 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/mt_finger/convenient.h

24 
	~<asm/∑øm.h
>

27 #if(
DEBUG
 == 1)

28 
	#MSG
(
°rög
, 
¨gs
...) \

29 
	`Ârötf
(
°dîr
, "%s:%†: " 
°rög
, 
__FILE__
, 
__FUNCTION__
, ##
¨gs
)

	)

30 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

31 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
)

	)

33 
	#MSG
(
°rög
, 
¨gs
...)

	)

34 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

38 
ölöe
 
	$bìp
(
wh©
)

40 
buf
[2];

41 
buf
[0] = ()(
wh©
);

42 
buf
[1] = '\0';

43 ()
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1);

44 
	}
}

51 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

53 
c
=0, 
m
;\

54 
f‹_ödex
,
ö√r_ödex
; \

56 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

57 
	`bìp
((
vÆ
)); \

58 
c
++;\

59 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

60 
m
=0;m<50;m++); \

63 }

	)

	@Training/L1_sysprg_trg/net_sockets/inet_domain/mt_finger/inet.h

4 
	~<°dio.h
>

5 
	~<°rög.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/sockë.h
>

10 
	~<√töë/ö.h
>

11 
	~<¨∑/öë.h
>

12 
	~<sig«l.h
>

13 
	~<sys/waô.h
>

14 
	~<î∫o.h
>

15 
	~<pwd.h
>

17 
	~"c⁄víõ¡.h
"

19 
	#SERV_IP
 "127.0.0.1"

20 
	#SERV_PORT
 61008

	)

21 
	#MAXBUF
 512

	)

22 
	#RE_MAXLEN
 100+256+48+8+8+1024+4096+128

	)

	@Training/L1_sysprg_trg/net_sockets/inet_domain/mt_finger/mt_sfingr.c

6 
	~"öë.h
"

7 
	~<±hªad.h
>

8 
	~<pwd.h
>

10 
	#QLENGTH
 5

	)

12 
	gvîbo£
 = 0;

13 *
	g¥g
;

15 
	$thrd_îr_exô
(*
¥g
, *
îr
, 
exôcode
)

17 *
îr_°r
, 
exô°r
[4];

19 
îr_°r
 = (*)
	`mÆloc
(300);

20 i‡(!
îr_°r
)

21 
	`¥ötf
("\n%s: mÆlo¯Áûed f‹Éº_°r..", 
¥g
);

23 
	`¢¥ötf
(
îr_°r
, 300, "%s: %s", 
¥g
, 
îr
);

24 
	`≥º‹
(
îr_°r
);

25 
	`‰ì
(
îr_°r
);

27 
	`¢¥ötf
(
exô°r
, 4, "%d", 
exôcode
);

28 
	`±hªad_exô
(
exô°r
);

29 
	}
}

31 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

33 *
îr_°r
;

35 
îr_°r
 = (*)
	`mÆloc
(
	`°æí
(
¥g
Ë+ såÀn(
îr
) + 2);

36 i‡(!
îr_°r
)

37 
	`¥ötf
("\n%s: mÆlo¯Áûed f‹Éº_°r..", 
¥g
);

39 
	`¢¥ötf
(
îr_°r
, 
	`°æí
(
¥g
Ë+ såÀn(
îr
) + 2, "%s: %s",Örg,Érr);

40 
	`≥º‹
(
îr_°r
);

41 
	`‰ì
(
îr_°r
);

43 
	`exô
(
exôcode
);

44 
	}
}

47 * 
	$¥o˚ss_˛õ¡
(*
¨g
)

49 *
u£∫ame
, *
ª∂y
;

50 
sd
, 
n
;

51 
∑sswd
 *
p
;

52 
	#PBUFLEN
 8192

	)

53 
pbuf
[
PBUFLEN
];

55 
sd
 = ()
¨g
;

56 i‡(
vîbo£
)

57 
	`¥ötf
("%s: childÅhread (%d) on socket sd %d\n",

58 
¥g
, 
	`gëpid
(), 
sd
);

60 #ifde‡
DBG


61 
	`¥ötf
("_chûdÅhªad: i¿¥o˚ss_˛õ¡()..¨g=%d\n", ()
¨g
);

62 
	`fÊush
(
°dout
);

64 
u£∫ame
 = 
	`mÆloc
(
MAXBUF
);

65 i‡(!
u£∫ame
) {

66 
	`¥ötf
("\n%s:Çÿmem‹y f‹ u£∫amêbuf„r", 
¥g
);

67 
	`±hªad_exô
("enomem");

70 i‡((
n
 = 
	`ªad
(
sd
, 
u£∫ame
, 
MAXBUF
)) == -1)

71 
	`thrd_îr_exô
(
¥g
, "socketÑeadÉrror", 6);

72 
u£∫ame
[
n
] = '\0';

73 #ifde‡
DBG


74 
	`¥ötf
("_chûdÅhªad:á‡ªad()..n=%d\n", 
n
);

75 
	`fÊush
(
°dout
);

78 
ª∂y
 = (*)
	`mÆloc
(
MAXBUF
);

79 i‡(!
ª∂y
) {

80 
	`¥ötf
("\n%s:Çÿmem‹y f‹Ñïly buf„r", 
¥g
);

81 
	`‰ì
(
u£∫ame
);

82 
	`±hªad_exô
("1");

89 
p
 = 
	`mÆloc
((
∑sswd
));

90 i‡(!
p
) {

91 
	`¥ötf
("\n%s:Çÿmem‹y f‹Öasswd såu˘uª", 
¥g
);

92 
	`‰ì
(
u£∫ame
);

93 
	`‰ì
(
ª∂y
);

94 
	`±hªad_exô
("1");

96 i‡(
	`gëpw«m_r
(
u£∫ame
, 
p
, 
pbuf
, 
PBUFLEN
, &pË|| (∞=
NULL
)) {

97 
	`¢¥ötf
(
ª∂y
, 
MAXBUF
-1, "\n%†i†u«bÀÅÿgë infÿf‹ %s\n", 
¥g
,

98 
u£∫ame
);

99 i‡((
	`wrôe
(
sd
, 
ª∂y
, 
	`°æí
(reply))) == -1)

100 
	`thrd_îr_exô
(
¥g
, "socket writeÉrror", 6);

101 
	`˛o£
(
sd
);

102 
	`‰ì
(
p
);

103 
	`‰ì
(
u£∫ame
);

104 
	`‰ì
(
ª∂y
);

105 
	`±hªad_exô
("1");

108 
	`¢¥ötf
(
ª∂y
, 
MAXBUF
-1,

111 
p
->
pw_«me
,Ö->
pw_∑sswd
,Ö->
pw_uid
,Ö->
pw_gid
,Ö->
pw_gecos
,Ö->
pw_dú
,Ö->
pw_shñl
);

113 i‡((
	`wrôe
(
sd
, 
ª∂y
, 
	`°æí
(reply))) == -1)

114 
	`thrd_îr_exô
(
¥g
, "socket writeÉrror", 6);

116 
	`‰ì
(
p
);

117 
	`‰ì
(
u£∫ame
);

118 
	`‰ì
(
ª∂y
);

120 #ifde‡
TESTING


121 
	`¶ìp
(5);

129 
	`˛o£
(
sd
);

130 
	`±hªad_exô
("0");

131 
	}
}

134 
	$maö
(
¨gc
, *
¨gv
[])

136 
sd
, 
√wsd
, 
r
;

137 
˛ûí
;

138 
±hªad_t
 
p2
;

139 
sockaddr_ö
 
svr_addr
, 
˛i_addr
;

141 i‡((
¨gc
 > 1Ë&& (
	`°rcmp
(
¨gv
[1], "-v") == 0))

142 
vîbo£
 = 1;

143 
¥g
 = 
¨gv
[0];

145 i‡((
sd
 = 
	`sockë
(
PF_INET
, 
SOCK_STREAM
, 0)) == -1)

146 
	`îr_exô
(
¨gv
[0], "socket creationÉrror", 1);

147 i‡(
vîbo£
)

148 
	`¥ötf
("%s:Å˝ sockë cª©ed\n", 
¨gv
[0]);

151 
svr_addr
.
sö_Ámûy
 = 
PF_INET
;

152 
svr_addr
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

154 
svr_addr
.
sö_p‹t
 = 
	`ht⁄s
(
SERV_PORT
);

156 i‡(
	`böd
(
sd
, (
sockaddr
 *)&
svr_addr
, (svr_addr)) == -1)

157 
	`îr_exô
(
¨gv
[0], "socket bindÉrror", 2);

158 i‡(
vîbo£
)

159 
	`¥ötf
("%s: böd d⁄ê© IP %†p‹à%d\n", 
¨gv
[0], 
SERV_IP
,

160 
SERV_PORT
);

162 i‡(
	`li°í
(
sd
, 
QLENGTH
) == -1)

163 
	`îr_exô
(
¨gv
[0], "socketÜistenÉrror", 3);

164 i‡(
vîbo£
)

165 
	`¥ötf
("%s:Üi°í q së up\n", 
¨gv
[0]);

168 i‡(
vîbo£
)

169 
	`¥ötf
("%s:Öid %d blocking onáccept()..\n",

170 
¨gv
[0], 
	`gëpid
());

171 
	`fÊush
(
°dout
);

173 
˛ûí
 = (
˛i_addr
);

174 i‡((
√wsd
 = 
	`ac˚±
(
sd
, (
sockaddr
 *)&
˛i_addr
, &
˛ûí
)) == -1)

175 
	`îr_exô
(
¨gv
[0], "socketácceptÉrror", 5);

177 
	`¥ötf
("\nSîvî %s: clõ¡ c⁄√˘edÇow from IP %†\
 # %d\n", 
¨gv
[0], 
	`öë_¡ﬂ
(
˛i_addr
.
sö_addr
), 
	`¡ohs
(˛i_addr.
sö_p‹t
));

179 
	`fÊush
(
°dout
);

183 
r
 = 
	`±hªad_¸óã
(&
p2
,

184 
NULL
,

185 
¥o˚ss_˛õ¡
,

186 (*)
√wsd
);

187 i‡(
r
)

188 
	`≥º‹
("pthread creation");

190 i‡(
	`±hªad_dëach
(
p2
)) {

191 
	`≥º‹
("svr:Öthread detach failed");

194 i‡(
vîbo£
)

195 
	`¥ötf
("%s: childÅhread created & detached\n",

196 
¨gv
[0]);

202 
	`fÊush
(
°dout
);

206 
	}
}

	@Training/L1_sysprg_trg/net_sockets/inet_domain/server_pre_threaded/svr_pre_mt.c

13 
	~<°dio.h
>

14 
	~<uni°d.h
>

15 
	~<f˙é.h
>

16 
	~<°rög.h
>

17 
	~<sys/°©.h
>

18 
	~<°dlib.h
>

19 
	~<˘y≥.h
>

20 
	~<°rögs.h
>

21 
	~<sys/ty≥s.h
>

22 
	~<sys/sockë.h
>

23 
	~<√töë/ö.h
>

24 
	~<¨∑/öë.h
>

25 
	~<sig«l.h
>

26 
	~<sys/time.h
>

27 
	~<sys/ªsour˚.h
>

28 
	~<sys/£ndfûe.h
>

29 
	~<sys/waô.h
>

30 
	~<time.h
>

31 
	~<loˇÀ.h
>

32 
	~<±hªad.h
>

33 
	~<î∫o.h
>

35 
	#DEFAULT_SERVER_PORT
 8000

	)

36 
	#QLEN_MAX
 10

	)

37 
	#METHOD_HANDLED
 0

	)

39 
	g¥g_«me
[128];

41 
	#THREADS_COUNT
 10

	)

42 
±hªad_t
 
	gthªads
[
THREADS_COUNT
];

44 
	g£rvî_sockë
;

45 
±hªad_muãx_t
 
	gmlock
 = 
PTHREAD_MUTEX_INITIALIZER
;

50 c⁄° *
	gunim∂emíãd_c⁄ã¡
 =

63 c⁄° *
	ghâp_404_c⁄ã¡
 =

80 
	$Áèl_îr‹
(c⁄° *
sysˇŒ
)

82 
	`≥º‹
(
sysˇŒ
);

83 
	`exô
(
î∫o
);

84 
	}
}

93 
	$gë_löe
(
sock
, *
buf
, 
size
)

95 
i
 = 0;

96 
c
 = '\0';

97 
ssize_t
 
n
;

99 (
i
 < 
size
 - 1Ë&& (
c
 != '\n')) {

100 
n
 = 
	`ªcv
(
sock
, &
c
, 1, 0);

101 i‡(
n
 > 0) {

102 i‡(
c
 == '\r') {

103 
n
 = 
	`ªcv
(
sock
, &
c
, 1, 
MSG_PEEK
);

104 i‡((
n
 > 0Ë&& (
c
 == '\n'))

105 
	`ªcv
(
sock
, &
c
, 1, 0);

107 
buf
[
i
] = 
c
;

108 
i
++;

113 
buf
[
i
] = '\0';

115  
i
;

116 
	}
}

122 
	$°πﬁowî
(*
°r
)

124 ; *
°r
; ++str)

125 *
°r
 = ()
	`tﬁowî
(*str);

126 
	}
}

133 
	$h™dÀ_unim∂emíãd_mëhod
(
˛õ¡_sockë
)

135 
	`£nd
(
˛õ¡_sockë
, 
unim∂emíãd_c⁄ã¡
,

136 
	`°æí
(
unim∂emíãd_c⁄ã¡
), 0);

137 
	}
}

144 
	$h™dÀ_hâp_404
(
˛õ¡_sockë
)

146 
	`£nd
(
˛õ¡_sockë
, 
hâp_404_c⁄ã¡
, 
	`°æí
(http_404_content), 0);

147 
	}
}

153 c⁄° *
	$gë_fûíame_ext
(c⁄° *
fûíame
)

155 c⁄° *
dŸ
 = 
	`°ºchr
(
fûíame
, '.');

156 i‡(!
dŸ
 || dŸ =
fûíame
)

158  
dŸ
 + 1;

159 
	}
}

162 
	$‰om_hex
(
ch
)

164  
	`isdigô
(
ch
Ë? ch - '0' : 
	`tﬁowî
(ch) - 'a' + 10;

165 
	}
}

174 *
	$uæícodög_decode
(*
°r
)

176 *
p°r
 = 
°r
, *
buf
 = 
	`mÆloc
(
	`°æí
(°rË+ 1), *
pbuf
 = buf;

177 *
p°r
) {

178 i‡(*
p°r
 == '%') {

179 i‡(
p°r
[1] &&Östr[2]) {

180 *
pbuf
++ =

181 
	`‰om_hex
(
p°r
[1]) << 4 | from_hex(pstr[2]);

182 
p°r
 += 2;

184 } i‡(*
p°r
 == '+') {

185 *
pbuf
++ = ' ';

187 *
pbuf
++ = *
p°r
;

189 
p°r
++;

191 *
pbuf
 = '\0';

192  
buf
;

193 
	}
}

204 
	$å™s„r_fûe_c⁄ã¡s
(*
fûe_∑th
, 
˛õ¡_sockë
)

206 
fd
, 
ªt
;

207 
°©
 
°©b
;

208 
off_t
 
fûesz
 = 0;

211 
ªt
 = 
	`°©
(
fûe_∑th
, &
°©b
);

212 i‡(
ªt
 < 0) {

213 
	`≥º‹
("stat failed");

216 i‡(!(
°©b
.
°_mode
 & 
S_IFREG
))

218 
fûesz
 = 
°©b
.
°_size
;

219 i‡(
fûesz
 <= 0)

222 
fd
 = 
	`›í
(
fûe_∑th
, 
O_RDONLY
);

223 i‡(
fd
 < 0) {

224 
	`≥º‹
("open failed");

227 
ªt
 = 
	`£ndfûe
(
˛õ¡_sockë
, 
fd
, 
NULL
, 
fûesz
);

228 i‡(
ªt
 < 0) {

229 
	`≥º‹
("sendfile failed");

232 
	`˛o£
(
fd
);

235 
	}
}

243 
	#FILE_TO_TRANSFER
 "/ëc/∑sswd"

	)

245 
	$h™dÀ_˛õ¡
(
˛õ¡_sockë
, 
thrdnum
)

247 
msg
[512];

248 
ªt
;

252 
	`¢¥ötf
(
msg
, 127,

254 
thrdnum
);

255 
ªt
 = 
	`£nd
(
˛õ¡_sockë
, 
msg
, 
	`°æí
(msg), 0);

256 i‡(
ªt
 < 0)

257 
	`Áèl_îr‹
("send(2) failed");

259 
ªt
 = 
	`å™s„r_fûe_c⁄ã¡s
(
FILE_TO_TRANSFER
, 
˛õ¡_sockë
);

260 
ªt
) {

265 
	`¢¥ötf
(
msg
, 512,

267 
¥g_«me
, 
__func__
, 
thrdnum
, 
FILE_TO_TRANSFER
);

270 
	`¢¥ötf
(
msg
, 512,

272 
¥g_«me
, 
__func__
, 
thrdnum
, 
FILE_TO_TRANSFER
);

275 
	`¢¥ötf
(
msg
, 512,

277 
¥g_«me
, 
__func__
, 
thrdnum
, 
FILE_TO_TRANSFER
);

280 
	`¢¥ötf
(
msg
, 512,

282 
¥g_«me
, 
__func__
, 
thrdnum
, 
FILE_TO_TRANSFER
);

285 
	`¢¥ötf
(
msg
, 512,

287 
¥g_«me
, 
__func__
, 
thrdnum
, 
FILE_TO_TRANSFER
);

290 
	`¢¥ötf
(
msg
, 512,

292 
¥g_«me
, 
__func__
, 
thrdnum
, 
FILE_TO_TRANSFER
, 
ªt
);

295 
	`°∫ˇt
(
msg
, "Lookup serverÜog for details.\n", 511);

296 
ªt
 = 
	`£nd
(
˛õ¡_sockë
, 
msg
, 
	`°æí
(msg), 0);

297 i‡(
ªt
 < 0)

298 
	`Áèl_îr‹
("send(2) failed");

300 
	}
}

312 *
	$íãr_£rvî_lo›
(*
èrg
)

314 
sockaddr_ö
 
˛õ¡_addr
;

315 
sockÀn_t
 
˛õ¡_addr_Àn
 = (
˛õ¡_addr
);

316 
thrdnum
 = ()
èrg
;

320 
	`±hªad_muãx_lock
(&
mlock
);

322 
˛õ¡_sockë
 = 
	`ac˚±
(
£rvî_sockë
,

323 (
sockaddr
 *)&
˛õ¡_addr
,

324 &
˛õ¡_addr_Àn
);

325 i‡(
˛õ¡_sockë
 == -1)

326 
	`Áèl_îr‹
("accept()");

328 
	`±hªad_muãx_u∆ock
(&
mlock
);

331 
	`h™dÀ_˛õ¡
(
˛õ¡_sockë
, 
thrdnum
);

333 
	}
}

335 
	#PER_THRD_STACKSIZE
 (8*1024*1024)

	)

336 
	$¸óã_thªad
(
ödex
)

338 
±hªad_©å_t
 
©å
;

340 
	`±hªad_©å_öô
(&
©å
);

341 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_DETACHED
);

342 
	`±hªad_©å_£t°acksize
(&
©å
, 
PER_THRD_STACKSIZE
);

344 i‡(
±hªad_¸óã


345 (&
thªads
[
ödex
], &
©å
, &
íãr_£rvî_lo›
, (*)index))

346 
	`Ârötf
(
°dîr
,

348 
__func__
, 
ödex
, 
î∫o
);

349 
	}
}

356 
	$£tup_li°íög_sockë
(
p‹t
)

358 
sock
;

359 
sockaddr_ö
 
§v_addr
;

361 
sock
 = 
	`sockë
(
PF_INET
, 
SOCK_STREAM
, 0);

362 i‡(
sock
 == -1)

363 
	`Áèl_îr‹
("socket()");

371 
íabÀ
 = 1;

372 i‡(
	`£tsock›t
(
sock
,

373 
SOL_SOCKET
, 
SO_REUSEADDR
, &
íabÀ
, ()) < 0)

374 
	`Áèl_îr‹
("setsockopt(SO_REUSEADDR)");

376 
	`bzîo
(&
§v_addr
, (srv_addr));

377 
§v_addr
.
sö_Ámûy
 = 
AF_INET
;

378 
§v_addr
.
sö_p‹t
 = 
	`ht⁄s
(
p‹t
);

379 
§v_addr
.
sö_addr
.
s_addr
 = 
	`ht⁄l
(
INADDR_ANY
);

384 i‡(
	`böd
(
sock
,

385 (c⁄° 
sockaddr
 *)&
§v_addr
, (srv_addr)) < 0)

386 
	`Áèl_îr‹
("bind()");

388 i‡(
	`li°í
(
sock
, 
QLEN_MAX
) < 0)

389 
	`Áèl_îr‹
("listen()");

391  
sock
;

392 
	}
}

402 
	$¥öt_°©s
(
signo
)

404 
u£r
, 
sys
;

405 
rußge
 
myußge
;

407 i‡(
	`gërußge
(
RUSAGE_SELF
, &
myußge
) < 0)

408 
	`Áèl_îr‹
("getrusage()");

410 
u£r
 = ()
myußge
.
ru_utime
.
tv_£c
 +

411 
myußge
.
ru_utime
.
tv_u£c
 / 1000000.0;

412 
sys
 = ()
myußge
.
ru_°ime
.
tv_£c
 +

413 
myußge
.
ru_°ime
.
tv_u£c
 / 1000000.0;

415 
	`¥ötf
("\nu£∏timê%g, sy†timê%g\n", 
u£r
, 
sys
);

416 
	`exô
(0);

417 
	}
}

425 
	$maö
(
¨gc
, *
¨gv
[])

427 
£rvî_p‹t
;

429 
	`sig«l
(
SIGINT
, 
¥öt_°©s
);

431 i‡(
¨gc
 > 1)

432 
£rvî_p‹t
 = 
	`©oi
(
¨gv
[1]);

434 
£rvî_p‹t
 = 
DEFAULT_SERVER_PORT
;

436 
	`sig«l
(
SIGPIPE
, 
SIG_IGN
);

437 
	`°∫˝y
(
¥g_«me
, 
¨gv
[0], 127);

439 
£rvî_sockë
 = 
	`£tup_li°íög_sockë
(
£rvî_p‹t
);

440 
	`¥ötf
("Pª-MT sîvîÜi°íög o¿p‹à%d\n", 
£rvî_p‹t
);

442 
i
 = 0; i < 
THREADS_COUNT
; ++i) {

443 
	`¸óã_thªad
(
i
);

447 
	`∑u£
();

448 
	}
}

	@Training/L1_sysprg_trg/net_sockets/unix_domain/unet.h

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~<sys/ty≥s.h
>

9 
	~<sys/sockë.h
>

10 
	~<sys/un.h
>

11 
	~<sig«l.h
>

12 
	~<sys/waô.h
>

13 
	~<î∫o.h
>

15 
	#SOCKET_NAME
 "/run/sock«me.sk"

	)

	@Training/L1_sysprg_trg/net_sockets/unix_domain/unix_cli.c

7 
	~"u√t.h
"

9 
	$maö
(
¨gc
, **
¨gv
)

11 
sd
;

12 
ssize_t
 
n
;

13 
buf
[80];

14 
sockaddr_un
 
˛i_addr
;

16 i‡(
	`gëeuid
(Ë!0 || 
	`gëuid
() != 0) {

17 
	`Ârötf
(
°dîr
, "%s:Ñequúe†roŸ (tÿ¸óã sock fûêundî /run).\n", 
¨gv
[0]);

18 
	`exô
 (1);

22 i‡((
sd
 = 
	`sockë
(
PF_UNIX
, 
SOCK_STREAM
, 0)) == -1)

23 
	`≥º‹
("sockëÉº‹"), 
	`exô
(1);

26 
˛i_addr
.
sun_Ámûy
 = 
PF_UNIX
;

27 
	`°∫˝y
(
˛i_addr
.
sun_∑th
, 
SOCKET_NAME
, (cli_addr.sun_path) - 1);

28 i‡(
	`c⁄√˘
(
sd
, (
sockaddr
 *)&
˛i_addr
, (cli_addr)) == -1)

29 
	`≥º‹
("sockë c⁄√˘Éº‹"), 
	`exô
(1);

32 i‡((
n
 = 
	`ªad
(
sd
, 
buf
, (buf))) == -1)

33 
	`≥º‹
("sockëÑódÉº‹"), 
	`exô
(1);

34 
buf
[
n
] = '\0';

36 
	`¥ötf
("Clõ¡:Ñód \"%s\"\n", 
buf
);

37 
	`˛o£
(
sd
);

38 
	`exô
(0);

39 
	}
}

	@Training/L1_sysprg_trg/net_sockets/unix_domain/unix_svr.c

6 
	~"u√t.h
"

9 
	$sig_chûd
(
signum
)

12 
°©us
;

13 
	`waô3
(&
°©us
, 
WNOHANG
, 0) > 0) ;

15 
	`¥ötf
("%s(): usög SA_NOCLDWAIT...\n", 
__func__
);

17 
	}
}

19 
	$maö
(
¨gc
, *
¨gv
[])

21 
sd
, 
ns
;

22 
sockÀn_t
 
‰omÀn
;

23 
sockaddr_un
 
svr_addr
, 
˛i_addr
;

24 
siga˘i⁄
 
a˘
;

26 i‡(
	`gëeuid
(Ë!0 || 
	`gëuid
() != 0) {

27 
	`Ârötf
(
°dîr
, "%s:Ñequúe†roŸ (tÿ¸óã sock fûêundî /run).\n", 
¨gv
[0]);

28 
	`exô
 (1);

31 
	`u∆ök
(
SOCKET_NAME
);

33 i‡((
sd
 = 
	`sockë
(
AF_UNIX
, 
SOCK_STREAM
, 0)) == -1)

34 
	`≥º‹
("sockë cª©i⁄Éº‹"), 
	`exô
(1);

37 
svr_addr
.
sun_Ámûy
 = 
AF_UNIX
;

38 
	`°∫˝y
(
svr_addr
.
sun_∑th
, 
SOCKET_NAME
, (svr_addr.sun_path) - 1);

39 i‡(
	`böd
(
sd
, (
sockaddr
 *)&
svr_addr
, (
sockaddr_un
))

41 
	`≥º‹
("sockë bödÉº‹"), 
	`exô
(1);

44 i‡(
	`li°í
(
sd
, 1) == -1)

45 
	`≥º‹
("sockëÜi°íÉº‹"), 
	`exô
(1);

47 
a˘
.
ß_h™dÀr
 = 
sig_chûd
;

48 
	`sigem±y£t
(&
a˘
.
ß_mask
);

52 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_NOCLDSTOP
 | 
SA_NOCLDWAIT
;

53 i‡(
	`siga˘i⁄
(
SIGCHLD
, &
a˘
, 0) == -1)

54 
	`≥º‹
("sig«»h™dlögÉº‹"), 
	`exô
(1);

57 
‰omÀn
 = (
sockaddr_un
);

58 
ns
 = 
	`ac˚±
(
sd
, (
sockaddr
 *)&
˛i_addr
, &
‰omÀn
);

59 i‡(
ns
 == -1)

60 
	`≥º‹
("sockëác˚±Éº‹"), 
	`exô
(1);

66 
	`f‹k
()) {

68 
	`≥º‹
("forkÉrror");

69 
	`fÊush
(
°dout
);

73 
	`˛o£
(
sd
);

74 i‡(
	`wrôe
(
ns
, "hello world", 11) == -1)

75 
	`≥º‹
("wrôêîr‹"), 
	`exô
(1);

76 
	`exô
(0);

79 
	`˛o£
(
ns
);

84 
	}
}

	@Training/L1_sysprg_trg/net_sockets/zero_copy_sendfile/restart_lib.h

11 #i‚de‡
__RESTART_LIB__


12 
	#__RESTART_LIB__


	)

14 
	~<î∫o.h
>

15 
	~<f˙é.h
>

16 
	~<limôs.h
>

17 
	~<°rög.h
>

18 
	~<sys/£À˘.h
>

19 
	~<sys/time.h
>

20 
	~<sys/waô.h
>

22 
	#BLKSIZE
 
PIPE_BUF


	)

23 
	#MILLION
 1000000L

	)

24 
	#D_MILLION
 1000000.0

	)

26 
ªadwrôe
(
‰omfd
, 
tofd
);

27 
waôfdtimed
(
fd
, 
timevÆ
 
íd
);

31 
	$gëtimeout
(
timevÆ
 
íd
,

32 
timevÆ
 *
timeouç
) {

33 
	`gëtimeofday
(
timeouç
, 
NULL
);

34 
timeouç
->
tv_£c
 = 
íd
.tv_sec -Åimeoutp->tv_sec;

35 
timeouç
->
tv_u£c
 = 
íd
.tv_usec -Åimeoutp->tv_usec;

36 i‡(
timeouç
->
tv_u£c
 >
MILLION
) {

37 
timeouç
->
tv_£c
++;

38 
timeouç
->
tv_u£c
 -
MILLION
;

40 i‡(
timeouç
->
tv_u£c
 < 0) {

41 
timeouç
->
tv_£c
--;

42 
timeouç
->
tv_u£c
 +
MILLION
;

44 i‡((
timeouç
->
tv_£c
 < 0) ||

45 ((
timeouç
->
tv_£c
 =0Ë&& (timeouç->
tv_u£c
 == 0))) {

46 
î∫o
 = 
ETIME
;

50 
	}
}

54 
	$r_˛o£
(
fûdes
) {

55 
ªtvÆ
;

56 
ªtvÆ
 = 
	`˛o£
(
fûdes
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

57  
ªtvÆ
;

58 
	}
}

60 
	$r_dup2
(
fûdes
, 
fûdes2
) {

61 
ªtvÆ
;

62 
ªtvÆ
 = 
	`dup2
(
fûdes
, 
fûdes2
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

63  
ªtvÆ
;

64 
	}
}

67 
	$r_›í2
(c⁄° *
∑th
, 
oÊag
) {

68 
ªtvÆ
;

69 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

70  
ªtvÆ
;

71 
	}
}

73 
	$r_›í3
(c⁄° *
∑th
, 
oÊag
, 
mode_t
 
mode
) {

74 
ªtvÆ
;

75 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
, 
mode
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

76  
ªtvÆ
;

77 
	}
}

79 
ssize_t
 
	$r_ªad
(
fd
, *
buf
, 
size_t
 
size
) {

80 
ssize_t
 
ªtvÆ
;

81 
ªtvÆ
 = 
	`ªad
(
fd
, 
buf
, 
size
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

82  
ªtvÆ
;

83 
	}
}

85 
pid_t
 
	$r_waô
(*
°©_loc
) {

86 
pid_t
 
ªtvÆ
;

87 ((
ªtvÆ
 = 
	`waô
(
°©_loc
)Ë=-1Ë&& (
î∫o
 =
EINTR
)) ;

88  
ªtvÆ
;

89 
	}
}

91 
pid_t
 
	$r_waôpid
(
pid_t
 
pid
, *
°©_loc
, 
›ti⁄s
) {

92 
pid_t
 
ªtvÆ
;

93 ((
ªtvÆ
 = 
	`waôpid
(
pid
, 
°©_loc
, 
›ti⁄s
)) == -1) &&

94 (
î∫o
 =
EINTR
)) ;

95  
ªtvÆ
;

96 
	}
}

98 
ssize_t
 
	$r_wrôe
(
fd
, *
buf
, 
size_t
 
size
) {

99 *
buÂ
;

100 
size_t
 
byã°owrôe
;

101 
ssize_t
 
byãswrôãn
;

102 
size_t
 
tŸÆbyãs
;

104 
buÂ
 = 
buf
, 
byã°owrôe
 = 
size
, 
tŸÆbyãs
 = 0;

105 
byã°owrôe
 > 0;

106 
buÂ
 +
byãswrôãn
, 
byã°owrôe
 -= byteswritten) {

107 
byãswrôãn
 = 
	`wrôe
(
fd
, 
buÂ
, 
byã°owrôe
);

108 i‡((
byãswrôãn
Ë=-1 && (
î∫o
 !
EINTR
))

110 i‡(
byãswrôãn
 == -1)

111 
byãswrôãn
 = 0;

112 
tŸÆbyãs
 +
byãswrôãn
;

114  
tŸÆbyãs
;

115 
	}
}

119 
timevÆ
 
	$add2cuºíâime
(
£c⁄ds
) {

120 
timevÆ
 
√wtime
;

122 
	`gëtimeofday
(&
√wtime
, 
NULL
);

123 
√wtime
.
tv_£c
 +()
£c⁄ds
;

124 
√wtime
.
tv_u£c
 +()((
£c⁄ds
 - ()£c⁄ds)*
D_MILLION
 + 0.5);

125 i‡(
√wtime
.
tv_u£c
 >
MILLION
) {

126 
√wtime
.
tv_£c
++;

127 
√wtime
.
tv_u£c
 -
MILLION
;

129  
√wtime
;

130 
	}
}

132 
	$c›yfûe
(
‰omfd
, 
tofd
) {

133 
byã§ód
;

134 
tŸÆbyãs
 = 0;

136 (
byã§ód
 = 
	`ªadwrôe
(
‰omfd
, 
tofd
)) > 0)

137 
tŸÆbyãs
 +
byã§ód
;

138  
tŸÆbyãs
;

139 
	}
}

141 
ssize_t
 
	$ªadblock
(
fd
, *
buf
, 
size_t
 
size
) {

142 *
buÂ
;

143 
ssize_t
 
byã§ód
;

144 
size_t
 
byã°‹ód
;

145 
size_t
 
tŸÆbyãs
;

147 
buÂ
 = 
buf
, 
byã°‹ód
 = 
size
, 
tŸÆbyãs
 = 0;

148 
byã°‹ód
 > 0;

149 
buÂ
 +
byã§ód
, 
byã°‹ód
 -= bytesread) {

150 
byã§ód
 = 
	`ªad
(
fd
, 
buÂ
, 
byã°‹ód
);

151 i‡((
byã§ód
 =0Ë&& (
tŸÆbyãs
 == 0))

153 i‡(
byã§ód
 == 0) {

154 
î∫o
 = 
EINVAL
;

157 i‡((
byã§ód
Ë=-1 && (
î∫o
 !
EINTR
))

159 i‡(
byã§ód
 == -1)

160 
byã§ód
 = 0;

161 
tŸÆbyãs
 +
byã§ód
;

163  
tŸÆbyãs
;

164 
	}
}

166 
	$ªadlöe
(
fd
, *
buf
, 
nbyãs
) {

167 
numªad
 = 0;

168 
ªtu∫vÆ
;

170 
numªad
 < 
nbyãs
 - 1) {

171 
ªtu∫vÆ
 = 
	`ªad
(
fd
, 
buf
 + 
numªad
, 1);

172 i‡((
ªtu∫vÆ
 =-1Ë&& (
î∫o
 =
EINTR
))

174 i‡((
ªtu∫vÆ
 =0Ë&& (
numªad
 == 0))

176 i‡(
ªtu∫vÆ
 == 0)

178 i‡(
ªtu∫vÆ
 == -1)

180 
numªad
++;

181 i‡(
buf
[
numªad
-1] == '\n') {

182 
buf
[
numªad
] = '\0';

183  
numªad
;

186 
î∫o
 = 
EINVAL
;

188 
	}
}

190 
ssize_t
 
	$ªadtimed
(
fd
, *
buf
, 
size_t
 
nbyã
, 
£c⁄ds
) {

191 
timevÆ
 
timed⁄e
;

193 
timed⁄e
 = 
	`add2cuºíâime
(
£c⁄ds
);

194 i‡(
	`waôfdtimed
(
fd
, 
timed⁄e
) == -1)

195  (
ssize_t
)(-1);

196  
	`r_ªad
(
fd
, 
buf
, 
nbyã
);

197 
	}
}

199 
	$ªadwrôe
(
‰omfd
, 
tofd
) {

200 
buf
[
BLKSIZE
];

201 
byã§ód
;

203 i‡((
byã§ód
 = 
	`r_ªad
(
‰omfd
, 
buf
, 
BLKSIZE
)) < 0)

205 i‡(
byã§ód
 == 0)

207 i‡(
	`r_wrôe
(
tofd
, 
buf
, 
byã§ód
) < 0)

209  
byã§ód
;

210 
	}
}

212 
	$ªadwrôeblock
(
‰omfd
, 
tofd
, *
buf
, 
size
) {

213 
byã§ód
;

215 
byã§ód
 = 
	`ªadblock
(
‰omfd
, 
buf
, 
size
);

216 i‡(
byã§ód
 !
size
)

217  
byã§ód
;

218  
	`r_wrôe
(
tofd
, 
buf
, 
size
);

219 
	}
}

221 
	$waôfdtimed
(
fd
, 
timevÆ
 
íd
) {

222 
fd_£t
 
ªad£t
;

223 
ªtvÆ
;

224 
timevÆ
 
timeout
;

226 i‡((
fd
 < 0Ë|| (fd >
FD_SETSIZE
)) {

227 
î∫o
 = 
EINVAL
;

230 
	`FD_ZERO
(&
ªad£t
);

231 
	`FD_SET
(
fd
, &
ªad£t
);

232 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

234 ((
ªtvÆ
 = 
	`£À˘
(
fd
+1, &
ªad£t
, 
NULL
, NULL, &
timeout
)) == -1)

235 && (
î∫o
 =
EINTR
)) {

236 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

238 
	`FD_ZERO
(&
ªad£t
);

239 
	`FD_SET
(
fd
, &
ªad£t
);

241 i‡(
ªtvÆ
 == 0) {

242 
î∫o
 = 
ETIME
;

245 i‡(
ªtvÆ
 == -1)

248 
	}
}

	@Training/L1_sysprg_trg/net_sockets/zero_copy_sendfile/xfer_file.c

25 
	~<°dio.h
>

26 
	~<°rög.h
>

27 
	~<°dlib.h
>

28 
	~<uni°d.h
>

29 
	~<sys/ty≥s.h
>

30 
	~<sys/sockë.h
>

31 
	~<√töë/ö.h
>

32 
	~<¨∑/öë.h
>

33 
	~<sig«l.h
>

34 
	~<sys/waô.h
>

35 
	~<löux/limôs.h
>

36 
	~<î∫o.h
>

37 
	~<pwd.h
>

38 
	~<sys/ty≥s.h
>

39 
	~<sys/°©.h
>

40 
	~<sys/£ndfûe.h
>

41 
	~"ª°¨t_lib.h
"

44 
	#SERV_IP
 "127.0.0.1"

	)

45 
	#SERV_PORT
 7100

	)

46 
	#DESTFILE
 "./de°fûe.d©"

	)

47 
	#TRADITIONAL
 1

	)

48 
	#MODERN
 2

	)

50 
	#VP
(
°r
, 
¨gs
...) \

52 i‡(
vîbo£
) \

53 
	`¥ötf
(
°r
, ##
¨gs
); \

54 } 0)

	)

56 
	gvîbo£
=0;

59 
	$sig_chûd
(
signum
)

61 
°©us
;

62 
pid
;

64  (
pid
=
	`waô3
–&
°©us
, 
WNOHANG
, 0 )) > 0 ) {

65 
	`VP
("∑ª¡ sîvî i¿SIGCHLD h™dÀr;Öid=%d\n",
pid
);

67 
	}
}

69 
ölöe
 
	$îr_exô
(*
¥g
, * 
îr
, 
exôcode
)

71 
îr_°r
[512];

73 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

74 
	`≥º‹
(
îr_°r
);

75 
	`exô
(
exôcode
);

76 
	}
}

79 
	$¥o˚ss_˛õ¡
(
sd
, 
howto
, *
¥g
)

81 *
fûe2£nd
=
NULL
;

82 
°©
 
sb
;

83 
fd_£nd
, 
n
=0, 
t£¡
=0;

85 
fûe2£nd
 = (*)
	`mÆloc
(
PATH_MAX
);

86 if–!
fûe2£nd
 ) {

87 
	`¥ötf
("\n%s:Çÿmem‹y f‹ u£∫amêbuf„r", 
¥g
 );

88 
	`exô
( 1 );

92 if((
n
=
	`ªad
 (
sd
, 
fûe2£nd
, 
PATH_MAX
)) == -1) {

93 
	`‰ì
(
fûe2£nd
);

94 
	`îr_exô
–
¥g
, "svr: socketÑeadÉrror", 1);

96 
fûe2£nd
[
n
]='\0';

98 
	`VP
("svr:Åÿ£nd fûê\"%s\"Åÿ˛õ¡...\n", 
fûe2£nd
);

99 i‡((
fd_£nd
 = 
	`r_›í2
(
fûe2£nd
, 
O_RDONLY
)) == -1) {

100 
	`‰ì
(
fûe2£nd
);

101 
	`îr_exô
(
¥g
, "svr: file openÉrror", 1);

104 i‡(
howto
 =
MODERN
) {

105 
	`VP
("svr: using MODERN sendfile(2)ápproach...\n");

106 i‡(
	`f°©
 (
fd_£nd
, &
sb
) < 0) {

107 
	`‰ì
(
fûe2£nd
);

108 
	`îr_exô
(
¥g
, "svr: fstatÉrror", 1);

111 
t£¡
 = 
	`£ndfûe
 (
sd
, 
fd_£nd
, 
NULL
, 
sb
.
°_size
);

112 i‡(
t£¡
 < 0) {

113 
	`‰ì
(
fûe2£nd
);

114 
	`îr_exô
(
¥g
, "svr: sendfileÉrror", 1);

116 } i‡(
howto
 =
TRADITIONAL
) {

117 
	`VP
("svr: using TRADITIONALÑead/writeÜoopápproach...\n");

120 
ƒ
;

121 
rbuf
[
	`gë∑gesize
()];

123 
ƒ
 = 
	`r_ªad
(
fd_£nd
, 
rbuf
, (rbuf));

124 i‡(0 =
ƒ
)

126 i‡(
ƒ
 < 0)

127 
	`îr_exô
–
¥g
, "svr:ÑeadÉrror", 1);

129 i‡(
	`r_wrôe
 (
sd
, 
rbuf
, 
ƒ
) <= 0)

130 
	`îr_exô
–
¥g
, "svr: writeÉrror", 1);

131 
t£¡
 +
ƒ
;

134 
	`VP
("svr: # byã†£¡ : %16d\n", 
t£¡
);

136 
	`‰ì
(
fûe2£nd
);

137 
	`r_˛o£
(
fd_£nd
);

138 
	`r_˛o£
(
sd
);

141 
	}
}

144 
ölöe
 
	$ußge
(*
«me
)

146 
	`Ârötf
(
°dîr
, "\
:\n\
%s -s -{t|m} [-v] <---ás server\n\
-OR-\n\
%s file-to-send [-v] <---ás client\n\
\n\
-s :ÑunÅheÖrogramásÅhe server\n\
-t : useÅhe _t_raditional 'loop overÑead/write syscalls'ápproach\n\
-m : useÅhe _m_odern 'single sendfile(2) syscall'ápproach\n\
 '-s'ÇotÖresent, it implies it'sÅhe clientánd you mustÖassá validÖathnameás fileÅo 'GET' fromÅhe server.\n",

156 
«me
,Çame);

157 
	}
}

159 
	$maö
(
¨gc
, *
¨gv
[])

161 
is_£rvî
=0, 
how
=0, 
sd
, 
√wsd
;

162 
sockÀn_t
 
˛ûí
;

163 
sockaddr_ö
 
svr_addr
, 
˛i_addr
;

164 
siga˘i⁄
 
a˘
;

167 i‡(
¨gc
 < 2) {

168 
	`ußge
(
¨gv
[0]);

169 
	`exô
 (1);

171 i‡(
¨gv
[1][0] == '-' &&árgv[1][1] == 's') {

172 
is_£rvî
=1;

173 i‡(
¨gc
 < 3) {

174 
	`ußge
(
¨gv
[0]);

175 
	`exô
 (1);

177 i‡(
¨gv
[2][0] == '-' &&árgv[2][1] == 't') {

178 
how
 = 
TRADITIONAL
;

179 
	`VP
("svr: will use TRADITIONAL (multiple)Ñead/writeÜoopápproach.\n");

180 } i‡(
¨gv
[2][0] == '-' &&árgv[2][1] == 'm') {

181 
how
 = 
MODERN
;

182 
	`VP
("svr: will use MODERN (single) sendfile(2)ápproach.\n");

185 
	`ußge
(
¨gv
[0]);

186 
	`exô
 (1);

188 if((
¨gc
>3Ë&& (
	`°rcmp
(
¨gv
[3],"-v")==0))

189 
vîbo£
=1;

192 if((
¨gc
>2Ë&& (
	`°rcmp
(
¨gv
[2],"-v")==0))

193 
vîbo£
=1;

197 if–(
sd
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1 )

198 
	`îr_exô
–
¨gv
[0], "socket creationÉrror", 1 );

199 
	`VP
("%s:Å˝ sockë cª©ed\n",
¨gv
[0]);

203 
svr_addr
.
sö_Ámûy
 = 
AF_INET
;

204 
svr_addr
.
sö_addr
.
s_addr
 = 
	`öë_addr
(
SERV_IP
);

205 
svr_addr
.
sö_p‹t
 = 
	`ht⁄s
(
SERV_PORT
);

207 i‡(
is_£rvî
) {

209 
yes
=1;

210 i‡(
	`£tsock›t
(
sd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
yes
,

212 
	`îr_exô
(
¨gv
[0], "setsockopt", 1);

215 if–
	`böd
(
sd
, (
sockaddr
 *)&
svr_addr
,\

216 (
svr_addr
) ) == -1 )

217 
	`îr_exô
–
¨gv
[0], "svr: socket bindÉrror", 1);

218 
	`VP
("%s: böd d⁄ê© IP %†p‹à%d\n",
¨gv
[0],
SERV_IP
, 
SERV_PORT
);

220 if–
	`li°í
(
sd
, 1) == -1 )

221 
	`îr_exô
–
¨gv
[0], "svr: socketÜistenÉrror", 1);

222 
	`VP
("%s:Üi°í q së up\n",
¨gv
[0]);

224 
a˘
.
ß_h™dÀr
=
sig_chûd
;

225 
	`sigem±y£t
(&
a˘
.
ß_mask
);

229 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_NOCLDSTOP
 | 
SA_NOCLDWAIT
;

230 if–
	`siga˘i⁄
–
SIGCHLD
, &
a˘
, 0 ) == -1 )

231 
	`îr_exô
–
¨gv
[0], "svr: sigactionÉrror", 1);

232 
	`VP
("%s: SIGCHLD h™dÀ∏£àup\n",
¨gv
[0]);

235 
	`VP
("%s:Öid %d blockög o¿ac˚±()..\n", 
¨gv
[0],
	`gëpid
() );

237 
˛ûí
 = –
˛i_addr
 );

238 if–(
√wsd
 = 
	`ac˚±
(
sd
, (
sockaddr
 *)&
˛i_addr
,\

239 &
˛ûí
)) == -1 )

240 
	`îr_exô
–
¨gv
[0], "svr: socketácceptÉrror", 1);

242 
	`VP
 ("\nSîvî %s: clõ¡ c⁄√˘edÇow from IP %†\
 # %d\n", 
¨gv
[0], 
	`öë_¡ﬂ
(
˛i_addr
.
sö_addr
), 
	`¡ohs
(˛i_addr.
sö_p‹t
));

245 
	`¥o˚ss_˛õ¡
(
√wsd
, 
how
, 
¨gv
[0]);

248 
fd_de°
, 
åecv
=0;

251 
svr_addr
.
sö_Ámûy
 = 
AF_INET
;

252 
svr_addr
.
sö_addr
.
s_addr
 = 
	`öë_addr
(
SERV_IP
);

253 
svr_addr
.
sö_p‹t
 = 
	`ht⁄s
(
SERV_PORT
);

256 if–(
	`c⁄√˘
(
sd
, (
sockaddr
 *)&
svr_addr
, (svr_addr))) == -1 )

257 
	`îr_exô
–
¨gv
[0], "cli: connectionÉrror", 1);

260 i‡(
	`r_wrôe
 (
sd
, 
¨gv
[1], 
	`°æí
(argv[1])) < 0)

261 
	`îr_exô
–
¨gv
[0], "cli: writeÉrror", 1);

264 i‡((
fd_de°
 = 
	`r_›í3
(
DESTFILE
, 
O_WRONLY
|
O_TRUNC
|
O_CREAT
, 0644)) == -1) {

265 
	`îr_exô
(
¨gv
[0], "cli: dest file openÉrror", 1);

269 
ƒ
;

270 
rbuf
[
	`gë∑gesize
()];

272 
ƒ
 = 
	`r_ªad
(
sd
, 
rbuf
, (rbuf));

273 i‡(0 =
ƒ
)

275 i‡(
ƒ
 < 0)

276 
	`îr_exô
–
¨gv
[0], "cli:ÑeadÉrror", 1);

278 i‡(
	`r_wrôe
 (
fd_de°
, 
rbuf
, 
ƒ
) <= 0)

279 
	`îr_exô
–
¨gv
[0], "cli: writeÉrror", 1);

280 
åecv
 +
ƒ
;

282 
	`r_˛o£
(
fd_de°
);

283 
	`VP
("˛i: # byã†ª˚ived: %16d\n", 
åecv
);

286 
	`r_˛o£
(
sd
);

288 
	}
}

	@Training/L1_sysprg_trg/pthreads/0_Makefile_template_pthreads/cr8ManyThrds/cr8ManyThrds.c

6 
	#_POSIX_C_SOURCE
 200112L

	)

8 
	~<±hªad.h
>

9 
	~<°dio.h
>

10 
	~<°dlib.h
>

11 
	~<uni°d.h
>

13 
	#MAX_THREADS
 50000

14 
	tu32
;

	)

15 
	tu64
;

17 
	ggbuf
[100];

19 *
	$PrötStuff
(*
thªadnum
)

21 
	`¥ötf
("Thªad %05ld\n", ()
thªadnum
);

22 
	`∑u£
();

23 
	`±hªad_exô
(
NULL
);

24 
	}
}

26 
	$maö
(
¨gc
, **
¨gv
)

28 
±hªad_t
 *
thªads
;

29 
numthrds
;

30 
t
;

32 i‡(
¨gc
 != 2) {

33 
	`¥ötf
("Ußge: %†num-thªads-to-¸óã\n", 
¨gv
[0]);

34 
	`exô
(1);

36 
numthrds
 = 
	`©oi
(
¨gv
[1]);

37 i‡((
numthrds
 <0Ë|| (numthrd†> 
MAX_THREADS
)) {

38 
	`¥ötf
("%s:Çum-thªad†övÆid\n", 
¨gv
[0]);

39 
	`exô
(1);

42 
thªads
 = 
	`mÆloc
((
±hªad_t
Ë* 
numthrds
);

43 i‡(!
thªads
) {

44 
	`¥ötf
("%s: ouào‡mem‹y!\n", 
¨gv
[0]);

45 
	`exô
(1);

48 
t
 = 0;Å < 
numthrds
;Å++) {

49 
rc
;

50 
rc
 = 
	`±hªad_¸óã
(&
thªads
[
t
], 
NULL
, 
PrötStuff
, (*)t);

51 i‡(
rc
) {

52 
¥ötf


54 
¨gv
[0], 
t
, 
rc
);

55 
	`≥º‹
("pthread_create failed");

56 
	`exô
(1);

59 
	`∑u£
();

60 
	`‰ì
(
thªads
);

61 
	`±hªad_exô
(
NULL
);

62 
	}
}

	@Training/L1_sysprg_trg/pthreads/assgn_robbins/prg12.9.c

5 
	~<±hªad.h
>

6 
	~<°dio.h
>

7 
	~<°rög.h
>

8 
	#NUMTHREADS
 10

	)

10 *
	$¥öèrg
(*
¨g
) {

11 
	`Ârötf
(
°dîr
, "ThªadÑe˚ived %d\n", *(*)
¨g
);

12  
NULL
;

13 
	}
}

15 
	$maö
 () {

16 
îr‹
;

17 
i
;

18 
j
;

19 
±hªad_t
 
tid
[
NUMTHREADS
];

21 
i
 = 0; i < 
NUMTHREADS
; i++)

22 i‡((
îr‹
 = 
	`±hªad_¸óã
(
tid
 + 
i
, 
NULL
, 
¥öèrg
, (*)&i))) {

23 
	`Ârötf
(
°dîr
, "FaûedÅÿ¸óãÅhªad: %s\n", 
	`°ªº‹
(
îr‹
));

24 
tid
[
i
] = 
	`±hªad_£lf
();

26 
j
 = 0; j < 
NUMTHREADS
; j++)

27 i‡(
	`±hªad_equÆ
(
	`±hªad_£lf
(), 
tid
[
j
]))

29 i‡((
îr‹
 = 
	`±hªad_joö
(
tid
[
j
], 
NULL
)))

30 
	`Ârötf
(
°dîr
, "FaûedÅÿjoöÅhªad: %s\n", 
	`°ªº‹
(
îr‹
));

31 
	`¥ötf
("AllÅhreads done\n");

33 
	}
}

	@Training/L1_sysprg_trg/pthreads/assgn_robbins/whichexit.c

2 
	~<î∫o.h
>

3 
	~<±hªad.h
>

4 
	~<°dio.h
>

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

8 *
	$whichexô
(*
¨g
) {

9 
n
;

10 
≈1
[1];

11 *
≈2
;

12 
s1
[10];

13 
s2
[] = "Iám done";

14 
n
 = 3;

15 
≈1
[0] = 
n
;

16 
≈2
 = (*)
	`mÆloc
((*));

17 *
≈2
 = 
n
;

18 
	`°r˝y
(
s1
, "Done");

19 (
NULL
);

20 
	}
}

22 
	$maö
()

24 
±hªad_t
 
tid
;

25 
îr‹
;

27 i‡((
îr‹
 = 
	`±hªad_¸óã
 (&
tid
, 
NULL
, 
whichexô
, 0))) {

28 
	`Ârötf
 (
°dîr
, "FaûedÅÿ¸óãÅhªad: %s\n", 
	`°ªº‹
(
îr‹
));

31 
	`±hªad_joö
 (
tid
, 
NULL
);

33 
	}
}

	@Training/L1_sysprg_trg/pthreads/isit_atomic/isit_atomic.c

12 
	~<°dio.h
>

13 
	~<°dlib.h
>

14 
	~<uni°d.h
>

15 
	~<sys/ty≥s.h
>

17 
	gg
=5;

19 
	$maö
 (
¨gc
, **
¨gv
)

21 
loc
=
g
;

22 
	`exô
(0);

23 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/convenient.h

11 #i‚de‡
__CONVENIENT_H__


12 
	#__CONVENIENT_H__


	)

14 
	~<asm/∑øm.h
>

15 
	~<löux/sched.h
>

17 #ifde‡
__KERNEL__


18 
	~<löux/øãlimô.h
>

44 #unde‡
USE_FTRACE_PRINT


46 #ifde‡
USE_FTRACE_PRINT


47 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

48 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

50 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

51 
USE_RATELIMITING
=0; \

53 i‡(
USE_RATELIMITING
) { \

54 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

57 
	`¥ötk
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 } 0)

	)

62 #ifde‡
DEBUG


63 #ifde‡
__KERNEL__


64 
	#MSG
(
°rög
, 
¨gs
...) do { \

65 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

66 } 0)

	)

68 
	#MSG
(
°rög
, 
¨gs
...) do { \

69 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

70 } 0)

	)

73 #ifde‡
__KERNEL__


74 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

75 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

76 } 0)

	)

78 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

79 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

80 } 0)

	)

84 
	#QP
 
	`MSG
("\n")

	)

86 #ifde‡
__KERNEL__


87 
	#QPDS
 do { \

88 
	`MSG
("\n"); \

89 
	`dump_°ack
(); \

90 } 0)

	)

93 #ifde‡
__KERNEL__


94 
	#HexDump
(
‰om_addr
, 
Àn
) \

95 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

98 
	#MSG
(
°rög
, 
¨gs
...)

	)

99 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

100 
	#QP


	)

101 
	#QPDS


	)

125 
	~<löux/sched.h
>

126 
	~<löux/öãºu±.h
>

128 #i‚de‡
USE_FTRACE_PRINT


129 
	#PRINT_CTX
() do { \

130 
£p
='|', 
öå
='.'; \

132 i‡(
	`ö_öãºu±
()) { \

133 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

134 
öå
='H'; \

135 i‡(
	`ö_úq
()) \

136 
öå
='h'; \

137 i‡(
	`ö_so·úq
()) \

138 
öå
='s'; \

141 
öå
='.'; \

143 
	`DBGPRINT
( \

147 , 
	`smp_¥o˚ss‹_id
(), \

148 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

149 (
	`úqs_dißbÀd
()?'d':'.'), \

150 (
	`√ed_ªsched
()?'N':'.'), \

151 
öå
, \

152 (
	`¥ìm±_cou¡
() && 0xff) \

154 } 0)

	)

156 
	#PRINT_CTX
() do { \

157 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

158 i‡(!
	`ö_öãºu±
()) { \

159 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

160 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

162 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

164 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

165 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

167 } 0)

	)

183 #ifde‡
__KERNEL__


184 
	#as£π
(
ex¥
) do { \

185 i‡(!(
ex¥
)) { \

186 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

187 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

189 } 0)

	)

193 
ölöe
 
	$bìp
(
wh©
)

195 #ifde‡
__KERNEL__


196 
	`DBGPRINT
("%c", ()
wh©
);

198 ()
	`¥ötf
("%c", ()
wh©
);

200 
	}
}

207 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

209 
c
=0, 
m
;\

210 
f‹_ödex
,
ö√r_ödex
; \

212 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

213 
	`bìp
((
vÆ
)); \

214 
c
++;\

215 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

216 
m
=0;m<50;m++); \

219 }

	)

222 #ifde‡
__KERNEL__


227 
	#DELAY_SEC
(
vÆ
) \

229 i‡(!
	`ö_öãºu±
()) { \

230 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

231 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

233 }

	)

236 #i‚de‡
__KERNEL__


241 
	~<sys/time.h
>

242 
timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

243 
timevÆ
 *
y
);

247 
__©åibuã__
 ((
unu£d
))

248 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

249 
timevÆ
 *
y
)

252 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

253 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

254 
y
->
tv_u£c
 -1000000 * 
n£c
;

255 
y
->
tv_£c
 +
n£c
;

257 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

258 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

259 
y
->
tv_u£c
 +1000000 * 
n£c
;

260 
y
->
tv_£c
 -
n£c
;

265 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

266 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

269  
x
->
tv_£c
 < 
y
->tv_sec;

270 
	}
}

280 #i‚de‡
_TIME_H


281 
	~<time.h
>

283 
	~<î∫o.h
>

284 
	$r_¶ìp
 (
£c
)

286 
time•ec
 
ªq
, 
ªm
;

288 
ªq
.
tv_£c
 = 
£c
;

289 
ªq
.
tv_n£c
 = 0;

291 
	`«no¶ìp
 (&
ªq
, &
ªm
) == -1) {

292 i‡(
î∫o
 !
EINTR
)

297 #ifde‡
DEBUG


298 
	`Ârötf
 (
°dîr
, "*Çanosleep interrupted!ÑemÅime: %lu.%lu *\n",

299 
ªm
.
tv_£c
,Ñem.
tv_n£c
);

301 
ªq
 = 
ªm
;

304 
	}
}

317 
__©åibuã__
 ((
unu£d
))

318 
	$dec2bö
(
decimÆ
, *
bö¨y
)

320 
k
 = 0, 
n
 = 0;

321 
√g_Êag
 = 0;

322 
ªmaö
;

332 #unde‡
TESTMODE


334 #ifde‡
TESTMODE


335 
ﬁd_decimÆ
;

337 
ãmp
[80];

340 i‡(
decimÆ
 < 0) {

341 
decimÆ
 = -decimal;

342 
√g_Êag
 = 1;

345 #ifde‡
TESTMODE


346 
ﬁd_decimÆ
 = 
decimÆ
;

348 
ªmaö
 = 
decimÆ
 % 2;

350 
decimÆ
 = decimal / 2;

352 #ifde‡
TESTMODE


353 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

354 
ªmaö
);

357 
ãmp
[
k
++] = 
ªmaö
 + '0';

358 } 
decimÆ
 > 0);

360 i‡(
√g_Êag
)

361 
ãmp
[
k
++] = '-';

363 
ãmp
[
k
++] = ' ';

366 
k
 >= 0)

367 
bö¨y
[
n
++] = 
ãmp
[--
k
];

369 
bö¨y
[
n
 - 1] = 0;

370 
	}
}

372 #i‚de‡
__KERNEL__


374 
	#MSG
(
°rög
, 
¨gs
...) do { \

375 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

376 } 0)

	)

378 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

379 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

380 } 0)

	)

382 
	#QP
 
	`MSG
("\n")

	)

385 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

387 i‡(
vîbo£
) \

388 
	`¥ötf
(
°r
, ##
¨gs
); \

389 } 0)

	)

391 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

393 
îr_°r
[512];

395 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

396 
	`≥º‹
(
îr_°r
);

397 
	`exô
(
exôcode
);

398 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/fork_test.c

7 
	~<°dio.h
>

8 
	~<°dlib.h
>

9 
	~<uni°d.h
>

10 
	~<sys/waô.h
>

12 
	#NFORKS
 50000

	)

14 
	$do_nŸhög
()

16 
i
;

17 
i
 = 0;

18 
	}
}

20 
	$maö
()

22 
pid
, 
j
, 
°©us
;

24 
j
 = 0; j < 
NFORKS
; j++) {

27 i‡((
pid
 = 
	`f‹k
()) < 0) {

28 
	`¥ötf
("f‹k faûed wôhÉº‹ code%d\n", 
pid
);

29 
	`exô
(1);

33 i‡(
pid
 == 0) {

34 
	`do_nŸhög
();

35 
	`exô
(0);

40 
	`waôpid
(
pid
, &
°©us
, 0);

43 
	`exô
(0);

44 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/libpk.h

15 
	~<°dio.h
>

16 
	~<uni°d.h
>

17 
	~<°dlib.h
>

18 
	~<asm/∑øm.h
>

20 
ölöe
 
	$bìp
(
wh©
)

22 
buf
[2];

23 
buf
[0]=()(
wh©
);

24 
buf
[1]='\0';

25 
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1 );

26 
	}
}

32 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

34 
c
=0;\

35 
f‹_ödex
,
ö√r_ödex
; \

36 
x
; \

37 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

38 
	`bìp
((
vÆ
)); \

39 
c
++;\

40 
ö√r_ödex
=0;ö√r_ödex<
HZ
*100000;inner_index++) \

41 
x
=(
ö√r_ödex
%2)*((22/7)%3); \

44 }

	)

47 #ifde‡
DEBUG


48 
	#MSG
(
°rög
, 
¨gs
...Ë
	`Ârötf
(
°dîr
, "%s:%†: " såög, 
__FILE__
, 
__FUNCTION__
, ##¨gs)

	)

50 
	#MSG
(
°rög
, 
¨gs
...)

	)

55 
ölöe
 
	$bìp
(
how
, * 
wh©
)

57 if–
how
 )

58 
	`wrôe
(
STDOUT_FILENO
, "\007", 1 );

60 
	`wrôe
(
STDOUT_FILENO
, 
wh©
, 1 );

61 
	}
}

63 
	#DELAY_STEP
 20240/
HZ


	)

64 
	#DELAY_LOOP
(
how
,
vÆ
) \

66 
i
,
k
; \

67 
x
; \

68 
i
=0;i<(
DELAY_STEP
);i++) { \

69 
	`bìp
((
how
), (
vÆ
)); \

70 
k
=0;k<
HZ
*100000;k++) \

71 
x
=(
k
%2)*((22/7)%3); \

73 }

	)

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/matrixmul-dbg.c

5 
	#_POSIX_C_SOURCE
 200112L

	)

7 
	~<±hªad.h
>

8 
	~<°dio.h
>

9 
	~<°dlib.h
>

10 
	~<mÆloc.h
>

11 
	~<uni°d.h
>

12 
	~"c⁄víõ¡.h
"

22 *
	ma
;

23 *
	mb
;

24 
	msum
;

25 
	mve˛í
;

26 } 
	tDOTDATA
;

28 
	tu64
;

32 
	#NUMTHRDS
 4

	)

33 
	#VECLEN
 100

	)

35 
DOTDATA
 
	ggDŸ°r
;

36 
±hªad_t
 
	gˇŒThd
[
NUMTHRDS
];

37 
±hªad_muãx_t
 
	gmuãxsum
;

50 *
	$dŸ¥od
(*
¨g
)

54 
i
, 
°¨t
, 
íd
, 
Àn
 ;

55 
mysum
, *
x
, *
y
;

56 
u64
 
off£t
 = (u64)
¨g
;

61 
	`±hªad_muãx_lock
 (&
muãxsum
);

62 
Àn
 = 
gDŸ°r
.
ve˛í
;

63 
x
 = 
gDŸ°r
.
a
;

64 
y
 = 
gDŸ°r
.
b
;

65 
	`±hªad_muãx_u∆ock
 (&
muãxsum
);

67 
°¨t
 = 
off£t
*
Àn
;

68 
íd
 = 
°¨t
 + 
Àn
;

75 
mysum
 = 0;

76 
i
=
°¨t
; i < 
íd
 ; i++) {

77 
mysum
 +(
x
[
i
] * 
y
[i]);

84 
	`±hªad_muãx_lock
 (&
muãxsum
);

85 
gDŸ°r
.
sum
 +
mysum
;

86 
	`DELAY_LOOP
('0'+
off£t
, 10);

87 
	`±hªad_muãx_u∆ock
 (&
muãxsum
);

89 
	`±hªad_exô
((*) 0);

90 
	}
}

93 * 
	$do_w‹k
(* 
msg
)

95 
	`MSG
("In do_work\n");

96 
	`DELAY_LOOP
('W', 200);

97 
	`±hªad_exô
(
NULL
);

98 
	}
}

111 
	$maö
 (
¨gc
, *
¨gv
[])

113 *
a
, *
b
;

114 
°©us
;

115 
u64
 
i
;

116 
±hªad_©å_t
 
©å
;

119 #ifde‡
_POSIX_THREAD_PROCESS_SHARED


120 
	`¥ötf
("%s: muãxÖro˚ss-sh¨ed i†åue.\n", 
¨gv
[0]);

122 
	`¥ötf
("%s: muãxÖro˚ss-sh¨ed i†Ál£.\n", 
¨gv
[0]);

126 
a
 = (*Ë
	`mÆloc
 (
NUMTHRDS
*
VECLEN
*());

127 
b
 = (*Ë
	`mÆloc
 (
NUMTHRDS
*
VECLEN
*());

129 
i
=0; i < 
VECLEN
*
NUMTHRDS
; i++) {

130 
a
[
i
]=1;

131 
b
[
i
]=
a
[i];

134 
gDŸ°r
.
ve˛í
 = 
VECLEN
;

135 
gDŸ°r
.
a
 =á;

136 
gDŸ°r
.
b
 = b;

137 
gDŸ°r
.
sum
=0;

139 
	`±hªad_muãx_öô
(&
muãxsum
, 
NULL
);

142 
	`±hªad_©å_öô
(&
©å
);

143 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

147 i‡(
	`±hªad_¸óã
–&
√wthrd
, &
©å
, 
do_w‹k
, 
NULL
)) {

148 
	`Ârötf
(
°dîr
, "%s:ÅhreadÇewthrd creation failed,áborting..\n",

149 
¨gv
[0]);

153 
i
=0; i<
NUMTHRDS
; i++) {

159 i‡(
	`±hªad_¸óã
–&
ˇŒThd
[
i
], &
©å
, 
dŸ¥od
, (*)i)) {

160 
	`Ârötf
(
°dîr
,

162 
¨gv
[0], 
i
);

166 
	`±hªad_©å_de°roy
(&
©å
);

169 
i
=0;ò< 
NUMTHRDS
;i++) {

170 
	`±hªad_joö
–
ˇŒThd
[
i
], (**)&
°©us
);

174 
	`¥ötf
 ("\nSum = %‡\n", 
gDŸ°r
.
sum
);

175 
	`‰ì
 (
a
);

176 
	`‰ì
 (
b
);

177 
	`±hªad_muãx_de°roy
(&
muãxsum
);

178 
	`±hªad_exô
(
NULL
);

179 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt1.c

4 
	#_POSIX_C_SOURCE
 200112L

	)

6 
	~<±hªad.h
>

7 
	~<°dio.h
>

8 
	~<°dlib.h
>

9 
	~<uni°d.h
>

11 
	#NUM_THREADS
 5

	)

13 *
	$PrötHñlo
(*
msg
)

15 
	`¥ötf
("%ld: HñlÿW‹ld! (pid=%d)\n", ()
msg
, 
	`gëpid
());

16 
	`±hªad_exô
(
NULL
);

17 
	}
}

19 
	$maö
()

21 
±hªad_t
 
thªads
[
NUM_THREADS
];

22 
rc
;

23 
t
;

25 
t
 = 0;Å < 
NUM_THREADS
;Å++) {

26 
	`¥ötf
("Cª©ögÅhªad %ld\n", 
t
);

27 
rc
 = 
	`±hªad_¸óã
(&
thªads
[
t
], 
NULL
, 
PrötHñlo
, (*)t);

28 i‡(
rc
) {

29 
¥ötf


31 
rc
);

32 
	`exô
(-1);

35 
	`±hªad_exô
(
NULL
);

36 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt2-join.c

2 
	#_POSIX_C_SOURCE
 200112L

	)

4 
	~<±hªad.h
>

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

9 
	#NUM_THREADS
 3

	)

11 *
	$BusyW‹k
(*
n
)

13 
i
;

14 
ªsu…
 = 0.0;

16 
i
 = 0; i < 1000000; i++) {

17 
ªsu…
 =Ñesult + 1;

20 
	`¥ötf
("w‹kî %ld:Ñesu… = %f\n", ()
n
, 
ªsu…
);

21 
	`±hªad_exô
((*)0);

22 
	}
}

24 
	$maö
()

26 
±hªad_t
 
w‹k_thrd
[
NUM_THREADS
];

27 
±hªad_©å_t
 
©å
;

28 
rc
, 
°©us
;

29 
t
;

32 
	`±hªad_©å_öô
(&
©å
);

33 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

35 
	`¥ötf
("NUM_THREADS = %d\n", 
NUM_THREADS
);

36 
t
 = 0;Å < 
NUM_THREADS
;Å++) {

37 
	`¥ötf
("Cª©ögÅhªad %ld\n", 
t
);

38 
rc
 = 
	`±hªad_¸óã
(&
w‹k_thrd
[
t
], &
©å
, 
BusyW‹k
, (*)t);

39 i‡(
rc
) {

40 
	`¥ötf
("ERROR;Ñëu∫ codê‰omÖthªad_¸óã(Ëi†%d\n", 
rc
);

41 
	`exô
(
EXIT_FAILURE
);

46 
	`±hªad_©å_de°roy
(&
©å
);

47 
	`¥ötf
("NUM_THREADS = %d\n", 
NUM_THREADS
);

48 
t
 = 0;Å < 
NUM_THREADS
;Å++) {

49 
	`¥ötf
("joöÜo› # %ld\n", 
t
);

51 
rc
 = 
	`±hªad_joö
(
w‹k_thrd
[
t
], (**)&
°©us
);

52 i‡(
rc
) {

53 
	`¥ötf
("ERROR;Ñëu∫ codê‰omÖthªad_joö(Ëi†%d\n", 
rc
);

54 
	`exô
(
EXIT_FAILURE
);

56 
	`¥ötf
("maö: com∂ëed joö wôhÅhªad %ld sètu†%d\n", 
t
, 
°©us
);

60 
	`±hªad_exô
(
NULL
);

61 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt3-matrixmul.c

2 
	#_POSIX_C_SOURCE
 200112L

	)

4 
	~<±hªad.h
>

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<mÆloc.h
>

8 
	~<uni°d.h
>

9 
	~"libpk.h
"

19 *
	ma
;

20 *
	mb
;

21 
	msum
;

22 
	mve˛í
;

23 } 
	tDOTDATA
;

27 
	#NUMTHRDS
 4

	)

28 
	#VECLEN
 100

	)

30 
DOTDATA
 
	gdŸ°r
;

31 
±hªad_t
 
	gˇŒThd
[
NUMTHRDS
];

32 
±hªad_muãx_t
 
	gmuãxsum
;

45 *
	$dŸ¥od
(*
¨g
)

49 
i
, 
°¨t
, 
íd
, 
off£t
, 
Àn
;

50 
mysum
, *
x
, *
y
;

51 
off£t
 = ()
¨g
;

53 
	`MSG
("Thªad T%d\n", 
off£t
);

55 
Àn
 = 
dŸ°r
.
ve˛í
;

56 
°¨t
 = 
off£t
 * 
Àn
;

57 
íd
 = 
°¨t
 + 
Àn
;

58 
x
 = 
dŸ°r
.
a
;

59 
y
 = 
dŸ°r
.
b
;

66 
mysum
 = 0;

67 
i
 = 
°¨t
; i < 
íd
; i++) {

68 
mysum
 +(
x
[
i
] * 
y
[i]);

70 
	`MSG
(" T%d: start %3dÉnd %3d, mysum = %6.2f\n",

71 
off£t
, 
°¨t
, 
íd
, 
mysum
);

76 
	`±hªad_muãx_lock
(&
muãxsum
);

77 
dŸ°r
.
sum
 +
mysum
;

78 
	`±hªad_muãx_u∆ock
(&
muãxsum
);

80 
	`±hªad_exô
((*)0);

81 
	}
}

93 
	$maö
(
¨gc
, *
¨gv
[])

95 
i
;

96 *
a
, *
b
;

97 
°©us
;

98 
±hªad_©å_t
 
©å
;

101 
a
 = (*)
	`mÆloc
(
NUMTHRDS
 * 
VECLEN
 * ());

102 
b
 = (*)
	`mÆloc
(
NUMTHRDS
 * 
VECLEN
 * ());

104 
i
 = 0; i < 
VECLEN
 * 
NUMTHRDS
; i++) {

105 
a
[
i
] = 1;

106 
b
[
i
] = 
a
[i];

109 
dŸ°r
.
ve˛í
 = 
VECLEN
;

110 
dŸ°r
.
a
 =á;

111 
dŸ°r
.
b
 = b;

112 
dŸ°r
.
sum
 = 0;

114 
	`±hªad_muãx_öô
(&
muãxsum
, 
NULL
);

117 
	`±hªad_©å_öô
(&
©å
);

118 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

120 
i
 = 0; i < 
NUMTHRDS
; i++) {

126 i‡(
	`±hªad_¸óã
(&
ˇŒThd
[
i
], &
©å
, 
dŸ¥od
, (*)i)) {

127 
	`Ârötf
(
°dîr
,

129 
¨gv
[0], 
i
);

133 
	`±hªad_©å_de°roy
(&
©å
);

136 
i
 = 0; i < 
NUMTHRDS
; i++) {

137 
	`±hªad_joö
(
ˇŒThd
[
i
], (**)&
°©us
);

141 
	`¥ötf
("Sum = %‡\n", 
dŸ°r
.
sum
);

142 
	`‰ì
(
a
);

143 
	`‰ì
(
b
);

144 
	`±hªad_muãx_de°roy
(&
muãxsum
);

145 
	`±hªad_exô
(
NULL
);

146 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt4-condvar.c

2 
	#_POSIX_C_SOURCE
 200112L

	)

4 
	~<±hªad.h
>

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~"libpk.h
"

10 
	#NUM_THREADS
 3

	)

11 
	#TCOUNT
 10

	)

12 
	#COUNT_LIMIT
 12

	)

14 
	gcou¡
 = 0;

15 
	gthªad_ids
[3] = {0,1,2};

16 
±hªad_muãx_t
 
	gcou¡_muãx
;

17 
±hªad_c⁄d_t
 
	gcou¡_thªshﬁd_cv
;

19 *
	$öc_cou¡
(*
idp
)

21 
j
,
i
;

22 
ªsu…
=0.0;

23 *
my_id
 = 
idp
;

25 
i
=0; i < 
TCOUNT
; i++) {

26 
	`±hªad_muãx_lock
(&
cou¡_muãx
);

27 
cou¡
++;

34 i‡(
cou¡
 =
COUNT_LIMIT
) {

35 
	`±hªad_c⁄d_sig«l
(&
cou¡_thªshﬁd_cv
);

36 
	`¥ötf
("öc_cou¡():Åhªad %d, cou¡ = %d \
Ñóched.\n", *
my_id
, 
cou¡
);

39 
	`¥ötf
("inc_count():Åhread %d, count = %d, unlocking mutex\n",

40 *
my_id
, 
cou¡
);

41 
	`±hªad_muãx_u∆ock
(&
cou¡_muãx
);

45 
j
=0; j < 1000; j++) {

46 
ªsu…
 =Ñesu… + ()
	`øndom
();

49 
	`±hªad_exô
(
NULL
);

50 
	}
}

52 *
	$w©ch_cou¡
(*
idp
)

54 *
my_id
 = 
idp
;

56 
	`¥ötf
("Sèπög w©ch_cou¡():Åhªad %d\n", *
my_id
);

66 
	`±hªad_muãx_lock
(&
cou¡_muãx
);

67 
cou¡
 < 
COUNT_LIMIT
) {

68 
	`±hªad_c⁄d_waô
(&
cou¡_thªshﬁd_cv
, &
cou¡_muãx
);

69 
	`¥ötf
("watch_count():Åhread %d Condition signalÑeceived.\n",

70 *
my_id
);

72 
	`±hªad_muãx_u∆ock
(&
cou¡_muãx
);

73 
	`±hªad_exô
(
NULL
);

74 
	}
}

77 
	$maö
(
¨gc
, **
¨gv
)

79 
i
;

80 
±hªad_t
 
thªads
[3];

81 
±hªad_©å_t
 
©å
;

84 
	`±hªad_muãx_öô
(&
cou¡_muãx
, 
NULL
);

85 
	`±hªad_c⁄d_öô
 (&
cou¡_thªshﬁd_cv
, 
NULL
);

91 
	`±hªad_©å_öô
(&
©å
);

92 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

94 
	`±hªad_¸óã
(&
thªads
[0], &
©å
, 
öc_cou¡
, (*)&
thªad_ids
[0]);

95 
	`±hªad_¸óã
(&
thªads
[1], &
©å
, 
öc_cou¡
, (*)&
thªad_ids
[1]);

97 
	`±hªad_¸óã
(&
thªads
[2], &
©å
, 
w©ch_cou¡
, (*)&
thªad_ids
[2]);

100 
i
 = 0; i < 
NUM_THREADS
; i++) {

101 
	`±hªad_joö
(
thªads
[
i
], 
NULL
);

103 
	`¥ötf
 ("Maö(): Waôed o¿%dÅhªads. D⁄e.\n", 
NUM_THREADS
);

106 
	`±hªad_©å_de°roy
(&
©å
);

107 
	`±hªad_muãx_de°roy
(&
cou¡_muãx
);

108 
	`±hªad_c⁄d_de°roy
(&
cou¡_thªshﬁd_cv
);

109 
	`±hªad_exô
(
NULL
);

110 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt4-condvar.orig.c

2 
	#_POSIX_C_SOURCE
 200112L

	)

4 
	~<±hªad.h
>

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~"libpk.h
"

10 
	#NUM_THREADS
 3

	)

11 
	#TCOUNT
 10

	)

12 
	#COUNT_LIMIT
 12

	)

14 
	gcou¡
 = 0;

15 
	gthªad_ids
[3] = {0,1,2};

16 
±hªad_muãx_t
 
	gcou¡_muãx
;

17 
±hªad_c⁄d_t
 
	gcou¡_thªshﬁd_cv
;

19 *
	$öc_cou¡
(*
idp
)

21 
j
,
i
;

22 
ªsu…
=0.0;

23 *
my_id
 = 
idp
;

25 
i
=0; i < 
TCOUNT
; i++) {

26 
	`±hªad_muãx_lock
(&
cou¡_muãx
);

27 
cou¡
++;

34 i‡(
cou¡
 =
COUNT_LIMIT
) {

35 
	`±hªad_c⁄d_sig«l
(&
cou¡_thªshﬁd_cv
);

36 
	`¥ötf
("öc_cou¡():Åhªad %d, cou¡ = %d \
Ñóched.\n", *
my_id
, 
cou¡
);

39 
	`¥ötf
("inc_count():Åhread %d, count = %d, unlocking mutex\n",

40 *
my_id
, 
cou¡
);

41 
	`±hªad_muãx_u∆ock
(&
cou¡_muãx
);

45 
j
=0; j < 1000; j++) {

46 
ªsu…
 =Ñesu… + ()
	`øndom
();

49 
	`±hªad_exô
(
NULL
);

50 
	}
}

52 *
	$w©ch_cou¡
(*
idp
)

54 *
my_id
 = 
idp
;

56 
	`¥ötf
("Sèπög w©ch_cou¡():Åhªad %d\n", *
my_id
);

65 
	`±hªad_muãx_lock
(&
cou¡_muãx
);

66 
cou¡
 < 
COUNT_LIMIT
) {

67 
	`±hªad_c⁄d_waô
(&
cou¡_thªshﬁd_cv
, &
cou¡_muãx
);

68 
	`¥ötf
("watch_count():Åhread %d Condition signal

69 
ª˚ived
.\
n
", *my_id);

71 
	`±hªad_muãx_u∆ock
(&
cou¡_muãx
);

72 
	`±hªad_exô
(
NULL
);

73 
	}
}

76 
	$maö
(
¨gc
, **
¨gv
)

78 
i
, 
rc
;

79 
±hªad_t
 
thªads
[3];

80 
±hªad_©å_t
 
©å
;

83 
	`±hªad_muãx_öô
(&
cou¡_muãx
, 
NULL
);

84 
	`±hªad_c⁄d_öô
 (&
cou¡_thªshﬁd_cv
, 
NULL
);

90 
	`±hªad_©å_öô
(&
©å
);

91 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

93 
	`±hªad_¸óã
(&
thªads
[0], &
©å
, 
öc_cou¡
, (*)&
thªad_ids
[0]);

94 
	`±hªad_¸óã
(&
thªads
[1], &
©å
, 
öc_cou¡
, (*)&
thªad_ids
[1]);

96 
	`±hªad_¸óã
(&
thªads
[2], &
©å
, 
w©ch_cou¡
, (*)&
thªad_ids
[2]);

99 
i
 = 0; i < 
NUM_THREADS
; i++) {

100 
	`±hªad_joö
(
thªads
[
i
], 
NULL
);

102 
	`¥ötf
 ("Maö(): Waôed o¿%dÅhªads. D⁄e.\n", 
NUM_THREADS
);

105 
	`±hªad_©å_de°roy
(&
©å
);

106 
	`±hªad_muãx_de°roy
(&
cou¡_muãx
);

107 
	`±hªad_c⁄d_de°roy
(&
cou¡_thªshﬁd_cv
);

108 
	`±hªad_exô
(
NULL
);

110 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pthread_test.c

7 
	#_POSIX_C_SOURCE
 200112L

	)

9 
	~<±hªad.h
>

10 
	~<°dio.h
>

11 
	~<°dlib.h
>

12 
	~<uni°d.h
>

14 
	#NTHREADS
 50000

	)

16 *
	$do_nŸhög
(*
nuŒ
)

18 
i
;

19 
i
 = 0;

21 
	`±hªad_exô
(
NULL
);

22 
	}
}

24 
	$maö
()

26 
rc
, 
j
;

27 
±hªad_t
 
tid
;

28 
±hªad_©å_t
 
©å
;

30 
	`±hªad_©å_öô
(&
©å
);

31 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

33 
j
 = 0; j < 
NTHREADS
; j++) {

34 
rc
 = 
	`±hªad_¸óã
(&
tid
, &
©å
, 
do_nŸhög
, 
NULL
);

35 i‡(
rc
) {

36 
¥ötf


38 
rc
);

39 
	`exô
(1);

43 
rc
 = 
	`±hªad_joö
(
tid
, 
NULL
);

44 i‡(
rc
) {

45 
	`¥ötf
("ERROR;Ñeturn code fromÖthread_join() is %d\n",

46 
rc
);

47 
	`exô
(1);

51 
	`±hªad_©å_de°roy
(&
©å
);

52 
	`±hªad_exô
(
NULL
);

53 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/stacksz.c

11 
	#_POSIX_C_SOURCE
 200112L

	)

13 
	~<±hªad.h
>

14 
	~<°dio.h
>

15 
	~<°dlib.h
>

16 
	~<uni°d.h
>

17 
	~"c⁄víõ¡.h
"

20 
	#NTHREADS
 2

	)

21 
	tu64
;

23 
	gN
 = 100;

24 
±hªad_©å_t
 
	g©å
;

26 
	$foo
(
a
, 
b
)

28 
QP
;

29 
	}
}

31 *
	$dow‹k
(*
èg
)

33 
¨r
[
N
][N];

34 
i
, 
j
;

35 
thrd
 = ()
èg
;

41 
QP
;

42 
	`¥ötf
("\nInÅhread #%ld:\nsizeof(double) = %ld; so stack mem = %ld\n",

43 
thrd
, (), ()*
N
*N);

44 
	`foo
(1, 2);

49 
i
 = 0; i < 
N
; i++)

50 
j
 = 0; j < 
N
; j++)

51 
¨r
[
i
][
j
] = ((ò* jË/ 3.452Ë+ (
N
 - i);

53 
	`±hªad_exô
(
NULL
);

54 
	}
}

56 
	$maö
(
¨gc
, **
¨gv
)

58 
rc
;

59 
j
;

60 
±hªad_t
 
tid
;

61 
size_t
 
°acksize
 = 0;

63 i‡(
¨gc
 != 2) {

64 
	`Ârötf
(
°dîr
, "Ußge: %†°acksize_ö_KB\n", 
¨gv
[0]);

65 
	`exô
(1);

68 
	`±hªad_©å_öô
(&
©å
);

69 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

70 
	`±hªad_©å_gë°acksize
(&
©å
, &
°acksize
);

71 
	`MSG
("platform default stacksize = %zu (=%zu Kb =%zu Mb), setting stackszÅo %d Kb\n",

72 
°acksize
, stacksize/1024, stacksize/(1024*1024),

73 
	`©oi
(
¨gv
[1]));

76 
°acksize
 = 
	`©oi
(
¨gv
[1]) * 1024;

78 i‡(
	`±hªad_©å_£t°acksize
(&
©å
, 
°acksize
)) {

79 
	`MSG
("±hªad_©å_£t°acksizê(%lu byãsËÁûed!\n", 
°acksize
);

81 
	`exô
(1);

85 
j
 = 0; j < 
NTHREADS
; j++) {

86 
rc
 = 
	`±hªad_¸óã
(&
tid
, &
©å
, 
dow‹k
, (*)
j
);

87 i‡(
rc
) {

88 
¥ötf


90 
rc
);

91 
	`exô
(1);

95 
rc
 = 
	`±hªad_joö
(
tid
, 
NULL
);

96 i‡(
rc
) {

97 
	`¥ötf
("ERROR;Ñeturn code fromÖthread_join() is %d\n",

98 
rc
);

99 
	`exô
(1);

103 
	`±hªad_©å_de°roy
(&
©å
);

104 
	`±hªad_exô
(
NULL
);

105 
	}
}

	@Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/stacksz_old.c

6 
	~<±hªad.h
>

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<°dlib.h
>

11 
	#NTHREADS
 4

	)

12 
	gN
=1000;

14 
±hªad_©å_t
 
	g©å
;

16 *
	$dow‹k
(*
thªadid
)

18 
A
[
N
][N];

19 
i
,
j
;

20 
tid
;

21 
size_t
 
my°acksize
;

22 
±hªad_©å_t
 
loˇâr
;

24 
tid
 = ()
thªadid
;

27 
	`±hªad_©å_gë°acksize
 (&
loˇâr
, &
my°acksize
);

28 
	`¥ötf
("Thªad %ld: sèck sizê%d byã†\n", 
tid
, 
my°acksize
);

30 
i
=0; i<
N
; i++)

31 
j
=0; j<
N
; j++)

32 
A
[
i
][
j
] = ((i*j)/3.452Ë+ (
N
-i);

34 
	`±hªad_exô
(
NULL
);

35 
	}
}

37 
	$maö
(
¨gc
, *
¨gv
[])

39 
±hªad_t
 
thªads
[
NTHREADS
];

40 
size_t
 
°acksize
;

41 
rc
;

42 
t
;

43 * 
°ackaddr
 = 
	`mÆloc
(());

45 
	`±hªad_©å_öô
(&
©å
);

46 
	`±hªad_©å_gë°acksize
 (&
©å
, &
°acksize
);

51 
°acksize
 = 1*1024*1024;

53 
N
=100;

55 
N
=1000;

57 
	`¥ötf
("Amou¡ o‡°ackÇìdedÖîÅhªad = %d\n",
°acksize
);

60 
	`±hªad_©å_£t°acksize
 (&
©å
, 
°acksize
);

62 
	`¥ötf
("Cª©ögÅhªad†wôh sèck sizê%d byãs\n",
°acksize
);

64 
t
=0;Å<
NTHREADS
;Å++){

66 
rc
 = 
	`±hªad_¸óã
(&
thªads
[
t
], 
NULL
 , 
dow‹k
, (*)&
©å
);

67 i‡(
rc
){

68 
	`¥ötf
("ERROR;Ñëu∫ codê‰omÖthªad_¸óã(Ëi†%d\n", 
rc
);

69 
	`exô
(-1);

72 
	`¥ötf
("Cª©ed %ldÅhªads.\n", 
t
);

73 
	`∑u£
();

74 
	`±hªad_exô
(
NULL
);

75 
	}
}

	@Training/L1_sysprg_trg/pthreads/main_dies/main_dies.c

6 
	#_POSIX_C_SOURCE
 200112L

	)

7 
	~<±hªad.h
>

8 
	~<°dio.h
>

9 
	~<°dlib.h
>

10 
	~<uni°d.h
>

12 
	#NUM_THREADS
 5

	)

14 *
	$PrötHñlo
(*
thªadid
)

16 
	`¥ötf
("Thªad %ld: Hñlo, w‹ld.\n", ()
thªadid
);

17 
	`∑u£
();

18 
	`±hªad_exô
(
NULL
);

19 
	}
}

21 
	$maö
()

23 
±hªad_t
 
thªads
[
NUM_THREADS
];

24 
t
;

26 
t
 = 0;Å < 
NUM_THREADS
;Å++) {

27 
rc
;

29 
	`¥ötf
("maö: Cª©ögÅhªad %ld\n", 
t
);

30 
rc
 = 
	`±hªad_¸óã
(&
thªads
[
t
], 
NULL
, 
PrötHñlo
, (*)t);

31 i‡(
rc
) {

32 
¥ötf


34 
rc
);

35 
	`exô
(-1);

38 
	`¶ìp
(10);

39 
	`¥ötf
("main:ÇowÉxiting withÖthread_exit...\n");

40 
	`±hªad_exô
(
NULL
);

43 
	}
}

	@Training/L1_sysprg_trg/pthreads/main_dies/worker_dies.c

5 
	#_POSIX_C_SOURCE
 200112L

	)

7 
	~<±hªad.h
>

8 
	~<°dio.h
>

9 
	~<°dlib.h
>

10 
	~<uni°d.h
>

12 
	#NUM_THREADS
 3

	)

14 
ölöe
 
	$bìp
(
wh©
)

16 
buf
[2];

17 
buf
[0] = ()(
wh©
);

18 
buf
[1] = '\0';

19 
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1);

20 
	}
}

26 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

28 
c
=0;\

29 
f‹_ödex
,
ö√r_ödex
; \

30 
x
; \

31 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

32 
	`bìp
((
vÆ
)); \

33 
c
++;\

34 
ö√r_ödex
=0;inner_index<10000000;inner_index++) \

35 
x
=(
ö√r_ödex
%2)*((22/7)%3); \

38 }

	)

40 *
	$PrötHñlo
(*
thªadid
)

42 
t
 = ()
thªadid
;

44 
	`¥ötf
("Thªad %ld\n", 
t
);

45 
t
) {

52 
	`¶ìp
(10);

53 
	`¥ötf
("Thªad %ldÉxôög..\n", 
t
);

56 
	`¶ìp
(3);

57 
	`¥ötf
("Thªad %ldÉxôög..\n", 
t
);

60 
	`¶ìp
(5);

61 
	`¥ötf
("Thªad %ldÉxôög..\n", 
t
);

64 
	`±hªad_exô
(
NULL
);

65 
	}
}

67 
	$maö
()

69 
±hªad_t
 
thªads
[
NUM_THREADS
];

70 
±hªad_©å_t
 
©å
;

71 
rc
, 
°©us
;

72 
t
;

75 
	`±hªad_©å_öô
(&
©å
);

76 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

78 
t
 = 0;Å < 
NUM_THREADS
;Å++) {

79 
	`¥ötf
("maö: Cª©ögÅhªad %ld\n", 
t
);

80 
rc
 = 
	`±hªad_¸óã
(&
thªads
[
t
], &
©å
, 
PrötHñlo
, (*)t);

81 i‡(
rc
) {

82 
¥ötf


84 
rc
);

85 
	`exô
(-1);

90 
	`±hªad_©å_de°roy
(&
©å
);

91 
t
 = 0;Å < 
NUM_THREADS
;Å++) {

92 
rc
 = 
	`±hªad_joö
(
thªads
[
t
], (**)&
°©us
);

93 i‡(
rc
) {

94 
	`¥ötf
("ERROR;Ñeturn code fromÖthread_join() is %d\n",

95 
rc
);

96 
	`exô
(1);

98 
	`¥ötf
("Com∂ëed joö wôhÅhªad %ld sètus%d\n", 
t
,

99 
°©us
);

101 
	`±hªad_exô
(
NULL
);

102 
	}
}

	@Training/L1_sysprg_trg/pthreads/misc/cr8ManyThrds/buggy_manythrds/cr8ManyThrds.c

6 
	#_POSIX_C_SOURCE
 200112L

	)

8 
	~<±hªad.h
>

9 
	~<°dio.h
>

10 
	~<°dlib.h
>

11 
	~<uni°d.h
>

13 
	#MAX_THREADS
 127000

14 
	tu32
;

	)

15 
	tu64
;

17 
	ggbuf
[100];

19 *
	$PrötStuff
(*
thªadnum
)

21 
	`¥ötf
("Thªad %05ld\n", ()
thªadnum
);

22 
	`∑u£
();

23 
	`±hªad_exô
(
NULL
);

24 
	}
}

26 
	$maö
(
¨gc
, **
¨gv
)

28 
±hªad_t
 
thªads
[5];

29 
numthrds
;

30 
t
;

32 i‡(
¨gc
 != 2) {

33 
	`¥ötf
("Ußge: %†num-thªads-to-¸óã\n", 
¨gv
[0]);

34 
	`exô
(1);

36 
numthrds
 = 
	`©oi
(
¨gv
[1]);

37 i‡((
numthrds
 <0Ë|| (numthrd†> 
MAX_THREADS
)) {

38 
	`¥ötf
("%s:Çum-thªad†övÆid\n", 
¨gv
[0]);

39 
	`exô
(1);

42 
t
 = 0;Å < 
numthrds
;Å++) {

43 
rc
;

44 
rc
 = 
	`±hªad_¸óã
(&
thªads
[
t
], 
NULL
, 
PrötStuff
, (*)t);

45 i‡(
rc
) {

46 
¥ötf


48 
¨gv
[0], 
t
, 
rc
);

49 
	`≥º‹
("pthread_create failed");

50 
	`exô
(1);

53 
	`∑u£
();

54 
	`±hªad_exô
(
NULL
);

55 
	}
}

	@Training/L1_sysprg_trg/pthreads/misc/cr8ManyThrds/cr8ManyThrds.c

13 
	#_POSIX_C_SOURCE
 200112L

	)

15 
	~<±hªad.h
>

16 
	~<°dio.h
>

17 
	~<°dlib.h
>

18 
	~<uni°d.h
>

20 
	#MAX_THREADS
 127000

21 
	tu32
;

	)

22 
	tu64
;

24 
	ggbuf
[100];

26 *
	$PrötStuff
(*
thªadnum
)

28 
	`¥ötf
("Thªad %05ld\n", ()
thªadnum
);

31 
	`∑u£
();

35 
	`±hªad_dëach
(
	`±hªad_£lf
());

37 
	`±hªad_exô
(
NULL
);

38 
	}
}

40 
	$maö
(
¨gc
, **
¨gv
)

42 
±hªad_t
 *
thªads
;

43 
numthrds
;

44 
t
;

46 i‡(
¨gc
 != 2) {

47 
	`¥ötf
("Ußge: %†num-thªads-to-¸óã\n", 
¨gv
[0]);

48 
	`exô
(1);

50 
numthrds
 = 
	`©oi
(
¨gv
[1]);

51 i‡((
numthrds
 <0Ë|| (numthrd†> 
MAX_THREADS
)) {

52 
	`¥ötf
("%s:Çum-thªad†övÆid\n", 
¨gv
[0]);

53 
	`exô
(1);

56 
thªads
 = 
	`mÆloc
((
±hªad_t
Ë* 
numthrds
);

57 i‡(!
thªads
) {

58 
	`¥ötf
("%s: ouào‡mem‹y!\n", 
¨gv
[0]);

59 
	`exô
(1);

62 
t
 = 0;Å < 
numthrds
;Å++) {

63 
rc
;

65 
rc
 = 
	`±hªad_¸óã
(&
thªads
[
t
], 
NULL
, 
PrötStuff
, (*)t);

66 i‡(
rc
) {

67 
¥ötf


69 
¨gv
[0], 
t
, 
rc
);

70 
	`≥º‹
("pthread_create failed");

71 
	`exô
(1);

74 
	`∑u£
();

75 
	`‰ì
(
thªads
);

76 
	`±hªad_exô
(
NULL
);

77 
	}
}

	@Training/L1_sysprg_trg/pthreads/misc/forking_MT_prcs/mt_fork_exec.c

12 
	#_POSIX_C_SOURCE
 200112L

	)

14 
	~<°dio.h
>

15 
	~<uni°d.h
>

16 
	~<°dlib.h
>

17 
	~<±hªad.h
>

18 
	~<sys/waô.h
>

19 
	~<sys/ty≥s.h
>

20 
	~<sys/°©.h
>

21 
	~<f˙é.h
>

23 
	#LAST_COL
 79

	)

27 *
	$thrd_p2
(*
msg
)

29 
	`¥ötf
("%s(): wû»ãrmö©êö 2s...\n", 
__func__
);

30 
	`¶ìp
(2);

31 
	`±hªad_exô
(
NULL
);

32 
	}
}

37 *
	$thrd_p3
(*
msg
)

39 
pid_t
 
n
;

40 *
‚ame
 = (*)
msg
;

42 i‡(!
‚ame
) {

43 
	`Ârötf
(
°dîr
, "%s(): PDF-fûe-to-võwáb£¡?\n", 
__func__
);

44 
	`exô
(1);

46 
	`¥ötf
("%s(): PID %d...‚ame=%s\n", 
__func__
, 
	`gëpid
(), 
‚ame
);

48 
	`¥ötf
("+++ WorkerÅhread 2: fork() in 3 seconds...\n");

49 
	`¶ìp
(3);

50 
n
 = 
	`f‹k
()) {

52 
	`≥º‹
("fork failed");

53 
	`exô
(1);

55 
	`¥ötf
("I¿chûd: PID %d. Exec-ögÉvö˚Çow ...\n", 
	`gëpid
());

56 i‡(
exe˛


57 ("/u§/bö/evö˚", "evö˚ PDFÑódî", 
‚ame
,

59 
	`≥º‹
("execl failed!");

60 
	`exô
(1);

62 
	`exô
(0);

64 
	`¥ötf
("worker 2: waiting for child...\n");

65 
	`¥ötf
("w‹kî 2: chûd %d dõd...\n", 
	`waô
(0));

68 
	`±hªad_exô
(
NULL
);

69 
	}
}

71 
	$maö
(
¨gc
, **
¨gv
)

73 
±hªad_t
 
p2
, 
p3
;

74 
fd
, 
r
;

75 *
ªt
;

77 i‡(
¨gc
 == 1) {

78 
	`Ârötf
(
°dîr
, "Ußge: %†PDF-fûe-to-võw\n", 
¨gv
[0]);

79 
	`exô
(1);

82 
fd
 = 
	`›í
(
¨gv
[1], 
O_RDONLY
);

83 i‡(
fd
 == -1) {

84 
	`Ârötf
(
°dîr
,

86 
¨gv
[0],árgv[1]);

87 
	`≥º‹
("File open failed");

88 
	`exô
(1);

90 
	`˛o£
(
fd
);

93 
	`¥ötf
("p1 (the main()Åhread):Çow creatingÖthreadÖ2..\n");

94 
r
 = 
	`±hªad_¸óã
(&
p2
,

95 
NULL
,

96 
thrd_p2
,

97 (*)
¨gv
[1]);

98 i‡(
r
)

99 
	`≥º‹
("±hªad cª©i⁄"), 
	`exô
(1);

101 
	`¥ötf
("p1 (the main()Åhread):Çow creatingÖthreadÖ3..\n");

102 
r
 = 
	`±hªad_¸óã
(&
p3
,

103 
NULL
,

104 
thrd_p3
,

105 (*)
¨gv
[1]);

106 i‡(
r
)

107 
	`≥º‹
("±hªad cª©i⁄"), 
	`exô
(1);

109 
	`¥ötf
("p1:ÅhreadsÖ2ándÖ3 created...\n");

110 
	`fÊush
(
°dout
);

113 
	`¥ötf
("main: join-ing ...\n");

114 i‡(
	`±hªad_joö
(
p2
, &
ªt
) != 0)

115 
	`≥º‹
("±hªad joö"), 
	`exô
(1);

116 
	`¥ötf
("p1:Ö2 has joined up\n");

117 i‡(
	`±hªad_joö
(
p3
, &
ªt
) != 0)

118 
	`≥º‹
("±hªad joö"), 
	`exô
(1);

119 
	`¥ötf
("p1:Ö3 has joined up\n");

121 
	`exô
(0);

122 
	}
}

	@Training/L1_sysprg_trg/pthreads/misc/pthrd_attr_getset/attr_setget.c

7 
	#_GNU_SOURCE


	)

8 
	~<±hªad.h
>

9 
	~<°dio.h
>

10 
	~<°dlib.h
>

11 
	~<uni°d.h
>

12 
	~<î∫o.h
>

14 
	#h™dÀ_îr‹_í
(
í
, 
msg
) \

15 dÿ{ 
î∫o
 = 
í
; 
	`≥º‹
(
msg
); 
	`exô
(
EXIT_FAILURE
); } 0)

	)

17 
	$di•œy_±hªad_©å
(
±hªad_©å_t
 * 
©å
, *
¥efix
)

19 
s
, 
i
;

20 
size_t
 
v
;

21 *
°kaddr
;

22 
sched_∑øm
 
•
;

24 
s
 = 
	`±hªad_©å_gëdëach°©e
(
©å
, &
i
);

25 i‡(
s
 != 0)

26 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_getdetachstate");

27 
	`¥ötf
("%sDëach sèã = %s\n", 
¥efix
,

28 (
i
 =
PTHREAD_CREATE_DETACHED
) ? "PTHREAD_CREATE_DETACHED" :

29 (
i
 =
PTHREAD_CREATE_JOINABLE
) ? "PTHREAD_CREATE_JOINABLE" :

32 
s
 = 
	`±hªad_©å_gësc›e
(
©å
, &
i
);

33 i‡(
s
 != 0)

34 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_getscope");

35 
	`¥ötf
("%sSc›ê = %s\n", 
¥efix
,

36 (
i
 =
PTHREAD_SCOPE_SYSTEM
) ? "PTHREAD_SCOPE_SYSTEM" :

37 (
i
 =
PTHREAD_SCOPE_PROCESS
) ? "PTHREAD_SCOPE_PROCESS" : "???");

39 
s
 = 
	`±hªad_©å_gëöhîôsched
(
©å
, &
i
);

40 i‡(
s
 != 0)

41 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_getinheritsched");

42 
	`¥ötf
("%sInhîô scheduÀ∏ = %s\n", 
¥efix
,

43 (
i
 =
PTHREAD_INHERIT_SCHED
) ? "PTHREAD_INHERIT_SCHED" :

44 (
i
 =
PTHREAD_EXPLICIT_SCHED
) ? "PTHREAD_EXPLICIT_SCHED" :

46 
s
 = 
	`±hªad_©å_gëschedpﬁicy
(
©å
, &
i
);

47 i‡(
s
 != 0)

48 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_getschedpolicy");

49 
	`¥ötf
("%sSchedulögÖﬁicy = %s\n", 
¥efix
,

50 (
i
 =
SCHED_OTHER
) ? "SCHED_OTHER" :

51 (
i
 =
SCHED_FIFO
) ? "SCHED_FIFO" :

52 (
i
 =
SCHED_RR
) ? "SCHED_RR" : "???");

54 
s
 = 
	`±hªad_©å_gësched∑øm
(
©å
, &
•
);

55 i‡(
s
 != 0)

56 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_getschedparam");

57 
	`¥ötf
("%sSchedulögÖri‹ôy = %d\n", 
¥efix
, 
•
.
sched_¥i‹ôy
);

59 
s
 = 
	`±hªad_©å_gëgu¨dsize
(
©å
, &
v
);

60 i‡(
s
 != 0)

61 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_getguardsize");

62 
	`¥ötf
("%sGu¨d sizê = %lu byãs\n", 
¥efix
, 
v
);

64 
s
 = 
	`±hªad_©å_gë°ack
(
©å
, &
°kaddr
, &
v
);

65 i‡(
s
 != 0)

66 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_getstack");

67 
	`¥ötf
("%sSèckáddªs† = %p\n", 
¥efix
, 
°kaddr
);

68 
	`¥ötf
("%sStack size = 0x%x (%u) bytes\n",

69 
¥efix
, ()
v
, ()v);

70 
	}
}

72 *
	$thªad_°¨t
(*
¨g
)

74 
s
;

75 
±hªad_©å_t
 
g©å
;

81 
s
 = 
	`±hªad_gë©å_≈
(
	`±hªad_£lf
(), &
g©å
);

82 i‡(
s
 != 0)

83 
	`h™dÀ_îr‹_í
(
s
, "pthread_getattr_np");

85 
	`¥ötf
("Threadáttributes:\n");

86 
	`di•œy_±hªad_©å
(&
g©å
, "\t");

87 
	`exô
(
EXIT_SUCCESS
);

88 
	}
}

90 
	$maö
(
¨gc
, *
¨gv
[])

92 
±hªad_t
 
thr
;

93 
±hªad_©å_t
 
©å
;

94 
±hªad_©å_t
 *
©åp
;

95 
s
;

97 
©åp
 = 
NULL
;

103 i‡(
¨gc
 > 1) {

104 
°ack_size
;

105 *
•
;

107 
©åp
 = &
©å
;

109 
s
 = 
	`±hªad_©å_öô
(&
©å
);

110 i‡(
s
 != 0)

111 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_init");

113 
s
 = 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_DETACHED
);

114 i‡(
s
 != 0)

115 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_setdetachstate");

117 
s
 = 
	`±hªad_©å_£töhîôsched
(&
©å
, 
PTHREAD_EXPLICIT_SCHED
);

118 i‡(
s
 != 0)

119 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_setinheritsched");

121 
°ack_size
 = 
	`°πoul
(
¨gv
[1], 
NULL
, 0);

134 
s
 = 
	`posix_memÆign
(&
•
, 
	`sysc⁄f
(
_SC_PAGESIZE
), 
°ack_size
);

135 i‡(
s
 != 0)

136 
	`h™dÀ_îr‹_í
(
s
, "posix_memalign");

138 
	`¥ötf
("posix_memÆign(ËÆloˇãdáà%p\n", 
•
);

139 
s
 = 
	`±hªad_©å_£t°ack
(&
©å
, 
•
, 
°ack_size
);

140 i‡(
s
 != 0)

141 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_setstack");

144 
s
 = 
	`±hªad_¸óã
(&
thr
, 
©åp
, &
thªad_°¨t
, 
NULL
);

145 i‡(
s
 != 0)

146 
	`h™dÀ_îr‹_í
(
s
, "pthread_create");

148 i‡(
©åp
 !
NULL
) {

149 
s
 = 
	`±hªad_©å_de°roy
(
©åp
);

150 i‡(
s
 != 0)

151 
	`h™dÀ_îr‹_í
(
s
, "pthread_attr_destroy");

154 
	`∑u£
();

155 
	`exô
(0);

156 
	}
}

	@Training/L1_sysprg_trg/pthreads/misc/rlim_pthrds/rlim_threads.c

19 
	~<°dio.h
>

20 
	~<uni°d.h
>

21 
	~<±hªad.h
>

22 
	~<°dlib.h
>

24 
	~<sys/time.h
>

25 
	~<sys/ªsour˚.h
>

27 
	#DELAY
 2

	)

30 
	$quîy_æimô
(
limô
, 
æimô
 *
æim
)

32 i‡(
	`gëæimô
(
RLIMIT_NOFILE
, 
æim
) == -1) {

33 
	`≥º‹
("getrlimit failed");

37 
	}
}

39 *
	$thrd_p2
(*
msg
)

41 
æimô
 
æim2
;

46 
	`¥ötf
(" %s(): sÀïög f‹ %d s..\n", 
__func__
, 
DELAY
);

47 
	`¶ìp
(
DELAY
);

49 
	`quîy_æimô
(
RLIMIT_NOFILE
, &
æim2
);

50 
	`¥ötf
(" %s(): RLIMIT_NOFILE currently setÅo:\n"

52 "\tH¨dÜimô : %d\n", 
__func__
, ()
æim2
.
æim_cur
, (Ïlim2.
æim_max
);

54 
	`¥ötf
(" %s():Çow sÀïög f‹ 5s..\n", 
__func__
);

55 
	`¶ìp
(5);

57 
	`quîy_æimô
(
RLIMIT_NOFILE
, &
æim2
);

58 
	`¥ötf
(" %s(): RLIMIT_NOFILE currently setÅo:\n"

60 "\tH¨dÜimô : %d\n", 
__func__
, ()
æim2
.
æim_cur
, (Ïlim2.
æim_max
);

62 
	`¥ötf
(" %s():Éxôög..", 
__func__
);

63 
	`±hªad_exô
("thrd_p2 joined");

64 
	}
}

66 
	$maö
(
¨gc
, **
¨gv
)

68 
±hªad_t
 
p2
;

69 
i
 = 0;

70 
r
;

71 
æimô
 
æim
;

73 
	`¥ötf
("p1 (pid %d -Åhe main()Åhread):Çow creatingÖthreadÖ2..\n",

74 
	`gëpid
());

75 
r
 = 
	`±hªad_¸óã
(&
p2
,

76 
NULL
,

77 
thrd_p2
,

78 (*)
i
);

79 i‡(
r
)

80 
	`≥º‹
("±hªad cª©i⁄"), 
	`exô
(1);

82 
	`quîy_æimô
(
RLIMIT_NOFILE
, &
æim
);

83 
	`¥ötf
("main: RLIMIT_NOFILE currently setÅo:\n"

85 "\tH¨dÜimô : %d\n", ()
æim
.
æim_cur
, (Ïlim.
æim_max
);

87 
	`¥ötf
("main:Çow sleeping for 3s...\n");

88 
	`¶ìp
(3);

90 
	`¥ötf
("main:Çow setting RLIMIT_NOFILEÅo 500\n");

91 
æim
.
æim_cur
 = 500;

92 
æim
.
æim_max
 = 800;

93 i‡(
	`£ålimô
(
RLIMIT_NOFILE
, &
æim
) == -1) {

94 
	`≥º‹
("main: setrlimit failed");

97 
	`¥ötf
("main: RLIMIT_NOFILE currently setÅo:\n"

99 "\tH¨dÜimô : %d\n", ()
æim
.
æim_cur
, (Ïlim.
æim_max
);

101 
	`¥ötf
("main:Çow sleeping for 5s...\n");

102 
	`¶ìp
(5);

103 
	`¥ötf
("mainÅhreadÉxiting..\n");

104 
	`±hªad_exô
(
NULL
);

105 
	}
}

	@Training/L1_sysprg_trg/pthreads/sched/sched_prios/sched_prios.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	~<sched.h
>

5 
	$maö
()

7 
mö
, 
max
;

9 
mö
 = 
	`sched_gë_¥i‹ôy_mö
(
SCHED_FIFO
);

10 
max
 = 
	`sched_gë_¥i‹ôy_max
(
SCHED_FIFO
);

11 
	`¥ötf
("SCHED_FIFO: mö=%d max=%d\n", 
mö
, 
max
);

13 
mö
 = 
	`sched_gë_¥i‹ôy_mö
(
SCHED_RR
);

14 
max
 = 
	`sched_gë_¥i‹ôy_max
(
SCHED_RR
);

15 
	`¥ötf
("SCHED_RR: mö=%d max=%d\n", 
mö
, 
max
);

17 
mö
 = 
	`sched_gë_¥i‹ôy_mö
(
SCHED_OTHER
);

18 
max
 = 
	`sched_gë_¥i‹ôy_max
(
SCHED_OTHER
);

19 
	`¥ötf
("SCHED_OTHER: mö=%d max=%d\n", 
mö
, 
max
);

20 
	}
}

	@Training/L1_sysprg_trg/pthreads/sched/sched_pthrd_rtprio/libpk.h

6 
	~<°dio.h
>

7 
	~<uni°d.h
>

8 
	~<°dlib.h
>

9 
	~<asm/∑øm.h
>

11 
ölöe
 
	$bìp
(
wh©
)

13 
buf
[2];

15 
buf
[0] = ()(
wh©
);

16 
buf
[1] = '\0';

17 
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1);

18 
	}
}

24 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

26 
c
 = 0;\

27 
f‹_ödex
, 
ö√r_ödex
; \

28 
x
; \

29 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

30 
	`bìp
((
vÆ
)); \

31 
c
++;\

32 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
*100000; inner_index++) \

33 
x
 = (
ö√r_ödex
%2)*((22/7)%3); \

36 }

	)

	@Training/L1_sysprg_trg/pthreads/sched/sched_pthrd_rtprio/sched_pthrd_rtprio.c

6 
	~<°dio.h
>

7 
	~<uni°d.h
>

8 
	~<±hªad.h
>

9 
	~<°dlib.h
>

10 
	~"libpk.h
"

12 
	#DEBUG


13 #ifde‡
DEBUG


	)

14 
	#MSG
(
°rög
, 
¨gs
...Ë
	`Ârötf
(
°dîr
, "%s:%†: " såög, 
__FILE__
, 
__func__
, ##¨gs)

	)

16 
	#MSG
(
°rög
, 
¨gs
...)

	)

19 *
	$thrd_p2
(*
msg
)

21 
sched_∑øm
 
p
;

28 
	`¥ötf
(" RT ThreadÖ2 (LWP %d) here in function %s()\n"

30 
	`gëpid
(), 
__func__
, ()
msg
);

31 
	`¶ìp
(2);

34 
p
.
sched_¥i‹ôy
 = ()
msg
;

35 i‡(
	`±hªad_£tsched∑øm
(
	`±hªad_£lf
(), 
SCHED_FIFO
, &
p
))

36 
	`≥º‹
("pthread_setschedparam");

38 
	`puts
("Ö2: working");

39 
	`DELAY_LOOP
('2', 350);

41 
	`puts
("Ö2:Éxiting..");

42 
	`±hªad_exô
(
NULL
);

43 
	}
}

45 *
	$thrd_p3
(*
msg
)

47 
sched_∑øm
 
p
;

53 
¥i
 = ()
msg
;

55 
¥i
 += 10;

56 
	`¥ötf
(" RT ThreadÖ3 (LWP %d) here in function %s()\n"

58 
	`gëpid
(), 
__func__
, 
¥i
);

64 
p
.
sched_¥i‹ôy
 = 
¥i
;

65 i‡(
	`±hªad_£tsched∑øm
(
	`±hªad_£lf
(), 
SCHED_FIFO
, &
p
))

66 
	`≥º‹
("pthread_setschedparam");

67 
	`¶ìp
(4);

69 
	`puts
("Ö3: working");

70 
	`DELAY_LOOP
('3', 210);

72 
	`puts
("Ö3:Éxiting..");

73 
	`±hªad_exô
(
NULL
);

74 
	}
}

76 
	$maö
(
¨gc
, **
¨gv
)

78 
±hªad_t
 
p2
, 
p3
;

79 
r
, 
mö
, 
max
;

80 
π_¥i
 = 1;

82 i‡(
¨gc
 == 1)

83 
	`Ârötf
(
°dîr
, "Usage: %sÑealtime-priority\n",

84 
¨gv
[0]), 
	`exô
(1);

85 
mö
 = 
	`sched_gë_¥i‹ôy_mö
(
SCHED_FIFO
);

86 i‡(
mö
 == -1) {

87 
	`≥º‹
("sched_get_priority_min failure");

88 
	`exô
(1);

90 
max
 = 
	`sched_gë_¥i‹ôy_max
(
SCHED_FIFO
);

91 i‡(
max
 == -1) {

92 
	`≥º‹
("sched_get_priority_max failure");

93 
	`exô
(1);

95 
	`MSG
("SCHED_FIFOÖri‹ôyÑ™gêi†%dÅÿ%d\n", 
mö
, 
max
);

97 
π_¥i
 = 
	`©oi
(
¨gv
[1]);

98 i‡((
π_¥i
 < 
mö
Ë|| (π_¥ò> (
max
 - 10))) {

99 
	`Ârötf
(
°dîr
,

101 
¨gv
[0], 
π_¥i
, 
mö
, (
max
 - 10));

102 
	`exô
(1);

105 
	`¥ötf
("\nNote:Åo createÅrue (soft) RTÅhreads,ánd have itÑunásÉxpected, youÇeedÅo:\n\
1.ÑunÅhisÖrogramás superuser -OR- haveÅhe capability CAP_SYS_NICE (better!)\n\
2.Énsure itÑuns oná single CPU core (useÅaskset -c02 <prg-name>)\n");

108 
	`¥ötf
("%s()Åhread (%d):Çow creatingÑealtimeÖthreadÖ2..\n",

109 
__func__
, 
	`gëpid
());

110 
r
 = 
	`±hªad_¸óã
(&
p2
,

111 
NULL
,

112 
thrd_p2
,

113 (*)
π_¥i
);

114 i‡(
r
)

115 
	`≥º‹
("±hªad cª©i⁄"), 
	`exô
(1);

117 
	`¥ötf
("%s()Åhread (%d):Çow creatingÑealtimeÖthreadÖ3..\n",

118 
__func__
, 
	`gëpid
());

119 
r
 = 
	`±hªad_¸óã
(&
p3
,

120 
NULL
,

121 
thrd_p3
,

122 (*)
π_¥i
);

123 i‡(
r
)

124 
	`≥º‹
("±hªad cª©i⁄"), 
	`exô
(1);

126 
	`DELAY_LOOP
('m', 400);

127 
	`±hªad_exô
(
NULL
);

128 
	}
}

	@Training/L1_sysprg_trg/pthreads/sched/tmslice/tmslc.c

6 
	~<°dio.h
>

7 
	~<uni°d.h
>

8 
	~<°dlib.h
>

9 
	~<sched.h
>

11 
	$maö
(
¨gc
, **
¨gv
)

13 
time•ec
 
ç
;

14 
pﬁicy
, 
ªt
;

15 
pid_t
 
pid
 = 0;

17 i‡(
¨gc
 == 1) {

18 
	`Ârötf
(
°dîr
, "Ußge: %†pid\n", 
¨gv
[0]);

19 
	`exô
(1);

21 
pid
 = 
	`©oi
(
¨gv
[1]);

29 i‡((
pﬁicy
 = 
	`sched_gëscheduÀr
(
pid
)) == -1) {

30 
	`≥º‹
("sched_getscheduler");

31 
	`exô
(1);

33 
	`¥ötf
("pﬁicy = %d\n", 
pﬁicy
);

34 i‡(
pﬁicy
 !
SCHED_RR
) {

35 
¥ötf


37 
¨gv
[0], 
pid
);

43 
ªt
 = 
	`sched_º_gë_öãrvÆ
(
pid
, &
ç
);

44 i‡(
ªt
 == -1) {

45 
	`≥º‹
("sched_rr_get_interval");

50 
	`¥ötf
("OurÅime quantum is %.2lf milliseconds\n",

51 (
ç
.
tv_£c
 * 1000.0fË+ (ç.
tv_n£c
 / 1000000.0f));

53 
	}
}

	@Training/L1_sysprg_trg/pthreads/signalling_mt/tsig.c

25 
	#_GNU_SOURCE


	)

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<uni°d.h
>

30 
	~<±hªad.h
>

31 
	~<sig«l.h
>

32 
	~<sys/ty≥s.h
>

33 
	~<°rög.h
>

34 
	~<î∫o.h
>

36 
	#NUM_THREADS
 2

	)

37 
	#FATAL
 1

	)

38 
	#NON_FATAL
 0

	)

40 
ölöe
 
	$bìp
(
wh©
)

42 
buf
[2];

43 
buf
[0] = ()(
wh©
);

44 
buf
[1] = '\0';

45 i‡(
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1) < 0)

46 
	`≥º‹
("write fail");

47 
	}
}

53 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

55 
c
=0;\

56 
f‹_ödex
,
ö√r_ödex
; \

57 
x
; \

58 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

59 
	`bìp
((
vÆ
)); \

60 
c
++;\

61 
ö√r_ödex
=0;inner_index<10000000;inner_index++) \

62 
x
=(
ö√r_ödex
%2)*((22/7)%3); \

65 }

	)

67 
	#MTX_LOCK
(
muãx
, 
Áèl
) do { \

68 
îr
; \

69 i‡((
îr
 = 
	`±hªad_muãx_lock
 (
muãx
))) { \

70 
	`Ârötf
 (
°dîr
, "±hªad_muãx_lock faûed! : %s\n", 
	`°ªº‹
 (
îr
)); \

72 i‡(
Áèl
) { \

73 
	`Ârötf
 (
°dîr
, "AbortingÇow...\n"); \

74 
	`exô
(1); \

77 
	`Ârötf
 (
°dîr
, "*WARNING*Öthread_mutex_lock failed!\n"); \

80 } 0)

	)

82 
	#MTX_UNLOCK
(
muãx
, 
Áèl
) do { \

83 
îr
; \

84 i‡((
îr
 = 
	`±hªad_muãx_u∆ock
 (
muãx
))) { \

85 
	`Ârötf
 (
°dîr
, "±hªad_muãx_u∆ock faûed! : %s\n", 
	`°ªº‹
 (
îr
)); \

87 i‡(
Áèl
) { \

88 
	`Ârötf
 (
°dîr
, "AbortingÇow...\n"); \

89 
	`exô
 (1); \

92 
	`Ârötf
 (
°dîr
, "*WARNING*Öthread_mutex_unlock failed!\n"); \

95 } 0)

	)

97 
	gsig«l_h™dÀd
 = -1;

98 
±hªad_muãx_t
 
	gsig_muãx
 = 
PTHREAD_MUTEX_INITIALIZER
;

99 
	gg_›t
;

105 
	$Áèl_sigs_h™dÀr
(
signum
, 
sigöfo_t
 * 
sigöfo
, *
ª°
)

107 vﬁ©ûê
sig_©omic_t
 
c
 = 0;

109 
	`¥ötf
("\n*** %s(): [%d] PID %d", 
__func__
, ++
c
, 
	`gëpid
());

110 #ifde‡
__löux__


111 
	`¥ötf
(" (TID %d)", 
	`gëtid
());

113 
	`¥ötf
("Ñeceived signal %d.Érrno=%d\n"

115 
signum
, 
sigöfo
->
si_î∫o
, sigöfo->
si_code
);

117 
sigöfo
->
si_code
) {

118 
SI_USER
:

119 
	`¥ötf
("user\n");

121 
SI_KERNEL
:

122 
	`¥ötf
("kernel\n");

124 
SI_QUEUE
:

125 
	`¥ötf
("queue\n");

127 
SI_TIMER
:

128 
	`¥ötf
("timer\n");

130 
SI_MESGQ
:

131 
	`¥ötf
("mesgq\n");

133 
SI_ASYNCIO
:

134 
	`¥ötf
("async io\n");

136 
SI_SIGIO
:

137 
	`¥ötf
("sigio\n");

139 
SI_TKILL
:

140 
	`¥ötf
("t[g]kill\n");

143 
SEGV_MAPERR
:

144 
	`¥ötf
("SEGV_MAPERR:áddressÇot mappedÅo object\n");

146 
SEGV_ACCERR
:

147 
	`¥ötf
("SEGV_ACCERR: invalidÖermissions for mapped object\n");

154 
SEGV_BNDERR
:

155 
	`¥ötf
("SEGV_BNDERR: failedáddress bound checks\n");

156 
SEGV_PKUERR
:

157 
¥ötf


161 
	`¥ötf
("-none-\n");

163 
	`¥ötf
(" Fau…ögáddr=%p\n", 
sigöfo
->
si_addr
);

168 
	`exô
(1);

170 
	`ab‹t
();

172 
	}
}

189 *
	$sig«l_h™dÀr
(*
¨g
)

191 
sig£t_t
 
sig£t
;

192 
sig
;

194 
	`¥ötf
("Dedicated signal_handler()Åhreadálive..\n");

197 i‡(
	`sigfûl£t
(&
sig£t
) == -1) {

198 
	`≥º‹
("signal_handler: sigfillset failed");

200 
	`exô
(1);

206 i‡(
	`sigwaô
(&
sig£t
, &
sig
) < 0) {

207 
	`≥º‹
("signal_handler: sigwait failed");

209 
	`exô
(1);

226 
sig
) {

227 
SIGINT
:

228 
	`MTX_LOCK
(&
sig_muãx
, 
FATAL
);

229 
sig«l_h™dÀd
 = 
SIGINT
;

230 
	`MTX_UNLOCK
(&
sig_muãx
, 
FATAL
);

233 
SIGQUIT
:

234 
	`MTX_LOCK
(&
sig_muãx
, 
FATAL
);

235 
sig«l_h™dÀd
 = 
SIGQUIT
;

236 
	`MTX_UNLOCK
(&
sig_muãx
, 
FATAL
);

239 
SIGIO
:

240 
	`MTX_LOCK
(&
sig_muãx
, 
FATAL
);

241 
sig«l_h™dÀd
 = 
SIGIO
;

242 
	`MTX_UNLOCK
(&
sig_muãx
, 
FATAL
);

246 
	`MTX_LOCK
(&
sig_muãx
, 
FATAL
);

247 
sig«l_h™dÀd
 = 
sig
;

248 
	`MTX_UNLOCK
(&
sig_muãx
, 
FATAL
);

251 
	`¥ötf
("!!! %s(): caughàsig«»#%d !!!\n", 
__func__
, 
sig
);

254 
	}
}

256 *
	$w‹k
(*
id
)

258 
this
 = ()
id
;

260 
	`¥ötf
("+++++++++++++++++++++++++++++++++++++++++\n\
Åhªad #%ld (pid %d)...\n", 
this
, 
	`gëpid
());

262 i‡(
this
 == 1) {

263 
	`DELAY_LOOP
('1', 2000);

264 i‡(
g_›t
 == 1) {

265 *
pi
 = 0x0;

266 
	`¥ötf
("pò%p\n", (*)*
pi
);

274 } i‡(
this
 == 2) {

275 
	`DELAY_LOOP
('2', 2000);

277 
	`¥ötf
("\n---------------------------------------\n");

278 
	`±hªad_exô
(
NULL
);

279 
	}
}

287 
	$£tup_Ætsig°ack
(
size_t
 
°ack_sz
)

289 
°ack_t
 
ss
;

291 
	`¥ötf
("A… sig«»°ack sizê%zu byãs\n", 
°ack_sz
);

292 
ss
.
ss_•
 = 
	`mÆloc
(
°ack_sz
);

293 i‡(!
ss
.
ss_•
){

294 
	`¥ötf
("mÆloc(%zuËf‹á… sig sèck faûed\n", 
°ack_sz
);

295  -
ENOMEM
;

298 
ss
.
ss_size
 = 
°ack_sz
;

299 
ss
.
ss_Êags
 = 0;

300 i‡(
	`sigÆt°ack
(&
ss
, 
NULL
) == -1){

301 
	`¥ötf
("sigÆt°ack f‹ sizê%zu faûed!\n", 
°ack_sz
);

302  -
î∫o
;

304 
	`¥ötf
("A… sig«»°ack uv®(u£∏vúàaddrË%p\n", 
ss
.
ss_•
);

307 
	}
}

309 
	$maö
(
¨gc
, **
¨gv
)

311 
sig£t_t
 
sig£t
;

312 
siga˘i⁄
 
a˘
;

313 
±hªad_t
 
±hrd
[
NUM_THREADS
 + 1];

314 
±hªad_©å_t
 
©å
;

315 
t
 = 0;

317 i‡(
¨gc
 != 2) {

318 
	`Ârötf
(
°dîr
, "Ußge: %†<›ti⁄>\n\
0 = dÿNOT cau£á segÁu…\n\
1 = dÿˇu£á segÁu…\n", 
¨gv
[0]);

321 
	`exô
(1);

323 
g_›t
 = 
	`©oi
(
¨gv
[1]);

324 i‡(
g_›t
 != 0 && g_opt != 1) {

325 
	`Ârötf
(
°dîr
, "<option>: bad valueÖassed\n");

326 
	`exô
(1);

333 i‡(
	`sigfûl£t
(&
sig£t
) < 0) {

334 
	`≥º‹
("sigfûl£t"); 
	`exô
(1);

340 i‡(
	`sigdñ£t
(&
sig£t
, 
SIGSEGV
) < 0) {

341 
	`≥º‹
("sigdñ£t"); 
	`exô
(1);

343 i‡(
	`sigdñ£t
(&
sig£t
, 
SIGBUS
) < 0) {

344 
	`≥º‹
("sigdñ£t"); 
	`exô
(1);

346 i‡(
	`sigdñ£t
(&
sig£t
, 
SIGABRT
) < 0) {

347 
	`≥º‹
("sigdñ£t"); 
	`exô
(1);

349 i‡(
	`sigdñ£t
(&
sig£t
, 
SIGFPE
) < 0) {

350 
	`≥º‹
("sigdñ£t"); 
	`exô
(1);

352 i‡(
	`sigdñ£t
(&
sig£t
, 
SIGILL
) < 0) {

353 
	`≥º‹
("sigdñ£t"); 
	`exô
(1);

355 i‡(
	`sigdñ£t
(&
sig£t
, 
SIGIOT
) < 0) {

356 
	`≥º‹
("sigdñ£t"); 
	`exô
(1);

358 i‡(
	`±hªad_sigmask
(
SIG_BLOCK
, &
sig£t
, 
NULL
)) {

359 
	`≥º‹
("main:Öthread_sigmask failed");

361 
	`exô
(1);

373 i‡(
	`£tup_Ætsig°ack
(10*1024*1024) < 0) {

374 
	`Ârötf
(
°dîr
, "%s: sëtög u∞Æàsig sèck faûed\n", 
¨gv
[0]);

375 
	`exô
(1);

377 
	`mem£t
(&
a˘
, 0, (act));

378 
a˘
.
ß_siga˘i⁄
 = 
Áèl_sigs_h™dÀr
;

379 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
 | 
SA_ONSTACK
;

380 
	`sigem±y£t
(&
a˘
.
ß_mask
);

381 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

382 
	`≥º‹
("siga˘i⁄"); 
	`exô
(1);

384 i‡(
	`siga˘i⁄
(
SIGBUS
, &
a˘
, 0) == -1) {

385 
	`≥º‹
("siga˘i⁄"); 
	`exô
(1);

387 i‡(
	`siga˘i⁄
(
SIGABRT
, &
a˘
, 0) == -1) {

388 
	`≥º‹
("siga˘i⁄"); 
	`exô
(1);

390 i‡(
	`siga˘i⁄
(
SIGFPE
, &
a˘
, 0) == -1) {

391 
	`≥º‹
("siga˘i⁄"); 
	`exô
(1);

393 i‡(
	`siga˘i⁄
(
SIGILL
, &
a˘
, 0) == -1) {

394 
	`≥º‹
("siga˘i⁄"); 
	`exô
(1);

396 i‡(
	`siga˘i⁄
(
SIGIOT
, &
a˘
, 0) == -1) {

397 
	`≥º‹
("siga˘i⁄"); 
	`exô
(1);

400 i‡(
	`±hªad_©å_öô
(&
©å
)) {

401 
	`≥º‹
("main:Öthread_attr_init failed");

403 
	`exô
(1);

405 i‡(
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_DETACHED
)) {

406 
	`≥º‹
("main:Öthread_attr_setdetachstate failed");

408 
	`exô
(1);

412 i‡(
	`±hªad_¸óã
(&
±hrd
[
t
], &
©å
, 
sig«l_h™dÀr
, 
NULL
)) {

413 
	`Ârötf
(
°dîr
, "%s:Åhªad %ld cª©i⁄ faûuª..\n", 
¨gv
[0],

414 
t
);

415 
	`≥º‹
("main:Öthread_create");

417 
	`exô
(1);

421 
t
 = 1;Å < 
NUM_THREADS
 + 1;Å++) {

422 i‡(
	`±hªad_¸óã
(&
±hrd
[
t
], &
©å
, 
w‹k
, (*)t)) {

423 
	`Ârötf
(
°dîr
, "%s:Åhread %ld creation failure..\n",

424 
¨gv
[0], 
t
);

425 
	`≥º‹
("main:Öthread_create");

427 
	`exô
(1);

433 
	`∑u£
();

435 
	`±hªad_exô
(
NULL
);

436 
	}
}

	@Training/L1_sysprg_trg/pthreads/speed_thrdprcs_simple/create_destroy/fork_test.c

7 
	~<°dio.h
>

8 
	~<°dlib.h
>

9 
	~<uni°d.h
>

10 
	~<sys/waô.h
>

12 
	#NFORKS
 50000

	)

14 
	$do_nŸhög
()

16 
i
;

17 
i
 = 0;

18 
	}
}

20 
	$maö
()

22 
pid
, 
j
, 
°©us
;

24 
j
 = 0; j < 
NFORKS
; j++) {

26 i‡((
pid
 = 
	`f‹k
()) < 0) {

27 
	`¥ötf
("f‹k faûed wôhÉº‹ code%d\n", 
pid
);

28 
	`exô
(1);

32 i‡(
pid
 == 0) {

33 
	`do_nŸhög
();

34 
	`exô
(0);

39 
	`waôpid
(
pid
, &
°©us
, 0);

42 
	`exô
(0);

43 
	}
}

	@Training/L1_sysprg_trg/pthreads/speed_thrdprcs_simple/create_destroy/pthread_test.c

7 
	#_POSIX_C_SOURCE
 200112L

	)

9 
	~<±hªad.h
>

10 
	~<°dio.h
>

11 
	~<°dlib.h
>

12 
	~<uni°d.h
>

14 
	#NTHREADS
 50000

	)

16 *
	$do_nŸhög
(*
nuŒ
)

18 
i
;

19 
i
 = 0;

20 
	`±hªad_exô
(
NULL
);

21 
	}
}

23 
	$maö
()

25 
rc
, 
j
;

26 
±hªad_t
 
tid
;

27 
±hªad_©å_t
 
©å
;

29 
	`±hªad_©å_öô
(&
©å
);

30 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

32 
j
 = 0; j < 
NTHREADS
; j++) {

33 
rc
 = 
	`±hªad_¸óã
(&
tid
, &
©å
, 
do_nŸhög
, 
NULL
);

34 i‡(
rc
) {

35 
¥ötf


37 
rc
);

38 
	`exô
(1);

42 
rc
 = 
	`±hªad_joö
(
tid
, 
NULL
);

43 i‡(
rc
) {

44 
	`¥ötf
("ERROR;Ñeturn code fromÖthread_join() is %d\n",

45 
rc
);

46 
	`exô
(1);

50 
	`±hªad_©å_de°roy
(&
©å
);

51 
	`±hªad_exô
(
NULL
);

52 
	}
}

	@Training/L1_sysprg_trg/pthreads/speed_thrdprcs_simple/matrixmul/prcs_matrixmul/prcs_matrixmul.c

2 
	~<°dio.h
>

3 
	~<°dlib.h
>

5 
	#n
 1024

6 
a
[
n
][n], 
b
[n][n], 
c
[n][n];

	)

8 
	$maö
()

10 
i
, 
j
, 
k
;

11 
i
 = 0; i < 
n
; i++)

12 
j
 = 0; j < 
n
; j++) {

13 
a
[
i
][
j
] = 1;

14 
b
[
i
][
j
] = 1;

16 
i
 = 0; i < 
n
; i++)

17 
j
 = 0; j < 
n
; j++)

18 
k
 = 0; k < 
n
; k++)

19 
c
[
i
][
j
] = c[i][j] + 
a
[i][
k
] * 
b
[k][j];

22 
	`¥ötf
("TheÑesultant matrix is \n:");

24 
i
 = 0; i < 
n
; i++) {

25 
j
 = 0; j < 
n
; j++)

26 
	`¥ötf
("%d ", 
c
[
i
][
j
]);

27 
	`¥ötf
("\n");

30 
	}
}

	@Training/L1_sysprg_trg/pthreads/speed_thrdprcs_simple/matrixmul/thrd_matrixmul/thrd_matrixmul.c

2 
	~<°dio.h
>

3 
	~<°dlib.h
>

4 
	~<±hªad.h
>

6 
	#n
 1024

7 
	#¡hªads
 12

8 
a
[
n
][n], 
b
[n][n], 
c
[n][n];

	)

10 *
	$thªadfun
(*
¨g
)

12 *
p
 = (*)
¨g
;

13 
i
, 
j
, 
k
;

15 
i
 = *
p
; i < (*∞+ (
n
 / 
¡hªads
)); i++)

16 
j
 = 0; j < 
n
; j++)

17 
k
 = 0; k < 
n
; k++)

18 
c
[
i
][
j
] = c[i][j] + 
a
[i][
k
] * 
b
[k][j];

19 
	`±hªad_exô
((*)0);

20 
	}
}

22 
	$maö
()

24 
i
, 
j
, 
rownos
[
¡hªads
];

25 
±hªad_t
 
tid
[
¡hªads
];

27 
i
 = 0; i < 
n
; i++) {

28 
j
 = 0; j < 
n
; j++) {

29 
a
[
i
][
j
] = 1;

30 
b
[
i
][
j
] = 1;

35 
i
 = 0; i < 
¡hªads
; i++) {

36 
rownos
[
i
] = i * (
n
 / 
¡hªads
);

37 
	`±hªad_¸óã
(&
tid
[
i
], 
NULL
, 
thªadfun
, &
rownos
[i]);

41 
i
 = 0; i < 
¡hªads
; i++)

42 
	`±hªad_joö
(
tid
[
i
], 
NULL
);

45 
	`¥ötf
("TheÑesult of multiplication is:\n:");

46 
i
 = 0; i < 
n
; i++) {

47 
j
 = 0; j < 
n
; j++)

48 
	`¥ötf
("%d ", 
c
[
i
][
j
]);

50 
	`¥ötf
("\n");

53 
	`±hªad_exô
((*)0);

54 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/alt_functions.h

16 #i‚de‡
ALT_FUNCTIONS_H


17 
	#ALT_FUNCTIONS_H


	)

19 #i‡
deföed
(
__osf__
Ë|| deföed(
__hpux
Ë|| deföed(
_AIX
) || \

20 
deföed
(
__sgi
Ë|| 
	$deföed
(
__APPLE__
)

21 
	#°rsig«l
(
sig
Ë
	`ALT_°rsig«l
(sig)

	)

23 *
	`ALT_°rsig«l
(
sig
);

25 #i‡
	`deföed
(
__hpux
Ë|| deföed(
__osf__
)

26 
	#h°ªº‹
(
îr
Ë
	`ALT_h°ªº‹
”º)

	)

28 *
	`ALT_h°ªº‹
(
sig
);

30 #i‡
	`deföed
(
__hpux
Ë|| deföed(
__osf__
)

31 
	#posix_›í±
(
Êags
Ë
	`ALT_posix_›í±
(Êags)

	)

33 
	`ALT_posix_›í±
(
Êags
);

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/error_functions.c

16 
	~<°d¨g.h
>

17 
	~"îr‹_fun˘i⁄s.h
"

18 
	~"épi_hdr.h
"

19 
	~"íame.c.öc
"

21 #ifde‡
__GNUC__


22 
__©åibuã__
 ((
__n‹ëu∫__
))

25 
	$ãrmö©e
(
Boﬁón
 
u£Exô3
)

27 *
s
;

33 
s
 = 
	`gëív
("EF_DUMPCORE");

35 i‡(
s
 !
NULL
 && *s != '\0')

36 
	`ab‹t
();

37 i‡(
u£Exô3
)

38 
	`exô
(
EXIT_FAILURE
);

40 
	`_exô
(
EXIT_FAILURE
);

41 
	}
}

53 
	$ouçutEº‹
(
Boﬁón
 
u£Eº
, 
îr
, Boﬁó¿
ÊushStdout
,

54 c⁄° *
f‹m©
, 
va_li°
 
≠
)

56 
	#BUF_SIZE
 500

	)

57 
buf
[
BUF_SIZE
], 
u£rMsg
[BUF_SIZE], 
îrText
[BUF_SIZE];

59 
	`v¢¥ötf
(
u£rMsg
, 
BUF_SIZE
, 
f‹m©
, 
≠
);

61 i‡(
u£Eº
)

62 
	`¢¥ötf
(
îrText
, 
BUF_SIZE
, " [%s %s]",

63 (
îr
 > 0 &&Éº <
MAX_ENAME
) ?

64 
íame
[
îr
] : "?UNKNOWN?", 
	`°ªº‹
(err));

66 
	`¢¥ötf
(
îrText
, 
BUF_SIZE
, ":");

68 
	`¢¥ötf
(
buf
, 
BUF_SIZE
, "ERROR%†%s\n", 
îrText
, 
u£rMsg
);

70 i‡(
ÊushStdout
)

71 
	`fÊush
(
°dout
);

72 
	`Âuts
(
buf
, 
°dîr
);

73 
	`fÊush
(
°dîr
);

74 
	}
}

80 
	$îrMsg
(c⁄° *
f‹m©
, ...)

82 
va_li°
 
¨gLi°
;

83 
ßvedEºno
;

85 
ßvedEºno
 = 
î∫o
;

87 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

88 
	`ouçutEº‹
(
TRUE
, 
î∫o
, TRUE, 
f‹m©
, 
¨gLi°
);

89 
	`va_íd
(
¨gLi°
);

91 
î∫o
 = 
ßvedEºno
;

92 
	}
}

98 
	$îrExô
(c⁄° *
f‹m©
, ...)

100 
va_li°
 
¨gLi°
;

102 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

103 
	`ouçutEº‹
(
TRUE
, 
î∫o
, TRUE, 
f‹m©
, 
¨gLi°
);

104 
	`va_íd
(
¨gLi°
);

106 
	`ãrmö©e
(
TRUE
);

107 
	}
}

125 
	$îr_exô
(c⁄° *
f‹m©
, ...)

127 
va_li°
 
¨gLi°
;

129 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

130 
	`ouçutEº‹
(
TRUE
, 
î∫o
, 
FALSE
, 
f‹m©
, 
¨gLi°
);

131 
	`va_íd
(
¨gLi°
);

133 
	`ãrmö©e
(
FALSE
);

134 
	}
}

140 
	$îrExôEN
(
î∫um
, c⁄° *
f‹m©
, ...)

142 
va_li°
 
¨gLi°
;

144 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

145 
	`ouçutEº‹
(
TRUE
, 
î∫um
, TRUE, 
f‹m©
, 
¨gLi°
);

146 
	`va_íd
(
¨gLi°
);

148 
	`ãrmö©e
(
TRUE
);

149 
	}
}

154 
	$Áèl
(c⁄° *
f‹m©
, ...)

156 
va_li°
 
¨gLi°
;

158 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

159 
	`ouçutEº‹
(
FALSE
, 0, 
TRUE
, 
f‹m©
, 
¨gLi°
);

160 
	`va_íd
(
¨gLi°
);

162 
	`ãrmö©e
(
TRUE
);

163 
	}
}

168 
	$ußgeEº
(c⁄° *
f‹m©
, ...)

170 
va_li°
 
¨gLi°
;

172 
	`fÊush
(
°dout
);

174 
	`Ârötf
(
°dîr
, "Usage: ");

175 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

176 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
¨gLi°
);

177 
	`va_íd
(
¨gLi°
);

179 
	`fÊush
(
°dîr
);

180 
	`exô
(
EXIT_FAILURE
);

181 
	}
}

187 
	$cmdLöeEº
(c⁄° *
f‹m©
, ...)

189 
va_li°
 
¨gLi°
;

191 
	`fÊush
(
°dout
);

193 
	`Ârötf
(
°dîr
, "Command-line usageÉrror: ");

194 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

195 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
¨gLi°
);

196 
	`va_íd
(
¨gLi°
);

198 
	`fÊush
(
°dîr
);

199 
	`exô
(
EXIT_FAILURE
);

200 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/error_functions.h

16 #i‚de‡
ERROR_FUNCTIONS_H


17 
	#ERROR_FUNCTIONS_H


	)

21 
îrMsg
(c⁄° *
f‹m©
, ...);

23 #ifde‡
__GNUC__


29 
	#NORETURN
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

	)

31 
	#NORETURN


	)

34 
	$îrExô
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

36 
	$îr_exô
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

38 
	$îrExôEN
(
î∫um
, c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

40 
	$Áèl
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

42 
	$ußgeEº
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

44 
	$cmdLöeEº
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/get_num.h

16 #i‚de‡
GET_NUM_H


17 
	#GET_NUM_H


	)

19 
	#GN_NONNEG
 01

	)

20 
	#GN_GT_0
 02

	)

23 
	#GN_ANY_BASE
 0100

	)

24 
	#GN_BASE_8
 0200

	)

25 
	#GN_BASE_16
 0400

	)

27 
gëL⁄g
(c⁄° *
¨g
, 
Êags
, c⁄° *
«me
);

29 
gëI¡
(c⁄° *
¨g
, 
Êags
, c⁄° *
«me
);

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tlpi_hdr.h

16 #i‚de‡
TLPI_HDR_H


17 
	#TLPI_HDR_H


	)

19 
	~<sys/ty≥s.h
>

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

23 
	~<uni°d.h
>

24 
	~<î∫o.h
>

25 
	~<°rög.h
>

27 
	~"gë_num.h
"

30 
	~"îr‹_fun˘i⁄s.h
"

35 #ifde‡
TRUE


36 #unde‡
TRUE


39 #ifde‡
FALSE


40 #unde‡
FALSE


43 íum { 
	mFALSE
, 
	mTRUE
 } 
	tBoﬁón
;

45 
	#mö
(
m
,
n
Ë((mË< (nË? (mË: (n))

	)

46 
	#max
(
m
,
n
Ë((mË> (nË? (mË: (n))

	)

50 #i‡
deföed
(
__sgi
)

51 
	tsockÀn_t
;

57 
	~"Æt_fun˘i⁄s.h
"

60 #i‡
deföed
(
__sun
)

61 
	~<sys/fûe.h
>

64 #i‡! 
deföed
(
O_ASYNC
Ë&& deföed(
FASYNC
)

66 
	#O_ASYNC
 
FASYNC


	)

69 #i‡
deföed
(
MAP_ANON
Ë&& ! deföed(
MAP_ANONYMOUS
)

71 
	#MAP_ANONYMOUS
 
MAP_ANON


	)

75 #i‡! 
deföed
(
O_SYNC
Ë&& deföed(
O_FSYNC
)

77 
	#O_SYNC
 
O_FSYNC


	)

80 #i‡
deföed
(
__FªeBSD__
)

84 
	#sivÆ_öt
 
sigvÆ_öt


	)

85 
	#sivÆ_±r
 
sigvÆ_±r


	)

101 
	$ouçutEº‹
(
Boﬁón
 
u£Eº
, 
îr
, Boﬁó¿
ÊushStdout
,

102 c⁄° *
f‹m©
, 
va_li°
 
≠
)

104 
	#BUF_SIZE
 500

	)

105 
buf
[
BUF_SIZE
], 
u£rMsg
[BUF_SIZE], 
îrText
[BUF_SIZE];

107 
	`v¢¥ötf
(
u£rMsg
, 
BUF_SIZE
, 
f‹m©
, 
≠
);

109 i‡(
u£Eº
)

110 
	`¢¥ötf
(
îrText
, 
BUF_SIZE
, " [%s %s]",

111 (
îr
 > 0 &&Éº <
MAX_ENAME
) ?

112 
íame
[
îr
] : "?UNKNOWN?", 
	`°ªº‹
(err));

114 
	`¢¥ötf
(
îrText
, 
BUF_SIZE
, ":");

116 
	`¢¥ötf
(
buf
, 
BUF_SIZE
, "ERROR%†%s\n", 
îrText
, 
u£rMsg
);

117 i‡(
ÊushStdout
)

118 
	`fÊush
(
°dout
);

119 
	`Âuts
(
buf
, 
°dîr
);

120 
	`fÊush
(
°dîr
);

121 
	}
}

127 
	$îrExô
(
î∫um
, c⁄° *
f‹m©
, ...)

129 
va_li°
 
¨gLi°
;

131 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

132 
	`ouçutEº‹
(
TRUE
, 
î∫um
, TRUE, 
f‹m©
, 
¨gLi°
);

133 
	`va_íd
(
¨gLi°
);

135 
	`ãrmö©e
(
TRUE
);

136 
	}
}

140 
	$ÁèlEº‹
(
î∫um
, *
msg
)

142 
	`Ârötf
(
°dîr
, "F©Æ Eº‹:Éº %d: %s\n", 
î∫um
, 
msg
);

143 
	`exô
 (1);

144 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/convenient.h

23 #i‚de‡
__CONVENIENT_H__


24 
	#__CONVENIENT_H__


	)

26 
	~<asm/∑øm.h
>

27 
	~<löux/sched.h
>

29 
	tBoﬁ
;

31 #i‚de‡
__KERNEL__


32 
	$h™dÀEº
(* 
‚
, 
Boﬁ
 
u£_î∫o
, Boﬁ 
Áèl_îr‹
)

34 
	`Ârötf
(
°dîr
, "%s:Éº‹!\n", 
‚
);

35 i‡(
u£_î∫o
)

36 
	`≥º‹
("failed.");

37 i‡(
Áèl_îr‹
)

38 
	`exô
 (
EXIT_FAILURE
);

39 
	}
}

44 
	#PRINT_IRQCTX
() { \

45 i‡(
	`¥ötk_øãlimô
()) \

46 
	`¥ötk
(" %s: in_interrupt:%3s in_irq:%3s in_softirq:%3s in_serving_softirq:%3s. cpu #%2dÖreempt_count=%x\n", \

47 
__func__
, (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

48 (
	`ö_£rvög_so·úq
()?"yes":"no"), 
	`smp_¥o˚ss‹_id
(), 
	`¥ìm±_cou¡
()); \

49 }

	)

51 #ifde‡
DEBUG


52 #ifde‡
__KERNEL__


53 
	#MSG
(
°rög
, 
¨gs
...) \

54 
	`¥ötk
(
KERN_INFO
 "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

56 
	#MSG
(
°rög
, 
¨gs
...) \

57 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

60 #ifde‡
__KERNEL__


61 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

62 
	`¥ötk
(
KERN_INFO
 
°rög
, ##
¨gs
)

	)

64 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

65 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
)

	)

68 
	#QP
 
	`MSG
("\n")

	)

70 #ifde‡
__KERNEL__


71 
	#QPDS
 do { \

72 
	`MSG
("\n"); \

73 
	`dump_°ack
(); \

74 } 0)

	)

75 
	#PRCS_CTX
 do { \

76 i‡(!
	`ö_öãºu±
()) { \

77 
	`MSG
("¥c†˘x: %s(%d)\n", 
cuºít
->
comm
, cuºít->
pid
); \

80 
	`MSG
("irq ctx\n"); \

81 
	`PRINT_IRQCTX
(); \

83 } 0)

	)

86 
	#MSG
(
°rög
, 
¨gs
...)

	)

87 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

88 
	#QP


	)

89 
	#QPDS


	)

95 #ifde‡
__KERNEL__


96 
	#as£π
(
ex¥
) \

97 i‡(!(
ex¥
)) { \

98 
	`¥ötk
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

99 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

100 }

	)

104 
ölöe
 
	$bìp
(
wh©
)

106 #ifde‡
__KERNEL__


107 ()
	`¥ötk
(
KERN_INFO
 "%c", ()
wh©
 );

109 ()
	`¥ötf
("%c", ()
wh©
 );

111 
	}
}

118 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

120 
c
=0, 
m
;\

121 
f‹_ödex
,
ö√r_ödex
; \

123 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

124 
	`bìp
((
vÆ
)); \

125 
c
++;\

126 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

127 
m
=0;m<50;m++); \

130 }

	)

133 #ifde‡
__KERNEL__


138 
	#DELAY_SEC
(
vÆ
) \

140 i‡(!
	`ö_öãºu±
()) { \

141 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

142 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

144 }

	)

151 
timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
, timevÆ *
y
);

155 
	$timevÆ_subåa˘
 (
timevÆ
 *
ªsu…
, timevÆ *
x
, timevÆ *
y
)

158 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

159 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

160 
y
->
tv_u£c
 -1000000 * 
n£c
;

161 
y
->
tv_£c
 +
n£c
;

163 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

164 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

165 
y
->
tv_u£c
 +1000000 * 
n£c
;

166 
y
->
tv_£c
 -
n£c
;

171 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

172 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

175  
x
->
tv_£c
 < 
y
->tv_sec;

176 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/strerror.c

15 
	#_GNU_SOURCE


	)

17 
	~<°dio.h
>

18 
	~<°rög.h
>

20 
	#MAX_ERROR_LEN
 256

	)

23 
	gbuf
[
MAX_ERROR_LEN
];

26 
	$°ªº‹
(
îr
)

28 i‡(
îr
 < 0 ||Éº >
_sys_√º
 || 
_sys_îæi°
[îr] =
NULL
) {

29 
	`¢¥ötf
(
buf
, 
MAX_ERROR_LEN
, "Unknow¿îr‹ %d", 
îr
);

31 
	`°∫˝y
(
buf
, 
_sys_îæi°
[
îr
], 
MAX_ERROR_LEN
 - 1);

32 
buf
[
MAX_ERROR_LEN
 - 1] = '\0';

35  
buf
;

36 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/strerror_test.c

15 
	~<°dio.h
>

16 
	~<°rög.h
>

17 
	~<±hªad.h
>

18 
	~"../épi_hdr.h
"

19 
	~"c⁄víõ¡.h
"

22 
	$thªadFunc
(*
¨g
)

24 *
°r
;

26 
	`¥ötf
("OtherÅhreadáboutÅo call strerror()\n");

27 
°r
 = 
	`°ªº‹
(
EPERM
);

28 
	`¥ötf
("OthîÅhªad: så (%pË%s\n", 
°r
, str);

30  
NULL
;

31 
	}
}

34 
	$maö
(
¨gc
, *
¨gv
[])

36 
±hªad_t
 
t
;

37 
s
;

38 *
°r
;

40 
°r
 = 
	`°ªº‹
(
EINVAL
);

41 
	`¥ötf
("MainÅhread has called strerror()\n");

43 
s
 = 
	`±hªad_¸óã
(&
t
, 
NULL
, 
thªadFunc
, NULL);

44 i‡(
s
 != 0)

45 
	`h™dÀEº
("±hªad_¸óã", 
TRUE
, TRUE);

47 
s
 = 
	`±hªad_joö
(
t
, 
NULL
);

48 i‡(
s
 != 0)

49 
	`h™dÀEº
("±hªad_¸óã", 
TRUE
, TRUE);

54 
	`¥ötf
("MaöÅhªad: så (%pË%s\n", 
°r
, str);

56 
	`exô
(
EXIT_SUCCESS
);

57 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/strerror_tls.c

21 
	#_GNU_SOURCE


	)

23 
	~<°dio.h
>

24 
	~<°rög.h
>

25 
	~<±hªad.h
>

27 
	#MAX_ERROR_LEN
 256

	)

30 
__thªad
 
	gbuf
[
MAX_ERROR_LEN
];

34 
	$°ªº‹
(
îr
)

36 i‡(
îr
 < 0 ||Éº >
_sys_√º
 || 
_sys_îæi°
[îr] =
NULL
) {

37 
	`¢¥ötf
(
buf
, 
MAX_ERROR_LEN
, "Unknow¿îr‹ %d", 
îr
);

39 
	`°∫˝y
(
buf
, 
_sys_îæi°
[
îr
], 
MAX_ERROR_LEN
 - 1);

40 
buf
[
MAX_ERROR_LEN
 - 1] = '\0';

43  
buf
;

44 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/strerror_tsd.c

18 
	#_GNU_SOURCE


	)

20 
	~<°dio.h
>

21 
	~<°rög.h
>

22 
	~<±hªad.h
>

23 
	~"../épi_hdr.h
"

24 
	~"c⁄víõ¡.h
"

26 
±hªad_⁄˚_t
 
	g⁄˚
 = 
PTHREAD_ONCE_INIT
;

27 
±hªad_key_t
 
	g°ªº‹Key
;

29 
	#MAX_ERROR_LEN
 256

	)

33 
	$de°ru˘‹
(*
buf
)

35 
	`‰ì
(
buf
);

36 
	}
}

39 
	$¸óãKey
()

41 
s
;

46 
s
 = 
	`±hªad_key_¸óã
(&
°ªº‹Key
, 
de°ru˘‹
);

47 i‡(
s
 != 0)

48 
	`h™dÀEº
("±hªad_key_¸óã", 
TRUE
, TRUE);

49 
	}
}

52 
	$°ªº‹
(
îr
)

54 
s
;

55 *
buf
;

59 
s
 = 
	`±hªad_⁄˚
(&
⁄˚
, 
¸óãKey
);

60 i‡(
s
 != 0)

61 
	`h™dÀEº
("±hªad_⁄˚", 
TRUE
, TRUE);

63 
buf
 = 
	`±hªad_gë•ecific
(
°ªº‹Key
);

64 i‡(
buf
 =
NULL
) {

66 
buf
 = 
	`mÆloc
(
MAX_ERROR_LEN
);

67 i‡(
buf
 =
NULL
)

68 
	`h™dÀEº
("mÆloc", 
FALSE
, 
TRUE
);

70 
s
 = 
	`±hªad_£t•ecific
(
°ªº‹Key
, 
buf
);

71 i‡(
s
 != 0)

72 
	`h™dÀEº
("±hªad_£t•ecific", 
TRUE
, TRUE);

75 i‡(
îr
 < 0 ||Éº >
_sys_√º
 || 
_sys_îæi°
[îr] =
NULL
) {

76 
	`¢¥ötf
(
buf
, 
MAX_ERROR_LEN
, "Unknow¿îr‹ %d", 
îr
);

78 
	`°∫˝y
(
buf
, 
_sys_îæi°
[
îr
], 
MAX_ERROR_LEN
 - 1);

79 
buf
[
MAX_ERROR_LEN
 - 1] = '\0';

82  
buf
;

83 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/alt_functions.h

16 #i‚de‡
ALT_FUNCTIONS_H


17 
	#ALT_FUNCTIONS_H


	)

19 #i‡
deföed
(
__osf__
Ë|| deföed(
__hpux
Ë|| deföed(
_AIX
) || \

20 
deföed
(
__sgi
Ë|| 
	$deföed
(
__APPLE__
)

21 
	#°rsig«l
(
sig
Ë
	`ALT_°rsig«l
(sig)

	)

23 *
	`ALT_°rsig«l
(
sig
);

25 #i‡
	`deföed
(
__hpux
Ë|| deföed(
__osf__
)

26 
	#h°ªº‹
(
îr
Ë
	`ALT_h°ªº‹
”º)

	)

28 *
	`ALT_h°ªº‹
(
sig
);

30 #i‡
	`deföed
(
__hpux
Ë|| deföed(
__osf__
)

31 
	#posix_›í±
(
Êags
Ë
	`ALT_posix_›í±
(Êags)

	)

33 
	`ALT_posix_›í±
(
Êags
);

	@Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/error_functions.c

16 
	~<°d¨g.h
>

17 
	~"îr‹_fun˘i⁄s.h
"

18 
	~"épi_hdr.h
"

19 
	~"íame.c.öc
"

21 #ifde‡
__GNUC__


22 
__©åibuã__
 ((
__n‹ëu∫__
))

25 
	$ãrmö©e
(
Boﬁón
 
u£Exô3
)

27 *
s
;

33 
s
 = 
	`gëív
("EF_DUMPCORE");

35 i‡(
s
 !
NULL
 && *s != '\0')

36 
	`ab‹t
();

37 i‡(
u£Exô3
)

38 
	`exô
(
EXIT_FAILURE
);

40 
	`_exô
(
EXIT_FAILURE
);

41 
	}
}

53 
	$ouçutEº‹
(
Boﬁón
 
u£Eº
, 
îr
, Boﬁó¿
ÊushStdout
,

54 c⁄° *
f‹m©
, 
va_li°
 
≠
)

56 
	#BUF_SIZE
 500

	)

57 
buf
[
BUF_SIZE
], 
u£rMsg
[BUF_SIZE], 
îrText
[BUF_SIZE];

59 
	`v¢¥ötf
(
u£rMsg
, 
BUF_SIZE
, 
f‹m©
, 
≠
);

61 i‡(
u£Eº
)

62 
	`¢¥ötf
(
îrText
, 
BUF_SIZE
, " [%s %s]",

63 (
îr
 > 0 &&Éº <
MAX_ENAME
) ?

64 
íame
[
îr
] : "?UNKNOWN?", 
	`°ªº‹
(err));

66 
	`¢¥ötf
(
îrText
, 
BUF_SIZE
, ":");

68 
	`¢¥ötf
(
buf
, 
BUF_SIZE
, "ERROR%†%s\n", 
îrText
, 
u£rMsg
);

70 i‡(
ÊushStdout
)

71 
	`fÊush
(
°dout
);

72 
	`Âuts
(
buf
, 
°dîr
);

73 
	`fÊush
(
°dîr
);

74 
	}
}

80 
	$îrMsg
(c⁄° *
f‹m©
, ...)

82 
va_li°
 
¨gLi°
;

83 
ßvedEºno
;

85 
ßvedEºno
 = 
î∫o
;

87 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

88 
	`ouçutEº‹
(
TRUE
, 
î∫o
, TRUE, 
f‹m©
, 
¨gLi°
);

89 
	`va_íd
(
¨gLi°
);

91 
î∫o
 = 
ßvedEºno
;

92 
	}
}

98 
	$îrExô
(c⁄° *
f‹m©
, ...)

100 
va_li°
 
¨gLi°
;

102 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

103 
	`ouçutEº‹
(
TRUE
, 
î∫o
, TRUE, 
f‹m©
, 
¨gLi°
);

104 
	`va_íd
(
¨gLi°
);

106 
	`ãrmö©e
(
TRUE
);

107 
	}
}

125 
	$îr_exô
(c⁄° *
f‹m©
, ...)

127 
va_li°
 
¨gLi°
;

129 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

130 
	`ouçutEº‹
(
TRUE
, 
î∫o
, 
FALSE
, 
f‹m©
, 
¨gLi°
);

131 
	`va_íd
(
¨gLi°
);

133 
	`ãrmö©e
(
FALSE
);

134 
	}
}

140 
	$îrExôEN
(
î∫um
, c⁄° *
f‹m©
, ...)

142 
va_li°
 
¨gLi°
;

144 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

145 
	`ouçutEº‹
(
TRUE
, 
î∫um
, TRUE, 
f‹m©
, 
¨gLi°
);

146 
	`va_íd
(
¨gLi°
);

148 
	`ãrmö©e
(
TRUE
);

149 
	}
}

154 
	$Áèl
(c⁄° *
f‹m©
, ...)

156 
va_li°
 
¨gLi°
;

158 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

159 
	`ouçutEº‹
(
FALSE
, 0, 
TRUE
, 
f‹m©
, 
¨gLi°
);

160 
	`va_íd
(
¨gLi°
);

162 
	`ãrmö©e
(
TRUE
);

163 
	}
}

168 
	$ußgeEº
(c⁄° *
f‹m©
, ...)

170 
va_li°
 
¨gLi°
;

172 
	`fÊush
(
°dout
);

174 
	`Ârötf
(
°dîr
, "Usage: ");

175 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

176 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
¨gLi°
);

177 
	`va_íd
(
¨gLi°
);

179 
	`fÊush
(
°dîr
);

180 
	`exô
(
EXIT_FAILURE
);

181 
	}
}

187 
	$cmdLöeEº
(c⁄° *
f‹m©
, ...)

189 
va_li°
 
¨gLi°
;

191 
	`fÊush
(
°dout
);

193 
	`Ârötf
(
°dîr
, "Command-line usageÉrror: ");

194 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

195 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
¨gLi°
);

196 
	`va_íd
(
¨gLi°
);

198 
	`fÊush
(
°dîr
);

199 
	`exô
(
EXIT_FAILURE
);

200 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/error_functions.h

16 #i‚de‡
ERROR_FUNCTIONS_H


17 
	#ERROR_FUNCTIONS_H


	)

21 
îrMsg
(c⁄° *
f‹m©
, ...);

23 #ifde‡
__GNUC__


29 
	#NORETURN
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

	)

31 
	#NORETURN


	)

34 
	$îrExô
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

36 
	$îr_exô
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

38 
	$îrExôEN
(
î∫um
, c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

40 
	$Áèl
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

42 
	$ußgeEº
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

44 
	$cmdLöeEº
(c⁄° *
f‹m©
, ...Ë
NORETURN
 ;

	@Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/get_num.h

16 #i‚de‡
GET_NUM_H


17 
	#GET_NUM_H


	)

19 
	#GN_NONNEG
 01

	)

20 
	#GN_GT_0
 02

	)

23 
	#GN_ANY_BASE
 0100

	)

24 
	#GN_BASE_8
 0200

	)

25 
	#GN_BASE_16
 0400

	)

27 
gëL⁄g
(c⁄° *
¨g
, 
Êags
, c⁄° *
«me
);

29 
gëI¡
(c⁄° *
¨g
, 
Êags
, c⁄° *
«me
);

	@Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/thread_cancel.c

15 
	~<±hªad.h
>

16 
	~"épi_hdr.h
"

19 
	$thªadFunc
(*
¨g
)

21 
j
;

23 
	`¥ötf
("NewÅhread started\n");

24 
j
 = 1; ; j++) {

25 
	`¥ötf
("Lo› %d\n", 
j
);

26 
	`¶ìp
(1);

34  
NULL
;

35 
	}
}

38 
	$maö
(
¨gc
, *
¨gv
[])

40 
±hªad_t
 
thr
;

41 
s
;

42 *
ªs
;

44 
s
 = 
	`±hªad_¸óã
(&
thr
, 
NULL
, 
thªadFunc
, NULL);

45 i‡(
s
 != 0)

46 
	`ÁèlEº‹
(
s
, "pthread_create");

48 
	`¶ìp
(3);

50 
s
 = 
	`±hªad_ˇn˚l
(
thr
);

51 i‡(
s
 != 0)

52 
	`ÁèlEº‹
(
s
, "pthread_cancel");

54 
s
 = 
	`±hªad_joö
(
thr
, &
ªs
);

55 i‡(
s
 != 0)

56 
	`ÁèlEº‹
(
s
, "pthread_join");

58 i‡(
ªs
 =
PTHREAD_CANCELED
)

59 
	`¥ötf
("Thread was canceled\n");

61 
	`¥ötf
("Thread wasÇot canceled (shouldÇot happen!)\n");

63 
	`exô
(
EXIT_SUCCESS
);

64 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/thread_cleanup.c

16 
	~<±hªad.h
>

17 
	~"épi_hdr.h
"

19 
±hªad_c⁄d_t
 
	gc⁄d
 = 
PTHREAD_COND_INITIALIZER
;

20 
±hªad_muãx_t
 
	gmtx
 = 
PTHREAD_MUTEX_INITIALIZER
;

21 
	gglob
 = 0;

24 
	$˛ónupH™dÀr
(*
¨g
)

26 
s
;

28 
	`¥ötf
("˛ónup: fªeög blockáà%p\n", 
¨g
);

29 
	`‰ì
(
¨g
);

31 
	`¥ötf
("cleanup: unlocking mutex\n");

32 
s
 = 
	`±hªad_muãx_u∆ock
(&
mtx
);

33 i‡(
s
 != 0)

34 
	`ÁèlEº‹
(
s
, "pthread_mutex_unlock");

35 
	}
}

38 
	$thªadFunc
(*
¨g
)

40 
s
;

41 *
buf
 = 
NULL
;

43 
buf
 = 
	`mÆloc
(0x10000);

44 
	`¥ötf
("thªad:áŒoˇãd mem‹yáà%p\n", 
buf
);

46 
s
 = 
	`±hªad_muãx_lock
(&
mtx
);

47 i‡(
s
 != 0)

48 
	`ÁèlEº‹
(
s
, "pthread_mutex_lock");

53 
	`±hªad_˛ónup_push
(
˛ónupH™dÀr
, 
buf
);

55 
glob
 == 0) {

56 
s
 = 
	`±hªad_c⁄d_waô
(&
c⁄d
, &
mtx
);

57 i‡(
s
 != 0)

58 
	`ÁèlEº‹
(
s
, "pthread_cond_wait");

61 
	`¥ötf
("thread: condition waitÜoop completed;Åhe condition we're waiting for has occured!\n");

67 
	`±hªad_˛ónup_p›
(1);

68  
NULL
;

69 
	}
}

72 
	$maö
(
¨gc
, *
¨gv
[])

74 
±hªad_t
 
thr
;

75 *
ªs
;

76 
s
;

78 
s
 = 
	`±hªad_¸óã
(&
thr
, 
NULL
, 
thªadFunc
, NULL);

79 i‡(
s
 != 0)

80 
	`ÁèlEº‹
(
s
, "pthread_create");

82 
	`¶ìp
(2);

84 i‡(
¨gc
 == 1) {

85 
	`¥ötf
("main:áboutÅo cancelÅhread\n");

86 
s
 = 
	`±hªad_ˇn˚l
(
thr
);

87 i‡(
s
 != 0)

88 
	`ÁèlEº‹
(
s
, "pthread_cancel");

91 
	`¥ötf
("main:áboutÅo signal condition variable\n");

92 
s
 = 
	`±hªad_muãx_lock
(&
mtx
);

93 i‡(
s
 != 0)

94 
	`ÁèlEº‹
(
s
, "pthread_mutex_lock");

95 
glob
 = 1;

96 
s
 = 
	`±hªad_muãx_u∆ock
(&
mtx
);

97 i‡(
s
 != 0)

98 
	`ÁèlEº‹
(
s
, "pthread_mutex_unlock");

99 
s
 = 
	`±hªad_c⁄d_sig«l
(&
c⁄d
);

100 i‡(
s
 != 0)

101 
	`ÁèlEº‹
(
s
, "pthread_cond_signal");

104 
s
 = 
	`±hªad_joö
(
thr
, &
ªs
);

105 i‡(
s
 != 0)

106 
	`ÁèlEº‹
(
s
, "pthread_join");

107 i‡(
ªs
 =
PTHREAD_CANCELED
)

108 
	`¥ötf
("main:Åhread was canceled\n");

110 
	`¥ötf
("main:ÅhreadÅerminatedÇormally\n");

112 
	`exô
(
EXIT_SUCCESS
);

113 
	}
}

	@Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/tlpi_hdr.h

16 #i‚de‡
TLPI_HDR_H


17 
	#TLPI_HDR_H


	)

19 
	~<sys/ty≥s.h
>

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

23 
	~<uni°d.h
>

24 
	~<î∫o.h
>

25 
	~<°rög.h
>

27 
	~"gë_num.h
"

30 
	~"îr‹_fun˘i⁄s.h
"

35 #ifde‡
TRUE


36 #unde‡
TRUE


39 #ifde‡
FALSE


40 #unde‡
FALSE


43 íum { 
	mFALSE
, 
	mTRUE
 } 
	tBoﬁón
;

45 
	#mö
(
m
,
n
Ë((mË< (nË? (mË: (n))

	)

46 
	#max
(
m
,
n
Ë((mË> (nË? (mË: (n))

	)

50 #i‡
deföed
(
__sgi
)

51 
	tsockÀn_t
;

57 
	~"Æt_fun˘i⁄s.h
"

60 #i‡
deföed
(
__sun
)

61 
	~<sys/fûe.h
>

64 #i‡! 
deföed
(
O_ASYNC
Ë&& deföed(
FASYNC
)

66 
	#O_ASYNC
 
FASYNC


	)

69 #i‡
deföed
(
MAP_ANON
Ë&& ! deföed(
MAP_ANONYMOUS
)

71 
	#MAP_ANONYMOUS
 
MAP_ANON


	)

75 #i‡! 
deföed
(
O_SYNC
Ë&& deföed(
O_FSYNC
)

77 
	#O_SYNC
 
O_FSYNC


	)

80 #i‡
deföed
(
__FªeBSD__
)

84 
	#sivÆ_öt
 
sigvÆ_öt


	)

85 
	#sivÆ_±r
 
sigvÆ_±r


	)

101 
	$ouçutEº‹
(
Boﬁón
 
u£Eº
, 
îr
, Boﬁó¿
ÊushStdout
,

102 c⁄° *
f‹m©
, 
va_li°
 
≠
)

104 
	#BUF_SIZE
 500

	)

105 
buf
[
BUF_SIZE
], 
u£rMsg
[BUF_SIZE], 
îrText
[BUF_SIZE];

107 
	`v¢¥ötf
(
u£rMsg
, 
BUF_SIZE
, 
f‹m©
, 
≠
);

109 i‡(
u£Eº
)

110 
	`¢¥ötf
(
îrText
, 
BUF_SIZE
, " [%s %s]",

111 (
îr
 > 0 &&Éº <
MAX_ENAME
) ?

112 
íame
[
îr
] : "?UNKNOWN?", 
	`°ªº‹
(err));

114 
	`¢¥ötf
(
îrText
, 
BUF_SIZE
, ":");

116 
	`¢¥ötf
(
buf
, 
BUF_SIZE
, "ERROR%†%s\n", 
îrText
, 
u£rMsg
);

117 i‡(
ÊushStdout
)

118 
	`fÊush
(
°dout
);

119 
	`Âuts
(
buf
, 
°dîr
);

120 
	`fÊush
(
°dîr
);

121 
	}
}

127 
	$îrExô
(
î∫um
, c⁄° *
f‹m©
, ...)

129 
va_li°
 
¨gLi°
;

131 
	`va_°¨t
(
¨gLi°
, 
f‹m©
);

132 
	`ouçutEº‹
(
TRUE
, 
î∫um
, TRUE, 
f‹m©
, 
¨gLi°
);

133 
	`va_íd
(
¨gLi°
);

135 
	`ãrmö©e
(
TRUE
);

136 
	}
}

140 
	$ÁèlEº‹
(
î∫um
, *
msg
)

142 
	`Ârötf
(
°dîr
, "F©Æ Eº‹:Éº %d: %s\n", 
î∫um
, 
msg
);

143 
	`exô
 (1);

144 
	}
}

	@Training/L1_sysprg_trg/pthreads/tls_eg/strerror.c

15 
	#_GNU_SOURCE


	)

17 
	~<°dio.h
>

18 
	~<°dlib.h
>

19 
	~<uni°d.h
>

20 
	~<î∫o.h
>

21 
	~<±hªad.h
>

22 
	~<°rög.h
>

24 
	#MAX_ERROR_LEN
 256

	)

27 
	gbuf
[
MAX_ERROR_LEN
];

30 
	$°ªº‹_unß„
(
îr
)

32 i‡(
îr
 < 0 ||Éº >
_sys_√º
 || 
_sys_îæi°
[îr] =
NULL
) {

33 
	`¢¥ötf
(
buf
, 
MAX_ERROR_LEN
, "Unknow¿îr‹ %d", 
îr
);

35 
	`°∫˝y
(
buf
, 
_sys_îæi°
[
îr
], 
MAX_ERROR_LEN
 - 1);

36 
buf
[
MAX_ERROR_LEN
 - 1] = '\0';

39  
buf
;

40 
	}
}

42 * 
	$thrd_func
(* 
¨g
)

44 *
°r
 = 
	`°ªº‹_unß„
(
ENOMEM
);

45 
	`¥ötf
("%s: &bu‡%∞; så (%pË%s\n", "thrd_func", 
buf
, 
°r
, str);

46 
	`±hªad_exô
(0);

47 
	}
}

49 
	$maö
()

51 
±hªad_t
 
t1
;

52 *
°r
;

53 
rc
;

55 
°r
 = 
	`°ªº‹_unß„
(
EPERM
);

56 
	`¥ötf
("maö: &bu‡%∞; så (%pË%s\n", 
buf
, 
°r
, str);

58 
±hªad_©å_t
 
©å
;

59 
	`±hªad_©å_öô
(&
©å
);

60 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

61 i‡(
	`±hªad_¸óã
(&
t1
, &
©å
, 
thrd_func
, 
NULL
)) {

62 
	`≥º‹
("p_¯Áûed"); 
	`exô
(1);

65 
rc
 = 
	`±hªad_joö
(
t1
, 
NULL
);

66 i‡(
rc
) {

67 
	`¥ötf
("ERROR;Ñëu∫ codê‰omÖthªad_joö(Ëi†%d\n", 
rc
);

68 
	`exô
(1);

71 
	}
}

	@Training/L1_sysprg_trg/pthreads/tls_eg/strerror_tls.c

21 
	#_GNU_SOURCE


	)

23 
	~<°dio.h
>

24 
	~<uni°d.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

27 
	~<±hªad.h
>

28 
	~<î∫o.h
>

30 
	#MAX_ERROR_LEN
 256

	)

32 
__thªad
 
	gbuf
[
MAX_ERROR_LEN
];

35 
	$°ªº‹
(
îr
)

37 i‡(
îr
 < 0 ||Éº >
_sys_√º
 || 
_sys_îæi°
[îr] =
NULL
) {

38 
	`¢¥ötf
(
buf
, 
MAX_ERROR_LEN
, "Unknow¿îr‹ %d", 
îr
);

40 
	`°∫˝y
(
buf
, 
_sys_îæi°
[
îr
], 
MAX_ERROR_LEN
 - 1);

41 
buf
[
MAX_ERROR_LEN
 - 1] = '\0';

44  
buf
;

45 
	}
}

47 * 
	$thrd_func
(* 
¨g
)

49 *
°r
 = 
	`°ªº‹
(
ENOMEM
);

50 
	`¥ötf
("%s: &bu‡%∞; så (%pË%s\n", "thrd_func", 
buf
, 
°r
, str);

51 
	`±hªad_exô
(0);

52 
	}
}

54 
	$maö
()

56 
±hªad_t
 
t1
;

57 *
°r
;

58 
rc
;

60 
°r
 = 
	`°ªº‹
(
EPERM
);

61 
	`¥ötf
("maö: &bu‡%∞; så (%pË%s\n", 
buf
, 
°r
, str);

63 
±hªad_©å_t
 
©å
;

64 
	`±hªad_©å_öô
(&
©å
);

65 
	`±hªad_©å_£tdëach°©e
(&
©å
, 
PTHREAD_CREATE_JOINABLE
);

66 i‡(
	`±hªad_¸óã
(&
t1
, &
©å
, 
thrd_func
, 
NULL
)) {

67 
	`≥º‹
("p_¯Áûed"); 
	`exô
(1);

70 
rc
 = 
	`±hªad_joö
(
t1
, 
NULL
);

71 i‡(
rc
) {

72 
	`¥ötf
("ERROR;Ñëu∫ codê‰omÖthªad_joö(Ëi†%d\n", 
rc
);

73 
	`exô
(1);

76 
	}
}

	@Training/L1_sysprg_trg/restart_lib-Robbins.c

8 
	~<î∫o.h
>

9 
	~<f˙é.h
>

10 
	~<limôs.h
>

11 
	~<°rög.h
>

12 
	~<sys/£À˘.h
>

13 
	~<sys/time.h
>

14 
	~<sys/waô.h
>

16 
	#BLKSIZE
 
PIPE_BUF


	)

17 
	#MILLION
 1000000L

	)

18 
	#D_MILLION
 1000000.0

	)

22 
	$gëtimeout
(
timevÆ
 
íd
, timevÆ *
timeouç
)

24 
	`gëtimeofday
(
timeouç
, 
NULL
);

25 
timeouç
->
tv_£c
 = 
íd
.tv_sec -Åimeoutp->tv_sec;

26 
timeouç
->
tv_u£c
 = 
íd
.tv_usec -Åimeoutp->tv_usec;

27 i‡(
timeouç
->
tv_u£c
 >
MILLION
) {

28 
timeouç
->
tv_£c
++;

29 
timeouç
->
tv_u£c
 -
MILLION
;

31 i‡(
timeouç
->
tv_u£c
 < 0) {

32 
timeouç
->
tv_£c
--;

33 
timeouç
->
tv_u£c
 +
MILLION
;

35 i‡((
timeouç
->
tv_£c
 < 0) ||

36 ((
timeouç
->
tv_£c
 =0Ë&& (timeouç->
tv_u£c
 == 0))) {

37 
î∫o
 = 
ETIME
;

41 
	}
}

45 
	$r_˛o£
(
fûdes
)

47 
ªtvÆ
;

48 
ªtvÆ
 = 
	`˛o£
(
fûdes
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

49  
ªtvÆ
;

50 
	}
}

52 
	$r_dup2
(
fûdes
, 
fûdes2
)

54 
ªtvÆ
;

55 
ªtvÆ
 = 
	`dup2
(
fûdes
, 
fûdes2
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

56  
ªtvÆ
;

57 
	}
}

59 
	$r_›í2
(c⁄° *
∑th
, 
oÊag
)

61 
ªtvÆ
;

62 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

63  
ªtvÆ
;

64 
	}
}

66 
	$r_›í3
(c⁄° *
∑th
, 
oÊag
, 
mode_t
 
mode
)

68 
ªtvÆ
;

69 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
, 
mode
),Ñetval == -1

70 && 
î∫o
 =
EINTR
) ;

71  
ªtvÆ
;

72 
	}
}

74 
ssize_t
 
	$r_ªad
(
fd
, *
buf
, 
size_t
 
size
)

76 
ssize_t
 
ªtvÆ
;

77 
ªtvÆ
 = 
	`ªad
(
fd
, 
buf
, 
size
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

78  
ªtvÆ
;

79 
	}
}

81 
pid_t
 
	$r_waô
(*
°©_loc
)

83 
pid_t
 
ªtvÆ
;

84 ((
ªtvÆ
 = 
	`waô
(
°©_loc
)Ë=-1Ë&& (
î∫o
 =
EINTR
)) ;

85  
ªtvÆ
;

86 
	}
}

88 
pid_t
 
	$r_waôpid
(
pid_t
 
pid
, *
°©_loc
, 
›ti⁄s
)

90 
pid_t
 
ªtvÆ
;

91 ((
ªtvÆ
 = 
	`waôpid
(
pid
, 
°©_loc
, 
›ti⁄s
)) == -1) &&

92 (
î∫o
 =
EINTR
)) ;

93  
ªtvÆ
;

94 
	}
}

96 
ssize_t
 
	$r_wrôe
(
fd
, *
buf
, 
size_t
 
size
)

98 *
buÂ
;

99 
size_t
 
byã°owrôe
;

100 
ssize_t
 
byãswrôãn
;

101 
size_t
 
tŸÆbyãs
;

103 
buÂ
 = 
buf
, 
byã°owrôe
 = 
size
, 
tŸÆbyãs
 = 0;

104 
byã°owrôe
 > 0;

105 
buÂ
 +
byãswrôãn
, 
byã°owrôe
 -= byteswritten) {

106 
byãswrôãn
 = 
	`wrôe
(
fd
, 
buÂ
, 
byã°owrôe
);

107 i‡((
byãswrôãn
Ë=-1 && (
î∫o
 !
EINTR
))

109 i‡(
byãswrôãn
 == -1)

110 
byãswrôãn
 = 0;

111 
tŸÆbyãs
 +
byãswrôãn
;

113  
tŸÆbyãs
;

114 
	}
}

118 
timevÆ
 
	$add2cuºíâime
(
£c⁄ds
)

120 
timevÆ
 
√wtime
;

122 
	`gëtimeofday
(&
√wtime
, 
NULL
);

123 
√wtime
.
tv_£c
 +()
£c⁄ds
;

124 
√wtime
.
tv_u£c
 +()((
£c⁄ds
 - ()£c⁄dsË* 
D_MILLION
 + 0.5);

125 i‡(
√wtime
.
tv_u£c
 >
MILLION
) {

126 
√wtime
.
tv_£c
++;

127 
√wtime
.
tv_u£c
 -
MILLION
;

129  
√wtime
;

130 
	}
}

132 
	$c›yfûe
(
‰omfd
, 
tofd
)

134 
byã§ód
;

135 
tŸÆbyãs
 = 0;

137 (
byã§ód
 = 
	`ªadwrôe
(
‰omfd
, 
tofd
)) > 0)

138 
tŸÆbyãs
 +
byã§ód
;

139  
tŸÆbyãs
;

140 
	}
}

142 
ssize_t
 
	$ªadblock
(
fd
, *
buf
, 
size_t
 
size
)

144 *
buÂ
;

145 
ssize_t
 
byã§ód
;

146 
size_t
 
byã°‹ód
;

147 
size_t
 
tŸÆbyãs
;

149 
buÂ
 = 
buf
, 
byã°‹ód
 = 
size
, 
tŸÆbyãs
 = 0;

150 
byã°‹ód
 > 0; 
buÂ
 +
byã§ód
, bytestoread -= bytesread) {

151 
byã§ód
 = 
	`ªad
(
fd
, 
buÂ
, 
byã°‹ód
);

152 i‡((
byã§ód
 =0Ë&& (
tŸÆbyãs
 == 0))

154 i‡(
byã§ód
 == 0) {

155 
î∫o
 = 
EINVAL
;

158 i‡((
byã§ód
Ë=-1 && (
î∫o
 !
EINTR
))

160 i‡(
byã§ód
 == -1)

161 
byã§ód
 = 0;

162 
tŸÆbyãs
 +
byã§ód
;

164  
tŸÆbyãs
;

165 
	}
}

167 
	$ªadlöe
(
fd
, *
buf
, 
nbyãs
)

169 
numªad
 = 0;

170 
ªtu∫vÆ
;

172 
numªad
 < 
nbyãs
 - 1) {

173 
ªtu∫vÆ
 = 
	`ªad
(
fd
, 
buf
 + 
numªad
, 1);

174 i‡((
ªtu∫vÆ
 =-1Ë&& (
î∫o
 =
EINTR
))

176 i‡((
ªtu∫vÆ
 =0Ë&& (
numªad
 == 0))

178 i‡(
ªtu∫vÆ
 == 0)

180 i‡(
ªtu∫vÆ
 == -1)

182 
numªad
++;

183 i‡(
buf
[
numªad
 - 1] == '\n') {

184 
buf
[
numªad
] = '\0';

185  
numªad
;

188 
î∫o
 = 
EINVAL
;

190 
	}
}

192 
ssize_t
 
	$ªadtimed
(
fd
, *
buf
, 
size_t
 
nbyã
, 
£c⁄ds
)

194 
timevÆ
 
timed⁄e
;

196 
timed⁄e
 = 
	`add2cuºíâime
(
£c⁄ds
);

197 i‡(
	`waôfdtimed
(
fd
, 
timed⁄e
) == -1)

198  (
ssize_t
) (-1);

199  
	`r_ªad
(
fd
, 
buf
, 
nbyã
);

200 
	}
}

202 
	$ªadwrôe
(
‰omfd
, 
tofd
)

204 
buf
[
BLKSIZE
];

205 
byã§ód
;

207 i‡((
byã§ód
 = 
	`r_ªad
(
‰omfd
, 
buf
, 
BLKSIZE
)) < 0)

209 i‡(
byã§ód
 == 0)

211 i‡(
	`r_wrôe
(
tofd
, 
buf
, 
byã§ód
) < 0)

213  
byã§ód
;

214 
	}
}

216 
	$ªadwrôeblock
(
‰omfd
, 
tofd
, *
buf
, 
size
)

218 
byã§ód
;

220 
byã§ód
 = 
	`ªadblock
(
‰omfd
, 
buf
, 
size
);

221 i‡(
byã§ód
 !
size
)

222  
byã§ód
;

223  
	`r_wrôe
(
tofd
, 
buf
, 
size
);

224 
	}
}

226 
	$waôfdtimed
(
fd
, 
timevÆ
 
íd
)

228 
fd_£t
 
ªad£t
;

229 
ªtvÆ
;

230 
timevÆ
 
timeout
;

232 i‡((
fd
 < 0Ë|| (fd >
FD_SETSIZE
)) {

233 
î∫o
 = 
EINVAL
;

236 
	`FD_ZERO
(&
ªad£t
);

237 
	`FD_SET
(
fd
, &
ªad£t
);

238 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

240 ((
ªtvÆ
 = 
	`£À˘
(
fd
 + 1, &
ªad£t
, 
NULL
, NULL, &
timeout
)) == -1)

241 && (
î∫o
 =
EINTR
)) {

242 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

244 
	`FD_ZERO
(&
ªad£t
);

245 
	`FD_SET
(
fd
, &
ªad£t
);

247 i‡(
ªtvÆ
 == 0) {

248 
î∫o
 = 
ETIME
;

251 i‡(
ªtvÆ
 == -1)

254 
	}
}

	@Training/L1_sysprg_trg/setuid_caps/pr_ids/pr_ids.c

9 
	~<°dio.h
>

10 
	~<uni°d.h
>

11 
	~<sys/ty≥s.h
>

12 
	~<°dlib.h
>

14 
	#SHOWIDS
() do { \

15 
	`¥ötf
 ("Now: RUID=%d EUID=%d\n" \

17 
	`gëuid
(), 
	`gëeuid
(), \

18 
	`gëgid
(), 
	`gëegid
()); \

19 } 0)

	)

21 
	$maö
(
¨gc
, **
¨gv
)

23 
	`SHOWIDS
();

24 i‡(0 =
	`gëeuid
()) {

25 
	`¥ötf
("%†nowÉf„˘ivñyÑu¬ögá†roŸ! ...\n", 
¨gv
[0]);

26 
	`¶ìp
(1);

28 
	`exô
(0);

29 
	}
}

	@Training/L1_sysprg_trg/setuid_caps/savedset_ids/savedset_ids.c

11 
	~<°dio.h
>

12 
	~<uni°d.h
>

13 
	~<sys/ty≥s.h
>

14 
	~<löux/limôs.h
>

15 
	~<°dlib.h
>

16 
	~<as£π.h
>

18 
	#SHOWIDS
() do { \

19 
	`¥ötf
 ("Now: RUID=%d EUID=%d\n" \

21 
	`gëuid
(), 
	`gëeuid
(), \

22 
	`gëgid
(), 
	`gëegid
()); \

23 } 0)

	)

25 
	$maö
(
¨gc
, **
¨gv
)

27 
uid_t
 
‹ig_euid
;

28 *
cmd
 = 
	`mÆloc
(
PATH_MAX
);

30 
	`as£π
(
cmd
);

31 
	`¥ötf
("Fú° makêsuªÅh© %†i†™ SUID-roŸ bö¨y\n", 
¨gv
[0]);

32 
	`¢¥ötf
(
cmd
, 128, "l†-»%s", 
¨gv
[0]);

33 
	`sy°em
(
cmd
);

34 
	`SHOWIDS
();

36 i‡(0 !
	`gëeuid
()) {

37 
	`Ârötf
(
°dîr
, "%s:Çotá setuid-rootÉxecutable,ábortingÇow ...\n"

40 , 
¨gv
[0],árgv[0],árgv[0]);

41 
	`‰ì
(
cmd
);

42 
	`exô
(1);

44 
	`¥ötf
("1. Ok, we'reÉffectivelyÑunningásÑoot! (euid==0)\n");

47 
‹ig_euid
 = 
	`gëeuid
();

49 
	`¥ötf
("2. Changing Effective UID backÅo my \"original\" UIDÇow...(and goingÅo sleep for 10s...)\n");

50 i‡(-1 =
	`£ãuid
(
	`gëuid
())) {

51 
	`≥º‹
("seteuid [1] failed");

52 
	`‰ì
(
cmd
);

53 
	`exô
(1);

55 
	`SHOWIDS
();

57 
	`¶ìp
(10);

59 
	`¥ötf
("3. NowÑevertingÅo my saved \'superior\'Örivileges...\n");

60 i‡(-1 =
	`£ãuid
(
‹ig_euid
)) {

61 
	`≥º‹
("seteuid [2] failed");

62 
	`‰ì
(
cmd
);

63 
	`exô
(1);

65 
	`SHOWIDS
();

67 
	`¥ötf
("4. Exiting ...\n");

68 
	`‰ì
(
cmd
);

69 
	`exô
(0);

70 
	}
}

	@Training/L1_sysprg_trg/signalling/chld_sig/chld_sig.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<sig«l.h
>

22 
	~<°rög.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/waô.h
>

26 
	$ˇtchî
(
sig
)

28 
	`¥ötf
("**************** %s():sig %d ****************\n", 
__func__
, 
sig
);

29 
	}
}

31 
	$¶ìp_r
(
£c
)

33 
ªm
 = 
£c
;

35 
ªm
 = 
	`¶ìp
(rem);

36 
	`¥ötf
("%s():ªm=%d\n", 
__func__
, 
ªm
);

37 } 
ªm
);

38 
	}
}

40 
	$di•œyChûdSètus
(
°©
, 
pid_t
 
˝id
)

42 
	`¥ötf
("\nChild %d just died!\n"

51 
˝id
,

52 
	`WIFEXITED
(
°©
),

53 
	`WEXITSTATUS
(
°©
),

54 
	`WIFSIGNALED
(
°©
),

55 
	`WTERMSIG
(
°©
),

56 
	`WIFSTOPPED
(
°©
),

57 
	`WSTOPSIG
(
°©
), 
	`WCOREDUMP
(°©), 
	`WIFCONTINUED
(stat)

59 
	}
}

61 
	$¸óãChûd
(
¶ìp_time
)

63 
pid_t
 
n
;

65 
n
 = 
	`f‹k
()) {

67 
	`≥º‹
("fork");

68 
	`exô
(1);

70 
	`¥ötf
("Chûd 2 PID %d sÀïög f‹ %ds...\n", 
	`gëpid
(),

71 
¶ìp_time
);

72 
	`¶ìp_r
(
¶ìp_time
);

73 
	`exô
(0);

77 
	}
}

79 
	$chkønge
(
num
, 
mö
, 
max
)

81 i‡(
num
 < 
mö
)

83 i‡(
num
 > 
max
)

86 
	}
}

88 
	$maö
(
¨gc
, **
¨gv
)

90 
°©
 = 0;

91 
c1_¶±m
 = 3, 
c2_¶±m
 = 7;

92 
pid_t
 
n
, 
˝id
;

93 
siga˘i⁄
 
a˘
;

95 i‡(
¨gc
 == 3) {

96 
c1_¶±m
 = 
	`©oi
(
¨gv
[1]);

97 i‡(
	`chkønge
(
c1_¶±m
, 1, 60) < 0) {

98 
	`Ârötf
(
°dîr
,

100 "Ñ™gê[1-60]\n", 
¨gv
[0], 
c1_¶±m
);

101 
	`exô
(1);

103 
c2_¶±m
 = 
	`©oi
(
¨gv
[2]);

104 i‡(
	`chkønge
(
c2_¶±m
, 1, 60) < 0) {

105 
	`Ârötf
(
°dîr
,

107 "Ñ™gê[1-60]\n", 
¨gv
[0], 
c2_¶±m
);

108 
	`exô
(1);

113 
	`mem£t
(&
a˘
, 0, (act));

114 
a˘
.
ß_h™dÀr
 = 
ˇtchî
;

115 
	`sigem±y£t
(&
a˘
.
ß_mask
);

117 
a˘
.
ß_Êags
 = 0;

119 i‡(
	`siga˘i⁄
(
SIGUSR1
, &
a˘
, 0) == -1) {

120 
	`≥º‹
("sigaction failure");

121 
	`exô
(1);

125 
n
 = 
	`f‹k
()) {

127 
	`≥º‹
("fork");

128 
	`exô
(1);

130 
	`¥ötf
("Chûd 1 PID %d sÀïög f‹ %ds...\n", 
	`gëpid
(),

131 
c1_¶±m
);

132 
	`¶ìp_r
(
c1_¶±m
);

133 
	`exô
(0);

135 
	`¸óãChûd
(
c2_¶±m
);

136 (
˝id
 = 
	`waô
(&
°©
)) != -1)

137 
	`di•œyChûdSètus
(
°©
, 
˝id
);

139 
	`¥ötf
("\nParent:áll children dead,Éxiting...\n");

140 
	`exô
(0);

141 
	}
}

	@Training/L1_sysprg_trg/signalling/handle_segfault/handle_segv/handle_segv.c

13 
	~<°dio.h
>

14 
	~<°dlib.h
>

15 
	~<uni°d.h
>

16 
	~<sys/ty≥s.h
>

17 
	~<sig«l.h
>

18 
	~<°rög.h
>

19 
	~<˘y≥.h
>

22 
	tu32
;

23 
	tu64
;

26 #i‡
__x86_64__


27 
	#ADDR_TYPE
 
u64


	)

28 
	#ADDR_FMT
 "%016lx"

	)

29 
u64
 
	grubbish_uaddr
 = 0x500f60L;

30 
u64
 
	grubbish_kaddr
 = 0xffff0a8700100000L;

32 
	#ADDR_TYPE
 
u32


	)

33 
	#ADDR_FMT
 "%08lx"

	)

34 
u32
 
	grubbish_uaddr
 = 0x500ffeL;

35 
u32
 
	grubbish_kaddr
 = 0xd0c00000L;

39 
	$myÁu…
(
signum
, 
sigöfo_t
 * 
sigöfo
, *
ª°
)

41 
c
 = 0;

43 
	`¥ötf
("*** %s: [%d]Ñeceived signal %d.Érrno=%d\n"

45 
__func__
, ++
c
, 
signum
, 
sigöfo
->
si_î∫o
, sigöfo->
si_code
);

47 
sigöfo
->
si_code
) {

48 
SI_USER
:

49 
	`¥ötf
("user\n");

51 
SI_KERNEL
:

52 
	`¥ötf
("kernel\n");

54 
SI_QUEUE
:

55 
	`¥ötf
("queue\n");

57 
SI_TIMER
:

58 
	`¥ötf
("timer\n");

60 
SI_MESGQ
:

61 
	`¥ötf
("mesgq\n");

63 
SI_ASYNCIO
:

64 
	`¥ötf
("async io\n");

66 
SI_SIGIO
:

67 
	`¥ötf
("sigio\n");

69 
SI_TKILL
:

70 
	`¥ötf
("t[g]kill\n");

73 
SEGV_MAPERR
:

74 
	`¥ötf
("SEGV_MAPERR:áddressÇot mappedÅo object\n");

76 
SEGV_ACCERR
:

77 
	`¥ötf
("SEGV_ACCERR: invalidÖermissions for mapped object\n");

84 
SEGV_BNDERR
:

85 
	`¥ötf
("SEGV_BNDERR: failedáddress bound checks\n");

86 
SEGV_PKUERR
:

87 
¥ötf


91 
	`¥ötf
("-none-\n");

93 
	`¥ötf
(" Fau…ögáddr=0x" 
ADDR_FMT
 "\n", (
ADDR_TYPE
Ë
sigöfo
->
si_addr
);

96 
	`exô
(1);

98 
	`ab‹t
();

100 
	}
}

102 
	$ußge
(*
nm
)

104 
	`Ârötf
(
°dîr
, "Usage: %s u|kÑ|w\n"

107 "Ñ =>Ñódáâem±\n" " w => wrôê©ãm±\n", 
nm
);

108 
	}
}

110 
	$maö
(
¨gc
, **
¨gv
)

112 
siga˘i⁄
 
a˘
;

114 i‡(
¨gc
 != 3) {

115 
	`ußge
(
¨gv
[0]);

116 
	`exô
(1);

119 
	`mem£t
(&
a˘
, 0, (act));

121 
a˘
.
ß_siga˘i⁄
 = 
myÁu…
;

122 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

123 
	`sigem±y£t
(&
a˘
.
ß_mask
);

129 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

130 
	`≥º‹
("sigaction");

131 
	`exô
(1);

134 i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'r')) {

135 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë
rubbish_uaddr
;

136 
¥ötf


138 
ADDR_FMT
 ":\n", (
ADDR_TYPE
Ë
u±r
);

139 
	`¥ötf
("*u±∏0x" 
ADDR_FMT
 "\n", *
u±r
);

140 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'w')) {

141 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë& 
maö
;

142 
¥ötf


144 
ADDR_FMT
 ":\n", (
ADDR_TYPE
Ë
u±r
);

145 *
u±r
 = 40;

146 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'r')) {

147 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
rubbish_kaddr
;

148 
¥ötf


150 
ADDR_FMT
 ":\n", (
ADDR_TYPE
Ë
k±r
);

151 
	`¥ötf
("*k±∏0x" 
ADDR_FMT
 "\n", *
k±r
);

152 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'w')) {

153 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
rubbish_kaddr
;

154 
¥ötf


156 
ADDR_FMT
 ":\n", (
ADDR_TYPE
Ë
k±r
);

157 *
k±r
 = 0x62;

159 
	`ußge
(
¨gv
[0]);

160 
	`exô
(0);

161 
	}
}

	@Training/L1_sysprg_trg/signalling/handle_segfault/handle_segv_altstack/handle_segv_altstack.c

13 
	~<°dio.h
>

14 
	~<°dlib.h
>

15 
	~<uni°d.h
>

16 
	~<sys/ty≥s.h
>

17 
	~<sig«l.h
>

18 
	~<°rög.h
>

19 
	~<˘y≥.h
>

20 
	~<î∫o.h
>

23 
	tu32
;

24 
	tu64
;

27 #i‡
__x86_64__


28 
	#ADDR_TYPE
 
u64


	)

29 
	#ADDR_FMT
 "%016lx"

	)

30 
u64
 
	grubbish_uaddr
 = 0x500f60L;

31 
u64
 
	grubbish_kaddr
 = 0xffff0a8700100000L;

33 
	#ADDR_TYPE
 
u32


	)

34 
	#ADDR_FMT
 "%08lx"

	)

35 
u32
 
	grubbish_uaddr
 = 0x500ffeL;

36 
u32
 
	grubbish_kaddr
 = 0xd0c00000L;

40 
	$myÁu…
(
signum
, 
sigöfo_t
 * 
sigöfo
, *
ª°
)

42 
c
 = 0;

44 
	`¥ötf
("*** %s: [%d]Ñeceived signal %d.Érrno=%d\n"

46 
__func__
, ++
c
, 
signum
, 
sigöfo
->
si_î∫o
, sigöfo->
si_code
);

48 
sigöfo
->
si_code
) {

49 
SI_USER
:

50 
	`¥ötf
("user\n");

52 
SI_KERNEL
:

53 
	`¥ötf
("kernel\n");

55 
SI_QUEUE
:

56 
	`¥ötf
("queue\n");

58 
SI_TIMER
:

59 
	`¥ötf
("timer\n");

61 
SI_MESGQ
:

62 
	`¥ötf
("mesgq\n");

64 
SI_ASYNCIO
:

65 
	`¥ötf
("async io\n");

67 
SI_SIGIO
:

68 
	`¥ötf
("sigio\n");

70 
SI_TKILL
:

71 
	`¥ötf
("t[g]kill\n");

74 
SEGV_MAPERR
:

75 
	`¥ötf
("SEGV_MAPERR:áddressÇot mappedÅo object\n");

77 
SEGV_ACCERR
:

78 
	`¥ötf
("SEGV_ACCERR: invalidÖermissions for mapped object\n");

85 
SEGV_BNDERR
:

86 
	`¥ötf
("SEGV_BNDERR: failedáddress bound checks\n");

87 
SEGV_PKUERR
:

88 
¥ötf


92 
	`¥ötf
("-none-\n");

94 
	`¥ötf
(" Fau…ögáddr=0x" 
ADDR_FMT
 "\n", (
ADDR_TYPE
Ë
sigöfo
->
si_addr
);

97 
	`exô
(1);

99 
	`ab‹t
();

101 
	}
}

109 
	$£tup_Ætsig°ack
(
size_t
 
°ack_sz
)

111 
°ack_t
 
ss
;

113 
	`¥ötf
("A… sig«»°ack sizê%zu byãs\n", 
°ack_sz
);

114 
ss
.
ss_•
 = 
	`mÆloc
(
°ack_sz
);

115 i‡(!
ss
.
ss_•
){

116 
	`¥ötf
("mÆloc(%zuËf‹á… sig sèck faûed\n", 
°ack_sz
);

117  -
ENOMEM
;

120 
ss
.
ss_size
 = 
°ack_sz
;

121 
ss
.
ss_Êags
 = 0;

122 i‡(
	`sigÆt°ack
(&
ss
, 
NULL
) == -1){

123 
	`¥ötf
("sigÆt°ack f‹ sizê%zu faûed!\n", 
°ack_sz
);

124  -
î∫o
;

126 
	`¥ötf
("A… sig«»°ack uv®(u£∏vúàaddrË%p\n", 
ss
.
ss_•
);

129 
	}
}

131 
	$ußge
(*
nm
)

133 
	`Ârötf
(
°dîr
, "Usage: %s u|kÑ|w\n"

136 "Ñ =>Ñódáâem±\n" " w => wrôê©ãm±\n", 
nm
);

137 
	}
}

139 
	$maö
(
¨gc
, **
¨gv
)

141 
siga˘i⁄
 
a˘
;

143 i‡(
¨gc
 != 3) {

144 
	`ußge
(
¨gv
[0]);

145 
	`exô
(1);

148 
	`¥ötf
("Reguœ∏°ack uv®eg (u£∏vúàaddrË%p\n", &
a˘
);

158 i‡(
	`£tup_Ætsig°ack
(10*1024*1024) < 0) {

159 
	`Ârötf
(
°dîr
, "%s: sëtög u∞Æàsig sèck faûed\n", 
¨gv
[0]);

160 
	`exô
(1);

163 
	`mem£t
(&
a˘
, 0, (act));

165 
a˘
.
ß_siga˘i⁄
 = 
myÁu…
;

166 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
 | 
SA_ONSTACK
;

167 
	`sigem±y£t
(&
a˘
.
ß_mask
);

169 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

170 
	`≥º‹
("sigaction");

171 
	`exô
(1);

174 i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'r')) {

175 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë
rubbish_uaddr
;

176 
¥ötf


178 
ADDR_FMT
 ":\n", (
ADDR_TYPE
Ë
u±r
);

179 
	`¥ötf
("*u±∏0x" 
ADDR_FMT
 "\n", *
u±r
);

180 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'w')) {

181 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë& 
maö
;

182 
¥ötf


184 
ADDR_FMT
 ":\n", (
ADDR_TYPE
Ë
u±r
);

185 *
u±r
 = 40;

186 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'r')) {

187 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
rubbish_kaddr
;

188 
¥ötf


190 
ADDR_FMT
 ":\n", (
ADDR_TYPE
Ë
k±r
);

191 
	`¥ötf
("*k±∏0x" 
ADDR_FMT
 "\n", *
k±r
);

192 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'w')) {

193 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
rubbish_kaddr
;

194 
¥ötf


196 
ADDR_FMT
 ":\n", (
ADDR_TYPE
Ë
k±r
);

197 *
k±r
 = 0x62;

199 
	`ußge
(
¨gv
[0]);

200 
	`exô
(0);

201 
	}
}

	@Training/L1_sysprg_trg/signalling/handle_segfault/stackmem_corrupt/stackmem_corrupt.c

19 
	#_GNU_SOURCE


	)

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<uni°d.h
>

23 
	~<sig«l.h
>

24 
	~<°rög.h
>

25 
	~<sys/time.h
>

26 
	~<sys/ªsour˚.h
>

27 
	~<î∫o.h
>

29 
	$myÁu…
(
signum
, 
sigöfo_t
 *
si
, *
uc⁄ãxt
)

31 
	`Ârötf
(
°dîr
,

33 
	`Ârötf
(
°dîr
, " %s:Ñeceived signal %d.Érrno=%d\n"

35 
__func__
, 
signum
, 
si
->
si_î∫o
, si->
si_code
);

37 
si
->
si_code
) {

39 
SEGV_MAPERR
:

40 
	`Ârötf
(
°dîr
, "SEGV_MAPERR:áddressÇot mappedÅo object\n");

42 
SEGV_ACCERR
:

43 
	`Ârötf
(
°dîr
, "SEGV_ACCERR: invalidÖermissions for mapped object\n");

47 
SEGV_BNDERR
:

48 
	`Ârötf
(
°dîr
, "SEGV_BNDERR: failedáddress bound checks\n");

49 
SEGV_PKUERR
:

50 
	`Ârötf
(
°dîr
, "SEGV_PKUERR:áccess denied by memory-protection keys\n");

53 
SI_USER
:

54 
	`Ârötf
(
°dîr
, "user\n");

56 
SI_KERNEL
:

57 
	`Ârötf
(
°dîr
, "kernel\n");

59 
SI_QUEUE
:

60 
	`Ârötf
(
°dîr
, "queue\n");

62 
SI_TIMER
:

63 
	`Ârötf
(
°dîr
, "timer\n");

65 
SI_MESGQ
:

66 
	`Ârötf
(
°dîr
, "mesgq\n");

68 
SI_ASYNCIO
:

69 
	`Ârötf
(
°dîr
, "async io\n");

71 
SI_SIGIO
:

72 
	`Ârötf
(
°dîr
, "sigio\n");

74 
SI_TKILL
:

75 
	`Ârötf
(
°dîr
, "t[g]kill\n");

78 
	`Ârötf
(
°dîr
, "-none-\n");

81 
	`Ârötf
(
°dîr
, " Fau…ög in°∏‹áddªs†%p\n", 
si
->
si_addr
);

84 
	`Ârötf
(
°dîr
,

86 
	`psigöfo
(
si
, "psiginfo helper");

87 
	`Ârötf
(
°dîr
,

104 
siga˘i⁄
 
a˘
;

106 
	`mem£t
(&
a˘
, 0, (act));

108 
a˘
.
ß_h™dÀr
 = 
SIG_DFL
;

110 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

111 
	`sigem±y£t
(&
a˘
.
ß_mask
);

112 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

113 
	`≥º‹
("sigaction");

114 
	`exô
(1);

117 i‡(
	`øi£
(
SIGSEGV
)) {

118 
	`Ârötf
(
°dîr
, "øi£ SIGSEGV faûed"); 
	`exô
(1); }

119 
	}
}

121 
	#USING_ALTSIGSTACK


	)

129 
	$£tup_Ætsig°ack
(
size_t
 
°ack_sz
)

131 
°ack_t
 
ss
;

133 
	`¥ötf
("A… sig«»°ack sizê%zu byãs\n", 
°ack_sz
);

134 
ss
.
ss_•
 = 
	`mÆloc
(
°ack_sz
);

135 i‡(!
ss
.
ss_•
) {

136 
	`¥ötf
("mÆloc(%zuËf‹á… sig sèck faûed\n", 
°ack_sz
);

137  -
ENOMEM
;

140 
ss
.
ss_size
 = 
°ack_sz
;

141 
ss
.
ss_Êags
 = 0;

142 i‡(
	`sigÆt°ack
(&
ss
, 
NULL
) == -1) {

143 
	`¥ötf
("sigÆt°ack f‹ sizê%zu faûed!\n", 
°ack_sz
);

144  -
î∫o
;

149 
	}
}

151 
	$wrôe_undîÊow_c‹ru±°ack
()

153 
°ack
, 
°ack±r
;

154 
æimô
 
ª¶imô
;

155 
cmd
[128], 
°acksz_hex°r
[18], 
sz
[9];

156 
°acksz
 = 0;

157 
FILE
 *
Â
;

158 
°acksz_hex
 = 0;

160 
	`¥ötf
("%s():ápprox stackÅop (~ curr sp) is %p\n",

161 
__func__
, (*)&
°ack
);

162 i‡(
	`¥limô
(0, 
RLIMIT_STACK
, 0, &
ª¶imô
) < 0) {

163 
	`≥º‹
("prlimit failed");

166 
	`¥ötf
("%s(): stackÑesourceÜimits: soft=%ld, hard=%ld\n",

167 
__func__
, 
ª¶imô
.
æim_cur
,Ñe¶imô.
æim_max
);

170 
	`mem£t
(
cmd
, 0, 128);

171 
	`¢¥ötf
(
cmd
, 128, "./gëm≠sizê%d sèck", 
	`gëpid
());

172 
Â
 = 
	`p›í
(
cmd
, "r");

173 i‡(!
Â
) {

174 
	`≥º‹
("popen failed");

177 
°acksz
 = 
	`©oi
(
	`fgës
(
sz
, 9, 
Â
));

178 i‡(
°acksz
 <= 0) {

179 
	`p˛o£
(
Â
);

180 
	`Ârötf
(
°dîr
, "%s():gëtögá˘uÆ sèck sizêÁûed\n", 
__func__
);

183 
	`p˛o£
(
Â
);

184 
	`¥ötf
("%s():actualÖrocess (T0Åhread) stack size = %d (0x%x) bytes\n",

185 
__func__
, 
°acksz
, stacksz);

186 i‡(
°acksz
 % 
	`gë∑gesize
())

187 
	`¥ötf
("%s():WARNING:a˘uÆ sèck sizêi¢'à®roundedÖagêsize\n", 
__func__
);

189 
	`¢¥ötf
(
°acksz_hex°r
, 18, "0x%x", 
°acksz
);

190 
°acksz_hex
 = 
	`°πoul
(
°acksz_hex°r
, 
NULL
, 16);

191 
°ack±r
 = ()&
°ack
;

192 
	`¥ötf
("%s():a˘uÆ sèπ o‡°ack i†0x%lx\n", 
__func__
, 
°ack±r
 - 
°acksz_hex
);

196 
	`mem£t
((*)(
°ack±r
 - 
°acksz_hex
), 'x', 
°acksz
);

241 
	}
}

243 
	$maö
(
¨gc
, **
¨gv
)

245 
siga˘i⁄
 
a˘
;

247 
	#NUMBYTES
 (7*1024*1024)

	)

248 
	#NUMEL
 (
NUMBYTES
/())

	)

249 
l⁄g¨r
[
NUMEL
];

251 
	`mem£t
(&
l⁄g¨r
[0], 0xef, 
NUMBYTES
);

261 
	`¥ötf
("%s: sëtög u∞™á… sig°ackándÅøµög SIGSEGVÇow...\n", 
¨gv
[0]);

262 #ifde‡
USING_ALTSIGSTACK


263 i‡(
	`£tup_Ætsig°ack
(10*1024*1024) < 0) {

264 
	`Ârötf
(
°dîr
, "%s: sëtög u∞Æàsig sèck faûed\n", 
¨gv
[0]);

265 
	`exô
(1);

268 
	`mem£t
(&
a˘
, 0, (act));

269 
a˘
.
ß_siga˘i⁄
 = 
myÁu…
;

270 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

271 #ifde‡
USING_ALTSIGSTACK


272 
a˘
.
ß_Êags
 |
SA_ONSTACK
;

274 
	`sigem±y£t
(&
a˘
.
ß_mask
);

275 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

276 
	`≥º‹
("sigaction");

277 
	`exô
(1);

280 
	`¥ötf
("Ru¬ög %†ã°ˇ£Çow...\n", 
¨gv
[0]);

281 
	`wrôe_undîÊow_c‹ru±°ack
();

282 
	`∑u£
();

283 
	`exô
(0);

284 
	}
}

	@Training/L1_sysprg_trg/signalling/killer.c

9 
	~<sig«l.h
>

10 
	~<°dio.h
>

11 
	~<uni°d.h
>

12 
	~<sys/ty≥s.h
>

13 
	~<sys/waô.h
>

14 
	~<°rög.h
>

15 
	~<°dlib.h
>

17 
	#SIG2SEND
 
SIGUSR1


	)

22 
	$ˇtchô
(
signo
)

24 i‡(
signo
 =
SIG2SEND
) {

25 
¥ötf


27 
	`gëpid
(), 
SIG2SEND
);

28 
	`exô
(0);

30 
	`¥ötf
("ˇtchô:Éº‹, h™dÀ∏f‹ %d o∆y\n", 
SIG2SEND
);

31 
	}
}

33 
	$maö
(
¨gc
, **
¨gv
)

35 
pid_t
 
pid
, 
n
;

36 
siga˘i⁄
 
a˘
;

37 
	#MAXTRIES
 3

	)

38 
åy
 = 0;

40 
	`mem£t
(&
a˘
, 0, (act));

41 
a˘
.
ß_h™dÀr
 = 
ˇtchô
;

42 
	`sigem±y£t
(&
a˘
.
ß_mask
);

43 
a˘
.
ß_Êags
 = 
SA_RESTART
;

45 i‡(
	`siga˘i⁄
(
SIG2SEND
, &
a˘
, 0) == -1) {

46 
	`≥º‹
("killer: sigaction failed.");

47 
	`exô
(1);

50 (
pid
 = 
	`f‹k
())) {

52 
	`≥º‹
("fork failed");

53 
	`exô
(1);

55 ()
	`∑u£
();

56 
	`exô
(0);

58 
	`¥ötf
("∑ª¡ i†%d, chûd i†%d\n", 
	`gëpid
(), 
pid
);

60 
	`kûl
(
pid
, 0) < 0) {

61 
	`¥ötf
("."); 
	`fÊush
(
°dout
);

62 i‡(
åy
 >
MAXTRIES
) {

63 
	`Ârötf
(
°dîr
,

64 "\n%s:Ö¨ít: chûd stû»nŸálive,áb‹tög..\n", 
¨gv
[0]);

65 
	`exô
(1);

67 ()
	`¶ìp
(1);

68 
åy
 ++;

70 
	`¥ötf
("\n");

71 i‡(
	`kûl
(
pid
, 
SIG2SEND
) < 0) {

72 
	`≥º‹
("kill(2) failed");

73 
	`exô
(1);

76 i‡((
n
 = 
	`waô
(0)) == -1) {

77 
	`≥º‹
("wait failed");

78 
	`exô
(1);

80 
	`¥ötf
("parent %d: childÖrocess fetched, wait "

81 "ªtu∫ed %d\n", 
	`gëpid
(), 
n
);

84 
	}
}

	@Training/L1_sysprg_trg/signalling/nano.c

11 
î∫o
;

13 
	~<°dio.h
>

14 
	~<uni°d.h
>

15 
	~<°dlib.h
>

16 
	~<time.h
>

17 
	~<sig«l.h
>

18 
	~<°rög.h
>

19 
	~<î∫o.h
>

20 
	~"../c⁄víõ¡.h
"

22 
	$sig
(
signum
)

24 
	`¥ötf
("**Sig«»%d i¡îru±i⁄!**\n", 
signum
);

25 
	}
}

27 
	$maö
(
¨gc
, **
¨gv
)

29 
siga˘i⁄
 
a˘
;

30 
n£c
 = 10, 
ªt
;

31 
time•ec
 
ªq
, 
ªm
;

33 i‡(
¨gc
 == 1) {

34 
	`Ârötf
(
°dîr
, "Ußge: %†›ti⁄=[0|1]\n\
0 : u£†thê¶ìp(3Ëfun˘i⁄\n\
1 : u£†thê«no¶ìp(2ËsysˇŒ\n", 
¨gv
[0]);

37 
	`exô
(1);

41 
	`mem£t
(&
a˘
, 0, (act));

42 
a˘
.
ß_h™dÀr
 = 
sig
;

43 
	`sigem±y£t
(&
a˘
.
ß_mask
);

44 
a˘
.
ß_Êags
 = 
SA_RESTART
;

46 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0Ë|| siga˘i⁄(
SIGQUIT
, &act, 0)

48 
	`≥º‹
("sigaction failure");

49 
	`exô
(1);

53 i‡(
	`©oi
(
¨gv
[1]) == 0) {

54 
	`¥ötf
("¶ì∞f‹ %d sÇow...\n", 
n£c
);

55 
ªt
 = 
	`¶ìp
(
n£c
);

60 
	`¥ötf
("¶ì∞ªtu∫ed %u\n", 
ªt
);

61 } i‡(
	`©oi
(
¨gv
[1]) == 1) {

62 
ªq
.
tv_£c
 = 
n£c
;

63 
ªq
.
tv_n£c
 = 0;

64 (
	`«no¶ìp
(&
ªq
, &
ªm
Ë=-1Ë&& (
î∫o
 =
EINTR
)) {

65 
	`¥ötf
("nanosleep interrupted:ÑemÅime: %07lu.%07lu\n",

66 
ªm
.
tv_£c
,Ñem.
tv_n£c
);

67 
ªq
 = 
ªm
;

70 
	`exô
(0);

71 
	}
}

	@Training/L1_sysprg_trg/signalling/sanodef.c

16 
	~<°dio.h
>

17 
	~<°dlib.h
>

18 
	~<uni°d.h
>

19 
	~<sig«l.h
>

20 
	~<°rög.h
>

21 
	~<sys/fûe.h
>

22 
	~"../c⁄víõ¡.h
"

24 
	#MAX
 8

	)

26 *
	$°ack
()

29 #ifde‡
__x86_64__


30 
	`¥ötf
("X86:\n");

31 i‡(
__WORDSIZE
 == 32) {

32 
	`__asm__
("movl %esp, %eax");

33 } i‡(
__WORDSIZE
 == 64) {

34 
	`__asm__
("movq %rsp, %rax");

38 #ifde‡
__¨m__


39 
asm
 volatile("movÑ0, sp");

41 #ifde‡
__Ørch64__


42 
asm
 volatile("mov x0, sp");

44 
	}
}

46 
	$sighdÃ
(
signum
)

48 
sig_©omic_t
 
s
;

49 
ßved
;

51 
	`¥ötf
("\nsighdÃ: caughàsig«»%d,", 
signum
);

53 
signum
) {

54 
SIGINT
:

55 
s
++;

56 i‡(
s
 >
MAX
)

57 
s
 = 1;

58 
ßved
 = 
s
;

60 
	`¥ötf
(" s=%d ; sèck %∞:", 
s
, 
	`°ack
());

61 
	`DELAY_LOOP
(
ßved
 + 48, 30);

62 
	`¥ötf
("*");

63 ()
	`fÊush
(
°dout
);

69 
	}
}

71 
	$maö
(
¨gc
, **
¨gv
)

73 
Êags
 = 0;

74 
siga˘i⁄
 
a˘
;

76 i‡(
¨gc
 == 1) {

77 
	`Ârötf
(
°dîr
, "Ußge: %†[›ti⁄]\n\
=0 : d⁄'àu£ SA_NODEFER fœg (deÁu… siga˘i⁄ styÀ)\n\
=1 : u£ SA_NODEFER fœg (wû»¥o˚s†sig«»immd)\n", 
¨gv
[0]);

80 
	`exô
(1);

83 
	`¥ötf
("SA_NODEFER u£d? %s\n", (
	`©oi
(
¨gv
[1])==0?"no":"yes"));

84 i‡(
	`©oi
(
¨gv
[1]) == 1)

85 
Êags
 = 
SA_NODEFER
 | 
SA_RESTART
;

86 i‡(
	`©oi
(
¨gv
[1]) == 0)

87 
Êags
 = 
SA_RESTART
;

90 
	`mem£t
(&
a˘
, 0, (act));

91 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

92 
	`sigem±y£t
(&
a˘
.
ß_mask
);

93 
a˘
.
ß_Êags
 = 
Êags
;

95 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) == -1) {

96 
	`≥º‹
(
¨gv
[0]);

97 
	`exô
(1);

100 
	`Ârötf
(
°dîr
, "\nProcessáwaiting signals\n");

102 ()
	`∑u£
();

103 
	}
}

	@Training/L1_sysprg_trg/signalling/sig1.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<sig«l.h
>

10 
	~<°rög.h
>

11 
	~<°dlib.h
>

13 
	$ˇtchî
(
signo
)

16 
	`¥ötf
("** Ouch! Received SIGINT. **\n");

19 
	`¥ötf
("%s():signÿ%d\n", 
__func__
, 
signo
);

21 i‡(
	`wrôe
(
STDOUT_FILENO
, "** Ouch! Received SIGINT. **", 28) == -1) {

22 
	`≥º‹
("sig1: write() failed");

23 
	`exô
(1);

26 ()
	`¶ìp
(1);

27 
	}
}

29 
	$maö
()

31 
siga˘i⁄
 
a˘
;

33 
	`mem£t
(&
a˘
, 0, (act));

34 
a˘
.
ß_h™dÀr
 = 
ˇtchî
;

36 
	`sigem±y£t
(&
a˘
.
ß_mask
);

39 
	`sigfûl£t
(&
a˘
.
ß_mask
);

46 
a˘
.
ß_Êags
 = 0;

49 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) == -1) {

50 
	`≥º‹
("sigaction failure");

51 
	`exô
(1);

53 i‡(
	`siga˘i⁄
(
SIGQUIT
, &
a˘
, 0) == -1) {

54 
	`≥º‹
("sigaction failure");

55 
	`exô
(1);

59 
	`¥ötf
("\nExecuting forÜoop..");

60 
	}
}

	@Training/L1_sysprg_trg/signalling/sig2.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<sig«l.h
>

10 
	~<°rög.h
>

11 
	~<°dlib.h
>

13 
	$ˇtchî
(
signo
)

16 
	`¥ötf
("** Ouch! Received SIGINT. **\n");

20 i‡(
	`wrôe
(
STDOUT_FILENO
, "** Ouch! Received SIGINT. **", 28) == -1) {

21 
	`≥º‹
("sig1: write() failed");

22 
	`exô
(1);

25 ()
	`¶ìp
(1);

26 
	}
}

28 
	$maö
()

30 
siga˘i⁄
 
a˘
;

32 
	`mem£t
(&
a˘
, 0, (act));

33 
a˘
.
ß_h™dÀr
 = 
ˇtchî
;

35 
	`sigem±y£t
(&
a˘
.
ß_mask
);

38 
	`sigfûl£t
(&
a˘
.
ß_mask
);

45 
a˘
.
ß_Êags
 = 0;

48 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) == -1) {

49 
	`≥º‹
("sigaction failure");

50 
	`exô
(1);

52 i‡(
	`siga˘i⁄
(
SIGQUIT
, &
a˘
, 0) == -1) {

53 
	`≥º‹
("sigaction failure");

54 
	`exô
(1);

58 
	`¥ötf
("\nExecuting forÜoop..");

59 
	}
}

	@Training/L1_sysprg_trg/signalling/sigcrit.c

12 
	~<°dio.h
>

13 
	~<°dlib.h
>

14 
	~<sig«l.h
>

15 
	~<°rög.h
>

16 
	~<sys/fûe.h
>

17 
	~<uni°d.h
>

18 
	~"../c⁄víõ¡.h
"

20 vﬁ©ûê
sig_©omic_t
 
	gc
 = 0, 
	gd
 = 0;

22 
	$sighdÃ
(
signum
)

24 
signum
) {

25 
SIGINT
:

26 
	`¥ötf
("SIGINT: cou¡=%d\n", ++
c
);

28 
SIGQUIT
:

29 
	`¥ötf
("SIGQUIT: cou¡=%d\n", ++
d
);

32 
	`¥ötf
("Sig«»%d: disˇrded\n", 
signum
);

35 
	}
}

37 
	$maö
(
¨gc
, **
¨gv
)

39 
siga˘i⁄
 
a˘
;

40 
sig£t_t
 
sig£t
, 
¥ev£t
;

43 
	`mem£t
(&
a˘
, 0, (act));

44 
a˘
.
ß_h™dÀr
 = 
sighdÃ
;

45 
	`sigfûl£t
(&
a˘
.
ß_mask
);

46 
a˘
.
ß_Êags
 = 
SA_RESTART
;

48 i‡(
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0) == -1) {

49 
	`≥º‹
(
¨gv
[0]);

50 
	`exô
(1);

52 i‡(
	`siga˘i⁄
(
SIGQUIT
, &
a˘
, 0) == -1) {

53 
	`≥º‹
(
¨gv
[0]);

54 
	`exô
(1);

56 
	`Ârötf
(
°dîr
, "Signals SIGINTánd SIGQUITÅrapped..\n");

65 
	`sigem±y£t
(&
sig£t
);

66 i‡(
	`sigadd£t
(&
sig£t
, 
SIGINT
) == -1)

67 
	`≥º‹
("sigadd£àÁûuª"), 
	`exô
(1);

68 i‡(
	`sigadd£t
(&
sig£t
, 
SIGQUIT
) == -1)

69 
	`≥º‹
("sigadd£àÁûuª"), 
	`exô
(1);

71 
	`sigfûl£t
(&
sig£t
);

73 i‡(
	`sig¥ocmask
(
SIG_BLOCK
, &
sig£t
, &
¥ev£t
) == -1)

74 
	`≥º‹
("sig¥ocmask 1 faûuª"), 
	`exô
(1);

77 
	`¥ötf
("Entering critical sectionÇow...\n");

78 
	`DELAY_LOOP
(65, 500);

79 
	`¥ötf
("Exiting critical sectionÇow...\n");

85 i‡(
	`sig¥ocmask
(
SIG_SETMASK
, &
¥ev£t
, 0) == -1)

86 
	`≥º‹
("sig¥ocmask 2 faûuª"), 
	`exô
(1);

89 ()
	`∑u£
();

90 
	}
}

	@Training/L1_sysprg_trg/signalling/sigfd_man_eg.c

4 
	~<sys/sig«lfd.h
>

5 
	~<sig«l.h
>

6 
	~<uni°d.h
>

7 
	~<°dlib.h
>

8 
	~<°dio.h
>

10 
	#h™dÀ_îr‹
(
msg
) \

11 dÿ{ 
	`≥º‹
(
msg
); 
	`exô
(
EXIT_FAILURE
); } 0)

	)

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
sig£t_t
 
mask
;

16 
sfd
;

17 
sig«lfd_sigöfo
 
fdsi
;

18 
ssize_t
 
s
;

20 
	`sigem±y£t
(&
mask
);

21 
	`sigadd£t
(&
mask
, 
SIGINT
);

22 
	`sigadd£t
(&
mask
, 
SIGQUIT
);

27 i‡(
	`sig¥ocmask
(
SIG_BLOCK
, &
mask
, 
NULL
) == -1)

28 
	`h™dÀ_îr‹
("sigprocmask");

30 
sfd
 = 
	`sig«lfd
(-1, &
mask
, 0);

31 i‡(
sfd
 == -1)

32 
	`h™dÀ_îr‹
("signalfd");

35 
s
 = 
	`ªad
(
sfd
, &
fdsi
, (
sig«lfd_sigöfo
));

36 i‡(
s
 !(
sig«lfd_sigöfo
))

37 
	`h™dÀ_îr‹
("read");

39 i‡(
fdsi
.
ssi_signo
 =
SIGINT
) {

40 
	`¥ötf
("Got SIGINT\n");

41 } i‡(
fdsi
.
ssi_signo
 =
SIGQUIT
) {

42 
	`¥ötf
("Got SIGQUIT\n");

43 
	`exô
(
EXIT_SUCCESS
);

45 
	`¥ötf
("Read unexpected signal\n");

48 
	}
}

	@Training/L1_sysprg_trg/signalling/sigq/sigq_rcv.c

9 
	~<°dio.h
>

10 
	~<°dlib.h
>

11 
	~<sig«l.h
>

12 
	~<uni°d.h
>

13 
	~<sys/ty≥s.h
>

21 
	$ˇtchî
(
signum
, 
sigöfo_t
 *
si
, *
˘x
)

23 
	`¥ötf
(

26 
	`gëpid
(), 
signum
, 
si
->
si_pid
, si->
si_uid
,

27 
si
->
si_vÆue
.
sivÆ_öt
);

28 
	}
}

30 
	$maö
(
¨gc
, **
¨gv
)

32 
siga˘i⁄
 
a˘
;

34 
a˘
.
ß_siga˘i⁄
 = 
ˇtchî
;

35 
	`sigem±y£t
(&
a˘
.
ß_mask
);

37 
a˘
.
ß_Êags
 = 
SA_RESTART
|
SA_SIGINFO
;

38 i‡(
	`siga˘i⁄
(
SIGRTMIN
+3, &
a˘
, 0) == -1) {

40 
	`≥º‹
("sigaction failure");

41 
	`exô
(1);

44 
	`¥ötf
("Hey, i¿%s[%d]! PausögÇow ... [^CÅÿexô..]\n", 
¨gv
[0],

45 
	`gëpid
());

47 
	`∑u£
();

48 
	`exô
(0);

49 
	}
}

	@Training/L1_sysprg_trg/signalling/sigq/sigq_snd.c

9 
	~<°dio.h
>

10 
	~<°dlib.h
>

11 
	~<sig«l.h
>

12 
	~<uni°d.h
>

13 
	~<sys/ty≥s.h
>

14 
	~<î∫o.h
>

15 
	~<limôs.h
>

17 
	$maö
(
¨gc
, **
¨gv
)

19 
sigvÆ
 
sv
;

20 *
íd±r
;

22 i‡(
¨gc
 != 3) {

23 
	`Ârötf
(
°dîr
, "Ußge: %†pid-to-£nd-tÿvÆue-to-£nd[öt]\n", 
¨gv
[0]);

24 
	`exô
 (1);

32 
î∫o
 = 0;

33 
sv
.
sivÆ_öt
 = 
	`°πﬁ
(
¨gv
[2], &
íd±r
, 0);

34 i‡((
î∫o
 =
ERANGE
 && (
sv
.
sivÆ_öt
 =
LONG_MAX
 || sv.sivÆ_öà=
LONG_MIN
))

35 || (
î∫o
 !0 && 
sv
.
sivÆ_öt
 == 0)) {

36 
	`≥º‹
("strtol");

37 
	`exô
(
EXIT_FAILURE
);

39 i‡(
íd±r
 =
¨gv
[2]) {

40 
	`Ârötf
(
°dîr
, "No digits were found\n");

41 
	`exô
(
EXIT_FAILURE
);

43 
sv
.
sivÆ_öt
 &= 0xffffffff;

44 i‡((
î∫o
 =
ERANGE
 && (
sv
.
sivÆ_öt
 =
INT_MAX
 || sv.sivÆ_öà=
INT_MIN
))

45 || (
î∫o
 !0 && 
sv
.
sivÆ_öt
 == 0)) {

46 
	`≥º‹
("strtol");

47 
	`exô
(
EXIT_FAILURE
);

49 
	`¥ötf
("%s: integer beingÅransmitted: %d%s\n",

50 
¨gv
[0], 
sv
.
sivÆ_öt
, sv.sival_int < 0 ? " !WARNING! it's -ve (possible IoF)" : "");

56 i‡(
	`sigqueue
(
	`©ﬁ
(
¨gv
[1]), 
SIGRTMIN
+3, 
sv
) == -1) {

58 
	`≥º‹
("sigqueue failed");

59 
	`exô
 (1);

61 
	`exô
 (0);

62 
	}
}

	@Training/L1_sysprg_trg/signalling/zombies_clear_linux26.c

18 
	~<°dio.h
>

19 
	~<uni°d.h
>

20 
	~<°dlib.h
>

21 
	~<sig«l.h
>

22 
	~<°rög.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/waô.h
>

25 
	~"../c⁄víõ¡.h
"

29 
	$˛órzomb
(
signum
)

31 
pid_t
 
pid
;

33 
	`MSG
("\nPID: %d\n", 
	`gëpid
());

49 (
pid
 = 
	`waô3
(0, 
WNOHANG
, 0)) != -1)

50 
	`MSG
("\n** Zombõ %d cÀ¨ed **\n", 
pid
);

51 
	}
}

54 
	$ußge
(*
«me
)

56 
	`Ârötf
(
°dîr
,

59 " 2 : ju° ign‹êthêsig«»SIGCHLD\n", 
«me
);

60 
	`exô
(
EXIT_FAILURE
);

61 
	}
}

63 
	$maö
(
¨gc
, **
¨gv
)

65 
siga˘i⁄
 
a˘
;

66 
›t
 = 0;

68 i‡(
¨gc
 != 2)

69 
	`ußge
(
¨gv
[0]);

71 
›t
 = 
	`©oi
(
¨gv
[1]);

72 i‡(
›t
 != 1 && opt != 2)

73 
	`ußge
(
¨gv
[0]);

75 
	`mem£t
(&
a˘
, 0, (act));

76 i‡(
›t
 == 1)

77 
a˘
.
ß_h™dÀr
 = 
NULL
;

79 
a˘
.
ß_h™dÀr
 = 
SIG_IGN
;

80 
	`sigem±y£t
(&
a˘
.
ß_mask
);

81 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_NOCLDSTOP
;

82 i‡(
›t
 == 1)

83 
a˘
.
ß_Êags
 |
SA_NOCLDWAIT
;

85 i‡(
	`siga˘i⁄
(
SIGCHLD
, &
a˘
, 0) == -1) {

86 
	`≥º‹
("sigaction failed");

87 
	`exô
(1);

90 
	`¥ötf
("∑ª¡: %d\n", 
	`gëpid
());

91 
	`f‹k
()) {

93 
	`≥º‹
("fork failed");

94 
	`exô
(1);

96 
	`¥ötf
("chûd: %d\n", 
	`gëpid
());

97 
	`DELAY_LOOP
('c', 250);

98 
	`exô
(0);

102 
	`∑u£
();

104 
	`exô
(0);

105 
	}
}

	@Training/L1_sysprg_trg/signalling/zombies_clear_traditional.c

14 
	~<°dio.h
>

15 
	~<uni°d.h
>

16 
	~<°dlib.h
>

17 
	~<sig«l.h
>

18 
	~<°rög.h
>

19 
	~<sys/ty≥s.h
>

20 
	~<sys/waô.h
>

21 
	~"../c⁄víõ¡.h
"

24 
	$˛órzomb
(
signum
)

26 
pid_t
 
pid
;

28 
	`¥ötf
("\nPID: %d\n", 
	`gëpid
());

44 (
pid
 = 
	`waô3
(0, 
WNOHANG
, 0)) != -1)

45 
	`¥ötf
("\n** Zombõ %d cÀ¨ed **\n", 
pid
);

46 
	}
}

48 
	$maö
(
¨gc
, **
¨gv
)

50 
siga˘i⁄
 
a˘
;

52 
	`mem£t
(&
a˘
, 0, (act));

53 
a˘
.
ß_h™dÀr
 = 
˛órzomb
;

54 
	`sigem±y£t
(&
a˘
.
ß_mask
);

55 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_NOCLDSTOP
;

57 i‡(
	`siga˘i⁄
(
SIGCHLD
, &
a˘
, 0) == -1) {

58 
	`≥º‹
("sigaction failed");

59 
	`exô
(1);

62 
	`¥ötf
("∑ª¡: %d\n", 
	`gëpid
());

63 
	`f‹k
()) {

65 
	`≥º‹
("fork failed");

66 
	`exô
(1);

68 
	`¥ötf
("chûd: %d\n", 
	`gëpid
());

69 
	`DELAY_LOOP
('c', 25);

70 
	`exô
(0);

72 
	`DELAY_LOOP
('p', 50);

74 
	`exô
(0);

75 
	}
}

	@Training/L1_sysprg_trg/size_pdatatype.c

1 
	~<°dio.h
>

2 
	~<limôs.h
>

4 
	#size
(
t
Ë{Å 
x
; 
	`¥ötf
("%10†:\t%3zu bô\n", #t, 
CHAR_BIT
 *  x); }

	)

6 
	$maö
(
¨gc
, *
¨gv
[])

8 
	`size
();

9 
	`size
();

10 
	`size
();

11 
	`size
();

12 
	`size
();

13 
	`size
(*);

14 
	`size
();

17 
	}
}

	@Training/L1_sysprg_trg/wip/feature_test_macros/featr_test_macs.c

6 
	~<°dio.h
>

7 
	~<uni°d.h
>

8 
	~<°dlib.h
>

10 
	$maö
(
¨gc
, *
¨gv
[])

12 #ifde‡
_POSIX_SOURCE


13 
	`¥ötf
("_POSIX_SOURCE defined\n");

16 #ifde‡
_POSIX_C_SOURCE


17 
	`¥ötf
("_POSIX_C_SOURCE deföed: %ldL\n", ()
_POSIX_C_SOURCE
);

20 #ifde‡
_ISOC99_SOURCE


21 
	`¥ötf
("_ISOC99_SOURCE defined\n");

24 #ifde‡
_ISOC11_SOURCE


25 
	`¥ötf
("_ISOC11_SOURCE defined\n");

28 #ifde‡
_XOPEN_SOURCE


29 
	`¥ötf
("_XOPEN_SOURCE deföed: %d\n", 
_XOPEN_SOURCE
);

32 #ifde‡
_XOPEN_SOURCE_EXTENDED


33 
	`¥ötf
("_XOPEN_SOURCE_EXTENDED defined\n");

36 #ifde‡
_LARGEFILE64_SOURCE


37 
	`¥ötf
("_LARGEFILE64_SOURCE defined\n");

39 #ifde‡
_FILE_OFFSET_BITS


40 
	`¥ötf
("_FILE_OFFSET_BITS deföed: %d\n", 
_FILE_OFFSET_BITS
);

43 #ifde‡
_BSD_SOURCE


44 
	`¥ötf
("_BSD_SOURCE defined\n");

47 #ifde‡
_SVID_SOURCE


48 
	`¥ötf
("_SVID_SOURCE defined\n");

51 #ifde‡
_DEFAULT_SOURCE


52 
	`¥ötf
("_DEFAULT_SOURCE defined\n");

55 #ifde‡
_ATFILE_SOURCE


56 
	`¥ötf
("_ATFILE_SOURCE defined\n");

59 #ifde‡
_GNU_SOURCE


60 
	`¥ötf
("_GNU_SOURCE defined\n");

63 #ifde‡
_REENTRANT


64 
	`¥ötf
("_REENTRANT defined\n");

67 #ifde‡
_THREAD_SAFE


68 
	`¥ötf
("_THREAD_SAFE defined\n");

71 #ifde‡
_FORTIFY_SOURCE


72 
	`¥ötf
("_FORTIFY_SOURCE defined\n");

75 
	`exô
(
EXIT_SUCCESS
);

76 
	}
}

	@Training/L1_sysprg_trg/wip/systemd_svcunit/primegen/primegen.c

1 
	#_GNU_SOURCE


	)

2 
	~<°dio.h
>

3 
	~<°dlib.h
>

4 
	~<uni°d.h
>

5 
	~<°rög.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/time.h
>

8 
	~<sys/ªsour˚.h
>

9 
	~<sys/ty≥s.h
>

10 
	~<sig«l.h
>

12 
	#MAX
 10000000

13 

	)

14 
	$sim∂e_¥imegí
(
limô
)

16 
i
, 
j
, 
num
 = 2, 
i•rime
;

18 
	`¥ötf
(" 2, 3, ");

19 
i
 = 4; i <
limô
; i++) {

20 
i•rime
 = 1;

21 
j
 = 2; j < 
limô
 / 2; j++) {

22 i‡((
i
 !
j
) && (i % j == 0)) {

23 
i•rime
 = 0;

27 i‡(
i•rime
) {

28 
num
++;

29 
	`¥ötf
("%6d, ", 
i
);

35 
	#WRAP
 16

	)

36 i‡(
num
 % 
WRAP
 == 0)

37 
	`¥ötf
("\n");

40 
	`¥ötf
("\n");

41 
	}
}

43 
	$buzz
(
signo
)

45 
	`¥ötf
("%s:%s()\n", 
__FILE__
, 
__func__
);

46 
	`kûl
(
	`gëpid
(), 
SIGTERM
);

47 
	}
}

49 
	$maö
(
¨gc
, **
¨gv
)

51 
limô
;

53 i‡(
¨gc
 < 2) {

54 
	`Ârötf
(
°dîr
,

56 " max i†%d\n", 
¨gv
[0], 
MAX
);

57 
	`exô
(
EXIT_FAILURE
);

60 
limô
 = 
	`©oi
(
¨gv
[1]);

61 i‡(
limô
 < 4 ||Üimô > 
MAX
) {

62 
	`Ârötf
(
°dîr
,

64 "thêøngê[4 - %d].\n", 
¨gv
[0], 
limô
, 
MAX
);

65 
	`exô
(
EXIT_FAILURE
);

67 i‡(
	`sig«l
(
SIGALRM
, 
buzz
) < 0) {

68 
	`≥º‹
("signal");

69 
	`exô
(
EXIT_FAILURE
);

72 
	`Æ¨m
(1);

73 
	`sim∂e_¥imegí
(
limô
);

74 
	`exô
(
EXIT_SUCCESS
);

75 
	}
}

	@Training/L2_kernel_trg/convenient.h

16 #i‚de‡
__LKD_CONVENIENT_H__


17 
	#__LKD_CONVENIENT_H__


	)

19 
	~<asm/∑øm.h
>

20 
	~<löux/sched.h
>

22 #ifde‡
__KERNEL__


23 
	~<löux/øãlimô.h
>

52 #unde‡
USE_FTRACE_BUFFER


54 #ifde‡
USE_FTRACE_BUFFER


55 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

56 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

58 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

59 
USE_RATELIMITING
 = 1; \

60 i‡(
USE_RATELIMITING
) { \

61 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

64 
	`¥_öfo
(
°rög
, ##
¨gs
); \

65 } 0)

	)

70 #ifde‡
DEBUG


71 #ifde‡
__KERNEL__


72 
	#MSG
(
°rög
, 
¨gs
...) do { \

73 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

74 } 0)

	)

76 
	#MSG
(
°rög
, 
¨gs
...) do { \

77 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

78 } 0)

	)

81 #ifde‡
__KERNEL__


82 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

83 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

84 } 0)

	)

86 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

87 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

88 } 0)

	)

92 
	#QP
 
	`MSG
("\n")

	)

94 #ifde‡
__KERNEL__


95 #i‚de‡
USE_FTRACE_BUFFER


96 
	#QPDS
 do { \

97 
	`MSG
("\n"); \

98 
	`dump_°ack
(); \

99 } 0)

	)

101 
	#QPDS
 do { \

102 
	`MSG
("\n"); \

103 
	`åa˚_dump_°ack
(); \

104 } 0)

	)

108 #ifde‡
__KERNEL__


109 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

110 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

111 } 0)

	)

114 
	#MSG
(
°rög
, 
¨gs
...)

	)

115 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

116 
	#QP


	)

117 
	#QPDS


	)

125 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

126 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

127 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

128 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

129 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

131 #ifde‡
__KERNEL__


157 
	~<löux/sched.h
>

158 
	~<löux/öãºu±.h
>

160 
	#PRINT_CTX
() do { \

161 
PRINTCTX_SHOWHDR
 = 0; \

162 
öå
 = '.'; \

163 i‡(!
	`ö_èsk
()) { \

164 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

165 
öå
 = 'H'; \

166 i‡(
	`ö_úq
()) \

167 
öå
 = 'h'; \

168 i‡(
	`ö_so·úq
()) \

169 
öå
 = 's'; \

172 
öå
 = '.'; \

174 i‡(
PRINTCTX_SHOWHDR
 == 1) \

175 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

176 
	`¥_debug
( \

180 , 
	`øw_smp_¥o˚ss‹_id
(), \

181 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

182 (
	`úqs_dißbÀd
()?'d':'.'), \

183 (
	`√ed_ªsched
()?'N':'.'), \

184 
öå
, \

185 (
	`¥ìm±_cou¡
() && 0xff), \

186 
__func__
 \

188 } 0)

	)

220 #ifde‡
__KERNEL__


221 
	#as£π
(
ex¥
) do { \

222 i‡(!(
ex¥
)) { \

223 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

224 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

226 } 0)

	)

230 
ölöe
 
	$bìp
(
wh©
)

232 #ifde‡
__KERNEL__


233 
	`¥_öfo
("%c", ()
wh©
);

235 
	~<uni°d.h
>

236 
buf
 = ()
wh©
;

237 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

239 
	}
}

248 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

250 
c
 = 0, 
m
; \

251 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

253 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

254 
	`bìp
((
vÆ
)); \

255 
c
++; \

256 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

257 
m
 = 0; m < 50; m++); \

258 
x
 = 
ö√r_ödex
 / 2; \

262 }

	)

265 #ifde‡
__KERNEL__


266 
dñay_£c
();

278 
	$dñay_£c
(
vÆ
)

280 
	`asm
 ("");

281 i‡(
	`ö_èsk
()) {

282 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

283 i‡(
vÆ
 == -1)

284 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

286 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

288 
	}
}

291 #ifde‡
__KERNEL__


299 
	~<löux/jiffõs.h
>

300 
	~<löux/ktime.h
>

301 
	#SHOW_DELTA
(
œãr
, 
óæõr
) do { \

302 i‡(
	`time_a·î
(()
œãr
, ()
óæõr
)) { \

303 
s64
 
dñè_ns
 = 
	`ktime_to_ns
(
	`ktime_sub
(
œãr
, 
óæõr
)); \

304 
	`¥_öfo
("dñè: %ŒdÇs", 
dñè_ns
); \

305 i‡(
dñè_ns
/1000 >= 1) \

306 
	`¥_c⁄t
(" (~ %Œd us", 
dñè_ns
/1000); \

307 i‡(
dñè_ns
/1000000 >= 1) \

308 
	`¥_c⁄t
(" ~ %Œd ms", 
dñè_ns
/1000000); \

309 i‡(
dñè_ns
/1000 >= 1) \

310 
	`¥_c⁄t
(")\n"); \

312 
	`¥_w¨n
("SHOW_DELTA(): *invalid*Éarlier >Üater? (check order ofÖarams)\n"); \

313 } 0)

	)

	@Training/L2_kernel_trg/foreach/prcs_show/foreach.c

11 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

13 
	~<löux/kî√l.h
>

14 
	~<löux/moduÀ.h
>

15 
	~<löux/öô.h
>

16 
	~<löux/sched.h
>

18 
	~<löux/vîsi⁄.h
>

19 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4, 11, 0)

20 
	~<löux/sched/sig«l.h
>

22 
	~<löux/fs.h
>

23 
	~<löux/¶ab.h
>

24 
	~<löux/uac˚ss.h
>

25 
	~<löux/kÆlsyms.h
>

27 
	#DRVNAME
 "f‹óch"

	)

28 
	#MY_MAJOR
 0

	)

29 
	#MAXKBUF_LEN
 (20*1024)

30 

	)

31 
	gèsköfo_maj‹
 = 
MY_MAJOR
;

33 
ssize_t
 
	$èsköfo_ªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
, 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

35 
èsk_°ru˘
 *
p
;

36 *
kbuf
, 
tmp
[128];

37 
numªad
 = 0, 
num
 = 0;

39 
kbuf
 = 
	`kzÆloc
(
MAXKBUF_LEN
, 
GFP_KERNEL
);

40 i‡(!
kbuf
)

41  -
ENOMEM
;

43 
	`rcu_ªad_lock
();

44 
	`f‹_óch_¥o˚ss
(
p
) {

45 
	`mem£t
(
tmp
, 0, 128);

46 
	`èsk_lock
(
p
);

47 
	`gë_èsk_°ru˘
(
p
);

48 
num
 = 
	`¢¥ötf
(
tmp
, 128, "\
%-16s|%7d|%7d|%7u|%7u\n", 
p
->
comm
,Ö->
tgid
,Ö->
pid
,

52 
	`__kuid_vÆ
(
p
->
¸ed
->
uid
), __kuid_vÆ’->¸ed->
euid
)

54 
	`°∫ˇt
(
kbuf
, 
tmp
, 
num
);

55 
numªad
 +
num
;

56 
	`¥_debug
("num=%dÇumªad=%dÅmp=%s\n", 
num
, 
numªad
, 
tmp
);

59 i‡(
	`c⁄d_ªsched
())

60 
	`¥_debug
("resched occuredÇow\n");

62 
	`put_èsk_°ru˘
(
p
);

63 
	`èsk_u∆ock
(
p
);

65 
	`rcu_ªad_u∆ock
();

70 i‡(
	`c›y_to_u£r
(
buf
, 
kbuf
, 
numªad
)) {

71 
	`¥_Æît
("copy_to_user failed..\n");

72 
	`k‰ì
(
kbuf
);

73  -
EFAULT
;

76 
	`k‰ì
(
kbuf
);

77  
cou¡
;

78 
	}
}

80 
ssize_t
 
	$èsköfo_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
,

81 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

83 
	`¥_debug
("write isn't supported. [fyi,Örocess %s [pid %d], count=%ld]\n",

84 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
);

85  -
ENOSYS
;

86 
	}
}

89 c⁄° 
fûe_›î©i⁄s
 
	gèsköfo_f›s
 = {

90 .
Œ£ek
 = 
no_Œ£ek
,

91 .
	gªad
 = 
èsköfo_ªad
,

92 .
	gwrôe
 = 
èsköfo_wrôe
,

95 
	$èsköfo_›í
(
öode
 *öode, 
fûe
 *
fûp
)

97 
	`¥_debug
("Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

99 
	`imö‹
(
öode
)) {

101 
fûp
->
f_›
 = &
èsköfo_f›s
;

104  -
ENXIO
;

106 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

107  
fûp
->
f_›
->
	`›í
(
öode
, filp);

113 
	}
}

116 c⁄° 
fûe_›î©i⁄s
 
	gèsköfo›í_f›s
 = {

117 .
›í
 = 
èsköfo_›í
,

126 
__öô
 
	$èsköfo_öô_moduÀ
()

128 
ªsu…
;

130 
	`¥_debug
("èsköfo_maj‹=%d\n", 
èsköfo_maj‹
);

136 
ªsu…
 = 
	`ªgi°î_chrdev
(
èsköfo_maj‹
, 
DRVNAME
, &
èsköfo›í_f›s
);

137 i‡(
ªsu…
 < 0) {

138 
	`¥_debug
("register_chrdev() failedÅryingÅo getÅaskinfo_major=%d\n",

139 
èsköfo_maj‹
);

140  
ªsu…
;

143 i‡(
èsköfo_maj‹
 == 0)

144 
èsköfo_maj‹
 = 
ªsu…
;

145 
	`¥_öfo
("ªgi°îed::Åasköfo_maj‹=%d\n", 
èsköfo_maj‹
);

148 
	}
}

150 
__exô
 
	$èsköfo_˛ónup_moduÀ
()

152 
	`uƒegi°î_chrdev
(
èsköfo_maj‹
, 
DRVNAME
);

153 
	`¥_öfo
("Unregistered.\n");

154 
	}
}

156 
moduÀ_öô
(
èsköfo_öô_moduÀ
);

157 
moduÀ_exô
(
èsköfo_˛ónup_moduÀ
);

159 
moduÀ_∑øm
(
èsköfo_maj‹
, , 0);

161 
MODULE_PARM_DESC
(
èsköfo_maj‹
, "MajorÇumberÅoáttemptÅo use");

162 
MODULE_AUTHOR
("Kaiwan");

163 
MODULE_DESCRIPTION
("Simple moduleÅhatÑeturnsÅask infoÅo userspace");

164 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L2_kernel_trg/foreach/prcs_show/rdtasks.c

11 
	~<°dio.h
>

12 
	~<uni°d.h
>

13 
	~<sys/ty≥s.h
>

14 
	~<limôs.h
>

15 
	~<sys/°©.h
>

16 
	~<f˙é.h
>

17 
	~<sig«l.h
>

18 
	~<°dlib.h
>

20 
	#FLGS
 
O_RDONLY


	)

21 
	#DMODE
 0

	)

22 
	#SZ
 1024

	)

24 
	$sig
(
signum
)

26 
	`Ârötf
(
°dîr
, "I¿sig: signum=%d\n", 
signum
);

27 
	}
}

29 
	$maö
(
¨gc
, **
¨gv
)

31 
fd
, 
n
;

32 
siga˘i⁄
 
a˘
;

33 *
buf
 = 
NULL
;

34 
size_t
 
num
 = 0;

36 i‡(
¨gc
 != 3) {

37 
	`Ârötf
(
°dîr
, "Ußge: %†devi˚_fûênum_byãs_to_ªad\n", 
¨gv
[0]);

38 
	`exô
(1);

41 
a˘
.
ß_h™dÀr
 = 
sig
;

42 
a˘
.
ß_Êags
 = 
SA_RESTART
;

43 
	`sigem±y£t
(&
a˘
.
ß_mask
);

44 i‡((
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0)) == -1) {

45 
	`≥º‹
("siga˘i⁄"), 
	`exô
(1);

48 i‡((
fd
 = 
	`›í
(
¨gv
[1], 
FLGS
, 
DMODE
)) == -1)

49 
	`≥º‹
("›í"), 
	`exô
(1);

50 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

52 
num
 = 
	`©oi
(
¨gv
[2]);

53 i‡((
num
 < 0Ë|| (num > 
INT_MAX
)) {

54 
	`Ârötf
(
°dîr
, "%s:Çumbî o‡byã†'%ld' invÆid.\n", 
¨gv
[0], 
num
);

55 
	`˛o£
(
fd
);

56 
	`exô
(1);

59 
buf
 = 
	`mÆloc
(
num
);

60 i‡(!
buf
) {

61 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!\n", 
¨gv
[0]);

62 
	`˛o£
(
fd
);

63 
	`exô
(1);

66 
n
 = 
	`ªad
(
fd
, 
buf
, 
num
);

67 i‡(
n
 < 0) {

68 
	`≥º‹
("read failed");

69 
	`‰ì
(
buf
);

70 
	`˛o£
(
fd
);

71 
	`exô
(1);

73 
buf
[
n
 - 1] = '\0';

88 
	`¥ötf
("%s:Ñód %d byã†‰om %s\n", 
¨gv
[0], 
n
,árgv[1]);

89 
	`¥ötf
("\
----------------------------------------------------------------------\n\
 Name | TGID | PID | RUID | EUID\n\
----------------------------------------------------------------------\n");

93 
	`˛o£
(
fd
);

95 
	`¥ötf
("%s\n", 
buf
);

97 
	`‰ì
(
buf
);

98 
	`exô
(0);

99 
	}
}

	@Training/L2_kernel_trg/foreach/thrd_show/showthreads.c

8 
	~<löux/kî√l.h
>

9 
	~<löux/moduÀ.h
>

10 
	~<löux/sched.h
>

12 
	~<löux/vîsi⁄.h
>

13 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4,11,0)

14 
	~<löux/sched/sig«l.h
>

17 
	#DRVNAME
 "showthªads"

	)

19 
	$showthrds
()

21 
èsk_°ru˘
 *
g
, *
t
;

22 
ƒ_thrds
=1;

23 
buf
[256], 
tmp
[128];

25 
	`¥_öfo
(

31 
	`rcu_ªad_lock
();

32 
	`do_óch_thªad
(
g
, 
t
) {

33 
	`èsk_lock
(
t
);

34 
	`gë_èsk_°ru˘
(
t
);

36 
	`¢¥ötf
(
buf
, 256, "%6d %6d ", 
g
->
tgid
, 
t
->
pid
);

37 i‡(!
g
->
mm
) {

38 
	`¢¥ötf
(
tmp
, 128, "[%30s]", 
t
->
comm
);

40 
	`¢¥ötf
(
tmp
, 128, " %30†", 
t
->
comm
);

42 
	`°∫ˇt
(
buf
, 
tmp
, 128);

44 
ƒ_thrds
 = 
	`gë_ƒ_thªads
(
g
);

46 i‡(
g
->
mm
 && (g->
tgid
 =
t
->
pid
Ë&& (
ƒ_thrds
 > 1)) {

47 
	`¢¥ötf
(
tmp
, 128, " %4d", 
ƒ_thrds
);

48 
	`°∫ˇt
(
buf
, 
tmp
, 128);

51 
	`¢¥ötf
(
tmp
, 2, "\n");

52 
	`°∫ˇt
(
buf
, 
tmp
, 2);

53 
	`¥_öfo
("%s", 
buf
);

55 
	`mem£t
(
buf
, 0, (buf));

56 
	`mem£t
(
tmp
, 0, (tmp));

57 
	`put_èsk_°ru˘
(
t
);

58 
	`èsk_u∆ock
(
t
);

59 } 
	`whûe_óch_thªad
(
g
, 
t
);

60 
	`rcu_ªad_u∆ock
();

61 
	}
}

63 
__öô
 
	$showthrds_öô_moduÀ
()

65 
	`showthrds
();

67 
	}
}

69 
__exô
 
	$showthrds_˛ónup_moduÀ
()

71 
	`¥_öfo
("%s: unﬂded.\n", 
KBUILD_MODNAME
);

72 
	}
}

74 
moduÀ_öô
(
showthrds_öô_moduÀ
);

75 
moduÀ_exô
(
showthrds_˛ónup_moduÀ
);

77 
MODULE_AUTHOR
("Kaiwan NB");

78 
MODULE_DESCRIPTION
("DisplaysállÅhreads.");

79 
MODULE_LICENSE
("GPL");

	@Training/L2_kernel_trg/helloworld/hello.c

1 
	~<löux/öô.h
>

2 
	~<löux/moduÀ.h
>

3 
	~<löux/kî√l.h
>

5 
MODULE_LICENSE
("Dual MIT/GPL");

7 
__öô
 
	$hñlo_öô
()

9 
	`¥_Æît
("Hello, LKM world\n");

12  -
ENOMEM
;

23 
	}
}

25 
__exô
 
	$hñlo_exô
()

27 
	`¥_Æît
("Goodbye, cruel world\n");

28 
	}
}

30 
moduÀ_öô
(
hñlo_öô
);

31 
moduÀ_exô
(
hñlo_exô
);

	@Training/L2_kernel_trg/list/list.c

10 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

12 
	~<löux/öô.h
>

13 
	~<löux/kî√l.h
>

14 
	~<löux/moduÀ.h
>

15 
	~<löux/¶ab.h
>

16 
	~<löux/li°.h
>

18 
MODULE_AUTHOR
("kaiwanTECH");

19 
MODULE_DESCRIPTION
("a simple Linux kernelÜinkedÜist usage demo");

20 
MODULE_LICENSE
("Dual MIT/GPL");

21 
MODULE_VERSION
("0.1");

23 
LIST_HEAD
(
hód_node
);

24 
	snode
 {

25 
li°_hód
 
	mli°
;

27 
	mivÆ1
, 
	mivÆ2
;

28 
s8
 
	mÀâî
;

31 
	$add2èû
(
v1
, 
v2
, 
s8
 
ach¨
)

33 
node
 *
mynode
 = 
NULL
;

35 
mynode
 = 
	`kzÆloc
((
node
), 
GFP_KERNEL
);

36 i‡(!
mynode
)

37  -
ENOMEM
;

38 
mynode
->
ivÆ1
 = 
v1
;

39 
mynode
->
ivÆ2
 = 
v2
;

40 
mynode
->
Àâî
 = 
ach¨
;

42 
	`INIT_LIST_HEAD
(&
mynode
->
li°
);

44 
	`li°_add_èû
(&
mynode
->
li°
, &
hód_node
);

45 
	`¥_öfo
("AddedáÇodê(wôhÜëã∏'%c'Ëtÿthêli°...\n", 
ach¨
);

48 
	}
}

50 
	$showli°
()

53 
node
 *
cuº
;

55 i‡(
	`li°_em±y
(&
hód_node
))

58 
	`¥_öfo
(" val1 | val2 |Üetter\n");

60 
	`li°_f‹_óch
(
±r
, &
hód_node
) {

61 
cuº
 = 
	`li°_íåy
(
±r
, 
node
, 
li°
);

64 
	`li°_f‹_óch_íåy
(
cuº
, &
hód_node
, 
li°
) {

66 
	`¥_öfo
("%9d %9d %c\n",

67 
cuº
->
ivÆ1
, cuº->
ivÆ2
, cuº->
Àâî
);

69 
	}
}

72 
	$födöli°_Àâî
(
s8
 
ch¨2loˇã
)

74 
node
 *
cuº
;

75 
i
 = 0;

76 
boﬁ
 
found
 = 
Ál£
;

78 i‡(
	`li°_em±y
(&
hód_node
))

81 
	`¥_öfo
("SórchögÜi° f‹Üëã∏'%c'...\n", 
ch¨2loˇã
);

82 
	`li°_f‹_óch_íåy
(
cuº
, &
hód_node
, 
li°
) {

83 i‡(
cuº
->
Àâî
 =
ch¨2loˇã
) {

84 
found
 = 
åue
;

85 
	`¥_öfo
("found '%c' @Çode #%d:\n"

87 
ch¨2loˇã
, 
i
, 
cuº
->
ivÆ1
, cuº->
ivÆ2
, cuº->
Àâî
);

89 
i
++;

91 i‡(!
found
)

92 
	`¥_öfo
("Didn'àföd '%c' i¿li°\n", 
ch¨2loˇã
);

93 
	}
}

95 
	$‰ìli°
()

97 
node
 *
cuº
;

99 i‡(
	`li°_em±y
(&
hód_node
))

102 
	`¥_öfo
("freeingÜist items...\n");

103 
	`li°_f‹_óch_íåy
(
cuº
, &
hód_node
, 
li°
)

104 
	`k‰ì
(
cuº
);

105 
	}
}

107 
__öô
 
	$li°_öô
()

109 
	`add2èû
(1, 2, 'l');

110 
	`add2èû
(5, 1000, 'i');

111 
	`add2èû
(3, 1415, 's');

112 
	`add2èû
(
jiffõs
, jiffõs+
	`m£cs_to_jiffõs
(300), 't');

113 
	`showli°
();

114 
	`födöli°_Àâî
('s');

115 
	`födöli°_Àâî
('z');

118 
	}
}

120 
__exô
 
	$li°_exô
()

122 
	`‰ìli°
();

123 
	`¥_öfo
("removed\n");

124 
	}
}

126 
moduÀ_öô
(
li°_öô
);

127 
moduÀ_exô
(
li°_exô
);

	@Training/L2_kernel_trg/lkm_template/lkm_template.c

12 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

14 
	~<löux/öô.h
>

15 
	~<löux/moduÀ.h
>

17 
MODULE_AUTHOR
("<insert yourÇame here>");

18 
MODULE_DESCRIPTION
("a hello, worldÅype LKM");

19 
MODULE_LICENSE
("Dual MIT/GPL");

20 
MODULE_VERSION
("0.1");

22 
__öô
 
	$lkm_ãm∂©e_öô
()

24 
	`¥_öfo
("inserted\n");

25 #ifde‡
DEBUG


26 
	`¥_öfo
("DEBUG defined\n");

27 
	`¥_debug
("thisÖr_debug() will work!\n");

29 
	`¥_öfo
("DEBUG undefined\n");

30 
	`¥_debug
("thisÖr_debug() won't work!\n");

33 
	}
}

35 
__exô
 
	$lkm_ãm∂©e_exô
()

37 
	`¥_öfo
("removed\n");

38 
	}
}

40 
moduÀ_öô
(
lkm_ãm∂©e_öô
);

41 
moduÀ_exô
(
lkm_ãm∂©e_exô
);

	@Training/L2_kernel_trg/mm/allocsize_tests/kmalloc_test/kmalloc_test.c

1 
	~<löux/öô.h
>

2 
	~<löux/moduÀ.h
>

3 
	~<löux/¶ab.h
>

4 
	~"../../../c⁄víõ¡.h
"

6 
MODULE_LICENSE
("Dual MIT/GPL");

8 
__öô
 
	$kmt_öô
()

10 
num
=100;

11 *
p
;

13 
p
 = 
	`kmÆloc
(
num
, 
GFP_KERNEL
);

14 i‡(!
p
) {

15 
	`¥_Æît
("kmÆlo¯Áû,Çum=%d\n", 
num
);

16  -
ENOMEM
;

18 
num
 += 1000;

19 
	`¥_öfo
("kmÆloc(%7dË%p\n", 
num
, 
p
);

20 
	`k‰ì
(
p
);

23 
	}
}

25 
__exô
 
	$kmt_exô
()

27 
	`¥_öfo
("Goodbye\n");

28 
	}
}

30 
moduÀ_öô
(
kmt_öô
);

31 
moduÀ_exô
(
kmt_exô
);

	@Training/L2_kernel_trg/mm/allocsize_tests/ksize_test/ksz_test.c

22 
	~<löux/öô.h
>

23 
	~<löux/kî√l.h
>

24 
	~<löux/moduÀ.h
>

25 
	~<löux/¶ab.h
>

27 
MODULE_LICENSE
("Dual MIT/GPL");

28 
MODULE_AUTHOR
("Kaiwan NB, kaiwanTECH");

29 
	gMODULE_DESCRIPTION


33 
	g°ïsz
 = 10000;

34 
moduÀ_∑øm
(
°ïsz
, , 0);

35 
MODULE_PARM_DESC
(
°ïsz
,

38 c⁄° *
	ghdr
 =

42 
__öô
 
	$kmt_öô
()

44 
num
 = 100, 
a˘uÆ_Æloc
 = 0;

45 *
p
;

47 
	`¥_öfo
("%s", 
hdr
);

50 
p
 = 
	`kmÆloc
(
num
, 
GFP_KERNEL
);

51 i‡(
	`u∆ikñy
(!
p
)) {

52 
	`¥_Æît
("kmÆlo¯Áû,Çum=%d\n", 
num
);

53  -
ENOMEM
;

55 
a˘uÆ_Æloc
 = 
	`ksize
(
p
);

56 
	`¥_öfo
("kmalloc(%7d) : %7d : %7d : %3d%%\n",

57 
num
, 
a˘uÆ_Æloc
,áctual_alloc -Çum,

58 (((
a˘uÆ_Æloc
 - 
num
) * 100 /Çum)));

59 
	`k‰ì
(
p
);

60 
num
 +
°ïsz
;

63 
	}
}

65 
__exô
 
	$kmt_exô
()

67 
	`¥_öfo
("Goodbye\n");

68 
	}
}

70 
moduÀ_öô
(
kmt_öô
);

71 
moduÀ_exô
(
kmt_exô
);

	@Training/L2_kernel_trg/mm/slab_custom/slab_custom.c

12 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

14 
	~<löux/kî√l.h
>

15 
	~<löux/moduÀ.h
>

16 
	~<löux/öô.h
>

17 
	~<löux/vîsi⁄.h
>

18 
	~<löux/highmem.h
>

19 
	~<löux/¶ab.h
>

20 
	~"../../c⁄víõ¡.h
"

22 
	#DRVNAME
 "¶ab_cu°om"

	)

23 
	#MYBUFSZ
 350

24 

	)

25 
kmem_ˇche
 *
	gmy_ˇchï
;

27 
	sMySåu˘
 {

28 
u32
 
	ma
, 
	mb
, 
	mc
;

29 
s8
 *
	m˝å
;

30 
u16
 
	mvÆid
;

31 
u8
 
	mötbuf
[
MYBUFSZ
];

34 
	$myˇche_u£
()

36 *
obje˘
;

38 #i‡
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2, 6, 39)

39 
	`¥_öfo
("Cachê«mêi†%s\n", 
	`kmem_ˇche_«me
(
my_ˇchï
));

41 
	`¥_öfo
("[ker ver > 2.6.38 cacheÇame deprecated...]\n");

43 
	`¥_öfo
("Cachêobje˘ sizêi†%u\n", 
	`kmem_ˇche_size
(
my_ˇchï
));

45 
obje˘
 = 
	`kmem_ˇche_Æloc
(
my_ˇchï
, 
GFP_KERNEL
);

47 
	`mem£t
(
obje˘
, 0x´, (
MySåu˘
));

48 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
obje˘
, (
MySåu˘
));

50 
	`kmem_ˇche_‰ì
(
my_ˇchï
, 
obje˘
);

51 
	}
}

53 
	$öô_my_ˇche
()

56 *
¢um
 = "1002";

57 
n
;

60 
n
 = 
	`k°πoöt
(
¢um
, 0, &n);

61 
	`¥_öfo
("¿%d, sÀn=%ld\n", 
n
, 
	`°æí
(
¢um
));

69 
	`¥_debug
("sizeof(MySåu˘Ë%lu\n", (
MySåu˘
));

76 
my_ˇchï
 = 
	`kmem_ˇche_¸óã
(
DRVNAME
,

77 (
MySåu˘
), 0,

78 
SLAB_HWCACHE_ALIGN
,

79 
NULL
);

80 
	}
}

82 
	$¶ab£e_öô
()

84 
	`öô_my_ˇche
();

85 
	`myˇche_u£
();

86 
	`¥_öfo
("initialized\n");

89 
	}
}

91 
	$¶ab£e_exô
()

93 
	`kmem_ˇche_de°roy
(
my_ˇchï
);

94 
	`¥_öfo
("removed\n");

95 
	}
}

97 
moduÀ_öô
(
¶ab£e_öô
);

98 
moduÀ_exô
(
¶ab£e_exô
);

100 
MODULE_LICENSE
("MIT");

	@Training/L2_kernel_trg/mm/vm_show_kernel_seg/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_PRINT


47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=1; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 
	`¥ötk
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

59 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

126 
	~<löux/sched.h
>

127 
	~<löux/öãºu±.h
>

129 #i‚de‡
USE_FTRACE_PRINT


130 
	#PRINT_CTX
() do { \

131 
£p
='|', 
öå
='.'; \

133 i‡(
	`ö_öãºu±
()) { \

134 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

135 
öå
='H'; \

136 i‡(
	`ö_úq
()) \

137 
öå
='h'; \

138 i‡(
	`ö_so·úq
()) \

139 
öå
='s'; \

142 
öå
='.'; \

144 
	`DBGPRINT
( \

148 , 
	`smp_¥o˚ss‹_id
(), \

149 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

150 (
	`úqs_dißbÀd
()?'d':'.'), \

151 (
	`√ed_ªsched
()?'N':'.'), \

152 
öå
, \

153 (
	`¥ìm±_cou¡
() && 0xff) \

155 } 0)

	)

157 
	#PRINT_CTX
() do { \

158 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

163 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

165 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

166 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

168 } 0)

	)

184 #ifde‡
__KERNEL__


185 
	#as£π
(
ex¥
) do { \

186 i‡(!(
ex¥
)) { \

187 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

188 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

190 } 0)

	)

194 
ölöe
 
	$bìp
(
wh©
)

196 #ifde‡
__KERNEL__


197 
	`DBGPRINT
("%c", ()
wh©
);

199 ()
	`¥ötf
("%c", ()
wh©
);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

210 
c
=0, 
m
;\

211 
f‹_ödex
,
ö√r_ödex
; \

213 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++;\

216 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

217 
m
=0;m<50;m++); \

220 }

	)

223 #ifde‡
__KERNEL__


228 
	#DELAY_SEC
(
vÆ
) \

230 i‡(!
	`ö_öãºu±
()) { \

231 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

232 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

234 }

	)

241 
timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

242 
timevÆ
 *
y
);

246 
__©åibuã__
 ((
unu£d
))

247 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

248 
timevÆ
 *
y
)

251 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

252 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

253 
y
->
tv_u£c
 -1000000 * 
n£c
;

254 
y
->
tv_£c
 +
n£c
;

256 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

257 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

258 
y
->
tv_u£c
 +1000000 * 
n£c
;

259 
y
->
tv_£c
 -
n£c
;

264 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

265 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

268  
x
->
tv_£c
 < 
y
->tv_sec;

269 
	}
}

280 
__©åibuã__
 ((
unu£d
))

281 
	$dec2bö
(
decimÆ
, *
bö¨y
)

283 
k
 = 0, 
n
 = 0;

284 
√g_Êag
 = 0;

285 
ªmaö
;

295 #unde‡
TESTMODE


297 #ifde‡
TESTMODE


298 
ﬁd_decimÆ
;

300 
ãmp
[80];

303 i‡(
decimÆ
 < 0) {

304 
decimÆ
 = -decimal;

305 
√g_Êag
 = 1;

308 #ifde‡
TESTMODE


309 
ﬁd_decimÆ
 = 
decimÆ
;

311 
ªmaö
 = 
decimÆ
 % 2;

313 
decimÆ
 = decimal / 2;

315 #ifde‡
TESTMODE


316 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

317 
ªmaö
);

320 
ãmp
[
k
++] = 
ªmaö
 + '0';

321 } 
decimÆ
 > 0);

323 i‡(
√g_Êag
)

324 
ãmp
[
k
++] = '-';

326 
ãmp
[
k
++] = ' ';

329 
k
 >= 0)

330 
bö¨y
[
n
++] = 
ãmp
[--
k
];

332 
bö¨y
[
n
 - 1] = 0;

333 
	}
}

335 #i‚de‡
__KERNEL__


337 
	#MSG
(
°rög
, 
¨gs
...) do { \

338 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

339 } 0)

	)

341 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

342 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

343 } 0)

	)

345 
	#QP
 
	`MSG
("\n")

	)

348 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

350 i‡(
vîbo£
) \

351 
	`¥ötf
(
°r
, ##
¨gs
); \

352 } 0)

	)

354 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

356 
îr_°r
[512];

358 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

359 
	`≥º‹
(
îr_°r
);

360 
	`exô
(
exôcode
);

361 
	}
}

	@Training/L2_kernel_trg/mm/vm_show_kernel_seg/vm_show_kernel_seg.c

12 
	~<löux/öô.h
>

13 
	~<löux/moduÀ.h
>

14 
	~<löux/kî√l.h
>

15 
	~<löux/sched.h
>

16 
	~<löux/mm.h
>

17 
	~<löux/highmem.h
>

18 
	~<löux/¶ab.h
>

19 
	~<löux/vmÆloc.h
>

20 
	~<asm/pgèbÀ.h
>

21 
	~"../../c⁄víõ¡.h
"

23 #if(
BITS_PER_LONG
 == 32)

24 
	#FMTSPC
 "%08x"

	)

25 
	#FMTSPC_DEC
 "%08d"

	)

26 
	#TYPECST
 

	)

27 
	#MY_PATTERN1
 0xdódÁ˚

	)

28 
	#MY_PATTERN2
 0xf„eddcc

	)

29 #ñif(
BITS_PER_LONG
 == 64)

30 
	#FMTSPC
 "%016lx"

	)

31 
	#FMTSPC_DEC
 "%ld"

	)

32 
	#TYPECST
 

	)

33 
	#MY_PATTERN1
 0xdódÁ˚dódÁ˚

	)

34 
	#MY_PATTERN2
 0xf„eddccbbØ9988

	)

37 
	g°©gul
;

39 
	$b¨
()

41 
	`¥_öfo
("---------------------Stack Dump:-------------------------------\n");

42 
	`dump_°ack
();

43 
	`¥_öfo
("---------------------------------------------------------------\n");

44 
	}
}

45 
	$foo
()

47 
c
='x';

48 
	`¥_öfo
("&¯0x" 
FMTSPC
 "\n", (
TYPECST
)&
c
);

49 
	`b¨
();

50 
	}
}

52 
	ggP©ã∫1
[] = {0xde, 0xad, 0xfa, 0xce,

54 
	ggP©ã∫2
[] = {0x88, 0x99, 0xaa, 0xbb,

58 
	$mem∑âîn
–*
pde°
, *
∑âîn
, 
Àn
)

60 
i
=0;

61 #if(
BITS_PER_LONG
 == 32)

62 
u32
 *
∑â±r
 = (u32 *)
pde°
;

63 #ñif(
BITS_PER_LONG
 == 64)

64 
u64
 *
∑â±r
 = (u64 *)
pde°
;

67 #if(
BITS_PER_LONG
 == 32)

68 
i
=0; i < 
Àn
/(
u32
 *); i++)

69 #ñif(
BITS_PER_LONG
 == 64)

70 
i
=0; i < 
Àn
/(
u64
 *); i++)

74 
	`mem˝y
(
∑â±r
, 
∑âîn
, (*));

75 
∑â±r
 ++;

77 
	}
}

79 *
	gk±r
=
NULL
, *
	gv±r
=NULL;

80 vﬁ©ûê
u32
 
	gvg
=0x1234abcd;

82 
__öô
 
	$vm_img_öô
()

84 
knum
=512, 
di•
=32;

86 
	`¥_öfo
("Platform:\n");

87 #ifde‡
CONFIG_X86


88 #if(
BITS_PER_LONG
 == 32)

89 
	`¥_öfo
(" x86-32 : ");

91 
	`¥_öfo
(" x86_64 : ");

94 #ifde‡
CONFIG_ARM


95 
	`¥_öfo
(" ARM-32 : ");

97 #ifde‡
CONFIG_ARM64


98 
	`¥_öfo
(" ARM64 : ");

100 #ifde‡
CONFIG_MIPS


101 
	`¥_öfo
(" MIPS : ");

103 #ifde‡
CONFIG_PPC


104 
	`¥_öfo
(" PPC : ");

107 #if(
BITS_PER_LONG
 == 32)

108 
	`¥_öfo
 (" 32-bit OS ");

109 #ñif(
BITS_PER_LONG
 == 64)

110 
	`¥_öfo
 (" 64-bit OS ");

112 #ifde‡
__BIG_ENDIAN


113 
	`¥_öfo
(" Big-endian.\n");

115 
	`¥_öfo
(" Little-endian.\n");

123 
	`¥_öfo
 (" sizeof(int) =%zu, sizeof(long) =%zu\n"

125 (), (), (*), (
u64
 *));

127 
k±r
 = 
	`kzÆloc
(
knum
, 
GFP_KERNEL
);

128 i‡(!
k±r
) {

129 
	`¥_Æît
("kzalloc failed!\n");

130  -
ENOMEM
;

150 
	`¥_öfo
("kmÆloc'ed mem‹y dum∞(%d byã†@ %pK):\n", 
di•
, 
k±r
);

151 
	`mem∑âîn
(
k±r
, &
gP©ã∫1
[0], 
knum
);

152 
	`¥öt_hex_dump_byãs
("k±r: ", 
DUMP_PREFIX_ADDRESS
, 
k±r
, 
di•
);

154 
v±r
 = 
	`vmÆloc
(42*
PAGE_SIZE
);

155 i‡(!
v±r
) {

156 
	`¥_Æît
("vmalloc failed!\n");

157 
	`k‰ì
(
k±r
);

158  -
ENOMEM
;

161 
	`mem∑âîn
(
v±r
, &
gP©ã∫2
[0], 
PAGE_SIZE
);

162 
	`¥_öfo
("vmÆloc'ed mem‹y dum∞(%d byã†@ %pK):\n", 
di•
, 
v±r
);

163 
	`¥öt_hex_dump_byãs
("v±r: ", 
DUMP_PREFIX_ADDRESS
, 
v±r
, 
di•
);

165 
	`¥_öfo
 (

167 #ifde‡
CONFIG_X86


168 " FIXADDR_START = 0x" 
FMTSPC
 "\n"

170 " MODULES_END = 0x" 
FMTSPC
 "\n"

171 " MODULES_VADDR = 0x" 
FMTSPC
 " [moduÀ†ønge: " 
FMTSPC_DEC
 " MB]\n"

172 #ifde‡
CONFIG_X86


173 " CPU_ENTRY_AREA_BASE = 0x" 
FMTSPC
 "\n"

174 " VMEMMAP_START = 0x" 
FMTSPC
 "\n"

176 " VMALLOC_END = 0x" 
FMTSPC
 "\n"

177 " VMALLOC_START = 0x" 
FMTSPC
 " [vmÆlo¯ønge: " 
FMTSPC_DEC
 " MB =" FMTSPC_DEC " GB]" "\n"

178 " PAGE_OFFSET = 0x" 
FMTSPC
 " [lowmemÑegion: start ofállÖhy mapped RAM (hereÅo RAM-size)]\n",

179 #ifde‡
CONFIG_X86


180 (
TYPECST
)
FIXADDR_START
,

182 (
TYPECST
)
MODULES_END
, (TYPECST)
MODULES_VADDR
,

183 (
TYPECST
)((
MODULES_END
-
MODULES_VADDR
)/(1024*1024)),

184 #ifde‡
CONFIG_X86


185 (
TYPECST
)
CPU_ENTRY_AREA_BASE
,

186 (
TYPECST
)
VMEMMAP_START
,

188 (
TYPECST
)
VMALLOC_END
, (TYPECST)
VMALLOC_START
,

189 (
TYPECST
)((
VMALLOC_END
-
VMALLOC_START
)/(1024*1024)),

190 (
TYPECST
)((
VMALLOC_END
-
VMALLOC_START
)/(1024*1024*1024)),

191 (
TYPECST
)
PAGE_OFFSET
);

193 #ifde‡
CONFIG_KASAN


194 
	`¥_öfo
("\nKASAN_SHADOW_START = 0x" 
FMTSPC
 " KASAN_SHADOW_END = 0x" FMTSPC "\n",

195 (
TYPECST
)
KASAN_SHADOW_START
, (TYPECST)
KASAN_SHADOW_END
);

203 
	`¥_öfo
("\n");

204 
	`PRINT_CTX
();

205 
	`¥_öfo
 (

207 " [TASK_SIZE = 0x" 
FMTSPC
 " size of userland]\n"

209 "Énv_íd = 0x" 
FMTSPC
 "\n"

210 "Énv_°¨à = 0x" 
FMTSPC
 "\n"

211 "árg_íd = 0x" 
FMTSPC
 "\n"

212 "árg_°¨à = 0x" 
FMTSPC
 "\n"

213 " sèπ_°ack = 0x" 
FMTSPC
 "\n"

214 " cuº brk = 0x" 
FMTSPC
 "\n"

215 " sèπ_brk = 0x" 
FMTSPC
 "\n"

216 "Énd_d©® = 0x" 
FMTSPC
 "\n"

217 " sèπ_d©® = 0x" 
FMTSPC
 "\n"

218 "Énd_codê = 0x" 
FMTSPC
 "\n"

219 " sèπ_codê = 0x" 
FMTSPC
 "\n"

221 (
TYPECST
)
TASK_SIZE
,

222 
cuºít
->
tgid
, cuºít->
pid
, cuºít->
comm
,

223 (
TYPECST
)
cuºít
->
mm
->
ív_íd
,

224 (
TYPECST
)
cuºít
->
mm
->
ív_°¨t
,

225 (
TYPECST
)
cuºít
->
mm
->
¨g_íd
,

226 (
TYPECST
)
cuºít
->
mm
->
¨g_°¨t
,

227 (
TYPECST
)
cuºít
->
mm
->
°¨t_°ack
,

228 (
TYPECST
)
cuºít
->
mm
->
brk
,

229 (
TYPECST
)
cuºít
->
mm
->
°¨t_brk
,

230 (
TYPECST
)
cuºít
->
mm
->
íd_d©a
,

231 (
TYPECST
)
cuºít
->
mm
->
°¨t_d©a
,

232 (
TYPECST
)
cuºít
->
mm
->
íd_code
,

233 (
TYPECST
)
cuºít
->
mm
->
°¨t_code
,

234 
cuºít
->
mm
->
m≠_cou¡
);

236 
	`¥_öfo
 (

238 "&°©gu»0x" 
FMTSPC
 ", &jiffies_64 = 0x%08lx, &vg = 0x" FMTSPC "\n"

239 "k±∏0x" 
FMTSPC
 " vptr = 0x" FMTSPC "\n",

240 (
TYPECST
)&
°©gul
, ()&
jiffõs_64
, (TYPECST)&
vg
,

241 (
TYPECST
)
k±r
, (TYPECST)
v±r
);

243 
	`foo
();

245 
	}
}

247 
__exô
 
	$vm_img_exô
()

249 
	`v‰ì
 (
v±r
);

250 
	`k‰ì
 (
k±r
);

251 
	`¥_öfo
("Done.\n");

252 
	}
}

254 
moduÀ_öô
(
vm_img_öô
);

255 
moduÀ_exô
(
vm_img_exô
);

257 
MODULE_AUTHOR
("Kaiwan N Billimoria <kaiwanát kaiwantech dot com>");

258 
MODULE_LICENSE
("Dual GPL/MIT");

	@Training/L2_kernel_trg/mm/vm_usermode/gen_malloc_pgfault/gen_malloc_pgfault.c

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<uni°d.h
>

24 
	~<sys/ty≥s.h
>

35 
	$maö
 (
¨gc
, **
¨gv
)

37 *
p
=0;

39 
p
 = 
	`mÆloc
(
	`gë∑gesize
());

40 i‡(!
p
) {

41 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!", 
¨gv
[0]);

42 
	`exô
(1);

44 *(
p
+200)='a';

46 
	`‰ì
(
p
);

47 
	`exô
 (0);

48 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/hello.c

1 
	~<°dio.h
>

2 
	$maö
()

4 
	`¥ötf
("Hello, world\n");

5 
	`∑u£
();

6 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/malloc_brk_test.c

31 
	~<°dio.h
>

32 
	~<°dlib.h
>

33 
	~<uni°d.h
>

34 
	~<sys/ty≥s.h
>

35 
	~<sys/waô.h
>

36 
	~<mÆloc.h
>

39 #unde‡
USE_CALLOC


41 
	#TRIES
 5

	)

42 *
	ghóp_±r
[
TRIES
];

43 *
	göô_brk
;

45 
	tu32
;

47 
	$Ælo˘e°
(
ödex
, 
size_t
 
num
)

49 *
p
;

51 #i‚de‡
USE_CALLOC


52 
p
 = 
	`mÆloc
(
num
);

54 
p
 = 
	`ˇŒoc
(
num
, ());

56 i‡(!
p
) {

57 
	`¥ötf
("out of memory!\n");

58 
	`exô
(1);

61 
hóp_±r
[
ödex
] = 
p
;

62 #i‚de‡
USE_CALLOC


63 
	`¥ötf
("\n%d: mÆloc", 
ödex
);

65 
	`¥ötf
("\n%d: cÆloc", 
ödex
);

67 
	`¥ötf
("(%6uËsuc˚ssful. Hó∞poöãr: %8p\n", 
num
, 
p
);

68 
	`¥ötf
("Cuºíàbªak: %8∞[dñè: %d]\n", 
	`sbrk
(0),

69 (
	`sbrk
(0Ë- 
öô_brk
));

71 
	`mÆloc_°©s
();

72 
	}
}

74 
	$maö
(
¨gc
, **
¨gv
)

76 
i
;

77 vﬁ©ûê*
q
;

79 
öô_brk
 = 
	`sbrk
(0);

80 
	`¥ötf
("Cuºíàbªak: %8p\n", 
öô_brk
);

81 
	`Ælo˘e°
(0, 8);

85 
q
 = 
hóp_±r
[0];

86 *(
q
 + 3000) = 'a';

90 
¥ötf


92 ()
q
, ()(q + 3000),

93 ()*(
q
 + 3000));

115 *(
q
 + 3000 + (
	`sbrk
(0Ë- 
öô_brk
)) = 'b';

122 
	`Ælo˘e°
(1, (
	`gë∑gesize
() - 8 - 5));

123 
	`Ælo˘e°
(2, 3);

125 
	`Ælo˘e°
(3, (
	`sbrk
(0Ë- 
öô_brk
 + 1000));

131 
	`Ælo˘e°
(4, 200000);

133 
i
 = 0; i < 
TRIES
; i++)

134 
	`‰ì
(
hóp_±r
[
i
]);

135 
	`exô
(0);

136 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/mem_sequence.c

19 
	~<°dio.h
>

20 
	~<°dlib.h
>

22 
	#MEM_TYPES
 5

	)

24 
	#STR_STACK
 "°ack"

	)

25 
	#STR_HEAP
 "hóp"

	)

26 
	#STR_BSS
 "bss"

	)

27 
	#STR_CONST
 "c⁄°'s"

	)

28 
	#STR_CODE
 "code"

	)

30 c⁄° 
	gc⁄°_exam∂e
[] = "constant string";

39 
	smemty≥_±r
 {

40 *
	m±r
;

41 *
	m°r
;

44 
memty≥_±r
 
	gty≥_poöãr
[
MEM_TYPES
];

47 
	gbss_exam∂e
[] = "A global variable";

50 
	$mem_xchg
(
memty≥_±r
 *
a
, memty≥_±∏*
b
)

52 
memty≥_±r
 
tmpmem±r
;

54 
tmpmem±r
.
°r
 = 
a
->str;

55 
tmpmem±r
.
±r
 = 
a
->ptr;

57 
a
->
°r
 = 
b
->str;

58 
a
->
±r
 = 
b
->ptr;

60 
b
->
°r
 = 
tmpmem±r
.str;

61 
b
->
±r
 = 
tmpmem±r
.ptr;

63 
	}
}

66 
	$¥öt_s‹ãd
(*
hóp_exam∂e
, 
°ack_exam∂e
)

69 
i
, 
j
;

76 
ty≥_poöãr
[0].
°r
 = 
STR_HEAP
;

77 
ty≥_poöãr
[0].
±r
 = 
hóp_exam∂e
;

79 
ty≥_poöãr
[1].
°r
 = 
STR_BSS
;

80 
ty≥_poöãr
[1].
±r
 = (*)&
bss_exam∂e
;

87 
ty≥_poöãr
[2].
°r
 = 
STR_STACK
;

88 
ty≥_poöãr
[2].
±r
 = &
°ack_exam∂e
;

94 
ty≥_poöãr
[3].
°r
 = 
STR_CODE
;

95 
ty≥_poöãr
[3].
±r
 = (*)
°ack_exam∂e
;

97 
ty≥_poöãr
[4].
°r
 = 
STR_CONST
;

98 
ty≥_poöãr
[4].
±r
 = (*)&
c⁄°_exam∂e
;

101 
j
 = 
MEM_TYPES
;

102 
j
--)

103 
i
 = 0; i < 
j
; i++)

104 i‡(
ty≥_poöãr
[
i
].
±r
 <Åype_pointer[i + 1].ptr)

105 
	`mem_xchg
(&
ty≥_poöãr
[
i
],

106 &
ty≥_poöãr
[
i
 + 1]);

109 
i
 = 0; i < 
MEM_TYPES
; i++)

110 
	`¥ötf
("%d.(0x%.8xË%s\n", 
i
 + 1,

111 ()
ty≥_poöãr
[
i
].
±r
,Åy≥_poöãr[i].
°r
);

114 
	}
}

117 
	$maö
()

120 *
dyn_Æloˇãd
, 
code_exam∂e
;

123 
code_exam∂e
 = ()&
maö
;

126 
dyn_Æloˇãd
 = (*)
	`mÆloc
(());

129 
	`¥öt_s‹ãd
(
dyn_Æloˇãd
, 
code_exam∂e
);

130 
	`gëch¨
();

133 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/mmap/fileio_mmap/mmap_fileio.c

14 
	~<°dio.h
>

15 
	~<°dlib.h
>

16 
	~<uni°d.h
>

17 
	~<sys/mm™.h
>

18 
	~<sys/ty≥s.h
>

19 
	~<sys/°©.h
>

20 
	~<f˙é.h
>

21 
	~"ª°¨t_lib.h
"

22 
	~"../../../../c⁄víõ¡.h
"

30 
	$maö
(
¨gc
, **
¨gv
)

32 
fd_‰om
, 
fd_to
;

33 
off_t
 
Àn
;

34 
°©
 
s°©
;

35 *
d©a_§c
, *
‹ig±r
, *
d©a_de°
;

37 i‡(
¨gc
 != 3) {

38 
	`Ârötf
(
°dîr
, "Ußge: %†sour˚-fûêde°-fûe\n", 
¨gv
[0]);

39 
	`exô
(1);

42 
fd_‰om
 = 
	`r_›í2
(
¨gv
[1], 
O_RDONLY
);

43 i‡(-1 =
fd_‰om
) {

44 
	`≥º‹
("open: src file");

45 
	`exô
(1);

48 
fd_to
 = 
	`r_›í3
(
¨gv
[2], 
O_RDWR
 | 
O_CREAT
,

49 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
);

50 i‡(-1 =
fd_to
) {

51 
	`≥º‹
("open: dest file");

52 
	`exô
(1);

56 i‡(
	`°©
(
¨gv
[1], &
s°©
) == -1) {

57 
	`≥º‹
("stat");

58 
	`exô
(1);

60 
Àn
 = 
s°©
.
°_size
;

61 i‡(
Àn
 == 0) {

62 
	`Ârötf
(
°dîr
,

64 
¨gv
[0],árgv[1]);

65 
	`exô
(1);

69 
	`l£ek
 (
fd_to
, 
Àn
-1, 
SEEK_SET
);

70 
	`wrôe
 (
fd_to
, "", 1);

76 
‹ig±r
 = 
d©a_§c
 = 
	`mm≠
(0, 
Àn
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd_‰om
, 0);

77 i‡(
d©a_§c
 == (*)-1) {

78 
	`≥º‹
("mmap:Åo src file");

79 
	`exô
(1);

81 i‡(
	`˛o£
(
fd_‰om
) == -1)

82 
	`≥º‹
 ("close failed");

83 
	`MSG
("Àn=%ld d©a_§¯%p\n", 
Àn
, 
d©a_§c
);

86 
d©a_de°
 = 
	`mm≠
(0, 
Àn
, 
PROT_READ
|
PROT_WRITE
, 
MAP_SHARED
, 
fd_to
, 0);

87 i‡(
d©a_de°
 == (*)-1) {

88 
	`≥º‹
("mmap:Åo dest file");

89 
	`exô
(1);

91 i‡(
	`˛o£
(
fd_to
) == -1)

92 
	`≥º‹
 ("close failed");

94 
	`mem˝y
 (
d©a_de°
, 
d©a_§c
, 
Àn
);

95 
	`∑u£
();

97 i‡(
	`munm≠
(
‹ig±r
, 
Àn
) == -1) {

98 
	`≥º‹
("munmap");

99 
	`exô
(1);

101 i‡(
	`˛o£
(
fd_‰om
) == -1)

102 
	`≥º‹
 ("close/3 failed");

104 
	`munm≠
(
d©a_de°
, 
Àn
);

105 i‡(
	`˛o£
(
fd_to
) == -1)

106 
	`≥º‹
 ("close/4 failed");

108 
	`exô
(0);

109 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/mmap/fileio_mmap/reg_fileio.c

11 
	~<°dio.h
>

12 
	~<°dlib.h
>

13 
	~<uni°d.h
>

14 
	~<sys/ty≥s.h
>

15 
	~<sys/°©.h
>

16 
	~<f˙é.h
>

17 
	~"ª°¨t_lib.h
"

25 
	$maö
(
¨gc
, **
¨gv
)

27 
fd_‰om
, 
fd_to
, 
n
;

29 i‡(
¨gc
 != 3) {

30 
	`Ârötf
(
°dîr
, "Ußge: %†sour˚-fûêde°-fûe\n", 
¨gv
[0]);

31 
	`exô
(1);

34 
fd_‰om
 = 
	`r_›í2
(
¨gv
[1], 
O_RDONLY
);

35 i‡(-1 =
fd_‰om
) {

36 
	`≥º‹
("open: from file");

37 
	`exô
(1);

40 
fd_to
 =

41 
	`r_›í3
(
¨gv
[2], 
O_WRONLY
 | 
O_CREAT
,

42 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
);

43 i‡(-1 =
fd_to
) {

44 
	`≥º‹
("open:Åo file");

45 
	`exô
(1);

48 
n
 = 
	`c›yfûe
(
fd_‰om
, 
fd_to
);

49 
	`¥ötf
("¿%d\n", 
n
);

51 
	`˛o£
(
fd_‰om
);

52 
	`˛o£
(
fd_to
);

53 
	`exô
(0);

54 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/mmap/fileio_mmap/restart_lib.h

13 #i‚de‡
__RESTART_LIB__


14 
	#__RESTART_LIB__


	)

16 
	~<î∫o.h
>

17 
	~<f˙é.h
>

18 
	~<limôs.h
>

19 
	~<°rög.h
>

20 
	~<sys/£À˘.h
>

21 
	~<sys/time.h
>

22 
	~<sys/waô.h
>

24 
	#BLKSIZE
 
PIPE_BUF


	)

25 
	#MILLION
 1000000L

	)

26 
	#D_MILLION
 1000000.0

	)

28 
ªadwrôe
(
‰omfd
, 
tofd
);

29 
waôfdtimed
(
fd
, 
timevÆ
 
íd
);

33 
	$gëtimeout
(
timevÆ
 
íd
, timevÆ *
timeouç
)

35 
	`gëtimeofday
(
timeouç
, 
NULL
);

36 
timeouç
->
tv_£c
 = 
íd
.tv_sec -Åimeoutp->tv_sec;

37 
timeouç
->
tv_u£c
 = 
íd
.tv_usec -Åimeoutp->tv_usec;

38 i‡(
timeouç
->
tv_u£c
 >
MILLION
) {

39 
timeouç
->
tv_£c
++;

40 
timeouç
->
tv_u£c
 -
MILLION
;

42 i‡(
timeouç
->
tv_u£c
 < 0) {

43 
timeouç
->
tv_£c
--;

44 
timeouç
->
tv_u£c
 +
MILLION
;

46 i‡((
timeouç
->
tv_£c
 < 0) ||

47 ((
timeouç
->
tv_£c
 =0Ë&& (timeouç->
tv_u£c
 == 0))) {

48 
î∫o
 = 
ETIME
;

52 
	}
}

56 
	$r_˛o£
(
fûdes
)

58 
ªtvÆ
;

59 
ªtvÆ
 = 
	`˛o£
(
fûdes
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

60  
ªtvÆ
;

61 
	}
}

63 
	$r_dup2
(
fûdes
, 
fûdes2
)

65 
ªtvÆ
;

66 
ªtvÆ
 = 
	`dup2
(
fûdes
, 
fûdes2
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

67  
ªtvÆ
;

68 
	}
}

70 
	$r_›í2
(c⁄° *
∑th
, 
oÊag
)

72 
ªtvÆ
;

73 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

74  
ªtvÆ
;

75 
	}
}

77 
	$r_›í3
(c⁄° *
∑th
, 
oÊag
, 
mode_t
 
mode
)

79 
ªtvÆ
;

80 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
, 
mode
),Ñetval == -1

81 && 
î∫o
 =
EINTR
) ;

82  
ªtvÆ
;

83 
	}
}

85 
ssize_t
 
	$r_ªad
(
fd
, *
buf
, 
size_t
 
size
)

87 
ssize_t
 
ªtvÆ
;

88 
ªtvÆ
 = 
	`ªad
(
fd
, 
buf
, 
size
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

89  
ªtvÆ
;

90 
	}
}

92 
pid_t
 
	$r_waô
(*
°©_loc
)

94 
pid_t
 
ªtvÆ
;

95 ((
ªtvÆ
 = 
	`waô
(
°©_loc
)Ë=-1Ë&& (
î∫o
 =
EINTR
)) ;

96  
ªtvÆ
;

97 
	}
}

99 
pid_t
 
	$r_waôpid
(
pid_t
 
pid
, *
°©_loc
, 
›ti⁄s
)

101 
pid_t
 
ªtvÆ
;

102 ((
ªtvÆ
 = 
	`waôpid
(
pid
, 
°©_loc
, 
›ti⁄s
)) == -1) &&

103 (
î∫o
 =
EINTR
)) ;

104  
ªtvÆ
;

105 
	}
}

107 
ssize_t
 
	$r_wrôe
(
fd
, *
buf
, 
size_t
 
size
)

109 *
buÂ
;

110 
size_t
 
byã°owrôe
;

111 
ssize_t
 
byãswrôãn
;

112 
size_t
 
tŸÆbyãs
;

114 
buÂ
 = 
buf
, 
byã°owrôe
 = 
size
, 
tŸÆbyãs
 = 0;

115 
byã°owrôe
 > 0;

116 
buÂ
 +
byãswrôãn
, 
byã°owrôe
 -= byteswritten) {

117 
byãswrôãn
 = 
	`wrôe
(
fd
, 
buÂ
, 
byã°owrôe
);

118 i‡((
byãswrôãn
Ë=-1 && (
î∫o
 !
EINTR
))

120 i‡(
byãswrôãn
 == -1)

121 
byãswrôãn
 = 0;

122 
tŸÆbyãs
 +
byãswrôãn
;

124  
tŸÆbyãs
;

125 
	}
}

129 
timevÆ
 
	$add2cuºíâime
(
£c⁄ds
)

131 
timevÆ
 
√wtime
;

133 
	`gëtimeofday
(&
√wtime
, 
NULL
);

134 
√wtime
.
tv_£c
 +()
£c⁄ds
;

135 
√wtime
.
tv_u£c
 +()((
£c⁄ds
 - ()£c⁄dsË* 
D_MILLION
 + 0.5);

136 i‡(
√wtime
.
tv_u£c
 >
MILLION
) {

137 
√wtime
.
tv_£c
++;

138 
√wtime
.
tv_u£c
 -
MILLION
;

140  
√wtime
;

141 
	}
}

143 
	$c›yfûe
(
‰omfd
, 
tofd
)

145 
byã§ód
;

146 
tŸÆbyãs
 = 0;

148 (
byã§ód
 = 
	`ªadwrôe
(
‰omfd
, 
tofd
)) > 0)

149 
tŸÆbyãs
 +
byã§ód
;

150  
tŸÆbyãs
;

151 
	}
}

153 
ssize_t
 
	$ªadblock
(
fd
, *
buf
, 
size_t
 
size
)

155 *
buÂ
;

156 
ssize_t
 
byã§ód
;

157 
size_t
 
byã°‹ód
;

158 
size_t
 
tŸÆbyãs
;

160 
buÂ
 = 
buf
, 
byã°‹ód
 = 
size
, 
tŸÆbyãs
 = 0;

161 
byã°‹ód
 > 0; 
buÂ
 +
byã§ód
, bytestoread -= bytesread) {

162 
byã§ód
 = 
	`ªad
(
fd
, 
buÂ
, 
byã°‹ód
);

163 i‡((
byã§ód
 =0Ë&& (
tŸÆbyãs
 == 0))

165 i‡(
byã§ód
 == 0) {

166 
î∫o
 = 
EINVAL
;

169 i‡((
byã§ód
Ë=-1 && (
î∫o
 !
EINTR
))

171 i‡(
byã§ód
 == -1)

172 
byã§ód
 = 0;

173 
tŸÆbyãs
 +
byã§ód
;

175  
tŸÆbyãs
;

176 
	}
}

178 
	$ªadlöe
(
fd
, *
buf
, 
nbyãs
)

180 
numªad
 = 0;

181 
ªtu∫vÆ
;

183 
numªad
 < 
nbyãs
 - 1) {

184 
ªtu∫vÆ
 = 
	`ªad
(
fd
, 
buf
 + 
numªad
, 1);

185 i‡((
ªtu∫vÆ
 =-1Ë&& (
î∫o
 =
EINTR
))

187 i‡((
ªtu∫vÆ
 =0Ë&& (
numªad
 == 0))

189 i‡(
ªtu∫vÆ
 == 0)

191 i‡(
ªtu∫vÆ
 == -1)

193 
numªad
++;

194 i‡(
buf
[
numªad
 - 1] == '\n') {

195 
buf
[
numªad
] = '\0';

196  
numªad
;

199 
î∫o
 = 
EINVAL
;

201 
	}
}

203 
ssize_t
 
	$ªadtimed
(
fd
, *
buf
, 
size_t
 
nbyã
, 
£c⁄ds
)

205 
timevÆ
 
timed⁄e
;

207 
timed⁄e
 = 
	`add2cuºíâime
(
£c⁄ds
);

208 i‡(
	`waôfdtimed
(
fd
, 
timed⁄e
) == -1)

209  (
ssize_t
) (-1);

210  
	`r_ªad
(
fd
, 
buf
, 
nbyã
);

211 
	}
}

213 
	$ªadwrôe
(
‰omfd
, 
tofd
)

215 
buf
[
BLKSIZE
];

216 
byã§ód
;

218 i‡((
byã§ód
 = 
	`r_ªad
(
‰omfd
, 
buf
, 
BLKSIZE
)) < 0)

220 i‡(
byã§ód
 == 0)

222 i‡(
	`r_wrôe
(
tofd
, 
buf
, 
byã§ód
) < 0)

224  
byã§ód
;

225 
	}
}

227 
	$ªadwrôeblock
(
‰omfd
, 
tofd
, *
buf
, 
size
)

229 
byã§ód
;

231 
byã§ód
 = 
	`ªadblock
(
‰omfd
, 
buf
, 
size
);

232 i‡(
byã§ód
 !
size
)

233  
byã§ód
;

234  
	`r_wrôe
(
tofd
, 
buf
, 
size
);

235 
	}
}

237 
	$waôfdtimed
(
fd
, 
timevÆ
 
íd
)

239 
fd_£t
 
ªad£t
;

240 
ªtvÆ
;

241 
timevÆ
 
timeout
;

243 i‡((
fd
 < 0Ë|| (fd >
FD_SETSIZE
)) {

244 
î∫o
 = 
EINVAL
;

247 
	`FD_ZERO
(&
ªad£t
);

248 
	`FD_SET
(
fd
, &
ªad£t
);

249 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

251 ((
ªtvÆ
 = 
	`£À˘
(
fd
 + 1, &
ªad£t
, 
NULL
, NULL, &
timeout
)) == -1)

252 && (
î∫o
 =
EINTR
)) {

253 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

255 
	`FD_ZERO
(&
ªad£t
);

256 
	`FD_SET
(
fd
, &
ªad£t
);

258 i‡(
ªtvÆ
 == 0) {

259 
î∫o
 = 
ETIME
;

262 i‡(
ªtvÆ
 == -1)

265 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/mmap/mmap_simple/mmap_simple.c

14 
	~<°dio.h
>

15 
	~<°dlib.h
>

16 
	~<uni°d.h
>

17 
	~<sys/mm™.h
>

18 
	~<sys/ty≥s.h
>

19 
	~<sys/°©.h
>

20 
	~<f˙é.h
>

21 
	~"ª°¨t_lib.h
"

22 
	~"../../../../c⁄víõ¡.h
"

30 
	$hex_dump
(*
d©a
, 
off£t
, 
size
, *
ˇ±i⁄
, 
vîbo£
)

32 
i
;

33 
j
;

34 
ãmp
[8];

35 
buf„r
[128];

36 *
ascii
;

38 
	`mem£t
(
buf„r
, 0, 128);

40 i‡(
vîbo£
 && 
ˇ±i⁄
)

41 
	`¥ötf
("---------> %†<--------- (%d byã†‰om %p)\n", 
ˇ±i⁄
,

42 
size
, 
d©a
);

45 
¥ötf


50 
ascii
 = 
buf„r
 + 58;

51 
	`mem£t
(
buf„r
, ' ', 58 + 16);

53 
	`•rötf
(
ãmp
, "+%06d", 
off£t
);

54 
buf„r
[58 + 16] = '\n';

55 
buf„r
[58 + 17] = '\0';

56 
buf„r
[0] = '+';

59 
buf„r
[1] = 
ãmp
[1];

60 
buf„r
[2] = 
ãmp
[2];

61 
buf„r
[3] = 
ãmp
[3];

62 
buf„r
[4] = 
ãmp
[4];

63 
buf„r
[5] = 
ãmp
[5];

64 
buf„r
[6] = 
ãmp
[6];

66 
i
 = 0, 
j
 = 0; i < 
size
; i++, j++) {

67 i‡(
j
 == 16) {

68 
	`¥ötf
("%s", 
buf„r
);

69 
	`mem£t
(
buf„r
, ' ', 58 + 16);

71 
	`•rötf
(
ãmp
, "+%06d", 
i
+
off£t
);

72 
	`mem˝y
(
buf„r
, 
ãmp
, 7);

74 
j
 = 0;

77 
	`•rötf
(
ãmp
, "%02x", 0xf‡& 
d©a
[
i
]);

78 
	`mem˝y
(
buf„r
 + 8 + (
j
 * 3), 
ãmp
, 2);

79 i‡((
d©a
[
i
] > 31) && (data[i] < 127))

80 
ascii
[
j
] = 
d©a
[
i
];

82 
ascii
[
j
] = '.';

85 i‡(
j
 != 0)

86 
	`¥ötf
("%s", 
buf„r
);

87 
	}
}

90 
	$maö
(
¨gc
, **
¨gv
)

92 
fd_‰om
;

93 
off_t
 
fsz
, 
Àn
, 
off
 = 0;

94 
°©
 
s°©
;

95 *
d©a_§c
, *
‹ig±r
;

97 i‡(
¨gc
 != 4) {

98 
	`Ârötf
(
°dîr
, "Usage: %s source-file start_offsetÜength\n",

99 
¨gv
[0]);

100 
	`exô
(1);

103 
fd_‰om
 = 
	`r_›í2
(
¨gv
[1], 
O_RDONLY
);

104 i‡(-1 =
fd_‰om
) {

105 
	`≥º‹
("open: src file");

106 
	`exô
(1);

109 i‡(
	`f°©
(
fd_‰om
, &
s°©
) == -1) {

110 
	`≥º‹
("fstat");

111 
	`exô
(1);

113 
fsz
 = 
s°©
.
°_size
;

114 i‡(0 =
fsz
) {

115 
	`Ârötf
(
°dîr
,

117 
¨gv
[0],árgv[1]);

118 
	`exô
(1);

121 
Àn
 = 
	`©ﬁ
(
¨gv
[3]);

122 i‡(
Àn
 <= 0) {

123 
	`Ârötf
(
°dîr
,

124 "%s: invÆidÜígth %ld,áb‹tög...\n", 
¨gv
[0], 
Àn
);

125 
	`exô
(1);

127 
off
 = 
	`©ﬁ
(
¨gv
[2]);

128 i‡((
off
 < 0Ë|| ((off+
Àn
Ë> 
fsz
)) {

129 
	`Ârötf
(
°dîr
,

130 "%s: invÆid off£à‹ off£t/Àngth combö©i⁄,áb‹tög...\n", 
¨gv
[0]);

131 
	`exô
(1);

142 
‹ig±r
 = 
d©a_§c
 = 
	`mm≠
(0, 
fsz
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd_‰om
, 0);

143 i‡(
d©a_§c
 =
MAP_FAILED
) {

144 
	`≥º‹
("mmap:Åo src file");

145 
	`exô
(1);

149 
	`hex_dump
(
d©a_§c
 + 
off
, off, 
Àn
, "Data", 0);

166 i‡(
	`msync
 (
‹ig±r
, 
Àn
, 
MS_SYNC
) < 0)

167 
	`≥º‹
("mysnc");

169 i‡(
	`munm≠
(
‹ig±r
, 
Àn
) == -1) {

170 
	`≥º‹
("munmap");

171 
	`exô
(1);

173 
	`˛o£
(
fd_‰om
);

174 
	`exô
(0);

175 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/mmap/mmap_simple/restart_lib.h

13 #i‚de‡
__RESTART_LIB__


14 
	#__RESTART_LIB__


	)

16 
	~<î∫o.h
>

17 
	~<f˙é.h
>

18 
	~<limôs.h
>

19 
	~<°rög.h
>

20 
	~<sys/£À˘.h
>

21 
	~<sys/time.h
>

22 
	~<sys/waô.h
>

24 
	#BLKSIZE
 
PIPE_BUF


	)

25 
	#MILLION
 1000000L

	)

26 
	#D_MILLION
 1000000.0

	)

28 
ªadwrôe
(
‰omfd
, 
tofd
);

29 
waôfdtimed
(
fd
, 
timevÆ
 
íd
);

33 
	$gëtimeout
(
timevÆ
 
íd
, timevÆ *
timeouç
)

35 
	`gëtimeofday
(
timeouç
, 
NULL
);

36 
timeouç
->
tv_£c
 = 
íd
.tv_sec -Åimeoutp->tv_sec;

37 
timeouç
->
tv_u£c
 = 
íd
.tv_usec -Åimeoutp->tv_usec;

38 i‡(
timeouç
->
tv_u£c
 >
MILLION
) {

39 
timeouç
->
tv_£c
++;

40 
timeouç
->
tv_u£c
 -
MILLION
;

42 i‡(
timeouç
->
tv_u£c
 < 0) {

43 
timeouç
->
tv_£c
--;

44 
timeouç
->
tv_u£c
 +
MILLION
;

46 i‡((
timeouç
->
tv_£c
 < 0) ||

47 ((
timeouç
->
tv_£c
 =0Ë&& (timeouç->
tv_u£c
 == 0))) {

48 
î∫o
 = 
ETIME
;

52 
	}
}

56 
	$r_˛o£
(
fûdes
)

58 
ªtvÆ
;

59 
ªtvÆ
 = 
	`˛o£
(
fûdes
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

60  
ªtvÆ
;

61 
	}
}

63 
	$r_dup2
(
fûdes
, 
fûdes2
)

65 
ªtvÆ
;

66 
ªtvÆ
 = 
	`dup2
(
fûdes
, 
fûdes2
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

67  
ªtvÆ
;

68 
	}
}

70 
	$r_›í2
(c⁄° *
∑th
, 
oÊag
)

72 
ªtvÆ
;

73 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

74  
ªtvÆ
;

75 
	}
}

77 
	$r_›í3
(c⁄° *
∑th
, 
oÊag
, 
mode_t
 
mode
)

79 
ªtvÆ
;

80 
ªtvÆ
 = 
	`›í
(
∑th
, 
oÊag
, 
mode
),Ñetval == -1

81 && 
î∫o
 =
EINTR
) ;

82  
ªtvÆ
;

83 
	}
}

85 
ssize_t
 
	$r_ªad
(
fd
, *
buf
, 
size_t
 
size
)

87 
ssize_t
 
ªtvÆ
;

88 
ªtvÆ
 = 
	`ªad
(
fd
, 
buf
, 
size
),ÑëvÆ =-1 && 
î∫o
 =
EINTR
) ;

89  
ªtvÆ
;

90 
	}
}

92 
pid_t
 
	$r_waô
(*
°©_loc
)

94 
pid_t
 
ªtvÆ
;

95 ((
ªtvÆ
 = 
	`waô
(
°©_loc
)Ë=-1Ë&& (
î∫o
 =
EINTR
)) ;

96  
ªtvÆ
;

97 
	}
}

99 
pid_t
 
	$r_waôpid
(
pid_t
 
pid
, *
°©_loc
, 
›ti⁄s
)

101 
pid_t
 
ªtvÆ
;

102 ((
ªtvÆ
 = 
	`waôpid
(
pid
, 
°©_loc
, 
›ti⁄s
)) == -1) &&

103 (
î∫o
 =
EINTR
)) ;

104  
ªtvÆ
;

105 
	}
}

107 
ssize_t
 
	$r_wrôe
(
fd
, *
buf
, 
size_t
 
size
)

109 *
buÂ
;

110 
size_t
 
byã°owrôe
;

111 
ssize_t
 
byãswrôãn
;

112 
size_t
 
tŸÆbyãs
;

114 
buÂ
 = 
buf
, 
byã°owrôe
 = 
size
, 
tŸÆbyãs
 = 0;

115 
byã°owrôe
 > 0;

116 
buÂ
 +
byãswrôãn
, 
byã°owrôe
 -= byteswritten) {

117 
byãswrôãn
 = 
	`wrôe
(
fd
, 
buÂ
, 
byã°owrôe
);

118 i‡((
byãswrôãn
Ë=-1 && (
î∫o
 !
EINTR
))

120 i‡(
byãswrôãn
 == -1)

121 
byãswrôãn
 = 0;

122 
tŸÆbyãs
 +
byãswrôãn
;

124  
tŸÆbyãs
;

125 
	}
}

129 
timevÆ
 
	$add2cuºíâime
(
£c⁄ds
)

131 
timevÆ
 
√wtime
;

133 
	`gëtimeofday
(&
√wtime
, 
NULL
);

134 
√wtime
.
tv_£c
 +()
£c⁄ds
;

135 
√wtime
.
tv_u£c
 +()((
£c⁄ds
 - ()£c⁄dsË* 
D_MILLION
 + 0.5);

136 i‡(
√wtime
.
tv_u£c
 >
MILLION
) {

137 
√wtime
.
tv_£c
++;

138 
√wtime
.
tv_u£c
 -
MILLION
;

140  
√wtime
;

141 
	}
}

143 
	$c›yfûe
(
‰omfd
, 
tofd
)

145 
byã§ód
;

146 
tŸÆbyãs
 = 0;

148 (
byã§ód
 = 
	`ªadwrôe
(
‰omfd
, 
tofd
)) > 0)

149 
tŸÆbyãs
 +
byã§ód
;

150  
tŸÆbyãs
;

151 
	}
}

153 
ssize_t
 
	$ªadblock
(
fd
, *
buf
, 
size_t
 
size
)

155 *
buÂ
;

156 
ssize_t
 
byã§ód
;

157 
size_t
 
byã°‹ód
;

158 
size_t
 
tŸÆbyãs
;

160 
buÂ
 = 
buf
, 
byã°‹ód
 = 
size
, 
tŸÆbyãs
 = 0;

161 
byã°‹ód
 > 0; 
buÂ
 +
byã§ód
, bytestoread -= bytesread) {

162 
byã§ód
 = 
	`ªad
(
fd
, 
buÂ
, 
byã°‹ód
);

163 i‡((
byã§ód
 =0Ë&& (
tŸÆbyãs
 == 0))

165 i‡(
byã§ód
 == 0) {

166 
î∫o
 = 
EINVAL
;

169 i‡((
byã§ód
Ë=-1 && (
î∫o
 !
EINTR
))

171 i‡(
byã§ód
 == -1)

172 
byã§ód
 = 0;

173 
tŸÆbyãs
 +
byã§ód
;

175  
tŸÆbyãs
;

176 
	}
}

178 
	$ªadlöe
(
fd
, *
buf
, 
nbyãs
)

180 
numªad
 = 0;

181 
ªtu∫vÆ
;

183 
numªad
 < 
nbyãs
 - 1) {

184 
ªtu∫vÆ
 = 
	`ªad
(
fd
, 
buf
 + 
numªad
, 1);

185 i‡((
ªtu∫vÆ
 =-1Ë&& (
î∫o
 =
EINTR
))

187 i‡((
ªtu∫vÆ
 =0Ë&& (
numªad
 == 0))

189 i‡(
ªtu∫vÆ
 == 0)

191 i‡(
ªtu∫vÆ
 == -1)

193 
numªad
++;

194 i‡(
buf
[
numªad
 - 1] == '\n') {

195 
buf
[
numªad
] = '\0';

196  
numªad
;

199 
î∫o
 = 
EINVAL
;

201 
	}
}

203 
ssize_t
 
	$ªadtimed
(
fd
, *
buf
, 
size_t
 
nbyã
, 
£c⁄ds
)

205 
timevÆ
 
timed⁄e
;

207 
timed⁄e
 = 
	`add2cuºíâime
(
£c⁄ds
);

208 i‡(
	`waôfdtimed
(
fd
, 
timed⁄e
) == -1)

209  (
ssize_t
) (-1);

210  
	`r_ªad
(
fd
, 
buf
, 
nbyã
);

211 
	}
}

213 
	$ªadwrôe
(
‰omfd
, 
tofd
)

215 
buf
[
BLKSIZE
];

216 
byã§ód
;

218 i‡((
byã§ód
 = 
	`r_ªad
(
‰omfd
, 
buf
, 
BLKSIZE
)) < 0)

220 i‡(
byã§ód
 == 0)

222 i‡(
	`r_wrôe
(
tofd
, 
buf
, 
byã§ód
) < 0)

224  
byã§ód
;

225 
	}
}

227 
	$ªadwrôeblock
(
‰omfd
, 
tofd
, *
buf
, 
size
)

229 
byã§ód
;

231 
byã§ód
 = 
	`ªadblock
(
‰omfd
, 
buf
, 
size
);

232 i‡(
byã§ód
 !
size
)

233  
byã§ód
;

234  
	`r_wrôe
(
tofd
, 
buf
, 
size
);

235 
	}
}

237 
	$waôfdtimed
(
fd
, 
timevÆ
 
íd
)

239 
fd_£t
 
ªad£t
;

240 
ªtvÆ
;

241 
timevÆ
 
timeout
;

243 i‡((
fd
 < 0Ë|| (fd >
FD_SETSIZE
)) {

244 
î∫o
 = 
EINVAL
;

247 
	`FD_ZERO
(&
ªad£t
);

248 
	`FD_SET
(
fd
, &
ªad£t
);

249 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

251 ((
ªtvÆ
 = 
	`£À˘
(
fd
 + 1, &
ªad£t
, 
NULL
, NULL, &
timeout
)) == -1)

252 && (
î∫o
 =
EINTR
)) {

253 i‡(
	`gëtimeout
(
íd
, &
timeout
) == -1)

255 
	`FD_ZERO
(&
ªad£t
);

256 
	`FD_SET
(
fd
, &
ªad£t
);

258 i‡(
ªtvÆ
 == 0) {

259 
î∫o
 = 
ETIME
;

262 i‡(
ªtvÆ
 == -1)

265 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/oom_try/oom-killer-try.c

16 
	~<°dio.h
>

17 
	~<°dlib.h
>

18 
	~<uni°d.h
>

19 
	~<°rög.h
>

21 
	#BLK
 (
	`gë∑gesize
()*2)

	)

23 
	gf‹˚_∑ge_Áu…
 = 0;

30 
	$£e_m≠s
()

33 
s
;

34 
cmd
[128];

36 
	`•rötf
(
cmd
, "cat /proc/%d/maps |awk '$6==\"[heap]\" {print $0}'",

37 
	`gëpid
());

38 
s
 = 
	`sy°em
(
cmd
);

39 i‡(
s
 == -1) {

40 
	`≥º‹
("system");

42 
	`fÊush
(
°dout
);

44 
	}
}

46 
	$maö
(
¨gc
, **
¨gv
)

48 *
p
;

49 
i
 = 0, 
°ïvÆ
 = 5000, 
vîbo£
 = 0;

51 i‡(
¨gc
 < 3) {

52 
	`Ârötf
(
°dîr
,

54 
¨gv
[0]);

55 
	`exô
(1);

58 
	`¥ötf
("%s: PID %d\n", 
¨gv
[0], 
	`gëpid
());

59 i‡(
	`©oi
(
¨gv
[2]) == 1)

60 
f‹˚_∑ge_Áu…
 = 1;

62 i‡(
¨gc
 >= 4) {

63 i‡(
	`©oi
(
¨gv
[3]) == 1)

64 
vîbo£
 = 1;

68 
p
 = (*)
	`mÆloc
(
BLK
);

69 i‡(
vîbo£
 && !(
i
 % 
°ïvÆ
))

70 
	`¥ötf
("%06d\taddrÖ = %p break = %p\n",

71 
i
, (*)
p
, (*)
	`sbrk
(0));

72 i‡(!
p
) {

73 
	`Ârötf
(
°dîr
, "%s:Üoop #%d: malloc failure.\n",

74 
¨gv
[0], 
i
);

85 i‡(
f‹˚_∑ge_Áu…
) {

86 
p
[4000] &= 0x14;

87 
p
[8000] |= 'a';

90 i‡(!(
i
 % 
°ïvÆ
)) {

91 
	`£e_m≠s
();

94 
i
++;

95 } 
p
 && (
i
 < 
	`©oi
(
¨gv
[1])));

97 
	`£e_m≠s
();

99 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/oom_try/rdpg_oom_try.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<°rög.h
>

23 
	#BLK
 8192

24 

	)

25 
	gf‹˚_∑ge_Áu…
 = 0;

32 
	$£e_m≠s
()

35 
s
;

36 
cmd
[128];

38 
	`•rötf
(
cmd
, "cat /proc/%d/maps |awk '$6==\"[heap]\" {print $0}'",

39 
	`gëpid
());

40 
s
 = 
	`sy°em
(
cmd
);

41 i‡(
s
 == -1) {

42 
	`≥º‹
("system");

44 
	`fÊush
(
°dout
);

46 
	}
}

48 
	$maö
(
¨gc
, **
¨gv
)

50 *
p
;

51 
i
 = 0, 
°ïvÆ
 = 5000, 
vîbo£
 = 0;

53 i‡(
¨gc
 < 3) {

54 
	`Ârötf
(
°dîr
,

56 
¨gv
[0]);

57 
	`exô
(1);

60 
	`¥ötf
("%s: PID %d\n", 
¨gv
[0], 
	`gëpid
());

61 i‡(
	`©oi
(
¨gv
[2]) == 1)

62 
f‹˚_∑ge_Áu…
 = 1;

64 i‡(
¨gc
 >= 4) {

65 i‡(
	`©oi
(
¨gv
[3]) == 1)

66 
vîbo£
 = 1;

70 
p
 = (*)
	`mÆloc
(
BLK
);

71 i‡(
vîbo£
)

72 
	`¥ötf
("%06d\èdd∏∞%∞ bªak = %p\n", ++
i
,

73 (*)
p
, (*)
	`sbrk
(0));

74 i‡(!
p
) {

75 
	`Ârötf
(
°dîr
, "%s:Üoop #%d: malloc failure.\n",

76 
¨gv
[0], 
i
);

87 i‡(
f‹˚_∑ge_Áu…
) {

89 
p
[4000] &= 0x14;

90 
p
[8000] |= 'a';

92 { 
x
, 
y
;

93 
x
 = 
p
[4000];

94 
y
 = 
p
[8000];

99 i‡(!(
i
 % 
°ïvÆ
)) {

100 
	`¥ötf
("%d...\n", 
i
);

104 
i
++;

105 } 
p
 && (
i
 < 
	`©oi
(
¨gv
[1])));

109 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/segv_pgfault.c

15 
	~<°dio.h
>

16 
	~<°dlib.h
>

17 
	~<uni°d.h
>

18 
	~<sys/ty≥s.h
>

19 
	~<sig«l.h
>

20 
	~<°rög.h
>

21 
	~<˘y≥.h
>

24 
	tu32
;

25 
	tu64
;

28 #i‡
__x86_64__


29 
	#ADDR_TYPE
 
u64


	)

30 
	#ADDR_FMT
 "%016lx"

	)

31 
u64
 
	grubbish_uaddr
 = 0x100000L;

32 
u64
 
	grubbish_kaddr
 = 0xffff0a8700100000L;

34 
	#ADDR_TYPE
 
u32


	)

35 
	#ADDR_FMT
 "%08lx"

	)

36 
u32
 
	grubbish_uaddr
 = 0x100000L;

37 
u32
 
	grubbish_kaddr
 = 0xd0100000L;

42 
	$myÁu…
(
signum
, 
sigöfo_t
 * 
sigöfo
, *
ª°
)

44 
c
 = 0;

46 
	`¥ötf
("*** %s: [%d]Ñeceived signal %d.Érrno=%d\n"

48 
__func__
, ++
c
, 
signum
, 
sigöfo
->
si_î∫o
, sigöfo->
si_code
);

50 
sigöfo
->
si_code
) {

51 
SI_USER
:

52 
	`¥ötf
("user\n");

54 
SI_KERNEL
:

55 
	`¥ötf
("kernel\n");

57 
SI_QUEUE
:

58 
	`¥ötf
("queue\n");

60 
SI_TIMER
:

61 
	`¥ötf
("timer\n");

63 
SI_MESGQ
:

64 
	`¥ötf
("mesgq\n");

66 
SI_ASYNCIO
:

67 
	`¥ötf
("async io\n");

69 
SI_SIGIO
:

70 
	`¥ötf
("sigio\n");

72 
SI_TKILL
:

73 
	`¥ötf
("t[g]kill\n");

76 
SEGV_MAPERR
:

77 
	`¥ötf
("SEGV_MAPERR:áddressÇot mappedÅo object\n");

79 
SEGV_ACCERR
:

80 
	`¥ötf
("SEGV_ACCERR: invalidÖermissions for mapped object\n");

83 
	`¥ötf
("-none-\n");

85 
	`¥ötf
(" Fau…ögáddr=0x" 
ADDR_FMT
 "\n", (
ADDR_TYPE
Ë
sigöfo
->
si_addr
);

88 
	`exô
 (1);

90 
	`ab‹t
();

92 
	}
}

94 
	$ußge
(*
nm
)

96 
	`Ârötf
(
°dîr
, "Usage: %s u|kÑ|w\n"

99 "Ñ =>Ñódáâem±\n" " w => wrôê©ãm±\n", 
nm
);

100 
	}
}

103 
	$maö
(
¨gc
, **
¨gv
)

105 
siga˘i⁄
 
a˘
;

107 i‡(
¨gc
 != 3) {

108 
	`ußge
(
¨gv
[0]);

109 
	`exô
(1);

112 
a˘
.
ß_siga˘i⁄
 = 
myÁu…
;

113 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

114 
	`sigem±y£t
(&
a˘
.
ß_mask
);

115 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

116 
	`≥º‹
("sigaction");

117 
	`exô
(1);

120 i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'r')) {

121 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë
rubbish_uaddr
;

122 
¥ötf


123 ("Aâem±ögÅÿªad c⁄ã¡†o‡¨bôøry u£rmodêv®u±∏0x" 
ADDR_FMT
 ":\n",

124 (
ADDR_TYPE
Ë
u±r
);

125 
	`¥ötf
("*u±∏0x" 
ADDR_FMT
 "\n", *
u±r
);

126 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'w')) {

127 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë& 
maö
;

128 
¥ötf


129 ("Aâem±ögÅÿwrôêötÿ¨bôøry u£rmodêv®u±∏(&maöá˘uÆlyË0x" 
ADDR_FMT
 ":\n",

130 (
ADDR_TYPE
Ë
u±r
);

131 *
u±r
 = 40;

132 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'r')) {

133 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
rubbish_kaddr
;

134 
¥ötf


135 ("Aâem±ögÅÿªad c⁄ã¡†o‡¨bôøry kî√»v®k±∏0x" 
ADDR_FMT
 ":\n",

136 (
ADDR_TYPE
Ë
k±r
);

137 
	`¥ötf
("*k±∏0x" 
ADDR_FMT
 "\n", *
k±r
);

138 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'w')) {

139 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
rubbish_kaddr
;

140 
¥ötf


141 ("Aâem±ögÅÿwrôêötÿ¨bôøry kî√»v®k±∏0x" 
ADDR_FMT
 ":\n",

142 (
ADDR_TYPE
Ë
k±r
);

143 *
k±r
 = 0x62;

145 
	`ußge
(
¨gv
[0]);

146 
	`exô
(0);

147 
	}
}

	@Training/L2_kernel_trg/mm/vm_usermode/vm_user.c

7 
	~<°dio.h
>

8 
	~<uni°d.h
>

9 
	~<°dlib.h
>

11 
	tu32
;

12 
	tu64
;

14 
	gg
=5, 
	gu
;

16 
	$maö
(
¨gc
, **
¨gv
)

18 
loˇl
;

19 *
hóµå
 = 
	`mÆloc
(100);

23 
	`¥ötf
("w‹dsizê: %d\n", 
__WORDSIZE
);

25 i‡(
__WORDSIZE
 == 32) {

26 
	`¥ötf
("&main = 0x%08x &g = 0x%08x &u = 0x%08x &heapptr = 0x%08x &loc = 0x%08x\n",

27 (
u32
)
maö
, (u32)&
g
, (u32)&
u
, (u32)
hóµå
, (u32)&
loˇl
);

28 } i‡(
__WORDSIZE
 == 64) {

29 
	`¥ötf
("&main = 0x%016lx &g = 0x%016lx &u = 0x%016lx &heapptr = 0x%016lx &loc = 0x%016lx\n",

30 (
u64
)
maö
, (u64)&
g
, (u64)&
u
, (u64)
hóµå
, (u64)&
loˇl
);

33 
	`‰ì
(
hóµå
);

35 
	}
}

	@Training/L2_kernel_trg/mm/xtras/malloc_brk_test.c

31 
	~<°dio.h
>

32 
	~<°dlib.h
>

33 
	~<uni°d.h
>

34 
	~<sys/ty≥s.h
>

35 
	~<sys/waô.h
>

36 
	~<mÆloc.h
>

39 #unde‡
USE_CALLOC


41 
	#TRIES
 5

	)

42 *
	ghóp_±r
[
TRIES
];

43 *
	göô_brk
;

45 
	tu32
;

47 
	$Ælo˘e°
(
ödex
, 
size_t
 
num
)

49 *
p
;

51 #i‚de‡
USE_CALLOC


52 
p
 = 
	`mÆloc
(
num
);

54 
p
 = 
	`ˇŒoc
(
num
, ());

56 i‡(!
p
) {

57 
	`¥ötf
("out of memory!\n");

58 
	`exô
(1);

61 
hóp_±r
[
ödex
] = 
p
;

62 #i‚de‡
USE_CALLOC


63 
	`¥ötf
("\n%d: mÆloc", 
ödex
);

65 
	`¥ötf
("\n%d: cÆloc", 
ödex
);

67 
	`¥ötf
("(%6uËsuc˚ssful. Hó∞poöãr: %8p\n", 
num
, 
p
);

68 
	`¥ötf
("Cuºíàbªak: %8∞[dñè: %d]\n", 
	`sbrk
(0),

69 (
	`sbrk
(0Ë- 
öô_brk
));

71 
	`mÆloc_°©s
();

72 
	}
}

74 
	$maö
(
¨gc
, **
¨gv
)

76 
i
;

77 vﬁ©ûê*
q
;

79 
öô_brk
 = 
	`sbrk
(0);

80 
	`¥ötf
("Cuºíàbªak: %8p\n", 
öô_brk
);

81 
	`Ælo˘e°
(0, 8);

85 
q
 = 
hóp_±r
[0];

86 *(
q
 + 3000) = 'a';

90 
¥ötf


92 ()
q
, ()(q + 3000),

93 ()*(
q
 + 3000));

115 *(
q
 + 3000 + (
	`sbrk
(0Ë- 
öô_brk
)) = 'b';

122 
	`Ælo˘e°
(1, (
	`gë∑gesize
() - 8 - 5));

123 
	`Ælo˘e°
(2, 3);

125 
	`Ælo˘e°
(3, (
	`sbrk
(0Ë- 
öô_brk
 + 1000));

131 
	`Ælo˘e°
(4, 200000);

133 
i
 = 0; i < 
TRIES
; i++)

134 
	`‰ì
(
hóp_±r
[
i
]);

135 
	`exô
(0);

136 
	}
}

	@Training/L2_kernel_trg/mm/xtras/segv_pgfault.c

13 
	~<°dio.h
>

14 
	~<°dlib.h
>

15 
	~<uni°d.h
>

16 
	~<sys/ty≥s.h
>

17 
	~<sig«l.h
>

18 
	~<°rög.h
>

19 
	~<˘y≥.h
>

22 
	tu32
;

23 
	tu64
;

26 #i‡
__x86_64__


27 
	#ADDR_TYPE
 
u64


	)

28 
	#ADDR_FMT
 "%016lx"

	)

29 
u64
 
	grubbish_uaddr
 = 0x100000L;

30 
u64
 
	grubbish_kaddr
 = 0xffff0a8700100000L;

32 
	#ADDR_TYPE
 
u32


	)

33 
	#ADDR_FMT
 "%08lx"

	)

34 
u32
 
	grubbish_uaddr
 = 0x100000L;

35 
u32
 
	grubbish_kaddr
 = 0xd0100000L;

40 
	$myÁu…
(
signum
, 
sigöfo_t
 * 
sigöfo
, *
ª°
)

42 
c
 = 0;

44 
	`¥ötf
("*** %s: [%d]Ñeceived signal %d.Érrno=%d\n"

46 
__func__
, ++
c
, 
signum
, 
sigöfo
->
si_î∫o
, sigöfo->
si_code
);

48 
sigöfo
->
si_code
) {

49 
SI_USER
:

50 
	`¥ötf
("user\n");

52 
SI_KERNEL
:

53 
	`¥ötf
("kernel\n");

55 
SI_QUEUE
:

56 
	`¥ötf
("queue\n");

58 
SI_TIMER
:

59 
	`¥ötf
("timer\n");

61 
SI_MESGQ
:

62 
	`¥ötf
("mesgq\n");

64 
SI_ASYNCIO
:

65 
	`¥ötf
("async io\n");

67 
SI_SIGIO
:

68 
	`¥ötf
("sigio\n");

70 
SI_TKILL
:

71 
	`¥ötf
("t[g]kill\n");

74 
SEGV_MAPERR
:

75 
	`¥ötf
("SEGV_MAPERR:áddressÇot mappedÅo object\n");

77 
SEGV_ACCERR
:

78 
	`¥ötf
("SEGV_ACCERR: invalidÖermissions for mapped object\n");

81 
	`¥ötf
("-none-\n");

83 
	`¥ötf
(" Fau…ögáddr=0x" 
ADDR_FMT
 "\n", (
ADDR_TYPE
Ë
sigöfo
->
si_addr
);

86 
	`exô
 (1);

88 
	`ab‹t
();

90 
	}
}

92 
	$ußge
(*
nm
)

94 
	`Ârötf
(
°dîr
, "Usage: %s u|kÑ|w\n"

97 "Ñ =>Ñódáâem±\n" " w => wrôê©ãm±\n", 
nm
);

98 
	}
}

101 
	$maö
(
¨gc
, **
¨gv
)

103 
siga˘i⁄
 
a˘
;

105 i‡(
¨gc
 != 3) {

106 
	`ußge
(
¨gv
[0]);

107 
	`exô
(1);

110 
a˘
.
ß_siga˘i⁄
 = 
myÁu…
;

111 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

112 
	`sigem±y£t
(&
a˘
.
ß_mask
);

113 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

114 
	`≥º‹
("sigaction");

115 
	`exô
(1);

118 i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'r')) {

119 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë
rubbish_uaddr
;

120 
¥ötf


121 ("Aâem±ögÅÿªad c⁄ã¡†o‡¨bôøry u£rmodêv®u±∏0x" 
ADDR_FMT
 ":\n",

122 (
ADDR_TYPE
Ë
u±r
);

123 
	`¥ötf
("*u±∏0x" 
ADDR_FMT
 "\n", *
u±r
);

124 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'u') &&Åolower(argv[2][0] == 'w')) {

125 
ADDR_TYPE
 *
u±r
 = (ADDR_TYPE *Ë& 
maö
;

126 
¥ötf


127 ("Aâem±ögÅÿwrôêötÿ¨bôøry u£rmodêv®u±∏(&maöá˘uÆlyË0x" 
ADDR_FMT
 ":\n",

128 (
ADDR_TYPE
Ë
u±r
);

129 *
u±r
 = 40;

130 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'r')) {

131 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
rubbish_kaddr
;

132 
¥ötf


133 ("Aâem±ögÅÿªad c⁄ã¡†o‡¨bôøry kî√»v®k±∏0x" 
ADDR_FMT
 ":\n",

134 (
ADDR_TYPE
Ë
k±r
);

135 
	`¥ötf
("*k±∏0x" 
ADDR_FMT
 "\n", *
k±r
);

136 } i‡((
	`tﬁowî
(
¨gv
[1][0]) == 'k') &&Åolower(argv[2][0] == 'w')) {

137 
ADDR_TYPE
 *
k±r
 = (ADDR_TYPE *Ë
rubbish_kaddr
;

138 
¥ötf


139 ("Aâem±ögÅÿwrôêötÿ¨bôøry kî√»v®k±∏0x" 
ADDR_FMT
 ":\n",

140 (
ADDR_TYPE
Ë
k±r
);

141 *
k±r
 = 0x62;

143 
	`ußge
(
¨gv
[0]);

144 
	`exô
(0);

145 
	}
}

	@Training/L2_kernel_trg/mm/xtras/trick.c

12 
	~<°dio.h
>

13 
	~<°dlib.h
>

15 
	$maö
(
¨gc
, **
¨gv
)

17 *
±r
, 
foo
;

18 i‡(
¨gc
 ==1) {

19 
	`Ârötf
(
°dîr
,"Ußge: %†kî√l|u£r-va\n", 
¨gv
[0]);

20 
	`exô
(1);

22 
±r
 = (*)
	`°πoul
(
¨gv
[1], 
NULL
, 16);

23 
foo
 = *
±r
;

24 
	}
}

	@Training/L2_kernel_trg/mm/xtras/vm_vas/vm_user.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	~<°dlib.h
>

5 
	tu32
;

6 
	tu64
;

8 
	gg
=5, 
	gu
;

10 
	$maö
(
¨gc
, **
¨gv
)

12 
loˇl
;

13 *
hóµå
 = 
	`mÆloc
(100);

19 i‡(
__WORDSIZE
 == 32) {

20 
	`¥ötf
("32-bit: &main = 0x%08x &g = 0x%08x &u = 0x%08x &heapptr = 0x%08x &loc = 0x%08x\n",

21 (
u32
)
maö
, (u32)&
g
, (u32)&
u
, (u32)
hóµå
, (u32)&
loˇl
);

22 } i‡(
__WORDSIZE
 == 64) {

23 
	`¥ötf
("64-bit: &main = 0x%016lx &g = 0x%016lx &u = %016lx &heapptr = 0x%016lx &loc = 0x%016lx\n",

24 (
u64
)
maö
, (u64)&
g
, (u64)&
u
, (u64)
hóµå
, (u64)&
loˇl
);

27 
	`‰ì
(
hóµå
);

29 
	}
}

	@Training/L2_kernel_trg/sched/sched_pthrd_app/libpk.h

15 
	~<°dio.h
>

16 
	~<uni°d.h
>

17 
	~<°dlib.h
>

18 
	~<asm/∑øm.h
>

20 
ölöe
 
	$bìp
(
wh©
)

22 
buf
[2];

23 
buf
[0] = ()(
wh©
);

24 
buf
[1] = '\0';

25 
	`wrôe
(
STDOUT_FILENO
, 
buf
, 1);

26 
	}
}

32 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

34 
c
=0;\

35 
f‹_ödex
,
ö√r_ödex
; \

36 
x
; \

37 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

38 
	`bìp
((
vÆ
)); \

39 
c
++;\

40 
ö√r_ödex
=0;ö√r_ödex<
HZ
*100000;inner_index++) \

41 
x
=(
ö√r_ödex
%2)*((22/7)%3); \

44 }

	)

47 
ölöe
 
	$bìp
(
how
, *
wh©
)

49 i‡(
how
)

50 
	`wrôe
(
STDOUT_FILENO
, "\007", 1);

52 
	`wrôe
(
STDOUT_FILENO
, 
wh©
, 1);

53 
	}
}

55 
	#DELAY_STEP
 20240/
HZ


	)

56 
	#DELAY_LOOP
(
how
,
vÆ
) \

58 
i
,
k
; \

59 
x
; \

60 
i
=0;i<(
DELAY_STEP
);i++) { \

61 
	`bìp
((
how
), (
vÆ
)); \

62 
k
=0;k<
HZ
*100000;k++) \

63 
x
=(
k
%2)*((22/7)%3); \

65 }

	)

	@Training/L2_kernel_trg/sched/sched_pthrd_app/sched_pthrd.c

6 
	~<°dio.h
>

7 
	~<uni°d.h
>

8 
	~<±hªad.h
>

9 
	~<°dlib.h
>

10 
	~"libpk.h
"

12 
	#DEBUG
 1

13 #ifde‡
DEBUG


	)

14 
	#MSG
(
°rög
, 
¨gs
...Ë
	`Ârötf
(
°dîr
, "%s:%†: " såög, 
__FILE__
, 
__FUNCTION__
, ##¨gs)

	)

16 
	#MSG
(
°rög
, 
¨gs
...)

	)

19 *
	$thrd_p2
(*
msg
)

21 
sched_∑øm
 
p
;

28 
	`¥ötf
(" RT ThreadÖ2 (LWP %d) here in functionÅhrd_p2\n\
 schedÖolicyÅo SCHED_FIFOánd RTÖriorityÅo %ld in 2 seconds..\n",

30 
	`gëpid
(), ()
msg
);

31 
	`¶ìp
(2);

36 
p
.
sched_¥i‹ôy
 = ()
msg
;

37 i‡(
	`±hªad_£tsched∑øm
(
	`±hªad_£lf
(), 
SCHED_FIFO
, &
p
))

38 
	`≥º‹
("pthread_setschedparam");

40 
	`puts
("Ö2: working");

41 
	`DELAY_LOOP
('2', 350);

43 
	`puts
("Ö2:Éxiting..");

44 
	`±hªad_exô
(
NULL
);

45 
	}
}

47 *
	$thrd_p3
(*
msg
)

49 
sched_∑øm
 
p
;

55 
¥i
 = ()
msg
;

57 
¥i
 += 10;

58 
	`¥ötf
(" RT ThreadÖ3 (LWP %d) here in functionÅhrd_p3\n"

60 
	`gëpid
(), 
¥i
);

65 
p
.
sched_¥i‹ôy
 = 
¥i
;

66 i‡(
	`±hªad_£tsched∑øm
(
	`±hªad_£lf
(), 
SCHED_FIFO
, &
p
))

67 
	`≥º‹
("pthread_setschedparam");

68 
	`¶ìp
(4);

70 
	`puts
("Ö3: working");

71 
	`DELAY_LOOP
('3', 210);

73 
	`puts
("Ö3:Éxiting..");

74 
	`±hªad_exô
(
NULL
);

75 
	}
}

77 
	$maö
(
¨gc
, **
¨gv
)

79 
±hªad_t
 
p2
, 
p3
;

80 
r
, 
mö
, 
max
;

81 
π_¥i
=1;

83 i‡(
¨gc
 == 1)

84 
	`Ârötf
(
°dîr
, "Usage: %sÑealtime-priority\n",

85 
¨gv
[0]), 
	`exô
(1);

86 
mö
 = 
	`sched_gë_¥i‹ôy_mö
(
SCHED_FIFO
);

87 i‡(
mö
 == -1) {

88 
	`≥º‹
("sched_get_priority_min failure");

89 
	`exô
(1);

91 
max
 = 
	`sched_gë_¥i‹ôy_max
(
SCHED_FIFO
);

92 i‡(
max
 == -1) {

93 
	`≥º‹
("sched_get_priority_max failure");

94 
	`exô
(1);

96 
	`MSG
("SCHED_FIFOÖri‹ôyÑ™gêi†%dÅÿ%d\n", 
mö
, 
max
);

98 
π_¥i
 = 
	`©oi
(
¨gv
[1]);

99 i‡((
π_¥i
 < 
mö
Ë|| (π_¥ò> (
max
 - 10))) {

100 
	`Ârötf
(
°dîr
,

102 
¨gv
[0], 
π_¥i
, 
mö
, (
max
 - 10));

103 
	`exô
(1);

106 
	`¥ötf
("\nNote:Åo createÅrue RTÅhreads, youÇeedÅoÑunÅhis \
ás superuser\n");

108 
	`¥ötf
("mainÅhread (%d):Çow creatingÑealtimeÖthreadÖ2..\n",

109 
	`gëpid
());

110 
r
 = 
	`±hªad_¸óã
(&
p2
,

111 
NULL
,

112 
thrd_p2
,

113 (*)
π_¥i
);

114 i‡(
r
)

115 
	`≥º‹
("±hªad cª©i⁄"), 
	`exô
(1);

117 
	`¥ötf
("mainÅhread (%d):Çow creatingÑealtimeÖthreadÖ3..\n",

118 
	`gëpid
());

119 
r
 = 
	`±hªad_¸óã
(&
p3
,

120 
NULL
,

121 
thrd_p3
,

122 (*)
π_¥i
);

123 i‡(
r
)

124 
	`≥º‹
("±hªad cª©i⁄"), 
	`exô
(1);

126 
	`DELAY_LOOP
('m', 400);

127 
	`±hªad_exô
(
NULL
);

128 
	}
}

	@Training/L2_kernel_trg/show_monolithic/show_monolithic.c

1 
	~<löux/öô.h
>

2 
	~<löux/moduÀ.h
>

3 
	~<löux/sched.h
>

5 
MODULE_LICENSE
("Dual MIT/GPL");

7 
__öô
 
	$hñlo_öô
()

9 
	`¥_Æît
("init: Process context :: %s PID %d\n",

10 
cuºít
->
comm
, cuºít->
pid
);

12 
	`dump_°ack
();

15 
	}
}

17 
__exô
 
	$hñlo_exô
()

19 
	`¥_Æît
("exit: Process context :: %s PID %d\n",

20 
cuºít
->
comm
, cuºít->
pid
);

22 
	`dump_°ack
();

24 
	}
}

26 
moduÀ_öô
(
hñlo_öô
);

27 
moduÀ_exô
(
hñlo_exô
);

	@Training/L2_kernel_trg/taskdtl/taskdtl_display.c

13 
	~<löux/sched.h
>

14 
	~<löux/vmÆloc.h
>

15 
	~<löux/mm_ty≥s.h
>

17 
	~<löux/vîsi⁄.h
>

18 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 10, 0)

19 
	~<löux/sched/sig«l.h
>

22 
	~<löux/mm.h
>

23 
	~<löux/©omic.h
>

24 
	~<löux/•ölock.h
>

26 
	$di•_èsk_dëaûs
(
èsk_°ru˘
 *
p
)

28 *
pﬁ
=
NULL
;

29 
thªad_öfo
 *
ti
 = 
	`èsk_thªad_öfo
(
p
);

31 i‡(!
	`pid_Æive
(
p
)) {

32 
	`¥_öfo
("%s():ÅaskÇŸálive?áb‹tög...\n", 
__func__
);

33  -
EINVAL
;

36 
	`èsk_lock
(
p
);

37 
	`¥_öfo
("\n<--------------- %16s : %7d ------------------>\n",

38 
p
->
comm
,Ö->
pid
);

41 
	`¥_öfo
("Task struct @ 0x%lx ::\n"

45 
p
,Ö->
comm
,Ö->
tgid
,Ö->
pid
,

46 " ", 
	`__kuid_vÆ
(
p
->
¸ed
->
uid
), __kuid_vÆ’->¸ed->
euid
),

47 " ", 
	`__kuid_vÆ
(
p
->
logöuid
));

50 #ifde‡
CONFIG_ARM64


51 
u64
 
•_ñ0
;

52 
	`asm
 ("mr†%0, sp_ñ0" : "Ù" (
•_ñ0
));

53 
	`¥_öfo
("árm64: sp_ñ0 hﬁd†èskÖå (vÆuêi†0x%lx)\n", 
•_ñ0
);

58 
	`¥_öfo
("Task sèã (%dË: ", 
p
->
°©e
);

59 
p
->
°©e
) {

60 
TASK_RUNNING
 : 
	`¥_öfo
(" R:Ñeady-to-run (onÑq) ORÑunning (on cpu)\n");

62 
TASK_INTERRUPTIBLE
 : 
	`¥_öfo
(" S: interruptible sleep\n");

64 
TASK_UNINTERRUPTIBLE
 : 
	`¥_öfo
(" D: uninterruptible sleep (!)\n");

66 
__TASK_STOPPED
 : 
	`¥_öfo
(" T: stopped\n");

68 
__TASK_TRACED
 : 
	`¥_öfo
("Å:Åraced\n");

70 
TASK_PARKED
 : 
	`¥_öfo
(" .: PARKED\n");

72 
TASK_DEAD
 : 
	`¥_öfo
(" X: DEAD\n");

74 
TASK_WAKEKILL
 : 
	`¥_öfo
(" .: WAKEKILL\n");

76 
TASK_WAKING
 : 
	`¥_öfo
(" .: WAKING\n");

78 
TASK_NOLOAD
 : 
	`¥_öfo
(" .: NOLOAD\n");

80 
TASK_NEW
 : 
	`¥_öfo
(" .: NEW\n");

82  : 
	`¥_öfo
(" ? <unknown>\n");

85 i‡(!
ti
)

86 
	`¥_w¨n
("ti invalid!\n");

88 
	`¥_öfo
(

90 #ifde‡
CONFIG_THREAD_INFO_IN_TASK


95 , 
ti
);

98 
	`¥_öfo
(

104 #ifde‡
CONFIG_VMAP_STACK


109 #ifde‡
CONFIG_GCC_PLUGIN_STACKLEAK


114 #ifde‡
CONFIG_THREAD_INFO_IN_TASK


123 
	`gë_ƒ_thªads
(
p
),

124 
p
->
°ack
,

125 #ifde‡
CONFIG_GCC_PLUGIN_STACKLEAK


126 
p
->
lowe°_°ack
,

128 
p
->
Êags
,

129 #ifde‡
CONFIG_THREAD_INFO_IN_TASK


130 
p
->
˝u
,

132 
p
->
⁄_rq
 ? "yes" : "no",

133 
p
->
¥io
,

134 
p
->
°©ic_¥io
,

135 
p
->
n‹mÆ_¥io
,

136 
p
->
π_¥i‹ôy
,

137 
p
->
£
.
vru¡ime


141 
p
->
pﬁicy
) {

142 
SCHED_NORMAL
: 
pﬁ
 = "Normal/Other";

144 
SCHED_FIFO
: 
pﬁ
 = "FIFO";

146 
SCHED_RR
: 
pﬁ
 = "RR";

148 
SCHED_BATCH
: 
pﬁ
 = "BATCH";

150 
SCHED_IDLE
: 
pﬁ
 = "IDLE";

152 
SCHED_DEADLINE
: 
pﬁ
 = "DEADLINE";

154 : 
pﬁ
 = "<Unknown>";

156 
	`¥_öfo
("Öﬁicy : %s", 
pﬁ
);

158 
	`¥_öfo
(

160 #ifde‡
CONFIG_SCHED_INFO


165 
p
->
ƒ_˝us_Ælowed


166 #ifde‡
CONFIG_SCHED_INFO


168 
p
->
sched_öfo
.
pcou¡
,

169 
p
->
sched_öfo
.
run_dñay


174 i‡(
p
->
mm
) {

175 
	`¥_öfo
("mm info ::\n"

176 "ÇŸá kî√»thªad; mm_°ru˘ : 0x%lx\n", 
p
->
mm
);

177 
	`¥_öfo
(

180 #ifde‡
CONFIG_MMU


195 
p
->
mm
->
pgd
,

196 
	`©omic_ªad
(&
p
->
mm
->
mm_u£rs
),

197 
	`©omic_ªad
(&
p
->
mm
->
mm_cou¡
),

198 #ifde‡
CONFIG_MMU


199 
	`©omic64_ªad
(&
p
->
mm
->
pgèbÀs_byãs
),

201 
p
->
mm
->
m≠_cou¡
,

202 
p
->
mm
->
highe°_vm_íd
,

203 
p
->
mm
->
hiw©î_rss
,

204 
p
->
mm
->
hiw©î_vm
,

205 
p
->
mm
->
tŸÆ_vm
,

206 
p
->
mm
->
locked_vm
,

207 
p
->
mm
->
pö√d_vm
,

208 
p
->
mm
->
d©a_vm
,

209 
p
->
mm
->
exec_vm
,

210 
p
->
mm
->
°ack_vm
,

211 
p
->
mm
->
def_Êags


216 
	`¥_öfo
(

226 
p
->
mm
->
ív_°¨t
,Ö->mm->
ív_íd
,

227 
p
->
mm
->
ív_íd
 -Ö->mm->
ív_°¨t
,

228 
p
->
mm
->
¨g_°¨t
,Ö->mm->
¨g_íd
,

229 
p
->
mm
->
¨g_íd
 -Ö->mm->
¨g_°¨t
,

232 
p
->
mm
->
°¨t_°ack
,

233 
p
->
mm
->
°¨t_brk
,Ö->mm->
brk
,

234 (
p
->
mm
->
brk
 -Ö->mm->
°¨t_brk
)/1024,

235 (
p
->
mm
->
brk
 -Ö->mm->
°¨t_brk
)/(1024*1024),

236 
p
->
mm
->
°¨t_d©a
,Ö->mm->
íd_d©a
,

237 (
p
->
mm
->
íd_d©a
 -Ö->mm->
°¨t_d©a
)/1024,

238 (
p
->
mm
->
íd_d©a
 -Ö->mm->
°¨t_d©a
)/(1024*1024),

239 
p
->
mm
->
°¨t_code
,Ö->mm->
íd_d©a
,

240 (
p
->
mm
->
íd_d©a
 -Ö->mm->
°¨t_code
)/1024,

241 (
p
->
mm
->
íd_d©a
 -Ö->mm->
°¨t_code
)/(1024*1024)

245 #ifde‡
CONFIG_ARM64


247 
u64
 
•_ñ1
;

248 
	`asm
 ("mr†%0, sp_ñ1" : "Ù" (
•_ñ1
));

249 
	`¥_öfo
("árm64: sp_ñ1 = 0x%lx\n", 
•_ñ1
);

254 
	`¥_öfo
("isá kernelÅhread (mm NUL)\n");

256 
	`¥_öfo
(

259 #ifde‡
CONFIG_STACKPROTECTOR


265 #ifde‡
CONFIG_LOCKDEP


268 #ifde‡
CONFIG_TASK_IO_ACCOUNTING


274 #ifde‡
CONFIG_TASK_XACCT


280 #ifde‡
CONFIG_PSI


284 
p
->
ö_execve
 == 1 ? "yes" : "no",

285 
p
->
ö_iowaô
 == 1 ? "yes" : "no",

286 #ifde‡
CONFIG_STACKPROTECTOR


287 
p
->
°ack_ˇ«ry
,

289 
p
->
utime
,Ö->
°ime
,

290 
p
->
nvcsw
,Ö->
nivcsw
,

291 
p
->
mö_Êt
,Ö->
maj_Êt
,

292 #ifde‡
CONFIG_LOCKDEP


293 
p
->
lockdï_dïth
,

295 #ifde‡
CONFIG_TASK_IO_ACCOUNTING


296 
p
->
iﬂc
.
ªad_byãs
,

297 
p
->
iﬂc
.
wrôe_byãs
,

298 
p
->
iﬂc
.
ˇn˚Œed_wrôe_byãs
,

300 #ifde‡
CONFIG_TASK_XACCT


301 
p
->
iﬂc
.
sys¸
,

302 
p
->
iﬂc
.
syscw
,

303 
p
->
ac˘_rss_mem1
,Ö->acct_rss_mem1/1024,

304 
p
->
ac˘_vm_mem1
,Ö->acct_vm_mem1/1024

306 #ifde‡
CONFIG_PSI


308 
p
->
psi_Êags


313 
	`¥_öfo
(

315 #ifde‡
CONFIG_X86_64


322 #ifde‡
CONFIG_ARM64


334 #ifde‡
CONFIG_ARM64_PTR_AUTH


341 &(
p
->
thªad
),

342 #ifde‡
CONFIG_X86_64


343 
ti
,

344 
p
->
thªad
.
•
,

345 
p
->
thªad
.
es
,Ö->thªad.
ds
,

346 
p
->
thªad
.
¸2
,Ö->thªad.
å≠_ƒ
,Ö->thªad.
îr‹_code


348 #ifde‡
CONFIG_ARM64


349 
ti
,

350 
ti
->
addr_limô
,

351 
ti
->
addr_limô
/(1024*1024),

352 
ti
->
addr_limô
/(1024*1024*1024),

353 
p
->
thªad
.
˝u_c⁄ãxt
.
x19
,Ö->thªad.˝u_c⁄ãxt.
x20
,Ö->thªad.˝u_c⁄ãxt.
x21
,

354 
p
->
thªad
.
˝u_c⁄ãxt
.
x22
,Ö->thªad.˝u_c⁄ãxt.
x23
,Ö->thªad.˝u_c⁄ãxt.
x24
,

355 
p
->
thªad
.
˝u_c⁄ãxt
.
x25
,Ö->thªad.˝u_c⁄ãxt.
x26
,Ö->thªad.˝u_c⁄ãxt.
x27
,

356 
p
->
thªad
.
˝u_c⁄ãxt
.
x28
,

357 
p
->
thªad
.
˝u_c⁄ãxt
.
Â
,Ö->thªad.˝u_c⁄ãxt.
•
,Ö->thªad.˝u_c⁄ãxt.
pc
,

358 
p
->
thªad
.
Áu…_addªss
,Ö->thªad.
Áu…_code


362 
	`èsk_u∆ock
(
p
);

364 
	`dump_°ack
();

367 
	}
}

368 
EXPORT_SYMBOL
(
di•_èsk_dëaûs
);

	@Training/L2_kernel_trg/taskdtl/taskdtl_miscdrv/taskdtl_miscdrv.c

12 
	~<löux/öô.h
>

13 
	~<löux/moduÀ.h
>

14 
	~<löux/sched.h
>

15 
	~<löux/¶ab.h
>

16 
	~<löux/uac˚ss.h
>

19 
	~<löux/fs.h
>

20 
	~<löux/miscdevi˚.h
>

21 
	~"../../c⁄víõ¡.h
"

23 
MODULE_LICENSE
("Dual MIT/GPL");

25 
	#MODNAME
 "èskdé_miscdrv"

	)

26 
di•_èsk_dëaûs
(
èsk_°ru˘
 *);

28 
devi˚
 *
	gdev
;

30 
	$my_dev_›í
(
öode
 *öode, 
fûe
 *file)

32 
	`¥_öfo
("%s:%s() called.\n"

34 
MODNAME
, 
__func__
, 
	`imö‹
(
öode
));

36 
	}
}

38 
ssize_t
 
	$my_dev_ªad
(
fûe
 *fûe, 
__u£r
 *
buf
,

39 
size_t
 
cou¡
, 
loff_t
 *
off
)

41 
	`¥_öfo
("%s:%s() called.\n"

43 
MODNAME
, 
__func__
, 
cou¡
);

44  
cou¡
;

45 
	}
}

47 
ssize_t
 
	$my_dev_wrôe
(
fûe
 *fûe, c⁄° 
__u£r
 *
buf
,

48 
size_t
 
cou¡
, 
loff_t
 *
off
)

50 
èsk_°ru˘
 *
ç
 = 
NULL
;

51 *
kbuf
 = 
	`kzÆloc
(10, 
GFP_KERNEL
);

52 
pid
 = 1;

53 
ssize_t
 
°©us
 = 
cou¡
;

55 
	`PRINT_CTX
();

56 
	`¥_debug
("%s:%s() called;\n"

58 
MODNAME
, 
__func__
, 
cou¡
);

59 i‡(!
kbuf
) {

60 
	`¥_îr
("%s:%s(): kzÆlo¯(10ËÁûed !\n", 
MODNAME
, 
__func__
);

61  -
ENOMEM
;

65 i‡(
	`c›y_‰om_u£r
(
kbuf
, 
buf
, 
cou¡
)) {

66 
	`¥_îr
("%s:%s(): c›y_‰om_u£∏Áûed !\n", 
MODNAME
, 
__func__
);

67 
°©us
 = -
EFAULT
;

68 
out1
;

70 
°©us
 = 
	`k°πﬁ
(
kbuf
, 0, &
pid
);

71 i‡(
°©us
 < 0) {

72 
	`¥_îr
("%s:%s(): kstrtol failed : wasáÇumeric valueÖassed?\n",

73 
MODNAME
, 
__func__
);

74 
out1
;

76 
°©us
 = 
cou¡
;

78 
ç
 = 
	`pid_èsk
(
	`föd_vpid
(
pid
), 
PIDTYPE_PID
);

79 i‡(!
ç
) {

80 
	`¥_îr
("%s: failedÅo obtainÅask structÖointer for PID %d\n",

81 
MODNAME
, 
pid
);

82 
°©us
 = -
EINVAL
;

83 
out1
;

85 
	`¥_debug
("Öid=%d,Åp=0x%lx\n", 
pid
, 
ç
);

86 
	`di•_èsk_dëaûs
(
ç
);

88 
out1
:

89 
	`k‰ì
(
kbuf
);

90  
°©us
;

91 
	}
}

93 
	$my_dev_˛o£
(
öode
 *öode, 
fûe
 *file)

95 
	`¥_öfo
("%s:%s(ËˇŒed.\n", 
MODNAME
, 
__func__
);

97 
	}
}

99 
	$my_dev_io˘l
(
fûe
 *fûe, 
cmd
, 
¨g
)

101 
	`¥_öfo
("%s:%s() called.\n"

103 , 
MODNAME
, 
__func__
, 
cmd
, 
¨g
);

105 
	}
}

107 c⁄° 
fûe_›î©i⁄s
 
	gmy_dev_f›s
 = {

108 .
ow√r
 = 
THIS_MODULE
,

109 .
	g›í
 = 
my_dev_›í
,

110 .
	gªad
 = 
my_dev_ªad
,

111 .
	gwrôe
 = 
my_dev_wrôe
,

112 .
	gªÀa£
 = 
my_dev_˛o£
,

113 .
	gu∆ocked_io˘l
 = 
my_dev_io˘l
,

117 
miscdevi˚
 
	gmy_miscdevi˚
 = {

118 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

119 .
	g«me
 = "taskdtl",

120 .
	gmode
 = 0666,

121 .
	gf›s
 = &
my_dev_f›s
,

125 
__öô
 
	$èskdé_öô
()

127 
ªt_vÆ
;

129 
	`¥_öfo
("%s:Åaskdé mis¯drivî inô\n", 
MODNAME
);

132 
ªt_vÆ
 = 
	`misc_ªgi°î
(&
my_miscdevi˚
);

133 i‡(
ªt_vÆ
 != 0) {

134 
	`¥_îr
("%s: couldÇŸÑegi°îÅhêmis¯devi˚ mydev", 
MODNAME
);

135  
ªt_vÆ
;

138 
dev
 = 
my_miscdevi˚
.
this_devi˚
;

139 
	`¥_öfo
("%s:mö‹=%d\n", 
MODNAME
, 
my_miscdevi˚
.
mö‹
);

140 
	`¥_öfo
("%s: inôülized\n", 
MODNAME
);

142 
	}
}

144 
__exô
 
	$èskdé_exô
()

146 
	`¥_öfo
("%s:ÉxôögÇow\n", 
MODNAME
);

148 
	`misc_dîegi°î
(&
my_miscdevi˚
);

149 
	}
}

151 
moduÀ_öô
(
èskdé_öô
);

152 
moduÀ_exô
(
èskdé_exô
);

	@Training/L2_kernel_trg/taskdtl/taskdtl_raw/taskdtl.c

12 
	~<löux/öô.h
>

13 
	~<löux/moduÀ.h
>

14 
	~<löux/sched.h
>

16 
	~<löux/vmÆloc.h
>

17 
	~<löux/mm_ty≥s.h
>

19 
	~<löux/vîsi⁄.h
>

20 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 10, 0)

21 
	~<löux/sched/sig«l.h
>

24 
	~<löux/mm.h
>

25 
	~<löux/©omic.h
>

26 
	~<löux/•ölock.h
>

28 
MODULE_LICENSE
("Dual MIT/GPL");

30 
	#MODNAME
 "èskdé"

	)

31 
	gpid
;

32 
moduÀ_∑øm
(
pid
, , 0);

33 
MODULE_PARM_DESC
(
pid
, "setÅhisÅoÅhe PID ofÅheÖrocess orÅhreadÅo dumpÅask infoábout");

35 
	$di•_èsk_dëaûs
(
èsk_°ru˘
 *
p
)

37 *
pﬁ
=
NULL
;

38 
thªad_öfo
 *
ti
 = 
	`èsk_thªad_öfo
(
p
);

40 
	`èsk_lock
(
p
);

43 
	`¥_öfo
("Task struct @ 0x%lx ::\n"

47 
p
,Ö->
comm
,Ö->
tgid
,Ö->
pid
,

48 " ", 
	`__kuid_vÆ
(
p
->
¸ed
->
uid
), __kuid_vÆ’->¸ed->
euid
),

49 " ", 
	`__kuid_vÆ
(
p
->
logöuid
));

52 #ifde‡
CONFIG_ARM64


53 
u64
 
•_ñ0
;

54 
	`asm
 ("mr†%0, sp_ñ0" : "Ù" (
•_ñ0
));

55 
	`¥_öfo
("árm64: sp_ñ0 hﬁd†èskÖå (vÆuêi†0x%lx)\n", 
•_ñ0
);

60 
	`¥_öfo
("Task sèã (%dË: ", 
p
->
°©e
);

61 
p
->
°©e
) {

62 
TASK_RUNNING
 : 
	`¥_öfo
(" R:Ñeady-to-run (onÑq) ORÑunning (on cpu)\n");

64 
TASK_INTERRUPTIBLE
 : 
	`¥_öfo
(" S: interruptible sleep\n");

66 
TASK_UNINTERRUPTIBLE
 : 
	`¥_öfo
(" D: uninterruptible sleep (!)\n");

68 
__TASK_STOPPED
 : 
	`¥_öfo
(" T: stopped\n");

70 
__TASK_TRACED
 : 
	`¥_öfo
("Å:Åraced\n");

72 
TASK_PARKED
 : 
	`¥_öfo
(" .: PARKED\n");

74 
TASK_DEAD
 : 
	`¥_öfo
(" X: DEAD\n");

76 
TASK_WAKEKILL
 : 
	`¥_öfo
(" .: WAKEKILL\n");

78 
TASK_WAKING
 : 
	`¥_öfo
(" .: WAKING\n");

80 
TASK_NOLOAD
 : 
	`¥_öfo
(" .: NOLOAD\n");

82 
TASK_NEW
 : 
	`¥_öfo
(" .: NEW\n");

84  : 
	`¥_öfo
(" ? <unknown>\n");

87 i‡(!
ti
)

88 
	`¥_w¨n
("ti invalid!\n");

90 
	`¥_öfo
(

92 #ifde‡
CONFIG_THREAD_INFO_IN_TASK


97 , 
ti
);

100 
	`¥_öfo
(

105 #ifde‡
CONFIG_VMAP_STACK


110 #ifde‡
CONFIG_GCC_PLUGIN_STACKLEAK


115 #ifde‡
CONFIG_THREAD_INFO_IN_TASK


124 
p
->
°ack
,

125 #ifde‡
CONFIG_GCC_PLUGIN_STACKLEAK


126 
p
->
lowe°_°ack
,

128 
p
->
Êags
,

129 #ifde‡
CONFIG_THREAD_INFO_IN_TASK


130 
p
->
˝u
,

132 
p
->
⁄_rq
 ? "yes" : "no",

133 
p
->
¥io
,

134 
p
->
°©ic_¥io
,

135 
p
->
n‹mÆ_¥io
,

136 
p
->
π_¥i‹ôy
,

137 
p
->
£
.
vru¡ime


141 
p
->
pﬁicy
) {

142 
SCHED_NORMAL
: 
pﬁ
 = "Normal/Other";

144 
SCHED_FIFO
: 
pﬁ
 = "FIFO";

146 
SCHED_RR
: 
pﬁ
 = "RR";

148 
SCHED_BATCH
: 
pﬁ
 = "BATCH";

150 
SCHED_IDLE
: 
pﬁ
 = "IDLE";

152 
SCHED_DEADLINE
: 
pﬁ
 = "DEADLINE";

154 : 
pﬁ
 = "<Unknown>";

156 
	`¥_öfo
("Öﬁicy : %s", 
pﬁ
);

158 
	`¥_öfo
(

160 #ifde‡
CONFIG_SCHED_INFO


165 
p
->
ƒ_˝us_Ælowed


166 #ifde‡
CONFIG_SCHED_INFO


168 
p
->
sched_öfo
.
pcou¡
,

169 
p
->
sched_öfo
.
run_dñay


174 i‡(
p
->
mm
) {

175 
	`¥_öfo
("mm info ::\n"

176 "ÇŸá kî√»thªad; mm_°ru˘ : 0x%lx\n", 
p
->
mm
);

177 
	`¥_öfo
(

180 #ifde‡
CONFIG_MMU


195 
p
->
mm
->
pgd
,

196 
	`©omic_ªad
(&
p
->
mm
->
mm_u£rs
),

197 
	`©omic_ªad
(&
p
->
mm
->
mm_cou¡
),

198 #ifde‡
CONFIG_MMU


199 
	`©omic64_ªad
(&
p
->
mm
->
pgèbÀs_byãs
),

201 
p
->
mm
->
m≠_cou¡
,

202 
p
->
mm
->
highe°_vm_íd
,

203 
p
->
mm
->
hiw©î_rss
,

204 
p
->
mm
->
hiw©î_vm
,

205 
p
->
mm
->
tŸÆ_vm
,

206 
p
->
mm
->
locked_vm
,

207 
p
->
mm
->
pö√d_vm
,

208 
p
->
mm
->
d©a_vm
,

209 
p
->
mm
->
exec_vm
,

210 
p
->
mm
->
°ack_vm
,

211 
p
->
mm
->
def_Êags


216 
	`¥_öfo
(

226 
p
->
mm
->
ív_°¨t
,Ö->mm->
ív_íd
,

227 
p
->
mm
->
ív_íd
 -Ö->mm->
ív_°¨t
,

228 
p
->
mm
->
¨g_°¨t
,Ö->mm->
¨g_íd
,

229 
p
->
mm
->
¨g_íd
 -Ö->mm->
¨g_°¨t
,

232 
p
->
mm
->
°¨t_°ack
,

233 
p
->
mm
->
°¨t_brk
,Ö->mm->
brk
,

234 (
p
->
mm
->
brk
 -Ö->mm->
°¨t_brk
)/1024,

235 (
p
->
mm
->
brk
 -Ö->mm->
°¨t_brk
)/(1024*1024),

236 
p
->
mm
->
°¨t_d©a
,Ö->mm->
íd_d©a
,

237 (
p
->
mm
->
íd_d©a
 -Ö->mm->
°¨t_d©a
)/1024,

238 (
p
->
mm
->
íd_d©a
 -Ö->mm->
°¨t_d©a
)/(1024*1024),

239 
p
->
mm
->
°¨t_code
,Ö->mm->
íd_d©a
,

240 (
p
->
mm
->
íd_d©a
 -Ö->mm->
°¨t_code
)/1024,

241 (
p
->
mm
->
íd_d©a
 -Ö->mm->
°¨t_code
)/(1024*1024)

245 #ifde‡
CONFIG_ARM64


247 
u64
 
•_ñ1
;

248 
	`asm
 ("mr†%0, sp_ñ1" : "Ù" (
•_ñ1
));

249 
	`¥_öfo
("árm64: sp_ñ1 = 0x%lx\n", 
•_ñ1
);

254 
	`¥_öfo
("isá kernelÅhread (mm NUL)\n");

256 
	`¥_öfo
(

263 #ifde‡
CONFIG_LOCKDEP


266 #ifde‡
CONFIG_TASK_IO_ACCOUNTING


272 #ifde‡
CONFIG_TASK_XACCT


278 #ifde‡
CONFIG_PSI


282 
p
->
ö_execve
 == 1 ? "yes" : "no",

283 
p
->
ö_iowaô
 == 1 ? "yes" : "no",

284 
p
->
°ack_ˇ«ry
,

285 
p
->
utime
,Ö->
°ime
,

286 
p
->
nvcsw
,Ö->
nivcsw
,

287 
p
->
mö_Êt
,Ö->
maj_Êt
,

288 #ifde‡
CONFIG_LOCKDEP


289 
p
->
lockdï_dïth
,

291 #ifde‡
CONFIG_TASK_IO_ACCOUNTING


292 
p
->
iﬂc
.
ªad_byãs
,

293 
p
->
iﬂc
.
wrôe_byãs
,

294 
p
->
iﬂc
.
ˇn˚Œed_wrôe_byãs
,

296 #ifde‡
CONFIG_TASK_XACCT


297 
p
->
iﬂc
.
sys¸
,

298 
p
->
iﬂc
.
syscw
,

299 
p
->
ac˘_rss_mem1
,Ö->acct_rss_mem1/1024,

300 
p
->
ac˘_vm_mem1
,Ö->acct_vm_mem1/1024

302 #ifde‡
CONFIG_PSI


304 
p
->
psi_Êags


309 
	`¥_öfo
(

311 #ifde‡
CONFIG_X86_64


319 #ifde‡
CONFIG_ARM64


331 #ifde‡
CONFIG_ARM64_PTR_AUTH


338 &(
p
->
thªad
),

339 #ifde‡
CONFIG_X86_64


340 
ti
,

341 
p
->
thªad
.
•
,

342 
p
->
thªad
.
es
,Ö->thªad.
ds
,

343 
p
->
thªad
.
¸2
,Ö->thªad.
å≠_ƒ
,Ö->thªad.
îr‹_code
,

344 
p
->
thªad
.
addr_limô
.
£g
, ()p->thread.addr_limit.seg/(1024*1024),

345 ()
p
->
thªad
.
addr_limô
.
£g
/(1024*1024*1024)

348 #ifde‡
CONFIG_ARM64


349 
ti
,

350 
ti
->
addr_limô
,

351 
ti
->
addr_limô
/(1024*1024),

352 
ti
->
addr_limô
/(1024*1024*1024),

353 
p
->
thªad
.
˝u_c⁄ãxt
.
x19
,Ö->thªad.˝u_c⁄ãxt.
x20
,Ö->thªad.˝u_c⁄ãxt.
x21
,

354 
p
->
thªad
.
˝u_c⁄ãxt
.
x22
,Ö->thªad.˝u_c⁄ãxt.
x23
,Ö->thªad.˝u_c⁄ãxt.
x24
,

355 
p
->
thªad
.
˝u_c⁄ãxt
.
x25
,Ö->thªad.˝u_c⁄ãxt.
x26
,Ö->thªad.˝u_c⁄ãxt.
x27
,

356 
p
->
thªad
.
˝u_c⁄ãxt
.
x28
,

357 
p
->
thªad
.
˝u_c⁄ãxt
.
Â
,Ö->thªad.˝u_c⁄ãxt.
•
,Ö->thªad.˝u_c⁄ãxt.
pc
,

358 
p
->
thªad
.
Áu…_addªss
,Ö->thªad.
Áu…_code


362 
	`èsk_u∆ock
(
p
);

364 
	`dump_°ack
();

367 
	}
}

369 
__öô
 
	$èskdé_öô
()

371 
èsk_°ru˘
 *
ç
;

373 i‡(0 =
pid
) {

374 
	`¥_îr
("%s:Ö»∑s†®vÆid PIDá†∑ømëîÅÿthi†kî√»moduÀ\n", 
MODNAME
);

375  -
EINVAL
;

377 
ç
 = 
	`pid_èsk
(
	`föd_vpid
(
pid
), 
PIDTYPE_PID
);

378 i‡(!
ç
) {

379 
	`¥_îr
("%s: failedÅo obtainÅask structÖointer for PID %d\n",

380 
MODNAME
, 
pid
);

381  -
EINVAL
;

383 
	`¥_debug
("pid=%d,Å∞0x%lx\n", 
pid
, 
ç
);

384 
	`di•_èsk_dëaûs
(
ç
);

386 
	}
}

387 
__exô
 
	$èskdé_exô
()

389 
	`¥_öfo
("%s:ÉxôögÇow\n", 
MODNAME
);

391 
	`dump_°ack
();

393 
	}
}

395 
moduÀ_öô
(
èskdé_öô
);

396 
moduÀ_exô
(
èskdé_exô
);

	@Training/L3_dd_trg/2.6k_chardrv_template/chardrv_template.c

5 
	~<löux/öô.h
>

6 
	~<löux/kî√l.h
>

7 
	~<löux/moduÀ.h
>

8 
	~<löux/devi˚.h
>

9 
	~<löux/sched.h
>

10 
	~<löux/fs.h
>

11 
	~<löux/¶ab.h
>

14 
	~<löux/vîsi⁄.h
>

15 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

16 
	~<löux/uac˚ss.h
>

18 
	~<asm/uac˚ss.h
>

21 
	~<löux/cdev.h
>

23 
	#DRVNAME
 "chardrv"

24 
	#DRV_MINOR_START
 0

	)

25 
	#DEV_COUNT
 2

26 
	#DEVICE_FILE
 "/dev/cdrv"

	)

28 #ifde‡
DEBUG


29 
	#MSG
(
°rög
, 
¨gs
...) \

30 
	`¥ötk
(
KERN_DEBUG
 "%s:%s:%d: " 
°rög
, \

31 
DRVNAME
, 
__func__
, 
__LINE__
, ##
¨gs
)

	)

33 
	#MSG
(
°rög
, 
¨gs
...)

	)

36 
dev_t
 
	gch¨drv_dev_numbî
;

37 
	sch¨drv_dev
 {

38 
	m«me
[10];

39 
cdev
 
	mcdev
;

40 } *
	gch¨drv_devp
;

41 
˛ass
 *
	gch¨drv_˛ass
;

44 c⁄° 
fûe_›î©i⁄s
 
	gdrv_f›s
 = {

45 .
Œ£ek
 = 
no_Œ£ek
,

49 
	$cdrv_›í
(
öode
 *öode, 
fûe
 *
fûp
)

51 
	`MSG
("Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

52 
	`imö‹
(
öode
)) {

54 
fûp
->
f_›
 = &
drv_f›s
;

57  -
ENXIO
;

59 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

60  
fûp
->
f_›
->
	`›í
(
öode
, filp);

62 
	}
}

65 c⁄° 
fûe_›î©i⁄s
 
	gcdrv_›í_f›s
 = {

66 .
›í
 = 
cdrv_›í
,

70 
	$ch¨dev_ªgi°øti⁄
()

72 
ªs
 = 0, 
i
 = 0;

74 
ªs
 =

75 
	`Æloc_chrdev_ªgi⁄
(&
ch¨drv_dev_numbî
, 
DRV_MINOR_START
, 
DEV_COUNT
,

76 
DEVICE_FILE
);

77 i‡(
ªs
) {

78 
	`¥_w¨n
("%s: couldÇŸáŒoˇã devi˚\n", 
DRVNAME
);

79  
ªs
;

81 
	`¥_öfo
("%s:Ñegi°îed wôh maj‹Çumbî %d\n", 
DRVNAME
,

82 
	`MAJOR
(
ch¨drv_dev_numbî
));

84 
ch¨drv_devp
 =

85 
	`kzÆloc
(
DEV_COUNT
 * (
ch¨drv_dev
), 
GFP_KERNEL
);

86 i‡(
ch¨drv_devp
 =
NULL
) {

87 
	`¥_w¨n
("%s: kzÆlo¯Áûed!\n", 
DRVNAME
);

88  -
ENOMEM
;

91 
i
 = 0; i < 
DEV_COUNT
; i++) {

92 
	`cdev_öô
(&
ch¨drv_devp
[
i
].
cdev
, &
cdrv_›í_f›s
);

93 
ch¨drv_devp
[
i
].
cdev
.
ow√r
 = 
THIS_MODULE
;

94 
ch¨drv_devp
[
i
].
cdev
.
›s
 = &
cdrv_›í_f›s
;

95 
ªs
 =

96 
	`cdev_add
(&
ch¨drv_devp
[
i
].
cdev
,

97 
	`MKDEV
(
	`MAJOR
(
ch¨drv_dev_numbî
),

98 
	`MINOR
(
ch¨drv_dev_numbî
Ë+ 
i
), 1);

99 i‡(
ªs
) {

100 
	`¥_nŸi˚
("%s: Eº‹ o¿cdev_add f‹ %d\n", 
DRVNAME
,

101 
ªs
);

102  
ªs
;

104 
	`¥_öfo
("%s: cdev %s.%dádded\n", 
DRVNAME
, DRVNAME, 
i
);

111 
ch¨drv_˛ass
 = 
	`˛ass_¸óã
(
THIS_MODULE
, 
DRVNAME
);

112 
i
 = 0; i < 
DEV_COUNT
; i++) {

113 i‡(!
devi˚_¸óã


114 (
ch¨drv_˛ass
, 
NULL
,

115 
	`MKDEV
(
	`MAJOR
(
ch¨drv_dev_numbî
),

116 
	`MINOR
(
ch¨drv_dev_numbî
Ë+ 
i
), 
NULL
, "%s.%d",

117 
DRVNAME
, 
i
)) {

118 
¥_nŸi˚


120 
DRVNAME
, DRVNAME, 
i
);

121  
ªs
;

123 
	`¥_öfo
(" %s: DeviceÇode /dev/%s.%d created.\n",

124 
DRVNAME
, DRVNAME, 
i
);

126  
ªs
;

127 
	}
}

129 
__öô
 
	$cdrv_öô_moduÀ
()

131  
	`ch¨dev_ªgi°øti⁄
();

132 
	}
}

134 
__exô
 
	$cdrv_˛ónup_moduÀ
()

136 
i
 = 0;

138 
i
 = 0; i < 
DEV_COUNT
; i++) {

139 
	`cdev_dñ
(&
ch¨drv_devp
[
i
].
cdev
);

140 
	`devi˚_de°roy
(
ch¨drv_˛ass
,

141 
	`MKDEV
(
	`MAJOR
(
ch¨drv_dev_numbî
),

142 
	`MINOR
(
ch¨drv_dev_numbî
Ë+ 
i
));

144 
	`˛ass_de°roy
(
ch¨drv_˛ass
);

145 
	`k‰ì
(
ch¨drv_devp
);

146 
	`uƒegi°î_chrdev_ªgi⁄
(
ch¨drv_dev_numbî
, 
DEV_COUNT
);

147 
	`MSG
("Unregistered.\n");

148 
	}
}

150 
moduÀ_öô
(
cdrv_öô_moduÀ
);

151 
moduÀ_exô
(
cdrv_˛ónup_moduÀ
);

152 
MODULE_AUTHOR
("Your Name here");

153 
MODULE_DESCRIPTION
("Writeá one-line description ofÅhe char device driver here.");

157 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L3_dd_trg/blockdrv/older_sbd/sbd.c

22 
	~<löux/moduÀ.h
>

23 
	~<löux/moduÀ∑øm.h
>

24 
	~<löux/öô.h
>

25 
	~<löux/kî√l.h
>

26 
	~<löux/fs.h
>

27 
	~<löux/î∫o.h
>

28 
	~<löux/ty≥s.h
>

29 
	~<löux/vmÆloc.h
>

30 
	~<löux/gíhd.h
>

31 
	~<löux/blkdev.h
>

32 
	~<löux/hdªg.h
>

33 
	~"../c⁄víõ¡.h
"

35 
	#MYDISKNAME
 "sblock0"

	)

38 
	#SHOW_K_DUMPSTACK
 0

39 #i‡(
SHOW_K_DUMPSTACK
 =1)

	)

40 
	#QP_‹_QPDS
 
QPDS


	)

42 
	#QP_‹_QPDS
 do { \

43 
	`MSG
("process %s(%d), irq-ctx? %s\n", \

44 
cuºít
->
comm
, cuºít->
tgid
, (
	`ö_öãºu±
() ? "y" : "n")); \

45 } 0)

	)

48 
MODULE_LICENSE
("Dual BSD/GPL");

50 
	gmaj‹_num
 = 0;

51 
moduÀ_∑øm
(
maj‹_num
, , 0);

52 
	glogiˇl_block_size
 = 512;

53 
moduÀ_∑øm
(
logiˇl_block_size
, , 0);

54 
	gn£˘‹s
 = 1024;

55 
moduÀ_∑øm
(
n£˘‹s
, , 0);

61 
	#KERNEL_SECTOR_SIZE
 512

	)

66 
ªque°_queue
 *
	gQueue
;

71 
	ssbd_devi˚
 {

72 
	msize
;

73 
•ölock_t
 
	mlock
;

74 
u8
 *
	md©a
;

75 
gídisk
 *
	mgd
;

76 } 
	gDevi˚
;

87 
	$sbd_å™s„r
(
sbd_devi˚
 *
dev
, 
£˘‹_t
 
£˘‹
,

88 
n£˘
, *
buf„r
, 
wrôe
)

90 
off£t
 = 
£˘‹
 * 
logiˇl_block_size
;

91 
nbyãs
 = 
n£˘
 * 
logiˇl_block_size
;

93 
	`MSG
("loc 0x%llx, bufferÖtr 0x%llx,Çbytes %lu, dir:%s\n",

94 (
u64
)(
dev
->
d©a
 + 
off£t
), (u64)
buf„r
, 
nbyãs
, (
wrôe
?"w":"r"));

95 i‡((
off£t
 + 
nbyãs
Ë> 
dev
->
size
) {

96 
	`¥_nŸi˚
("sbd: Bey⁄d-íd wrôê(%ld %ld)\n", 
off£t
, 
nbyãs
);

102 i‡(
wrôe
)

103 
	`mem˝y
(
dev
->
d©a
 + 
off£t
, 
buf„r
, 
nbyãs
);

105 
	`mem˝y
(
buf„r
, 
dev
->
d©a
 + 
off£t
, 
nbyãs
);

106 
	}
}

110 
	$show_ªq_dëaûs
(
ªque°
 *
ªq
)

112 
gídisk
 *
gd
;

114 
	`as£π
(
ªq
 !
NULL
);

115 
gd
 = 
ªq
->
rq_disk
;

119 
	`MSG
("Data dir '%s', on (gen)disk: %s\n",

120 (
	`rq_d©a_dú
(
ªq
Ë? "W" : "R"), 
gd
->
disk_«me
);

124 
	#SHOW_POS
 0

125 #i‡(
SHOW_POS
 =1)

	)

134 
	`MSG
("curr sector: %9u\n"

137 
	`blk_rq_pos
(
ªq
),

138 
	`blk_rq_byãs
(
ªq
), 
	`blk_rq_cur_byãs
(req),

139 
	`blk_rq_£˘‹s
(
ªq
), 
	`blk_rq_cur_£˘‹s
(req));

148 
	#SHOW_BLOCKDEV
 0

149 #i‡(
SHOW_BLOCKDEV
 =1)

	)

152 
block_devi˚
 *
bd
 = 
ªq
->
bio
->
bi_bdev
;

153 
su≥r_block
 *
sb
 = 
bd
->
bd_su≥r
;

154 
	`as£π
(
bd
 !
NULL
);

156 
	`MSG
("block devÖå = 0x%x\n", (
u32
)
bd
);

157 
	`MSG
("bd_part_count = %d, invalidated=%d, bd_contains=0x%x\n",

158 
bd
->
bd_∑π_cou¡
, bd->
bd_övÆid©ed
, (
u32
)bd->
bd_c⁄èös
);

164 
	#SHOW_BIO
 1

165 #i‡(
SHOW_BIO
 =1)

	)

168 
bio
 *biÿ
ªq
->bio;

169 
bio_vec
 *
bvec
;

170 
i
=0;

171 
bvec_ôî
 
ôî
;

173 
	`as£π
 (
bio
 !
NULL
);

175 
	`MSG
("---bio=0x%lx biŸaû=0x%lx\n", ()
ªq
->
bio
, (Ïeq->
biŸaû
);

176 
	`MSG
("--> curr (start) sector= %9dÇr_sectors= %6u\n",

177 ()
	`blk_rq_pos
(
ªq
), 
	`blk_rq_£˘‹s
(req));

180 
	`f‹_óch_bio
(
bio
) {

181 
fú°
=1;

183 
	`bio_gë
(
bio
);

184 
	`MSG
(" %2d:BIO 0x%lx: #Élements (i.e. segments) inÅhis bio's biovecárray: ## %d ##\n",

185 
i
, ()
bio
, bio->
bi_v˙t
);

186 
	`MSG
(" segments=%d, sectors=%d,Öhys segments=%d, flags=0x%x\n",

187 
	`bio_£gmíts
(
bio
), 
	`bio_£˘‹s
(bio), bio->
bi_phys_£gmíts
, (
u32
)bio->
bi_Êags
);

191 
	#SEE_ALL_BIOS
 0

	)

192 #i‡(
SEE_ALL_BIOS
 == 0)

193 
	`bio_f‹_óch_£gmít
(
bvec
, 
bio
, 
ôî
)

195 
	`__bio_f‹_óch_£gmít
(
bvec
, 
bio
, 
ôî
, 0)

198 i‡(
fú°
) {

199 
	`MSG
(" %2d:SEG:Öage=0x%x, offset %u,Üen %u\n",

202 
ôî
->
bi_idx
, (
u32
)
	`bio_∑ge
(
bio
), 
	`bio_off£t
(bio), 
	`bio_cur_byãs
(bio));

204 i‡(
bio
->
bi_v˙t
 > 1)

205 
	`MSG_SHORT
(" [ªm %2dÅÿ", 
i
+1);

206 
fú°
=0;

208 i‡((
bio
->
bi_v˙t
 > 1Ë&& (
i
 == bio->bi_vcnt-1))

209 
	`MSG_SHORT
(" %2d]ÇŸ shown", 
i
);

211 
	`bio_put
(
bio
);

215 
	}
}

242 
	$sbd_ªque°
(
ªque°_queue
 *
q
)

244 
ªque°
 *
ªq
;

246 
	`¥_öfo
("------------------\n");

247 
QP_‹_QPDS
;

249 
ªq
 = 
	`blk_„tch_ªque°
(
q
);

251 
ªq
 !
NULL
) {

255 i‡(
ªq
 =
NULL
) {

256 
	`¥_nŸi˚
("SkipÇon-CMDÑequest\n");

257 
	`__blk_íd_ªque°_Æl
(
ªq
, -
EIO
);

263 
	`show_ªq_dëaûs
(
ªq
);

272 
	`MSG
(" sbd_transfer(&Device 0x%x, start sector %d, # sectors %d, "

274 (
u32
)&
Devi˚
, 
	`blk_rq_pos
(
ªq
), 
	`blk_rq_cur_£˘‹s
(req),

275 (
u32
)
ªq
->
buf„r
, (
	`rq_d©a_dú
(req) ? "1" : "0"));

279 
	`sbd_å™s„r
(&
Devi˚
, 
	`blk_rq_pos
(
ªq
), 
	`blk_rq_cur_£˘‹s
(req),

280 
	`bio_d©a
(
ªq
->
bio
), 
	`rq_d©a_dú
(req));

283 
	`¥_öfo
("skipped: sbd_transfer : memcpy ...\n");

286 i‡–! 
	`__blk_íd_ªque°_cur
(
ªq
, 0) ) {

287 
ªq
 = 
	`blk_„tch_ªque°
(
q
);

290 
	}
}

297 
	$sbd_gëgeomëry
(
block_devi˚
 * block_devi˚, 
hd_geomëry
 * 
geo
)

299 
size
;

301 
QP_‹_QPDS
;

303 
size
 = 
Devi˚
.sizê* (
logiˇl_block_size
 / 
KERNEL_SECTOR_SIZE
);

304 
	`MSG
("sizê%ld [%ld Kb, %ld Mb]\n", 
size
, size/1024, size/(1024*1024));

305 
geo
->
cylödîs
 = (
size
 & ~0x3f) >> 6;

306 
geo
->
hóds
 = 4;

307 
geo
->
£˘‹s
 = 16;

308 
geo
->
°¨t
 = 0;

310 
	}
}

316 
	$sbd_›í
(
block_devi˚
 *
bd
, 
fmode_t
 
mode
)

318 
QP_‹_QPDS
;

319 i‡(
bd
->
bd_su≥r
)

320 
	`MSG
("su≥rblock blocksize: %lu\n", 
bd
->
bd_su≥r
->
s_blocksize
);

322 
	}
}

323 
	$sbd_ªÀa£
(
gídisk
 *
gd
, 
fmode_t
 
mode
)

325 
QP_‹_QPDS
;

326 
	}
}

332 
block_devi˚_›î©i⁄s
 
	gsbd_›s
 = {

333 .
ow√r
 = 
THIS_MODULE
,

334 .
	ggëgeo
 = 
sbd_gëgeomëry
,

335 .
	g›í
 = 
sbd_›í
,

336 .
	gªÀa£
 = 
sbd_ªÀa£
,

339 
__öô
 
	$sbd_öô
()

344 
Devi˚
.
size
 = 
n£˘‹s
 * 
logiˇl_block_size
;

345 
	`•ö_lock_öô
(&
Devi˚
.
lock
);

346 
Devi˚
.
d©a
 = 
	`vmÆloc
(Devi˚.
size
);

347 i‡(
Devi˚
.
d©a
 =
NULL
)

348  -
ENOMEM
;

354 
Queue
 = 
	`blk_öô_queue
(
sbd_ªque°
, &
Devi˚
.
lock
);

355 i‡(
Queue
 =
NULL
)

356 
out
;

357 
QP
;

359 
	`blk_queue_logiˇl_block_size
(
Queue
, 
logiˇl_block_size
);

366 
maj‹_num
 = 
	`ªgi°î_blkdev
(maj‹_num, 
MYDISKNAME
);

367 i‡(
maj‹_num
 <= 0) {

368 
	`¥_w¨n
("sbd: unableÅo get majorÇumber\n");

369 
out
;

371 
QP
;

376 
Devi˚
.
gd
 = 
	`Æloc_disk
(16);

377 i‡(!
Devi˚
.
gd
)

378 
out_uƒegi°î
;

379 
QP
;

380 
Devi˚
.
gd
->
maj‹
 = 
maj‹_num
;

381 
Devi˚
.
gd
->
fú°_mö‹
 = 0;

382 
Devi˚
.
gd
->
f›s
 = &
sbd_›s
;

383 
Devi˚
.
gd
->
¥iv©e_d©a
 = &Device;

384 
	`°r˝y
(
Devi˚
.
gd
->
disk_«me
, 
MYDISKNAME
);

385 
	`£t_ˇ∑côy
(
Devi˚
.
gd
, 
n£˘‹s
);

386 
Devi˚
.
gd
->
queue
 = 
Queue
;

388 
	`add_disk
(
Devi˚
.
gd
);

390 
	`MSG
("sbd:Ñegistered.\n");

394 
out_uƒegi°î
:

395 
	`uƒegi°î_blkdev
(
maj‹_num
, 
MYDISKNAME
);

396 
out
:

397 
	`v‰ì
(
Devi˚
.
d©a
);

398  -
ENOMEM
;

399 
	}
}

401 
__exô
 
	$sbd_exô
()

403 
	`dñ_gídisk
(
Devi˚
.
gd
);

404 
	`put_disk
(
Devi˚
.
gd
);

405 
	`uƒegi°î_blkdev
(
maj‹_num
, 
MYDISKNAME
);

406 
	`blk_˛ónup_queue
(
Queue
);

407 
	`v‰ì
(
Devi˚
.
d©a
);

408 
	`MSG
("sbd: unregistered.\n");

409 
	}
}

411 
moduÀ_öô
(
sbd_öô
);

412 
moduÀ_exô
(
sbd_exô
);

	@Training/L3_dd_trg/blockdrv/sblkdev/convenient.h

16 #i‚de‡
__LKD_CONVENIENT_H__


17 
	#__LKD_CONVENIENT_H__


	)

19 
	~<asm/∑øm.h
>

20 
	~<löux/sched.h
>

22 #ifde‡
__KERNEL__


23 
	~<löux/øãlimô.h
>

52 #unde‡
USE_FTRACE_BUFFER


54 #ifde‡
USE_FTRACE_BUFFER


55 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

56 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

58 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

59 
USE_RATELIMITING
 = 1; \

60 i‡(
USE_RATELIMITING
) { \

61 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

64 
	`¥_öfo
(
°rög
, ##
¨gs
); \

65 } 0)

	)

70 #ifde‡
DEBUG


71 #ifde‡
__KERNEL__


72 
	#MSG
(
°rög
, 
¨gs
...) do { \

73 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

74 } 0)

	)

76 
	#MSG
(
°rög
, 
¨gs
...) do { \

77 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

78 } 0)

	)

81 #ifde‡
__KERNEL__


82 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

83 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

84 } 0)

	)

86 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

87 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

88 } 0)

	)

92 
	#QP
 
	`MSG
("\n")

	)

94 #ifde‡
__KERNEL__


95 #i‚de‡
USE_FTRACE_BUFFER


96 
	#QPDS
 do { \

97 
	`MSG
("\n"); \

98 
	`dump_°ack
(); \

99 } 0)

	)

101 
	#QPDS
 do { \

102 
	`MSG
("\n"); \

103 
	`åa˚_dump_°ack
(); \

104 } 0)

	)

108 #ifde‡
__KERNEL__


109 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

110 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

111 } 0)

	)

114 
	#MSG
(
°rög
, 
¨gs
...)

	)

115 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

116 
	#QP


	)

117 
	#QPDS


	)

125 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

126 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

127 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

128 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

129 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

131 #ifde‡
__KERNEL__


157 
	~<löux/sched.h
>

158 
	~<löux/öãºu±.h
>

160 
	#PRINT_CTX
() do { \

161 
PRINTCTX_SHOWHDR
 = 0; \

162 
öå
 = '.'; \

163 i‡(!
	`ö_èsk
()) { \

164 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

165 
öå
 = 'H'; \

166 i‡(
	`ö_úq
()) \

167 
öå
 = 'h'; \

168 i‡(
	`ö_so·úq
()) \

169 
öå
 = 's'; \

172 
öå
 = '.'; \

174 i‡(
PRINTCTX_SHOWHDR
 == 1) \

175 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

176 
	`¥_debug
( \

180 , 
	`øw_smp_¥o˚ss‹_id
(), \

181 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

182 (
	`úqs_dißbÀd
()?'d':'.'), \

183 (
	`√ed_ªsched
()?'N':'.'), \

184 
öå
, \

185 (
	`¥ìm±_cou¡
() && 0xff), \

186 
__func__
 \

188 } 0)

	)

220 #ifde‡
__KERNEL__


221 
	#as£π
(
ex¥
) do { \

222 i‡(!(
ex¥
)) { \

223 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

224 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

226 } 0)

	)

230 
ölöe
 
	$bìp
(
wh©
)

232 #ifde‡
__KERNEL__


233 
	`¥_öfo
("%c", ()
wh©
);

235 
	~<uni°d.h
>

236 
buf
 = ()
wh©
;

237 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

239 
	}
}

248 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

250 
c
 = 0, 
m
; \

251 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

253 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

254 
	`bìp
((
vÆ
)); \

255 
c
++; \

256 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

257 
m
 = 0; m < 50; m++); \

258 
x
 = 
ö√r_ödex
 / 2; \

262 }

	)

265 #ifde‡
__KERNEL__


267 
dñay_£c
();

279 
	$dñay_£c
(
vÆ
)

281 
	`asm
 ("");

282 i‡(
	`ö_èsk
()) {

283 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

284 i‡(
vÆ
 == -1)

285 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

287 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

289 
	}
}

293 #ifde‡
__KERNEL__


301 
	~<löux/jiffõs.h
>

302 
	~<löux/ktime.h
>

303 
	#SHOW_DELTA
(
œãr
, 
óæõr
) do { \

304 i‡(
	`time_a·î
(()
œãr
, ()
óæõr
)) { \

305 
s64
 
dñè_ns
 = 
	`ktime_to_ns
(
	`ktime_sub
(
œãr
, 
óæõr
)); \

306 
	`¥_öfo
("dñè: %ŒdÇs", 
dñè_ns
); \

307 i‡(
dñè_ns
/1000 >= 1) \

308 
	`¥_c⁄t
(" (~ %Œd us", 
dñè_ns
/1000); \

309 i‡(
dñè_ns
/1000000 >= 1) \

310 
	`¥_c⁄t
(" ~ %Œd ms", 
dñè_ns
/1000000); \

311 i‡(
dñè_ns
/1000 >= 1) \

312 
	`¥_c⁄t
(")\n"); \

314 
	`¥_w¨n
("SHOW_DELTA(): *invalid*Éarlier >Üater? (check order ofÖarams)\n"); \

315 } 0)

	)

	@Training/L3_dd_trg/blockdrv/sblkdev/device.c

3 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

4 
	~<löux/hdªg.h
>

5 
	~<löux/cdrom.h
>

6 
	~"devi˚.h
"

8 #ifde‡
CONFIG_SBLKDEV_REQUESTS_BASED


10 
ölöe
 
	$¥o˚ss_ªque°
(
ªque°
 *
rq
, *
ƒ_byãs
)

12 
ªt
 = 0;

13 
bio_vec
 
bvec
;

14 
ªq_ôî©‹
 
ôî
;

15 
sblkdev_devi˚
 *
dev
 = 
rq
->
q
->
queued©a
;

16 
loff_t
 
pos
 = 
	`blk_rq_pos
(
rq
Ë<< 
SECTOR_SHIFT
;

17 
loff_t
 
dev_size
 = (
dev
->
ˇ∑côy
 << 
SECTOR_SHIFT
);

19 
	`PRINT_CTX
();

20 
	`rq_f‹_óch_£gmít
(
bvec
, 
rq
, 
ôî
) {

21 
Àn
 = 
bvec
.
bv_Àn
;

22 *
buf
 = 
	`∑ge_addªss
(
bvec
.
bv_∑ge
Ë+ bvec.
bv_off£t
;

24 i‡((
pos
 + 
Àn
Ë> 
dev_size
)

25 
Àn
 = ()(
dev_size
 - 
pos
);

27 i‡(
	`rq_d©a_dú
(
rq
))

28 
	`mem˝y
(
dev
->
d©a
 + 
pos
, 
buf
, 
Àn
);

30 
	`mem˝y
(
buf
, 
dev
->
d©a
 + 
pos
, 
Àn
);

32 
pos
 +
Àn
;

33 *
ƒ_byãs
 +
Àn
;

36  
ªt
;

37 
	}
}

39 
blk_°©us_t
 
	$_queue_rq
(
blk_mq_hw_˘x
 *
h˘x
, c⁄° 
blk_mq_queue_d©a
 *
bd
)

41 
ƒ_byãs
 = 0;

42 
blk_°©us_t
 
°©us
 = 
BLK_STS_OK
;

43 
ªque°
 *
rq
 = 
bd
->rq;

45 
	`PRINT_CTX
();

47 
	`ˇ¡_¶ìp
();

49 
	`blk_mq_°¨t_ªque°
(
rq
);

51 i‡(
	`¥o˚ss_ªque°
(
rq
, &
ƒ_byãs
))

52 
°©us
 = 
BLK_STS_IOERR
;

54 
	`¥_debug
("ªque° %Œu:%dÖro˚s£d\n", 
	`blk_rq_pos
(
rq
), 
ƒ_byãs
);

56 
	`blk_mq_íd_ªque°
(
rq
, 
°©us
);

58  
°©us
;

59 
	}
}

61 
blk_mq_›s
 
	gmq_›s
 = {

62 .
queue_rq
 = 
_queue_rq
,

67 
ölöe
 
	$¥o˚ss_bio
(
sblkdev_devi˚
 *
dev
, 
bio
 *bio)

69 
bio_vec
 
bvec
;

70 
bvec_ôî
 
ôî
;

71 
loff_t
 
pos
 = 
bio
->
bi_ôî
.
bi_£˘‹
 << 
SECTOR_SHIFT
;

72 
loff_t
 
dev_size
 = (
dev
->
ˇ∑côy
 << 
SECTOR_SHIFT
);

73 
°¨t_time
;

75 
	`PRINT_CTX
();

76 
°¨t_time
 = 
	`bio_°¨t_io_ac˘
(
bio
);

77 
	`bio_f‹_óch_£gmít
(
bvec
, 
bio
, 
ôî
) {

78 
Àn
 = 
bvec
.
bv_Àn
;

79 *
buf
 = 
	`∑ge_addªss
(
bvec
.
bv_∑ge
Ë+ bvec.
bv_off£t
;

81 i‡((
pos
 + 
Àn
Ë> 
dev_size
) {

83 
bio
->
bi_°©us
 = 
BLK_STS_IOERR
;

87 i‡(
	`bio_d©a_dú
(
bio
))

88 
	`mem˝y
(
dev
->
d©a
 + 
pos
, 
buf
, 
Àn
);

90 
	`mem˝y
(
buf
, 
dev
->
d©a
 + 
pos
, 
Àn
);

92 
pos
 +
Àn
;

94 
	`bio_íd_io_ac˘
(
bio
, 
°¨t_time
);

95 
	`bio_ídio
(
bio
);

96 
	}
}

98 #ifde‡
HAVE_QC_SUBMIT_BIO


99 
blk_qc_t
 
	$_submô_bio
(
bio
 *bio)

101 
blk_qc_t
 
ªt
 = 
BLK_QC_T_NONE
;

103 
	$_submô_bio
(
bio
 *bio)

106 #ifde‡
HAVE_BI_BDEV


107 
sblkdev_devi˚
 *
dev
 = 
bio
->
bi_bdev
->
bd_disk
->
¥iv©e_d©a
;

109 #ifde‡
HAVE_BI_BDISK


110 
sblkdev_devi˚
 *
dev
 = 
bio
->
bi_disk
->
¥iv©e_d©a
;

113 
	`PRINT_CTX
();

114 
	`might_¶ìp
();

117 
	`¥o˚ss_bio
(
dev
, 
bio
);

119 #ifde‡
HAVE_QC_SUBMIT_BIO


120  
ªt
;

121 
	}
}

129 
	$_›í
(
block_devi˚
 *
bdev
, 
fmode_t
 
mode
)

131 
sblkdev_devi˚
 *
dev
 = 
bdev
->
bd_disk
->
¥iv©e_d©a
;

133 i‡(!
dev
) {

134 
	`¥_îr
("Invalid diskÖrivate_data\n");

135  -
ENXIO
;

138 
	`¥_debug
("Device was opened\n");

139 
	`PRINT_CTX
();

142 
	}
}

144 
	$_ªÀa£
(
gídisk
 *
disk
, 
fmode_t
 
mode
)

146 
sblkdev_devi˚
 *
dev
 = 
disk
->
¥iv©e_d©a
;

148 i‡(!
dev
) {

149 
	`¥_îr
("Invalid diskÖrivate_data\n");

153 
	`¥_debug
("Device was closed\n");

154 
	`PRINT_CTX
();

155 
	}
}

157 
ölöe
 
	$io˘l_hdio_gëgeo
(
sblkdev_devi˚
 *
dev
, 
¨g
)

159 
hd_geomëry
 
geo
 = {0};

161 
	`PRINT_CTX
();

162 
geo
.
°¨t
 = 0;

163 i‡(
dev
->
ˇ∑côy
 > 63) {

164 
£˘‹_t
 
quŸõ¡
;

166 
geo
.
£˘‹s
 = 63;

167 
quŸõ¡
 = (
dev
->
ˇ∑côy
 + (63 - 1)) / 63;

169 i‡(
quŸõ¡
 > 255) {

170 
geo
.
hóds
 = 255;

171 
geo
.
cylödîs
 = ()

172 ((
quŸõ¡
 + (255 - 1)) / 255);

174 
geo
.
hóds
 = ()
quŸõ¡
;

175 
geo
.
cylödîs
 = 1;

178 
geo
.
£˘‹s
 = ()
dev
->
ˇ∑côy
;

179 
geo
.
cylödîs
 = 1;

180 
geo
.
hóds
 = 1;

183 i‡(
	`c›y_to_u£r
((*)
¨g
, &
geo
, (geo)))

184  -
EINVAL
;

187 
	}
}

189 
	$_io˘l
(
block_devi˚
 *
bdev
, 
fmode_t
 
mode
, 
cmd
, 
¨g
)

191 
sblkdev_devi˚
 *
dev
 = 
bdev
->
bd_disk
->
¥iv©e_d©a
;

193 
	`¥_debug
("c⁄tﬁ comm™d [0x%x]Ñe˚ived\n", 
cmd
);

195 
cmd
) {

196 
HDIO_GETGEO
:

197  
	`io˘l_hdio_gëgeo
(
dev
, 
¨g
);

198 
CDROM_GET_CAPABILITY
:

199  -
EINVAL
;

201  -
ENOTTY
;

203 
	}
}

205 #ifde‡
CONFIG_COMPAT


206 
	$_com∑t_io˘l
(
block_devi˚
 *
bdev
, 
fmode_t
 
mode
, 
cmd
, 
¨g
)

209  -
ENOTTY
;

210 
	}
}

213 c⁄° 
block_devi˚_›î©i⁄s
 
	gf›s
 = {

214 .
ow√r
 = 
THIS_MODULE
,

215 .
	g›í
 = 
_›í
,

216 .
	gªÀa£
 = 
_ªÀa£
,

217 .
	gio˘l
 = 
_io˘l
,

218 #ifde‡
CONFIG_COMPAT


219 .
	gcom∑t_io˘l
 = 
_com∑t_io˘l
,

221 #i‚de‡
CONFIG_SBLKDEV_REQUESTS_BASED


222 .
	gsubmô_bio
 = 
_submô_bio
,

229 
	$sblkdev_ªmove
(
sblkdev_devi˚
 *
dev
)

231 
	`dñ_gídisk
(
dev
->
disk
);

233 #ifde‡
HAVE_BLK_MQ_ALLOC_DISK


234 #ifde‡
HAVE_BLK_CLEANUP_DISK


235 
	`blk_˛ónup_disk
(
dev
->
disk
);

237 
	`put_disk
(
dev
->
disk
);

240 
	`blk_˛ónup_queue
(
dev
->
disk
->
queue
);

241 
	`put_disk
(
dev
->
disk
);

244 #ifde‡
CONFIG_SBLKDEV_REQUESTS_BASED


245 
	`blk_mq_‰ì_èg_£t
(&
dev
->
èg_£t
);

247 
	`v‰ì
(
dev
->
d©a
);

249 
	`k‰ì
(
dev
);

251 
	`¥_öfo
("simple block device wasÑemoved\n");

252 
	}
}

254 #ifde‡
CONFIG_SBLKDEV_REQUESTS_BASED


255 
ölöe
 
	$öô_èg_£t
(
blk_mq_èg_£t
 *
£t
, *
d©a
)

257 
£t
->
›s
 = &
mq_›s
;

258 
£t
->
ƒ_hw_queues
 = 1;

259 
£t
->
ƒ_m≠s
 = 1;

260 
£t
->
queue_dïth
 = 128;

261 
£t
->
numa_node
 = 
NUMA_NO_NODE
;

262 
£t
->
Êags
 = 
BLK_MQ_F_SHOULD_MERGE
 | 
BLK_MQ_F_STACKING
;

264 
£t
->
cmd_size
 = 0;

265 
£t
->
drivî_d©a
 = 
d©a
;

268  
	`blk_mq_Æloc_èg_£t
(
£t
);

269 
	}
}

272 #i‚de‡
HAVE_BLK_MQ_ALLOC_DISK


273 
ölöe
 
gídisk
 *
	$blk_mq_Æloc_disk
(
blk_mq_èg_£t
 *
£t
,

274 *
queued©a
)

276 
gídisk
 *
disk
;

277 
ªque°_queue
 *
queue
;

279 
queue
 = 
	`blk_mq_öô_queue
(
£t
);

280 i‡(
	`IS_ERR
(
queue
)) {

281 
	`¥_îr
("FailedÅoállocate queue\n");

282  
	`ERR_PTR
(
	`PTR_ERR
(
queue
));

285 
queue
->
queued©a
 = queuedata;

286 
	`blk_queue_boun˚_limô
(
queue
, 
BLK_BOUNCE_HIGH
);

288 
disk
 = 
	`Æloc_disk
(1);

289 i‡(!
disk
)

290 
	`¥_îr
("FailedÅoállocate disk\n");

292 
disk
->
queue
 = queue;

294  
disk
;

295 
	}
}

298 #i‚de‡
HAVE_BLK_ALLOC_DISK


299 
ölöe
 
gídisk
 *
	$blk_Æloc_disk
(
node
)

301 
ªque°_queue
 *
q
;

302 
gídisk
 *
disk
;

304 
q
 = 
	`blk_Æloc_queue
(
node
);

305 i‡(!
q
)

306  
NULL
;

308 
disk
 = 
	`__Æloc_disk_node
(0, 
node
);

309 i‡(!
disk
) {

310 
	`blk_˛ónup_queue
(
q
);

311  
NULL
;

313 
disk
->
queue
 = 
q
;

315  
disk
;

316 
	}
}

322 
sblkdev_devi˚
 *
	$sblkdev_add
(
maj‹
, 
mö‹
, *
«me
,

323 
£˘‹_t
 
ˇ∑côy
)

325 
sblkdev_devi˚
 *
dev
 = 
NULL
;

326 
ªt
 = 0;

327 
gídisk
 *
disk
;

329 
	`¥_öfo
("add devi˚ '%s' c≠acôy %Œu se˘‹s\n", 
«me
, 
ˇ∑côy
);

331 
dev
 = 
	`kzÆloc
((
sblkdev_devi˚
), 
GFP_KERNEL
);

332 i‡(!
dev
) {

333 
ªt
 = -
ENOMEM
;

334 
Áû
;

337 
	`INIT_LIST_HEAD
(&
dev
->
lök
);

338 
dev
->
ˇ∑côy
 = capacity;

339 
dev
->
d©a
 = 
	`__vmÆloc
(
ˇ∑côy
 << 
SECTOR_SHIFT
, 
GFP_NOIO
 | 
__GFP_ZERO
);

340 i‡(!
dev
->
d©a
) {

341 
ªt
 = -
ENOMEM
;

342 
Áû_k‰ì
;

345 #ifde‡
CONFIG_SBLKDEV_REQUESTS_BASED


346 
ªt
 = 
	`öô_èg_£t
(&
dev
->
èg_£t
, dev);

347 i‡(
ªt
) {

348 
	`¥_îr
("FailedÅoállocateÅag set\n");

349 
Áû_v‰ì
;

356 
disk
 = 
	`blk_mq_Æloc_disk
(&
dev
->
èg_£t
, dev);

357 i‡(
	`u∆ikñy
(!
disk
)) {

358 
ªt
 = -
ENOMEM
;

359 
	`¥_îr
("FailedÅoállocate disk\n");

360 
Áû_‰ì_èg_£t
;

362 i‡(
	`IS_ERR
(
disk
)) {

363 
ªt
 = 
	`PTR_ERR
(
disk
);

364 
	`¥_îr
("FailedÅoállocate disk\n");

365 
Áû_‰ì_èg_£t
;

369 
disk
 = 
	`blk_Æloc_disk
(
NUMA_NO_NODE
);

370 i‡(!
disk
) {

371 
	`¥_îr
("FailedÅoállocate disk\n");

372 
ªt
 = -
ENOMEM
;

373 
Áû_v‰ì
;

377 
dev
->
disk
 = disk;

380 #ifde‡
GENHD_FL_NO_PART_SCAN


381 
disk
->
Êags
 |
GENHD_FL_NO_PART_SCAN
;

383 
disk
->
Êags
 |
GENHD_FL_NO_PART
;

389 
disk
->
maj‹
 = major;

390 
disk
->
fú°_mö‹
 = 
mö‹
;

391 
disk
->
mö‹s
 = 1;

393 
disk
->
f›s
 = &fops;

395 
disk
->
¥iv©e_d©a
 = 
dev
;

397 
	`•rötf
(
disk
->
disk_«me
, 
«me
);

398 
	`£t_ˇ∑côy
(
disk
, 
dev
->
ˇ∑côy
);

400 #ifde‡
CONFIG_SBLKDEV_BLOCK_SIZE


401 
	`blk_queue_physiˇl_block_size
(
disk
->
queue
, 
CONFIG_SBLKDEV_BLOCK_SIZE
);

402 
	`blk_queue_logiˇl_block_size
(
disk
->
queue
, 
CONFIG_SBLKDEV_BLOCK_SIZE
);

403 
	`blk_queue_io_mö
(
disk
->
queue
, 
CONFIG_SBLKDEV_BLOCK_SIZE
);

404 
	`blk_queue_io_›t
(
disk
->
queue
, 
CONFIG_SBLKDEV_BLOCK_SIZE
);

406 
	`blk_queue_physiˇl_block_size
(
disk
->
queue
, 
SECTOR_SIZE
);

407 
	`blk_queue_logiˇl_block_size
(
disk
->
queue
, 
SECTOR_SIZE
);

409 
	`blk_queue_max_hw_£˘‹s
(
disk
->
queue
, 
BLK_DEF_MAX_SECTORS
);

410 
	`blk_queue_Êag_£t
(
QUEUE_FLAG_NOMERGES
, 
disk
->
queue
);

414 #ifde‡
HAVE_ADD_DISK_RESULT


415 
ªt
 = 
	`add_disk
(
disk
);

416 i‡(
ªt
) {

417 
	`¥_îr
("FaûedÅÿadd disk '%s'\n", 
disk
->
disk_«me
);

418 
Áû_put_disk
;

421 
	`add_disk
(
disk
);

424 
	`¥_öfo
("Sim∂êblock devi˚ [%d:%d] wa†added\n", 
maj‹
, 
mö‹
);

426  
dev
;

428 #ifde‡
HAVE_ADD_DISK_RESULT


429 
Áû_put_disk
:

430 #ifde‡
HAVE_BLK_MQ_ALLOC_DISK


431 #ifde‡
HAVE_BLK_CLEANUP_DISK


432 
	`blk_˛ónup_disk
(
dev
->
disk
);

434 
	`put_disk
(
dev
->
disk
);

437 
	`blk_˛ónup_queue
(
dev
->
queue
);

438 
	`put_disk
(
dev
->
disk
);

442 #ifde‡
CONFIG_SBLKDEV_REQUESTS_BASED


443 
Áû_‰ì_èg_£t
:

444 
	`blk_mq_‰ì_èg_£t
(&
dev
->
èg_£t
);

446 
Áû_v‰ì
:

447 
	`v‰ì
(
dev
->
d©a
);

448 
Áû_k‰ì
:

449 
	`k‰ì
(
dev
);

450 
Áû
:

451 
	`¥_îr
("FailedÅoádd block device\n");

453  
	`ERR_PTR
(
ªt
);

454 
	}
}

	@Training/L3_dd_trg/blockdrv/sblkdev/device.h

3 
	~<löux/blk_ty≥s.h
>

4 
	~<löux/blkdev.h
>

5 
	~<löux/devi˚.h
>

6 
	~<löux/blk-mq.h
>

7 
	~<löux/li°.h
>

8 
	~"c⁄víõ¡.h
"

10 
	ssblkdev_devi˚
 {

11 
li°_hód
 
	mlök
;

13 
£˘‹_t
 
	mˇ∑côy
;

14 
u8
 *
	md©a
;

15 #ifde‡
CONFIG_SBLKDEV_REQUESTS_BASED


16 
blk_mq_èg_£t
 
	mèg_£t
;

18 
gídisk
 *
	mdisk
;

21 
sblkdev_devi˚
 *
sblkdev_add
(
maj‹
, 
mö‹
, *
«me
,

22 
£˘‹_t
 
ˇ∑côy
);

23 
sblkdev_ªmove
(
sblkdev_devi˚
 *
dev
);

	@Training/L3_dd_trg/blockdrv/sblkdev/main.c

3 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

5 
	~<löux/moduÀ.h
>

6 
	~"devi˚.h
"

8 #ifde‡
CONFIG_SBLKDEV_REQUESTS_BASED


9 #¥agm®
mesßge
("Request-based scheme selected.")

11 #¥agm®
mesßge
("Bio-based scheme selected.")

14 #ifde‡
CONFIG_SBLKDEV_BLOCK_SIZE


15 #¥agm®
mesßge
("Specific block size selected.")

18 #ifde‡
HAVE_BI_BDEV


19 #¥agm®
mesßge
("The struct bio haveÖointerÅo struct block_device.")

21 #ifde‡
HAVE_BI_BDISK


22 #¥agm®
mesßge
("The struct bio haveÖointerÅo struct gendisk.")

24 #ifde‡
HAVE_BLK_MQ_ALLOC_DISK


25 #¥agm®
mesßge
("The blk_mq_alloc_disk() function was found.")

27 #ifde‡
HAVE_ADD_DISK_RESULT


28 #¥agm®
mesßge
("The functionádd_disk() hasáÑeturn code.")

30 #ifde‡
HAVE_BDEV_BIO_ALLOC


31 #¥agm®
mesßge
("The function bio_alloc_bioset() hasáÖarameter bdev.")

33 #ifde‡
HAVE_BLK_CLEANUP_DISK


34 #¥agm®
mesßge
("The function blk_cleanup_disk() was found.")

36 #ifde‡
HAVE_GENHD_H


37 #¥agm®
mesßge
("The header file 'genhd.h' was found.")

48 
	gsblkdev_maj‹
;

49 
LIST_HEAD
(
sblkdev_devi˚_li°
);

50 *
	gsblkdev_ˇèlog
 = "sblkdev1,2048;sblkdev2,4096";

58 
__öô
 
	$sblkdev_öô
()

60 
ªt
 = 0;

61 
öx
 = 0;

62 *
ˇèlog
;

63 *
√xt_tokí
;

64 *
tokí
;

65 
size_t
 
Àngth
;

67 
sblkdev_maj‹
 = 
	`ªgi°î_blkdev
(sblkdev_maj‹, 
KBUILD_MODNAME
);

68 i‡(
sblkdev_maj‹
 <= 0) {

69 
	`¥_öfo
("UnableÅo get majorÇumber\n");

70  -
EBUSY
;

73 
Àngth
 = 
	`°æí
(
sblkdev_ˇèlog
);

74 i‡((
Àngth
 < 1Ë|| (Àngth > 
PAGE_SIZE
)) {

75 
	`¥_öfo
("Invalid moduleÖarameter 'catalog'\n");

76 
ªt
 = -
EINVAL
;

77 
Áû_uƒegi°î
;

80 
ˇèlog
 = 
	`kzÆloc
(
Àngth
 + 1, 
GFP_KERNEL
);

81 i‡(!
ˇèlog
) {

82 
ªt
 = -
ENOMEM
;

83 
Áû_uƒegi°î
;

85 
	`°r˝y
(
ˇèlog
, 
sblkdev_ˇèlog
);

87 
√xt_tokí
 = 
ˇèlog
;

88 (
tokí
 = 
	`°r£p
(&
√xt_tokí
, ";"))) {

89 
sblkdev_devi˚
 *
dev
;

90 *
«me
;

91 *
ˇ∑côy
;

92 
£˘‹_t
 
ˇ∑côy_vÆue
;

94 
«me
 = 
	`°r£p
(&
tokí
, ",");

95 i‡(!
«me
)

97 
ˇ∑côy
 = 
	`°r£p
(&
tokí
, ",");

98 i‡(!
ˇ∑côy
)

101 
ªt
 = 
	`k°πouŒ
(
ˇ∑côy
, 10, &
ˇ∑côy_vÆue
);

102 i‡(
ªt
)

105 
dev
 = 
	`sblkdev_add
(
sblkdev_maj‹
, 
öx
, 
«me
, 
ˇ∑côy_vÆue
);

106 i‡(
	`IS_ERR
(
dev
)) {

107 
ªt
 = 
	`PTR_ERR
(
dev
);

111 
	`li°_add
(&
dev
->
lök
, &
sblkdev_devi˚_li°
);

112 
öx
++;

114 
	`k‰ì
(
ˇèlog
);

116 
	`¥_öfo
("registered\n");

117 i‡(
ªt
 == 0)

120 
Áû_uƒegi°î
:

121 
	`uƒegi°î_blkdev
(
sblkdev_maj‹
, 
KBUILD_MODNAME
);

122  
ªt
;

123 
	}
}

131 
__exô
 
	$sblkdev_exô
()

133 
sblkdev_devi˚
 *
dev
;

135 (
dev
 = 
	`li°_fú°_íåy_‹_nuŒ
(&
sblkdev_devi˚_li°
,

136 
sblkdev_devi˚
, 
lök
))) {

137 
	`li°_dñ
(&
dev
->
lök
);

138 
	`sblkdev_ªmove
(
dev
);

141 i‡(
sblkdev_maj‹
 > 0)

142 
	`uƒegi°î_blkdev
(
sblkdev_maj‹
, 
KBUILD_MODNAME
);

143 
	}
}

145 
moduÀ_öô
(
sblkdev_öô
);

146 
moduÀ_exô
(
sblkdev_exô
);

148 
moduÀ_∑øm_«med
(
ˇèlog
, 
sblkdev_ˇèlog
, 
ch¨p
, 0644);

149 
MODULE_PARM_DESC
(
ˇèlog
, "New block devices catalog in format '<name>,<capacity sectors>;...'");

151 
MODULE_LICENSE
("GPL");

152 
MODULE_AUTHOR
("Sergei Shtepa");

	@Training/L3_dd_trg/convenient.h

9 #i‚de‡
__CONVENIENT_H__


10 
	#__CONVENIENT_H__


	)

12 
	~<asm/∑øm.h
>

13 
	~<löux/sched.h
>

15 #ifde‡
__KERNEL__


16 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_BUFFER


47 #ifde‡
USE_FTRACE_BUFFER


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
 = 1; \

53 i‡(
USE_RATELIMITING
) { \

54 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

57 
	`¥_öfo
(
°rög
, ##
¨gs
); \

58 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 #i‚de‡
USE_FTRACE_BUFFER


89 
	#QPDS
 do { \

90 
	`MSG
("\n"); \

91 
	`dump_°ack
(); \

92 } 0)

	)

94 
	#QPDS
 do { \

95 
	`MSG
("\n"); \

96 
	`åa˚_dump_°ack
(); \

97 } 0)

	)

101 #ifde‡
__KERNEL__


102 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

103 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

104 } 0)

	)

107 
	#MSG
(
°rög
, 
¨gs
...)

	)

108 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

109 
	#QP


	)

110 
	#QPDS


	)

118 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

119 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

120 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

121 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

122 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

124 #ifde‡
__KERNEL__


145 
	~<löux/sched.h
>

146 
	~<löux/öãºu±.h
>

148 
	#PRINT_CTX
() do { \

149 
PRINTCTX_SHOWHDR
 = 0; \

150 
öå
 = '.'; \

151 i‡(!
	`ö_èsk
()) { \

152 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

153 
öå
 = 'H'; \

154 i‡(
	`ö_úq
()) \

155 
öå
 = 'h'; \

156 i‡(
	`ö_so·úq
()) \

157 
öå
 = 's'; \

160 
öå
 = '.'; \

162 i‡(
PRINTCTX_SHOWHDR
 == 1) \

163 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

164 
	`¥_debug
( \

168 , 
	`smp_¥o˚ss‹_id
(), \

169 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

170 (
	`úqs_dißbÀd
()?'d':'.'), \

171 (
	`√ed_ªsched
()?'N':'.'), \

172 
öå
, \

173 (
	`¥ìm±_cou¡
() && 0xff), \

174 
__func__
 \

176 } 0)

	)

191 #ifde‡
__KERNEL__


192 
	#as£π
(
ex¥
) do { \

193 i‡(!(
ex¥
)) { \

194 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

195 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

197 } 0)

	)

201 
ölöe
 
	$bìp
(
wh©
)

203 #ifde‡
__KERNEL__


204 
	`¥_öfo
("%c", ()
wh©
);

206 
	~<uni°d.h
>

207 
buf
 = ()
wh©
;

208 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

210 
	}
}

219 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

221 
c
 = 0, 
m
; \

222 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

224 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

225 
	`bìp
((
vÆ
)); \

226 
c
++; \

227 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

228 
m
 = 0; m < 50; m++); \

229 
x
 = 
ö√r_ödex
 / 2; \

233 }

	)

236 #ifde‡
__KERNEL__


237 
dñay_£c
();

245 
	$dñay_£c
(
vÆ
)

247 
	`asm
 ("");

248 i‡(
	`ö_èsk
()) {

249 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

250 i‡(-1 =
vÆ
)

251 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

253 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

255 
	}
}

	@Training/L3_dd_trg/cz_chardrv/badcdrv/app_badread.c

8 
	~<°dio.h
>

9 
	~<uni°d.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<limôs.h
>

12 
	~<sys/°©.h
>

13 
	~<f˙é.h
>

14 
	~<sig«l.h
>

15 
	~<°dlib.h
>

16 
	~<°rög.h
>

18 
	#FLGS
 
O_RDONLY


	)

19 
	#DMODE
 0

	)

20 
	#SZ
 1024

	)

22 
	$sig
–
signum
 )

24 
	`Ârötf
 (
°dîr
,"I¿sig: signum=%d\n", 
signum
);

25 
	}
}

27 
	$maö
(
¨gc
, **
¨gv
)

29 
fd
=-1,
n
=0;

30 
siga˘i⁄
 
a˘
;

31 
size_t
 
num
=0;

32 
de°_addr
=0x0;

33 
FILE
 *
Â1
=
NULL
, *
Â2
=NULL;

34 
cmd1
[128], 
cmd2
[128], 
sAddr
[16], 
sVMA
[128];

36 if–
¨gc
 != 3 ) {

37 
	`Ârötf
(
°dîr
,"Ußge: %†devi˚_fûênum_byãs_to_ªad\n", 
¨gv
[0]);

38 
	`exô
(1);

41 
a˘
.
ß_h™dÀr
 = 
sig
;

42 
a˘
.
ß_Êags
 = 
SA_RESTART
;

43 
	`sigem±y£t
 (&
a˘
.
ß_mask
);

44 i‡((
	`siga˘i⁄
 (
SIGINT
, &
a˘
, 0)) == -1) {

45 
	`≥º‹
("siga˘i⁄"), 
	`exô
 (1);

48 if–(
fd
=
	`›í
(
¨gv
[1],
FLGS
,
DMODE
)) == -1)

49 
	`≥º‹
("›í"),
	`exô
(1);

50 
	`¥ötf
("%s: PID %d.\n",
¨gv
[0], 
	`gëpid
());

52 
num
 = 
	`©oi
(
¨gv
[2]);

53 i‡((
num
 < 0Ë|| (num > 
INT_MAX
)) {

54 
	`Ârötf
(
°dîr
,"%s:Çumbî o‡byã†'%ld' invÆid.\n", 
¨gv
[0], 
num
);

55 
	`˛o£
 (
fd
);

56 
	`exô
 (1);

67 
	`¢¥ötf
 (
cmd1
, 128, "gª∞'^........-' /¥oc/%d/m≠†|cuà-f1 -d' '|cuà-f1 -d'-'", 
	`gëpid
());

68 
Â1
 = 
	`p›í
 (
cmd1
, "r");

70 
	`¢¥ötf
 (
cmd2
, 128, "ˇà/¥oc/%d/m≠s", 
	`gëpid
());

71 
Â2
 = 
	`p›í
 (
cmd2
, "r");

73 i‡(!
Â1
 || !
Â2
) {

74 
	`≥º‹
("popen");

75 
	`˛o£
 (
fd
);

76 
	`exô
 (1);

79 
	`fgës
 (
sAddr
, 16, 
Â1
)) {

80 
	`fgës
 (
sVMA
, 128, 
Â2
);

81 
sVMA
[
	`°æí
(sVMA)-1]='\0';

82 
	`¥ötf
("\nVMA: %s\n", 
sVMA
);

83 
sAddr
[
	`°æí
(sAddr)-1]='\0';

84 
de°_addr
 = 
	`°πﬁl
 (
sAddr
, 
NULL
, 16) + 0x500;

85 
	`¥ötf
("sAdd∏%†de°_add∏0x%08x\n", 
sAddr
, ()
de°_addr
);

87 
n
 = 
	`ªad
 (
fd
, (*)
de°_addr
, 
num
);

88 if–
n
 < 0 )

89 
	`≥º‹
("read failed");

91 
	`¥ötf
("ªad %d byãs\n", 
n
);

95 
	`p˛o£
 (
Â1
);

96 
	`p˛o£
 (
Â2
);

97 
	`˛o£
(
fd
);

98 
	`exô
(0);

99 
	}
}

	@Training/L3_dd_trg/cz_chardrv/badcdrv/badcdrv.c

4 
	~<löux/öô.h
>

5 
	~<löux/kî√l.h
>

6 
	~<löux/moduÀ.h
>

7 
	~<löux/devi˚.h
>

8 
	~<löux/sched.h
>

9 
	~<löux/fs.h
>

10 
	~<löux/¶ab.h
>

13 
	~<löux/vîsi⁄.h
>

14 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4,11,0)

15 
	~<löux/uac˚ss.h
>

17 
	~<asm/uac˚ss.h
>

20 
	~<löux/cdev.h
>

22 
	#DRVNAME
 "badcdrv"

23 
	#DRV_MINOR_START
 0

	)

24 
	#DRV_COUNT
 1

25 
	#DEVICE_FILE
 "/dev/cdrv"

	)

27 #ifde‡
DEBUG


28 
	#MSG
(
°rög
, 
¨gs
...Ë\

	)

29 
¥ötk
(
KERN_DEBUG
 "%s:%s:%d: " 
°rög
, \

30 
DRVNAME
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

32 
	#MSG
(
°rög
, 
¨gs
...)

	)

35 
dev_t
 
	gch¨drv_dev_numbî
;

36 
	sch¨drv_dev
 {

37 
	m«me
[10];

38 
cdev
 
	mcdev
;

39 } *
	gch¨drv_devp
;

40 
˛ass
 *
	gch¨drv_˛ass
=
NULL
;

43 
ssize_t
 
	$badªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
,

44 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

46 *
kbuf
=
NULL
;

47 
ªt
 = 
cou¡
;

49 i‡(
cou¡
 > 
PAGE_SIZE
)

50 
cou¡
 = 
PAGE_SIZE
;

52 
	`MSG
("\n-----PID %d. userspace destáddr = %pK (0x%lx)\n",

53 
cuºít
->
tgid
, 
buf
, ()buf);

54 
kbuf
 = 
	`kmÆloc
 (
cou¡
, 
GFP_KERNEL
);

55 i‡(!
kbuf
) {

56 
ªt
 = -
ENOMEM
;

57 
out_mem_Áûed
;

64 i‡(!
	`ac˚ss_ok
 (
VERIFY_WRITE
, 
buf
, 
cou¡
)) {

65 
	`¥ötk
(
KERN_ALERT
 "%s:%s:ac˚ss_ok check faûed!\n", 
DRVNAME
, 
__func__
);

66 
ªt
 = -
EFAULT
;

67 
out_c›y_Áûed
;

69 
	`MSG
("áccess_ok checkÖassed.\n");

71 
ªt
 = 
	`c›y_to_u£r
 (
buf
, 
kbuf
, 
cou¡
);

72 i‡(
ªt
) {

73 
	`¥ötk
(
KERN_ALERT
 "%s:%s:c›y_to_u£∏Áûed!Ñë=%d\n", 
DRVNAME
, 
__func__
, 
ªt
);

74 
ªt
 = -
EIO
;

75 
out_c›y_Áûed
;

77 
	`MSG
(" c›y_to_u£∏tÿ0x%08x suc˚eded!\n", ()
buf
);

79 
ªt
 = 
cou¡
;

80 
out_c›y_Áûed
:

81 
	`k‰ì
 (
kbuf
);

82 
out_mem_Áûed
:

83  
ªt
;

84 
	}
}

87 
fûe_›î©i⁄s
 
	gdrv_f›s
 = {

88 .
Œ£ek
 = 
no_Œ£ek
,

89 .
	gªad
 = 
badªad
,

93 
	$cdrv_›í
(
öode
 * inode, 
fûe
 * 
fûp
)

95 
	`MSG
–"Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

97 
	`imö‹
(
öode
)) {

99 
fûp
->
f_›
 = &
drv_f›s
;

102  -
ENXIO
;

104 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

105  
fûp
->
f_›
->
	`›í
(
öode
,filp);

107 
	}
}

110 
fûe_›î©i⁄s
 
	gcdrv_›í_f›s
 = {

111 .
›í
 = 
cdrv_›í
,

115 
	$ch¨dev_ªgi°øti⁄
()

117 
ªs
=0,
i
=0;

119 
ªs
 = 
	`Æloc_chrdev_ªgi⁄
(&
ch¨drv_dev_numbî
, 
DRV_MINOR_START
, 
DRV_COUNT
, 
DEVICE_FILE
);

120 i‡(
ªs
) {

121 
	`¥ötk
(
KERN_WARNING
 "%s: couldÇŸáŒoˇã devi˚\n", 
DRVNAME
);

122  
ªs
;

124 
	`¥ötk
 (
KERN_INFO
 "%s:Ñegi°îed wôh maj‹Çumbî %d\n", 
DRVNAME
, 
	`MAJOR
(
ch¨drv_dev_numbî
));

127 
ch¨drv_devp
 = 
	`kmÆloc
(
DRV_COUNT
 * (
ch¨drv_dev
), 
GFP_KERNEL
);

128 i‡(
NULL
 =
ch¨drv_devp
) {

129  -
ENOMEM
;

132 
	`mem£t
(
ch¨drv_devp
, 0, 
DRV_COUNT
 * (
ch¨drv_dev
));

133 
i
 = 0 ; i < 
DRV_COUNT
; i++) {

134 
	`cdev_öô
 (&
ch¨drv_devp
[
i
].
cdev
, &
cdrv_›í_f›s
);

135 
ch¨drv_devp
[
i
].
cdev
.
ow√r
 = 
THIS_MODULE
;

136 
ch¨drv_devp
[
i
].
cdev
.
›s
 = &
cdrv_›í_f›s
;

137 
ªs
 = 
	`cdev_add
 (&
ch¨drv_devp
[
i
].
cdev
, 
	`MKDEV
(
	`MAJOR
(
ch¨drv_dev_numbî
), 
	`MINOR
(chardrv_dev_number)+i), 1);

138 i‡(
ªs
) {

139 
	`¥ötk
(
KERN_NOTICE
 "%s: Eº‹ o¿cdev_add f‹ %d\n", 
DRVNAME
, 
ªs
);

141 
	`¥ötk
(
KERN_INFO
 "%s: cdev %s.%dádded\n", 
DRVNAME
, DRVNAME, 
i
);

149 
ch¨drv_˛ass
 = 
	`˛ass_¸óã
 (
THIS_MODULE
, 
DRVNAME
);

150  
i
 = 0 ; i < 
DRV_COUNT
; i++) {

151 i‡(!
	`devi˚_¸óã
(
ch¨drv_˛ass
, 
NULL
, 
	`MKDEV
(
	`MAJOR
(
ch¨drv_dev_numbî
), 
	`MINOR
(ch¨drv_dev_numbî)+
i
),

152 
NULL
, "%s.%d", 
DRVNAME
, 
i
)) {

153 
	`¥ötk
(
KERN_NOTICE
 "%s: Eº‹ cª©ög devi˚Çodê/dev/%s.%d !\n", 
DRVNAME
, DRVNAME, 
i
);

156 
	`¥ötk
(
KERN_INFO
 " %s: Devi˚Çodê/dev/%s.%d cª©ed.\n", 
DRVNAME
, DRVNAME, 
i
);

159  
ªs
;

160 
	}
}

163 
__öô
 
	$cdrv_öô_moduÀ
()

165 
	`ch¨dev_ªgi°øti⁄
();

167 
	}
}

169 
__exô
 
	$cdrv_˛ónup_moduÀ
()

171 
i
=0;

174 
i
=0; i<
DRV_COUNT
; i++) {

175 
	`cdev_dñ
(&
ch¨drv_devp
[
i
].
cdev
);

176 
	`devi˚_de°roy
(
ch¨drv_˛ass
, 
	`MKDEV
(
	`MAJOR
(
ch¨drv_dev_numbî
), 
	`MINOR
(ch¨drv_dev_numbî)+
i
));

178 
	`˛ass_de°roy
(
ch¨drv_˛ass
);

179 
	`k‰ì
(
ch¨drv_devp
);

180 
	`uƒegi°î_chrdev_ªgi⁄
(
ch¨drv_dev_numbî
, 
DRV_COUNT
);

181 
	`MSG
("Unregistered.\n");

182 
	}
}

184 
moduÀ_öô
(
cdrv_öô_moduÀ
);

185 
moduÀ_exô
(
cdrv_˛ónup_moduÀ
);

187 
MODULE_AUTHOR
("Me !");

188 
MODULE_DESCRIPTION
("Test illegal memoryáccesses (write) from char driver.");

189 
MODULE_LICENSE
("GPL");

	@Training/L3_dd_trg/cz_chardrv/cz.c

24 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

26 
	~<löux/kî√l.h
>

27 
	~<löux/moduÀ.h
>

28 
	~<löux/öô.h
>

29 
	~<löux/sched.h
>

30 
	~<löux/fs.h
>

31 
	~<löux/¶ab.h
>

34 
	~<löux/vîsi⁄.h
>

35 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

36 
	~<löux/uac˚ss.h
>

38 
	~<asm/uac˚ss.h
>

41 
	#CZ_MAJOR
 0

	)

42 
	#MAX_READ_COUNT
 
PAGE_SIZE


	)

44 
	gcz_maj‹
 = 
CZ_MAJOR
;

56 
ssize_t
 
	$czîo_ªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
,

57 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

59 *
zbuf
;

60 
°©us
;

63 i‡(
cou¡
 > 
MAX_READ_COUNT
)

64 
cou¡
 = 
MAX_READ_COUNT
;

66 
zbuf
 = 
	`kzÆloc
(
cou¡
, 
GFP_KERNEL
);

67 i‡(
	`u∆ikñy
(
zbuf
 =
NULL
)) {

68 
°©us
 = -
ENOMEM
;

69 
out_no_mem
;

75 
	`¥_debug
("process %s [pid %d]ÅoÑead %zu bytes\n",

76 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
);

78 i‡(
	`c›y_to_u£r
(
buf
, 
zbuf
, 
cou¡
)) {

79 
°©us
 = -
EFAULT
;

80 
out_c›y_îr
;

83 
°©us
 = 
cou¡
;

85 
out_c›y_îr
:

86 
	`k‰ì
(
zbuf
);

87 
out_no_mem
:

88  
°©us
;

89 
	}
}

91 
ssize_t
 
	$czîo_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
,

92 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

94 
	`¥_debug
("process %s [pid %d], count=%zu\n",

95 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
);

96  -
ENOSYS
;

97 
	}
}

104 
ssize_t
 
	$˙ul_ªad
(
fûe
 *
fûp
, 
__u£r
 * 
buf
,

105 
size_t
 
cou¡
, 
loff_t
 * 
ofÂ
)

107 
	`¥_debug
("process %s [pid %d], count=%zu\n",

108 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
);

119 
	}
}

125 
ssize_t
 
	$˙ul_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 * 
buf
,

126 
size_t
 
cou¡
, 
loff_t
 * 
ofÂ
)

128 
	`¥_debug
("process %s [pid %d], count=%zu\n\tjiffies=%lu\n",

129 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
, 
jiffõs
);

130  
cou¡
;

132 
	}
}

139 c⁄° 
fûe_›î©i⁄s
 
	gczîo_f›s
 = {

140 .
Œ£ek
 = 
no_Œ£ek
,

141 .
	gªad
 = 
czîo_ªad
,

142 .
	gwrôe
 = 
czîo_wrôe
,

145 c⁄° 
fûe_›î©i⁄s
 
	g˙ul_f›s
 = {

146 .
Œ£ek
 = 
no_Œ£ek
,

147 .
	gªad
 = 
˙ul_ªad
,

148 .
	gwrôe
 = 
˙ul_wrôe
,

151 
	$cz_›í
(
öode
 *öode, 
fûe
 *
fûp
)

153 
	`¥_debug
("Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

155 
	`imö‹
(
öode
)) {

157 
fûp
->
f_›
 = &
czîo_f›s
;

160 
fûp
->
f_›
 = &
˙ul_f›s
;

163  -
ENXIO
;

165 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

166  
fûp
->
f_›
->
	`›í
(
öode
, filp);

172 
	}
}

178 c⁄° 
fûe_›î©i⁄s
 
	gcz›í_f›s
 = {

179 .
›í
 = 
cz_›í
,

189 
__öô
 
	$cz_öô_moduÀ
()

191 
ªsu…
;

193 
	`¥_debug
("cz_maj‹=%d\n", 
cz_maj‹
);

199 
ªsu…
 = 
	`ªgi°î_chrdev
(
cz_maj‹
, 
KBUILD_MODNAME
, &
cz›í_f›s
);

200 i‡(
ªsu…
 < 0) {

201 
	`¥_öfo
("register_chrdev() failedÅryingÅo get cz_major=%d\n",

202 
cz_maj‹
);

203  
ªsu…
;

206 i‡(
cz_maj‹
 == 0)

207 
cz_maj‹
 = 
ªsu…
;

208 
	`¥_öfo
("ªgi°îed:: cz_maj‹=%d\n", 
cz_maj‹
);

211 
	}
}

213 
__exô
 
	$cz_˛ónup_moduÀ
()

215 
	`uƒegi°î_chrdev
(
cz_maj‹
, 
KBUILD_MODNAME
);

216 
	`¥_öfo
("Unregistered.\n");

217 
	}
}

219 
moduÀ_öô
(
cz_öô_moduÀ
);

220 
moduÀ_exô
(
cz_˛ónup_moduÀ
);

222 
moduÀ_∑øm
(
cz_maj‹
, , 0);

224 
MODULE_PARM_DESC
(
cz_maj‹
, "MajorÇumberÅoáttemptÅo use");

225 
MODULE_AUTHOR
("Kaiwan");

226 
MODULE_DESCRIPTION
("Simple (demo)Çullánd zero memory driver driver");

227 
MODULE_LICENSE
("GPL");

	@Training/L3_dd_trg/cz_chardrv/cz.mod.c

1 
	~<löux/moduÀ.h
>

2 
	#INCLUDE_VERMAGIC


	)

3 
	~<löux/buûd-ß….h
>

4 
	~<löux/ñ‚Ÿe-…o.h
>

5 
	~<löux/vîmagic.h
>

6 
	~<löux/compûî.h
>

8 
	gBUILD_SALT
;

9 
	gBUILD_LTO_INFO
;

11 
MODULE_INFO
(
vîmagic
, 
VERMAGIC_STRING
);

12 
MODULE_INFO
(
«me
, 
KBUILD_MODNAME
);

14 
__visibÀ
 
moduÀ
 
__this_moduÀ


15 
__£˘i⁄
(".gnu.linkonce.this_module") = {

16 .
«me
 = 
KBUILD_MODNAME
,

17 .
	göô
 = 
öô_moduÀ
,

18 #ifde‡
CONFIG_MODULE_UNLOAD


19 .
	gexô
 = 
˛ónup_moduÀ
,

21 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

24 #ifde‡
CONFIG_RETPOLINE


25 
MODULE_INFO
(
ªçﬁöe
, "Y");

28 c⁄° 
modvîsi⁄_öfo
 
	g____vîsi⁄s
[]

29 
__u£d
 
__£˘i⁄
("__versions") = {

47 
MODULE_INFO
(
dïíds
, "");

50 
MODULE_INFO
(
§cvîsi⁄
, "6179331B87C9EC548DCC5C3");

	@Training/L3_dd_trg/cz_chardrv/cz_enh.c

17 
	~<löux/kî√l.h
>

18 
	~<löux/moduÀ.h
>

19 
	~<löux/öô.h
>

20 
	~<löux/sched.h
>

21 
	~<löux/fs.h
>

22 
	~<löux/vîsi⁄.h
>

23 
	~<löux/¶ab.h
>

26 
	~<löux/vîsi⁄.h
>

27 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

28 
	~<löux/uac˚ss.h
>

30 
	~<asm/uac˚ss.h
>

33 
	#DRVNAME
 "cz_íh"

	)

34 
	#CZ_MAJOR
 0

	)

37 
	gcz_maj‹
 = 
CZ_MAJOR
;

60 
ssize_t
 
	$czîo_ªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
,

61 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

63 *
zbuf
;

64 
buf_to
 = 0;

65 
mcou¡
 = 
cou¡
, 
i
 = 0, 
lo›cou¡
, 
ªm
 = 0, 
°©us
 = count;

70 
	`¥_debug
("process %s [pid %d]ÅoÑead %zu bytes; buf=0x%lx\n",

71 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
, ()
buf
);

73 i‡(
cou¡
 > 
PAGE_SIZE
)

74 
mcou¡
 = 
PAGE_SIZE
;

81 #i‡
LINUX_VERSION_CODE
 > 
	`KERNEL_VERSION
(2, 6, 14)

82 
zbuf
 = 
	`kzÆloc
(
mcou¡
, 
GFP_KERNEL
);

83 i‡(
zbuf
 =
NULL
) {

85 
zbuf
 = 
	`kmÆloc
(
mcou¡
, 
GFP_KERNEL
);

86 i‡(
zbuf
 =
NULL
) {

88 
°©us
 = -
ENOMEM
;

89 
out_no_mem
;

91 #i‡
LINUX_VERSION_CODE
 <
	`KERNEL_VERSION
(2, 6, 14)

92 
	`mem£t
(
zbuf
, 0, 
mcou¡
);

95 
	#FILL_PATTERN
 0

	)

96 #i‡(
FILL_PATTERN
 == 1)

97 
i
 = 0; i < 
mcou¡
 / 4; i++) {

98 
zbuf
[(
i
 * 4) + 0] = 0xce;

99 
zbuf
[(
i
 * 4) + 1] = 0xfa;

100 
zbuf
[(
i
 * 4) + 2] = 0xad;

101 
zbuf
[(
i
 * 4) + 3] = 0xde;

103 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_OFFSET
, 
zbuf
, 
mcou¡
 / 4);

106 
lo›cou¡
 = 
cou¡
 / 
PAGE_SIZE
;

107 
	`¥_debug
("lo›cou¡=%d\n", 
lo›cou¡
);

109 
i
 = 0; i < 
lo›cou¡
; i++) {

110 
buf_to
 = ()
buf
 + (
i
 * 
PAGE_SIZE
);

111 
	`¥_debug
("%d: buf_tÿloc=0x%lx\n", 
i
, 
buf_to
);

112 i‡(
	`c›y_to_u£r
((*)
buf_to
, 
zbuf
, 
mcou¡
)) {

113 
°©us
 = -
EFAULT
;

114 
out
;

116 
	`c⁄d_ªsched
();

118 #i‚de‡
CONFIG_PREEMPT


119 i‡((!(
i
 % 100))

121 
	`u∆ikñy
(
	`ã°_tsk_thªad_Êag
(
cuºít
, 
TIF_NEED_RESCHED
)))

122 
	`scheduÀ
();

128 
ªm
 = 
cou¡
 % 
PAGE_SIZE
;

129 
	`¥_debug
("ªm=%d\n", 
ªm
);

130 i‡(!
ªm
)

131 
out
;

133 
buf_to
 = ()
buf
 + (
i
 * 
PAGE_SIZE
);

134 
	`¥_debug
("%d: buf_tÿloc=0x%lx\n", 
i
, 
buf_to
);

135 i‡(
	`c›y_to_u£r
((*)
buf_to
, 
zbuf
, 
ªm
)) {

136 
°©us
 = -
EFAULT
;

137 
out
;

139 
out
:

140 
	`k‰ì
(
zbuf
);

141 
out_no_mem
:

142  
°©us
;

143 
	}
}

145 
ssize_t
 
	$czîo_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
,

146 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

148 
	`¥_debug
("process %s [pid %d], count=%zu\n",

149 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
);

150  -
ENOSYS
;

151 
	}
}

157 
ssize_t
 
	$˙ul_ªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
,

158 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

160 
	`¥_debug
("process %s [pid %d], count=%zu\n",

161 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
);

172 
	}
}

174 
ssize_t
 
	$˙ul_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
,

175 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

177 
	`¥_debug
("process %s [pid %d], count=%zu\n\tjiffies=%lu\n",

178 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
, 
jiffõs
);

179  
cou¡
;

181 
	}
}

184 c⁄° 
fûe_›î©i⁄s
 
	gczîo_f›s
 = {

185 .
Œ£ek
 = 
no_Œ£ek
,

186 .
	gªad
 = 
czîo_ªad
,

187 .
	gwrôe
 = 
czîo_wrôe
,

190 c⁄° 
fûe_›î©i⁄s
 
	g˙ul_f›s
 = {

191 .
Œ£ek
 = 
no_Œ£ek
,

192 .
	gªad
 = 
˙ul_ªad
,

193 .
	gwrôe
 = 
˙ul_wrôe
,

196 
	$cz_›í
(
öode
 *öode, 
fûe
 *
fûp
)

198 
	`¥_öfo
("Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

200 
	`imö‹
(
öode
)) {

202 
fûp
->
f_›
 = &
czîo_f›s
;

205 
fûp
->
f_›
 = &
˙ul_f›s
;

208  -
ENXIO
;

210 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

211  
fûp
->
f_›
->
	`›í
(
öode
, filp);

216 
	}
}

219 c⁄° 
fûe_›î©i⁄s
 
	gcz›í_f›s
 = {

220 .
›í
 = 
cz_›í
,

230 
__öô
 
	$cz_öô_moduÀ
()

232 
ªsu…
;

234 
	`¥_debug
("cz_maj‹=%d\n", 
cz_maj‹
);

240 
ªsu…
 = 
	`ªgi°î_chrdev
(
cz_maj‹
, 
DRVNAME
, &
cz›í_f›s
);

241 i‡(
ªsu…
 < 0) {

242 
	`¥_öfo
("register_chrdev() failedÅryingÅo get cz_major=%d\n",

243 
cz_maj‹
);

244  
ªsu…
;

247 i‡(
cz_maj‹
 == 0)

248 
cz_maj‹
 = 
ªsu…
;

249 
	`¥_öfo
("ªgi°îed:: cz_maj‹=%d\n", 
cz_maj‹
);

252 
	}
}

254 
__exô
 
	$cz_˛ónup_moduÀ
()

256 
	`uƒegi°î_chrdev
(
cz_maj‹
, 
DRVNAME
);

257 
	`¥_öfo
("Unregistered.\n");

258 
	}
}

260 
moduÀ_öô
(
cz_öô_moduÀ
);

261 
moduÀ_exô
(
cz_˛ónup_moduÀ
);

263 
moduÀ_∑øm
(
cz_maj‹
, , 0);

265 
MODULE_PARM_DESC
(
cz_maj‹
, "MajorÇumberÅoáttemptÅo use");

266 
MODULE_AUTHOR
("Kaiwan");

267 
MODULE_DESCRIPTION
("Simple (demo)Çullánd zero memory driver driver");

268 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L3_dd_trg/cz_chardrv/cz_enh.mod.c

1 
	~<löux/moduÀ.h
>

2 
	#INCLUDE_VERMAGIC


	)

3 
	~<löux/buûd-ß….h
>

4 
	~<löux/ñ‚Ÿe-…o.h
>

5 
	~<löux/vîmagic.h
>

6 
	~<löux/compûî.h
>

8 
	gBUILD_SALT
;

9 
	gBUILD_LTO_INFO
;

11 
MODULE_INFO
(
vîmagic
, 
VERMAGIC_STRING
);

12 
MODULE_INFO
(
«me
, 
KBUILD_MODNAME
);

14 
__visibÀ
 
moduÀ
 
__this_moduÀ


15 
__£˘i⁄
(".gnu.linkonce.this_module") = {

16 .
«me
 = 
KBUILD_MODNAME
,

17 .
	göô
 = 
öô_moduÀ
,

18 #ifde‡
CONFIG_MODULE_UNLOAD


19 .
	gexô
 = 
˛ónup_moduÀ
,

21 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

24 #ifde‡
CONFIG_RETPOLINE


25 
MODULE_INFO
(
ªçﬁöe
, "Y");

28 c⁄° 
modvîsi⁄_öfo
 
	g____vîsi⁄s
[]

29 
__u£d
 
__£˘i⁄
("__versions") = {

51 
MODULE_INFO
(
dïíds
, "");

54 
MODULE_INFO
(
§cvîsi⁄
, "3EFAE42AC574102CCFDE993");

	@Training/L3_dd_trg/cz_chardrv/mmap_cz/cz_mmap.c

22 
	~<löux/kî√l.h
>

23 
	~<löux/moduÀ.h
>

24 
	~<löux/öô.h
>

25 
	~<löux/sched.h
>

26 
	~<löux/fs.h
>

27 
	~<löux/vîsi⁄.h
>

28 
	~<löux/¶ab.h
>

29 
	~<löux/mm.h
>

32 
	~<löux/vîsi⁄.h
>

33 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4,11,0)

34 
	~<löux/uac˚ss.h
>

36 
	~<asm/uac˚ss.h
>

39 
	~<asm/io.h
>

40 
	~"../../c⁄víõ¡.h
"

42 
	#DRVNAME
 "cz_mm≠"

	)

43 
	#CZ_MAJOR
 0

	)

45 
	gcz_maj‹
 = 
CZ_MAJOR
;

53 *
	gzbuf
=
NULL
;

54 
	$czîo_›í
(
öode
 *öode, 
fûe
 *
fûp
)

56 
QP
;

58 
	}
}

59 
	$czîo_˛o£
(
öode
 *öode, 
fûe
 *
fûp
)

61 
QP
;

62 i‡(
zbuf
)

63 
	`MSG
("zbufÇon-null\n");

65 
	`MSG
("zbufÇull\n");

66 i‡(
zbuf
) {

67 
	`k‰ì
 (
zbuf
);

68 
zbuf
 = 
NULL
;

71 
	}
}

73 
ssize_t
 
	$czîo_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
,

74 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

76 
	`MSG
( "process %s [pid %d], count=%ld\n",

77 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
);

78  -
ENOSYS
;

79 
	}
}

81 
	#MAX_MMAP_PAGES
 3

82 
	`czîo_mm≠
(
fûe
 *
fûp
, 
vm_¨ó_°ru˘
 *
vma
)

	)

84 
	gÀn
=
vma
->
vm_íd
 - vma->
vm_°¨t
, 
	g°©us
=0;

85 
	gQP
;

87 
k‰ì
 (
zbuf
);

88 
	gzbuf
=
NULL
;

90 
MSG
("vma: start=0x%08xÉnd=0x%08xÜen=%dÖgoff=%lu\n",

91 (
u32
)
vma
->
vm_°¨t
, (u32)vma->
vm_íd
, 
Àn
, vma->
vm_pgoff
);

96 i‡(
	gÀn
 > (
MAX_MMAP_PAGES
*
	gPAGE_SIZE
)) {

97 
MSG
("mm≠ÜígthÅoÿœrge! (¨tificü»max o‡%dÖage†hîe)\n", 
MAX_MMAP_PAGES
);

98 i‡(
	gzbuf
)

99 
MSG
("zbufÇon-null\n");

101 
MSG
("zbufÇull\n");

102 
	g°©us
 = -
EINVAL
;

103 
	gout
;

107 i‡((
	gvma
->
vm_pgoff
*
	gPAGE_SIZE
Ë> 
	gÀn
) {

108 
MSG
("offsetÅooÜarge!\n");

109 
	g°©us
 = -
EINVAL
;

110 
	gout
;

113 i‡((
	gzbuf
 = 
kzÆloc
(
Àn
, 
GFP_KERNEL
)Ë=
NULL
) {

114 
°©us
 = -
ENOMEM
;

115 
	gout_no_mem
;

131 i‡((
	g°©us
 = 
ªm≠_p‚_ønge
(
vma
,

132 
vma
->
vm_°¨t
,

133 
vút_to_phys
(
zbuf
Ë>> 
PAGE_SHIFT
,

134 
Àn
,

135 
vma
->
vm_∑ge_¥Ÿ
) < 0)) {

136 
MSG
("remap_pfn_range failed!\n");

137 
	gout
;

139 
MSG
("remap_pfn_range succeeded..\n");

140 
	gout
:

142 
out_no_mem
:

143  
°©us
;

151 
ssize_t
 
	$˙ul_ªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
,

152 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

154 
	`MSG
( "process %s [pid %d], count=%ld\n",

155 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
);

166 
	}
}

168 
ssize_t
 
	$˙ul_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
,

169 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

171 
	`MSG
( "process %s [pid %d], count=%ld\n\tjiffies=%lu\n",

172 
cuºít
->
comm
, cuºít->
pid
, 
cou¡
, 
jiffõs
 );

173  
cou¡
;

175 
	}
}

179 
fûe_›î©i⁄s
 
	gczîo_f›s
 = {

180 .
Œ£ek
 = 
no_Œ£ek
,

181 .
	g›í
 = 
czîo_›í
,

183 .
	gwrôe
 = 
czîo_wrôe
,

184 .
	gmm≠
 = 
czîo_mm≠
,

185 .
	gªÀa£

czîo_˛o£
,

188 
fûe_›î©i⁄s
 
	g˙ul_f›s
 = {

189 .
Œ£ek
 = 
no_Œ£ek
,

190 .
	gªad
 = 
˙ul_ªad
,

191 .
	gwrôe
 = 
˙ul_wrôe
,

194 
	$cz_›í
(
öode
 * inode, 
fûe
 * 
fûp
)

196 
	`MSG
–"Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

198 
	`imö‹
(
öode
)) {

200 
fûp
->
f_›
 = &
czîo_f›s
;

203 
fûp
->
f_›
 = &
˙ul_f›s
;

206  -
ENXIO
;

208 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

209  
fûp
->
f_›
->
	`›í
(
öode
,filp);

214 
	}
}

217 
fûe_›î©i⁄s
 
	gcz›í_f›s
 = {

218 .
›í
 = 
cz_›í
,

228 
__öô
 
	$cz_öô_moduÀ
()

230 
ªsu…
;

232 
	`MSG
–"cz_maj‹=%d\n",
cz_maj‹
);

238 
ªsu…
 = 
	`ªgi°î_chrdev
(
cz_maj‹
, 
DRVNAME
, &
cz›í_f›s
);

239 i‡(
ªsu…
 < 0) {

240 
	`MSG
( "register_chrdev() failedÅryingÅo get cz_major=%d\n",

241 
cz_maj‹
);

242  
ªsu…
;

245 i‡(
cz_maj‹
 =0Ëcz_maj‹ = 
ªsu…
;

246 
	`MSG
–"ªgi°îed:: cz_maj‹=%d\n",
cz_maj‹
);

249 
	}
}

251 
__exô
 
	$cz_˛ónup_moduÀ
()

253 
	`uƒegi°î_chrdev
(
cz_maj‹
, 
DRVNAME
);

254 
	`MSG
("Unregistered.\n");

255 
	}
}

257 
moduÀ_öô
(
cz_öô_moduÀ
);

258 
moduÀ_exô
(
cz_˛ónup_moduÀ
);

260 
moduÀ_∑øm
(
cz_maj‹
, , 0);

262 
MODULE_PARM_DESC
(
cz_maj‹
, "MajorÇumberÅoáttemptÅo use");

263 
MODULE_AUTHOR
("Kaiwan");

264 
MODULE_DESCRIPTION
("Simple (demo)Çullánd zero memory driver driver");

265 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L3_dd_trg/cz_chardrv/mmap_cz/mmap_tst.c

9 
	~<°dio.h
>

10 
	~<uni°d.h
>

11 
	~<sys/ty≥s.h
>

12 
	~<limôs.h
>

13 
	~<sys/°©.h
>

14 
	~<sys/mm™.h
>

15 
	~<f˙é.h
>

16 
	~<sig«l.h
>

17 
	~<°dlib.h
>

19 
	#FLGS
 
O_RDONLY


	)

20 
	#DMODE
 0

	)

21 
	#SZ
 1024

	)

23 
	$sig
–
signum
 )

25 
	`Ârötf
 (
°dîr
,"I¿sig: signum=%d\n", 
signum
);

26 
	}
}

28 
	$maö
(
¨gc
, **
¨gv
)

30 
fd
, *
addr
=0, 
Àn
;

31 
off_t
 
off£t
=0x0;

32 
siga˘i⁄
 
a˘
;

33 
size_t
 
num
=0;

35 if–
¨gc
!=3 ) {

36 
	`Ârötf
(
°dîr
,"Ußge: %†devi˚_fûênum_byãs_to_ªad\n", 
¨gv
[0]);

37 
	`exô
(1);

40 
a˘
.
ß_h™dÀr
 = 
sig
;

41 
a˘
.
ß_Êags
 = 
SA_RESTART
;

42 
	`sigem±y£t
 (&
a˘
.
ß_mask
);

43 i‡((
	`siga˘i⁄
 (
SIGINT
, &
a˘
, 0)) == -1) {

44 
	`≥º‹
("siga˘i⁄"), 
	`exô
 (1);

47 if–(
fd
=
	`›í
(
¨gv
[1],
FLGS
,
DMODE
)) == -1)

48 
	`≥º‹
("›í"),
	`exô
(1);

49 
	`¥ötf
("PID %d: devi˚ o≥√d: fd=%d\n", 
	`gëpid
(), 
fd
);

51 
num
 = 
	`©oi
(
¨gv
[2]);

52 i‡((
num
 < 0Ë|| (num > 
INT_MAX
)) {

53 
	`Ârötf
(
°dîr
,"%s:Çumbî o‡byã†'%d' invÆid.\n", 
¨gv
[0], 
num
);

54 
	`˛o£
 (
fd
);

55 
	`exô
 (1);

59 
Àn
 = 
num
;

60 
off£t
 = 0x0;

62 i‡(
off£t
 % 
	`gë∑gesize
()) {

63 
	`¥ötf
("%s: off£àmu° bê∑ge-Æig√d,áb‹tög...\n", 
¨gv
[0]);

64 
	`˛o£
(
fd
);

72 
addr
 = 
	`mm≠
(0, 
Àn
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 
off£t
);

73 i‡(-1 =()
addr
) {

74 
	`≥º‹
("mmap failed (see dmesg outputás well)");

75 
	`˛o£
(
fd
);

78 
	`¥ötf
("%s: mm≠ádd∏%p\n", 
¨gv
[0], 
addr
);

81 
i
, 
j
, 
°ïsz
 = 32;

82 *
ˇddr
 = (*)
addr
;

84 
	`¥ötf
("\nMmap-ped memory dump (@ step size of %d byte(s))\n"

85 "Addªs†:Off£t: C⁄ã¡†", 
°ïsz
);

86 
i
=
off£t
, 
j
=0; i<(
Àn
+off£t); i+=
°ïsz
,j++) {

87 i‡(!(
j
%32))

88 
	`¥ötf
("\n%08x:%06d: ", ()
addr
+
i
, i);

89 
	`¥ötf
("%02x ", (
ˇddr
[
i
]));

91 
	`¥ötf
("\n");

93 
	`munm≠
(
addr
, 
Àn
);

94 
	`˛o£
(
fd
);

95 
	`exô
(0);

96 
	}
}

	@Training/L3_dd_trg/cz_chardrv/rd_tst.c

8 
	~<°dio.h
>

9 
	~<uni°d.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<limôs.h
>

12 
	~<sys/°©.h
>

13 
	~<f˙é.h
>

14 
	~<sig«l.h
>

15 
	~<°dlib.h
>

17 
	#FLGS
 
O_RDONLY


	)

18 
	#DMODE
 0

	)

19 
	#SZ
 1024

	)

21 
	$sig
(
signum
)

23 
	`Ârötf
(
°dîr
, "I¿%s(): signum=%d\n", 
__func__
, 
signum
);

24 
	}
}

26 
	$maö
(
¨gc
, **
¨gv
)

28 
fd
, 
n
;

29 
siga˘i⁄
 
a˘
;

30 *
buf
 = 
NULL
;

31 
size_t
 
num
 = 0;

33 i‡(
¨gc
 != 3) {

34 
	`Ârötf
(
°dîr
, "Usage: %s device_fileÇum_bytes_to_read\n",

35 
¨gv
[0]);

36 
	`exô
(1);

39 
a˘
.
ß_h™dÀr
 = 
sig
;

40 
a˘
.
ß_Êags
 = 
SA_RESTART
;

41 
	`sigem±y£t
(&
a˘
.
ß_mask
);

42 i‡((
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0)) == -1) {

43 
	`≥º‹
("sigaction");

44 
	`exô
(1);

47 
fd
 = 
	`›í
(
¨gv
[1], 
FLGS
, 
DMODE
);

48 i‡(
fd
 == -1)

49 
	`≥º‹
("›í"), 
	`exô
(1);

50 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

52 
num
 = 
	`©oi
(
¨gv
[2]);

53 i‡((
num
 < 0Ë|| (num > 
INT_MAX
)) {

54 
	`Ârötf
(
°dîr
, "%s:Çumbî o‡byã†'%ld' invÆid.\n", 
¨gv
[0],

55 
num
);

56 
	`˛o£
(
fd
);

57 
	`exô
(1);

60 
buf
 = 
	`mÆloc
(
num
);

61 i‡(!
buf
) {

62 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!\n", 
¨gv
[0]);

63 
	`˛o£
(
fd
);

64 
	`exô
(1);

67 
n
 = 
	`ªad
(
fd
, 
buf
, 
num
);

68 i‡(
n
 < 0) {

69 
	`≥º‹
("read failed");

70 
	`‰ì
(
buf
);

71 
	`˛o£
(
fd
);

72 
	`exô
(1);

85 
	`¥ötf
("%s:Ñód %d byã†‰om %s\n", 
¨gv
[0], 
n
,árgv[1]);

86 
	`˛o£
(
fd
);

87 
	`‰ì
(
buf
);

88 
	`exô
(0);

89 
	}
}

	@Training/L3_dd_trg/cz_chardrv/wr_tst.c

8 
	~<°dio.h
>

9 
	~<uni°d.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<sys/°©.h
>

12 
	~<f˙é.h
>

13 
	~<°dlib.h
>

15 
	#FLGS
 
O_RDWR


	)

16 
	#DMODE
 0

	)

17 
	#SZ
 1024

	)

19 
	$maö
(
¨gc
, **
¨gv
)

21 
fd
;

22 
size_t
 
n
;

23 
buf
[
SZ
];

25 i‡(
¨gc
 == 1) {

26 
	`Ârötf
(
°dîr
, "Ußge: %†devi˚_fûe\n", 
¨gv
[0]);

27 
	`exô
(1);

30 
fd
 = 
	`›í
(
¨gv
[1], 
FLGS
, 
DMODE
);

31 i‡(
fd
 == -1)

32 
	`≥º‹
("›í"), 
	`exô
(1);

34 
n
 = 0;Ç < 
SZ
;Ç++)

35 
buf
[
n
] = '\0';

37 
n
 = 
	`wrôe
(
fd
, 
buf
, 1024);

38 i‡(
n
 == -1) {

39 
	`≥º‹
("write failed");

40 
	`˛o£
(
fd
);

41 
	`exô
(1);

44 
	`¥ötf
("¶ìpy:: wrŸê%ld byãs\n", 
n
);

45 
	`˛o£
(
fd
);

46 
	`exô
(0);

47 
	}
}

	@Training/L3_dd_trg/dt_platform_drv/dtdemo_platformdrv/dtdemo_platdrv.c

26 
	~<löux/moduÀ.h
>

27 
	~<löux/fs.h
>

28 
	~<löux/∂©f‹m_devi˚.h
>

31 
	~<löux/vîsi⁄.h
>

32 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4,11,0)

33 
	~<löux/uac˚ss.h
>

35 
	~<asm/uac˚ss.h
>

38 
	~<löux/miscdevi˚.h
>

39 
	~<löux/dñay.h
>

40 
	~<löux/of.h
>

42 
	#DRVNAME
 "dtdemo_∂©drv"

	)

44 
	$dtdemo_∂©dev_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

46 
devi˚
 *
dev
 = &
pdev
->dev;

47 c⁄° *
¥›
 = 
NULL
;

48 
Àn
 = 0;

50 
	`dev_dbg
(
dev
, "platform driverÖrobeÉnter\n");

52 i‡(
pdev
->
dev
.
of_node
) {

53 
¥›
 = 
	`of_gë_¥›îty
(
pdev
->
dev
.
of_node
, "≠r›îty", &
Àn
);

54 i‡(!
¥›
) {

55 
	`¥_w¨n
("%s: gëtög DTÖr›îty faûed\n", 
DRVNAME
);

58 
	`¥_öfo
("%s: DTÖr›îty '≠r›îty' = %†÷í=%d)\n", 
DRVNAME
, 
¥›
, 
Àn
);

61 
	`¥_w¨n
("couldn'táccess DTÖroperty!\n");

62  -
EINVAL
;

76 
	}
}

78 
	$dtdemo_∂©dev_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

80 
devi˚
 *
dev
 = &
pdev
->dev;

82 
	`dev_dbg
(
dev
, "platform driverÑemove\n");

84 
	}
}

86 #ifde‡
CONFIG_OF


87 c⁄° 
of_devi˚_id
 
	gmy_of_ids
[] = {

95 { .
com∑tibÀ
 = "dtdemo,dtdemo_platdev"},

98 
MODULE_DEVICE_TABLE
(
of
, 
my_of_ids
);

101 
∂©f‹m_drivî
 
	gmy_∂©f‹m_drivî
 = {

102 .
¥obe
 = 
dtdemo_∂©dev_¥obe
,

103 .
	gªmove
 = 
dtdemo_∂©dev_ªmove
,

104 .
	gdrivî
 = {

105 .
«me
 = "dtdemo_platdev",

109 #ifde‡
CONFIG_OF


110 .
	gof_m©ch_èbÀ
 = 
my_of_ids
,

112 .
	gow√r
 = 
THIS_MODULE
,

116 
	$dtdemo_∂©drv_öô
()

118 
ªt_vÆ
;

120 
	`¥_öfo
("%s: in£πed\n", 
DRVNAME
);

123 
ªt_vÆ
 = 
	`∂©f‹m_drivî_ªgi°î
(&
my_∂©f‹m_drivî
);

124 i‡(
ªt_vÆ
 !=0) {

125 
	`¥_îr
("∂©f‹m vÆuêªtu∫ed %d\n", 
ªt_vÆ
);

126  
ªt_vÆ
;

129 
	}
}

131 
	$dtdemo_∂©drv_˛ónup
()

133 
	`∂©f‹m_drivî_uƒegi°î
(&
my_∂©f‹m_drivî
);

134 
	`¥_öfo
("%s:Ñemoved\n", 
DRVNAME
);

135 
	}
}

137 
moduÀ_öô
(
dtdemo_∂©drv_öô
);

138 
moduÀ_exô
(
dtdemo_∂©drv_˛ónup
);

140 
MODULE_LICENSE
("Dual MIT/GPL");

141 
MODULE_AUTHOR
("Kaiwan N Billimoria");

142 
MODULE_DESCRIPTION
(

	@Training/L3_dd_trg/dt_platform_drv/platform_devdrv_demo/platdemo.c

15 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

16 
	#dev_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

18 
	~<löux/öô.h
>

19 
	~<löux/kî√l.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/sched.h
>

22 
	~<löux/fs.h
>

23 
	~<löux/¶ab.h
>

24 
	~<löux/devi˚.h
>

25 
	~<löux/∂©f‹m_devi˚.h
>

26 
	~"../../c⁄víõ¡.h
"

28 
	#DRVNAME
 "∂©demo"

	)

30 
∂©dev_¥obe
(
∂©f‹m_devi˚
 *);

31 
∂©dev_ªmove
(
∂©f‹m_devi˚
 *);

32 
∂©0_ªÀa£
(
devi˚
 *);

35 
∂©f‹m_devi˚
 
	g∂©0
 = {

40 .
«me
 = "plat",

44 .
	gdrivî_ovîride
 = 
DRVNAME
,

46 .
	g«me
 = 
DRVNAME
,

48 .
	gid
 = 0,

49 .
	gdev
 = {

50 .
∂©f‹m_d©a
 = 
NULL
,

58 .
	gªÀa£
 = 
∂©0_ªÀa£
,

62 
∂©f‹m_devi˚
 *
	g∂©demo_∂©f‹m_devi˚s
[] 
	g__öôd©a
 = {

63 &
∂©0
,

67 
∂©f‹m_drivî
 
	g∂©drv
 = {

68 .
¥obe
 = 
∂©dev_¥obe
,

69 .
	gªmove
 = 
∂©dev_ªmove
,

70 .
	gdrivî
 = {

71 .
«me
 = 
DRVNAME
,

72 .
	gow√r
 = 
THIS_MODULE
,

77 
	sMyCtx
 {

79 
	mtxpkäum
, 
	mrxpkäum
;

80 
	mtx_byãs
, 
	mrx_byãs
;

81 
	md©a_xf‹m
;

83 } 
	t°MyCtx
, *
	tp°MyCtx
;

87 
	$∂©dev_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

89 
devi˚
 *
dev
 = &
pdev
->dev;

90 
p°MyCtx
 
p°Ctx
 = 
	`dev_gë_∂©d©a
(&
pdev
->
dev
);

96 
p°Ctx
->
d©a_xf‹m
 = 100;

97 
	`dev_dbg
(
dev
, "probe method invoked; setting 'data_xform'Åo 100\n");

99 
	}
}

101 
	$∂©dev_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

103 
devi˚
 *
dev
 = &
pdev
->dev;

104 
p°MyCtx
 
p°Ctx
 = 
	`dev_gë_∂©d©a
(
dev
);

106 
	`dev_dbg
(
dev
, "remove method invoked\n data_xform=%d\n",

107 
p°Ctx
->
d©a_xf‹m
);

109 
	}
}

111 
	$∂©0_ªÀa£
(
devi˚
 *
dev
)

113 
	`dev_dbg
(
dev
, "release method invoked\n");

114 
	}
}

116 
__öô
 
	$∂©dev_öô
()

118 
ªs
 = 0;

119 
p°MyCtx
 
p°Ctx
 = 
NULL
;

121 
	`¥_öfo
("InitializingÖlatform demo driverÇow...\n");

123 
p°Ctx
 = 
	`kzÆloc
((
°MyCtx
), 
GFP_KERNEL
);

124 i‡(!
p°Ctx
)

125  -
ENOMEM
;

126 
∂©0
.
dev
.
∂©f‹m_d©a
 = 
p°Ctx
;

129 
ªs
 = 
	`∂©f‹m_add_devi˚s
(
∂©demo_∂©f‹m_devi˚s
,

130 
	`ARRAY_SIZE
(
∂©demo_∂©f‹m_devi˚s
));

131 i‡(
ªs
) {

132 
	`¥_w¨n
("platform_add_devices failed!\n");

133 
out_Áû_∑d
;

137 
ªs
 = 
	`∂©f‹m_drivî_ªgi°î
(&
∂©drv
);

138 i‡(
ªs
) {

139 
	`¥_w¨n
("platform_driver_register failed!\n");

140 
out_Áû_pdr
;

145 
	`dev_dbg
(&
∂©0
.
dev
, "loaded.\n");

146  
ªs
;

148 
out_Áû_pdr
:

149 
	`∂©f‹m_devi˚_uƒegi°î
(&
∂©0
);

150 
out_Áû_∑d
:

151 
	`k‰ì
(
p°Ctx
);

152  
ªs
;

153 
	}
}

155 
__exô
 
	$∂©dev_exô
()

157 
devi˚
 *
dev
 = &
∂©0
.dev;

158 
p°MyCtx
 
p°Ctx
 = 
∂©0
.
dev
.
∂©f‹m_d©a
;

160 
	`dev_dbg
(
dev
, "unloading\n");

161 
	`∂©f‹m_drivî_uƒegi°î
(&
∂©drv
);

162 
	`∂©f‹m_devi˚_uƒegi°î
(&
∂©0
);

163 
	`k‰ì
(
p°Ctx
);

164 
	}
}

166 
moduÀ_öô
(
∂©dev_öô
);

167 
moduÀ_exô
(
∂©dev_exô
);

169 
	gMODULE_DESCRIPTION


171 
MODULE_AUTHOR
("Kaiwan N Billimoria");

172 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L3_dd_trg/dt_platform_drv/rtc_ds3231/convenient.h

16 #i‚de‡
__LLKD_CONVENIENT_H__


17 
	#__LLKD_CONVENIENT_H__


	)

19 
	~<asm/∑øm.h
>

20 
	~<löux/sched.h
>

22 #ifde‡
__KERNEL__


23 
	~<löux/øãlimô.h
>

52 #unde‡
USE_FTRACE_BUFFER


54 #ifde‡
USE_FTRACE_BUFFER


55 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

56 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

58 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

59 
USE_RATELIMITING
 = 1; \

60 i‡(
USE_RATELIMITING
) { \

61 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

64 
	`¥_öfo
(
°rög
, ##
¨gs
); \

65 } 0)

	)

70 #ifde‡
DEBUG


71 #ifde‡
__KERNEL__


72 
	#MSG
(
°rög
, 
¨gs
...) do { \

73 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

74 } 0)

	)

76 
	#MSG
(
°rög
, 
¨gs
...) do { \

77 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

78 } 0)

	)

81 #ifde‡
__KERNEL__


82 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

83 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

84 } 0)

	)

86 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

87 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

88 } 0)

	)

92 
	#QP
 
	`MSG
("\n")

	)

94 #ifde‡
__KERNEL__


95 #i‚de‡
USE_FTRACE_BUFFER


96 
	#QPDS
 do { \

97 
	`MSG
("\n"); \

98 
	`dump_°ack
(); \

99 } 0)

	)

101 
	#QPDS
 do { \

102 
	`MSG
("\n"); \

103 
	`åa˚_dump_°ack
(); \

104 } 0)

	)

108 #ifde‡
__KERNEL__


109 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

110 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

111 } 0)

	)

114 
	#MSG
(
°rög
, 
¨gs
...)

	)

115 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

116 
	#QP


	)

117 
	#QPDS


	)

125 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

126 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

127 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

128 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

129 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

131 #ifde‡
__KERNEL__


152 
	~<löux/sched.h
>

153 
	~<löux/öãºu±.h
>

155 
	#PRINT_CTX
() do { \

156 
PRINTCTX_SHOWHDR
 = 0; \

157 
öå
 = '.'; \

158 i‡(!
	`ö_èsk
()) { \

159 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

160 
öå
 = 'H'; \

161 i‡(
	`ö_úq
()) \

162 
öå
 = 'h'; \

163 i‡(
	`ö_so·úq
()) \

164 
öå
 = 's'; \

167 
öå
 = '.'; \

169 i‡(
PRINTCTX_SHOWHDR
 == 1) \

170 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

171 
	`¥_debug
( \

175 , 
	`smp_¥o˚ss‹_id
(), \

176 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

177 (
	`úqs_dißbÀd
()?'d':'.'), \

178 (
	`√ed_ªsched
()?'N':'.'), \

179 
öå
, \

180 (
	`¥ìm±_cou¡
() && 0xff), \

181 
__func__
 \

183 } 0)

	)

198 #ifde‡
__KERNEL__


199 
	#as£π
(
ex¥
) do { \

200 i‡(!(
ex¥
)) { \

201 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

202 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

204 } 0)

	)

208 
ölöe
 
	$bìp
(
wh©
)

210 #ifde‡
__KERNEL__


211 
	`¥_öfo
("%c", ()
wh©
);

213 
	~<uni°d.h
>

214 
buf
 = ()
wh©
;

215 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

217 
	}
}

226 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

228 
c
 = 0, 
m
; \

229 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

231 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

232 
	`bìp
((
vÆ
)); \

233 
c
++; \

234 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

235 
m
 = 0; m < 50; m++); \

236 
x
 = 
ö√r_ödex
 / 2; \

240 }

	)

243 #ifde‡
__KERNEL__


244 
dñay_£c
();

252 
	$dñay_£c
(
vÆ
)

254 
	`asm
("");

255 i‡(
	`ö_èsk
()) {

256 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

257 i‡(-1 =
vÆ
)

258 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

260 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

262 
	}
}

	@Training/L3_dd_trg/dt_platform_drv/rtc_ds3231/ds3231.c

15 
	#¥_fmt
(
fmt
Ë"%s:%s():%d: " fmt, 
KBUILD_MODNAME
, 
__func__
, 
__LINE__


	)

17 
	~<löux/öô.h
>

18 
	~<löux/moduÀ.h
>

19 
	~<löux/kî√l.h
>

20 
	~<löux/sched.h
>

21 
	~<löux/¶ab.h
>

22 
	~<löux/vîsi⁄.h
>

23 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4, 11, 0)

24 
	~<löux/uac˚ss.h
>

25 
	~<löux/sched/sig«l.h
>

27 
	~<asm/uac˚ss.h
>

29 
	~<löux/devi˚.h
>

30 
	~<löux/i2c.h
>

31 
	~<löux/πc.h
>

32 
	~<löux/öãºu±.h
>

33 
	~<löux/gpio.h
>

35 
	~<löux/bcd.h
>

36 
	~"c⁄víõ¡.h
"

38 
MODULE_AUTHOR
("Kaiwan N Billimoria, kaiwan@kaiwantech.com");

39 
MODULE_DESCRIPTION
("DS3231 RTC I2C chip driver");

40 
MODULE_LICENSE
("Dual MIT/GPL");

42 
	#GPIO_SQW
 16

	)

45 
	#A1M1
 0x7

46 
	#A1M2
 0x8

47 
	#A1M3
 0x9

48 
	#A1M4
 0xA

49 

	)

50 
	#TIME_BASEREG
 0x0

51 
	#TIME_BASEREG_LEN
 7

52 
	#TEMPR_MSB
 0x11

53 
	#CONTROL_REG
 0x0E

54 

	)

56 
	sds3231
 {

57 
πc_devi˚
 *
	mπc
;

58 
i2c_˛õ¡
 *
	m˛õ¡
;

61 
	$ds3231_ªad_block_d©a
(
i2c_˛õ¡
 *
˛õ¡
, 
ªg
,

62 
Àngth
, *
buf
)

64 
i2c_msg
 
msgs
[] = {

66 .
addr
 = 
˛õ¡
->addr,

67 .
Àn
 = 1,

68 .
buf
 = &
ªg
,

71 .
addr
 = 
˛õ¡
->addr,

72 .
Êags
 = 
I2C_M_RD
,

73 .
Àn
 = 
Àngth
,

74 .
buf
 = buf

79 i‡((
	`i2c_å™s„r
(
˛õ¡
->
ad≠ãr
, 
msgs
, 2)) != 2) {

80 
	`dev_îr
(&
˛õ¡
->
dev
, "%s:ÑódÉº‹\n", 
__func__
);

81  -
EIO
;

85 
	}
}

87 
	$ds3231_ªad_ãmp
(
devi˚
 *
dev
)

89 
i2c_˛õ¡
 *
˛õ¡
 = 
	`to_i2c_˛õ¡
(
dev
);

90 
buf
[2];

91 
îr
, 
Àn
 = 2;

92 
s16
 
ãmp
;

93 
mûliC
 = 0;

96 
îr
 = 
	`ds3231_ªad_block_d©a
(
˛õ¡
, 
TEMPR_MSB
, 
Àn
, 
buf
);

97 i‡(
îr
)

98  
îr
;

114 
ãmp
 = (
buf
[0] << 8) | buf[1];

115 
ãmp
 >>= 6;

116 
mûliC
 = 
ãmp
 * 250;

120  
mûliC
;

121 
	}
}

132 
ssize_t
 
	$ds3231_ãmp_show
(
devi˚
 *
dev
,

133 
devi˚_©åibuã
 *
©å
, *
buf
)

135 
n
;

136 
mûliC
 = 
	`ds3231_ªad_ãmp
(
dev
);

138 
	`dev_dbg
(
dev
, "%s():Åemp=%ld mûliC\n", 
__func__
, 
mûliC
);

139 
n
 = 
	`¢¥ötf
(
buf
, 8, "%ld", 
mûliC
);

141  
n
;

142 
	}
}

148 
DEVICE_ATTR_RO
(
ds3231_ãmp
);

156 
	$ds3231_πc_ªad_time
(
devi˚
 *
dev
, 
πc_time
 *
tm
)

158 
i2c_˛õ¡
 *
˛õ¡
 = 
	`to_i2c_˛õ¡
(
dev
);

159 
buf
[8];

160 
îr
 = 0;

162 
	`PRINT_CTX
();

168 
îr
 = 
	`ds3231_ªad_block_d©a
(
˛õ¡
, 
TIME_BASEREG
, 
TIME_BASEREG_LEN
, 
buf
);

169 i‡(
îr
)

170  
îr
;

173 
	`¥_debug
("sec,min,hrs,day,date,mon,year\n");

174 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_OFFSET
, 
buf
, 
TIME_BASEREG_LEN
);

175 
tm
->
tm_£c
 = 
	`bcd2bö
(
buf
[0] & 0xF);

176 
tm
->
tm_mö
 = 
	`bcd2bö
(
buf
[1] & 0xF);

177 
tm
->
tm_hour
 = 
	`bcd2bö
(
buf
[2] & 0xF);

178 
tm
->
tm_wday
 = 
buf
[3] & 0x7;

179 
tm
->
tm_mday
 = 
	`bcd2bö
(
buf
[4] & 0xF);

180 
tm
->
tm_m⁄
 = 
	`bcd2bö
(
buf
[5] & 0xF);

181 
tm
->
tm_yór
 = 
	`bcd2bö
(
buf
[6] & 0xF);

184 
	}
}

186 
	$ds3231_πc_£t_time
(
devi˚
 *
dev
, 
πc_time
 *
t
)

188 
i2c_˛õ¡
 *
˛õ¡
 = 
	`to_i2c_˛õ¡
(
dev
);

189 
buf
[8];

190 
îr
 = 0;

192 
	`PRINT_CTX
();

194 
	`dev_dbg
(
dev
, "%s secs=%d, mins=%d, "

196 "wrôe:", 
t
->
tm_£c
,Å->
tm_mö
,

197 
t
->
tm_hour
,Å->
tm_mday
,

198 
t
->
tm_m⁄
,Å->
tm_yór
,Å->
tm_wday
);

202 
	}
}

205 
	$ds3231_πc_io˘l
(
devi˚
 *
dev
, 
cmd
, 
¨g
)

208 
πc_time
 
tm
;

210 
	`¥_öfo
("############### %s(Ë!\n", 
__func__
);

211 
	`PRINT_CTX
();

214 
cmd
) {

215 
RTC_RD_TIME
:

216 
	`ds3231_πc_ªad_time
(
dev
, &
tm
);

217 i‡(
¨g
) {

218 
	`mem£t
((*)
¨g
, 0, (
πc_time
));

219 i‡(
	`c›y_to_u£r
((
__u£r
 
πc_time
 *)
¨g
, &
tm
, (rtc_time))) {

220 
	`dev_îr
(
dev
, "%s: c›y_to_u£∏îr‹\n", 
__func__
);

221  -
EIO
;

226  -
ENOIOCTLCMD
;

230 
	}
}

232 c⁄° 
πc_˛ass_›s
 
	gds3231_πc_›s
 = {

233 .
io˘l
 = 
ds3231_πc_io˘l
,

234 .
	gªad_time
 = 
ds3231_πc_ªad_time
,

235 .
	g£t_time
 = 
ds3231_πc_£t_time
,

237 .
	gªad_Æ¨m
 = 
ds3231_gë_Æ¨m
,

238 .
	g£t_Æ¨m
 = 
ds3231_£t_Æ¨m
,

242 
úqªtu∫_t
 
	$ds3231_h™dÀr
(
úq
, *
d©a
)

244 
ds3231
 *ds3231 = (ds3231 *)
d©a
;

245 
devi˚
 *
dev
 = &
ds3231
->
˛õ¡
->dev;

247 
	`dev_dbg
(
dev
, "***** in hardirq handler! *****\n");

248  
IRQ_HANDLED
;

249 
	}
}

251 
s32
 
	$wrôe_i2c_ªgi°î
(
i2c_˛õ¡
 *
˛õ¡
, 
u8
 
cmdªg
, u8 
vÆ
)

253 
s32
 
îr
 = 0;

255 
	`¥_öfo
("cmdªg=0x%x vÆ=0x%x\n", 
cmdªg
, 
vÆ
);

256 
îr
 = 
	`i2c_smbus_wrôe_byã_d©a
(
˛õ¡
, 
cmdªg
, 
vÆ
);

257 i‡(
îr
 != 0)

258 
	`dev_w¨n
(&
˛õ¡
->
dev
, "ªgi°î wrôêÁûed: (0x%x, 0x%x)\n", 
cmdªg
, 
vÆ
);

260  
îr
;

261 
	}
}

264 
	$ds3231_¥obe
(
i2c_˛õ¡
 *
˛õ¡
, c⁄° 
i2c_devi˚_id
 *
id
)

271 
devi˚
 *
dev
 = &
˛õ¡
->dev;

272 
ds3231
 *ds3231;

273 
îr
 = 0, 
úq
;

275 
QP
;

284 i‡(!
	`i2c_check_fun˘i⁄Æôy
(
˛õ¡
->
ad≠ãr
, 
I2C_FUNC_I2C
))

285  -
ENODEV
;

287 
ds3231
 = 
	`devm_kzÆloc
(
dev
, (ds3231), 
GFP_KERNEL
);

288 i‡(!
ds3231
)

289  -
ENOMEM
;

291 
	`i2c_£t_˛õ¡d©a
(
˛õ¡
, 
ds3231
);

292 
ds3231
->
˛õ¡
 = client;

294 
ds3231
->
πc
 = 
	`devm_πc_Æloˇã_devi˚
(&
˛õ¡
->
dev
);

295 i‡(
	`IS_ERR
(
ds3231
->
πc
))

296  
	`PTR_ERR
(
ds3231
->
πc
);

298 
ds3231
->
πc
->
›s
 = &
ds3231_πc_›s
;

300 
ds3231
->
πc
->
uõ_unsuµ‹ãd
 = 0;

301 
ds3231
->
πc
->
ønge_mö
 = 
RTC_TIMESTAMP_BEGIN_2000
;

302 
ds3231
->
πc
->
ønge_max
 = 
RTC_TIMESTAMP_END_2099
;

303 
ds3231
->
πc
->
£t_°¨t_time
 = 
åue
;

307 
	`dev_dbg
(
dev
, "˛õ¡ irq = %d\n", 
˛õ¡
->
úq
);

314 
úq
 = 
	`gpio_to_úq
(
GPIO_SQW
);

316 
	`dev_dbg
(
dev
, "úq = %d\n", 
úq
);

331 
îr
 = 
	`devm_ªque°_úq
(
dev
, 
úq
, 
ds3231_h™dÀr
,

332 
IRQF_SHARED
 | 
IRQF_TRIGGER_RISING
,

333 
KBUILD_MODNAME
, 
ds3231
);

334 i‡(
îr
)

335 
	`dev_w¨n
(
dev
, "thªaded IRQÑeque° faûed (%d)\n", 
îr
);

339 
îr
 =

340 
	`devi˚_¸óã_fûe
(
dev
, &
dev_©å_ds3231_ãmp
);

348 i‡(
îr
)

349 
	`dev_w¨n
(
dev
, "devi˚_¸óã_fûêÁûed (%d)\n", 
îr
);

350 
	`dev_dbg
(
dev
, "created sysfs file forÑeadingÅemperature\n");

353 
îr
 = 
	`πc_ªgi°î_devi˚
(
ds3231
->
πc
);

354 i‡(
îr
)

355  
îr
;

366 
	`wrôe_i2c_ªgi°î
(
˛õ¡
, 
A1M1
, 0x80);

367 
	`wrôe_i2c_ªgi°î
(
˛õ¡
, 
A1M2
, 0x80);

368 
	`wrôe_i2c_ªgi°î
(
˛õ¡
, 
A1M3
, 0x80);

369 
	`wrôe_i2c_ªgi°î
(
˛õ¡
, 
A1M4
, 0x80);

371 
u8
 
ªgs
[4];

372 
îr
 = 
	`ds3231_ªad_block_d©a
(
˛õ¡
, 
A1M1
, 4, 
ªgs
);

373 i‡(
îr
) {

374 
	`dev_w¨n
(&
˛õ¡
->
dev
, "alarm 0ÑegisterÑead failed: (0x0E, 1)\n");

377 
	`¥öt_hex_dump_byãs
("Æ¨m0", 
DUMP_PREFIX_OFFSET
, 
ªgs
, 4);

392 
u8
 
˘æªg_buf
[1];

393 
u8
 
˘æªg
 = 0;

395 
îr
 = 
	`ds3231_ªad_block_d©a
(
˛õ¡
, 
CONTROL_REG
, 1, 
˘æªg_buf
);

396 i‡(
îr
) {

397 
	`dev_w¨n
(&
˛õ¡
->
dev
, "controlÑegisterÑead failed: (0x0E, 1)\n");

400 
˘æªg
 = 
	`k°πou8
(
˘æªg_buf
, 0, &ctrlreg);

401 
	`dev_dbg
(&
˛õ¡
->
dev
, "˘æªg = 0x%08x\n", 
˘æªg
);

404 
˘æªg
 |= 0x5;

405 
	`wrôe_i2c_ªgi°î
(
˛õ¡
, 
CONTROL_REG
, 
˘æªg
);

406 
˘æªg_buf
[0] = '\0';

407 
	`ds3231_ªad_block_d©a
(
˛õ¡
, 
CONTROL_REG
, 1, 
˘æªg_buf
);

408 
˘æªg
 = 
	`k°πou8
(
˘æªg_buf
, 0, &ctrlreg);

409 
	`dev_dbg
(&
˛õ¡
->
dev
, "˘æªgá‡|0x5 = 0x%08x\n", 
˘æªg
);

412 
	}
}

415 
	$ds3231_ªmove
(
i2c_˛õ¡
 *
˛õ¡
)

417 
QP
;

418 
	`devi˚_ªmove_fûe
(&
˛õ¡
->
dev
, &
dev_©å_ds3231_ãmp
);

420 
	}
}

438 c⁄° 
i2c_devi˚_id
 
	gds3231_id
[] = {

444 
MODULE_DEVICE_TABLE
(
i2c
, 
ds3231_id
);

449 #ifde‡
CONFIG_OF


450 c⁄° 
of_devi˚_id
 
	gds3231_of_m©ch
[] = {

455 {.
com∑tibÀ
 = "myvendor,ks3231"},

460 
MODULE_DEVICE_TABLE
(
of
, 
ds3231_of_m©ch
);

465 c⁄° 
	ga˝i_devi˚_id
 <
	gchù«me
>
	g_a˝i_id
[] = {

470 
MODULE_DEVICE_TABLE
(
a˝i
, <
chù«me
>
_a˝i_id
);

471 c⁄° 
of_devi˚_id
 
	gdev_ids
 = {

472 {.
com∑tibÀ
 = "maxim,ds3231"},

474 }; 
MODULE_DEVICE_TABLE
(
of
, 
dev_ids
);

483 
i2c_drivî
 
	gds3231_drivî
 = {

484 .
drivî
 = {

485 .
«me
 = "ks3231",

491 .
	gof_m©ch_èbÀ
 = 
of_m©ch_±r
(
ds3231_of_m©ch
),

493 .
	g¥obe
 = 
ds3231_¥obe
,

494 .
	gªmove
 = 
ds3231_ªmove
,

495 .
	gid_èbÀ
 = 
ds3231_id
,

497 .
	gdisc⁄√˘
 = 
ds3231_disc⁄√˘
,

498 .
	gsu•íd
 = 
ds3231_su•íd
,

499 .
	gªsume
 = 
ds3231_ªsume
,

517 
moduÀ_i2c_drivî
(
ds3231_drivî
);

	@Training/L3_dd_trg/dt_platform_drv/rtc_ds3231/uapp.c

4 
	~<°dio.h
>

5 
	~<uni°d.h
>

6 
	~<sys/ty≥s.h
>

7 
	~<sys/°©.h
>

8 
	~<f˙é.h
>

9 
	~<sig«l.h
>

10 
	~<°dlib.h
>

11 
	~<sys/io˘l.h
>

13 
	~<löux/πc.h
>

15 
	$maö
(
¨gc
, **
¨gv
)

17 
fd
, 
powî
;

18 
πc_time
 
tm
;

20 i‡(
¨gc
 < 2) {

21 
	`Ârötf
(
°dîr
, "Ußge: %†devi˚_fûe\n", 
¨gv
[0]);

22 
	`exô
(
EXIT_FAILURE
);

25 i‡((
fd
 = 
	`›í
(
¨gv
[1], 
O_RDWR
, 0)) == -1) {

26 
	`≥º‹
("open");

27 
	`exô
(
EXIT_FAILURE
);

29 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

32 i‡(
	`io˘l
(
fd
, 
RTC_RD_TIME
, &
tm
) == -1) {

33 
	`≥º‹
("ioctl RTC_RD_TIME failed");

34 
	`˛o£
(
fd
);

35 
	`exô
(
EXIT_FAILURE
);

37 
	`¥ötf
("%s: RTCÑód d⁄e\n", 
¨gv
[0]);

39 
	`˛o£
(
fd
);

40 
	`exô
(
EXIT_SUCCESS
);

41 
	}
}

	@Training/L3_dd_trg/input_drv_mouse/coord_gen.c

5 
	~<°dio.h
>

6 
	~<uni°d.h
>

7 
	~<f˙é.h
>

8 
	~<°dlib.h
>

9 
	~<°rög.h
>

11 
	#SYSFS_FILE
 "/sys/devi˚s/∂©f‹m/vms/vms"

	)

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
sim_fd
;

16 
x
, 
y
;

17 
buf„r
[10];

20 
sim_fd
 = 
	`›í
(
SYSFS_FILE
, 
O_WRONLY
);

21 i‡(
sim_fd
 < 0) {

22 
	`≥º‹
("Couldn't open vms coordinate file\n");

23 
	`exô
(-1);

28 
x
 = 
	`øndom
() % 20;

29 
y
 = 
	`øndom
() % 20;

30 i‡(
x
 % 2)

31 
x
 = -x;

32 i‡(
y
 % 2)

33 
y
 = -y;

35 
	`•rötf
(
buf„r
, "%d %d %d", 
x
, 
y
, 0);

36 i‡(
	`wrôe
(
sim_fd
, 
buf„r
, 
	`°æí
(buffer)) < 0)

37 
	`≥º‹
("write failed");

38 
	`fsync
(
sim_fd
);

39 
	`¶ìp
(1);

41 
	`˛o£
(
sim_fd
);

42 
	}
}

	@Training/L3_dd_trg/input_drv_mouse/input_drv_mouse.c

5 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

7 
	~<löux/öô.h
>

8 
	~<löux/moduÀ.h
>

9 
	~<löux/kî√l.h
>

10 
	~<löux/fs.h
>

11 
	~<löux/öput.h
>

12 
	~<löux/∂©f‹m_devi˚.h
>

13 
	~<löux/muãx.h
>

16 
	~<löux/vîsi⁄.h
>

17 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

18 
	~<löux/uac˚ss.h
>

20 
	~<asm/uac˚ss.h
>

23 
MODULE_DESCRIPTION
("Input driver -Éxample, simple mouseÉmulator demo;Ñef: ELDD book");

30 
MODULE_LICENSE
("Dual MIT/GPL");

31 
MODULE_VERSION
("0.1");

33 
	#OURMODNAME
 "öput_drv_mou£"

	)

34 
	#SYSFS_FILE1
 
vms


	)

36 
öput_dev
 *
	gvms_öput_dev
;

37 
∂©f‹m_devi˚
 *
	gsysfs_demo_∂©dev
;

54 
ssize_t
 
	$vms_°‹e
(
devi˚
 *
dev
,

55 
devi˚_©åibuã
 *
©å
,

56 c⁄° *
buf
, 
size_t
 
cou¡
)

58 
x
, 
y
;

60 
	`ssˇnf
(
buf
, "%d%d", &
x
, &
y
);

61 
	`dev_dbg
(
dev
, "%s(): count=%zu; (%d, %d)Ñeported up\n",

62 
__func__
, 
cou¡
, 
x
, 
y
);

65 
	`öput_ªp‹t_ªl
(
vms_öput_dev
, 
REL_X
, 
x
);

66 
	`öput_ªp‹t_ªl
(
vms_öput_dev
, 
REL_Y
, 
y
);

67 
	`öput_sync
(
vms_öput_dev
);

109  
cou¡
;

110 
	}
}

116 
DEVICE_ATTR_WO
(
vms
);

135 
__öô
 
	$öput_drv_mou£_öô
()

137 
°©
 = 0;

139 i‡(
	`u∆ikñy
(!
	`IS_ENABLED
(
CONFIG_SYSFS
))) {

140 
	`¥_w¨n
("sysfs unsupported! Aborting ...\n");

141  -
EINVAL
;

153 
	#PLAT_NAME
 "vms"

	)

154 
sysfs_demo_∂©dev
 = 
	`∂©f‹m_devi˚_ªgi°î_sim∂e
(
PLAT_NAME
, -1, 
NULL
, 0);

155 i‡(
	`IS_ERR
(
sysfs_demo_∂©dev
)) {

156 
°©
 = 
	`PTR_ERR
(
sysfs_demo_∂©dev
);

157 
	`¥_öfo
("îr‹ (%dËªgi°îög ou∏∂©f‹m devi˚,áb‹tög\n", 
°©
);

158 
out1
;

170 
°©
 = 
	`devi˚_¸óã_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_vms
);

184 i‡(
°©
) {

185 
	`¥_öfo
("devi˚_¸óã_fûêÁûed (%d),áb‹tögÇow\n", 
°©
);

186 
out2
;

188 
	`¥_debug
("sysf†fûê(/sys/devi˚s/∂©f‹m/%s/%sË¸óãd\n", 
PLAT_NAME
, "vms");

191 
vms_öput_dev
 = 
	`öput_Æloˇã_devi˚
();

192 i‡(!
vms_öput_dev
) {

193 
	`dev_w¨n
(&
sysfs_demo_∂©dev
->
dev
, "input_alloc_device() failed\n");

194 
out3
;

196 
vms_öput_dev
->
«me
 = "virtual mouse (vms)";

197 
vms_öput_dev
->
phys
 = "virtual/input0";

200 
	`£t_bô
(
EV_REL
, 
vms_öput_dev
->
evbô
);

202 
	`£t_bô
(
REL_X
, 
vms_öput_dev
->
ªlbô
);

203 
	`£t_bô
(
REL_Y
, 
vms_öput_dev
->
ªlbô
);

207 
	`£t_bô
(
EV_KEY
, 
vms_öput_dev
->
evbô
);

208 
	`£t_bô
(
BTN_0
, 
vms_öput_dev
->
keybô
);

212 
	`öput_ªgi°î_devi˚
(
vms_öput_dev
);

213 
	`¥_öfo
("Virtual Mouse Driver Initialized.\n");

216 
out3
:

217 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_vms
);

218 
out2
:

219 
	`∂©f‹m_devi˚_uƒegi°î
(
sysfs_demo_∂©dev
);

220 
out1
:

221  
°©
;

222 
	}
}

224 
__exô
 
	$öput_drv_mou£_˛ónup
()

227 
	`öput_uƒegi°î_devi˚
(
vms_öput_dev
);

230 
	`devi˚_ªmove_fûe
(&
sysfs_demo_∂©dev
->
dev
, &
dev_©å_vms
);

233 
	`∂©f‹m_devi˚_uƒegi°î
(
sysfs_demo_∂©dev
);

234 
	`¥_öfo
("removed\n");

235 
	}
}

237 
moduÀ_öô
(
öput_drv_mou£_öô
);

238 
moduÀ_exô
(
öput_drv_mou£_˛ónup
);

	@Training/L3_dd_trg/ioctl_kernel_poc/convenient.h

23 #i‚de‡
__CONVENIENT_H__


24 
	#__CONVENIENT_H__


	)

26 
	~<asm/∑øm.h
>

27 
	~<löux/sched.h
>

31 #ifde‡
DEBUG


32 
	#MSG
(
°rög
, 
¨gs
...) \

33 
	`¥ötk
(
KERN_INFO
 "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

34 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

35 
	`¥ötk
(
KERN_INFO
 
°rög
, ##
¨gs
)

	)

36 
	#QP
 
	`MSG
("\n")

	)

37 
	#QPDS
 do { \

38 
	`MSG
("\n"); \

39 
	`dump_°ack
(); \

40 } 0)

	)

42 
	#MSG
(
°rög
, 
¨gs
...)

	)

43 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

44 
	#QP


	)

45 
	#QPDS


	)

65 
	#as£π
(
ex¥
) \

66 i‡(!(
ex¥
)) { \

67 
	`¥ötk
("Assertion [%s] failed! : %s:%s:%d\n", \

68 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

69 }

	)

72 
ölöe
 
	$bìp
(
wh©
)

74 ()
	`¥ötk
(
KERN_INFO
 "%c", ()
wh©
);

75 
	}
}

82 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

84 
c
=0, 
m
;\

85 
f‹_ödex
,
ö√r_ödex
; \

87 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

88 
	`bìp
((
vÆ
)); \

89 
c
++;\

90 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

91 
m
=0;m<50;m++); \

94 }

	)

101 
	#DELAY_SEC
(
vÆ
) \

103 i‡(!
	`ö_öãºu±
()) { \

104 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

105 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

107 }

	)

	@Training/L3_dd_trg/ioctl_kernel_poc/ioctl_kdrv.c

12 
	~<löux/moduÀ.h
>

13 
	~<löux/kî√l.h
>

14 
	~<löux/öô.h
>

15 
	~<löux/fs.h
>

16 
	~<löux/io˘l.h
>

17 
	~<löux/vîsi⁄.h
>

20 
	~<löux/vîsi⁄.h
>

21 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4,11,0)

22 
	~<löux/uac˚ss.h
>

24 
	~<asm/uac˚ss.h
>

27 
	~"io˘l_kdrv.h
"

28 
	~"c⁄víõ¡.h
"

30 
	#MODULE_VER
 "0.1"

	)

31 
	#MODULE_NAME
 "io˘l_kdrv"

	)

33 
	giok_maj‹
 = 0, 
	gpowî
 = 1;

39 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,36)

40 
	$iok_io˘l
(
fûe
 *
fûp
, 
cmd
, 
¨g
)

42 
	$iok_io˘l
(
öode
 *
öo
, 
fûe
 *
fûp
, 
cmd
,

43 
¨g
)

46 
îr
 = 0, 
ªtvÆ
 = 0;

48 
	`MSG
("I¿io˘»mëhod, cmd=%d\n", 
	`_IOC_NR
(
cmd
));

51 i‡(
	`_IOC_TYPE
(
cmd
Ë!
IOCTL_KDRV_MAGIC
) {

52 
	`MSG
("ioctl fail 1\n");

53  -
ENOTTY
;

56 i‡(
	`_IOC_NR
(
cmd
Ë> 
IOCTL_KDRV_MAXIOCTL
) {

57 
	`MSG
("ioctl fail 2\n");

58  -
ENOTTY
;

62 i‡(
	`_IOC_DIR
(
cmd
Ë& 
_IOC_READ
)

64 
îr
 =

65 !
	`ac˚ss_ok
(
VERIFY_WRITE
, (
__u£r
 *)
¨g
,

66 
	`_IOC_SIZE
(
cmd
));

67 i‡(
	`_IOC_DIR
(
cmd
Ë& 
_IOC_WRITE
)

69 
îr
 =

70 !
	`ac˚ss_ok
(
VERIFY_READ
, (
__u£r
 *)
¨g
, 
	`_IOC_SIZE
(
cmd
));

71 i‡(
îr
)

72  -
EFAULT
;

74 
cmd
) {

75 
IOCTL_KDRV_IOCRESET
:

76 
	`MSG
("In option: IOCTL_KDRV_IOCRESET\n");

78 
IOCTL_KDRV_IOCQPOWER
:

79 
	`MSG
("I¿›ti⁄: IOCTL_KDRV_IOCQPOWER\n\
=0x%x (drvËpowî=%d\n", ()
¨g
, 
powî
);

81 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

82  -
EPERM
;

83 
ªtvÆ
 = 
	`__put_u£r
(
powî
, (
__u£r
 *)
¨g
);

85 
IOCTL_KDRV_IOCSPOWER
:

86 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

87  -
EPERM
;

88 
powî
 = 
¨g
;

89 
	`MSG
("I¿›ti⁄: IOCTL_KDRV_IOCSPOWER\n\
=%dÇow.\n", 
powî
);

93  -
ENOTTY
;

96  
ªtvÆ
;

97 
	}
}

99 
fûe_›î©i⁄s
 
	giok_f›s
 = {

100 .
Œ£ek
 = 
no_Œ£ek
,

101 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,36)

102 .
	gu∆ocked_io˘l
 = 
iok_io˘l
,

105 .
	gio˘l
 = 
iok_io˘l
,

109 
	$iok_›í
(
öode
 *öode, 
fûe
 *
fûp
)

111 
	`MSG
("Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

113 
	`imö‹
(
öode
)) {

115 
fûp
->
f_›
 = &
iok_f›s
;

118  -
ENXIO
;

120 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

121  
fûp
->
f_›
->
	`›í
(
öode
, filp);

124 
	}
}

127 
fûe_›î©i⁄s
 
	giok_›í_f›s
 = {

128 .
›í
 = 
iok_›í
,

134 
__öô
 
	$io˘l_kdrv_öô_moduÀ
()

136 
ªsu…
;

138 
	`MSG
("iok_maj‹=%d\n", 
iok_maj‹
);

144 
ªsu…
 = 
	`ªgi°î_chrdev
(
iok_maj‹
, 
MODULE_NAME
, &
iok_›í_f›s
);

145 i‡(
ªsu…
 < 0) {

146 
	`MSG
("register_chrdev() failedÅryingÅo get iok_major=%d\n",

147 
iok_maj‹
);

148  
ªsu…
;

151 i‡(
iok_maj‹
 == 0)

152 
iok_maj‹
 = 
ªsu…
;

153 
	`MSG
("ªgi°îed:: iok_maj‹=%d\n", 
iok_maj‹
);

155 
	`¥ötk
(
KERN_INFO
 "%†%†öôülized\n", 
MODULE_NAME
, 
MODULE_VER
);

157 
	}
}

162 
	$io˘l_kdrv_˛ónup_moduÀ
()

164 
	`uƒegi°î_chrdev
(
iok_maj‹
, 
MODULE_NAME
);

165 
	`¥ötk
(
KERN_INFO
 "%†%†ªmoved\n", 
MODULE_NAME
, 
MODULE_VER
);

166 
	}
}

168 
moduÀ_öô
(
io˘l_kdrv_öô_moduÀ
);

169 
moduÀ_exô
(
io˘l_kdrv_˛ónup_moduÀ
);

171 
MODULE_AUTHOR
("My Name");

172 
MODULE_DESCRIPTION
("A simple ioctl kernel usage demo");

173 
MODULE_LICENSE
("GPL");

	@Training/L3_dd_trg/ioctl_kernel_poc/ioctl_kdrv.h

9 
	#IOCTL_KDRV_MAGIC
 0x88

	)

29 
	#IOCTL_KDRV_IOCRESET
 
	`_IO
(
IOCTL_KDRV_MAGIC
, 0)

	)

31 
	#IOCTL_KDRV_IOCQPOWER
 
	`_IOR
(
IOCTL_KDRV_MAGIC
, 1, )

	)

33 
	#IOCTL_KDRV_IOCSPOWER
 
	`_IOW
(
IOCTL_KDRV_MAGIC
, 2, )

	)

35 
	#IOCTL_KDRV_MAXIOCTL
 3

	)

	@Training/L3_dd_trg/ioctl_kernel_poc/ioctl_user_test.c

8 
	~<°dio.h
>

9 
	~<uni°d.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<sys/°©.h
>

12 
	~<f˙é.h
>

13 
	~<sig«l.h
>

14 
	~<°dlib.h
>

16 
	~<sys/io˘l.h
>

17 
	~"io˘l_kdrv.h
"

19 
	#FLGS
 
O_RDWR


	)

20 
	#DMODE
 0

	)

22 
	$maö
(
¨gc
, **
¨gv
)

24 
fd
, 
powî
;

26 i‡(
¨gc
 < 2) {

27 
	`Ârötf
(
°dîr
, "Ußge: %†devi˚_fûe\n\
 devi˚_fûêd€†nŸÉxi°, cª©êô usög mknod(1Ë◊†roŸ)\n", 
¨gv
[0]);

29 
	`exô
(1);

32 i‡((
fd
 = 
	`›í
(
¨gv
[1], 
FLGS
, 
DMODE
)) == -1)

33 
	`≥º‹
("›í"), 
	`exô
(1);

34 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

36 
	`¥ötf
("IOCTL_KDRV_IOCRESET = 0x%x IOCTL_KDRV_IOCQPOWER= 0x%x IOCTL_KDRV_IOCSPOWER=0x%x\n",

37 
IOCTL_KDRV_IOCRESET
, ()
IOCTL_KDRV_IOCQPOWER
,

38 ()
IOCTL_KDRV_IOCSPOWER
);

41 i‡(
	`io˘l
(
fd
, 
IOCTL_KDRV_IOCRESET
, 0) == -1) {

42 
	`≥º‹
("ioctl IOCTL_KDRV_IOCRESET failed");

43 
	`˛o£
(
fd
);

44 
	`exô
(1);

46 
	`¥ötf
("%s: devi˚Ñe£t.\n", 
¨gv
[0]);

48 i‡(
	`io˘l
(
fd
, 
IOCTL_KDRV_IOCQPOWER
, &
powî
) == -1) {

49 
	`≥º‹
("ioctl IOCTL_KDRV_IOCQPOWER failed");

50 
	`˛o£
(
fd
);

51 
	`exô
(1);

53 
	`¥ötf
("%s:Öowî=%d\n", 
¨gv
[0], 
powî
);

55 i‡(!
powî
) {

56 
	`¥ötf
("Device OFF,Öowering it on in 3s...\n");

57 
	`¶ìp
(3);

58 i‡(
	`io˘l
(
fd
, 
IOCTL_KDRV_IOCSPOWER
, 1) == -1) {

59 
	`≥º‹
("ioctl IOCTL_KDRV_IOCSPOWER failed");

60 
	`˛o£
(
fd
);

61 
	`exô
(1);

63 
	`¥ötf
("%s:Öowî ONÇow.\n", 
¨gv
[0]);

65 
	`¥ötf
("%s:Öowîög OFFÇow..\n", 
¨gv
[0]);

66 i‡(
	`io˘l
(
fd
, 
IOCTL_KDRV_IOCSPOWER
, 0) == -1) {

67 
	`≥º‹
("ioctl IOCTL_KDRV_IOCSPOWER failed");

68 
	`˛o£
(
fd
);

69 
	`exô
(1);

71 
	`¥ötf
("%s:Öowî OFF ok,Éxôög..\n", 
¨gv
[0]);

74 
	`˛o£
(
fd
);

75 
	`exô
(0);

76 
	}
}

	@Training/L3_dd_trg/irq_work/irq_work.c

11 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

12 
	~<löux/öô.h
>

13 
	~<löux/moduÀ.h
>

14 
	~<löux/úq_w‹k.h
>

15 
	~"../c⁄víõ¡.h
"

17 
	#OURMODNAME
 "úq_w‹k"

	)

20 
	g¶ìp_ö_öå˘x
;

21 
moduÀ_∑øm
(
¶ìp_ö_öå˘x
, , 0660);

22 
MODULE_PARM_DESC
(
¶ìp_ö_öå˘x
,

26 
MODULE_AUTHOR
("Kaiwan NB, kaiwanTECH");

27 
MODULE_DESCRIPTION
("A simple demo ofÑunning in interrupt context viaÅhe irq_work");

28 
MODULE_LICENSE
("Dual MIT/GPL");

30 
úq_w‹k
 
	gúqw‹k
;

35 
	$my_úq_w‹k
(
úq_w‹k
 *
func
)

37 
	`PRINT_CTX
();

38 
	`dump_°ack
();

39 
	`¥_Æît_øãlimôed
("\nanálert-levelÑatelimitedÖrintk here!\n");

40 
	`åa˚_¥ötk
("... followed byáÅrace_printk()Åoo!\n");

42 i‡(
¶ìp_ö_öå˘x
 == 1) {

43 
	`¥_öfo
("attempting sleep in irq ctxÇow... (yes we know it's buggy :)\n");

44 
	`scheduÀ
();

46 
	}
}

48 
__öô
 
	$öå_drv_öô
()

50 
i
;

52 
	`¥_öfo
("param sleep_in_intrctx=%d (%s)\n",

53 
¶ìp_ö_öå˘x
, (sleep_in_intrctx == 0 ? "ok" : "Aaargh!"));

54 
	`PRINT_CTX
();

56 
	`öô_úq_w‹k
(&
úqw‹k
, 
my_úq_w‹k
);

58 
	#NUM_TIMES_TRIGGER
 3

	)

59 
i
 = 0; i < 
NUM_TIMES_TRIGGER
; i++) {

60 
	`¥_öfo
("åiggî i¡îru± w‹k, in°™˚ #%02d\n", 
i
);

62 
	`úq_w‹k_queue
(&
úqw‹k
);

66 
	}
}

68 
__exô
 
	$öå_drv_exô
()

70 
	`¥_öfo
("removed\n");

71 
	}
}

73 
moduÀ_öô
(
öå_drv_öô
);

74 
moduÀ_exô
(
öå_drv_exô
);

	@Training/L3_dd_trg/kthread_demo/ktdemo.c

6 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

8 
	~<löux/öô.h
>

9 
	~<löux/moduÀ.h
>

10 
	~<löux/sched.h
>

11 
	~<löux/sched/èsk.h
>

12 
	~<löux/sched/sig«l.h
>

13 
	~<löux/sig«l.h
>

14 
	~<löux/kthªad.h
>

15 
	~"../c⁄víõ¡.h
"

17 
	#MODULE_NAME
 "ktdemo"

	)

18 
èsk_°ru˘
 *
	ggKthrd
;

21 
	$mykt
(*
¨g
)

23 
	`¥_öfo
("name: %s PID: %d TGID: %d\n",

24 
cuºít
->
comm
, cuºít->
pid
, cuºít->
tgid
);

25 i‡(!
cuºít
->
mm
)

26 
	`¥_öfo
("mm field NULL.\n");

31 
	`Ælow_sig«l
(
SIGINT
);

32 
	`Ælow_sig«l
(
SIGQUIT
);

34 !
	`kthªad_should_°›
()) {

40 
	`¥_öfo
("K Thªad %d goögÅÿ¶ì∞now...\n", 
cuºít
->
pid
);

41 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
);

42 
	`scheduÀ
();

45 i‡(
	`sig«l_≥ndög
(
cuºít
))

50 
	`£t_cuºít_°©e
 (
TASK_RUNNING
);

51 
	`¥_öfo
("Kî√»thªad %dÉxôögÇow...\n", 
cuºít
->
pid
);

54 
	}
}

56 
	$ktdemo_öô
()

58 
ªt
=0, 
i
=0;

60 
	`¥_öfo
("Createá kernelÅhread...\n");

66 
gKthrd
 = 
	`kthªad_run
(
mykt
, 
NULL
, "%s.%d", 
MODULE_NAME
, 
i
);

68 i‡(
ªt
 < 0) {

69 
	`¥_îr
("kt1: kthªad_¸óã faûed (%d)\n", 
ªt
);

70  
ªt
;

72 
	`gë_èsk_°ru˘
(
gKthrd
);

74 
	`¥_öfo
("Module %s initialized,ÅhreadÅaskÖtr is 0x%pK (actual=0x%llx)\n"

77 
MODULE_NAME
, 
gKthrd
, ()gKthrd, MODULE_NAME);

79 
	}
}

81 
	$ktdemo_exô
()

83 
	`kthªad_°›
(
gKthrd
);

84 
	`put_èsk_°ru˘
(
gKthrd
);

85 
	`¥_öfo
("ModuÀ %†u∆ﬂded.\n", 
MODULE_NAME
);

86 
	}
}

88 
MODULE_LICENSE
("Dual MIT/GPL");

89 
MODULE_AUTHOR
("Kaiwan NB, kaiwanTECH");

90 
MODULE_DESCRIPTION
("Simple demo of creatingá kernelÅhread");

92 
moduÀ_öô
(
ktdemo_öô
);

93 
moduÀ_exô
(
ktdemo_exô
);

	@Training/L3_dd_trg/ktime_stuff/ktimers/ktimers.c

8 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

10 
	~<löux/öô.h
>

11 
	~<löux/kî√l.h
>

12 
	~<löux/moduÀ.h
>

13 
	~<löux/timî.h
>

14 
	~"../../c⁄víõ¡.h
"

16 
	#OURMODNAME
 "ktimîs"

	)

18 
MODULE_AUTHOR
("Kaiwan NB");

19 
MODULE_DESCRIPTION
("L3 LDDÅrg: using simple kernelÅimers");

20 
MODULE_LICENSE
("Dual MIT/GPL");

21 
MODULE_VERSION
("0.1");

23 
	skd©a
 {

24 
timî_li°
 
	mtmr
;

25 
	md©a
;

26 } 
	gkd
;

27 
	gexp_ms
 = 500;

29 
	$dög
(
timî_li°
 *
timr
)

31 
kd©a
 *
mykd
 = 
	`‰om_timî
(mykd, 
timr
, 
tmr
);

33 
	`PRINT_CTX
();

34 
	`¥_öfo
("timed out... d©a=%d\n", 
mykd
->
d©a
--);

37 i‡(
mykd
->
d©a
)

38 
	`mod_timî
(&
mykd
->
tmr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
));

39 
	}
}

41 
__öô
 
	$ktimîs_öô
()

43 
°©
 = 0;

45 
	`¥_öfo
("inserted\n");

47 
kd
.
d©a
 = 114;

48 
kd
.
tmr
.
expúes
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
);

49 
kd
.
tmr
.
Êags
 = 0;

50 
	`timî_£tup
(&
kd
.
tmr
, 
dög
, 0);

52 
	`¥_öfo
("timî sëÅÿexpúêö %ld ms\n", 
exp_ms
);

53 
°©
 = 
	`mod_timî
(&
kd
.
tmr
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(
exp_ms
));

54 i‡(
°©
 != 0) {

55 
	`¥_w¨n
("mod_timî faûed (%d)\n", 
°©
);

56  
°©
;

60 
	}
}

62 
__exô
 
	$ktimîs_exô
()

64 
	`¥_öfo
("wait forÖossibleÅimeoutsÅo complete...\n");

65 
	`dñ_timî_sync
(&
kd
.
tmr
);

66 
	`¥_öfo
("removed\n");

67 
	}
}

69 
moduÀ_öô
(
ktimîs_öô
);

70 
moduÀ_exô
(
ktimîs_exô
);

	@Training/L3_dd_trg/ktime_stuff/time_lld_cookbk/time.c

6 
	#¥_fmt
(
fmt
Ë"%s:%s: " fmt, 
KBUILD_MODNAME
, 
__func__


	)

7 
	~<löux/moduÀ.h
>

8 
	~<löux/dñay.h
>

9 
	~<löux/timekìpög.h
>

11 
	#¥öt_time
(
°r
, 
code
) \

13 
u64
 
t0
, 
t1
; \

14 
t0
 = 
	`ktime_gë_ªÆ_ns
(); \

15 
code
; \

16 
t1
 = 
	`ktime_gë_ªÆ_ns
(); \

17 
	`¥_öfo
(
°r
 " -> %11lluÇs = %5llu us = %3llu ms\n", \

18 (
t1
 - 
t0
), (t1-t0)/1000, (t1-t0)/1000000); \

19 } 0)

	)

25 
__öô
 
	$time_öô
()

28 
	`¥_öfo
("*delay() functions (atomic, iná delayÜoop):\n");

29 
	`¥öt_time
(" 10Ç†vüÇdñay(10)", 
	`ndñay
(10));

31 
	`¥öt_time
(" 10,000Ç†vü udñay(10)", 
	`udñay
(10));

32 
	`¥öt_time
("10,000,000Ç†vü mdñay(10)", 
	`mdñay
(10));

35 
	`¥_öfo
("*sleep() functions (process ctx, sleeps/schedule()'s out):\n\n");

37 
	`¥öt_time
(" 10,000Ç†vü u¶ìp_ønge(10,10)", 
	`u¶ìp_ønge
(10, 10));

39 
	`¥öt_time
(" 10,000,000Ç†vü m¶ìp(10)", 
	`m¶ìp
(10));

40 
	`¥öt_time
(" 10,000,000Ç†vü m¶ìp_öå(10)", 
	`m¶ìp_öãºu±ibÀ
(10));

42 
	`¥öt_time
("10,000,000,000Ç†vü s¶ìp(10)", 
	`s¶ìp
(10));

49  -
EINVAL
;

55 
	}
}

57 
__exô
 
	$time_exô
()

59 
	`¥_öfo
("unloaded\n");

60 
	}
}

62 
moduÀ_öô
(
time_öô
);

63 
moduÀ_exô
(
time_exô
);

65 
MODULE_LICENSE
("GPL");

66 
MODULE_AUTHOR
("Rodolfo Giometti");

67 
MODULE_DESCRIPTION
("KernelÅiming functions");

68 
MODULE_VERSION
("0.1");

	@Training/L3_dd_trg/ldm_template_drv/ldm_template_drv.c

13 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

14 
	#dev_fmt
(
fmt
Ë"%s(): " fmt, 
__func__


	)

16 
	~<löux/öô.h
>

17 
	~<löux/moduÀ.h
>

18 
	~<löux/kî√l.h
>

19 
	~<löux/sched.h
>

20 
	~<löux/¶ab.h
>

21 
	~<löux/vîsi⁄.h
>

22 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4, 11, 0)

23 
	~<löux/uac˚ss.h
>

24 
	~<löux/sched/sig«l.h
>

26 
	~<asm/uac˚ss.h
>

28 
	~<löux/devi˚.h
>

31 
MODULE_AUTHOR
("<yourÇame,Émail id>");

32 
MODULE_DESCRIPTION
("<driver 1Üine decription>");

33 
MODULE_LICENSE
("<license>");

49 <
	gchù«me
>
_¥obe
(<
foo
>
_˛õ¡
/
dev
 *
˛õ¡
/dev,

50 c⁄° <
foo
>
_devi˚_id
 *
id
)

57 
devi˚
 *
	gdev
 = &
˛õ¡
->
dev
;

86 c⁄° <
	gfoo
>
	g_devi˚_id
 <
	gchù«me
>
	g_id
[] = {

92 
MODULE_DEVICE_TABLE
(<
foo
>, <
chù«me
>
_id
);

97 #ifde‡
CONFIG_OF


98 c⁄° 
	gof_devi˚_id
 <
	gchù«me
>
	g_of_m©ch
[] = {

107 { .
com∑tibÀ
 = "<manufacturer>,<model-abc-xyz>", "<oem>,<model-abc>", },

111 
MODULE_DEVICE_TABLE
(
of
, <
chù«me
>
_of_m©ch
);

115 c⁄° 
	ga˝i_devi˚_id
 <
	gchù«me
>
	g_a˝i_id
[] = {

120 
MODULE_DEVICE_TABLE
(
a˝i
, <
chù«me
>
_a˝i_id
);

130 <
	gfoo
>
	g_drivî
 <
	gchù«me
>_driver = {

131 .
drivî
 = {

132 .
«me
 = "<driver-name-used-for-match>",

137 .
	gof_m©ch_èbÀ
 = 
of_m©ch_±r
(<
chù«me
>
_of_m©ch
),

139 .
	g¥obe
 = <
chù«me
>
_¥obe
,

140 .
	gªmove
 = <
chù«me
>
_ªmove
,

141 .
	gdisc⁄√˘
 = <
chù«me
>
_disc⁄√˘
,

143 .
	gid_èbÀ
 = <
chù«me
>
_id
,

145 .
	gsu•íd
 = <
chù«me
>
_su•íd
,

146 .
	gªsume
 = <
chù«me
>
_ªsume
,

164 
	gmoduÀ_
<
	gfoo
>
_drivî
(<
chù«me
>_driver);

	@Training/L3_dd_trg/lkm_template/lkm_template.c

10 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

12 
	~<löux/öô.h
>

13 
	~<löux/kî√l.h
>

14 
	~<löux/moduÀ.h
>

16 
	#OURMODNAME
 "lkm_ãm∂©e"

	)

18 
MODULE_AUTHOR
("<insert yourÇame here>");

19 
MODULE_DESCRIPTION
("a hello, worldÅype LKM");

20 
MODULE_LICENSE
("Dual MIT/GPL");

21 
MODULE_VERSION
("0.1");

23 
__öô
 
	$lkm_ãm∂©e_öô
()

25 
	`¥_öfo
("inserted\n");

27 
	}
}

29 
__exô
 
	$lkm_ãm∂©e_exô
()

31 
	`¥_öfo
("removed\n");

32 
	}
}

34 
moduÀ_öô
(
lkm_ãm∂©e_öô
);

35 
moduÀ_exô
(
lkm_ãm∂©e_exô
);

	@Training/L3_dd_trg/miscmj_chardrv/miscmj_cdrv.c

7 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

9 
	~<löux/kî√l.h
>

10 
	~<löux/moduÀ.h
>

11 
	~<löux/fs.h
>

12 
	~<löux/miscdevi˚.h
>

14 
MODULE_LICENSE
("Dual MIT/GPL");

16 
devi˚
 *
	gdev
;

20 
	$my_dev_›í
(
öode
 *öode, 
fûe
 *file)

22 
	`dev_dbg
(
dev
, "%s() called.\n"

24 
__func__
, 
	`imö‹
(
öode
));

26 
	}
}

28 
ssize_t
 
	$my_dev_ªad
(
fûe
 *fûe, 
__u£r
 *
buf
,

29 
size_t
 
cou¡
, 
loff_t
 *
off
)

31 
	`dev_dbg
(
dev
, "%s() called.\n"

33 
__func__
, 
cou¡
);

34  
cou¡
;

35 
	}
}

37 
ssize_t
 
	$my_dev_wrôe
(
fûe
 *fûe, c⁄° 
__u£r
 *
buf
,

38 
size_t
 
cou¡
, 
loff_t
 *
off
)

40 
	`dev_dbg
(
dev
, "%s() called.\n"

42 
__func__
, 
cou¡
);

43  
cou¡
;

44 
	}
}

46 
	$my_dev_˛o£
(
öode
 *öode, 
fûe
 *file)

49 
	}
}

51 
	$my_dev_io˘l
(
fûe
 *fûe, 
cmd
, 
¨g
)

53 
	`dev_dbg
(
dev
, "%s() called.\n"

55 
__func__
, 
cmd
, 
¨g
);

57 
	}
}

59 c⁄° 
fûe_›î©i⁄s
 
	gmy_dev_f›s
 = {

60 .
ow√r
 = 
THIS_MODULE
,

61 .
	g›í
 = 
my_dev_›í
,

62 .
	gªad
 = 
my_dev_ªad
,

63 .
	gwrôe
 = 
my_dev_wrôe
,

64 .
	gªÀa£
 = 
my_dev_˛o£
,

65 .
	gu∆ocked_io˘l
 = 
my_dev_io˘l
,

69 
	#DEVNODENM
 "miscdev"

	)

70 
miscdevi˚
 
	gmy_miscdevi˚
 = {

71 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

72 .
	g«me
 = 
DEVNODENM
,

74 .
	gmode
 = 0666,

75 .
	gf›s
 = &
my_dev_f›s
,

78 
__öô
 
	$miscdrv_öô
()

80 
ªt_vÆ
;

82 
	`¥_öfo
("misc char driver init\n");

85 
ªt_vÆ
 = 
	`misc_ªgi°î
(&
my_miscdevi˚
);

86 i‡(
ªt_vÆ
 != 0) {

87 
	`¥_îr
("couldÇotÑegisterÅhe misc device mydev");

88  
ªt_vÆ
;

90 
dev
 = 
my_miscdevi˚
.
this_devi˚
;

91 
	`dev_dbg
(
dev
, "devÖtr = 0x%pK [actual=0x%lx]; deviceÇode: /dev/%s\n",

92 
dev
, ()dev, 
DEVNODENM
);

95 
	}
}

97 
__exô
 
	$miscdrv_exô
()

100 
	`dev_dbg
(
dev
, "misc char driver unloading\n");

101 
	`misc_dîegi°î
(&
my_miscdevi˚
);

102 
	}
}

104 
moduÀ_öô
(
miscdrv_öô
);

105 
moduÀ_exô
(
miscdrv_exô
);

	@Training/L3_dd_trg/older/intr_ctx/intr_work.c

13 
	~<löux/öô.h
>

14 
	~<löux/moduÀ.h
>

15 
	~<löux/úq_w‹k.h
>

16 
	~"../c⁄víõ¡.h
"

18 
	#OURMODNAME
 "öå_w‹k"

	)

21 
	g¶ìp_ö_öå˘x
;

22 
moduÀ_∑øm
(
¶ìp_ö_öå˘x
, , 0660);

23 
MODULE_PARM_DESC
(
¶ìp_ö_öå˘x
,

27 
MODULE_LICENSE
("Dual MIT/GPL");

29 
úq_w‹k
 
	gúqw‹k
;

34 
	$my_úq_w‹k
(
úq_w‹k
 *
úqwk
)

36 
	`PRINT_CTX
();

37 
	`dump_°ack
();

38 
	`¥_w¨n_øãlimôed
("\n%s:áÑ©ñimôedÖrötk hîe!\n", 
OURMODNAME
);

40 
	`åa˚_¥ötk
("... followed byáÅrace_printk()Åoo!\n");

42 i‡(
¶ìp_ö_öå˘x
 == 1) {

43 
	`¥_öfo
("%s:áâem±ög sÀï i¿úq ctxÇow...\n", 
OURMODNAME
);

44 
	`scheduÀ
();

46 
	}
}

48 
__öô
 
	$öå_drv_öô
()

50 
i
;

52 
	`¥_öfo
("%s:Öaram sleep_in_intrctx=%d (%s)\n",

53 
OURMODNAME
, 
¶ìp_ö_öå˘x
,

54 (
¶ìp_ö_öå˘x
==0?"ok":"Aaargh!"));

55 
	`PRINT_CTX
();

57 
	`öô_úq_w‹k
(&
úqw‹k
, 
my_úq_w‹k
);

59 
	#NUM_TIMES_TRIGGER
 3

	)

60 
i
=0; i<
NUM_TIMES_TRIGGER
; i++) {

61 
	`¥_öfo
("%s:Åriggî i¡îru± w‹k, in°™˚ #%02d\n", 
OURMODNAME
, 
i
);

63 
	`úq_w‹k_queue
(&
úqw‹k
);

67 
	}
}

69 
__exô
 
	$öå_drv_exô
()

71 
	`¥_öfo
("%s:Ñemoved\n", 
OURMODNAME
);

72 
	}
}

74 
moduÀ_öô
(
öå_drv_öô
);

75 
moduÀ_exô
(
öå_drv_exô
);

	@Training/L3_dd_trg/older/sysfs_sample_parrot_drv/parrot_driver.c

21 
	~<löux/moduÀ.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/öô.h
>

24 
	~<löux/¶ab.h
>

25 
	~<löux/fs.h
>

26 
	~<löux/devi˚.h
>

27 
	~<löux/ty≥s.h
>

28 
	~<löux/muãx.h
>

29 
	~<löux/kfifo.h
>

30 
	~"∑ºŸ_drivî.h
"

33 
MODULE_AUTHOR
(
AUTHOR
);

34 
MODULE_DESCRIPTION
(
DESCRIPTION
);

35 
MODULE_VERSION
(
VERSION
);

36 
MODULE_LICENSE
("GPL");

39 
˛ass
* 
	g∑ºŸ_˛ass
 = 
NULL
;

40 
devi˚
* 
	g∑ºŸ_devi˚
 = 
NULL
;

41 
	g∑ºŸ_maj‹
;

43 
boﬁ
 
	gmesßge_ªad
;

45 
DEFINE_MUTEX
(
∑ºŸ_devi˚_muãx
);

47 
DECLARE_KFIFO
(
∑ºŸ_msg_fifo
, , 
PARROT_MSG_FIFO_SIZE
);

49 
	g∑ºŸ_msg_Àn
[
PARROT_MSG_FIFO_MAX
];

51 
	g∑ºŸ_msg_idx_rd
, 
	g∑ºŸ_msg_idx_wr
;

54 
boﬁ
 
	gdebug
 = 
åue
;

55 
moduÀ_∑øm
(
debug
, 
boﬁ
, 
S_IRUGO
 | 
S_IWUSR
);

56 
MODULE_PARM_DESC
(
debug
, "enable debug info (default:Årue)");

58 
boﬁ
 
	g⁄e_shŸ
 = 
åue
;

59 
moduÀ_∑øm
(
⁄e_shŸ
, 
boﬁ
, 
S_IRUGO
 | 
S_IWUSR
);

60 
MODULE_PARM_DESC
(
⁄e_shŸ
, "disableÅheÑeadout of multiple messagesát once (default:Årue)");

63 
	$∑ºŸ_devi˚_›í
(
öode
* inode, 
fûe
* 
fûp
)

65 
	`dbg
("");

68 i‡–((
fûp
->
f_Êags
 & 
O_ACCMODE
Ë=
O_WRONLY
)

69 || ((
fûp
->
f_Êags
 & 
O_ACCMODE
Ë=
O_RDWR
) ) {

70 
	`w¨n
("writeáccess isÖrohibited\n");

71  -
EACCES
;

76 i‡(!
	`muãx_åylock
(&
∑ºŸ_devi˚_muãx
)) {

77 
	`w¨n
("anotherÖrocess isáccessingÅhe device\n");

78  -
EBUSY
;

81 
mesßge_ªad
 = 
Ál£
;

83 
	}
}

85 
	$∑ºŸ_devi˚_˛o£
(
öode
* inode, 
fûe
* 
fûp
)

87 
	`dbg
("");

88 
	`muãx_u∆ock
(&
∑ºŸ_devi˚_muãx
);

90 
	}
}

92 
ssize_t
 
	$∑ºŸ_devi˚_ªad
(
fûe
* 
fûp
, 
__u£r
 *
buf„r
, 
size_t
 
Àngth
, 
loff_t
* 
off£t
)

94 
ªtvÆ
;

95 
c›õd
;

99 i‡(
⁄e_shŸ
 && 
mesßge_ªad
)  0;

100 
	`dbg
("");

102 i‡(
	`kfifo_is_em±y
(&
∑ºŸ_msg_fifo
)) {

103 
	`dbg
("no message in fifo\n");

107 
	`dbg
("∑ºŸ_msg_idx_rd = %dÖ¨rŸ_msg_idx_w∏%d\n", 
∑ºŸ_msg_idx_rd
, 
∑ºŸ_msg_idx_wr
);

108 
ªtvÆ
 = 
	`kfifo_to_u£r
(&
∑ºŸ_msg_fifo
, 
buf„r
, 
∑ºŸ_msg_Àn
[
∑ºŸ_msg_idx_rd
], &
c›õd
);

110 i‡(
∑ºŸ_msg_Àn
[
∑ºŸ_msg_idx_rd
] !
c›õd
) {

111 
	`w¨n
("shortÑead detected\n");

114 
∑ºŸ_msg_idx_rd
 = (∑ºŸ_msg_idx_rd+1)%
PARROT_MSG_FIFO_MAX
;

115 
mesßge_ªad
 = 
åue
;

116 
	`dbg
("∑ºŸ_msg_idx_rd = %dÖ¨rŸ_msg_idx_w∏%d\n", 
∑ºŸ_msg_idx_rd
, 
∑ºŸ_msg_idx_wr
);

118  
ªtvÆ
 ?ÑëvÆ : 
c›õd
;

119 
	}
}

123 
fûe_›î©i⁄s
 
	gf›s
 = {

124 .
ªad
 = 
∑ºŸ_devi˚_ªad
,

125 .
	g›í
 = 
∑ºŸ_devi˚_›í
,

126 .
	gªÀa£
 = 
∑ºŸ_devi˚_˛o£


131 
ssize_t
 
	$sysfs_add_to_fifo
(
devi˚
* 
dev
, 
devi˚_©åibuã
* 
©å
, c⁄° * 
buf
, 
size_t
 
cou¡
)

133 
c›õd
;

135 
	`dbg
("");

136 i‡(
	`kfifo_avaû
(&
∑ºŸ_msg_fifo
Ë< 
cou¡
) {

137 
	`w¨n
("notÉnough spaceÜeft on fifo\n");

138  -
ENOSPC
;

140 i‡((
∑ºŸ_msg_idx_wr
+1)%
PARROT_MSG_FIFO_MAX
 =
∑ºŸ_msg_idx_rd
) {

142 
	`w¨n
("messageÜengthÅable is full\n");

143  -
ENOSPC
;

147 
c›õd
 = 
	`kfifo_ö
(&
∑ºŸ_msg_fifo
, 
buf
, 
cou¡
);

148 
∑ºŸ_msg_Àn
[
∑ºŸ_msg_idx_wr
] = 
c›õd
;

149 i‡(
c›õd
 !
cou¡
) {

150 
	`w¨n
("short write detected\n");

152 
∑ºŸ_msg_idx_wr
 = (∑ºŸ_msg_idx_wr+1)%
PARROT_MSG_FIFO_MAX
;

153 
	`dbg
("∑ºŸ_msg_idx_rd = %dÖ¨rŸ_msg_idx_w∏%d\n", 
∑ºŸ_msg_idx_rd
, 
∑ºŸ_msg_idx_wr
);

155  
c›õd
;

156 
	}
}

159 
ssize_t
 
	$sysfs_ª£t
(
devi˚
* 
dev
, 
devi˚_©åibuã
* 
©å
, c⁄° * 
buf
, 
size_t
 
cou¡
)

161 
	`dbg
("");

165 
	`kfifo_ª£t
(&
∑ºŸ_msg_fifo
);

166 
∑ºŸ_msg_idx_rd
 = 
∑ºŸ_msg_idx_wr
 = 0;

168  
cou¡
;

169 
	}
}

174 
ssize_t
 
	$sysfs_fifo_°©us_ªad
(
devi˚
* 
dev
, 
devi˚_©åibuã
* 
©å
, * 
buf
)

176 
	`dbg
("");

177  
	`•rötf
(
buf
, "%d\n", 
∑ºŸ_msg_idx_rd
);

178 
	}
}

183 
ssize_t
 
	$sysfs_fifo_°©us_wrôãn
(
devi˚
* 
dev
, 
devi˚_©åibuã
* 
©å
, * 
buf
)

185 
	`dbg
("");

186  
	`•rötf
(
buf
, "%d\n", 
∑ºŸ_msg_idx_wr
);

187 
	}
}

193 
DEVICE_ATTR
(
fifo
, 
S_IWUSR
, 
NULL
, 
sysfs_add_to_fifo
);

194 
DEVICE_ATTR
(
ª£t
, 
S_IWUSR
, 
NULL
, 
sysfs_ª£t
);

196 
DEVICE_ATTR
(
°©us_ªad
, 
S_IRUGO
, 
sysfs_fifo_°©us_ªad
, 
NULL
);

197 
DEVICE_ATTR
(
°©us_wrôãn
, 
S_IRUGO
, 
sysfs_fifo_°©us_wrôãn
, 
NULL
);

217 
__öô
 
	$∑ºŸ_moduÀ_öô
()

219 
ªtvÆ
;

220 
	`dbg
("");

223 
∑ºŸ_maj‹
 = 
	`ªgi°î_chrdev
(0, 
DEVICE_NAME
, &
f›s
);

224 i‡(
∑ºŸ_maj‹
 < 0) {

225 
	`îr
("ÁûedÅÿªgi°î devi˚:Éº‹ %d\n", 
∑ºŸ_maj‹
);

226 
ªtvÆ
 = 
∑ºŸ_maj‹
;

227 
Áûed_chrdevªg
;

232 
∑ºŸ_˛ass
 = 
	`˛ass_¸óã
(
THIS_MODULE
, 
CLASS_NAME
);

233 i‡(
	`IS_ERR
(
∑ºŸ_˛ass
)) {

234 
	`îr
("ÁûedÅÿªgi°î devi˚ cœs†'%s'\n", 
CLASS_NAME
);

235 
ªtvÆ
 = 
	`PTR_ERR
(
∑ºŸ_˛ass
);

236 
Áûed_˛as§eg
;

267 
∑ºŸ_devi˚
 = 
	`devi˚_¸óã
(
∑ºŸ_˛ass
, 
NULL
, 
	`MKDEV
(
∑ºŸ_maj‹
, 0), NULL, 
CLASS_NAME
 "_" 
DEVICE_NAME
);

268 i‡(
	`IS_ERR
(
∑ºŸ_devi˚
)) {

269 
	`îr
("ÁûedÅÿ¸óã devi˚ '%s_%s'\n", 
CLASS_NAME
, 
DEVICE_NAME
);

270 
ªtvÆ
 = 
	`PTR_ERR
(
∑ºŸ_devi˚
);

271 
Áûed_devªg
;

281 
ªtvÆ
 = 
	`devi˚_¸óã_fûe
(
∑ºŸ_devi˚
, &
dev_©å_fifo
);

282 i‡(
ªtvÆ
 < 0) {

283 
	`w¨n
("failedÅo create write /sysÉndpoint [fifo] - continuing without\n");

285 
ªtvÆ
 = 
	`devi˚_¸óã_fûe
(
∑ºŸ_devi˚
, &
dev_©å_ª£t
);

286 i‡(
ªtvÆ
 < 0) {

287 
	`w¨n
("failedÅo createÑeset /sysÉndpoint [reset] - continuing without\n");

289 
ªtvÆ
 = 
	`devi˚_¸óã_fûe
(
∑ºŸ_devi˚
, &
dev_©å_°©us_ªad
);

290 i‡(
ªtvÆ
 < 0) {

291 
	`w¨n
("failedÅo createÑeset /sysÉndpoint [status_read] - continuing without\n");

293 
ªtvÆ
 = 
	`devi˚_¸óã_fûe
(
∑ºŸ_devi˚
, &
dev_©å_°©us_wrôãn
);

294 i‡(
ªtvÆ
 < 0) {

295 
	`w¨n
("failedÅo createÑeset /sysÉndpoint [status_written] - continuing without\n");

298 
	`muãx_öô
(&
∑ºŸ_devi˚_muãx
);

300 
	`INIT_KFIFO
(
∑ºŸ_msg_fifo
);

301 
∑ºŸ_msg_idx_rd
 = 
∑ºŸ_msg_idx_wr
 = 0;

303 
	`¥_öfo
(

307 
CLASS_NAME
, 
DEVICE_NAME
, CLASS_NAME);

310 
Áûed_devªg
:

311 
	`˛ass_uƒegi°î
(
∑ºŸ_˛ass
);

312 
	`˛ass_de°roy
(
∑ºŸ_˛ass
);

313 
Áûed_˛as§eg
:

314 
	`uƒegi°î_chrdev
(
∑ºŸ_maj‹
, 
DEVICE_NAME
);

315 
Áûed_chrdevªg
:

317 
	}
}

319 
__exô
 
	$∑ºŸ_moduÀ_exô
()

321 
	`dbg
("");

322 
	`devi˚_ªmove_fûe
(
∑ºŸ_devi˚
, &
dev_©å_fifo
);

323 
	`devi˚_ªmove_fûe
(
∑ºŸ_devi˚
, &
dev_©å_ª£t
);

324 
	`devi˚_ªmove_fûe
(
∑ºŸ_devi˚
, &
dev_©å_°©us_ªad
);

325 
	`devi˚_ªmove_fûe
(
∑ºŸ_devi˚
, &
dev_©å_°©us_wrôãn
);

326 
	`devi˚_de°roy
(
∑ºŸ_˛ass
, 
	`MKDEV
(
∑ºŸ_maj‹
, 0));

327 
	`˛ass_uƒegi°î
(
∑ºŸ_˛ass
);

328 
	`˛ass_de°roy
(
∑ºŸ_˛ass
);

329 
	`uƒegi°î_chrdev
(
∑ºŸ_maj‹
, 
DEVICE_NAME
);

330 
	}
}

333 
moduÀ_öô
(
∑ºŸ_moduÀ_öô
);

334 
moduÀ_exô
(
∑ºŸ_moduÀ_exô
);

	@Training/L3_dd_trg/older/sysfs_sample_parrot_drv/parrot_driver.h

21 
	#DEVICE_NAME
 "devi˚"

	)

22 
	#CLASS_NAME
 "∑ºŸ"

	)

23 
	#PARROT_MSG_FIFO_SIZE
 1024

	)

24 
	#PARROT_MSG_FIFO_MAX
 128

	)

26 
	#AUTHOR
 "PëêB©¨d <≥ã@akeo.õ>"

	)

27 
	#DESCRIPTION
 "'∑ºŸ' sam∂êdevi˚ drivî"

	)

28 
	#VERSION
 "0.3"

	)

31 
	#dbg
(
f‹m©
, 
¨g
...Ëdÿ{ i‡(
debug
Ë
	`¥_öfo
(
CLASS_NAME
 ": %s:%d " f‹m© , 
__FUNCTION__
 , 
__LINE__
 , ##árg); } 0)

	)

32 
	#îr
(
f‹m©
, 
¨g
...Ë
	`¥_îr
(
CLASS_NAME
 ": " f‹m©, ##árg)

	)

33 
	#öfo
(
f‹m©
, 
¨g
...Ë
	`¥_öfo
(
CLASS_NAME
 ": " f‹m©, ##árg)

	)

34 
	#w¨n
(
f‹m©
, 
¨g
...Ë
	`¥_w¨n
(
CLASS_NAME
 ": " f‹m©, ##árg)

	)

	@Training/L3_dd_trg/sleepy_waitq/rd_tst.c

22 
	~<°dio.h
>

23 
	~<uni°d.h
>

24 
	~<sys/ty≥s.h
>

25 
	~<limôs.h
>

26 
	~<sys/°©.h
>

27 
	~<f˙é.h
>

28 
	~<sig«l.h
>

29 
	~<°dlib.h
>

31 
	#FLGS
 
O_RDONLY


	)

32 
	#DMODE
 0

	)

33 
	#SZ
 1024

	)

35 
	$sig
(
signum
)

37 
	`Ârötf
(
°dîr
, "I¿sig: signum=%d\n", 
signum
);

38 
	}
}

40 
	$maö
(
¨gc
, **
¨gv
)

42 
fd
, 
n
;

43 
siga˘i⁄
 
a˘
;

44 *
buf
 = 
NULL
;

45 
size_t
 
num
 = 0;

47 i‡(
¨gc
 != 3) {

48 
	`Ârötf
(
°dîr
, "Usage: %s device_fileÇum_bytes_to_read\n",

49 
¨gv
[0]);

50 
	`exô
(1);

53 
a˘
.
ß_h™dÀr
 = 
sig
;

54 
a˘
.
ß_Êags
 = 
SA_RESTART
;

55 
	`sigem±y£t
(&
a˘
.
ß_mask
);

56 i‡((
	`siga˘i⁄
(
SIGINT
, &
a˘
, 0)) == -1) {

57 
	`≥º‹
("siga˘i⁄"), 
	`exô
(1);

60 i‡((
fd
 = 
	`›í
(
¨gv
[1], 
FLGS
, 
DMODE
)) == -1)

61 
	`≥º‹
("›í"), 
	`exô
(1);

62 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

64 
num
 = 
	`©oi
(
¨gv
[2]);

65 i‡((
num
 < 0Ë|| (num > 
INT_MAX
)) {

66 
	`Ârötf
(
°dîr
, "%s:Çumbî o‡byã†'%ld' invÆid.\n", 
¨gv
[0],

67 
num
);

68 
	`˛o£
(
fd
);

69 
	`exô
(1);

72 
buf
 = 
	`mÆloc
(
num
);

73 i‡(!
buf
) {

74 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!\n", 
¨gv
[0]);

75 
	`˛o£
(
fd
);

76 
	`exô
(1);

79 
n
 = 
	`ªad
(
fd
, 
buf
, 
num
);

80 i‡(
n
 < 0) {

81 
	`≥º‹
("read failed");

82 
	`‰ì
(
buf
);

83 
	`˛o£
(
fd
);

84 
	`exô
(1);

98 
	`¥ötf
("%s:Ñód %d byã†‰om %s\n", 
¨gv
[0], 
n
,árgv[1]);

99 
	`˛o£
(
fd
);

100 
	`‰ì
(
buf
);

101 
	`exô
(0);

102 
	}
}

	@Training/L3_dd_trg/sleepy_waitq/slpy.c

19 
	~<löux/kî√l.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/öô.h
>

22 
	~<löux/waô.h
>

23 
	~<löux/fs.h
>

24 
	~<löux/sched.h
>

26 
	#DRVNAME
 "¶py"

	)

28 #ifde‡
DEBUG


29 
	#MSG
(
°rög
, 
¨gs
...) \

30 
	`¥ötk
(
KERN_DEBUG
 "%s:%s:%d: " 
°rög
, \

31 
DRVNAME
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

33 
	#MSG
(
°rög
, 
¨gs
...)

	)

36 
©omic_t
 
	gd©a_¥e£¡
 = 
ATOMIC_INIT
(0);

37 
	g¶ìpy_maj‹
 = 0;

38 
DECLARE_WAIT_QUEUE_HEAD
(
wq
);

40 
MODULE_AUTHOR
("Kaiwan");

41 
MODULE_DESCRIPTION
("Trivial demo of usingá wait queue.");

42 
MODULE_LICENSE
("GPL/MIT");

49 
ssize_t
 
	$¶ìpy_ªad
(
fûe
 *
fûp
, 
__u£r
 * 
buf
,

50 
size_t
 
cou¡
, 
loff_t
 * 
ofÂ
)

52 i‡(
	`©omic_ªad
(&
d©a_¥e£¡
) == 0) {

53 
	`MSG
("¥o˚s†%d (%sËgoögÅÿ¶ìp\n", 
cuºít
->
pid
,

54 
cuºít
->
comm
);

55 i‡(
waô_evít_öãºu±ibÀ


56 (
wq
, (
	`©omic_ªad
(&
d©a_¥e£¡
) == 1))) {

57 
	`MSG
("wait interrupted by signal,Ñet -ERESTARTSYSÅo VFS..\n");

58  -
ERESTARTSYS
;

65 
	`MSG
("awoken %d (%s), data_present=%d\n",

66 
cuºít
->
pid
, cuºít->
comm
, 
	`©omic_ªad
(&
d©a_¥e£¡
));

68 
	`MSG
("%d (%s): Data isávailable,Öroceeding...\n",

69 
cuºít
->
pid
, cuºít->
comm
);

72  
cou¡
;

73 
	}
}

75 
ssize_t
 
	$¶ìpy_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 * 
buf
,

76 
size_t
 
cou¡
, 
loff_t
 * 
ofÂ
)

78 
	`MSG
("process %d (%s)áwakeningÅheÑeaders...\n",

79 
cuºít
->
pid
, cuºít->
comm
);

83 
	`©omic_£t
(&
d©a_¥e£¡
, 1);

85 
	`wake_up_öãºu±ibÀ
(&
wq
);

87  
cou¡
;

88 
	}
}

90 
fûe_›î©i⁄s
 
	g¶ìpy_f›s
 = {

91 .
ow√r
 = 
THIS_MODULE
,

92 .
	gŒ£ek
 = 
no_Œ£ek
,

93 .
	gªad
 = 
¶ìpy_ªad
,

94 .
	gwrôe
 = 
¶ìpy_wrôe
,

97 
__öô
 
	$¶py_öô_moduÀ
()

99 
ªsu…
;

101 
ªsu…
 = 
	`ªgi°î_chrdev
(
¶ìpy_maj‹
, 
DRVNAME
, &
¶ìpy_f›s
);

102 i‡(
ªsu…
 < 0)

103  
ªsu…
;

105 i‡(
¶ìpy_maj‹
 == 0)

106 
¶ìpy_maj‹
 = 
ªsu…
;

107 
	`¥ötk
(
KERN_DEBUG
 "¶ìpy: maj‹ # = %d\n", 
¶ìpy_maj‹
);

110 
	}
}

112 
__exô
 
	$¶py_˛ónup_moduÀ
()

114 
	`uƒegi°î_chrdev
(
¶ìpy_maj‹
, 
DRVNAME
);

115 
	`MSG
("Removed.\n");

116 
	}
}

118 
moduÀ_öô
(
¶py_öô_moduÀ
);

119 
moduÀ_exô
(
¶py_˛ónup_moduÀ
);

	@Training/L3_dd_trg/sleepy_waitq/wr_tst.c

23 
	~<°dio.h
>

24 
	~<uni°d.h
>

25 
	~<sys/ty≥s.h
>

26 
	~<sys/°©.h
>

27 
	~<f˙é.h
>

28 
	~<°dlib.h
>

30 
	#FLGS
 
O_RDWR


	)

31 
	#DMODE
 0

	)

32 
	#SZ
 1024

	)

34 
	$maö
(
¨gc
, **
¨gv
)

36 
fd
;

37 
size_t
 
n
;

38 
buf
[
SZ
];

40 i‡(
¨gc
 == 1) {

41 
	`Ârötf
(
°dîr
, "Ußge: %†devi˚_fûe\n", 
¨gv
[0]);

42 
	`exô
(1);

45 i‡((
fd
 = 
	`›í
(
¨gv
[1], 
FLGS
, 
DMODE
)) == -1)

46 
	`≥º‹
("›í"), 
	`exô
(1);

48 
n
 = 0;Ç < 
SZ
;Ç++)

49 
buf
[
n
] = '\0';

51 
n
 = 
	`wrôe
(
fd
, 
buf
, 1024);

52 i‡(
n
 == -1) {

53 
	`≥º‹
("write failed");

54 
	`˛o£
(
fd
);

55 
	`exô
(1);

58 
	`¥ötf
("¶ìpy:: wrŸê%ld byãs\n", 
n
);

59 
	`˛o£
(
fd
);

60 
	`exô
(0);

61 
	}
}

	@Training/L3_dd_trg/workq_slpydrv_plus_timer/workq_slpydrv.c

18 
	~<löux/öô.h
>

19 
	~<löux/kî√l.h
>

20 
	~<löux/moduÀ.h
>

21 
	~<löux/waô.h
>

22 
	~<löux/fs.h
>

23 
	~<löux/öãºu±.h
>

24 
	~<löux/sched.h
>

25 
	~<löux/w‹kqueue.h
>

26 
	~<löux/timî.h
>

27 
	~"../c⁄víõ¡.h
"

29 
	#DRVNAME
 "w‹kq_•lydrv"

	)

34 
	g¶ìpy_maj‹
=0;

35 
©omic_t
 
	gd©a_¥e£¡
=
ATOMIC_INIT
(0);

36 
DECLARE_WAIT_QUEUE_HEAD
(
wq
);

38 
w‹k_°ru˘
 
	gws
;

39 
timî_li°
 
	gtimr
;

40 
	gdñay£c
=7;

43 
MODULE_AUTHOR
("Kaiwan NB, kaiwanTECH");

44 
MODULE_DESCRIPTION
("Demo of usingá work queue (andÅimer).");

45 
MODULE_LICENSE
("Dual MIT/GPL");

48 
	$whì
(
timî_li°
 *
tmr
)

50 
	`¥_debug
("Timed out. jiffõs=%lu\n", 
jiffõs
);

51 
	`PRINT_CTX
();

55 
	`scheduÀ
();

58 
	`mod_timî
(&
timr
, 
jiffõs
 + 
dñay£c
*
HZ
);

59 
	}
}

64 
	$wq_func
(
w‹k_°ru˘
 *
w‹k
)

66 
	`¥_debug
("We'ª hîêdoög somêde„ºed w‹k! HZ=%d jiffõs=%lu\n", 
HZ
, 
jiffõs
);

67 
	`PRINT_CTX
();

68 
QPDS
;

69 
	`¥_debug
("\nNow sëtög u∞®◊uto-ª≥©ögËtimî wôh %d†expúy...\n", 
dñay£c
);

72 
	`mod_timî
(&
timr
, 
jiffõs
 + 
dñay£c
*
HZ
);

73 
	}
}

75 
ssize_t
 
	$¶ìpy_ªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
,

76 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

78 
	`¥_debug
("¥o˚s†%d (%sËgoögÅÿ¶ìp\n", 
cuºít
->
pid
, cuºít->
comm
);

81 i‡(
	`waô_evít_öãºu±ibÀ
(
wq
, 
	`©omic_ªad
(&
d©a_¥e£¡
)==1)) {

82 
	`¥_debug
("wait interrupted by signal,Ñet -ERESTARTSYSÅo VFS..\n");

83  -
ERESTARTSYS
;

86 
	`¥_öfo
("%s:áwoken %d (%s), data_present=%d\n",

87 
DRVNAME
, 
cuºít
->
pid
, cuºít->
comm
, 
	`©omic_ªad
(&
d©a_¥e£¡
));

90 
	}
}

92 
ssize_t
 
	$¶ìpy_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
,

93 
size_t
 
cou¡
, 
loff_t
 *
ofÂ
)

95 
	`¥_öfo
("%s: schedulög de„ºed w‹k i¿thêw‹k queuênow...\n", 
DRVNAME
);

96 
	`scheduÀ_w‹k
(&
ws
);

98 
	`¥_debug
("process %d (%s)áwakeningÅheÑeaders...\n",

99 
cuºít
->
pid
, cuºít->
comm
 );

101 
	`©omic_£t
(&
d©a_¥e£¡
, 1);

102 
	`wake_up_öãºu±ibÀ
(&
wq
);

105  
cou¡
;

106 
	}
}

109 
fûe_›î©i⁄s
 
	g¶ìpy_f›s
 = {

110 .
ow√r
 = 
THIS_MODULE
,

111 .
	gŒ£ek
 = 
no_Œ£ek
,

112 .
	gªad
 = 
¶ìpy_ªad
,

113 .
	gwrôe
 = 
¶ìpy_wrôe
,

116 
__öô
 
	$w‹kq_¶pydrv_öô_moduÀ
()

118 
ªsu…
;

120 
ªsu…
 = 
	`ªgi°î_chrdev
(
¶ìpy_maj‹
, 
DRVNAME
, &
¶ìpy_f›s
);

121 i‡(
ªsu…
 < 0)

122  
ªsu…
;

124 i‡(
¶ìpy_maj‹
 == 0)

125 
¶ìpy_maj‹
 = 
ªsu…
;

126 
	`¥_debug
("¶ìpy: maj‹ # = %d\n", 
¶ìpy_maj‹
);

129 
	`INIT_WORK
(&
ws
, 
wq_func
);

132 
	`timî_£tup
(&
timr
, 
whì
, 0);

134 
	`¥_öfo
("%s: w‹kQándÅimî inôülized..\n", 
DRVNAME
);

135 
	`¥_debug
("Loaded ok.\n");

138 
	}
}

140 
__exô
 
	$w‹kq_¶pydrv_˛ónup_moduÀ
()

142 
	`dñ_timî_sync
(&
timr
);

143 
	`Êush_scheduÀd_w‹k
();

144 
	`uƒegi°î_chrdev
(
¶ìpy_maj‹
, 
DRVNAME
);

145 
	`¥_debug
("Removed.\n");

146 
	}
}

148 
moduÀ_öô
(
w‹kq_¶pydrv_öô_moduÀ
);

149 
moduÀ_exô
(
w‹kq_¶pydrv_˛ónup_moduÀ
);

	@Training/L5_debug_trg/1_buggy_gdb_usermode/.1_correct.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<time.h
>

21 
	~<sys/°©.h
>

23 
	$maö
(
¨gc
, **
¨gv
)

25 
°©
 
°©buf
;

27 i‡(
¨gc
 != 2) {

28 
	`Ârötf
 (
°dîr
, "Ußge: %†fûíame\n", 
¨gv
[0]);

29 
	`exô
 (1);

33 
	`°©
(
¨gv
[1], &
°©buf
);

44 
	`¥ötf
("%s:\n"

48 
¨gv
[1], 
°©buf
.
°_öo
,

49 
°©buf
.
°_size
, 
	`˘ime
(&°©buf.
°_mtime
),

50 
°©buf
.
°_uid
, sètbuf.
°_gid
,

51 
°©buf
.
°_blksize
, sètbuf.
°_blocks
);

53 
	`exô
(0);

54 
	}
}

	@Training/L5_debug_trg/1_buggy_gdb_usermode/1_buggy.c

18 
	~<°dio.h
>

19 
	~<time.h
>

20 
	~<sys/°©.h
>

22 
	$maö
(
¨gc
, **
¨gv
)

24 
°©
 
°©buf
;

25 
cmd
[128];

27 i‡(
¨gc
 != 2) {

28 
	`Ârötf
 (
°dîr
, "Usage: %s filename\n");

29 
	`exô
 (1);

33 
	`°©
(
¨gv
[1], &
°©buf
);

44 
	`¥ötf
("%s:\n"

48 
¨gv
[1], 
°©buf
.
°_öo
,

49 
°©buf
.
°_size
, 
	`˘ime
(°©buf.
°_mtime
),

50 
°©buf
.
°_uid
, sètbuf.
°_gid
,

51 
°©buf
.
°_blksize
, sètbuf.
°_blocks
);

53 
	`exô
(0);

54 
	}
}

	@Training/L5_debug_trg/1_buggy_gdb_usermode/1buggy_segv_handler/1buggy_segv_handler.c

18 
	~<°dio.h
>

19 
	~<°dlib.h
>

20 
	~<uni°d.h
>

21 
	~<time.h
>

22 
	~<sys/°©.h
>

23 
	~<sig«l.h
>

24 
	~<î∫o.h
>

26 
	$myÁu…
(
signum
, 
sigöfo_t
 * 
sigöfo
, *
ª°
)

28 
c
 = 0;

30 
	`¥ötf
("*** %s: [%d]Ñeceived signal %d.Érrno=%d\n"

32 
__func__
, ++
c
, 
signum
, 
sigöfo
->
si_î∫o
, sigöfo->
si_code
);

34 
sigöfo
->
si_code
) {

35 
SI_USER
:

36 
	`¥ötf
("user\n");

38 
SI_KERNEL
:

39 
	`¥ötf
("kernel\n");

41 
SI_QUEUE
:

42 
	`¥ötf
("queue\n");

44 
SI_TIMER
:

45 
	`¥ötf
("timer\n");

47 
SI_MESGQ
:

48 
	`¥ötf
("mesgq\n");

50 
SI_ASYNCIO
:

51 
	`¥ötf
("async io\n");

53 
SI_SIGIO
:

54 
	`¥ötf
("sigio\n");

56 
SI_TKILL
:

57 
	`¥ötf
("t[g]kill\n");

60 
SEGV_MAPERR
:

61 
	`¥ötf
("SEGV_MAPERR:áddressÇot mappedÅo object\n");

63 
SEGV_ACCERR
:

64 
	`¥ötf
("SEGV_ACCERR: invalidÖermissions for mapped object\n");

71 
SEGV_BNDERR
:

72 
	`¥ötf
("SEGV_BNDERR: failedáddress bound checks\n");

73 
SEGV_PKUERR
:

74 
¥ötf


78 
	`¥ötf
("-none-\n");

80 
	`¥ötf
(" Fau…ögáddr=%p\n", 
sigöfo
->
si_addr
);

82 
	`Ârötf
(
°dîr
,

84 
	`psigöfo
(
sigöfo
, "psiginfo helper");

85 
	`Ârötf
(
°dîr
,

88 
	`∑u£
();

100 i‡(
	`sig«l
(
SIGSEGV
, 
SIG_DFL
Ë=
SIG_ERR
) {

101 
	`Ârötf
(
°dîr
, "signal -reverting SIGSEGVÅo default- failed\n");

102 
	`exô
(
EXIT_FAILURE
);

104 i‡(
	`øi£
(
SIGSEGV
)) {

105 
	`Ârötf
(
°dîr
, "raise SIGSEGV failed\n");

106 
	`exô
(
EXIT_FAILURE
);

108 
	}
}

116 
	$£tup_Ætsig°ack
(
size_t
 
°ack_sz
)

118 
°ack_t
 
ss
;

120 
	`¥ötf
("A… sig«»°ack sizê%zu byãs\n", 
°ack_sz
);

121 
ss
.
ss_•
 = 
	`mÆloc
(
°ack_sz
);

122 i‡(!
ss
.
ss_•
){

123 
	`¥ötf
("mÆloc(%zuËf‹á… sig sèck faûed\n", 
°ack_sz
);

124  -
ENOMEM
;

127 
ss
.
ss_size
 = 
°ack_sz
;

128 
ss
.
ss_Êags
 = 0;

129 i‡(
	`sigÆt°ack
(&
ss
, 
NULL
) == -1){

130 
	`¥ötf
("sigÆt°ack f‹ sizê%zu faûed!\n", 
°ack_sz
);

131  -
î∫o
;

136 
	}
}

138 
	$maö
(
¨gc
, **
¨gv
)

140 
siga˘i⁄
 
a˘
;

141 
°©
 
°©buf
;

142 
cmd
[128];

144 i‡(
¨gc
 != 2) {

145 
	`Ârötf
 (
°dîr
, "Usage: %s filename\n");

146 
	`exô
 (1);

148 
	`¥ötf
("%s:%d\n", 
¨gv
[0], 
	`gëpid
());

158 i‡(
	`£tup_Ætsig°ack
(10*1024*1024) < 0) {

159 
	`Ârötf
(
°dîr
, "%s: sëtög u∞Æàsig sèck faûed\n", 
¨gv
[0]);

160 
	`exô
(1);

163 
	`mem£t
(&
a˘
, 0, (act));

164 
a˘
.
ß_siga˘i⁄
 = 
myÁu…
;

165 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
 | 
SA_ONSTACK
;

166 
	`sigem±y£t
(&
a˘
.
ß_mask
);

167 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

168 
	`≥º‹
("sigaction");

169 
	`exô
(1);

173 
	`°©
(
¨gv
[1], &
°©buf
);

184 
	`¥ötf
("%s:\n"

188 
¨gv
[1], 
°©buf
.
°_öo
,

189 
°©buf
.
°_size
, 
	`˘ime
(°©buf.
°_mtime
),

190 
°©buf
.
°_uid
, sètbuf.
°_gid
,

191 
°©buf
.
°_blksize
, sètbuf.
°_blocks
);

193 
	`exô
(0);

194 
	}
}

	@Training/L5_debug_trg/1_buggy_gdb_usermode/gdb_2part_solution/1_buggy.c

18 
	~<°dio.h
>

19 
	~<time.h
>

20 
	~<sys/°©.h
>

22 
	$maö
(
¨gc
, **
¨gv
)

24 
°©
 
°©buf
;

26 i‡(
¨gc
 != 2) {

27 
	`Ârötf
 (
°dîr
, "Usage: %s filename\n");

28 
	`exô
 (1);

32 
	`°©
 (
¨gv
[1], &
°©buf
);

40 
	`¥ötf
 ("%s:\ninodeÇumber: %d : size (bytes): %d : mtime: %s\n",

41 
¨gv
[1], 
°©buf
.
°_öo
,

42 
°©buf
.
°_size
, 
	`˘ime
(°©buf.
°_mtime
));

44 
	`exô
 (0);

45 
	}
}

	@Training/L5_debug_trg/1_buggy_gdb_usermode/vaddr.c

2 
	~<°dio.h
>

3 
	~<°dlib.h
>

4 
	~<uni°d.h
>

7 #unde‡
BITS_32


9 #ifde‡
BITS_32


10 
	#FMTSPC
 "%08x"

	)

11 
	#TYPECST
 

	)

13 
	#FMTSPC
 "%08lx"

	)

14 
	#TYPECST
 

	)

16 
	tu32
;

18 *
ívú⁄
;

19 
	ggi
=5, 
	ggu
;

21 
	$maö
(
¨gc
, **
¨gv
)

23 
loˇl
=0xff, *
hópmem
;

24 
i
=1, 
j
=2, 
k
=3;

26 
hópmem
 = 
	`mÆloc
(1024);

27 
	`¥ötf
 ("[pid %d]:\nva: &maö = 0x" 
FMTSPC
 " &gi = 0x" FMTSPC " &gu = 0x" FMTSPC " &heapmem = 0x" \

28 
FMTSPC
 " &local = 0x" FMTSPC " &environ = 0x" FMTSPC "\n",

29 
	`gëpid
(), (
TYPECST
Ë&
maö
, (TYPECSTË&
gi
, (TYPECSTË&
gu
,

30 (
TYPECST
Ë
hópmem
, (TYPECSTË&
loˇl
, (TYPECST)
ívú⁄
);

32 
	`∑u£
();

33 
	`‰ì
 (
hópmem
);

34 
	`exô
 (0);

35 
	}
}

	@Training/L5_debug_trg/1by10.c

10 
	~<°dio.h
>

11 
	gªs
 = 0;

13 
	$maö
()

15 
ªs
 = 1.0/10.0;

16 
	`¥ötf
("ª†o‡1/10 i†%.30f\n", 
ªs
);

17 
	}
}

	@Training/L5_debug_trg/kernel_debug/convenient.c

11 #i‚de‡
__KERNEL__


13 
	~<°dio.h
>

14 
	~<uni°d.h
>

15 
	~<°dlib.h
>

16 
	~<time.h
>

17 
	~<î∫o.h
>

18 
	~<°rög.h
>

19 
	~<sys/time.h
>

24 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

25 
timevÆ
 *
y
)

28 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

29 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

30 
y
->
tv_u£c
 -1000000 * 
n£c
;

31 
y
->
tv_£c
 +
n£c
;

33 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

34 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

35 
y
->
tv_u£c
 +1000000 * 
n£c
;

36 
y
->
tv_£c
 -
n£c
;

41 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

42 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

45  
x
->
tv_£c
 < 
y
->tv_sec;

46 
	}
}

57 
	$dec2bö
(
decimÆ
, *
bö¨y
)

59 
k
 = 0, 
n
 = 0;

60 
√g_Êag
 = 0;

61 
ªmaö
;

71 #unde‡
TESTMODE


73 #ifde‡
TESTMODE


74 
ﬁd_decimÆ
;

76 
ãmp
[80];

79 i‡(
decimÆ
 < 0) {

80 
decimÆ
 = -decimal;

81 
√g_Êag
 = 1;

84 #ifde‡
TESTMODE


85 
ﬁd_decimÆ
 = 
decimÆ
;

87 
ªmaö
 = 
decimÆ
 % 2;

89 
decimÆ
 = decimal / 2;

91 #ifde‡
TESTMODE


92 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

93 
ªmaö
);

96 
ãmp
[
k
++] = 
ªmaö
 + '0';

97 } 
decimÆ
 > 0);

99 i‡(
√g_Êag
)

100 
ãmp
[
k
++] = '-';

102 
ãmp
[
k
++] = ' ';

105 
k
 >= 0)

106 
bö¨y
[
n
++] = 
ãmp
[--
k
];

108 
bö¨y
[
n
 - 1] = 0;

109 
	}
}

117 #i‚de‡
_TIME_H


118 
	~<time.h
>

120 
	$r_¶ìp
(
time_t
 
£c
, 
n£c
)

122 
time•ec
 
ªq
, 
ªm
;

124 
ªq
.
tv_£c
 = 
£c
;

125 
ªq
.
tv_n£c
 = 
n£c
;

126 
	`«no¶ìp
(&
ªq
, &
ªm
) == -1) {

127 i‡(
î∫o
 !
EINTR
)

133 #ifde‡
DEBUG


134 
	`Ârötf
(
°dîr
,

136 
ªm
.
tv_£c
,Ñem.
tv_n£c
);

138 
ªq
 = 
ªm
;

141 
	}
}

149 
	$hex_dump
(*
d©a
, 
size
, *
ˇ±i⁄
, 
vîbo£
)

151 
i
;

152 
j
;

153 
ãmp
[8];

154 
buf„r
[128];

155 *
ascii
;

157 
	`mem£t
(
buf„r
, 0, 128);

159 i‡(
vîbo£
 && 
ˇ±i⁄
)

160 
	`¥ötf
("---------> %†<--------- (%d byã†‰om %p)\n", 
ˇ±i⁄
,

161 
size
, 
d©a
);

164 
¥ötf


169 
ascii
 = 
buf„r
 + 58;

170 
	`mem£t
(
buf„r
, ' ', 58 + 16);

171 
buf„r
[58 + 16] = '\n';

172 
buf„r
[58 + 17] = '\0';

173 
buf„r
[0] = '+';

174 
buf„r
[1] = '0';

175 
buf„r
[2] = '0';

176 
buf„r
[3] = '0';

177 
buf„r
[4] = '0';

178 
i
 = 0, 
j
 = 0; i < 
size
; i++, j++) {

179 i‡(
j
 == 16) {

180 
	`¥ötf
("%s", 
buf„r
);

181 
	`mem£t
(
buf„r
, ' ', 58 + 16);

183 
	`•rötf
(
ãmp
, "+%04x", 
i
);

184 
	`mem˝y
(
buf„r
, 
ãmp
, 5);

186 
j
 = 0;

189 
	`•rötf
(
ãmp
, "%02x", 0xf‡& 
d©a
[
i
]);

190 
	`mem˝y
(
buf„r
 + 8 + (
j
 * 3), 
ãmp
, 2);

191 i‡((
d©a
[
i
] > 31) && (data[i] < 127))

192 
ascii
[
j
] = 
d©a
[
i
];

194 
ascii
[
j
] = '.';

197 i‡(
j
 != 0)

198 
	`¥ötf
("%s", 
buf„r
);

199 
	}
}

201 
	$h™dÀ_îr
(
Áèl
, c⁄° *
fmt
, ...)

203 
	#ERRSTRMAX
 512

	)

204 *
îr_°r
;

205 
va_li°
 
¨gp
;

207 
îr_°r
 = 
	`mÆloc
(
ERRSTRMAX
);

208 i‡(
îr_°r
 =
NULL
)

211 
	`va_°¨t
(
¨gp
, 
fmt
);

212 
	`v¢¥ötf
(
îr_°r
, 
ERRSTRMAX
 - 1, 
fmt
, 
¨gp
);

213 
	`va_íd
(
¨gp
);

215 
	`Ârötf
(
°dîr
, "%s", 
îr_°r
);

216 i‡(
î∫o
)

217 
	`≥º‹
("perror says");

219 
	`‰ì
(
îr_°r
);

220 i‡(!
Áèl
)

222 
	`exô
(
Áèl
);

223 
	}
}

	@Training/L5_debug_trg/kernel_debug/convenient.h

16 #i‚de‡
__LKD_CONVENIENT_H__


17 
	#__LKD_CONVENIENT_H__


	)

19 
	~<asm/∑øm.h
>

20 
	~<löux/sched.h
>

22 #ifde‡
__KERNEL__


23 
	~<löux/øãlimô.h
>

52 #unde‡
USE_FTRACE_BUFFER


54 #ifde‡
USE_FTRACE_BUFFER


55 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

56 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

58 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

59 
USE_RATELIMITING
 = 1; \

60 i‡(
USE_RATELIMITING
) { \

61 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

64 
	`¥_öfo
(
°rög
, ##
¨gs
); \

65 } 0)

	)

70 #ifde‡
DEBUG


71 #ifde‡
__KERNEL__


72 
	#MSG
(
°rög
, 
¨gs
...) do { \

73 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

74 } 0)

	)

76 
	#MSG
(
°rög
, 
¨gs
...) do { \

77 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

78 } 0)

	)

81 #ifde‡
__KERNEL__


82 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

83 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

84 } 0)

	)

86 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

87 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

88 } 0)

	)

92 
	#QP
 
	`MSG
("\n")

	)

94 #ifde‡
__KERNEL__


95 #i‚de‡
USE_FTRACE_BUFFER


96 
	#QPDS
 do { \

97 
	`MSG
("\n"); \

98 
	`dump_°ack
(); \

99 } 0)

	)

101 
	#QPDS
 do { \

102 
	`MSG
("\n"); \

103 
	`åa˚_dump_°ack
(); \

104 } 0)

	)

108 #ifde‡
__KERNEL__


109 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

110 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

111 } 0)

	)

114 
	#MSG
(
°rög
, 
¨gs
...)

	)

115 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

116 
	#QP


	)

117 
	#QPDS


	)

125 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

126 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

127 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

128 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

129 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

131 #ifde‡
__KERNEL__


157 
	~<löux/sched.h
>

158 
	~<löux/öãºu±.h
>

160 
	#PRINT_CTX
() do { \

161 
PRINTCTX_SHOWHDR
 = 0; \

162 
öå
 = '.'; \

163 i‡(!
	`ö_èsk
()) { \

164 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

165 
öå
 = 'H'; \

166 i‡(
	`ö_úq
()) \

167 
öå
 = 'h'; \

168 i‡(
	`ö_so·úq
()) \

169 
öå
 = 's'; \

172 
öå
 = '.'; \

174 i‡(
PRINTCTX_SHOWHDR
 == 1) \

175 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

176 
	`¥_debug
( \

180 , 
	`øw_smp_¥o˚ss‹_id
(), \

181 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

182 (
	`úqs_dißbÀd
()?'d':'.'), \

183 (
	`√ed_ªsched
()?'N':'.'), \

184 
öå
, \

185 (
	`¥ìm±_cou¡
() && 0xff), \

186 
__func__
 \

188 } 0)

	)

220 #ifde‡
__KERNEL__


221 
	#as£π
(
ex¥
) do { \

222 i‡(!(
ex¥
)) { \

223 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

224 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

226 } 0)

	)

230 
ölöe
 
	$bìp
(
wh©
)

232 #ifde‡
__KERNEL__


233 
	`¥_öfo
("%c", ()
wh©
);

235 
	~<uni°d.h
>

236 
buf
 = ()
wh©
;

237 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

239 
	}
}

248 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

250 
c
 = 0, 
m
; \

251 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

253 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

254 
	`bìp
((
vÆ
)); \

255 
c
++; \

256 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

257 
m
 = 0; m < 50; m++); \

258 
x
 = 
ö√r_ödex
 / 2; \

262 }

	)

265 #ifde‡
__KERNEL__


266 
dñay_£c
();

278 
	$dñay_£c
(
vÆ
)

280 
	`asm
 ("");

281 i‡(
	`ö_èsk
()) {

282 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

283 i‡(
vÆ
 == -1)

284 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

286 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

288 
	}
}

291 #ifde‡
__KERNEL__


299 
	~<löux/jiffõs.h
>

300 
	~<löux/ktime.h
>

301 
	#SHOW_DELTA
(
œãr
, 
óæõr
) do { \

302 i‡(
	`time_a·î
(()
œãr
, ()
óæõr
)) { \

303 
s64
 
dñè_ns
 = 
	`ktime_to_ns
(
	`ktime_sub
(
œãr
, 
óæõr
)); \

304 
	`¥_öfo
("dñè: %ŒdÇs", 
dñè_ns
); \

305 i‡(
dñè_ns
/1000 >= 1) \

306 
	`¥_c⁄t
(" (~ %Œd us", 
dñè_ns
/1000); \

307 i‡(
dñè_ns
/1000000 >= 1) \

308 
	`¥_c⁄t
(" ~ %Œd ms", 
dñè_ns
/1000000); \

309 i‡(
dñè_ns
/1000 >= 1) \

310 
	`¥_c⁄t
(")\n"); \

312 
	`¥_w¨n
("SHOW_DELTA(): *invalid*Éarlier >Üater? (check order ofÖarams)\n"); \

313 } 0)

	)

	@Training/L5_debug_trg/kernel_debug/convenient_simpler.h

10 #i‚de‡
__CONVENIENT_H__


11 
	#__CONVENIENT_H__


	)

13 
	~<asm/∑øm.h
>

14 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/öãºu±.h
>

20 
	#PRINT_CTX
() { \

21 i‡(
	`¥ötk_øãlimô
()) { \

22 
	`¥ötk
("PRINT_CTX:: i¿fun˘i⁄ %†⁄ cpu #%2d\n", 
__func__
, 
	`smp_¥o˚ss‹_id
()); \

23 i‡(!
	`ö_öãºu±
()) \

24 
	`¥ötk
(" i¿¥o˚s†c⁄ãxt: %s:%d\n", 
cuºít
->
comm
, cuºít->
pid
); \

26 
	`¥ötk
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. in_serving_softirq:%3s.Öreempt_count=0x%x\n", \

27 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

28 (
	`ö_£rvög_so·úq
()?"yes":"no"), 
	`¥ìm±_cou¡
()); \

30 }

	)

33 #ifde‡
DEBUG


34 #ifde‡
__KERNEL__


35 
	#MSG
(
°rög
, 
¨gs
...) \

36 
	`¥ötk
(
KERN_INFO
 "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

38 
	#MSG
(
°rög
, 
¨gs
...) \

39 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

42 #ifde‡
__KERNEL__


43 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

44 
	`¥ötk
(
KERN_INFO
 
°rög
, ##
¨gs
)

	)

46 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

47 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
)

	)

50 
	#QP
 
	`MSG
("\n")

	)

52 #ifde‡
__KERNEL__


53 
	#QPDS
 do { \

54 
	`MSG
("\n"); \

55 
	`dump_°ack
(); \

56 } 0)

	)

57 
	#PRCS_CTX
 do { \

58 i‡(!
	`ö_öãºu±
()) { \

59 
	`MSG
("¥c†˘x: %s(%d)\n", 
cuºít
->
comm
, cuºít->
pid
); \

62 
	`MSG
("irq ctx\n"); \

63 
	`PRINT_IRQCTX
(); \

65 } 0)

	)

68 #ifde‡
__KERNEL__


69 
	#HexDump
(
‰om_addr
, 
Àn
) \

70 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

73 
	#MSG
(
°rög
, 
¨gs
...)

	)

74 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

75 
	#QP


	)

76 
	#QPDS


	)

80 #ifde‡
__KERNEL__


81 
	#as£π
(
ex¥
) \

82 i‡(!(
ex¥
)) { \

83 
	`¥ötk
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

84 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

85 }

	)

89 
ölöe
 
	$bìp
(
wh©
)

91 #ifde‡
__KERNEL__


92 ()
	`¥ötk
(
KERN_INFO
 "%c", ()
wh©
);

94 ()
	`¥ötf
("%c", ()
wh©
);

96 
	}
}

103 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

105 
c
=0, 
m
;\

106 
f‹_ödex
,
ö√r_ödex
; \

108 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

109 
	`bìp
((
vÆ
)); \

110 
c
++;\

111 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

112 
m
=0;m<50;m++); \

115 }

	)

118 #ifde‡
__KERNEL__


123 
	#DELAY_SEC
(
vÆ
) \

125 i‡(!
	`ö_öãºu±
()) { \

126 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

127 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

129 }

	)

132 #i‚de‡
__KERNEL__


133 
timevÆ_subåa˘
(
timevÆ
 *, timeval *, timeval *);

134 
dec2bö
(, *);

135 
r_¶ìp
(
time_t
, );

136 
îr_exô
(*, *, );

137 
hex_dump
(*
d©a
, 
size
, *
ˇ±i⁄
, 
vîbo£
);

140 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

142 i‡(
vîbo£
) \

143 
	`¥ötf
(
°r
, ##
¨gs
); \

144 } 0)

	)

	@Training/L5_debug_trg/kernel_debug/ctemplate.c

12 
	~<°dio.h
>

13 
	~<°dlib.h
>

14 
	~<uni°d.h
>

15 
	~<sys/ty≥s.h
>

26 
	$maö
(
¨gc
, **
¨gv
)

28 i‡(
¨gc
 < 2) {

29 
	`Ârötf
(
°dîr
, "Ußge: %†\n", 
¨gv
[0]);

30 
	`exô
(
EXIT_FAILURE
);

33 
	`exô
 (
EXIT_SUCCESS
);

34 
	}
}

	@Training/L5_debug_trg/kernel_debug/debugfs/01_debugfs_all_eg/debugfs_eg.c

9 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

11 
	~<löux/öô.h
>

12 
	~<löux/moduÀ.h
>

13 
	~<löux/sched.h
>

14 
	~<löux/debugfs.h
>

15 
	~<löux/¶ab.h
>

16 
	~<löux/uac˚ss.h
>

20 
	#DRVNAME
 "debugfs_sim∂e"

	)

22 
	#DBGFS_CREATE_ERR
(
pDíåy
, 
°r
) do { \

23 
	`¥_îr
("%s: faûed.\n", 
°r
); \

24 i‡(
	`PTR_ERR
(
pDíåy
Ë=-
ENODEV
) \

25 
	`¥_w¨n
(" debugfs supportÇotávailable?\n"); \

26 
	`debugfs_ªmove_ªcursive
(
pDíåy
); \

27  
	`PTR_ERR
(
pDíåy
); \

28 } 0)

	)

31 
díåy
 *
	g∑ª¡
;

37 
ssize_t
 
	$dbgfs_gíªad
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

39 *
d©a
 = (*)
fûp
->
f_öode
->
i_¥iv©e
;

41 
	`¥_debug
("d©a: %†Àn=%ld\n", 
d©a
, 
	`°æí
(data));

59 
	`¥_öfo
("%s:%d\n", 
cuºít
->
comm
, cuºít->
pid
);

60  
	`sim∂e_ªad_‰om_buf„r
(
ubuf
, 
	`°æí
(
d©a
), 
Âos
, data, strlen(data));

61 
	}
}

63 
	#MAXUPASS
 100

64 
ssize_t
 
	`dbgfs_gíwrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

	)

66 
	gud©a
[
MAXUPASS
];

67 i‡(
	gcou¡
 > 
	gMAXUPASS
) {

68 
¥_w¨n
("Too much dataáttemptedÅo beÖassed from userspaceÅo here\n");

69  -
	gENOSPC
;

71 i‡(
c›y_‰om_u£r
(
ud©a
, 
ubuf
, 
cou¡
)) {

72 
¥_w¨n
("copy_from_user failed!\n");

73  -
	gEIO
;

75 
¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_NONE
, 
ud©a
, 
cou¡
);

76  
	gcou¡
;

79 
fûe_›î©i⁄s
 
	gdbg_f›s1
 = {

80 .
ªad
 = 
dbgfs_gíªad
,

81 .
	gwrôe
 = 
dbgfs_gíwrôe
,

86 
	mtx
, 
	mrx
;

87 
u32
 
	mj
;

88 
	m£c
[20];

89 } 
	tMYS
;

90 
MYS
 *
	gmöe
;

92 
ssize_t
 
	$dbgfs_gíªad2
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

94 
MYS
 *
d©a
 = (MYS *)
fûp
->
f_öode
->
i_¥iv©e
;

96 
loc
[
MAXUPASS
];

98 
d©a
->
j
 = 
jiffõs
;

99 
	`¥_debug
("d©a:Åx=%dÑx=%d j=%u sec=%s\n", 
d©a
->
tx
, d©a->
rx
, d©a->
j
, d©a->
£c
);

100 
	`¢¥ötf
(
loc
, 
cou¡
-1, "d©a:Åx=%dÑx=%d j=%u sec=%s\n", 
d©a
->
tx
, d©a->
rx
, d©a->
j
, d©a->
£c
);

101  
	`sim∂e_ªad_‰om_buf„r
(
ubuf
, 
MAXUPASS
, 
Âos
, 
loc
, 
	`°æí
(loc));

102 
	}
}

104 
fûe_›î©i⁄s
 
	gdbg_f›s2
 = {

105 .
ªad
 = 
dbgfs_gíªad2
,

109 
u32
 
	gmyu32
=100;

110 
u64
 
	gmyu64
=64;

111 
u32
 
	gmyx32
=0x100;

112 
boﬁ
 
	gmyboﬁ
=1;

115 
debugfs_blob_wøµî
 
	gmyblob
;

119 
	$£tup_debugfs_íåõs
()

121 
∑ª¡
 = 
	`debugfs_¸óã_dú
(
DRVNAME
, 
NULL
);

122 i‡(!
∑ª¡
) {

123 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_dir");

130 i‡(!
	`debugfs_¸óã_fûe
("gíîic_1", 0644, 
∑ª¡
, (*)"somejunk d©a", &
dbg_f›s1
)) {

131 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_file 1");

138 
möe
 = (
MYS
 *)
	`kzÆloc
((MYS), 
GFP_KERNEL
);

139 i‡(
	`u∆ikñy
(!
möe
)) {

140 
	`¥_Æît
("kmalloc failed!\n");

141  -
ENOMEM
;

143 
möe
->
tx
 = möe->
rx
 = 0;

144 
möe
->
j
 = 
jiffõs
;

145 
	`°∫˝y
(
möe
->
£c
, "Security Proto 1B", 20);

146 i‡(!
	`debugfs_¸óã_fûe
("gíîic_2", 0440, 
∑ª¡
, (*)
möe
, &
dbg_f›s2
)) {

147 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_file 2");

157 
	`debugfs_¸óã_u32
("hñ≥r_u32", 0644, 
∑ª¡
, &
myu32
);

158 
	`debugfs_¸óã_u64
("hñ≥r_u64", 0644, 
∑ª¡
, &
myu64
);

160 
	`debugfs_¸óã_x32
("hñ≥r_x32", 0644, 
∑ª¡
, &
myx32
);

171 i‡(!
	`debugfs_¸óã_boﬁ
("hñ≥r_boﬁ", 0644, 
∑ª¡
, &
myboﬁ
)) {

172 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_bool ");

193 
myblob
.
d©a
 = 
möe
;

194 
myblob
.
size
 = (
MYS
);

195 i‡(!
	`debugfs_¸óã_blob
("myblob", 0444, 
∑ª¡
, &
myblob
)) {

196 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_blob ");

200 i‡(!
	`debugfs_¸óã_symlök
("thed©a", 
∑ª¡
, "generic_2")) {

201 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_symlink ");

204 
	}
}

206 
	$debugfs_öô
()

208 
	`£tup_debugfs_íåõs
();

209 
	`¥_öfo
("ßm∂êdebugf†íåõ†£tu∞©: <debugfs_mou¡>/%s\n", 
DRVNAME
);

211 
	}
}

213 
	$debugfs_exô
()

215 
	`k‰ì
(
möe
);

216 
	`debugfs_ªmove_ªcursive
(
∑ª¡
);

217 
	`¥_debug
("Done.\n");

218 
	}
}

220 
MODULE_LICENSE
("Dual MIT/GPL");

221 
MODULE_DESCRIPTION
("Simple demo of usingÅhe Linux debugfs filesystem");

222 
MODULE_AUTHOR
("Kaiwan NB");

224 
moduÀ_öô
(
debugfs_öô
);

225 
moduÀ_exô
(
debugfs_exô
);

	@Training/L5_debug_trg/kernel_debug/debugfs/assgn_debugfs/assgn_debugfs.c

17 
	~<löux/öô.h
>

18 
	~<löux/moduÀ.h
>

19 
	~<löux/debugfs.h
>

20 
	~<löux/¶ab.h
>

22 
	~<löux/uac˚ss.h
>

23 
	~"../../c⁄víõ¡.h
"

25 
	#DRVNAME
 "assgn_debugfs"

	)

27 
	#DBGFS_CREATE_ERR
(
pDíåy
, 
°r
) do { \

28 
	`¥ötk
("%s: faûed.\n", 
°r
); \

29 i‡(
	`PTR_ERR
(
pDíåy
Ë=-
ENODEV
) \

30 
	`¥ötk
(" debugfs supportÇotávailable?\n"); \

31 
	`debugfs_ªmove_ªcursive
(
pDíåy
); \

32  
	`PTR_ERR
(
pDíåy
); \

33 } 0)

	)

35 
díåy
 *
	g∑ª¡
;

36 
	gbö°r
[80];

39 
ssize_t
 
	$dbgfs_gíªad
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

61  
	`sim∂e_ªad_‰om_buf„r
(
ubuf
, 
	`°æí
(
bö°r
), 
Âos
, binstr, strlen(binstr));

62 
	}
}

74 
	$dec2bö
(
decimÆ
, *
bö¨y
)

76 
k
 = 0, 
n
 = 0;

77 
√g_Êag
 = 0;

78 
ªmaö
;

87 #unde‡
TESTMODE


89 #ifde‡
TESTMODE


90 
ﬁd_decimÆ
;

92 
ãmp
[80];

95 i‡(
decimÆ
 < 0) {

96 
decimÆ
 = -decimal;

97 
√g_Êag
 = 1;

100 #ifde‡
TESTMODE


101 
ﬁd_decimÆ
 = 
decimÆ
;

103 
ªmaö
 = 
decimÆ
 % 2;

105 
decimÆ
 = decimal / 2;

107 #ifde‡
TESTMODE


108 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

109 
ªmaö
);

112 
ãmp
[
k
++] = 
ªmaö
 + '0';

113 } 
decimÆ
 > 0);

115 i‡(
√g_Êag
)

116 
ãmp
[
k
++] = '-';

118 
ãmp
[
k
++] = ' ';

121 
k
 >= 0)

122 
bö¨y
[
n
++] = 
ãmp
[--
k
];

124 
bö¨y
[
n
 - 1] = 0;

125 
	}
}

127 
	#MAXUPASS
 80

128 
ssize_t
 
	`dbgfs_gíwrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

	)

130 
	gud©a
[
MAXUPASS
];

131 
	gnum
=0;

133 i‡(
	gcou¡
 > 
	gMAXUPASS
) {

134 
¥ötk
("%s:Åoo much dataáttemptedÅo beÖassed from userspaceÅo here: %s:%d\n",

135 
DRVNAME
, 
__FUNCTION__
, 
__LINE__
);

136  -
	gENOSPC
;

138 i‡(
c›y_‰om_u£r
(
ud©a
, 
ubuf
, 
cou¡
))

139  -
	gEIO
;

141 
	gud©a
[
cou¡
-1]='\0';

142 
MSG
("cou¡=%zu u£∏∑s£d: %s\n", 
cou¡
, 
ud©a
);

144 i‡(
	gud©a
[0] ='0' && 
ud©a
[1] == 'x')

145 
num
 = 
sim∂e_°πﬁ
(
ud©a
, 
NULL
, 16);

147 
	gnum
 = 
sim∂e_°πﬁ
(
ud©a
, 
NULL
, 10);

149 
dec2bö
(
num
, 
bö°r
);

150  
	gcou¡
;

153 
fûe_›î©i⁄s
 
	gdbg_f›s
 = {

154 .
ªad
 = 
dbgfs_gíªad
,

155 .
	gwrôe
 = 
dbgfs_gíwrôe
,

158 
	$£tup_debugfs_íåõs
()

160 
∑ª¡
 = 
	`debugfs_¸óã_dú
(
DRVNAME
, 
NULL
);

161 i‡(!
∑ª¡
) {

162 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_dir");

165 i‡(!
	`debugfs_¸óã_fûe
("dec2bö", 0666, 
∑ª¡
, 
NULL
, &
dbg_f›s
)) {

166 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_file 1");

169 
	}
}

171 
	$debugfs_öô
()

173 
	`£tup_debugfs_íåõs
();

175 
	}
}

177 
	$debugfs_exô
()

179 
	`debugfs_ªmove_ªcursive
(
∑ª¡
);

180 
	`MSG
("Done.\n");

181 
	}
}

183 
MODULE_LICENSE
("Dual BSD/GPL");

184 
MODULE_DESCRIPTION
("Simpleássignment: convert decimalÅo binary usingÅhe Linux debugfs filesystem");

185 
MODULE_AUTHOR
("Kaiwan NB");

187 
moduÀ_öô
(
debugfs_öô
);

188 
moduÀ_exô
(
debugfs_exô
);

	@Training/L5_debug_trg/kernel_debug/debugfs/showthrds_dbgfs/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_PRINT


47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=0; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 
	`¥_debug
 (
	`¥_fmt
(
°rög
), ##
¨gs
); \

59 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

126 
	~<löux/sched.h
>

127 
	~<löux/öãºu±.h
>

129 #i‚de‡
USE_FTRACE_PRINT


130 
	#PRINT_CTX
() do { \

131 
£p
='|', 
öå
='.'; \

133 i‡(
	`ö_öãºu±
()) { \

134 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

135 
öå
='H'; \

136 i‡(
	`ö_úq
()) \

137 
öå
='h'; \

138 i‡(
	`ö_so·úq
()) \

139 
öå
='s'; \

142 
öå
='.'; \

144 
	`DBGPRINT
( \

148 , 
	`smp_¥o˚ss‹_id
(), \

149 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

150 (
	`úqs_dißbÀd
()?'d':'.'), \

151 (
	`√ed_ªsched
()?'N':'.'), \

152 
öå
, \

153 (
	`¥ìm±_cou¡
() && 0xff) \

155 } 0)

	)

157 
	#PRINT_CTX
() do { \

158 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

163 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

165 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

166 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

168 } 0)

	)

184 #ifde‡
__KERNEL__


185 
	#as£π
(
ex¥
) do { \

186 i‡(!(
ex¥
)) { \

187 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

188 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

190 } 0)

	)

194 
ölöe
 
	$bìp
(
wh©
)

196 #ifde‡
__KERNEL__


197 
	`DBGPRINT
("%c", ()
wh©
);

199 ()
	`¥ötf
("%c", ()
wh©
);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

210 
c
=0, 
m
;\

211 
f‹_ödex
,
ö√r_ödex
; \

213 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++;\

216 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

217 
m
=0;m<50;m++); \

220 }

	)

223 #ifde‡
__KERNEL__


228 
	#DELAY_SEC
(
vÆ
) \

230 i‡(!
	`ö_öãºu±
()) { \

231 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

232 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

234 }

	)

237 #i‚de‡
__KERNEL__


243 
timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

244 
timevÆ
 *
y
);

248 
__©åibuã__
 ((
unu£d
))

249 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

250 
timevÆ
 *
y
)

253 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

254 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

255 
y
->
tv_u£c
 -1000000 * 
n£c
;

256 
y
->
tv_£c
 +
n£c
;

258 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

259 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

260 
y
->
tv_u£c
 +1000000 * 
n£c
;

261 
y
->
tv_£c
 -
n£c
;

266 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

267 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

270  
x
->
tv_£c
 < 
y
->tv_sec;

271 
	}
}

281 #i‚de‡
_TIME_H


282 
	~<time.h
>

284 
	$r_¶ìp
 (
£c
)

286 
time•ec
 
ªq
, 
ªm
;

288 
ªq
.
tv_£c
 = 
£c
;

289 
ªq
.
tv_n£c
 = 0;

291 
	`«no¶ìp
 (&
ªq
, &
ªm
) == -1) {

292 i‡(
î∫o
 !
EINTR
)

297 #ifde‡
DEBUG


298 
	`Ârötf
 (
°dîr
, "*Çanosleep interrupted!ÑemÅime: %lu.%lu *\n",

299 
ªm
.
tv_£c
,Ñem.
tv_n£c
);

301 
ªq
 = 
ªm
;

304 
	}
}

317 
__©åibuã__
 ((
unu£d
))

318 
	$dec2bö
(
decimÆ
, *
bö¨y
)

320 
k
 = 0, 
n
 = 0;

321 
√g_Êag
 = 0;

322 
ªmaö
;

332 #unde‡
TESTMODE


334 #ifde‡
TESTMODE


335 
ﬁd_decimÆ
;

337 
ãmp
[80];

340 i‡(
decimÆ
 < 0) {

341 
decimÆ
 = -decimal;

342 
√g_Êag
 = 1;

345 #ifde‡
TESTMODE


346 
ﬁd_decimÆ
 = 
decimÆ
;

348 
ªmaö
 = 
decimÆ
 % 2;

350 
decimÆ
 = decimal / 2;

352 #ifde‡
TESTMODE


353 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

354 
ªmaö
);

357 
ãmp
[
k
++] = 
ªmaö
 + '0';

358 } 
decimÆ
 > 0);

360 i‡(
√g_Êag
)

361 
ãmp
[
k
++] = '-';

363 
ãmp
[
k
++] = ' ';

366 
k
 >= 0)

367 
bö¨y
[
n
++] = 
ãmp
[--
k
];

369 
bö¨y
[
n
 - 1] = 0;

370 
	}
}

372 #i‚de‡
__KERNEL__


374 
	#MSG
(
°rög
, 
¨gs
...) do { \

375 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

376 } 0)

	)

378 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

379 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

380 } 0)

	)

382 
	#QP
 
	`MSG
("\n")

	)

385 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

387 i‡(
vîbo£
) \

388 
	`¥ötf
(
°r
, ##
¨gs
); \

389 } 0)

	)

391 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

393 
îr_°r
[512];

395 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

396 
	`≥º‹
(
îr_°r
);

397 
	`exô
(
exôcode
);

398 
	}
}

	@Training/L5_debug_trg/kernel_debug/debugfs/showthrds_dbgfs/showthrds_dbgfs.c

13 
	~<löux/kî√l.h
>

14 
	~<löux/moduÀ.h
>

15 
	~<löux/öô.h
>

16 
	~<löux/¥oc_fs.h
>

17 
	~<löux/sched.h
>

18 
	~<löux/•ölock.h
>

19 
	~<asm/uac˚ss.h
>

20 
	~<löux/debugfs.h
>

21 
	~<löux/vmÆloc.h
>

23 
	~<löux/vîsi⁄.h
>

24 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(4,11,0)

25 
	~<löux/sched/sig«l.h
>

28 
	~"c⁄víõ¡.h
"

30 
	#DRVNAME
 "showthrds_dbgfs"

	)

32 
	#DBGFS_CREATE_ERR
(
pDíåy
, 
°r
) do { \

33 
	`¥_öfo
("%s: faûed.\n", 
°r
); \

34 i‡(
	`PTR_ERR
(
pDíåy
Ë=-
ENODEV
) \

35 
	`¥_öfo
(" debugfs supportÇotávailable?\n"); \

36 
	`debugfs_ªmove_ªcursive
(
pDíåy
); \

37  
	`PTR_ERR
(
pDíåy
); \

38 } 0)

	)

40 
díåy
 *
	g∑ª¡
;

42 
ssize_t
 
	$dbgfs_showÆ…hrds
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
, 
size_t
 
cou¡
, 
loff_t
 *
Âos
)

44 
èsk_°ru˘
 *
g
, *
t
;

45 *
d©a
;

46 
	#MEM_REQD_PER_THREAD
 100

	)

47 
tmpbuf
[128];

48 
ssize_t
 
numthrds
=0, 
n
=0;

50 
	`do_óch_thªad
(
g
, 
t
) {

51 
numthrds
 ++;

52 } 
	`whûe_óch_thªad
(
g
, 
t
);

53 
	`MSG
("#Åhªad†Æive: %zd\n", 
numthrds
);

55 
d©a
 = 
	`vzÆloc
(
numthrds
*
MEM_REQD_PER_THREAD
);

56 i‡(!
d©a
) {

57 
	`¥_Æît
("%s: vzÆlo¯Áûuª!\n", 
DRVNAME
);

58  -
ENOMEM
;

61 
	`¢¥ötf
 (
d©a
, 300,

67 
	`do_óch_thªad
(
g
, 
t
) {

68 
	`èsk_lock
(
t
);

70 
	`•rötf
(
tmpbuf
, "%6d %6d ", 
g
->
tgid
, 
t
->
pid
);

71 
	`°∫ˇt
 (
d©a
, 
tmpbuf
, 14);

73 i‡(!
g
->
mm
) {

74 
	`•rötf
(
tmpbuf
, "[%20s]", 
g
->
comm
);

76 
	`•rötf
(
tmpbuf
, " %20†", 
g
->
comm
);

78 
	`°∫ˇt
 (
d©a
, 
tmpbuf
, 41);

81 i‡(
g
->
mm
 && (g->
tgid
 =
t
->
pid
Ë&& (
	`©omic_ªad
(&g->mm->
mm_u£rs
) > 1)) {

82 
	`•rötf
(
tmpbuf
, " %4d", 
	`©omic_ªad
(&
g
->
mm
->
mm_u£rs
));

83 
	`°∫ˇt
 (
d©a
, 
tmpbuf
, 8);

86 
	`•rötf
(
tmpbuf
, "\n");

87 
	`°∫ˇt
 (
d©a
, 
tmpbuf
, 2);

89 
	`èsk_u∆ock
(
t
);

91 
numthrds
--;

92 i‡(!
numthrds
) {

93 
	`¥_öfo
("%s:Ouch!Éx˚eded mem‹y!áb‹tög ouçuànow..", 
DRVNAME
);

94 
out
;

96 } 
	`whûe_óch_thªad
(
g
, 
t
);

118 
out
:

119 
n
 = 
	`sim∂e_ªad_‰om_buf„r
(
ubuf
, 
	`°æí
(
d©a
), 
Âos
, data, strlen(data));

120 
	`v‰ì
 (
d©a
);

121  
n
;

122 
	}
}

124 
fûe_›î©i⁄s
 
	gdbg_f›s1
 = {

125 .
ªad
 = 
dbgfs_showÆ…hrds
,

128 
__öô
 
	$showthrds_öô_moduÀ
()

130 
∑ª¡
 = 
	`debugfs_¸óã_dú
(
DRVNAME
, 
NULL
);

131 i‡(!
∑ª¡
) {

132 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_dir");

135 i‡(!
	`debugfs_¸óã_fûe
("show_Æl_thªads", 0644, 
∑ª¡
,

136 (*)0, &
dbg_f›s1
)) {

137 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_file 1");

139 
	`MSG
("DebugfsÉntry setup successfully (under <debugfs_mount>/%s) .\n",

140 
DRVNAME
);

142 
	}
}

144 
__exô
 
	$showthrds_˛ónup_moduÀ
()

146 
	`debugfs_ªmove_ªcursive
(
∑ª¡
);

147 
	`MSG
("Removed.\n");

148 
	}
}

150 
moduÀ_öô
(
showthrds_öô_moduÀ
);

151 
moduÀ_exô
(
showthrds_˛ónup_moduÀ
);

153 
MODULE_AUTHOR
("Kaiwan NB@kaiwanTECH");

154 
MODULE_DESCRIPTION
("DisplaysállÅhreads.");

155 
MODULE_LICENSE
("Dual BSD/GPL");

	@Training/L5_debug_trg/kernel_debug/hello_gdb/hello_gdb.c

12 
	~<löux/moduÀ.h
>

13 
	~<löux/kî√l.h
>

14 
	~<löux/öô.h
>

15 
	~<löux/sched.h
>

17 
	~<löux/¶ab.h
>

19 
	#MODULE_VER
 "1.0"

	)

20 
	#MODULE_NAME
 "hñlo_gdb"

	)

21 
	#¥o˙ame
 "gdb_ã°"

	)

23 #ifde‡
DEBUG


24 
	#MSG
(
°rög
, 
¨gs
...) \

25 
	`¥ötk
(
KERN_DEBUG
 "%s:%s:%d: " 
°rög
, \

26 
MODULE_NAME
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

28 
	#MSG
(
°rög
, 
¨gs
...)

	)

37 
	mtx
, 
	mrx
;

38 
u32
 
	mj
;

39 } 
	tMYS
;

40 
MYS
 *
	gmöe
;

44 
	$¥o¸ód
(*
buf
, **
°¨t
, 
off_t
 
off£t
,

45 
cou¡
, *
eof
, *
d©a
)

47 
n
 = 
	`•rötf
(
buf
, "InÖrocÑead callback.\n\
 %dÑunning onÖrocessor # %d\n",

49 
cuºít
->
pid
, 
	`smp_¥o˚ss‹_id
());

51 *
eof
=1;

52  
n
;

53 
	}
}

59 
__öô
 
	$hñlo_gdb_öô_moduÀ
()

62 i‡(!
	`¸óã_¥oc_ªad_íåy
 (
¥o˙ame
, 0444,

63 
NULL
,

64 
¥o¸ód
,

65 
NULL
 )) {

66 
	`MSG
("ProcÉntry creation failure,áborting..\n");

67  -
ENOMEM
;

70 
möe
 = (
MYS
 *)
	`kmÆloc
 ((MYS), 
GFP_KERNEL
);

71 i‡(!
möe
) {

72 
	`¥ötk
(
KERN_ALERT
 "hello_gdb: kmalloc failed.\n");

73  -
ENOMEM
;

75 
möe
->
tx
 = möe->
rx
 = 0;

76 
möe
->
j
 = 
jiffõs
;

78 
	`¥ötk
(
KERN_INFO
 "%†%†öôülized\n", 
MODULE_NAME
, 
MODULE_VER
);

80 
	}
}

85 
	$hñlo_gdb_˛ónup_moduÀ
()

88 
	`k‰ì
 (
möe
);

89 
	`¥ötk
(
KERN_INFO
 "%†%†ªmoved\n", 
MODULE_NAME
, 
MODULE_VER
);

90 
	}
}

92 
moduÀ_öô
(
hñlo_gdb_öô_moduÀ
);

93 
moduÀ_exô
(
hñlo_gdb_˛ónup_moduÀ
);

95 
MODULE_AUTHOR
("Kaiwan");

96 
MODULE_DESCRIPTION
("Demo of using gdb with kernel module");

97 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/ioctl/convenient.h

23 #i‚de‡
__CONVENIENT_H__


24 
	#__CONVENIENT_H__


	)

26 
	~<asm/∑øm.h
>

27 
	~<löux/sched.h
>

31 #ifde‡
DEBUG


32 
	#MSG
(
°rög
, 
¨gs
...) \

33 
	`¥ötk
(
KERN_INFO
 "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

34 
	#MSG_SHORT
(
°rög
, 
¨gs
...) \

35 
	`¥ötk
(
KERN_INFO
 
°rög
, ##
¨gs
)

	)

36 
	#QP
 
	`MSG
("\n")

	)

37 
	#QPDS
 do { \

38 
	`MSG
("\n"); \

39 
	`dump_°ack
(); \

40 } 0)

	)

42 
	#MSG
(
°rög
, 
¨gs
...)

	)

43 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

44 
	#QP


	)

45 
	#QPDS


	)

65 
	#as£π
(
ex¥
) \

66 i‡(!(
ex¥
)) { \

67 
	`¥ötk
("Assertion [%s] failed! : %s:%s:%d\n", \

68 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

69 }

	)

72 
ölöe
 
	$bìp
(
wh©
)

74 ()
	`¥ötk
(
KERN_INFO
 "%c", ()
wh©
 );

75 
	}
}

82 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

84 
c
=0, 
m
;\

85 
f‹_ödex
,
ö√r_ödex
; \

87 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

88 
	`bìp
((
vÆ
)); \

89 
c
++;\

90 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

91 
m
=0;m<50;m++); \

94 }

	)

101 
	#DELAY_SEC
(
vÆ
) \

103 i‡(!
	`ö_öãºu±
()) { \

104 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

105 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

107 }

	)

	@Training/L5_debug_trg/kernel_debug/ioctl/ioctl_kdrv.c

14 
	~<löux/moduÀ.h
>

15 
	~<löux/kî√l.h
>

16 
	~<löux/öô.h
>

17 
	~<löux/fs.h
>

18 
	~<löux/io˘l.h
>

19 
	~<löux/vîsi⁄.h
>

20 
	~<löux/uac˚ss.h
>

21 
	~"io˘l_kdrv.h
"

22 
	~"c⁄víõ¡.h
"

24 
	#MODULE_VER
 "0.1"

	)

25 
	#MODULE_NAME
 "io˘l_kdrv"

	)

27 
	giok_maj‹
=0, 
	gpowî
=1;

33 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,36)

34 
	$iok_io˘l
(
fûe
 *
fûp
, 
cmd
, 
¨g
)

36 
	$iok_io˘l
(
öode
 *
öo
, 
fûe
 *
fûp
, 
cmd
, 
¨g
)

39 
îr
=0, 
ªtvÆ
=0;

41 
	`MSG
 ("I¿io˘»mëhod, cmd=%d\n", 
	`_IOC_NR
(
cmd
));

44 i‡(
	`_IOC_TYPE
(
cmd
Ë!
IOCTL_KDRV_MAGIC
) {

45 
	`MSG
("ioctl fail 1\n");

46  -
ENOTTY
;

49 i‡(
	`_IOC_NR
(
cmd
Ë> 
IOCTL_KDRV_MAXIOCTL
) {

50 
	`MSG
("ioctl fail 2\n");

51  -
ENOTTY
;

55 i‡(
	`_IOC_DIR
(
cmd
Ë& 
_IOC_READ
)

57 #i‡
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(5,0,0)

58 
îr
 = !
	`ac˚ss_ok
((
__u£r
 *)
¨g
, 
	`_IOC_SIZE
(
cmd
));

60 
îr
 = !
	`ac˚ss_ok
(
VERIFY_WRITE
, (
__u£r
 *)
¨g
, 
	`_IOC_SIZE
(
cmd
));

62 i‡(
	`_IOC_DIR
(
cmd
Ë& 
_IOC_WRITE
)

64 #i‡
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(5,0,0)

65 
îr
 = !
	`ac˚ss_ok
((
__u£r
 *)
¨g
, 
	`_IOC_SIZE
(
cmd
));

67 
îr
 = !
	`ac˚ss_ok
(
VERIFY_READ
, (
__u£r
 *)
¨g
, 
	`_IOC_SIZE
(
cmd
));

69 i‡(
îr
)

70  -
EFAULT
;

73 
cmd
) {

74 
IOCTL_KDRV_IOCRESET
:

75 
	`MSG
 ("In option: IOCTL_KDRV_IOCRESET\n");

77 
IOCTL_KDRV_IOCQPOWER
:

78 
	`MSG
 ("I¿›ti⁄: IOCTL_KDRV_IOCQPOWER\n\
=0x%x (drvËpowî=%d\n", ()
¨g
, 
powî
);

80 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

81  -
EPERM
;

82 
ªtvÆ
 = 
	`__put_u£r
(
powî
, (
__u£r
 *)
¨g
);

84 
IOCTL_KDRV_IOCSPOWER
:

85 i‡(!
	`ˇ∑bÀ
(
CAP_SYS_ADMIN
))

86  -
EPERM
;

87 
powî
 = 
¨g
;

88 
	`MSG
 ("I¿›ti⁄: IOCTL_KDRV_IOCSPOWER\n\
=%dÇow.\n", 
powî
);

92  -
ENOTTY
;

95  
ªtvÆ
;

96 
	}
}

99 
fûe_›î©i⁄s
 
	giok_f›s
 = {

100 .
Œ£ek
 = 
no_Œ£ek
,

101 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,36)

102 .
	gu∆ocked_io˘l
 = 
iok_io˘l
,

105 .
	gio˘l
 = 
iok_io˘l
,

109 
	$iok_›í
(
öode
 * inode, 
fûe
 * 
fûp
)

111 
	`MSG
–"Devi˚Çodêwôh mö‹ # %d beög u£d\n", 
	`imö‹
(
öode
));

113 
	`imö‹
(
öode
)) {

115 
fûp
->
f_›
 = &
iok_f›s
;

118  -
ENXIO
;

120 i‡(
fûp
->
f_›
 && fûp->f_›->
›í
)

121  
fûp
->
f_›
->
	`›í
(
öode
,filp);

124 
	}
}

127 
fûe_›î©i⁄s
 
	giok_›í_f›s
 = {

128 .
›í
 = 
iok_›í
,

135 
__öô
 
	$io˘l_kdrv_öô_moduÀ
()

137 
ªsu…
;

139 
	`MSG
–"iok_maj‹=%d\n",
iok_maj‹
);

145 
ªsu…
 = 
	`ªgi°î_chrdev
(
iok_maj‹
, 
MODULE_NAME
, &
iok_›í_f›s
);

146 i‡(
ªsu…
 < 0) {

147 
	`MSG
( "register_chrdev() failedÅryingÅo get iok_major=%d\n",

148 
iok_maj‹
);

149  
ªsu…
;

152 i‡(
iok_maj‹
 =0Ëiok_maj‹ = 
ªsu…
;

153 
	`MSG
–"ªgi°îed:: iok_maj‹=%d\n",
iok_maj‹
);

156 
	`¥ötk
(
KERN_INFO
 "%†%†öôülized\n", 
MODULE_NAME
, 
MODULE_VER
);

158 
	}
}

163 
	$io˘l_kdrv_˛ónup_moduÀ
()

165 
	`uƒegi°î_chrdev
(
iok_maj‹
, 
MODULE_NAME
);

166 
	`¥ötk
(
KERN_INFO
 "%†%†ªmoved\n", 
MODULE_NAME
, 
MODULE_VER
);

167 
	}
}

169 
moduÀ_öô
(
io˘l_kdrv_öô_moduÀ
);

170 
moduÀ_exô
(
io˘l_kdrv_˛ónup_moduÀ
);

172 
MODULE_AUTHOR
("My Name");

173 
MODULE_DESCRIPTION
("A simple ioctl kernel usage demo");

174 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/ioctl/ioctl_kdrv.h

9 
	#IOCTL_KDRV_MAGIC
 0x88

	)

29 
	#IOCTL_KDRV_IOCRESET
 
	`_IO
(
IOCTL_KDRV_MAGIC
, 0)

	)

31 
	#IOCTL_KDRV_IOCQPOWER
 
	`_IOR
(
IOCTL_KDRV_MAGIC
, 1, )

	)

33 
	#IOCTL_KDRV_IOCSPOWER
 
	`_IOW
(
IOCTL_KDRV_MAGIC
, 2, )

	)

35 
	#IOCTL_KDRV_MAXIOCTL
 2

	)

	@Training/L5_debug_trg/kernel_debug/ioctl/user_test.c

8 
	~<°dio.h
>

9 
	~<uni°d.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<sys/°©.h
>

12 
	~<f˙é.h
>

13 
	~<sig«l.h
>

14 
	~<°dlib.h
>

16 
	~<sys/io˘l.h
>

17 
	~"io˘l_kdrv.h
"

19 
	#FLGS
 
O_RDWR


	)

20 
	#DMODE
 0

	)

22 
	$maö
(
¨gc
, **
¨gv
)

24 
fd
, 
powî
;

26 if–
¨gc
 < 2 ) {

27 
	`Ârötf
(
°dîr
,

28 "Ußge: %†devi˚_fûe\n\
 devi˚_fûêd€†nŸÉxi°, cª©êô usög mknod(1)\n", 
¨gv
[0]);

30 
	`exô
(1);

33 if–(
fd
=
	`›í
(
¨gv
[1],
FLGS
,
DMODE
)) == -1)

34 
	`≥º‹
("›í"),
	`exô
(1);

35 
	`¥ötf
("devi˚ o≥√d: fd=%d\n", 
fd
);

38 i‡(
	`io˘l
 (
fd
, 
IOCTL_KDRV_IOCRESET
, 0) == -1) {

39 
	`≥º‹
("ioctl IOCTL_KDRV_IOCRESET failed");

40 
	`˛o£
(
fd
);

41 
	`exô
(1);

43 
	`¥ötf
 ("%s: devi˚Ñe£t.\n", 
¨gv
[0]);

45 i‡(
	`io˘l
 (
fd
, 
IOCTL_KDRV_IOCQPOWER
, &
powî
) == -1) {

46 
	`≥º‹
("ioctl IOCTL_KDRV_IOCQPOWER failed");

47 
	`˛o£
(
fd
);

48 
	`exô
(1);

50 
	`¥ötf
 ("%s:Öowî=%d\n", 
¨gv
[0], 
powî
);

52 i‡(!
powî
) {

53 
	`¥ötf
("Device OFF,Öowering it on in 3s...\n");

54 
	`¶ìp
 (3);

55 i‡(
	`io˘l
 (
fd
, 
IOCTL_KDRV_IOCSPOWER
, 1) == -1) {

56 
	`≥º‹
("ioctl IOCTL_KDRV_IOCSPOWER failed");

57 
	`˛o£
(
fd
);

58 
	`exô
(1);

60 
	`¥ötf
 ("%s:Öowî ONÇow.\n", 
¨gv
[0]);

63 
	`¥ötf
 ("%s:Öowîög OFFÇow..\n", 
¨gv
[0]);

64 i‡(
	`io˘l
 (
fd
, 
IOCTL_KDRV_IOCSPOWER
, 0) == -1) {

65 
	`≥º‹
("ioctl IOCTL_KDRV_IOCSPOWER failed");

66 
	`˛o£
(
fd
);

67 
	`exô
(1);

69 
	`¥ötf
 ("%s:Öowî OFF ok,Éxôög..\n", 
¨gv
[0]);

72 
	`˛o£
(
fd
);

73 
	`exô
(0);

74 
	}
}

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/lab_oops_hang_panic/hang_panic.c

14 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

16 
	~<löux/moduÀ.h
>

17 
	~<löux/kî√l.h
>

18 
	~<löux/öô.h
>

19 
	~<löux/sched.h
>

20 
	~<löux/timî.h
>

21 
	~<löux/dñay.h
>

22 
	~<löux/öãºu±.h
>

24 
	#MODULE_VER
 "1.0"

	)

25 
	#MODULE_NAME
 "h™g_∑nic"

	)

28 
	$dög
(
timî_li°
 *
timî
)

30 
	`¥_öfo
("InÅimeout function \"ding\"Çow...\n");

37 
	}
}

39 
	$åy_timeout
()

41 
timî_li°
 
mytimî
;

43 
	`¥_öfo
("InÅry_timeout()\n\
 %dÑunning onÖrocessor # %d\n",

45 
cuºít
->
pid
, 
	`smp_¥o˚ss‹_id
());

48 
	`¥_öfo
("%†£âög u∞timî (1sËnow..\n", 
MODULE_NAME
);

52 
	`timî_£tup
(&
mytimî
, 
dög
, 0);

54 
mytimî
.
expúes
 = 
	`m£cs_to_jiffõs
(1000);

55 
	`¥_öfo
("ArmingÅheÅimerÇow!\n");

56 
	`add_timî
(&
mytimî
);

57 
	}
}

62 
__öô
 
	$h™g_∑nic_öô_moduÀ
()

65 
	`¥_öfo
("%†dñayög f‹ 1†now..\n", 
MODULE_NAME
);

66 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
);

67 i‡(
	`scheduÀ_timeout
 (
HZ
)) {

68 
	`¥ötk
 (
KERN_INFO


70 
MODULE_NAME
);

71  -
ERESTARTSYS
;

74 
	`¥_öfo
("initialized\n");

75 
	`åy_timeout
();

78 
	}
}

83 
	$h™g_∑nic_˛ónup_moduÀ
()

85 
	`¥ötk
(
KERN_INFO
 "%s %sÑemoved\n",

86 
MODULE_NAME
, 
MODULE_VER
);

87 
	}
}

89 
moduÀ_öô
(
h™g_∑nic_öô_moduÀ
);

90 
moduÀ_exô
(
h™g_∑nic_˛ónup_moduÀ
);

92 
MODULE_AUTHOR
("Kaiwan NB");

93 
MODULE_DESCRIPTION
("A simple module demo -á subtle bug whereáÅimer is set up.");

94 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/miscdrv_rdwr_buggy/miscdrv_rdwr.c

28 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

30 
	~<löux/öô.h
>

31 
	~<löux/moduÀ.h
>

32 
	~<löux/miscdevi˚.h
>

33 
	~<löux/¶ab.h
>

34 
	~<löux/mm.h
>

35 
	~<löux/fs.h
>

36 
	~<löux/sched.h
>

39 
	~<löux/vîsi⁄.h
>

40 #i‡
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(4, 11, 0)

41 
	~<löux/uac˚ss.h
>

43 
	~<asm/uac˚ss.h
>

48 
	#OURMODNAME
 "miscdrv_rdwr"

	)

49 
MODULE_AUTHOR
("Kaiwan N Billimoria");

50 
MODULE_DESCRIPTION
("LKP-2 book:ch1/miscdrv_rdwr: simple misc char driver with"

52 
MODULE_LICENSE
("Dual MIT/GPL");

53 
MODULE_VERSION
("0.1");

55 
	gga
, 
	ggb
 = 1;

61 
	sdrv_˘x
 {

62 
devi˚
 *
	mdev
;

63 
	mtx
, 
	mrx
, 
	mîr
, 
	mmyw‹d
;

64 
u32
 
	mc⁄fig1
, 
	mc⁄fig2
;

65 
u64
 
	mc⁄fig3
;

66 
	#MAXBYTES
 128

	)

68 
	mour£¸ë
[
MAXBYTES
];

70 
drv_˘x
 *
	g˘x
;

83 
	$›í_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

85 
devi˚
 *
dev
 = 
˘x
->dev;

86 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

88 i‡(
	`u∆ikñy
(!
buf
))

89  -
ENOMEM
;

92 
ga
++;

93 
gb
--;

94 
	`dev_öfo
(
dev
, " opening \"%s\"Çow; wrt open file: f_flags = 0x%x\n",

95 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
), fûp->
f_Êags
);

96 
	`k‰ì
(
buf
);

98  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

99 
	}
}

110 
ssize_t
 
	$ªad_miscdrv_rdwr
(
fûe
 *
fûp
, 
__u£r
 *
ubuf
,

111 
size_t
 
cou¡
, 
loff_t
 *
off
)

113 
ªt
 = 
cou¡
, 
£¸ë_Àn
 = 
	`°∫Àn
(
˘x
->
our£¸ë
, 
MAXBYTES
);

114 
devi˚
 *
dev
 = 
˘x
->dev;

115 
èsknm
[
TASK_COMM_LEN
];

118 
	`dev_öfo
(
dev
, "%†w™t†tÿªad (u±oË%zu byãs\n", 
	`gë_èsk_comm
(
èsknm
, 
cuºít
), 
cou¡
);

120 
ªt
 = -
EINVAL
;

121 i‡(
cou¡
 < 
MAXBYTES
) {

122 
	`dev_w¨n
(
dev
, "request # of bytes (%zu) is <Ñequired size"

123 " (%d),áb‹tögÑód\n", 
cou¡
, 
MAXBYTES
);

124 
out_nŸok
;

126 i‡(
£¸ë_Àn
 <= 0) {

127 
	`dev_w¨n
(
dev
, "whoops, something's wrong,Åhe 'secret' isn't"

129 
out_nŸok
;

143 
ªt
 = -
EFAULT
;

144 i‡(
	`c›y_to_u£r
(
ubuf
, 
˘x
->
our£¸ë
, 
£¸ë_Àn
)) {

145 
	`dev_w¨n
(
dev
, "copy_to_user() failed\n");

146 
out_nŸok
;

148 
ªt
 = 
£¸ë_Àn
;

151 
˘x
->
tx
 +
£¸ë_Àn
;

152 
	`dev_öfo
(
dev
, " %d bytesÑead,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

153 
£¸ë_Àn
, 
˘x
->
tx
, ctx->
rx
);

154 
out_nŸok
:

155  
ªt
;

156 
	}
}

167 
ssize_t
 
	$wrôe_miscdrv_rdwr
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
ubuf
,

168 
size_t
 
cou¡
, 
loff_t
 *
off
)

170 
ªt
 = 
cou¡
;

171 *
kbuf
 = 
NULL
;

172 
devi˚
 *
dev
 = 
˘x
->dev;

173 
èsknm
[
TASK_COMM_LEN
];

176 i‡(
	`u∆ikñy
(
cou¡
 > 
MAXBYTES
)) {

177 
	`dev_w¨n
(
dev
, "count %zuÉxceeds max # of bytesállowed, "

178 "ab‹tög wrôe\n", 
cou¡
);

179 
out_nomem
;

181 
	`dev_öfo
(
dev
, "%†w™t†tÿwrôê%zu byãs\n", 
	`gë_èsk_comm
(
èsknm
, 
cuºít
), 
cou¡
);

183 
ªt
 = -
ENOMEM
;

184 
kbuf
 = 
	`kvmÆloc
(
cou¡
, 
GFP_KERNEL
);

185 i‡(
	`u∆ikñy
(!
kbuf
))

186 
out_nomem
;

187 
	`mem£t
(
kbuf
, 0, 
cou¡
);

196 
ªt
 = -
EFAULT
;

197 i‡(
	`c›y_‰om_u£r
(
kbuf
-0x2000, 
ubuf
, 
cou¡
)) {

198 
	`dev_w¨n
(
dev
, "copy_from_user() failed\n");

199 
out_cfu
;

207 
	`°æ˝y
(
˘x
->
our£¸ë
, 
kbuf
, (
cou¡
 > 
MAXBYTES
 ? MAXBYTES : count));

210 
	`¥öt_hex_dump_byãs
("˘x ", 
DUMP_PREFIX_OFFSET
,

211 
˘x
, (
drv_˘x
));

214 
˘x
->
rx
 +
cou¡
;

216 
ªt
 = 
cou¡
;

217 
	`dev_öfo
(
dev
, " %zu bytes written,Ñeturning... (stats:Åx=%d,Ñx=%d)\n",

218 
cou¡
, 
˘x
->
tx
, ctx->
rx
);

219 
out_cfu
:

220 
	`kv‰ì
(
kbuf
);

221 
out_nomem
:

222  
ªt
;

223 
	}
}

231 
	$˛o£_miscdrv_rdwr
(
öode
 *öode, 
fûe
 *
fûp
)

233 
devi˚
 *
dev
 = 
˘x
->dev;

234 *
buf
 = 
	`kzÆloc
(
PATH_MAX
, 
GFP_KERNEL
);

236 i‡(
	`u∆ikñy
(!
buf
))

237  -
ENOMEM
;

240 
ga
--;

241 
gb
++;

242 
	`dev_öfo
(
dev
, " fûíame: \"%s\"\n", 
	`fûe_∑th
(
fûp
, 
buf
, 
PATH_MAX
));

243 
	`k‰ì
(
buf
);

246 
	}
}

249 c⁄° 
fûe_›î©i⁄s
 
	gŒkd_misc_f›s
 = {

250 .
›í
 = 
›í_miscdrv_rdwr
,

251 .
	gªad
 = 
ªad_miscdrv_rdwr
,

252 .
	gwrôe
 = 
wrôe_miscdrv_rdwr
,

253 .
	gŒ£ek
 = 
no_Œ£ek
,

254 .
	gªÀa£
 = 
˛o£_miscdrv_rdwr
,

265 
miscdevi˚
 
	gŒkd_miscdev
 = {

266 .
mö‹
 = 
MISC_DYNAMIC_MINOR
,

267 .
	g«me
 = "llkd_miscdrv_rdwr",

270 .
	gmode
 = 0666,

271 .
	gf›s
 = &
Œkd_misc_f›s
,

274 
__öô
 
	$miscdrv_rdwr_öô
()

276 
ªt
 = 0;

277 
devi˚
 *
dev
;

279 
ªt
 = 
	`misc_ªgi°î
(&
Œkd_miscdev
);

280 i‡(
ªt
) {

281 
	`¥_nŸi˚
("%s: mis¯devi˚Ñegi°øti⁄ faûed,áb‹tög\n", 
OURMODNAME
);

282  
ªt
;

285 
dev
 = 
Œkd_miscdev
.
this_devi˚
;

287 
	`¥_öfo
("LLKD misc driver (major # 10)Ñegistered, minor# = %d,"

288 " devÇodêi†/dev/%s\n", 
Œkd_miscdev
.
mö‹
,Ülkd_miscdev.
«me
);

296 
˘x
 = 
	`devm_kzÆloc
(
dev
, (
drv_˘x
), 
GFP_KERNEL
);

297 i‡(
	`u∆ikñy
(!
˘x
))

298  -
ENOMEM
;

300 
˘x
->
dev
 = dev;

302 
	`°æ˝y
(
˘x
->
our£¸ë
, "initmsg", 8);

303 
	`dev_dbg
(
˘x
->
dev
, "A sampleÖrint viaÅhe dev_dbg(): driver initialized\n");

306 
	}
}

308 
__exô
 
	$miscdrv_rdwr_exô
()

310 
	`misc_dîegi°î
(&
Œkd_miscdev
);

311 
	`¥_öfo
("LLKD misc (rdwr) driver deregistered, bye\n");

312 
	}
}

314 
moduÀ_öô
(
miscdrv_rdwr_öô
);

315 
moduÀ_exô
(
miscdrv_rdwr_exô
);

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/miscdrv_rdwr_buggy/rdwr_test_secret.c

23 
	~<°dio.h
>

24 
	~<uni°d.h
>

25 
	~<°rög.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<limôs.h
>

28 
	~<sys/°©.h
>

29 
	~<f˙é.h
>

30 
	~<°dlib.h
>

32 
	#MAXBYTES
 128

	)

34 
	g°ay_Æive
;

36 
ölöe
 
	$ußge
(*
¥g
)

38 
	`Ârötf
(
°dîr
,

42 " (max %d byãs)\n", 
¥g
, 
MAXBYTES
);

43 
	}
}

45 
	$maö
(
¨gc
, **
¨gv
)

47 
›t
 = 'r';

48 
fd
, 
Êags
 = 
O_RDONLY
;

49 
ssize_t
 
n
;

50 *
buf
 = 
NULL
;

51 
size_t
 
num
 = 0;

53 i‡(
¨gc
 < 3) {

54 
	`ußge
(
¨gv
[0]);

55 
	`exô
(
EXIT_FAILURE
);

58 
›t
 = 
¨gv
[1][0];

59 i‡(
›t
 != 'r' && opt != 'w') {

60 
	`ußge
(
¨gv
[0]);

61 
	`exô
(
EXIT_FAILURE
);

63 i‡((
›t
 ='w' && 
¨gc
 != 4) || (opt == 'r' &&árgc != 3)) {

64 
	`ußge
(
¨gv
[0]);

65 
	`exô
(
EXIT_FAILURE
);

67 i‡('w' =
›t
 && 
	`°∫Àn
(
¨gv
[3], 
MAXBYTES
) > MAXBYTES) {

68 
	`Ârötf
(
°dîr
, "%s:Åoo bigá secret (%zu bytes);ÖlÑestrict"

69 "Åÿ%d byã†max\n", 
¨gv
[0], 
	`°∫Àn
(argv[3],

70 
MAXBYTES
),

71 
MAXBYTES
);

72 
	`exô
(
EXIT_FAILURE
);

75 i‡('w' =
›t
)

76 
Êags
 = 
O_WRONLY
;

77 
fd
 = 
	`›í
(
¨gv
[2], 
Êags
, 0);

78 i‡(
fd
 == -1) {

79 
	`Ârötf
(
°dîr
, "%s: o≥n(2Ë⁄ %†Áûed\n", 
¨gv
[0],árgv[2]);

80 
	`≥º‹
("open");

81 
	`exô
(
EXIT_FAILURE
);

83 
	`¥ötf
("Device file %s opened (in %s mode): fd=%d\n",

84 
¨gv
[2], (
Êags
 =
O_RDONLY
 ? "ªad-⁄ly" : "wrôe-⁄ly"), 
fd
);

86 i‡('w' =
›t
) {

87 
num
 = 
	`°∫Àn
(
¨gv
[3], 
MAXBYTES
) + 1;

88 i‡(
num
 > 
MAXBYTES
)

89 
num
 = 
MAXBYTES
;

91 
num
 = 
MAXBYTES
;

93 
buf
 = 
	`mÆloc
(
num
);

94 i‡(!
buf
) {

95 
	`Ârötf
(
°dîr
, "%s: ouào‡mem‹y!\n", 
¨gv
[0]);

96 
	`˛o£
(
fd
);

97 
	`exô
(
EXIT_FAILURE
);

100 i‡('r' =
›t
) {

101 
n
 = 
	`ªad
(
fd
, 
buf
, 
num
);

102 i‡(
n
 < 0) {

103 
	`≥º‹
("read failed");

104 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

105 
	`‰ì
(
buf
);

106 
	`˛o£
(
fd
);

107 
	`exô
(
EXIT_FAILURE
);

109 
	`¥ötf
("%s:Ñód %zd byã†‰om %s\n", 
¨gv
[0], 
n
,árgv[2]);

110 
	`¥ötf
("Thê'£¸ë' is:\¿\"%.*s\"\n", ()
n
, 
buf
);

112 
	`°∫˝y
(
buf
, 
¨gv
[3], 
num
);

113 
n
 = 
	`wrôe
(
fd
, 
buf
, 
num
);

114 i‡(
n
 < 0) {

115 
	`≥º‹
("write failed");

116 
	`Ârötf
(
°dîr
, "Tip: see kernelÜog\n");

117 
	`‰ì
(
buf
);

118 
	`˛o£
(
fd
);

119 
	`exô
(
EXIT_FAILURE
);

121 
	`¥ötf
("%s: wrŸê%zd byã†tÿ%s\n", 
¨gv
[0], 
n
,árgv[2]);

124 i‡(
°ay_Æive
) {

125 
	`¥ötf
("%s:%d: sèyö'álivê(öÖau£()Ë... \n", 
¨gv
[0],

126 
	`gëpid
());

127 
	`∑u£
();

130 
	`‰ì
(
buf
);

131 
	`˛o£
(
fd
);

132 
	`exô
(
EXIT_SUCCESS
);

133 
	}
}

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/oops1/oops1.c

7 
	~<löux/öô.h
>

8 
	~<löux/moduÀ.h
>

9 
	~<löux/¶ab.h
>

11 
MODULE_LICENSE
("Dual BSD/GPL");

12 *
	g±r
=
NULL
;

14 
__öô
 
	$o›s2_öô
()

16 
	`¥_öfo
("Hello,áboutÅo Oops!\n");

17 *(
±r
+0x20) = 'a';

19 
	}
}

21 
__exô
 
	$o›s2_exô
()

23 
	`¥_öfo
("Goodbye\n");

24 
	}
}

26 
moduÀ_öô
(
o›s2_öô
);

27 
moduÀ_exô
(
o›s2_exô
);

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/oops2/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_PRINT


47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=1; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 
	`¥ötk
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

59 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

126 
	~<löux/sched.h
>

127 
	~<löux/öãºu±.h
>

129 #i‚de‡
USE_FTRACE_PRINT


130 
	#PRINT_CTX
() do { \

131 
£p
='|', 
öå
='.'; \

133 i‡(
	`ö_öãºu±
()) { \

134 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

135 
öå
='H'; \

136 i‡(
	`ö_úq
()) \

137 
öå
='h'; \

138 i‡(
	`ö_so·úq
()) \

139 
öå
='s'; \

142 
öå
='.'; \

144 
	`DBGPRINT
( \

148 , 
	`smp_¥o˚ss‹_id
(), \

149 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

150 (
	`úqs_dißbÀd
()?'d':'.'), \

151 (
	`√ed_ªsched
()?'N':'.'), \

152 
öå
, \

153 (
	`¥ìm±_cou¡
() && 0xff) \

155 } 0)

	)

157 
	#PRINT_CTX
() do { \

158 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

163 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

165 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

166 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

168 } 0)

	)

184 #ifde‡
__KERNEL__


185 
	#as£π
(
ex¥
) do { \

186 i‡(!(
ex¥
)) { \

187 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

188 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

190 } 0)

	)

194 
ölöe
 
	$bìp
(
wh©
)

196 #ifde‡
__KERNEL__


197 
	`DBGPRINT
("%c", ()
wh©
);

199 ()
	`¥ötf
("%c", ()
wh©
);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

210 
c
=0, 
m
;\

211 
f‹_ödex
,
ö√r_ödex
; \

213 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++;\

216 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

217 
m
=0;m<50;m++); \

220 }

	)

223 #ifde‡
__KERNEL__


228 
	#DELAY_SEC
(
vÆ
) \

230 i‡(!
	`ö_öãºu±
()) { \

231 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

232 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

234 }

	)

246 
__©åibuã__
((
unu£d
))

247 
	$dec2bö
(
decimÆ
, *
bö¨y
)

249 
k
 = 0, 
n
 = 0;

250 
√g_Êag
 = 0;

251 
ªmaö
;

261 #unde‡
TESTMODE


263 #ifde‡
TESTMODE


264 
ﬁd_decimÆ
;

266 
ãmp
[80];

269 i‡(
decimÆ
 < 0) {

270 
decimÆ
 = -decimal;

271 
√g_Êag
 = 1;

274 #ifde‡
TESTMODE


275 
ﬁd_decimÆ
 = 
decimÆ
;

277 
ªmaö
 = 
decimÆ
 % 2;

279 
decimÆ
 = decimal / 2;

281 #ifde‡
TESTMODE


282 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
, 
ªmaö
);

285 
ãmp
[
k
++] = 
ªmaö
 + '0';

286 } 
decimÆ
 > 0);

288 i‡(
√g_Êag
)

289 
ãmp
[
k
++] = '-';

291 
ãmp
[
k
++] = ' ';

294 
k
 >= 0)

295 
bö¨y
[
n
++] = 
ãmp
[--
k
];

297 
bö¨y
[
n
 - 1] = 0;

298 
	}
}

300 #i‚de‡
__KERNEL__


302 
	#MSG
(
°rög
, 
¨gs
...) do { \

303 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

304 } 0)

	)

306 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

307 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

308 } 0)

	)

310 
	#QP
 
	`MSG
("\n")

	)

313 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

315 i‡(
vîbo£
) \

316 
	`¥ötf
(
°r
, ##
¨gs
); \

317 } 0)

	)

319 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

321 
îr_°r
[512];

323 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

324 
	`≥º‹
(
îr_°r
);

325 
	`exô
(
exôcode
);

326 
	}
}

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/oops2/oops2.c

8 
	~<löux/öô.h
>

9 
	~<löux/moduÀ.h
>

10 
	~<löux/¶ab.h
>

11 
	~"c⁄víõ¡.h
"

13 
MODULE_LICENSE
("Dual MIT/GPL");

26 
	sÁkî
 {

27 
	ml⁄gs
[7];

28 
	mdumb
[7];

29 
	mbad_ˇche_Æign
;

31 
Ákî
 *
	gf1
 = 
NULL
;

33 
__öô
 
	$o›s2_öô
()

36 
f1
 = 
	`kmÆloc
((
Ákî
), 
GFP_KERNEL
);

37 i‡(!
f1
)

38  -
ENOMEM
;

39 
	`MSG
("sizeof(long) = %ld, sizeof(struct faker) = %lu,áctual spaceálloced = %lu\n",

40 (), (
Ákî
), 
	`ksize
(
f1
));

42 
	`MSG
("Hello,áboutÅo Oops!\n");

43 
f1
->
bad_ˇche_Æign
 = 0xabcd;

46 
	}
}

48 
__exô
 
	$o›s2_exô
()

51 
	`k‰ì
(
f1
);

53 
	`MSG
("Goodbye\n");

54 
	}
}

56 
moduÀ_öô
(
o›s2_öô
);

57 
moduÀ_exô
(
o›s2_exô
);

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/panic_notifier/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_PRINT


47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=1; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 
	`¥ötk
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

59 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

126 
	~<löux/sched.h
>

127 
	~<löux/öãºu±.h
>

129 #i‚de‡
USE_FTRACE_PRINT


130 
	#PRINT_CTX
() do { \

131 
£p
='|', 
öå
='.'; \

133 i‡(
	`ö_öãºu±
()) { \

134 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

135 
öå
='H'; \

136 i‡(
	`ö_úq
()) \

137 
öå
='h'; \

138 i‡(
	`ö_so·úq
()) \

139 
öå
='s'; \

142 
öå
='.'; \

144 
	`DBGPRINT
( \

148 , 
	`smp_¥o˚ss‹_id
(), \

149 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

150 (
	`úqs_dißbÀd
()?'d':'.'), \

151 (
	`√ed_ªsched
()?'N':'.'), \

152 
öå
, \

153 (
	`¥ìm±_cou¡
() && 0xff) \

155 } 0)

	)

157 
	#PRINT_CTX
() do { \

158 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

163 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

165 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

166 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

168 } 0)

	)

184 #ifde‡
__KERNEL__


185 
	#as£π
(
ex¥
) do { \

186 i‡(!(
ex¥
)) { \

187 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

188 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

190 } 0)

	)

194 
ölöe
 
	$bìp
(
wh©
)

196 #ifde‡
__KERNEL__


197 
	`DBGPRINT
("%c", ()
wh©
);

199 ()
	`¥ötf
("%c", ()
wh©
);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

210 
c
=0, 
m
;\

211 
f‹_ödex
,
ö√r_ödex
; \

213 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++;\

216 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

217 
m
=0;m<50;m++); \

220 }

	)

223 #ifde‡
__KERNEL__


228 
	#DELAY_SEC
(
vÆ
) \

230 i‡(!
	`ö_öãºu±
()) { \

231 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

232 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

234 }

	)

241 
timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

242 
timevÆ
 *
y
);

246 
__©åibuã__
 ((
unu£d
))

247 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

248 
timevÆ
 *
y
)

251 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

252 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

253 
y
->
tv_u£c
 -1000000 * 
n£c
;

254 
y
->
tv_£c
 +
n£c
;

256 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

257 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

258 
y
->
tv_u£c
 +1000000 * 
n£c
;

259 
y
->
tv_£c
 -
n£c
;

264 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

265 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

268  
x
->
tv_£c
 < 
y
->tv_sec;

269 
	}
}

280 
__©åibuã__
 ((
unu£d
))

281 
	$dec2bö
(
decimÆ
, *
bö¨y
)

283 
k
 = 0, 
n
 = 0;

284 
√g_Êag
 = 0;

285 
ªmaö
;

295 #unde‡
TESTMODE


297 #ifde‡
TESTMODE


298 
ﬁd_decimÆ
;

300 
ãmp
[80];

303 i‡(
decimÆ
 < 0) {

304 
decimÆ
 = -decimal;

305 
√g_Êag
 = 1;

308 #ifde‡
TESTMODE


309 
ﬁd_decimÆ
 = 
decimÆ
;

311 
ªmaö
 = 
decimÆ
 % 2;

313 
decimÆ
 = decimal / 2;

315 #ifde‡
TESTMODE


316 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

317 
ªmaö
);

320 
ãmp
[
k
++] = 
ªmaö
 + '0';

321 } 
decimÆ
 > 0);

323 i‡(
√g_Êag
)

324 
ãmp
[
k
++] = '-';

326 
ãmp
[
k
++] = ' ';

329 
k
 >= 0)

330 
bö¨y
[
n
++] = 
ãmp
[--
k
];

332 
bö¨y
[
n
 - 1] = 0;

333 
	}
}

335 #i‚de‡
__KERNEL__


337 
	#MSG
(
°rög
, 
¨gs
...) do { \

338 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

339 } 0)

	)

341 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

342 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

343 } 0)

	)

345 
	#QP
 
	`MSG
("\n")

	)

348 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

350 i‡(
vîbo£
) \

351 
	`¥ötf
(
°r
, ##
¨gs
); \

352 } 0)

	)

354 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

356 
îr_°r
[512];

358 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

359 
	`≥º‹
(
îr_°r
);

360 
	`exô
(
exôcode
);

361 
	}
}

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/panic_notifier/panic_handler_lkm.c

6 
	~<löux/öô.h
>

7 
	~<löux/moduÀ.h
>

8 
	~<löux/nŸifõr.h
>

9 
	~<asm-gíîic/bug.h
>

11 
MODULE_LICENSE
("Dual BSD/GPL");

13 
u32
 
	g¨m•
;

14 
	$¨m_gëªg
()

16 #i‡
deföed
 
CONFIG_ARM


17 
__asm__
 
	`__vﬁ©ûe__
 (

19 : "Ù" (
¨m•
)

23 
	}
}

26 #i‡
deföed
 
CONFIG_ARM


27 
	#ARM_GETREG
(
REG
) \

29 
__asm__
 
	`__vﬁ©ûe__
 ( \

31 : "Ù" (
¨m•
) \

34 } 0)

	)

39 
	$my_∑nic_nŸifõr_ˇŒ
(
nŸifõr_block
 *
nb
,

40 
code
, *
_∑øm
)

42 
loc
=5;

44 
	`¥_emîg
("P™i¯!ALARM! @ %s_%s_%d\n", 
__FILE__
, 
__FUNCTION__
, 
__LINE__
);

45 
	`dump_°ack
();

46 #i‡
deföed
 
CONFIG_ARM


47 
	`¨m_gëªg
();

48 
	`¥_emîg
("loc=0x%p, ARM sèckÑeg vÆ = 0x%x\n", &
loc
, 
¨m•
);

50  
NOTIFY_OK
;

51 
	}
}

53 
nŸifõr_block
 
	gk_∑nic_nŸifõr_block
 = {

54 .
nŸifõr_ˇŒ
 = 
my_∑nic_nŸifõr_ˇŒ
,

55 .
	g√xt
 = 
NULL
,

56 .
	g¥i‹ôy
 = 
INT_MAX


59 
	$≤c_ªgi°î_∑nic_nŸifõr
()

61 
	`©omic_nŸifõr_chaö_ªgi°î
(&
∑nic_nŸifõr_li°
, &
k_∑nic_nŸifõr_block
);

69 
	}
}

71 
	$≤c_uƒegi°î_∑nic_nŸifõr
()

73 
	`©omic_nŸifõr_chaö_uƒegi°î
(&
∑nic_nŸifõr_li°
, &
k_∑nic_nŸifõr_block
);

74 
	}
}

76 
__öô
 
	$≤c_öô
()

78 
	`≤c_ªgi°î_∑nic_nŸifõr
();

79 
	`¥_debug
("RegdÖanicÇotifier.\n");

81 
	}
}

82 
__exô
 
	$≤c_exô
()

84 
	`≤c_uƒegi°î_∑nic_nŸifõr
();

85 
	`¥_debug
("UnregdÖanicÇotifier.\n");

86 
	}
}

88 
moduÀ_öô
(
≤c_öô
);

89 
moduÀ_exô
(
≤c_exô
);

	@Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/warn_bug_try/warn_bug_try.c

7 
	~<löux/öô.h
>

8 
	~<löux/moduÀ.h
>

9 
	~<asm-gíîic/bug.h
>

11 
MODULE_LICENSE
("Dual BSD/GPL");

13 
__öô
 
	$w¨n_bug_åy_öô
()

15 
n
=5;

16 
	`¥ötk
(
KERN_ALERT
 "Hello, world\n");

18 
	`WARN
((1==1), "%d: WARNÅry :)", 
n
);

20 
	`∑nic
("YeaÖanic-king..\n");

23 
	}
}

25 
__exô
 
	$w¨n_bug_åy_exô
()

27 
	`¥ötk
(
KERN_ALERT
 "Goodbye, invoking BUGÇow...\n");

29 
	`BUG
();

32 
	}
}

34 
moduÀ_öô
(
w¨n_bug_åy_öô
);

35 
moduÀ_exô
(
w¨n_bug_åy_exô
);

	@Training/L5_debug_trg/kernel_debug/kmemleak_kmemcheck_test/kmemchk_test.c

15 
	~<löux/öô.h
>

16 
	~<löux/moduÀ.h
>

17 
	~<löux/¶ab.h
>

18 
	~<löux/vmÆloc.h
>

21 
	$gÂ_ã°
()

23 
kbuf
, *
kp
;

24 
kbuf
 = 
	`__gë_‰ì_∑ge
(
GFP_KERNEL
);

25 
kp
 = (*)
kbuf
;

26 i‡(!
kp
) {

27 
	`¥_w¨n
("out of memory!");

28  -
ENOMEM
;

30 
	`¥_öfo
("$$$ gfp_test: kp=%pÖa=%p\n",

31 ()
kp
,

32 ()
	`vút_to_phys
(
kp
));

33 
	`¥öt_hex_dump_byãs
("$$$ ", 
DUMP_PREFIX_ADDRESS
, 
kp
, 32);

34 
	`‰ì_∑ge
(
kbuf
);

36 
	}
}

38 
	$¶ab_ã°
()

40 *
kbuf
;

41 
kbuf
 = 
	`kmÆloc
(512, 
GFP_KERNEL
);

42 i‡(!
kbuf
) {

43 
	`¥_w¨n
("kmalloc: out of memory!");

44  -
ENOMEM
;

46 
	`¥_öfo
("### sœb_ã°: kbuf=%∞∑=%p\n", 
kbuf
,

47 
	`vút_to_phys
(
kbuf
));

48 
	`¥öt_hex_dump_byãs
("### ", 
DUMP_PREFIX_ADDRESS
, 
kbuf
, 32);

49 
	`k‰ì
(
kbuf
);

51 
	}
}

53 
	$vmÆloc_ã°
(
Àn
)

55 *
vbuf
;

56 
vbuf
 = 
	`vmÆloc
(
Àn
);

57 i‡(!
vbuf
) {

58 
	`¥_w¨n
("vmalloc: out of memory!");

59  -
ENOMEM
;

61 
	`¥_öfo
("@@@ vmÆloc_ã°: vmÆloc(%u): vbuf=%∞∑=%p\n", 
Àn
, 
vbuf
,

62 
	`vút_to_phys
(
vbuf
));

63 
	`¥öt_hex_dump_byãs
("@@@ ", 
DUMP_PREFIX_ADDRESS
, 
vbuf
, 
Àn
);

64 #i‚de‡
KMEMLEAK_TEST


65 
	`v‰ì
(
vbuf
);

68 
	}
}

71 
__öô
 
	$kmemchk_ã°_öô
()

73 
loˇl_öô
=5, 
loˇl_unöô
;

75 
	`¥_öfo
("Hi,áccessingÜocal varsÇow:Üocal_init=%dÜocal_uninit=%d\n",

76 
loˇl_öô
, 
loˇl_unöô
);

85 
	`vmÆloc_ã°
(5*
PAGE_SIZE
);

88 
	}
}

90 
__exô
 
	$kmemchk_ã°_exô
()

92 
	`¥_öfo
("Goodbye\n");

93 
	}
}

95 
moduÀ_öô
(
kmemchk_ã°_öô
);

96 
moduÀ_exô
(
kmemchk_ã°_exô
);

98 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/1_kp_simple/kp_intr.c

18 
	~<löux/moduÀ.h
>

19 
	~<löux/kî√l.h
>

20 
	~<löux/öô.h
>

21 
	~<löux/sched.h
>

22 
	~<löux/öãºu±.h
>

23 
	~<löux/k¥obes.h
>

25 
k¥obe
 
	gkpb
 = {

26 .
symbﬁ_«me
 = "timer_interrupt",

36 
	$h™dÀr_¥e_timîöå
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
)

38 i‡(
	`¥ötk_øãlimô
())

39 
	`¥ötk
(
KERN_INFO
 "kprobeÅimer interruptÖre_handler: intr ctx = %d\
:process %s:%d\n",

41 
	`ö_öãºu±
(Ë? 1 : 0, 
cuºít
->
comm
, cuºít->
tgid
);

43 
	}
}

45 
	$kp_sched_öô_moduÀ
()

47 
kpb
.
¥e_h™dÀr
 = 
h™dÀr_¥e_timîöå
;

48 
	`ªgi°î_k¥obe
(&
kpb
);

49 
	`¥ötk
("registered kprobe \n");

51 
	}
}

53 
	$kp_sched_˛ónup_moduÀ
()

55 
	`uƒegi°î_k¥obe
(&
kpb
);

56 
	`¥ötk
("unregister kprobe,ánd unloaded.\n");

57 
	}
}

58 
moduÀ_öô
(
kp_sched_öô_moduÀ
);

59 
moduÀ_exô
(
kp_sched_˛ónup_moduÀ
);

61 
MODULE_AUTHOR
("Kaiwan NB");

62 
MODULE_DESCRIPTION
("Simple kprobe demo");

63 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/1_kp_simple/kp_sched.c

17 
	~<löux/moduÀ.h
>

18 
	~<löux/kî√l.h
>

19 
	~<löux/öô.h
>

20 
	~<löux/sched.h
>

21 
	~<löux/öãºu±.h
>

22 
	~<löux/k¥obes.h
>

24 
k¥obe
 
	gkpb
 = {

25 .
symbﬁ_«me
 = "schedule",

36 
	$h™dÀr_¥e_scheduÀ
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
)

38 i‡(
	`¥ötk_øãlimô
())

39 
	`¥ötk
(
KERN_INFO
 "kprobe scheduleÖre_handler: intr ctx = %d :process %s:%d\n",

40 
	`ö_öãºu±
(Ë? 1 : 0, 
cuºít
->
comm
, cuºít->
tgid
);

42 
	}
}

45 
	$h™dÀr_po°_scheduÀ
(
k¥obe
 *
p
, 
±_ªgs


46 *
ªgs
, 
Êags
){

47 
	`¥ötk
("po°_h™dÀr_scheduÀ:Ö->addr=0x%p\n", 
p
->
addr
);

48 
	}
}

51 
	$kp_sched_öô_moduÀ
()

53 
kpb
.
¥e_h™dÀr
 = 
h™dÀr_¥e_scheduÀ
;

56 
	`ªgi°î_k¥obe
(&
kpb
);

57 
	`¥ötk
("registered kprobe \n");

59 
	}
}

61 
	$kp_sched_˛ónup_moduÀ
()

63 
	`uƒegi°î_k¥obe
(&
kpb
);

64 
	`¥ötk
("unregister kprobe,ánd unloaded.\n");

65 
	}
}

66 
moduÀ_öô
(
kp_sched_öô_moduÀ
);

67 
moduÀ_exô
(
kp_sched_˛ónup_moduÀ
);

69 
MODULE_AUTHOR
("Kaiwan NB");

70 
MODULE_DESCRIPTION
("Simple kprobe demo");

71 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/1_kp_simple/kp_sys_open.c

9 
	~<löux/kî√l.h
>

10 
	~<löux/moduÀ.h
>

11 
	~<löux/k¥obes.h
>

13 
k¥obe
 
	gkpb
;

15 
	$h™dÀr_¥e_sys_›í
(
k¥obe
 *
p
, 
±_ªgs


16 *
ªgs
) {

17 
	`¥ötk
("sys_›íÖª_h™dÀr:Ö->addr=0x%p\n", 
p
->
addr
);

19 
	}
}

21 
	$h™dÀr_po°_sys_›í
(
k¥obe
 *
p
, 
±_ªgs


22 *
ªgs
, 
Êags
){

23 
	`¥ötk
("po°_h™dÀr_sys_›í:Ö->addr=0x%p\n", 
p
->
addr
);

24 
	}
}

26 
	$h™dÀr_Áu…_sys_›í
(
k¥obe
 *
p
, 
±_ªgs


27 *
ªgs
, 
å≠ƒ
) {

28 
	`¥ötk
("Áu…_h™dÀr_sys_›í:Ö->addr=0x%p\n", 
p
->
addr
);

30 
	}
}

32 
	$öô_moduÀ
()

34 
kpb
.
Áu…_h™dÀr
 = 
h™dÀr_Áu…_sys_›í
;

35 
kpb
.
¥e_h™dÀr
 = 
h™dÀr_¥e_sys_›í
;

36 
kpb
.
po°_h™dÀr
 = 
h™dÀr_po°_sys_›í
;

38 
kpb
.
symbﬁ_«me
 = "sys_open";

39 
	`ªgi°î_k¥obe
(&
kpb
);

40 
	`¥ötk
("Ñegister kprobe \n");

42 
	}
}

44 
	$˛ónup_moduÀ
()

46 
	`uƒegi°î_k¥obe
(&
kpb
);

47 
	`¥ötk
("unregister kprobe\n");

48 
	}
}

49 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/2_helper_kp/convenient.h

16 #i‚de‡
__LKP2_CONVENIENT_H__


17 
	#__LKP2_CONVENIENT_H__


	)

19 
	~<asm/∑øm.h
>

20 
	~<löux/sched.h
>

22 #ifde‡
__KERNEL__


23 
	~<löux/øãlimô.h
>

52 #unde‡
USE_FTRACE_BUFFER


54 #ifde‡
USE_FTRACE_BUFFER


55 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

56 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

58 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

59 
USE_RATELIMITING
 = 1; \

60 i‡(
USE_RATELIMITING
) { \

61 
	`¥_öfo_øãlimôed
(
°rög
, ##
¨gs
); \

64 
	`¥_öfo
(
°rög
, ##
¨gs
); \

65 } 0)

	)

70 #ifde‡
DEBUG


71 #ifde‡
__KERNEL__


72 
	#MSG
(
°rög
, 
¨gs
...) do { \

73 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

74 } 0)

	)

76 
	#MSG
(
°rög
, 
¨gs
...) do { \

77 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__func__
, 
__LINE__
, ##
¨gs
); \

78 } 0)

	)

81 #ifde‡
__KERNEL__


82 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

83 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

84 } 0)

	)

86 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

87 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

88 } 0)

	)

92 
	#QP
 
	`MSG
("\n")

	)

94 #ifde‡
__KERNEL__


95 #i‚de‡
USE_FTRACE_BUFFER


96 
	#QPDS
 do { \

97 
	`MSG
("\n"); \

98 
	`dump_°ack
(); \

99 } 0)

	)

101 
	#QPDS
 do { \

102 
	`MSG
("\n"); \

103 
	`åa˚_dump_°ack
(); \

104 } 0)

	)

108 #ifde‡
__KERNEL__


109 
	#HexDump
(
‰om_addr
, 
Àn
) do { \

110 
	`¥öt_hex_dump_byãs
(" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
); \

111 } 0)

	)

114 
	#MSG
(
°rög
, 
¨gs
...)

	)

115 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

116 
	#QP


	)

117 
	#QPDS


	)

125 
	#SHOW_DELTA_b
(
low
, 
hi
Ë÷ow), (hi), ((hiË- (low))

	)

126 
	#SHOW_DELTA_K
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 10)

	)

127 
	#SHOW_DELTA_M
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20)

	)

128 
	#SHOW_DELTA_G
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 30)

	)

129 
	#SHOW_DELTA_MG
(
low
, 
hi
Ë÷ow), (hi), (((hiË- (low)Ë>> 20), (((hiË- (low)Ë>> 30)

	)

131 #ifde‡
__KERNEL__


152 
	~<löux/sched.h
>

153 
	~<löux/öãºu±.h
>

155 
	#PRINT_CTX
() do { \

156 
PRINTCTX_SHOWHDR
 = 0; \

157 
öå
 = '.'; \

158 i‡(!
	`ö_èsk
()) { \

159 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

160 
öå
 = 'H'; \

161 i‡(
	`ö_úq
()) \

162 
öå
 = 'h'; \

163 i‡(
	`ö_so·úq
()) \

164 
öå
 = 's'; \

167 
öå
 = '.'; \

169 i‡(
PRINTCTX_SHOWHDR
 == 1) \

170 
	`¥_debug
("CPU)Åask_name:PID | irqs,need-resched,hard/softirq,preempt-depth /* func_name() */\n"); \

171 
	`¥_debug
( \

175 , 
	`øw_smp_¥o˚ss‹_id
(), \

176 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, \

177 (
	`úqs_dißbÀd
()?'d':'.'), \

178 (
	`√ed_ªsched
()?'N':'.'), \

179 
öå
, \

180 (
	`¥ìm±_cou¡
() && 0xff), \

181 
__func__
 \

183 } 0)

	)

198 #ifde‡
__KERNEL__


199 
	#as£π
(
ex¥
) do { \

200 i‡(!(
ex¥
)) { \

201 
	`¥_w¨n
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

202 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

204 } 0)

	)

208 
ölöe
 
	$bìp
(
wh©
)

210 #ifde‡
__KERNEL__


211 
	`¥_öfo
("%c", ()
wh©
);

213 
	~<uni°d.h
>

214 
buf
 = ()
wh©
;

215 ()
	`wrôe
(
STDOUT_FILENO
, &
buf
, 1);

217 
	}
}

226 
	#DELAY_LOOP
(
vÆ
, 
lo›_cou¡
) \

228 
c
 = 0, 
m
; \

229 
f‹_ödex
, 
ö√r_ödex
, 
x
; \

231 
f‹_ödex
 = 0; f‹_ödex < 
lo›_cou¡
; for_index++) { \

232 
	`bìp
((
vÆ
)); \

233 
c
++; \

234 
ö√r_ödex
 = 0; i¬î_ödex < 
HZ
; inner_index++) { \

235 
m
 = 0; m < 50; m++); \

236 
x
 = 
ö√r_ödex
 / 2; \

240 }

	)

243 #ifde‡
__KERNEL__


244 
dñay_£c
();

256 
	$dñay_£c
(
vÆ
)

258 
	`asm
 ("");

259 i‡(
	`ö_èsk
()) {

260 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

261 i‡(-1 =
vÆ
)

262 
	`scheduÀ_timeout
(
MAX_SCHEDULE_TIMEOUT
);

264 
	`scheduÀ_timeout
(
vÆ
 * 
HZ
);

266 
	}
}

269 #ifde‡
__KERNEL__


277 
	~<löux/jiffõs.h
>

278 
	~<löux/ktime.h
>

279 
	#SHOW_DELTA
(
œãr
, 
óæõr
) do { \

280 i‡(
	`time_a·î
(()
œãr
, ()
óæõr
)) { \

281 
	`¥_öfo
("delta: %lldÇs (~ %lld us ~ %lld ms)\n", \

282 
	`ktime_sub
(
œãr
, 
óæõr
), \

283 
	`ktime_sub
(
œãr
, 
óæõr
)/1000, \

284 
	`ktime_sub
(
œãr
, 
óæõr
)/1000000 \

287 
	`¥_w¨n
("SHOW_DELTA(): *invalid*Éarlier >Üater?\n"); \

288 } 0)

	)

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/2_helper_kp/helper_kp.c

18 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

20 
	~<löux/moduÀ.h
>

21 
	~<löux/kî√l.h
>

22 
	~<löux/öô.h
>

23 
	~<löux/öãºu±.h
>

24 
	~<löux/•ölock.h
>

25 
	~<löux/k¥obes.h
>

26 
	~"c⁄víõ¡.h
"

28 
	#MODULE_VER
 "0.1"

	)

31 * 
	gfun˙ame
;

35 
moduÀ_∑øm
(
fun˙ame
, 
ch¨p
, 0);

36 
MODULE_PARM_DESC
(
fun˙ame
,

39 
	gvîbo£
=0;

40 
moduÀ_∑øm
(
vîbo£
, , 0644);

41 
MODULE_PARM_DESC
(
vîbo£
, "SetÅo 1Åo get verboseÖrintk's (defaultsÅo 0).");

43 
k¥obe
 
	gkpb
;

44 
u64
 
	gtm_°¨t
 = 0, 
	gtm_íd
 = 0;

45 
	gru¬ög_avg
=0;

46 
•ölock_t
 
	glock
;

51 
	$h™dÀr_¥e
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
)

53 
	`•ö_lock
(&
lock
);

54 
tm_°¨t
 = 
	`ktime_gë_ªÆ_ns
();

55 
	`•ö_u∆ock
(&
lock
);

57 i‡(
vîbo£
) {

58 
	`¥_debug
–"Pª '%s'.\n", 
fun˙ame
);

59 
	`PRINT_CTX
();

63 
	}
}

65 
	#QUITE_LARGE_LATENCY_US
 100

66 
	`h™dÀr_po°
(
k¥obe
 *
p
, 
±_ªgs
 *
ªgs
,

	)

67 
	gÊags
)

69 
•ö_lock
(&
lock
);

70 
	gtm_íd
 = 
ktime_gë_ªÆ_ns
();

72 i‡(
	gvîbo£
) {

73 
¥_debug
( "%s:%d. Post '%s'.\n",

74 
cuºít
->
comm
, cuºít->
pid
, 
fun˙ame
);

88 
SHOW_DELTA
(
tm_íd
, 
tm_°¨t
);

89 
•ö_u∆ock
(&
lock
);

92 
__öô
 
	$hñ≥r_kp_öô_moduÀ
()

94 i‡(!
fun˙ame
) {

95 
	`¥_öfo
("MustÖass funcnameásá moduleÖarameter\n");

96  -
EINVAL
;

98 
	`•ö_lock_öô
(&
lock
);

99 
	`¥_öfo
("å≠pög fun˘i⁄ %s, vîbo£ modê%s\n", 
fun˙ame
, (
vîbo£
==1?"Y":"N"));

105 
kpb
.
¥e_h™dÀr
 = 
h™dÀr_¥e
;

106 
kpb
.
po°_h™dÀr
 = 
h™dÀr_po°
;

107 
kpb
.
symbﬁ_«me
 = 
fun˙ame
;

108 i‡(
	`ªgi°î_k¥obe
(&
kpb
)) {

109 
	`¥_Æît
("register_kprobe failed!\n"

111 
fun˙ame
);

112  -
EINVAL
;

114 
	`¥_öfo
("ªgi°îed k¥obêf‹ fun˘i⁄ %s\n", 
fun˙ame
);

116 
	}
}

118 
	$hñ≥r_kp_˛ónup_moduÀ
()

120 
	`uƒegi°î_k¥obe
(&
kpb
);

121 
	`¥_öfo
("Uƒegi°îed k¥obê@ fun˘i⁄ %s\n", 
fun˙ame
);

122 
	}
}

124 
moduÀ_öô
(
hñ≥r_kp_öô_moduÀ
);

125 
moduÀ_exô
(
hñ≥r_kp_˛ónup_moduÀ
);

127 
MODULE_AUTHOR
("Kaiwan N Billimoria");

128 
MODULE_DESCRIPTION
("Helper Kprobe module;Ñegistersá kprobeÅoÅheÖassed function");

129 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/2_helper_kp/kp_hello_oops.c

40 
	~<löux/moduÀ.h
>

41 
	~<löux/kî√l.h
>

42 
	~<löux/öô.h
>

43 
	~<löux/sched.h
>

44 
	~<löux/¥oc_fs.h
>

46 
	#MODULE_VER
 "1.0"

	)

47 
	#MODULE_NAME
 "hñlo_o›s"

	)

48 
	#¥o˙ame
 "o›s-ã°"

	)

50 #ifde‡
DEBUG


51 
	#MSG
(
°rög
, 
¨gs
...) \

52 
	`¥ötk
(
KERN_DEBUG
 "%s:%s:%d: " 
°rög
, \

53 
MODULE_NAME
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
)

	)

55 
	#MSG
(
°rög
, 
¨gs
...)

	)

61 
	$hñlo_¥o¸ód
(*
buf
, **
°¨t
, 
off_t
 
off£t
,

62 
cou¡
, *
eof
, *
d©a
)

64 
n
, *
p
;

66 
n
 = 
	`•rötf
(
buf
, "InÖrocÑead callback.\n\
 %dÑunning onÖrocessor # %d\n",

68 
cuºít
->
pid
, 
	`smp_¥o˚ss‹_id
());

76 
p
=0;

77 
	`¥ötk
 (
KERN_INFO
 "%s: %d\n", 
MODULE_NAME
,

78 *
p
);

85 *
eof
=1;

86  
n
;

87 
	}
}

93 
__öô
 
	$hñlo_o›s_öô_moduÀ
()

95 i‡(!
	`¸óã_¥oc_ªad_íåy
 (
¥o˙ame
, 0444,

96 
NULL
,

97 
hñlo_¥o¸ód
,

98 
NULL
 )) {

99 
	`MSG
("ProcÉntry creation failure,áborting..\n");

100  -
ENOMEM
;

103 
	`¥ötk
(
KERN_INFO
 "%†%†öôülized\n", 
MODULE_NAME
, 
MODULE_VER
);

105 
	}
}

110 
	$hñlo_o›s_˛ónup_moduÀ
()

112 
	`ªmove_¥oc_íåy
 (
¥o˙ame
, 
NULL
);

113 
	`¥ötk
(
KERN_INFO
 "%†%†ªmoved\n", 
MODULE_NAME
, 
MODULE_VER
);

114 
	}
}

116 
moduÀ_öô
(
hñlo_o›s_öô_moduÀ
);

117 
moduÀ_exô
(
hñlo_o›s_˛ónup_moduÀ
);

119 
MODULE_AUTHOR
("Kaiwan NB");

120 
MODULE_DESCRIPTION
("A very simple Oops! dump demo");

121 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/3_jprobes_simple/jprobe_eg.c

15 
	~<löux/kî√l.h
>

16 
	~<löux/moduÀ.h
>

17 
	~<löux/k¥obes.h
>

18 
	~<löux/öãºu±.h
>

19 
	~"../c⁄víõ¡.h
"

21 
	#MYNAME
 "j¥obe_eg"

	)

29 
	$jp_do_sys_›í
(
dfd
, c⁄° 
__u£r
 *
fûíame
, 
Êags
, 
mode
)

31 
	`PRINT_CTX
();

34 
	`j¥obe_ªtu∫
();

36 
	}
}

39 
	$jp_do_f‹k
(
˛⁄e_Êags
, 
°ack_°¨t
,

40 
±_ªgs
 *
ªgs
, 
°ack_size
,

41 
__u£r
 *
∑ª¡_tid±r
, __u£∏*
chûd_tid±r
)

43 
	`PRINT_CTX
();

44 
	`¥ötk
(
KERN_INFO
 "%s:%s:clone_flags = 0x%lx, stack_size = 0x%lx [%s]\n",

45 
MYNAME
, 
__func__
, 
˛⁄e_Êags
, 
°ack_size
, 
cuºít
->
comm
);

48 
	`j¥obe_ªtu∫
();

50 
	}
}

52 
	$jp_do_execve
(* 
fûíame
,

53 
__u£r
 *__u£∏*
¨gv
,

54 
__u£r
 *__u£∏*
ívp
,

55 
±_ªgs
 * 
ªgs
)

57 
	`PRINT_CTX
();

58 
	`¥ötk
(
KERN_INFO
 "%s:%s:¥ede˚ss‹ -> suc˚ss‹: %†-> %s\n", 
MYNAME
, 
__func__
, 
cuºít
->
comm
, 
fûíame
);

61 
	`j¥obe_ªtu∫
();

63 
	}
}

66 
j¥obe
 
	gmy_do_f‹k_j¥obe
 = {

67 .
íåy
 = 
jp_do_f‹k
,

68 .
	gkp
 = {

69 .
symbﬁ_«me
 = "do_fork",

72 
j¥obe
 
	gmy_vfs_›í_j¥obe
 = {

73 .
íåy
 = 
jp_do_sys_›í
,

74 .
	gkp
 = {

75 .
symbﬁ_«me
 = "do_sys_open",

78 
j¥obe
 
	gmy_do_execve_j¥obe
 = {

79 .
íåy
 = 
jp_do_execve
,

80 .
	gkp
 = {

81 .
symbﬁ_«me
 = "do_execve",

85 
__öô
 
	$j¥obe_öô
()

87 
ªt
;

89 
ªt
 = 
	`ªgi°î_j¥obe
(&
my_do_f‹k_j¥obe
);

90 i‡(
ªt
 < 0) {

91 
	`¥ötk
(
KERN_INFO
 "ªgi°î_j¥obêÁûed,Ñëu∫ed %d\n", 
ªt
);

97 
ªt
 = 
	`ªgi°î_j¥obe
(&
my_vfs_›í_j¥obe
);

98 i‡(
ªt
 < 0) {

99 
	`¥ötk
(
KERN_INFO
 "ªgi°î_j¥obêÁûed,Ñëu∫ed %d\n", 
ªt
);

103 
ªt
 = 
	`ªgi°î_j¥obe
(&
my_do_execve_j¥obe
);

104 i‡(
ªt
 < 0) {

105 
	`¥ötk
(
KERN_INFO
 "ªgi°î_j¥obêÁûed,Ñëu∫ed %d\n", 
ªt
);

108 
	`¥ötk
(
KERN_INFO
 "%s: J¥obe†ªgi°îed.\n", 
MYNAME
);

110 
	}
}

112 
__exô
 
	$j¥obe_exô
()

115 
	`uƒegi°î_j¥obe
(&
my_do_f‹k_j¥obe
);

116 
	`uƒegi°î_j¥obe
(&
my_do_execve_j¥obe
);

117 
	`¥ötk
(
KERN_INFO
 "%s: j¥obe†uƒegi°îed\n", 
MYNAME
);

118 
	}
}

120 
	$moduÀ_öô
(
j¥obe_öô
)

121 
	$moduÀ_exô
(
j¥obe_exô
)

122 
	`MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/4_helper_jp_probeit/convenient.h

11 #i‚de‡
__CONVENIENT_H__


12 
	#__CONVENIENT_H__


	)

14 
	~<asm/∑øm.h
>

15 
	~<löux/sched.h
>

17 #ifde‡
__KERNEL__


18 
	~<löux/øãlimô.h
>

44 #unde‡
USE_FTRACE_PRINT


46 #ifde‡
USE_FTRACE_PRINT


47 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

48 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

50 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

51 
USE_RATELIMITING
=1; \

52 i‡(
USE_RATELIMITING
) { \

53 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

56 
	`¥_öfo
(
	`¥_fmt
(
°rög
), ##
¨gs
); \

57 } 0)

	)

61 #ifde‡
DEBUG


62 #ifde‡
__KERNEL__


63 
	#MSG
(
°rög
, 
¨gs
...) do { \

64 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

65 } 0)

	)

67 
	#MSG
(
°rög
, 
¨gs
...) do { \

68 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

69 } 0)

	)

72 #ifde‡
__KERNEL__


73 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

74 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

75 } 0)

	)

77 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

78 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

79 } 0)

	)

83 
	#QP
 
	`MSG
("\n")

	)

85 #ifde‡
__KERNEL__


86 
	#QPDS
 do { \

87 
	`MSG
("\n"); \

88 
	`dump_°ack
(); \

89 } 0)

	)

92 #ifde‡
__KERNEL__


93 
	#HexDump
(
‰om_addr
, 
Àn
) \

94 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

97 
	#MSG
(
°rög
, 
¨gs
...)

	)

98 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

99 
	#QP


	)

100 
	#QPDS


	)

125 
	~<löux/sched.h
>

126 
	~<löux/öãºu±.h
>

128 #i‚de‡
USE_FTRACE_PRINT


129 
	#PRINT_CTX
() do { \

130 
£p
='|', 
öå
='.'; \

132 i‡(
	`ö_öãºu±
()) { \

133 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

134 
öå
='H'; \

135 i‡(
	`ö_úq
()) \

136 
öå
='h'; \

137 i‡(
	`ö_so·úq
()) \

138 
öå
='s'; \

141 
öå
='.'; \

143 
	`DBGPRINT
( \

147 , 
	`smp_¥o˚ss‹_id
(), \

148 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

149 (
	`úqs_dißbÀd
()?'d':'.'), \

150 (
	`√ed_ªsched
()?'N':'.'), \

151 
öå
, \

152 (
	`¥ìm±_cou¡
() && 0xff) \

154 } 0)

	)

156 
	#PRINT_CTX
() do { \

157 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, \

158 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!current->mm?']':' '), \

162 
cuºít
->
pid
); \

164 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

166 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

167 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

169 } 0)

	)

185 #ifde‡
__KERNEL__


186 
	#as£π
(
ex¥
) do { \

187 i‡(!(
ex¥
)) { \

188 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

189 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

191 } 0)

	)

195 
ölöe
 
	$bìp
(
wh©
)

197 #ifde‡
__KERNEL__


198 
	`DBGPRINT
("%c", ()
wh©
);

200 ()
	`¥ötf
("%c", ()
wh©
);

202 
	}
}

209 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

211 
c
=0, 
m
; \

212 
f‹_ödex
,
ö√r_ödex
; \

214 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

215 
	`bìp
((
vÆ
)); \

216 
c
++; \

217 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

218 
m
=0;m<50;m++); \

221 }

	)

224 #ifde‡
__KERNEL__


229 
	#DELAY_SEC
(
vÆ
) \

231 i‡(!
	`ö_öãºu±
()) { \

232 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

233 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

235 }

	)

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/4_helper_jp_probeit/jp_helper_template.c

23 
	~<löux/kî√l.h
>

24 
	~<löux/moduÀ.h
>

25 
	~<löux/k¥obes.h
>

26 
	~<löux/öãºu±.h
>

27 
	~"c⁄víõ¡.h
"

33 
	#MYNAME
 
xxx


	)

45 <
ªt
 
	gty≥
> 
	$jp_xxx
( )

48 
	`PRINT_CTX
();

58 
	`j¥obe_ªtu∫
();

59  <
somëhög
>;

60 
	}
}

63 
j¥obe
 
	gjps_xxx
 = {

64 .
íåy
 = 
jp_xxx
,

65 .
	gkp
 = {

66 .
symbﬁ_«me
 = "xxx",

70 
__öô
 
	$j¥obe_öô
()

72 
ªt
;

74 
ªt
 = 
	`ªgi°î_j¥obe
(&
jps_xxx
);

75 i‡(
ªt
 < 0) {

76 
	`¥ötk
(
KERN_INFO
 "register_jprobe failed,Ñeturned %d\n"

78 "ölöê‹áâribuã-m¨ked '__k¥obes' ?\n", 
ªt
);

79  
ªt
;

81 
	`¥ötk
(
KERN_INFO
 "%s: J¥obe(sËªgi°îed.\n", 
MYNAME
);

83 
	}
}

85 
__exô
 
	$j¥obe_exô
()

87 
	`uƒegi°î_j¥obe
(&
jps_xxx
);

88 
	`¥ötk
(
KERN_INFO
 "%s: J¥obe(sËuƒegi°îed\n", 
MYNAME
);

89 
	}
}

91 
moduÀ_öô
(
j¥obe_öô
);

92 
moduÀ_exô
(
j¥obe_exô
);

93 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/5_jkret_helper/helper_jkret.c

13 
	~<löux/moduÀ.h
>

14 
	~<löux/kî√l.h
>

15 
	~<löux/öô.h
>

16 
	~<löux/k¥obes.h
>

17 
	~"../c⁄víõ¡.h
"

19 
	#MODULE_VER
 "0.1"

	)

20 
	#MODULE_NAME
 "hñ≥r_jkªt"

	)

22 * 
	gfun˙ame
;

28 
moduÀ_∑øm
(
fun˙ame
, 
ch¨p
, 0);

29 
MODULE_PARM_DESC
(
fun˙ame
,

41 * 
	$h™dÀr_¥e
(
size_t
 
sz
, 
gÂ_t
 
Êags
)

46 
	`PRINT_CTX
();

47 
	`j¥obe_ªtu∫
();

49 
	}
}

51 
j¥obe
 
	gjpb
 = {

52 .
íåy
 = (
k¥obe_›code_t
 *)
h™dÀr_¥e
,

56 
	$ªt_h™dÀr
(
kªçrobe_ö°™˚
 *
kri
, 
±_ªgs
 *
ªgs
)

58 
u32
 
ªtvÆ
 = 
	`ªgs_ªtu∫_vÆue
(
ªgs
);

59 
	`¥_öfo_øãlimôed
("Ñë=0x%x\n", 
ªtvÆ
);

60 i‡(!
ªtvÆ
)

61 
	`¥_w¨n_øãlimôed
(" ***Ñet: FAILURE indicated!!\n");

63 
	}
}

65 
kªçrobe
 
	gkªt
 = {

66 .
h™dÀr
 = 
ªt_h™dÀr
,

67 .
	gmaxa˘ive
 = 20

73 
__öô
 
	$hñ≥r_kp_öô_moduÀ
()

75 
ªt
=0;

83 i‡(!
fun˙ame
) {

84 
	`¥ötk
(
KERN_INFO
 "helper_kp: MustÖass funcname \
á moduleÖarameter\n");

86  -
EINVAL
;

93 
jpb
.
kp
.
symbﬁ_«me
 = 
kªt
.kp.symbﬁ_«mê
fun˙ame
;

96 i‡((
ªt
 = 
	`ªgi°î_j¥obe
(&
jpb
)) < 0) {

97 
	`¥ötk
 ("ªgi°î_j¥obêÁûed,Ñëu∫ed %d\n", 
ªt
);

98  
ªt
;

100 i‡((
ªt
 = 
	`ªgi°î_kªçrobe
 (&
kªt
)) < 0) {

101 
	`¥ötk
 ("ªgi°î_kªçrobêÁûed,Ñëu∫ed %d\n", 
ªt
);

102 
	`uƒegi°î_j¥obe
 (&
jpb
);

103  
ªt
;

105 
	`¥ötk
 (
KERN_INFO
 "helper_kp:Ñegistered jprobe (and kretprobe) for function %s\n"

109 
fun˙ame
);

112 
	}
}

117 
	$hñ≥r_kp_˛ónup_moduÀ
()

119 
	`uƒegi°î_kªçrobe
(&
kªt
);

120 
	`uƒegi°î_j¥obe
(&
jpb
);

121 
	`¥ötk
(
KERN_INFO
 "Uƒegi°îed. %†%†ªmoved\n", 
MODULE_NAME
, 
MODULE_VER
);

122 
	}
}

124 
moduÀ_öô
(
hñ≥r_kp_öô_moduÀ
);

125 
moduÀ_exô
(
hñ≥r_kp_˛ónup_moduÀ
);

127 
MODULE_AUTHOR
("Kaiwan NB <kaiwan@kaiwantech.com>");

128 
MODULE_DESCRIPTION
("Helper Kprobe module;Ñegistersá jprobeánd kretprobeátÅheÖassed function.");

129 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/6_kp_kretp_kmalloc/kp_kretp_kmalloc.c

6 
	~<löux/öô.h
>

7 
	~<löux/moduÀ.h
>

8 
	~<löux/sched.h
>

9 
	~<löux/k¥obes.h
>

10 
	~<löux/¶ab.h
>

11 
	~"../c⁄víõ¡.h
"

13 
MODULE_LICENSE
("Dual MIT/GPL");

15 * 
	$jp_kmÆloc
(
size_t
 
sz
, 
gÂ_t
 
Êags
)

17 
	`PRINT_CTX
();

18 
	`¥_öfo_øãlimôed
(" __kmÆloc(%luË", 
sz
);

19 
	`j¥obe_ªtu∫
();

21 
	}
}

23 
j¥obe
 
	gjpb
 = {

24 .
íåy
 = 
jp_kmÆloc
,

25 .
	gkp
 = {

26 .
symbﬁ_«me
 = "__kmalloc",

31 
	$ªt_h™dÀr
(
kªçrobe_ö°™˚
 *
kri
, 
±_ªgs
 *
ªgs
)

33 
	`¥_öfo_øãlimôed
(" = 0x%lx\n", 
ªgs
->
ax
);

34 i‡(
ªgs
->
ax
 <= 0)

35 
	`¥_w¨n_øãlimôed
(" ***Ñet: FAILURE indicated!!\n");

37 
	}
}

39 
kªçrobe
 
	gkªt
 = {

40 .
h™dÀr
 = 
ªt_h™dÀr
,

41 .
	gmaxa˘ive
 = 20

44 
__öô
 
	$kp_öô
()

46 
ªt
=0;

49 i‡((
ªt
 = 
	`ªgi°î_j¥obe
(&
jpb
)) < 0) {

50 
	`¥ötk
 ("ªgi°î_j¥obêÁûed,Ñëu∫ed %d\n", 
ªt
);

51  
ªt
;

53 
kªt
.
kp
.
symbﬁ_«me
 = "__kmalloc";

54 i‡((
ªt
 = 
	`ªgi°î_kªçrobe
 (&
kªt
)) < 0) {

55 
	`¥ötk
 ("ªgi°î_kªçrobêÁûed,Ñëu∫ed %d\n", 
ªt
);

56 
	`uƒegi°î_j¥obe
 (&
jpb
);

57  
ªt
;

60 
	}
}

62 
__exô
 
	$kp_˛ónup
()

64 
	`uƒegi°î_kªçrobe
(&
kªt
);

65 
	`uƒegi°î_j¥obe
(&
jpb
);

66 
	}
}

68 
moduÀ_öô
(
kp_öô
);

69 
moduÀ_exô
(
kp_˛ónup
);

	@Training/L5_debug_trg/kernel_debug/kprobes_stuff/convenient.h

11 #i‚de‡
__CONVENIENT_H__


12 
	#__CONVENIENT_H__


	)

14 
	~<asm/∑øm.h
>

15 
	~<löux/sched.h
>

17 #ifde‡
__KERNEL__


18 
	~<löux/øãlimô.h
>

44 #unde‡
USE_FTRACE_PRINT


46 #ifde‡
USE_FTRACE_PRINT


47 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

48 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

50 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

51 
USE_RATELIMITING
=1; \

52 i‡(
USE_RATELIMITING
) { \

53 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

56 
	`¥_öfo
(
	`¥_fmt
(
°rög
), ##
¨gs
); \

57 } 0)

	)

61 #ifde‡
DEBUG


62 #ifde‡
__KERNEL__


63 
	#MSG
(
°rög
, 
¨gs
...) do { \

64 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

65 } 0)

	)

67 
	#MSG
(
°rög
, 
¨gs
...) do { \

68 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

69 } 0)

	)

72 #ifde‡
__KERNEL__


73 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

74 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

75 } 0)

	)

77 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

78 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

79 } 0)

	)

83 
	#QP
 
	`MSG
("\n")

	)

85 #ifde‡
__KERNEL__


86 
	#QPDS
 do { \

87 
	`MSG
("\n"); \

88 
	`dump_°ack
(); \

89 } 0)

	)

92 #ifde‡
__KERNEL__


93 
	#HexDump
(
‰om_addr
, 
Àn
) \

94 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

97 
	#MSG
(
°rög
, 
¨gs
...)

	)

98 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

99 
	#QP


	)

100 
	#QPDS


	)

125 
	~<löux/sched.h
>

126 
	~<löux/öãºu±.h
>

128 #i‚de‡
USE_FTRACE_PRINT


129 
	#PRINT_CTX
() do { \

130 
£p
='|', 
öå
='.'; \

132 i‡(
	`ö_öãºu±
()) { \

133 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

134 
öå
='H'; \

135 i‡(
	`ö_úq
()) \

136 
öå
='h'; \

137 i‡(
	`ö_so·úq
()) \

138 
öå
='s'; \

141 
öå
='.'; \

143 
	`DBGPRINT
( \

147 , 
	`smp_¥o˚ss‹_id
(), \

148 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

149 (
	`úqs_dißbÀd
()?'d':'.'), \

150 (
	`√ed_ªsched
()?'N':'.'), \

151 
öå
, \

152 (
	`¥ìm±_cou¡
() && 0xff) \

154 } 0)

	)

156 
	#PRINT_CTX
() do { \

157 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, \

158 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!current->mm?']':' '), \

162 
cuºít
->
pid
); \

164 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

166 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

167 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

169 } 0)

	)

185 #ifde‡
__KERNEL__


186 
	#as£π
(
ex¥
) do { \

187 i‡(!(
ex¥
)) { \

188 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

189 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

191 } 0)

	)

195 
ölöe
 
	$bìp
(
wh©
)

197 #ifde‡
__KERNEL__


198 
	`DBGPRINT
("%c", ()
wh©
);

200 ()
	`¥ötf
("%c", ()
wh©
);

202 
	}
}

209 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

211 
c
=0, 
m
; \

212 
f‹_ödex
,
ö√r_ödex
; \

214 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

215 
	`bìp
((
vÆ
)); \

216 
c
++; \

217 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

218 
m
=0;m<50;m++); \

221 }

	)

224 #ifde‡
__KERNEL__


229 
	#DELAY_SEC
(
vÆ
) \

231 i‡(!
	`ö_öãºu±
()) { \

232 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

233 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

235 }

	)

	@Training/L5_debug_trg/kernel_debug/membugs_kasan/membugs_kasan.c

15 
	~<löux/öô.h
>

16 
	~<löux/moduÀ.h
>

17 
	~<löux/¶ab.h
>

18 
	~<löux/mm.h
>

20 
	#OURMODNAME
 "membugs_kaßn"

	)

22 
MODULE_AUTHOR
("Kaiwan N Billimoria");

23 
MODULE_DESCRIPTION
("membugs_kasan:á few KASANÅest cases");

24 
MODULE_LICENSE
("Dual MIT/GPL");

25 
MODULE_VERSION
("0.1");

27 
	#NUM
 2048

	)

29 
	#FATAL
(
îrmsg
, 
în
) do { \

30 
	`¥_w¨n
("%s: Fatal Error! \"%s\"\n", \

31 
OURMODNAME
, 
îrmsg
); \

32  
în
; \

33 } 0)

	)

35 
	gã°ˇ£
;

36 
moduÀ_∑øm
(
ã°ˇ£
, , 0644);

37 
MODULE_PARM_DESC
(
ã°ˇ£
, " Test caseÅoÑun ::\n\
1 : UMR : uninitialized memoryÑead\n\
2 : OOB - out-of-bounds : write overflow on compile-mem\n\
3 : OOB - out-of-bounds : write overflow on dynamic-mem\n\
4 : OOB - out-of-bounds : write underflow\n\
5 : OOB - out-of-bounds :Ñead overflow on compile-mem\n\
6 : OOB - out-of-bounds :Ñead overflow on dynamic-mem\n\
7 : OOB - out-of-bounds :Ñead underflow\n\
8 : UAF - use-after-free\n\
9 : UAR - use-after-return\n\
10 : double-free \n\
11 : memoryÜeak : simpleÜeak\n\
");

69 
	$Àak_sim∂e
()

71 *
p
 = 
NULL
;

73 
p
 = 
	`kzÆloc
(1520, 
GFP_KERNEL
);

74 i‡(!
p
)

75 
	`FATAL
("ã°ˇ£ #11, kzÆlo¯Áûed!", -
ENOMEM
);

76 
	`¥öt_hex_dump_byãs
("p: ", 
DUMP_PREFIX_OFFSET
, 
p
, 32);

79 
	`k‰ì
(
p
);

82 
	}
}

84 
	$doubÀ_‰ì
()

86 *
p
 = 
NULL
, *
q
 = NULL;

87 
§c
[] = "abcd5678";

89 
p
 = 
	`kzÆloc
(320, 
GFP_KERNEL
);

90 i‡(!
p
)

91 
	`FATAL
("ã°ˇ£ #10, kzÆlo¯1 faûed!", -
ENOMEM
);

93 
	`°∫˝y
(
p
, 
§c
, 
	`°æí
(src));

94 
	`k‰ì
(
p
);

96 
q
 = 
	`kzÆloc
(-1UL, 
GFP_KERNEL
);

98 i‡(!
q
) {

99 
	`k‰ì
(
p
);

100 
	`FATAL
("ã°ˇ£ #10, kzÆlo¯2 faûed!", -
ENOMEM
);

104 
	}
}

106 *
	$u¨
()

108 
«me
[32];

110 *
q
 = 
NULL
;

111 
q
 = 
	`kzÆloc
(32, 
GFP_KERNEL
);

112 
	`°∫˝y
(
q
, "Linux kernel debug", 18);

113  
q
;

115 
	`mem£t
(
«me
, 0, 32);

116 
	`°∫˝y
(
«me
, "Linux kernel debug", 18);

118  
«me
;

119 
	}
}

121 
	$uaf
()

123 *
p
 = 
	`kzÆloc
(32, 
GFP_KERNEL
);

124 
§c
[] = "abcd5678";

125 
qs
 = 1;

127 i‡(!
p
)

128 
	`FATAL
("ã°ˇ£ 8: kzÆlo¯Áûed!", -
ENOMEM
);

129 
	`°∫˝y
(
p
, 
§c
, 
	`°æí
(src));

130 
	`k‰ì
(
p
);

132 i‡(
qs
) {

133 
	`°∫˝y
(
p
, 
§c
, 
	`°æí
(src));

137 
	}
}

139 
	$oob_ªad_undîÊow
(**
p
, 
sz
)

141 
¥_öfo


143 
__func__
);

144 
	`¥_debug
("*∞%p\n", (*)*
p
);

146 
	`¥_öfo
("ªadögáàkv®%p+%+d : 0x%x\n", (*)*
p
, 
sz
, *(*p + sz));

147 
	}
}

149 
	$oob_ªad_ovîÊow_dynmem
(**
p
, 
sz
)

151 
¥_öfo


153 
__func__
);

154 
	`¥_debug
("*∞%p\n", (*)*
p
);

155 
	`¥_öfo
("ªadögáàkv®%p+%+d : 0x%x\n", (*)*
p
, 
sz
, *(*p + sz));

156 
	}
}

158 
	$oob_ªad_ovîÊow_compûemem
()

160 
i
, 
¨r
[5], 
¨r2
[7];

162 
¥_öfo


164 
__func__
);

165 
i
 = 0; i < 5; i++)

166 
¨r
[
i
] = i;

168 
i
 = 0; i <= 10; i++)

169 
	`¥_öfo
("¨r[%d] = %d\n", 
i
, 
¨r
[i]);

170 
	}
}

172 
	$oob_wrôe_undîÊow
(**
p
, 
sz
)

174 
¥_öfo


176 
__func__
);

177 
	`¥_debug
("*∞%p\n", (*)*
p
);

178 
	`mem£t
(*
p
 + 
sz
, 0xab, 32);

179 
	}
}

181 
	$oob_wrôe_ovîÊow_dynmem
(**
p
, 
sz
)

183 
¥_öfo


185 
__func__
);

186 
	`¥_debug
("*∞%p\n", (*)*
p
);

187 
	`mem£t
(*
p
, 0xab, 
NUM
 + 
sz
);

188 
	}
}

191 
	$oob_wrôe_ovîÊow_compûemem
()

193 
i
, 
¨r
[5], 
¨r2
[7];

194 
s_¨r
[5], 
s_¨r2
[10];

196 
¥_öfo


198 
__func__
);

201 
i
 = 0; i <= 5000; i++) {

202 
¨r
[
i
] = 100;

205 
s_¨r
[
i
] = 200;

207 
	}
}

210 
	$umr
()

212 
x
;

216 i‡(
x
)

217 
	`¥_öfo
("%s():Åruêˇ£: x=%d\n", 
__func__
, 
x
);

219 
	`¥_öfo
("%s(): fÆ£ ca£ (x==0)\n", 
__func__
);

220 
	}
}

224 *
	$öô
()

226 *
kp
 = 
NULL
;

228 
kp
 = 
	`kvmÆloc
(
NUM
, 
GFP_KERNEL
);

229 i‡(!
kp
) {

230 
	`¥_w¨n
("%s: kmÆlo¯Áûed!\n", 
OURMODNAME
);

231  
	`ERR_PTR
(-
ENOMEM
);

233 
	`¥_debug
("k∞0x%px\n", 
kp
);

238 
	`¥_öfo
(" k∞%lx; dumpög fú° 32 byã†Bef‹êöô...\n", 
kp
);

239 
	`¥öt_hex_dump_byãs
("kp: ", 
DUMP_PREFIX_OFFSET
, 
kp
, 32);

241 
	`mem£t
(
kp
, 0xdd, 
NUM
);

243 
	`mem£t
(
kp
, 0xdd, 
NUM
 + 4);

245 
	`¥_öfo
(" dumping first 32 bytes After init...\n");

246 
	`¥öt_hex_dump_byãs
("kp: ", 
DUMP_PREFIX_ADDRESS
, 
kp
, 32);

248  
kp
;

249 
	}
}

251 
__öô
 
	$membugs_kaßn_öô
()

253 *
kp
 = 
NULL
, *
ªs
;

255 
	`¥_debug
("%s: in£πed;Åe°ˇ£ = %d\n", 
OURMODNAME
, 
ã°ˇ£
);

256 i‡(
ã°ˇ£
 == 0) {

257 
¥_öfo


259 
OURMODNAME
);

260  -
EINVAL
;

262 
kp
 = 
	`öô
();

264 
ã°ˇ£
) {

266 
	`umr
();

269 
	`oob_wrôe_ovîÊow_compûemem
();

272 
	`oob_wrôe_ovîÊow_dynmem
(&
kp
, 8);

275 
	`oob_wrôe_undîÊow
(&
kp
, -8);

278 
	`oob_ªad_ovîÊow_compûemem
();

281 
	`oob_ªad_ovîÊow_dynmem
(&
kp
, 
NUM
 + 8);

284 
	`oob_ªad_undîÊow
(&
kp
, -
NUM
 - 8);

287 
	`uaf
();

290 
ªs
 = 
	`kmÆloc
(32, 
GFP_KERNEL
);

291 
ªs
 = 
	`u¨
();

292 
	`¥_öfo
("Ñes: %s\n", (*)
ªs
);

293 
	`k‰ì
(
ªs
);

296 
	`doubÀ_‰ì
();

299 
	`Àak_sim∂e
();

302 
	`¥_öfo
("InvalidÅestcase # %dÖassed,áborting...\n",

303 
ã°ˇ£
);

307 
	`k‰ì
(
kp
);

309 
	}
}

311 
__exô
 
	$membugs_kaßn_exô
()

313 
	`¥_debug
("%s:Ñemoved\n", 
OURMODNAME
);

314 
	}
}

316 
moduÀ_öô
(
membugs_kaßn_öô
);

317 
moduÀ_exô
(
membugs_kaßn_exô
);

	@Training/L5_debug_trg/kernel_debug/panic_notifier/convenient.h

12 #i‚de‡
__CONVENIENT_H__


13 
	#__CONVENIENT_H__


	)

15 
	~<asm/∑øm.h
>

16 
	~<löux/sched.h
>

18 #ifde‡
__KERNEL__


19 
	~<löux/øãlimô.h
>

45 #unde‡
USE_FTRACE_PRINT


47 #ifde‡
USE_FTRACE_PRINT


48 
	#DBGPRINT
(
°rög
, 
¨gs
...) \

49 
	`åa˚_¥ötk
(
°rög
, ##
¨gs
);

	)

51 
	#DBGPRINT
(
°rög
, 
¨gs
...) do { \

52 
USE_RATELIMITING
=1; \

54 i‡(
USE_RATELIMITING
) { \

55 
	`¥ötk_øãlimôed
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

58 
	`¥ötk
 (
KERN_INFO
 
	`¥_fmt
(
°rög
), ##
¨gs
); \

59 } 0)

	)

63 #ifde‡
DEBUG


64 #ifde‡
__KERNEL__


65 
	#MSG
(
°rög
, 
¨gs
...) do { \

66 
	`DBGPRINT
("%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

67 } 0)

	)

69 
	#MSG
(
°rög
, 
¨gs
...) do { \

70 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

71 } 0)

	)

74 #ifde‡
__KERNEL__


75 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

76 
	`DBGPRINT
(
°rög
, ##
¨gs
); \

77 } 0)

	)

79 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

80 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

81 } 0)

	)

85 
	#QP
 
	`MSG
("\n")

	)

87 #ifde‡
__KERNEL__


88 
	#QPDS
 do { \

89 
	`MSG
("\n"); \

90 
	`dump_°ack
(); \

91 } 0)

	)

94 #ifde‡
__KERNEL__


95 
	#HexDump
(
‰om_addr
, 
Àn
) \

96 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
‰om_addr
, 
Àn
);

	)

99 
	#MSG
(
°rög
, 
¨gs
...)

	)

100 
	#MSG_SHORT
(
°rög
, 
¨gs
...)

	)

101 
	#QP


	)

102 
	#QPDS


	)

126 
	~<löux/sched.h
>

127 
	~<löux/öãºu±.h
>

129 #i‚de‡
USE_FTRACE_PRINT


130 
	#PRINT_CTX
() do { \

131 
£p
='|', 
öå
='.'; \

133 i‡(
	`ö_öãºu±
()) { \

134 i‡(
	`ö_úq
(Ë&& 
	`ö_so·úq
()) \

135 
öå
='H'; \

136 i‡(
	`ö_úq
()) \

137 
öå
='h'; \

138 i‡(
	`ö_so·úq
()) \

139 
öå
='s'; \

142 
öå
='.'; \

144 
	`DBGPRINT
( \

148 , 
	`smp_¥o˚ss‹_id
(), \

149 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
, 
£p
, \

150 (
	`úqs_dißbÀd
()?'d':'.'), \

151 (
	`√ed_ªsched
()?'N':'.'), \

152 
öå
, \

153 (
	`¥ìm±_cou¡
() && 0xff) \

155 } 0)

	)

157 
	#PRINT_CTX
() do { \

158 
	`DBGPRINT
("PRINT_CTX:: [˝u %02d]%s:%d\n", 
	`smp_¥o˚ss‹_id
(), 
__func__
, 
cuºít
->
pid
); \

159 i‡(!
	`ö_öãºu±
()) { \

160 
	`DBGPRINT
(" inÖrocess context:%c%s%c:%d\n", \

161 (!
cuºít
->
mm
?'[':' '), cuºít->
comm
, (!cuºít->mm?']':' '), cuºít->
pid
); \

163 
	`DBGPRINT
(" in interrupt context: in_interrupt:%3s. in_irq:%3s. in_softirq:%3s. " \

165 (
	`ö_öãºu±
()?"yes":"no"), (
	`ö_úq
()?"yes":"no"), (
	`ö_so·úq
()?"yes":"no"), \

166 (
	`ö_£rvög_so·úq
()?"yes":"no"), (
	`¥ìm±_cou¡
() && 0xff)); \

168 } 0)

	)

184 #ifde‡
__KERNEL__


185 
	#as£π
(
ex¥
) do { \

186 i‡(!(
ex¥
)) { \

187 
	`DBGPRINT
("********** Assertion [%s] failed! : %s:%s:%d **********\n", \

188 #ex¥, 
__FILE__
, 
__func__
, 
__LINE__
); \

190 } 0)

	)

194 
ölöe
 
	$bìp
(
wh©
)

196 #ifde‡
__KERNEL__


197 
	`DBGPRINT
("%c", ()
wh©
);

199 ()
	`¥ötf
("%c", ()
wh©
);

201 
	}
}

208 
	#DELAY_LOOP
(
vÆ
,
lo›_cou¡
) \

210 
c
=0, 
m
;\

211 
f‹_ödex
,
ö√r_ödex
; \

213 
f‹_ödex
=0;f‹_ödex<
lo›_cou¡
;for_index++) { \

214 
	`bìp
((
vÆ
)); \

215 
c
++;\

216 
ö√r_ödex
=0;ö√r_ödex<
HZ
*1000*8;inner_index++) \

217 
m
=0;m<50;m++); \

220 }

	)

223 #ifde‡
__KERNEL__


228 
	#DELAY_SEC
(
vÆ
) \

230 i‡(!
	`ö_öãºu±
()) { \

231 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
); \

232 
	`scheduÀ_timeout
 (
vÆ
 * 
HZ
); \

234 }

	)

241 
timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

242 
timevÆ
 *
y
);

246 
__©åibuã__
 ((
unu£d
))

247 
	$timevÆ_subåa˘
(
timevÆ
 *
ªsu…
, timevÆ *
x
,

248 
timevÆ
 *
y
)

251 i‡(
x
->
tv_u£c
 < 
y
->tv_usec) {

252 
n£c
 = (
y
->
tv_u£c
 - 
x
->tv_usec) / 1000000 + 1;

253 
y
->
tv_u£c
 -1000000 * 
n£c
;

254 
y
->
tv_£c
 +
n£c
;

256 i‡(
x
->
tv_u£c
 - 
y
->tv_usec > 1000000) {

257 
n£c
 = (
x
->
tv_u£c
 - 
y
->tv_usec) / 1000000;

258 
y
->
tv_u£c
 +1000000 * 
n£c
;

259 
y
->
tv_£c
 -
n£c
;

264 
ªsu…
->
tv_£c
 = 
x
->tv_£¯- 
y
->tv_sec;

265 
ªsu…
->
tv_u£c
 = 
x
->tv_u£¯- 
y
->tv_usec;

268  
x
->
tv_£c
 < 
y
->tv_sec;

269 
	}
}

280 
__©åibuã__
 ((
unu£d
))

281 
	$dec2bö
(
decimÆ
, *
bö¨y
)

283 
k
 = 0, 
n
 = 0;

284 
√g_Êag
 = 0;

285 
ªmaö
;

295 #unde‡
TESTMODE


297 #ifde‡
TESTMODE


298 
ﬁd_decimÆ
;

300 
ãmp
[80];

303 i‡(
decimÆ
 < 0) {

304 
decimÆ
 = -decimal;

305 
√g_Êag
 = 1;

308 #ifde‡
TESTMODE


309 
ﬁd_decimÆ
 = 
decimÆ
;

311 
ªmaö
 = 
decimÆ
 % 2;

313 
decimÆ
 = decimal / 2;

315 #ifde‡
TESTMODE


316 
	`¥ötf
("%d/2 = %dÑemaödî = %d\n", 
ﬁd_decimÆ
, 
decimÆ
,

317 
ªmaö
);

320 
ãmp
[
k
++] = 
ªmaö
 + '0';

321 } 
decimÆ
 > 0);

323 i‡(
√g_Êag
)

324 
ãmp
[
k
++] = '-';

326 
ãmp
[
k
++] = ' ';

329 
k
 >= 0)

330 
bö¨y
[
n
++] = 
ãmp
[--
k
];

332 
bö¨y
[
n
 - 1] = 0;

333 
	}
}

335 #i‚de‡
__KERNEL__


337 
	#MSG
(
°rög
, 
¨gs
...) do { \

338 
	`Ârötf
(
°dîr
, "%s:%d : " 
°rög
, 
__FUNCTION__
, 
__LINE__
, ##
¨gs
); \

339 } 0)

	)

341 
	#MSG_SHORT
(
°rög
, 
¨gs
...) do { \

342 
	`Ârötf
(
°dîr
, 
°rög
, ##
¨gs
); \

343 } 0)

	)

345 
	#QP
 
	`MSG
("\n")

	)

348 
	#VP
(
vîbo£
, 
°r
, 
¨gs
...) \

350 i‡(
vîbo£
) \

351 
	`¥ötf
(
°r
, ##
¨gs
); \

352 } 0)

	)

354 
ölöe
 
	$îr_exô
(*
¥g
, *
îr
, 
exôcode
)

356 
îr_°r
[512];

358 
	`¢¥ötf
(
îr_°r
, 511, "%s: %s", 
¥g
, 
îr
);

359 
	`≥º‹
(
îr_°r
);

360 
	`exô
(
exôcode
);

361 
	}
}

	@Training/L5_debug_trg/kernel_debug/panic_notifier/pnc.c

6 
	~<löux/öô.h
>

7 
	~<löux/moduÀ.h
>

9 
	~<löux/vîsi⁄.h
>

10 #i‡
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(5, 14, 0)

11 
	~<löux/∑nic_nŸifõr.h
>

13 
	~<löux/nŸifõr.h
>

16 
MODULE_LICENSE
("Dual MIT/GPL");

19 
	$my_∑nic_nŸifõr_ˇŒ
(
nŸifõr_block
 *
nb
,

20 
code
, *
_∑øm
)

22 
	`¥_emîg
("P™i¯!ALARM! @ %s_%s_%d\n", 
__FILE__
, 
__func__
, 
__LINE__
);

23  
NOTIFY_OK
;

24 
	}
}

26 
nŸifõr_block
 
	gk_∑nic_nŸifõr_block
 = {

27 .
nŸifõr_ˇŒ
 = 
my_∑nic_nŸifõr_ˇŒ
,

28 .
	g√xt
 = 
NULL
,

29 .
	g¥i‹ôy
 = 
INT_MAX


32 
__öô
 
	$≤c_öô
()

35 
	`©omic_nŸifõr_chaö_ªgi°î
(&
∑nic_nŸifõr_li°
, &
k_∑nic_nŸifõr_block
);

36 
	`¥_debug
("RegdÖanicÇotifier.\n");

38 
	}
}

39 
__exô
 
	$≤c_exô
()

42 
	`©omic_nŸifõr_chaö_uƒegi°î
(&
∑nic_nŸifõr_li°
, &
k_∑nic_nŸifõr_block
);

43 
	}
}

45 
moduÀ_öô
(
≤c_öô
);

46 
moduÀ_exô
(
≤c_exô
);

	@Training/L5_debug_trg/kernel_debug/stkovf/stkovf.c

10 
	#¥_fmt
(
fmt
Ë"%s:%s(): " fmt, 
KBUILD_MODNAME
, 
__func__


	)

12 
	~<löux/öô.h
>

13 
	~<löux/moduÀ.h
>

15 
MODULE_LICENSE
("Dual MIT/GPL");

17 
	#TOOBIG
 (8*
PAGE_SIZE
)

	)

18 
	$o›s_ovîÊow
()

20 
loˇlbuf
[
TOOBIG
];

21 
i
;

23 
	`¥_öfo
("P›uœtög sèck/loˇ»buf, sizê%ld byã†now...", 
TOOBIG
);

24 
i
=0; i<
TOOBIG
; i++)

25 
loˇlbuf
[
i
] = 'x';

27 
	}
}

29 
__öô
 
	$°kovf_öô
()

31 
	`¥_öfo
("Hello, stack overflow\n");

32 
	`o›s_ovîÊow
();

35 
	}
}

37 
__exô
 
	$°kovf_exô
()

39 
	`¥_öfo
("Goodbye\n");

40 
	}
}

42 
moduÀ_öô
(
°kovf_öô
);

43 
moduÀ_exô
(
°kovf_exô
);

	@Training/L5_debug_trg/kernel_debug/to_debug_assgn/lab1_simple_oops/oops_lab.c

38 
	~<löux/moduÀ.h
>

39 
	~<löux/kî√l.h
>

40 
	~<löux/sched.h
>

41 
	~<löux/öô.h
>

42 
	~<löux/¶ab.h
>

43 
	~<löux/vmÆloc.h
>

44 
	~<asm/uac˚ss.h
>

46 
	#MODULE_VER
 "1.0"

	)

47 
	#MODULE_NAME
 "o›s_œb"

	)

52 #unde‡
MSG


53 #ifde‡
DEBUG


54 #ifde‡
__KERNEL__


56 
	#MSG
(
°rög
, 
¨gs
...Ë
	`¥ötk
 (
KERN_DEBUG
 "%s:%s : " string, \

57 
__FILE__
, 
__FUNCTION__
, ##
¨gs
)

	)

60 
	#MSG
(
°rög
, 
¨gs
...) \

61 
	`Ârötf
(
°dîr
, "%s:%†: " 
°rög
, 
__FILE__
, 
__FUNCTION__
, ##
¨gs
)

	)

64 
	#MSG
(
fmt
, 
¨gs
...Ë

	)

67 
	#SZ
 
PAGE_SIZE


	)

68 
	#ARBIT_USER
 1024*1024*32

	)

73 
__öô
 
	$o›s_œb1_öô
()

75 * 
kbuf
;

76 
ªt
;

78 
	`¥ötk
(
KERN_INFO
 "Hello, %s ver %s initialized\n",

79 
MODULE_NAME
, 
MODULE_VER
);

81 
	`MSG
 ("Æloˇtög %ld byã†mem‹yÇow..\n", 
SZ
);

82 i‡(!(
kbuf
 = 
	`kmÆloc
 (
SZ
, 
GFP_KERNEL
))) {

83 
	`¥ötk
 (
KERN_DEBUG
 "%s: ouào‡mem‹y.\n", 
MODULE_NAME
);

84  -
ENOMEM
;

86 
	`mem£t
 (
kbuf
, 0x´, 
SZ
);

88 
ªt
 = 
	`c›y_to_u£r
 (
ARBIT_USER
, 
kbuf
, 
SZ
);

89 i‡(
ªt
) {

90 
	`¥ötk
 (
KERN_DEBUG
 "%s: c›y_to_u£∏Áûuª\n", 
MODULE_NAME
);

91 
	`k‰ì
 (
kbuf
);

92  -
EFAULT
;

95 
	`v‰ì
 (
kbuf
);

96 
	`MSG
 ("%ld byã†‰ìd up..\n", 
SZ
);

102 
kbuf
=0;

103 *
kbuf
 = 0xae;

109 
	}
}

115 
	$o›s_œb1_˛ónup
()

117 
	`¥ötk
(
KERN_INFO
 "Goodbye, %s ver %sÑemoved\n",

118 
MODULE_NAME
, 
MODULE_VER
);

119 
	}
}

121 
moduÀ_öô
(
o›s_œb1_öô
);

122 
moduÀ_exô
(
o›s_œb1_˛ónup
);

124 
MODULE_AUTHOR
("My Name");

125 
MODULE_DESCRIPTION
("A simple buggy kernel module demo");

126 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/to_debug_assgn/lab2_oops_hang_panic/hang_panic.c

14 
	~<löux/moduÀ.h
>

15 
	~<löux/kî√l.h
>

16 
	~<löux/öô.h
>

17 
	~<löux/sched.h
>

18 
	~<löux/timî.h
>

19 
	~<löux/dñay.h
>

20 
	~<löux/öãºu±.h
>

22 
	#MODULE_VER
 "1.0"

	)

23 
	#MODULE_NAME
 "h™g_∑nic"

	)

25 
	$dög
(
timî_li°
 *
timî
)

27 
	`¥_öfo
("%s: I¿timeouàfun˘i⁄ \"dög\"Çow...\n", 
MODULE_NAME
);

35 
	}
}

37 
	$åy_timeout
()

39 
timî_li°
 
timî
;

41 
	`¥_öfo
("InÅry_timeout()\n\
 %dÑunning onÖrocessor # %d\n",

43 
cuºít
->
pid
, 
	`smp_¥o˚ss‹_id
());

46 
	`¥_öfo
("%†£âög u∞timî (1sËnow..\n", 
MODULE_NAME
);

47 
timî
.
expúes
 = 
jiffõs
+
HZ
;

48 
timî
.
fun˘i⁄
 = 
dög
;

49 
timî
.
Êags
 = 0;

50 
	`timî_£tup
(&
timî
, 
dög
, 0);

52 
	`add_timî
(&
timî
);

53 
	}
}

58 
__öô
 
	$h™g_∑nic_öô_moduÀ
()

61 
	`¥_öfo
("%†dñayög f‹ 1†now..\n", 
MODULE_NAME
);

62 
	`£t_cuºít_°©e
 (
TASK_INTERRUPTIBLE
);

63 i‡(
	`scheduÀ_timeout
 (
HZ
)) {

64 
	`¥ötk
 (
KERN_INFO


66 
MODULE_NAME
);

67  -
ERESTARTSYS
;

70 
	`¥_öfo
("%s %s initialized\n",

71 
MODULE_NAME
, 
MODULE_VER
);

73 
	`åy_timeout
();

75 
	}
}

80 
	$h™g_∑nic_˛ónup_moduÀ
()

83 
	`¥_öfo
("%†%†ªmoved\n", 
MODULE_NAME
, 
MODULE_VER
);

84 
	}
}

86 
moduÀ_öô
(
h™g_∑nic_öô_moduÀ
);

87 
moduÀ_exô
(
h™g_∑nic_˛ónup_moduÀ
);

89 
MODULE_AUTHOR
("Kaiwan NB");

90 
MODULE_DESCRIPTION
("A simple module demo -á subtle bug whereáÅimer is set up.");

91 
MODULE_LICENSE
("Dual MIT/GPL");

	@Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/netdriver/buggy_veth_netdrv.c

48 
	~"vëh_comm⁄.h
"

50 
p°V√tI¡fCtx
 
	ggp°Ctx
=
NULL
;

51 
v√t_rx
(, 
sk_buff
 *);

69 
	gtx_pkt_cou¡
=0, 
	grx_pkt_cou¡
=0;

70 
	$v√t_°¨t_xmô
 (
sk_buff
 *
skb
, 
√t_devi˚
 *
dev
)

72 
ùhdr
 *
ù
;

73 
udphdr
 *
udph
;

74 
p°V√tI¡fCtx
 
p°Ctx
 = 
	`√tdev_¥iv
 (
dev
);

76 
timevÆ
 
ts1
, 
ts2
, 
tdiff
;

78 i‡(!
skb
) {

79 
	`¥ötk
 (
KERN_ALERT
 "%s:%s: skb NULL!\n", 
DRVNAME
, 
__func__
);

80  -
EAGAIN
;

96 
	`•ö_lock
(&
p°Ctx
->
lock
);

97 
	`do_gëtimeofday
(&
ts1
);

102 
ù
 = 
	`ù_hdr
(
skb
);

103 
	`MSG
("¥Ÿo: 0x%x: ", 
ù
->
¥Ÿocﬁ
);

104 i‡(
ù
->
¥Ÿocﬁ
 != 0x11) {

105 
	`MSG
("not UDP,disregardingÖkt..\n");

107 
out_tx
;

114 
udph
 = 
	`udp_hdr
(
skb
);

115 i‡(
	`¡ohs
(
udph
->
de°
) != 0xd417) {

116 
	`MSG
("otherÖort, disregardingÖkt..\n");

118 
out_tx
;

122 
	`¥ötk
("ah,á UDPÖacket with destÖort 54295!\n");

125 
	`MSG
("dataÖayload:\n");

126 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_OFFSET
, 
skb
->
hód
+16+20+8, skb->
èû
 - skb->
d©a
);

129 
	`•ö_lock
(&
p°Ctx
->
lock
);

130 
	`do_gëtimeofday
(&
ts1
);

133 
p°Ctx
->
txpkäum
 = ++
tx_pkt_cou¡
;

134 
p°Ctx
->
tx_byãs
 +
skb
->
Àn
;

137 
	`do_gëtimeofday
(&
ts2
);

138 
	`•ö_u∆ock
(&
p°Ctx
->
lock
);

140 i‡(1 =
	`timevÆ_subåa˘
 (&
tdiff
, &
ts2
, &
ts1
))

141 
	`MSG
("Warning:Åimeval_subtractÑeturned -ve!\n");

143 
	`MSG
("•öÜock hﬁdÅime: %ld†%ldus\n", 
tdiff
.
tv_£c
,Ådiff.
tv_u£c
);

145 
	`MSG
("Emulating Rx byártificially invoking vnet_rx()Çow...\n");

146 
	`v√t_rx
(()
dev
, 
skb
);

147 
out_tx
:

148 
	`dev_k‰ì_skb
 (
skb
);

150 
	}
}

152 
	#TMOUT_SEC
 5

153 

	)

167 
u16
 
	$ù_checksum
(
u16
 *
±r
, 
Àngth
)

169 
sum
 = 0;

170 
u16
 
™swî
 = 0;

171 
u16
 *
w
 = 
±r
;

172 
∆e·
 = 
Àngth
;

174 
∆e·
 > 1){

175 
sum
 +*
w
++;

176 
∆e·
 -= 2;

179 
sum
 = (sum >> 16) + (sum & 0xFFFF);

180 
sum
 += (sum >> 16);

181 
™swî
 = ~
sum
;

182 (
™swî
);

183 
	}
}

185 
u8
 
	gvëh_MAC_addr
[6] = {0x48, 0x0F, 0x0E, 0x0D, 0x0A, 0x02};

192 
	mDATA_XFORM_ECHO
 = 0,

193 
	mDATA_XFORM_REVERSE
,

194 
	mDATA_XFORM_ENCODE
,

195 
	mDATA_XFORM_METAPKTINFO
,

196 } 
	ge_d©a_xf‹m
;

199 
ölöe
 
	$xf‹m_d©a
(*
gí±r
, 
d©a_xf‹m
,

200 *
tx_d©a
, 
tx_d©Æí
, 
sk_buff
 *
tx_skb
)

202 
i
, 
d©aoff
=
ETH_HLEN
+(
ùhdr
)+(
udphdr
);

204 
d©a_xf‹m
) {

205 
DATA_XFORM_ECHO
:

206 
	`mem˝y
 (
gí±r
+
d©aoff
, 
tx_d©a
, 
tx_d©Æí
);

208 
DATA_XFORM_REVERSE
:

209 
i
=0; i<
tx_d©Æí
; i++)

210 *(
u8
 *)(
gí±r
+
d©aoff
+
i
Ë
tx_d©a
[
tx_d©Æí
-i-1];

212 
DATA_XFORM_ENCODE
:

213 
i
=0; i<
tx_d©Æí
; i++)

214 *(
u8
 *)(
gí±r
+
d©aoff
+
i
Ë
tx_d©a
[i]+1;

218 
DATA_XFORM_METAPKTINFO
:

219 
	`MSG
 ("s->d©a:%xÜí %u \n", (
u32
)
tx_skb
->
d©a
, 
tx_d©Æí
);

220 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_OFFSET
, 
tx_skb
->
d©a
, 
tx_d©Æí
);

222 
i
=0; i<
tx_d©Æí
; i++)

223 *(
u8
 *)(
gí±r
+
d©aoff
+
i
Ë
tx_skb
->
d©a
[i];

226 : 
	`MSG
("Whoops! default case? FallbackÅo 'ECHO' xform..\n");

227 
	`mem˝y
 (
gí±r
+
d©aoff
, 
tx_d©a
, 
tx_d©Æí
);

232 
	}
}

235 
ölöe
 
	$p›uœã_d©a
(*
gí±r
, 
sk_buff
 *
tx_skb
, 
tx_d©Æí
)

237 *
tx_d©a
=0;

238 
√t_devi˚
 *
dev
 = 
tx_skb
->dev;

239 
p°V√tI¡fCtx
 
p°Ctx
 = 
	`√tdev_¥iv
 (
dev
);

242 
tx_d©a
 = 
	`skb_å™•‹t_hódî
(
tx_skb
)+(
udphdr
);

243 
	`MSG
("data_xform=%dÅx_data=0x%08x datalen=%d\n",

244 
xf‹m_d©a_‚
, (
u32
)
tx_d©a
, 
tx_d©Æí
);

246 
p°Ctx
->
d©a_xf‹m
=
xf‹m_d©a_‚
;

247 
	`xf‹m_d©a
(
gí±r
, 
p°Ctx
->
d©a_xf‹m
, 
tx_d©a
, 
tx_d©Æí
, 
tx_skb
);

248 
	}
}

279 
	$buûd_∑ckë
(
u8
 *
rx_pkt
, 
sk_buff
 *
tx_skb
)

281 
i
, 
j
;

282 
u8
 
§c_hwaddr
[6] = {0x00, 0x82, 0x56, 0xc0, 0x00, 0x39};

283 
ùoff
=
ETH_HLEN
,

284 
udpoff
=
ETH_HLEN
+(
ùhdr
),

285 
d©aoff
=
ETH_HLEN
+(
ùhdr
)+(
udphdr
);

286 *
gí±r
 = 
rx_pkt
;

287 
u16
 
csum
=0;

289 *
tx_d©a
 = 
	`skb_å™•‹t_hódî
(
tx_skb
)+(
udphdr
);

290 
tx_d©Æí
;

292 i‡(
xf‹m_d©a_‚
 !
DATA_XFORM_METAPKTINFO
)

293 
tx_d©Æí
 = 
tx_skb
->
èû
-
tx_d©a
;

295 
tx_d©Æí
 = 
tx_skb
->
èû
-tx_skb->
d©a
;

299 
i
=0; i<
ETH_ALEN
; i++)

300 
rx_pkt
[
i
] = 
vëh_MAC_addr
[i];

302 
i
=
ETH_ALEN
, 
j
=0; j<ETH_ALEN; i++, j++)

303 
rx_pkt
[
i
] = 
§c_hwaddr
[
j
];

305 *(
u16
 *)(
gí±r
+
ETH_HLEN
-2Ë
	`˝u_to_be16
(0x0800);

308 *(
u16
 *)(
gí±r
+
ùoff
+0Ë
	`˝u_to_be16
(0x4500);

311 *(
u16
 *)(
gí±r
+
ùoff
+2Ë
	`˝u_to_be16
((
ùhdr
)+(
udphdr
Ë+ 
tx_d©Æí
);

313 *(
u32
 *)(
gí±r
+
ùoff
+4) = 0x4000;

315 *(
u8
 *Ë(
gí±r
+
ùoff
+8) = 0x40;

316 *(
u8
 *Ë(
gí±r
+
ùoff
+9) = 0x11;

317 *(
u16
 *)(
gí±r
+
ùoff
+10) = 0x0;

318 *(
u32
 *)(
gí±r
+
ùoff
+12Ë
	`˝u_to_be32
(0x0a0a0135);

319 *(
u32
 *)(
gí±r
+
ùoff
+16Ë
	`˝u_to_be32
(0x0a0a0105);

322 
csum
 = 
	`ù_checksum
(
gí±r
+
ùoff
, (
ùhdr
));

324 *(
u16
 *)(
gí±r
+
ùoff
+10Ë
csum
;

327 *(
u16
 *)(
gí±r
+
udpoff
+0Ë
	`˝u_to_be16
(0xd417);

328 *(
u16
 *)(
gí±r
+
udpoff
+2Ë
	`˝u_to_be16
(0xd417);

329 *(
u16
 *)(
gí±r
+
udpoff
+4Ë
	`˝u_to_be16
((
udphdr
)+
tx_d©Æí
);

331 *(
u16
 *)(
gí±r
+
udpoff
+6Ë
	`˝u_to_be16
(0x2421);

334 
	`p›uœã_d©a
(
gí±r
, 
tx_skb
, 
tx_d©Æí
);

335 
	`wmb
();

337 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_OFFSET
, 
rx_pkt
,

338 
ETH_HLEN
+(
ùhdr
)+(
udphdr
)+
tx_d©Æí
);

340  (
d©aoff
+
tx_d©Æí
);

341 
	}
}

351 
	$v√t_rx
(
d©a
, 
sk_buff
 *
tx_skb
)

353 
√t_devi˚
 *
dev
 = (√t_devi˚ *)
d©a
;

354 
p°V√tI¡fCtx
 
p°Ctx
 = 
	`√tdev_¥iv
 (
dev
);

355 
u8
 *
rx_pkt
=
NULL
;

356 
sk_buff
 *
skb
=
NULL
;

357 
Àn
=
MAXPKTSZ
;

359 
QP
;

360 
	`•ö_lock
(&
p°Ctx
->
lock
);

364 
rx_pkt
 = 
	`kzÆloc
(
MAXPKTSZ
, 
GFP_KERNEL
);

365 i‡(!
rx_pkt
) {

366 
	`¥ötk
(
KERN_ALERT
 "%s: kmÆlo¯Áûuª!\n", 
DRVNAME
);

367 
	`•ö_u∆ock
(&
p°Ctx
->
lock
);

371 
Àn
 = 
	`buûd_∑ckë
(
rx_pkt
, 
tx_skb
);

372 
	`MSG
("Àn=%u\n",
Àn
);

375 
skb
 = 
	`√tdev_Æloc_skb
(
dev
, 
Àn
);

376 i‡(!
skb
) {

377 
	`¥ötk
 (
KERN_ALERT
 "%s:%s: ouào‡mem‹y\n", 
DRVNAME
, 
__func__
);

378 
	`k‰ì
(
rx_pkt
);

379 
	`•ö_u∆ock
(&
p°Ctx
->
lock
);

383 
	`mem˝y
(
skb
->
d©a
, 
rx_pkt
, 
Àn
);

384 
	`k‰ì
(
rx_pkt
);

386 
	`skb_push
(
skb
, 
Àn
);

388 
	`skb_£t_√tw‹k_hódî
(
skb
, 
ETH_HLEN
);

389 
	`skb_£t_å™•‹t_hódî
(
skb
, 
ETH_HLEN
+(
ùhdr
));

390 
skb
->
dev
 = dev;

391 
skb
->
¥Ÿocﬁ
 = 
	`ëh_ty≥_å™s
 (skb, 
dev
);

392 
skb
->
ù_summed
 = 
CHECKSUM_UNNECESSARY
;

397 
	`√tif_rx
 (
skb
);

399 
p°Ctx
->
rxpkäum
 = ++
rx_pkt_cou¡
;

400 
p°Ctx
->
rx_byãs
 +
skb
->
Àn
;

402 
	`•ö_u∆ock
(&
p°Ctx
->
lock
);

404 
	}
}

406 
	$v√t_›í
 (
√t_devi˚
 *
dev
)

408 
QP
;

410 
	`√tif_ˇºõr_⁄
 (
dev
);

411 
	`√tif_°¨t_queue
 (
dev
);

413 
	}
}

414 
	$v√t_°›
 (
√t_devi˚
 *
dev
)

417 
QP
;

419 
	`√tif_°›_queue
 (
dev
);

420 
	`√tif_ˇºõr_off
 (
dev
);

422 
	}
}

425 
√t_devi˚_°©s
 
	gnd°©s
;

426 
√t_devi˚_°©s
* 
	$v√t_gë_°©s
(
√t_devi˚
 *
dev
)

428 
p°V√tI¡fCtx
 
p°Ctx
 = 
	`√tdev_¥iv
 (
dev
);

430 
	`•ö_lock
(&
p°Ctx
->
lock
);

431 
nd°©s
.
rx_∑ckës
 = 
p°Ctx
->
rxpkäum
;

432 
nd°©s
.
rx_byãs
 = 
p°Ctx
->rx_bytes;

433 
nd°©s
.
tx_∑ckës
 = 
p°Ctx
->
txpkäum
;

434 
nd°©s
.
tx_byãs
 = 
p°Ctx
->tx_bytes;

435 
	`•ö_u∆ock
(&
p°Ctx
->
lock
);

437  (&
nd°©s
);

438 
	}
}

440 
	$v√t_tx_timeout
(
√t_devi˚
 *
dev
)

442 
	`MSG
("!! TxÅimed out !!\n");

443 
	}
}

445 c⁄° 
√t_devi˚_›s
 
	gv√t_√tdev_›s
 = {

446 .
ndo_›í
 = 
v√t_›í
,

447 .
	gndo_°›
 = 
v√t_°›
,

448 .
	gndo_gë_°©s
 = 
v√t_gë_°©s
,

450 .
	gndo_°¨t_xmô
 = 
v√t_°¨t_xmô
,

451 .
	gndo_tx_timeout
 = 
v√t_tx_timeout
,

458 
	$v√t_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

460 
√t_devi˚
 *
dev
=
NULL
;

461 
ªs
=0;

463 
QP
;

464 
dev
 = 
	`Æloc_ëhîdev
 ( (
°V√tI¡fCtx
));

465 i‡(!
dev
) {

466 
	`¥ötk
 (
KERN_ALERT
 "%s:áŒoc_ëhîdev faûed!\n", 
DRVNAME
);

467  -
ENOMEM
;

470 
	`SET_NETDEV_DEV
(
dev
, &
pdev
->dev);

477 
	`ëhî_£tup
 (
dev
);

478 
	`°r˝y
 (
dev
->
«me
, 
INTF_NAME
);

479 
	`mem˝y
 (
dev
->
dev_addr
, 
vëh_MAC_addr
,  (veth_MAC_addr));

482 
MAC
 
addr
..

483 
ndo
 
mëhods
:

484 
›í


485 
xmô


486 
°›


487 
gë_°©s


488 
do_io˘l
 ?

490 
iomem
 
addr


491 
úq


494 i‡(!
	`is_vÆid_ëhî_addr
 (
dev
->
dev_addr
)) {

495 
	`MSG
("%s: InvalidÉthernet MACáddress. Please set using ifconfig\n",

496 
dev
->
«me
);

500 
dev
->
Êags
 |
IFF_NOARP
;

503 
dev
->
w©chdog_timeo
 = 8*
HZ
;

504 
	`•ö_lock_öô
(&
gp°Ctx
->
lock
);

507 
dev
->
√tdev_›s
 = &
v√t_√tdev_›s
;

509 i‡((
ªs
 = 
	`ªgi°î_√tdev
 (
dev
))) {

510 
	`¥ötk
 (
KERN_ALERT
 "%s: faûedÅÿªgi°îÇë devi˚!\n", 
DRVNAME
);

511 
out_ªg√tdev_Áû
;

513 
gp°Ctx
->
√tdev
 = 
dev
;

515 
	`√tif_°›_queue
 (
dev
);

516 
	`√tif_ˇºõr_off
 (
dev
);

519 
out_ªg√tdev_Áû
:

520 
	`‰ì_√tdev
 (
dev
);

521  
ªs
;

522 
	}
}

523 
	$v√t_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

525 
√t_devi˚
 *
dev
=
gp°Ctx
->
√tdev
;

527 
QP
;

528 
	`√tif_ˇºõr_off
 (
dev
);

529 
	`√tif_°›_queue
 (
dev
);

530 
	`uƒegi°î_√tdev
 (
dev
);

531 
	`‰ì_√tdev
 (
dev
);

533 
	}
}

542 
∂©f‹m_devi˚
 
	gvëh0
 = {

543 .
«me
 = 
DRVNAME
,

544 .
	gid
 = 0,

546 
∂©f‹m_devi˚
 * 
	gvëh_∂©f‹m_devi˚s
[] 
	g__öôd©a
 = {

547 &
vëh0
,

549 
∂©f‹m_drivî
 
	gvúäë
 = {

550 .
¥obe
 = 
v√t_¥obe
,

551 .
	gªmove
 = 
v√t_ªmove
,

552 .
	gdrivî
 = {

553 .
«me
 = 
DRVNAME
,

554 .
	gow√r
 = 
THIS_MODULE
,

559 
díåy
 * 
£tup_debugfs_íåõs
();

560 
díåy
 *
	gdbgfs_∑ª¡
;

562 
__öô
 
	$v√t_öô
()

564 
ªs
=0;

565 
	`MSG
 ("%s: InôülizögÇëw‹k drivî...\n", 
DRVNAME
);

567 
gp°Ctx
 = 
	`kzÆloc
 ( (
°V√tI¡fCtx
), 
GFP_KERNEL
);

568 i‡(!
gp°Ctx
) {

569 
	`¥ötk
 (
KERN_ALERT
 "%s:%†kzÆlo¯Áûed!\n", 
DRVNAME
, 
__func__
);

570  -
ENOMEM
;

573 i‡((
ªs
 = 
	`∂©f‹m_add_devi˚s
(
vëh_∂©f‹m_devi˚s
, 
	`ARRAY_SIZE
(veth_platform_devices)))) {

574 
	`¥ötk
(
KERN_ALERT
 "%s:Öœtf‹m_add_devi˚†Áûed!\n", 
DRVNAME
);

575 
out_Áû_∑d
;

578 
ªs
 = 
	`∂©f‹m_drivî_ªgi°î
 (&
vúäë
);

579 i‡(
ªs
) {

580 
	`¥ötk
(
KERN_ALERT
 "%s:Öœtf‹m_drivî_ªgi°î faûed!\n", 
DRVNAME
);

581 
out_Áû_pdr
;

586 
dbgfs_∑ª¡
 = 
	`£tup_debugfs_íåõs
();

587 i‡(!
dbgfs_∑ª¡
) {

588 
	`¥ötk
(
KERN_ALERT
 "%s: debugf†£tu∞Áûed!\n", 
DRVNAME
);

589 
ªs
 = 
	`PTR_ERR
(
dbgfs_∑ª¡
);

590 
out_Áû_dbgfs
;

593 
	`¥ötk
(
KERN_INFO
 "%s:Üﬂded.\n", 
DRVNAME
);

594  
ªs
;

596 
out_Áû_dbgfs
:

597 
	`∂©f‹m_drivî_uƒegi°î
 (&
vúäë
);

598 
out_Áû_pdr
:

599 
	`∂©f‹m_devi˚_uƒegi°î
 (&
vëh0
);

600 
out_Áû_∑d
:

601 
	`k‰ì
 (
gp°Ctx
);

602  
ªs
;

603 
	}
}

604 
__exô
 
	$v√t_exô
()

606 
	`debugfs_ªmove_ªcursive
(
dbgfs_∑ª¡
);

607 
	`∂©f‹m_drivî_uƒegi°î
 (&
vúäë
);

608 
	`∂©f‹m_devi˚_uƒegi°î
 (&
vëh0
);

609 
	`k‰ì
 (
gp°Ctx
);

610 
	`¥ötk
(
KERN_INFO
 "%s: u∆ﬂded.\n", 
DRVNAME
);

611 
	}
}

613 
moduÀ_öô
(
v√t_öô
);

614 
moduÀ_exô
(
v√t_exô
);

616 
MODULE_DESCRIPTION
("Simple demo virtualÉthernet (NIC) driver; dynamically generatesán RxÖacket \
 oná 'transform' debugfs variable's value.");

618 
MODULE_AUTHOR
("Kaiwan NB <kaiwan@designergraphix.com>");

619 
MODULE_LICENSE
("GPL");

	@Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/netdriver/debugfs_veth.c

10 
	~"vëh_comm⁄.h
"

12 
	#DBGFS_CREATE_ERR
(
pDíåy
, 
°r
) do { \

13 
	`¥ötk
("%s: faûed.\n", 
°r
); \

14 i‡(
	`PTR_ERR
(
pDíåy
Ë=-
ENODEV
) \

15 
	`¥ötk
(" debugfs supportÇotávailable?\n"); \

16 
	`debugfs_ªmove_ªcursive
(
pDíåy
); \

17  (
pDíåy
); \

18 } 0)

	)

20 
u32
 
	gxf‹m_d©a_‚
=0;

21 
díåy
 *
	g∑ª¡
=
NULL
;

23 
díåy
 * 
	$£tup_debugfs_íåõs
()

25 
QP
;

26 
∑ª¡
 = 
	`debugfs_¸óã_dú
(
DRVNAME
, 
NULL
);

27 i‡(!
∑ª¡
) {

28 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_dir");

31 i‡(!
	`debugfs_¸óã_u32
("xf‹m_d©a_func", 0644, 
∑ª¡
, &
xf‹m_d©a_‚
)) {

32 
	`DBGFS_CREATE_ERR
(
∑ª¡
, "debugfs_create_u32 ");

35  
∑ª¡
;

36 
	}
}

	@Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/netdriver/veth_common.h

8 #i‚de‡
__VETH_COMMON_H__


9 
	#__VETH_COMMON_H__


	)

11 
	~<löux/öô.h
>

12 
	~<löux/moduÀ.h
>

13 
	~<löux/sched.h
>

14 
	~<löux/fs.h
>

15 
	~<löux/¶ab.h
>

16 
	~<löux/timî.h
>

18 
	~<löux/√tdevi˚.h
>

19 
	~<löux/ëhîdevi˚.h
>

20 
	~<löux/∂©f‹m_devi˚.h
>

21 
	~<löux/skbuff.h
>

22 
	~<löux/ëhtoﬁ.h
>

23 
	~<löux/ù.h
>

24 
	~<löux/udp.h
>

25 
	~<löux/debugfs.h
>

27 
	~"../c⁄víõ¡.h
"

29 
	#DRVNAME
 "v√t"

	)

30 
	#INTF_NAME
 "veth3"

32 

	)

33 
	#DUMP_PKTS
 0

	)

34 
	#Pröt_hex_dump_byãs
(
¥efix_°r
, 
¥efix
, 
d©≠å
, 
Àn
) do { \

35 i‡(
DUMP_PKTS
) \

36 
	`¥öt_hex_dump_byãs
 (
¥efix_°r
, 
¥efix
, 
d©≠å
, 
Àn
); \

37 } 0)

	)

39 
	#MAXPKTSZ
 1500

	)

47 
	#SKB_PEEK
(
skb
) do { \

48 
	`PRINT_CTX
(); \

49 
	`MSG_SHORT
("////////////////////////// SKB_PEEK (Ctx: <-- %s. Intr? %c. Prcs: %s(%d))\n" \

55 
__FUNCTION__
, (
	`ö_öãºu±
()?'y':'n'), 
cuºít
->
comm
, cuºít->
pid
, \

56 ()
skb
, \

57 
skb
->
Àn
, skb->
åuesize
, 
	`©omic_ªad
(&skb->
u£rs
), \

58 ()
skb
->
mac_hódî
, ()skb->
√tw‹k_hódî
, ()skb->
å™•‹t_hódî
, \

59 ()
skb
->
hód
, ()skb->
íd
, skb->end - skb->head, \

60 ()
skb
->
d©a
, ()skb->
èû
, skb->tail - skb->data \

62 
	`¥öt_hex_dump_byãs
 (" ", 
DUMP_PREFIX_ADDRESS
, 
skb
->
hód
, (skb->
íd
 - skb->head)); \

63 
	`MSG_SHORT
("////////////////////////\n"); \

64 } 0)

	)

67 
	sVútNëI¡fCtx
 {

68 
√t_devi˚
 *
	m√tdev
;

69 
	mtxpkäum
, 
	mrxpkäum
;

70 
	mtx_byãs
, 
	mrx_byãs
;

71 
	md©a_xf‹m
;

72 
•ölock_t
 
	mlock
;

73 } 
	t°V√tI¡fCtx
, *
	tp°V√tI¡fCtx
;

75 
u32
 
xf‹m_d©a_‚
;

	@Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/userspc/listener_dgram.c

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<uni°d.h
>

8 
	~<î∫o.h
>

9 
	~<°rög.h
>

10 
	~<sys/ty≥s.h
>

11 
	~<sys/sockë.h
>

12 
	~<√töë/ö.h
>

13 
	~<¨∑/öë.h
>

15 
	#MYPORT
 54295

16 
	#MAXBUFLEN
 1024

	)

19 
	$hexdump
(*
§cbuf
, 
Àn
)

21 
i
;

23 
i
=0; i<
Àn
; i++) {

24 
	`¥ötf
("%02x ", 
§cbuf
[
i
]);

26 
	`¥ötf
("\n");

27 
	}
}

30 
	$maö
(
¨gc
, **
¨gv
)

32 
sockfd
;

33 
sockaddr_ö
 
my_addr
;

34 
sockaddr_ö
 
theú_addr
;

35 
numbyãs
;

36 
sockÀn_t
 
addr_Àn
;

37 
buf
[
MAXBUFLEN
];

40 if–
¨gc
 == 1 ) {

41 
	`Ârötf
(
°dîr
,"Ußge: %†öãrÁ˚-to-böd-to\n",
¨gv
[0]);

42 
	`exô
( 1 );

46 if–(
sockfd
 = 
	`sockë
(
AF_INET
, 
SOCK_DGRAM
, 0)) == -1 ) {

47 
	`≥º‹
("socket");

48 
	`exô
(1);

52 i‡(
	`£tsock›t
 (
sockfd
, 
SOL_SOCKET
, 
SO_BINDTODEVICE
, 
¨gv
[1], 
	`°æí
(argv[1])+1) < 0) {

53 
	`¥ötf
("\n%s:£tsock›àÁûed...\n",
¨gv
[0]);

54 
	`˛o£
(
sockfd
);

55 
	`exô
(1);

57 
	`¥ötf
 ("%s: suc˚ssfuŒy boundÅÿöãrÁ˚ '%s'\n", 
¨gv
[0],árgv[1]);

60 
my_addr
.
sö_Ámûy
 = 
AF_INET
;

61 
my_addr
.
sö_p‹t
 = 
	`ht⁄s
(
MYPORT
);

63 
my_addr
.
sö_addr
.
s_addr
 = 
INADDR_ANY
;

64 
	`mem£t
(&(
my_addr
.
sö_zîo
), '\0', 8);

65 i‡(
	`böd
(
sockfd
, (
sockaddr
 *)&
my_addr
,

66 (
sockaddr
)) == -1) {

67 
	`≥º‹
("bind");

68 
	`exô
(1);

70 
addr_Àn
 = (
sockaddr
);

71 
	`¥ötf
("%s: blockög o¿ªcv‰om...\n", 
¨gv
[0]);

72 i‡((
numbyãs
 = 
	`ªcv‰om
(
sockfd
, 
buf
, 
MAXBUFLEN
-1, 0,

73 (
sockaddr
 *)&
theú_addr
,

74 &
addr_Àn
)) == -1) {

75 
	`≥º‹
("recvfrom");

76 
	`exô
(1);

78 
	`¥ötf
("gŸÖackë from %s\n", 
	`öë_¡ﬂ
(
theú_addr
.
sö_addr
));

79 
	`¥ötf
("∑ckë i†%d byã†l⁄g\n", 
numbyãs
);

80 i‡(
numbyãs
 == 58) {

83 
	`¥ötf
("42+16=58; we knowÅhenÅhat forÅhisápp/drv, \n\
'sÅhe \"meta-data\" functionality, whereÅheÇet driver gives usÅhe \n\
Öacket content, i.e., skb->data forÖktÜen bytes.\n\
\n\
ás:\n\
\n\
: 14 20 8 x \n\
+------------------------------------------------------------------+\n\
| Eth II Hdr | IPv4 Hdr | UDP Hdr | Data |\n\
+------------------------------------------------------------------+\n\
^ ^\n\
| |\n\
-> dataÅail\n\
\n\
");

98 
	`hexdump
(
buf
, 
numbyãs
);

100 
buf
[
numbyãs
] = '\0';

101 
	`¥ötf
("∑ckë c⁄èö†\"%s\"\n", 
buf
);

104 
	}
}

	@Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/userspc/talker_dgram.c

6 
	~<°dio.h
>

7 
	~<°dlib.h
>

8 
	~<uni°d.h
>

9 
	~<î∫o.h
>

10 
	~<°rög.h
>

11 
	~<sys/ty≥s.h
>

12 
	~<sys/sockë.h
>

13 
	~<√töë/ö.h
>

14 
	~<¨∑/öë.h
>

15 
	~<√tdb.h
>

17 
	#SERVERPORT
 54295

18 

	)

19 
	$£nd_pkt
(
sd
, *
de°_ù
, *
msg
)

21 
sockaddr_ö
 
de°_addr
;

22 
numbyãs
;

24 
de°_addr
.
sö_Ámûy
 = 
AF_INET
;

25 
de°_addr
.
sö_p‹t
 = 
	`ht⁄s
(
SERVERPORT
);

26 
de°_addr
.
sö_addr
.
s_addr
 = 
	`öë_addr
(
de°_ù
);

27 
	`mem£t
(&(
de°_addr
.
sö_zîo
), '\0', 8);

29 
	`¥ötf
 ("Sending message over datagram socketÅo %s:%dÇow...\n",

30 
de°_ù
, 
SERVERPORT
);

31 i‡((
numbyãs
 = 
	`£ndto
(
sd
, 
msg
, 
	`°æí
(msg), 0,

32 (
sockaddr
 *)&
de°_addr
, (dest_addr))) == -1) {

33 
	`≥º‹
("talker: sendto");

37 
	`¥ötf
("èlkî: síà%d byãs.\n", 
numbyãs
);

38  
numbyãs
;

39 
	}
}

42 
	#MAXBUFLEN
 1000

	)

43 
	$ªcv_pkt
(
sd
)

45 
sockaddr_ö
 
§c_addr
;

46 
numbyãs
;

47 
sockÀn_t
 
addr_Àn
;

48 
buf
[
MAXBUFLEN
];

50 
addr_Àn
 = (
sockaddr
);

51 i‡((
numbyãs
 = 
	`ªcv‰om
(
sd
, 
buf
, 
MAXBUFLEN
-1, 0,

52 (
sockaddr
 *)&
§c_addr
,

53 &
addr_Àn
)) == -1) {

54 
	`≥º‹
("recvfrom");

55 
	`exô
(1);

57 
	`¥ötf
("gŸÖackë from %s\n", 
	`öë_¡ﬂ
(
§c_addr
.
sö_addr
));

58 
	`¥ötf
("∑ckë i†%d byã†l⁄g\n", 
numbyãs
);

59 
buf
[
numbyãs
] = '\0';

60 
	`¥ötf
("∑ckë c⁄èö†\"%s\"\n", 
buf
);

62  
numbyãs
;

63 
	}
}

67 
	$maö
(
¨gc
, *
¨gv
[])

69 
sockfd
;

71 i‡(
	`gëeuid
()) {

72 
	`Ârötf
(
°dîr
,"%s:ÇìdÅÿru¿a†roŸ.\n", 
¨gv
[0]);

73 
	`exô
(1);

75 i‡(
¨gc
 != 3) {

76 
	`Ârötf
(
°dîr
,"ußge: %†DEST-IP-addªs†mesßge\n", 
¨gv
[0]);

78 
	`exô
(1);

81 if–(
sockfd
 = 
	`sockë
(
AF_INET
, 
SOCK_DGRAM
, 0)) == -1 ) {

82 
	`≥º‹
("socket");

83 
	`exô
(1);

88 i‡(
	`£tsock›t
 (
sockfd
, 
SOL_SOCKET
, 
SO_BINDTODEVICE
, 
¨gv
[1], 
	`°æí
(argv[1])+1) < 0) {

89 
	`¥ötf
("\n%s:£tsock›àÁûed...\n",
¨gv
[0]);

90 
	`˛o£
(
sockfd
);

91 
	`exô
(1);

93 
	`¥ötf
 ("%s: suc˚ssfuŒy boundÅÿöãrÁ˚ '%s'\n", 
¨gv
[0],árgv[1]);

96 i‡(
	`£nd_pkt
(
sockfd
, 
¨gv
[1],árgv[2]) == -1) {

97 
	`Ârötf
(
°dîr
,"%s: síd_pkàÁûed,áb‹tög.\n", 
¨gv
[0]);

98 
	`˛o£
(
sockfd
);

99 
	`exô
(1);

103 
	`˛o£
(
sockfd
);

106 
	}
}

	@Training/L5_debug_trg/stackmem_corrupt/stackmem_corrupt.c

19 
	#_GNU_SOURCE


	)

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<uni°d.h
>

23 
	~<sig«l.h
>

24 
	~<°rög.h
>

25 
	~<sys/time.h
>

26 
	~<sys/ªsour˚.h
>

27 
	~<î∫o.h
>

29 
	$myÁu…
(
signum
, 
sigöfo_t
 *
si
, *
uc⁄ãxt
)

31 
	`Ârötf
(
°dîr
,

33 
	`Ârötf
(
°dîr
, " %s:Ñeceived signal %d.Érrno=%d\n"

35 
__func__
, 
signum
, 
si
->
si_î∫o
, si->
si_code
);

37 
si
->
si_code
) {

39 
SEGV_MAPERR
:

40 
	`Ârötf
(
°dîr
, "SEGV_MAPERR:áddressÇot mappedÅo object\n");

42 
SEGV_ACCERR
:

43 
	`Ârötf
(
°dîr
, "SEGV_ACCERR: invalidÖermissions for mapped object\n");

47 
SEGV_BNDERR
:

48 
	`Ârötf
(
°dîr
, "SEGV_BNDERR: failedáddress bound checks\n");

49 
SEGV_PKUERR
:

50 
	`Ârötf
(
°dîr
, "SEGV_PKUERR:áccess denied by memory-protection keys\n");

53 
SI_USER
:

54 
	`Ârötf
(
°dîr
, "user\n");

56 
SI_KERNEL
:

57 
	`Ârötf
(
°dîr
, "kernel\n");

59 
SI_QUEUE
:

60 
	`Ârötf
(
°dîr
, "queue\n");

62 
SI_TIMER
:

63 
	`Ârötf
(
°dîr
, "timer\n");

65 
SI_MESGQ
:

66 
	`Ârötf
(
°dîr
, "mesgq\n");

68 
SI_ASYNCIO
:

69 
	`Ârötf
(
°dîr
, "async io\n");

71 
SI_SIGIO
:

72 
	`Ârötf
(
°dîr
, "sigio\n");

74 
SI_TKILL
:

75 
	`Ârötf
(
°dîr
, "t[g]kill\n");

78 
	`Ârötf
(
°dîr
, "-none-\n");

81 
	`Ârötf
(
°dîr
, " Fau…ög in°∏‹áddªs†%p\n", 
si
->
si_addr
);

84 
	`Ârötf
(
°dîr
,

86 
	`psigöfo
(
si
, "psiginfo helper");

87 
	`Ârötf
(
°dîr
,

104 
siga˘i⁄
 
a˘
;

106 
	`mem£t
(&
a˘
, 0, (act));

108 
a˘
.
ß_h™dÀr
 = 
SIG_DFL
;

110 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

111 
	`sigem±y£t
(&
a˘
.
ß_mask
);

112 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

113 
	`≥º‹
("sigaction");

114 
	`exô
(1);

117 i‡(
	`øi£
(
SIGSEGV
)) {

118 
	`Ârötf
(
°dîr
, "øi£ SIGSEGV faûed"); 
	`exô
(1); }

119 
	}
}

121 
	#USING_ALTSIGSTACK


	)

129 
	$£tup_Ætsig°ack
(
size_t
 
°ack_sz
)

131 
°ack_t
 
ss
;

133 
	`¥ötf
("A… sig«»°ack sizê%zu byãs\n", 
°ack_sz
);

134 
ss
.
ss_•
 = 
	`mÆloc
(
°ack_sz
);

135 i‡(!
ss
.
ss_•
) {

136 
	`¥ötf
("mÆloc(%zuËf‹á… sig sèck faûed\n", 
°ack_sz
);

137  -
ENOMEM
;

140 
ss
.
ss_size
 = 
°ack_sz
;

141 
ss
.
ss_Êags
 = 0;

142 i‡(
	`sigÆt°ack
(&
ss
, 
NULL
) == -1) {

143 
	`¥ötf
("sigÆt°ack f‹ sizê%zu faûed!\n", 
°ack_sz
);

144  -
î∫o
;

149 
	}
}

151 
	$wrôe_undîÊow_c‹ru±°ack
()

153 
°ack
, 
°ack±r
;

154 
æimô
 
ª¶imô
;

155 
cmd
[128], 
°acksz_hex°r
[18], 
sz
[9];

156 
°acksz
 = 0;

157 
FILE
 *
Â
;

158 
°acksz_hex
 = 0;

160 
	`¥ötf
("%s():ápprox stackÅop (~ curr sp) is %p\n",

161 
__func__
, (*)&
°ack
);

162 i‡(
	`¥limô
(0, 
RLIMIT_STACK
, 0, &
ª¶imô
) < 0) {

163 
	`≥º‹
("prlimit failed");

166 
	`¥ötf
("%s(): stackÑesourceÜimits: soft=%ld, hard=%ld\n",

167 
__func__
, 
ª¶imô
.
æim_cur
,Ñe¶imô.
æim_max
);

170 
	`mem£t
(
cmd
, 0, 128);

171 
	`¢¥ötf
(
cmd
, 128, "./gëm≠sizê%d sèck", 
	`gëpid
());

172 
Â
 = 
	`p›í
(
cmd
, "r");

173 i‡(!
Â
) {

174 
	`≥º‹
("popen failed");

177 
°acksz
 = 
	`©oi
(
	`fgës
(
sz
, 9, 
Â
));

178 i‡(
°acksz
 <= 0) {

179 
	`p˛o£
(
Â
);

180 
	`Ârötf
(
°dîr
, "%s():gëtögá˘uÆ sèck sizêÁûed\n", 
__func__
);

183 
	`p˛o£
(
Â
);

184 
	`¥ötf
("%s():actualÖrocess (T0Åhread) stack size = %d (0x%x) bytes\n",

185 
__func__
, 
°acksz
, stacksz);

186 i‡(
°acksz
 % 
	`gë∑gesize
())

187 
	`¥ötf
("%s():WARNING:a˘uÆ sèck sizêi¢'à®roundedÖagêsize\n", 
__func__
);

189 
	`¢¥ötf
(
°acksz_hex°r
, 18, "0x%x", 
°acksz
);

190 
°acksz_hex
 = 
	`°πoul
(
°acksz_hex°r
, 
NULL
, 16);

191 
°ack±r
 = ()&
°ack
;

192 
	`¥ötf
("%s():a˘uÆ sèπ o‡°ack i†0x%lx\n", 
__func__
, 
°ack±r
 - 
°acksz_hex
);

196 
	`mem£t
((*)(
°ack±r
 - 
°acksz_hex
), 'x', 
°acksz
);

241 
	}
}

243 
	$maö
(
¨gc
, **
¨gv
)

245 
siga˘i⁄
 
a˘
;

247 
	#NUMBYTES
 (7*1024*1024)

	)

248 
	#NUMEL
 (
NUMBYTES
/())

	)

249 
l⁄g¨r
[
NUMEL
];

251 
	`mem£t
(&
l⁄g¨r
[0], 0xef, 
NUMBYTES
);

261 
	`¥ötf
("%s: sëtög u∞™á… sig°ackándÅøµög SIGSEGVÇow...\n", 
¨gv
[0]);

262 #ifde‡
USING_ALTSIGSTACK


263 i‡(
	`£tup_Ætsig°ack
(10*1024*1024) < 0) {

264 
	`Ârötf
(
°dîr
, "%s: sëtög u∞Æàsig sèck faûed\n", 
¨gv
[0]);

265 
	`exô
(1);

268 
	`mem£t
(&
a˘
, 0, (act));

269 
a˘
.
ß_siga˘i⁄
 = 
myÁu…
;

270 
a˘
.
ß_Êags
 = 
SA_RESTART
 | 
SA_SIGINFO
;

271 #ifde‡
USING_ALTSIGSTACK


272 
a˘
.
ß_Êags
 |
SA_ONSTACK
;

274 
	`sigem±y£t
(&
a˘
.
ß_mask
);

275 i‡(
	`siga˘i⁄
(
SIGSEGV
, &
a˘
, 0) == -1) {

276 
	`≥º‹
("sigaction");

277 
	`exô
(1);

280 
	`¥ötf
("Ru¬ög %†ã°ˇ£Çow...\n", 
¨gv
[0]);

281 
	`wrôe_undîÊow_c‹ru±°ack
();

282 
	`∑u£
();

283 
	`exô
(0);

284 
	}
}

	@/usr/include/alloca.h

18 #i‚def 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

26 
	g__BEGIN_DECLS


29 #unde‡
Æloˇ


32 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

34 #ifdef 
__GNUC__


35 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

38 
__END_DECLS


	@/usr/include/arpa/inet.h

18 #i‚de‡
_ARPA_INET_H


19 
	#_ARPA_INET_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<√töë/ö.h
>

25 #i‚de‡
__sockÀn_t_deföed


26 
__sockÀn_t
 
	tsockÀn_t
;

27 
	#__sockÀn_t_deföed


	)

30 
__BEGIN_DECLS


34 
ö_addr_t
 
	$öë_addr
 (c⁄° *
__˝
Ë
__THROW
;

37 
ö_addr_t
 
	$öë_ aof
 (
ö_addr
 
__ö
Ë
__THROW
;

41 
ö_addr
 
	$öë_makóddr
 (
ö_addr_t
 
__√t
, in_addr_à
__ho°
)

42 
__THROW
;

45 
ö_addr_t
 
	$öë_√tof
 (
ö_addr
 
__ö
Ë
__THROW
;

49 
ö_addr_t
 
	$öë_√tw‹k
 (c⁄° *
__˝
Ë
__THROW
;

53 *
	$öë_¡ﬂ
 (
ö_addr
 
__ö
Ë
__THROW
;

58 
	$öë_±⁄
 (
__af
, c⁄° *
__ª°ri˘
 
__˝
,

59 *
__ª°ri˘
 
__buf
Ë
__THROW
;

64 c⁄° *
	$öë_¡›
 (
__af
, c⁄° *
__ª°ri˘
 
__˝
,

65 *
__ª°ri˘
 
__buf
, 
sockÀn_t
 
__Àn
)

66 
__THROW
;

70 #ifde‡
__USE_MISC


73 
	$öë_©⁄
 (c⁄° *
__˝
, 
ö_addr
 *
__öp
Ë
__THROW
;

77 *
	$öë_√è
 (
ö_addr_t
 
__√t
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

82 *
	$öë_√t_¡›
 (
__af
, c⁄° *
__˝
, 
__bôs
,

83 *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

88 
	$öë_√t_±⁄
 (
__af
, c⁄° *
__˝
,

89 *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

94 
	$öë_nßp_addr
 (c⁄° *
__˝
,

95 *
__buf
, 
__Àn
Ë
__THROW
;

99 *
	$öë_nßp_¡ﬂ
 (
__Àn
, c⁄° *
__˝
,

100 *
__buf
Ë
__THROW
;

103 
__END_DECLS


	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #unde‡
_ASSERT_H


25 #unde‡
as£π


26 #unde‡
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #unde‡
as£π_≥º‹


34 
	#_ASSERT_H
 1

	)

35 
	~<„©uªs.h
>

37 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
°©ic_ˇ°
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£π
(
ex¥
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£π_≥º‹
(
î∫um
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #i‚de‡
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£π_Áû
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
,

70 
__löe
, c⁄° *
__fun˘i⁄
)

71 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

74 
	$__as£π_≥º‹_Áû
 (
__î∫um
, c⁄° *
__fûe
,

75 
__löe
, c⁄° *
__fun˘i⁄
)

76 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

81 
	$__as£π
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
, 
__löe
)

82 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

85 
__END_DECLS


91 #i‡
deföed
 
__˝lu•lus


92 
	#as£π
(
ex¥
) \

93 (
°©ic_ˇ°
 <
boﬁ
> (
ex¥
) \

95 : 
	`__as£π_Áû
 (#ex¥, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

96 #ñi‡!
deföed
 
__GNUC__
 || deföed 
__STRICT_ANSI__


97 
	#as£π
(
ex¥
) \

98 ((
ex¥
) \

99 ? 
	`__ASSERT_VOID_CAST
 (0) \

100 : 
	`__as£π_Áû
 (#ex¥, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

107 
	#as£π
(
ex¥
) \

108 ((Ë ((
ex¥
Ë? 1 : 0), 
	`__exãnsi⁄__
 ({ \

109 i‡(
ex¥
) \

112 
	`__as£π_Áû
 (#ex¥, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
); \

113 
	}
}))

	)

116 #ifdef 
__USE_GNU


117 
	#as£π_≥º‹
(
î∫um
) \

118 (!(
î∫um
) \

119 ? 
	`__ASSERT_VOID_CAST
 (0) \

120 : 
	`__as£π_≥º‹_Áû
 ((
î∫um
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

128 #i‡
deföed
 
__˝lu•lus
 ? 
__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

129 
	#__ASSERT_FUNCTION
 
__exãnsi⁄__
 
__PRETTY_FUNCTION__


	)

131 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

132 
	#__ASSERT_FUNCTION
 
__func__


	)

134 
	#__ASSERT_FUNCTION
 ((c⁄° *Ë0)

	)

141 #i‡
deföed
 
__USE_ISOC11
 && !deföed 
__˝lu•lus


142 #unde‡
°©ic_as£π


143 
	#°©ic_as£π
 
_Sètic_as£π


	)

	@/usr/include/ctype.h

22 #i‚def 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 
	g__BEGIN_DECLS


30 #i‚de‡
_ISbô


39 
	~<bôs/ídün.h
>

40 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


41 
	#_ISbô
(
bô
Ë(1 << (bô))

	)

43 
	#_ISbô
(
bô
Ë((bôË< 8 ? ((1 << (bô)Ë<< 8Ë: ((1 << (bô)Ë>> 8))

	)

48 
	m_ISuµî
 = 
_ISbô
 (0),

49 
	m_ISlowî
 = 
_ISbô
 (1),

50 
	m_ISÆpha
 = 
_ISbô
 (2),

51 
	m_ISdigô
 = 
_ISbô
 (3),

52 
	m_ISxdigô
 = 
_ISbô
 (4),

53 
	m_IS•a˚
 = 
_ISbô
 (5),

54 
	m_IS¥öt
 = 
_ISbô
 (6),

55 
	m_ISgøph
 = 
_ISbô
 (7),

56 
	m_ISbœnk
 = 
_ISbô
 (8),

57 
	m_IS˙ål
 = 
_ISbô
 (9),

58 
	m_ISpun˘
 = 
_ISbô
 (10),

59 
	m_ISÆnum
 = 
_ISbô
 (11)

79 c⁄° **
	$__˘y≥_b_loc
 ()

80 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

81 c⁄° 
__öt32_t
 **
	$__˘y≥_tﬁowî_loc
 ()

82 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

83 c⁄° 
__öt32_t
 **
	$__˘y≥_touµî_loc
 ()

84 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

87 #i‚de‡
__˝lu•lus


88 
	#__is˘y≥
(
c
, 
ty≥
) \

89 ((*
	`__˘y≥_b_loc
 ())[(Ë(
c
)] & (Ë
ty≥
)

	)

90 #ñi‡
deföed
 
__USE_EXTERN_INLINES


91 
	#__is˘y≥_f
(
ty≥
) \

92 
__exã∫_ölöe
 \

93 
is
##
	`ty≥
 (
__c
Ë
__THROW
 \

95  (*
	`__˘y≥_b_loc
 ())[(Ë(
__c
)] & (Ë
_IS
##
ty≥
; \

96 
	}

	)
}

99 
	#__ißscii
(
c
Ë(((cË& ~0x7fË=0Ë

	)

100 
	#__tﬂscii
(
c
Ë((cË& 0x7fË

	)

102 
	#__ex˘y≥
(
«me
Ë
	`«me
 (Ë
__THROW


	)

108 
__ex˘y≥
 (
iß um
);

109 
__ex˘y≥
 (
ißÕha
);

110 
__ex˘y≥
 (
is˙ål
);

111 
__ex˘y≥
 (
isdigô
);

112 
__ex˘y≥
 (
i¶owî
);

113 
__ex˘y≥
 (
isgøph
);

114 
__ex˘y≥
 (
i•röt
);

115 
__ex˘y≥
 (
i•un˘
);

116 
__ex˘y≥
 (
is•a˚
);

117 
__ex˘y≥
 (
isuµî
);

118 
__ex˘y≥
 (
isxdigô
);

122 
	$tﬁowî
 (
__c
Ë
__THROW
;

125 
	$touµî
 (
__c
Ë
__THROW
;

129 #ifdef 
__USE_ISOC99


130 
	`__ex˘y≥
 (
isbœnk
);

133 #ifde‡
__USE_GNU


135 
	$is˘y≥
 (
__c
, 
__mask
Ë
__THROW
;

138 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


142 
	$ißscii
 (
__c
Ë
__THROW
;

146 
	$tﬂscii
 (
__c
Ë
__THROW
;

150 
	`__ex˘y≥
 (
_touµî
);

151 
	`__ex˘y≥
 (
_tﬁowî
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¨gs
) \

156 (
__exãnsi⁄__
 \

157 ({ 
__ªs
; \

158 i‡( (
c
) > 1) \

160 i‡(
	`__buûtö_c⁄°™t_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__ªs
 = 
__c
 < -128 || __¯> 255 ? __¯: (
a
)[__c]; \

166 
__ªs
 = 
f
 
¨gs
; \

169 
__ªs
 = (
a
)[(Ë(
c
)]; \

170 
__ªs
; 
	}
}))

	)

172 #i‡!
deföed
 
__NO_CTYPE


173 #ifde‡
__is˘y≥_f


174 
	$__is˘y≥_f
 (
Ænum
)

175 
	$__is˘y≥_f
 (
Æpha
)

176 
	$__is˘y≥_f
 (
˙ål
)

177 
	$__is˘y≥_f
 (
digô
)

178 
	$__is˘y≥_f
 (
lowî
)

179 
	$__is˘y≥_f
 (
gøph
)

180 
	$__is˘y≥_f
 (
¥öt
)

181 
	$__is˘y≥_f
 (
pun˘
)

182 
	$__is˘y≥_f
 (
•a˚
)

183 
	$__is˘y≥_f
 (
uµî
)

184 
	$__is˘y≥_f
 (
xdigô
)

185 #ifde‡
__USE_ISOC99


186 
	$__is˘y≥_f
 (
bœnk
)

188 #ñi‡
deföed
 
__is˘y≥


189 
	#iß um
(
c
Ë
	`__is˘y≥
((c), 
_ISÆnum
)

	)

190 
	#ißÕha
(
c
Ë
	`__is˘y≥
((c), 
_ISÆpha
)

	)

191 
	#is˙ål
(
c
Ë
	`__is˘y≥
((c), 
_IS˙ål
)

	)

192 
	#isdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISdigô
)

	)

193 
	#i¶owî
(
c
Ë
	`__is˘y≥
((c), 
_ISlowî
)

	)

194 
	#isgøph
(
c
Ë
	`__is˘y≥
((c), 
_ISgøph
)

	)

195 
	#i•röt
(
c
Ë
	`__is˘y≥
((c), 
_IS¥öt
)

	)

196 
	#i•un˘
(
c
Ë
	`__is˘y≥
((c), 
_ISpun˘
)

	)

197 
	#is•a˚
(
c
Ë
	`__is˘y≥
((c), 
_IS•a˚
)

	)

198 
	#isuµî
(
c
Ë
	`__is˘y≥
((c), 
_ISuµî
)

	)

199 
	#isxdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISxdigô
)

	)

200 #ifde‡
__USE_ISOC99


201 
	#isbœnk
(
c
Ë
	`__is˘y≥
((c), 
_ISbœnk
)

	)

205 #ifde‡
__USE_EXTERN_INLINES


206 
__exã∫_ölöe
 

207 
	`__NTH
 (
	$tﬁowî
 (
__c
))

209  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_tﬁowî_loc
 ())[__c] : __c;

210 
	}
}

212 
__exã∫_ölöe
 

213 
__NTH
 (
	$touµî
 (
__c
))

215  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_touµî_loc
 ())[__c] : __c;

216 
	}
}

219 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


220 
	#tﬁowî
(
c
Ë
	`__tobody
 (c, 
tﬁowî
, *
	`__˘y≥_tﬁowî_loc
 (), (c))

	)

221 
	#touµî
(
c
Ë
	`__tobody
 (c, 
touµî
, *
	`__˘y≥_touµî_loc
 (), (c))

	)

224 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


225 
	#ißscii
(
c
Ë
	`__ißscii
 (c)

	)

226 
	#tﬂscii
(
c
Ë
	`__tﬂscii
 (c)

	)

228 
	#_tﬁowî
(
c
Ë((Ë(*
	`__˘y≥_tﬁowî_loc
 ())[(Ë(c)])

	)

229 
	#_touµî
(
c
Ë((Ë(*
	`__˘y≥_touµî_loc
 ())[(Ë(c)])

	)

235 #ifde‡
__USE_XOPEN2K8


237 
	~<bôs/ty≥s/loˇÀ_t.h
>

241 
	#__is˘y≥_l
(
c
, 
ty≥
, 
loˇÀ
) \

242 ((
loˇÀ
)->
__˘y≥_b
[(Ë(
c
)] & (Ë
ty≥
)

	)

244 
	#__ex˘y≥_l
(
«me
) \

245 
	`«me
 (, 
loˇÀ_t
Ë
__THROW


	)

251 
__ex˘y≥_l
 (
iß um_l
);

252 
__ex˘y≥_l
 (
ißÕha_l
);

253 
__ex˘y≥_l
 (
is˙ål_l
);

254 
__ex˘y≥_l
 (
isdigô_l
);

255 
__ex˘y≥_l
 (
i¶owî_l
);

256 
__ex˘y≥_l
 (
isgøph_l
);

257 
__ex˘y≥_l
 (
i•röt_l
);

258 
__ex˘y≥_l
 (
i•un˘_l
);

259 
__ex˘y≥_l
 (
is•a˚_l
);

260 
__ex˘y≥_l
 (
isuµî_l
);

261 
__ex˘y≥_l
 (
isxdigô_l
);

263 
__ex˘y≥_l
 (
isbœnk_l
);

267 
	$__tﬁowî_l
 (
__c
, 
loˇÀ_t
 
__l
Ë
__THROW
;

268 
	$tﬁowî_l
 (
__c
, 
loˇÀ_t
 
__l
Ë
__THROW
;

271 
	$__touµî_l
 (
__c
, 
loˇÀ_t
 
__l
Ë
__THROW
;

272 
	$touµî_l
 (
__c
, 
loˇÀ_t
 
__l
Ë
__THROW
;

274 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


275 
	#__tﬁowî_l
(
c
, 
loˇÀ
) \

276 
	`__tobody
 (
c
, 
__tﬁowî_l
, (
loˇÀ
)->
__˘y≥_tﬁowî
, (c,ÜoˇÀ))

	)

277 
	#__touµî_l
(
c
, 
loˇÀ
) \

278 
	`__tobody
 (
c
, 
__touµî_l
, (
loˇÀ
)->
__˘y≥_touµî
, (c,ÜoˇÀ))

	)

279 
	#tﬁowî_l
(
c
, 
loˇÀ
Ë
	`__tﬁowî_l
 ((c), (loˇÀ))

	)

280 
	#touµî_l
(
c
, 
loˇÀ
Ë
	`__touµî_l
 ((c), (loˇÀ))

	)

284 #i‚de‡
__NO_CTYPE


285 
	#__iß um_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆnum
, (l))

	)

286 
	#__ißÕha_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆpha
, (l))

	)

287 
	#__is˙ål_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS˙ål
, (l))

	)

288 
	#__isdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISdigô
, (l))

	)

289 
	#__i¶owî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISlowî
, (l))

	)

290 
	#__isgøph_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISgøph
, (l))

	)

291 
	#__i•röt_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS¥öt
, (l))

	)

292 
	#__i•un˘_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISpun˘
, (l))

	)

293 
	#__is•a˚_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS•a˚
, (l))

	)

294 
	#__isuµî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISuµî
, (l))

	)

295 
	#__isxdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISxdigô
, (l))

	)

297 
	#__isbœnk_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISbœnk
, (l))

	)

299 #ifde‡
__USE_MISC


300 
	#__ißscii_l
(
c
,
l
Ë(÷), 
	`__ißscii
 (c))

	)

301 
	#__tﬂscii_l
(
c
,
l
Ë(÷), 
	`__tﬂscii
 (c))

	)

304 
	#iß um_l
(
c
,
l
Ë
	`__iß um_l
 ((c), (l))

	)

305 
	#ißÕha_l
(
c
,
l
Ë
	`__ißÕha_l
 ((c), (l))

	)

306 
	#is˙ål_l
(
c
,
l
Ë
	`__is˙ål_l
 ((c), (l))

	)

307 
	#isdigô_l
(
c
,
l
Ë
	`__isdigô_l
 ((c), (l))

	)

308 
	#i¶owî_l
(
c
,
l
Ë
	`__i¶owî_l
 ((c), (l))

	)

309 
	#isgøph_l
(
c
,
l
Ë
	`__isgøph_l
 ((c), (l))

	)

310 
	#i•röt_l
(
c
,
l
Ë
	`__i•röt_l
 ((c), (l))

	)

311 
	#i•un˘_l
(
c
,
l
Ë
	`__i•un˘_l
 ((c), (l))

	)

312 
	#is•a˚_l
(
c
,
l
Ë
	`__is•a˚_l
 ((c), (l))

	)

313 
	#isuµî_l
(
c
,
l
Ë
	`__isuµî_l
 ((c), (l))

	)

314 
	#isxdigô_l
(
c
,
l
Ë
	`__isxdigô_l
 ((c), (l))

	)

316 
	#isbœnk_l
(
c
,
l
Ë
	`__isbœnk_l
 ((c), (l))

	)

318 #ifde‡
__USE_MISC


319 
	#ißscii_l
(
c
,
l
Ë
	`__ißscii_l
 ((c), (l))

	)

320 
	#tﬂscii_l
(
c
,
l
Ë
	`__tﬂscii_l
 ((c), (l))

	)

327 
__END_DECLS


	@/usr/include/errno.h

22 #i‚def 
_ERRNO_H


23 
	#_ERRNO_H
 1

	)

25 
	~<„©uªs.h
>

28 
	~<bôs/î∫o.h
>

32 #i‚de‡
__ASSEMBLER__


34 
__BEGIN_DECLS


37 *
	$__î∫o_loˇti⁄
 (Ë
__THROW
 
__©åibuã_c⁄°__
;

38 
	#î∫o
 (*
	`__î∫o_loˇti⁄
 ())

	)

40 #ifde‡
__USE_GNU


45 *
¥ogøm_övoˇti⁄_«me
;

46 *
¥ogøm_övoˇti⁄_sh‹t_«me
;

48 
	~<bôs/ty≥s/îr‹_t.h
>

52 
__END_DECLS


	@/usr/include/fcntl.h

22 #i‚def 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


31 
	~<bôs/ty≥s.h
>

35 
	~<bôs/f˙é.h
>

39 #ifde‡
__O_TMPFILE


40 
	#__OPEN_NEEDS_MODE
(
oÊag
) \

41 (((
oÊag
Ë& 
O_CREAT
Ë!0 || ((oÊagË& 
__O_TMPFILE
Ë=__O_TMPFILE)

	)

43 
	#__OPEN_NEEDS_MODE
(
oÊag
Ë(((oÊagË& 
O_CREAT
Ë!0)

	)

49 #i‚de‡
__mode_t_deföed


50 
__mode_t
 
	tmode_t
;

51 
	#__mode_t_deföed


	)

54 #i‚de‡
__off_t_deföed


55 #i‚de‡
__USE_FILE_OFFSET64


56 
__off_t
 
	toff_t
;

58 
__off64_t
 
	toff_t
;

60 
	#__off_t_deföed


	)

63 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_deföed


	)

68 #i‚de‡
__pid_t_deföed


69 
__pid_t
 
	tpid_t
;

70 
	#__pid_t_deföed


	)

74 #ifde‡
__USE_XOPEN2K8


75 
	~<bôs/ty≥s/°ru˘_time•ec.h
>

77 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


78 
	~<bôs/°©.h
>

80 
	#S_IFMT
 
__S_IFMT


	)

81 
	#S_IFDIR
 
__S_IFDIR


	)

82 
	#S_IFCHR
 
__S_IFCHR


	)

83 
	#S_IFBLK
 
__S_IFBLK


	)

84 
	#S_IFREG
 
__S_IFREG


	)

85 #ifde‡
__S_IFIFO


86 
	#S_IFIFO
 
__S_IFIFO


	)

88 #ifde‡
__S_IFLNK


89 
	#S_IFLNK
 
__S_IFLNK


	)

91 #i‡(
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8
Ë&& deföed 
__S_IFSOCK


92 
	#S_IFSOCK
 
__S_IFSOCK


	)

97 
	#S_ISUID
 
__S_ISUID


	)

98 
	#S_ISGID
 
__S_ISGID


	)

100 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


102 
	#S_ISVTX
 
__S_ISVTX


	)

105 
	#S_IRUSR
 
__S_IREAD


	)

106 
	#S_IWUSR
 
__S_IWRITE


	)

107 
	#S_IXUSR
 
__S_IEXEC


	)

109 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

111 
	#S_IRGRP
 (
S_IRUSR
 >> 3Ë

	)

112 
	#S_IWGRP
 (
S_IWUSR
 >> 3Ë

	)

113 
	#S_IXGRP
 (
S_IXUSR
 >> 3Ë

	)

115 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

117 
	#S_IROTH
 (
S_IRGRP
 >> 3Ë

	)

118 
	#S_IWOTH
 (
S_IWGRP
 >> 3Ë

	)

119 
	#S_IXOTH
 (
S_IXGRP
 >> 3Ë

	)

121 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

124 #ifdef 
__USE_MISC


125 #i‚de‡
R_OK


128 
	#R_OK
 4

	)

129 
	#W_OK
 2

	)

130 
	#X_OK
 1

	)

131 
	#F_OK
 0

	)

136 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


137 
	#SEEK_SET
 0

	)

138 
	#SEEK_CUR
 1

	)

139 
	#SEEK_END
 2

	)

147 #i‚de‡
__USE_FILE_OFFSET64


148 
f˙é
 (
__fd
, 
__cmd
, ...);

150 #ifde‡
__REDIRECT


151 
__REDIRECT
 (
f˙é
, (
__fd
, 
__cmd
, ...), 
f˙é64
);

153 
	#f˙é
 
f˙é64


	)

156 #ifde‡
__USE_LARGEFILE64


157 
f˙é64
 (
__fd
, 
__cmd
, ...);

167 #i‚de‡
__USE_FILE_OFFSET64


168 
	$›í
 (c⁄° *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

170 #ifde‡
__REDIRECT


171 
	`__REDIRECT
 (
›í
, (c⁄° *
__fûe
, 
__oÊag
, ...), 
›í64
)

172 
	`__n⁄nuŒ
 ((1));

174 
	#›í
 
›í64


	)

177 #ifde‡
__USE_LARGEFILE64


178 
	$›í64
 (c⁄° *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

181 #ifde‡
__USE_ATFILE


191 #i‚de‡
__USE_FILE_OFFSET64


192 
	$›í©
 (
__fd
, c⁄° *
__fûe
, 
__oÊag
, ...)

193 
	`__n⁄nuŒ
 ((2));

195 #ifde‡
__REDIRECT


196 
	`__REDIRECT
 (
›í©
, (
__fd
, c⁄° *
__fûe
, 
__oÊag
,

197 ...), 
›í©64
Ë
	`__n⁄nuŒ
 ((2));

199 
	#›í©
 
›í©64


	)

202 #ifde‡
__USE_LARGEFILE64


203 
	$›í©64
 (
__fd
, c⁄° *
__fûe
, 
__oÊag
, ...)

204 
	`__n⁄nuŒ
 ((2));

213 #i‚de‡
__USE_FILE_OFFSET64


214 
	$¸ót
 (c⁄° *
__fûe
, 
mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

216 #ifde‡
__REDIRECT


217 
	`__REDIRECT
 (
¸ót
, (c⁄° *
__fûe
, 
mode_t
 
__mode
),

218 
¸ót64
Ë
	`__n⁄nuŒ
 ((1));

220 
	#¸ót
 
¸ót64


	)

223 #ifde‡
__USE_LARGEFILE64


224 
	$¸ót64
 (c⁄° *
__fûe
, 
mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

227 #i‡!
deföed
 
F_LOCK
 && (deföed 
__USE_MISC
 || (deföed 
__USE_XOPEN_EXTENDED
 \

228 && !
deföed
 
__USE_POSIX
))

237 
	#F_ULOCK
 0

	)

238 
	#F_LOCK
 1

	)

239 
	#F_TLOCK
 2

	)

240 
	#F_TEST
 3

	)

242 #i‚de‡
__USE_FILE_OFFSET64


243 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Àn
);

245 #ifde‡
__REDIRECT


246 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
), 
lockf64
);

248 
	#lockf
 
lockf64


	)

251 #ifde‡
__USE_LARGEFILE64


252 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Àn
);

256 #ifde‡
__USE_XOPEN2K


259 #i‚de‡
__USE_FILE_OFFSET64


260 
	$posix_Ádvi£
 (
__fd
, 
off_t
 
__off£t
, off_à
__Àn
,

261 
__advi£
Ë
__THROW
;

263 #ifde‡
__REDIRECT_NTH


264 
	`__REDIRECT_NTH
 (
posix_Ádvi£
, (
__fd
, 
__off64_t
 
__off£t
,

265 
__off64_t
 
__Àn
, 
__advi£
),

266 
posix_Ádvi£64
);

268 
	#posix_Ádvi£
 
posix_Ádvi£64


	)

271 #ifde‡
__USE_LARGEFILE64


272 
	$posix_Ádvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_à
__Àn
,

273 
__advi£
Ë
__THROW
;

281 #i‚de‡
__USE_FILE_OFFSET64


282 
	`posix_ÁŒoˇã
 (
__fd
, 
off_t
 
__off£t
, off_à
__Àn
);

284 #ifde‡
__REDIRECT


285 
	`__REDIRECT
 (
posix_ÁŒoˇã
, (
__fd
, 
__off64_t
 
__off£t
,

286 
__off64_t
 
__Àn
),

287 
posix_ÁŒoˇã64
);

289 
	#posix_ÁŒoˇã
 
posix_ÁŒoˇã64


	)

292 #ifde‡
__USE_LARGEFILE64


293 
	`posix_ÁŒoˇã64
 (
__fd
, 
off64_t
 
__off£t
, off64_à
__Àn
);

299 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄
 \

300 && 
deföed
 
__va_¨g_∑ck_Àn


301 
	~<bôs/f˙é2.h
>

304 
__END_DECLS


	@/usr/include/limits.h

22 #i‚de‡
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<bôs/libc-hódî-°¨t.h
>

32 
	#MB_LEN_MAX
 16

	)

37 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

42 #i‚de‡
_LIMITS_H


43 
	#_LIMITS_H
 1

	)

45 
	~<bôs/w‹dsize.h
>

54 
	#CHAR_BIT
 8

	)

57 
	#SCHAR_MIN
 (-128)

	)

58 
	#SCHAR_MAX
 127

	)

61 
	#UCHAR_MAX
 255

	)

64 #ifde‡
__CHAR_UNSIGNED__


65 
	#CHAR_MIN
 0

	)

66 
	#CHAR_MAX
 
UCHAR_MAX


	)

68 
	#CHAR_MIN
 
SCHAR_MIN


	)

69 
	#CHAR_MAX
 
SCHAR_MAX


	)

73 
	#SHRT_MIN
 (-32768)

	)

74 
	#SHRT_MAX
 32767

	)

77 
	#USHRT_MAX
 65535

	)

80 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

81 
	#INT_MAX
 2147483647

	)

84 
	#UINT_MAX
 4294967295U

	)

87 #i‡
__WORDSIZE
 == 64

88 
	#LONG_MAX
 9223372036854775807L

	)

90 
	#LONG_MAX
 2147483647L

	)

92 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

95 #i‡
__WORDSIZE
 == 64

96 
	#ULONG_MAX
 18446744073709551615UL

	)

98 
	#ULONG_MAX
 4294967295UL

	)

101 #ifde‡
__USE_ISOC99


104 
	#LLONG_MAX
 9223372036854775807LL

	)

105 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

108 
	#ULLONG_MAX
 18446744073709551615ULL

	)

122 #i‡
deföed
 
__GNUC__
 && !deföed 
_GCC_LIMITS_H_


124 #ö˛ude_√xà<
limôs
.
h
>

130 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__


131 #i‚de‡
LLONG_MIN


132 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

134 #i‚de‡
LLONG_MAX


135 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

137 #i‚de‡
ULLONG_MAX


138 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

145 #i‡
__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

146 #i‚de‡
CHAR_WIDTH


147 
	#CHAR_WIDTH
 8

	)

149 #i‚de‡
SCHAR_WIDTH


150 
	#SCHAR_WIDTH
 8

	)

152 #i‚de‡
UCHAR_WIDTH


153 
	#UCHAR_WIDTH
 8

	)

155 #i‚de‡
SHRT_WIDTH


156 
	#SHRT_WIDTH
 16

	)

158 #i‚de‡
USHRT_WIDTH


159 
	#USHRT_WIDTH
 16

	)

161 #i‚de‡
INT_WIDTH


162 
	#INT_WIDTH
 32

	)

164 #i‚de‡
UINT_WIDTH


165 
	#UINT_WIDTH
 32

	)

167 #i‚de‡
LONG_WIDTH


168 
	#LONG_WIDTH
 
__WORDSIZE


	)

170 #i‚de‡
ULONG_WIDTH


171 
	#ULONG_WIDTH
 
__WORDSIZE


	)

173 #i‚de‡
LLONG_WIDTH


174 
	#LLONG_WIDTH
 64

	)

176 #i‚de‡
ULLONG_WIDTH


177 
	#ULLONG_WIDTH
 64

	)

181 #ifdef 
__USE_POSIX


183 
	~<bôs/posix1_lim.h
>

186 #ifdef 
__USE_POSIX2


187 
	~<bôs/posix2_lim.h
>

190 #ifdef 
__USE_XOPEN


191 
	~<bôs/x›í_lim.h
>

	@/usr/include/linux/cdrom.h

12 #i‚de‡
_LINUX_CDROM_H


13 
	#_LINUX_CDROM_H


	)

15 
	~<löux/ty≥s.h
>

16 
	~<asm/byã‹dî.h
>

47 
	#EDRIVE_CANT_DO_THIS
 
EOPNOTSUPP


	)

54 
	#CDROMPAUSE
 0x5301

	)

55 
	#CDROMRESUME
 0x5302

	)

56 
	#CDROMPLAYMSF
 0x5303

	)

57 
	#CDROMPLAYTRKIND
 0x5304

	)

59 
	#CDROMREADTOCHDR
 0x5305

	)

61 
	#CDROMREADTOCENTRY
 0x5306

	)

63 
	#CDROMSTOP
 0x5307

	)

64 
	#CDROMSTART
 0x5308

	)

65 
	#CDROMEJECT
 0x5309

	)

66 
	#CDROMVOLCTRL
 0x530®

	)

68 
	#CDROMSUBCHNL
 0x530b

	)

70 
	#CDROMREADMODE2
 0x530¯

	)

72 
	#CDROMREADMODE1
 0x530d

	)

74 
	#CDROMREADAUDIO
 0x530ê

	)

75 
	#CDROMEJECT_SW
 0x530‡

	)

76 
	#CDROMMULTISESSION
 0x5310

	)

79 
	#CDROM_GET_MCN
 0x5311

	)

81 
	#CDROM_GET_UPC
 
CDROM_GET_MCN


	)

83 
	#CDROMRESET
 0x5312

	)

84 
	#CDROMVOLREAD
 0x5313

	)

86 
	#CDROMREADRAW
 0x5314

	)

91 
	#CDROMREADCOOKED
 0x5315

	)

92 
	#CDROMSEEK
 0x5316

	)

98 
	#CDROMPLAYBLK
 0x5317

	)

103 
	#CDROMREADALL
 0x5318

	)

112 
	#CDROMGETSPINDOWN
 0x531d

	)

113 
	#CDROMSETSPINDOWN
 0x531e

	)

120 
	#CDROMCLOSETRAY
 0x5319

	)

121 
	#CDROM_SET_OPTIONS
 0x5320

	)

122 
	#CDROM_CLEAR_OPTIONS
 0x5321

	)

123 
	#CDROM_SELECT_SPEED
 0x5322

	)

124 
	#CDROM_SELECT_DISC
 0x5323

	)

125 
	#CDROM_MEDIA_CHANGED
 0x5325

	)

126 
	#CDROM_DRIVE_STATUS
 0x5326

	)

127 
	#CDROM_DISC_STATUS
 0x5327

	)

128 
	#CDROM_CHANGER_NSLOTS
 0x5328

	)

129 
	#CDROM_LOCKDOOR
 0x5329

	)

130 
	#CDROM_DEBUG
 0x5330

	)

131 
	#CDROM_GET_CAPABILITY
 0x5331

	)

138 
	#CDROMAUDIOBUFSIZ
 0x5382

	)

142 
	#DVD_READ_STRUCT
 0x5390

	)

143 
	#DVD_WRITE_STRUCT
 0x5391

	)

144 
	#DVD_AUTH
 0x5392

	)

146 
	#CDROM_SEND_PACKET
 0x5393

	)

147 
	#CDROM_NEXT_WRITABLE
 0x5394

	)

148 
	#CDROM_LAST_WRITTEN
 0x5395

	)

155 
	scdrom_msf0


157 
__u8
 
	mmöuã
;

158 
__u8
 
	m£c⁄d
;

159 
__u8
 
	m‰ame
;

163 
	ucdrom_addr


165 
cdrom_msf0
 
	mmsf
;

166 
	mlba
;

170 
	scdrom_msf


172 
__u8
 
	mcdmsf_mö0
;

173 
__u8
 
	mcdmsf_£c0
;

174 
__u8
 
	mcdmsf_‰ame0
;

175 
__u8
 
	mcdmsf_mö1
;

176 
__u8
 
	mcdmsf_£c1
;

177 
__u8
 
	mcdmsf_‰ame1
;

181 
	scdrom_ti


183 
__u8
 
	mcdti_åk0
;

184 
__u8
 
	mcdti_öd0
;

185 
__u8
 
	mcdti_åk1
;

186 
__u8
 
	mcdti_öd1
;

190 
	scdrom_tochdr


192 
__u8
 
	mcdth_åk0
;

193 
__u8
 
	mcdth_åk1
;

197 
	scdrom_vﬁ˘æ


199 
__u8
 
	mch™√l0
;

200 
__u8
 
	mch™√l1
;

201 
__u8
 
	mch™√l2
;

202 
__u8
 
	mch™√l3
;

206 
	scdrom_subch∆


208 
__u8
 
	mcdsc_f‹m©
;

209 
__u8
 
	mcdsc_audio°©us
;

210 
__u8
 
	mcdsc_adr
: 4;

211 
__u8
 
	mcdsc_˘æ
: 4;

212 
__u8
 
	mcdsc_åk
;

213 
__u8
 
	mcdsc_öd
;

214 
cdrom_addr
 
	mcdsc_abßddr
;

215 
cdrom_addr
 
	mcdsc_ªœddr
;

220 
	scdrom_to˚¡ry


222 
__u8
 
	mcdã_åack
;

223 
__u8
 
	mcdã_adr
 :4;

224 
__u8
 
	mcdã_˘æ
 :4;

225 
__u8
 
	mcdã_f‹m©
;

226 
cdrom_addr
 
	mcdã_addr
;

227 
__u8
 
	mcdã_d©amode
;

231 
	scdrom_ªad


233 
	mcdªad_lba
;

234 *
	mcdªad_buÁddr
;

235 
	mcdªad_buÊí
;

239 
	scdrom_ªad_audio


241 
cdrom_addr
 
	maddr
;

242 
__u8
 
	maddr_f‹m©
;

243 
	mn‰ames
;

244 
__u8
 *
	mbuf
;

248 
	scdrom_mu…i£ssi⁄


250 
cdrom_addr
 
	maddr
;

253 
__u8
 
	mxa_Êag
;

254 
__u8
 
	maddr_f‹m©
;

262 
	scdrom_m˙


264 
__u8
 
	mmedium_ˇèlog_numbî
[14];

268 
	scdrom_blk


270 
	m‰om
;

271 
	mÀn
;

274 
	#CDROM_PACKET_SIZE
 12

	)

276 
	#CGC_DATA_UNKNOWN
 0

	)

277 
	#CGC_DATA_WRITE
 1

	)

278 
	#CGC_DATA_READ
 2

	)

279 
	#CGC_DATA_NONE
 3

	)

282 
	scdrom_gíîic_comm™d


284 
	mcmd
[
CDROM_PACKET_SIZE
];

285 *
	mbuf„r
;

286 
	mbuÊí
;

287 
	m°©
;

288 
ªque°_£n£
 *
	m£n£
;

289 
	md©a_dúe˘i⁄
;

290 
	mquõt
;

291 
	mtimeout
;

292 *
	mª£rved
[1];

330 
	#CD_MINS
 74

	)

331 
	#CD_SECS
 60

	)

332 
	#CD_FRAMES
 75

	)

333 
	#CD_SYNC_SIZE
 12

	)

334 
	#CD_MSF_OFFSET
 150

	)

335 
	#CD_CHUNK_SIZE
 24

	)

336 
	#CD_NUM_OF_CHUNKS
 98

	)

337 
	#CD_FRAMESIZE_SUB
 96

	)

338 
	#CD_HEAD_SIZE
 4

	)

339 
	#CD_SUBHEAD_SIZE
 8

	)

340 
	#CD_EDC_SIZE
 4

	)

341 
	#CD_ZERO_SIZE
 8

	)

342 
	#CD_ECC_SIZE
 276

	)

343 
	#CD_FRAMESIZE
 2048

	)

344 
	#CD_FRAMESIZE_RAW
 2352

	)

345 
	#CD_FRAMESIZE_RAWER
 2646

	)

347 
	#CD_FRAMESIZE_RAW1
 (
CD_FRAMESIZE_RAW
-
CD_SYNC_SIZE
Ë

	)

348 
	#CD_FRAMESIZE_RAW0
 (
CD_FRAMESIZE_RAW
-
CD_SYNC_SIZE
-
CD_HEAD_SIZE
Ë

	)

350 
	#CD_XA_HEAD
 (
CD_HEAD_SIZE
+
CD_SUBHEAD_SIZE
Ë

	)

351 
	#CD_XA_TAIL
 (
CD_EDC_SIZE
+
CD_ECC_SIZE
Ë

	)

352 
	#CD_XA_SYNC_HEAD
 (
CD_SYNC_SIZE
+
CD_XA_HEAD
Ë

	)

355 
	#CDROM_LBA
 0x01

	)

356 
	#CDROM_MSF
 0x02

	)

359 
	#CDROM_DATA_TRACK
 0x04

	)

362 
	#CDROM_LEADOUT
 0xAA

	)

365 
	#CDROM_AUDIO_INVALID
 0x00

	)

366 
	#CDROM_AUDIO_PLAY
 0x11

	)

367 
	#CDROM_AUDIO_PAUSED
 0x12

	)

368 
	#CDROM_AUDIO_COMPLETED
 0x13

	)

369 
	#CDROM_AUDIO_ERROR
 0x14

	)

370 
	#CDROM_AUDIO_NO_STATUS
 0x15

	)

373 
	#CDC_CLOSE_TRAY
 0x1

	)

374 
	#CDC_OPEN_TRAY
 0x2

	)

375 
	#CDC_LOCK
 0x4

	)

376 
	#CDC_SELECT_SPEED
 0x8

	)

377 
	#CDC_SELECT_DISC
 0x10

	)

378 
	#CDC_MULTI_SESSION
 0x20

	)

379 
	#CDC_MCN
 0x40

	)

380 
	#CDC_MEDIA_CHANGED
 0x80

	)

381 
	#CDC_PLAY_AUDIO
 0x100

	)

382 
	#CDC_RESET
 0x200

	)

383 
	#CDC_DRIVE_STATUS
 0x800

	)

384 
	#CDC_GENERIC_PACKET
 0x1000

	)

385 
	#CDC_CD_R
 0x2000

	)

386 
	#CDC_CD_RW
 0x4000

	)

387 
	#CDC_DVD
 0x8000

	)

388 
	#CDC_DVD_R
 0x10000

	)

389 
	#CDC_DVD_RAM
 0x20000

	)

390 
	#CDC_MO_DRIVE
 0x40000

	)

391 
	#CDC_MRW
 0x80000

	)

392 
	#CDC_MRW_W
 0x100000

	)

393 
	#CDC_RAM
 0x200000

	)

396 
	#CDS_NO_INFO
 0

	)

397 
	#CDS_NO_DISC
 1

	)

398 
	#CDS_TRAY_OPEN
 2

	)

399 
	#CDS_DRIVE_NOT_READY
 3

	)

400 
	#CDS_DISC_OK
 4

	)

404 
	#CDS_AUDIO
 100

	)

405 
	#CDS_DATA_1
 101

	)

406 
	#CDS_DATA_2
 102

	)

407 
	#CDS_XA_2_1
 103

	)

408 
	#CDS_XA_2_2
 104

	)

409 
	#CDS_MIXED
 105

	)

412 
	#CDO_AUTO_CLOSE
 0x1

	)

413 
	#CDO_AUTO_EJECT
 0x2

	)

414 
	#CDO_USE_FFLAGS
 0x4

	)

415 
	#CDO_LOCK
 0x8

	)

416 
	#CDO_CHECK_TYPE
 0x10

	)

419 
	#CDSL_NONE
 (
INT_MAX
-1)

	)

420 
	#CDSL_CURRENT
 
INT_MAX


	)

427 
	#CD_PART_MAX
 64

	)

428 
	#CD_PART_MASK
 (
CD_PART_MAX
 - 1)

	)

436 
	#GPCMD_BLANK
 0xa1

	)

437 
	#GPCMD_CLOSE_TRACK
 0x5b

	)

438 
	#GPCMD_FLUSH_CACHE
 0x35

	)

439 
	#GPCMD_FORMAT_UNIT
 0x04

	)

440 
	#GPCMD_GET_CONFIGURATION
 0x46

	)

441 
	#GPCMD_GET_EVENT_STATUS_NOTIFICATION
 0x4a

	)

442 
	#GPCMD_GET_PERFORMANCE
 0xac

	)

443 
	#GPCMD_INQUIRY
 0x12

	)

444 
	#GPCMD_LOAD_UNLOAD
 0xa6

	)

445 
	#GPCMD_MECHANISM_STATUS
 0xbd

	)

446 
	#GPCMD_MODE_SELECT_10
 0x55

	)

447 
	#GPCMD_MODE_SENSE_10
 0x5a

	)

448 
	#GPCMD_PAUSE_RESUME
 0x4b

	)

449 
	#GPCMD_PLAY_AUDIO_10
 0x45

	)

450 
	#GPCMD_PLAY_AUDIO_MSF
 0x47

	)

451 
	#GPCMD_PLAY_AUDIO_TI
 0x48

	)

452 
	#GPCMD_PLAY_CD
 0xbc

	)

453 
	#GPCMD_PREVENT_ALLOW_MEDIUM_REMOVAL
 0x1e

	)

454 
	#GPCMD_READ_10
 0x28

	)

455 
	#GPCMD_READ_12
 0xa8

	)

456 
	#GPCMD_READ_BUFFER
 0x3c

	)

457 
	#GPCMD_READ_BUFFER_CAPACITY
 0x5c

	)

458 
	#GPCMD_READ_CDVD_CAPACITY
 0x25

	)

459 
	#GPCMD_READ_CD
 0xbe

	)

460 
	#GPCMD_READ_CD_MSF
 0xb9

	)

461 
	#GPCMD_READ_DISC_INFO
 0x51

	)

462 
	#GPCMD_READ_DVD_STRUCTURE
 0xad

	)

463 
	#GPCMD_READ_FORMAT_CAPACITIES
 0x23

	)

464 
	#GPCMD_READ_HEADER
 0x44

	)

465 
	#GPCMD_READ_TRACK_RZONE_INFO
 0x52

	)

466 
	#GPCMD_READ_SUBCHANNEL
 0x42

	)

467 
	#GPCMD_READ_TOC_PMA_ATIP
 0x43

	)

468 
	#GPCMD_REPAIR_RZONE_TRACK
 0x58

	)

469 
	#GPCMD_REPORT_KEY
 0xa4

	)

470 
	#GPCMD_REQUEST_SENSE
 0x03

	)

471 
	#GPCMD_RESERVE_RZONE_TRACK
 0x53

	)

472 
	#GPCMD_SEND_CUE_SHEET
 0x5d

	)

473 
	#GPCMD_SCAN
 0xba

	)

474 
	#GPCMD_SEEK
 0x2b

	)

475 
	#GPCMD_SEND_DVD_STRUCTURE
 0xbf

	)

476 
	#GPCMD_SEND_EVENT
 0xa2

	)

477 
	#GPCMD_SEND_KEY
 0xa3

	)

478 
	#GPCMD_SEND_OPC
 0x54

	)

479 
	#GPCMD_SET_READ_AHEAD
 0xa7

	)

480 
	#GPCMD_SET_STREAMING
 0xb6

	)

481 
	#GPCMD_START_STOP_UNIT
 0x1b

	)

482 
	#GPCMD_STOP_PLAY_SCAN
 0x4e

	)

483 
	#GPCMD_TEST_UNIT_READY
 0x00

	)

484 
	#GPCMD_VERIFY_10
 0x2f

	)

485 
	#GPCMD_WRITE_10
 0x2a

	)

486 
	#GPCMD_WRITE_12
 0xØ

	)

487 
	#GPCMD_WRITE_AND_VERIFY_10
 0x2e

	)

488 
	#GPCMD_WRITE_BUFFER
 0x3b

	)

493 
	#GPCMD_SET_SPEED
 0xbb

	)

496 
	#GPCMD_PLAYAUDIO_TI
 0x48

	)

501 
	#GPCMD_GET_MEDIA_STATUS
 0xda

	)

504 
	#GPMODE_VENDOR_PAGE
 0x00

	)

505 
	#GPMODE_R_W_ERROR_PAGE
 0x01

	)

506 
	#GPMODE_WRITE_PARMS_PAGE
 0x05

	)

507 
	#GPMODE_WCACHING_PAGE
 0x08

	)

508 
	#GPMODE_AUDIO_CTL_PAGE
 0x0e

	)

509 
	#GPMODE_POWER_PAGE
 0x1a

	)

510 
	#GPMODE_FAULT_FAIL_PAGE
 0x1c

	)

511 
	#GPMODE_TO_PROTECT_PAGE
 0x1d

	)

512 
	#GPMODE_CAPABILITIES_PAGE
 0x2a

	)

513 
	#GPMODE_ALL_PAGES
 0x3f

	)

516 
	#GPMODE_CDROM_PAGE
 0x0d

	)

521 
	#DVD_STRUCT_PHYSICAL
 0x00

	)

522 
	#DVD_STRUCT_COPYRIGHT
 0x01

	)

523 
	#DVD_STRUCT_DISCKEY
 0x02

	)

524 
	#DVD_STRUCT_BCA
 0x03

	)

525 
	#DVD_STRUCT_MANUFACT
 0x04

	)

527 
	sdvd_œyî
 {

528 
__u8
 
	mbook_vîsi⁄
 : 4;

529 
__u8
 
	mbook_ty≥
 : 4;

530 
__u8
 
	mmö_øã
 : 4;

531 
__u8
 
	mdisc_size
 : 4;

532 
__u8
 
	mœyî_ty≥
 : 4;

533 
__u8
 
	måack_∑th
 : 1;

534 
__u8
 
	m∆ayîs
 : 2;

535 
__u8
 
	måack_dísôy
 : 4;

536 
__u8
 
	mlöór_dísôy
 : 4;

537 
__u8
 
	mbˇ
 : 1;

538 
__u32
 
	m°¨t_£˘‹
;

539 
__u32
 
	míd_£˘‹
;

540 
__u32
 
	míd_£˘‹_l0
;

543 
	#DVD_LAYERS
 4

	)

545 
	sdvd_physiˇl
 {

546 
__u8
 
	mty≥
;

547 
__u8
 
	mœyî_num
;

548 
dvd_œyî
 
	mœyî
[
DVD_LAYERS
];

551 
	sdvd_c›yright
 {

552 
__u8
 
	mty≥
;

554 
__u8
 
	mœyî_num
;

555 
__u8
 
	m˝°
;

556 
__u8
 
	mrmi
;

559 
	sdvd_disckey
 {

560 
__u8
 
	mty≥
;

562 
	magid
 : 2;

563 
__u8
 
	mvÆue
[2048];

566 
	sdvd_bˇ
 {

567 
__u8
 
	mty≥
;

569 
	mÀn
;

570 
__u8
 
	mvÆue
[188];

573 
	sdvd_m™uÁ˘
 {

574 
__u8
 
	mty≥
;

576 
__u8
 
	mœyî_num
;

577 
	mÀn
;

578 
__u8
 
	mvÆue
[2048];

582 
__u8
 
	mty≥
;

584 
dvd_physiˇl
 
	mphysiˇl
;

585 
dvd_c›yright
 
	mc›yright
;

586 
dvd_disckey
 
	mdisckey
;

587 
dvd_bˇ
 
	mbˇ
;

588 
dvd_m™uÁ˘
 
	mm™uÁ˘
;

589 } 
	tdvd_°ru˘
;

596 
	#DVD_LU_SEND_AGID
 0

	)

597 
	#DVD_HOST_SEND_CHALLENGE
 1

	)

598 
	#DVD_LU_SEND_KEY1
 2

	)

599 
	#DVD_LU_SEND_CHALLENGE
 3

	)

600 
	#DVD_HOST_SEND_KEY2
 4

	)

603 
	#DVD_AUTH_ESTABLISHED
 5

	)

604 
	#DVD_AUTH_FAILURE
 6

	)

607 
	#DVD_LU_SEND_TITLE_KEY
 7

	)

608 
	#DVD_LU_SEND_ASF
 8

	)

609 
	#DVD_INVALIDATE_AGID
 9

	)

610 
	#DVD_LU_SEND_RPC_STATE
 10

	)

611 
	#DVD_HOST_SEND_RPC_STATE
 11

	)

614 
__u8
 
	tdvd_key
[5];

615 
__u8
 
	tdvd_chÆÀnge
[10];

617 
	sdvd_lu_£nd_agid
 {

618 
__u8
 
	mty≥
;

619 
	magid
 : 2;

622 
	sdvd_ho°_£nd_chÆÀnge
 {

623 
__u8
 
	mty≥
;

624 
	magid
 : 2;

626 
dvd_chÆÀnge
 
	mchÆ
;

629 
	sdvd_£nd_key
 {

630 
__u8
 
	mty≥
;

631 
	magid
 : 2;

633 
dvd_key
 
	mkey
;

636 
	sdvd_lu_£nd_chÆÀnge
 {

637 
__u8
 
	mty≥
;

638 
	magid
 : 2;

640 
dvd_chÆÀnge
 
	mchÆ
;

643 
	#DVD_CPM_NO_COPYRIGHT
 0

	)

644 
	#DVD_CPM_COPYRIGHTED
 1

	)

646 
	#DVD_CP_SEC_NONE
 0

	)

647 
	#DVD_CP_SEC_EXIST
 1

	)

649 
	#DVD_CGMS_UNRESTRICTED
 0

	)

650 
	#DVD_CGMS_SINGLE
 2

	)

651 
	#DVD_CGMS_RESTRICTED
 3

	)

653 
	sdvd_lu_£nd_tôÀ_key
 {

654 
__u8
 
	mty≥
;

655 
	magid
 : 2;

657 
dvd_key
 
	mtôÀ_key
;

658 
	mlba
;

659 
	m˝m
 : 1;

660 
	m˝_£c
 : 1;

661 
	mcgms
 : 2;

664 
	sdvd_lu_£nd_asf
 {

665 
__u8
 
	mty≥
;

666 
	magid
 : 2;

668 
	masf
 : 1;

671 
	sdvd_ho°_£nd_Ωc°©e
 {

672 
__u8
 
	mty≥
;

673 
__u8
 
	mpdrc
;

676 
	sdvd_lu_£nd_Ωc°©e
 {

677 
__u8
 
	mty≥
 : 2;

678 
__u8
 
	mvø
 : 3;

679 
__u8
 
	mucˇ
 : 3;

680 
__u8
 
	mªgi⁄_mask
;

681 
__u8
 
	mΩc_scheme
;

685 
__u8
 
	mty≥
;

687 
dvd_lu_£nd_agid
 
	mlß
;

688 
dvd_ho°_£nd_chÆÀnge
 
	mhsc
;

689 
dvd_£nd_key
 
	mlsk
;

690 
dvd_lu_£nd_chÆÀnge
 
	mlsc
;

691 
dvd_£nd_key
 
	mhsk
;

692 
dvd_lu_£nd_tôÀ_key
 
	ml°k
;

693 
dvd_lu_£nd_asf
 
	mlßsf
;

694 
dvd_ho°_£nd_Ωc°©e
 
	mhΩcs
;

695 
dvd_lu_£nd_Ωc°©e
 
	mÃpcs
;

696 } 
	tdvd_authöfo
;

698 
	sªque°_£n£
 {

699 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

700 
__u8
 
	mvÆid
 : 1;

701 
__u8
 
	mîr‹_code
 : 7;

702 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

703 
__u8
 
	mîr‹_code
 : 7;

704 
__u8
 
	mvÆid
 : 1;

706 
__u8
 
	m£gmít_numbî
;

707 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

708 
__u8
 
	mª£rved1
 : 2;

709 
__u8
 
	mûi
 : 1;

710 
__u8
 
	mª£rved2
 : 1;

711 
__u8
 
	m£n£_key
 : 4;

712 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

713 
__u8
 
	m£n£_key
 : 4;

714 
__u8
 
	mª£rved2
 : 1;

715 
__u8
 
	mûi
 : 1;

716 
__u8
 
	mª£rved1
 : 2;

718 
__u8
 
	möf‹m©i⁄
[4];

719 
__u8
 
	madd_£n£_Àn
;

720 
__u8
 
	mcomm™d_öfo
[4];

721 
__u8
 
	masc
;

722 
__u8
 
	mascq
;

723 
__u8
 
	m‰uc
;

724 
__u8
 
	msks
[3];

725 
__u8
 
	masb
[46];

731 
	#CDF_RWRT
 0x0020

	)

732 
	#CDF_HWDM
 0x0024

	)

733 
	#CDF_MRW
 0x0028

	)

738 
	#CDM_MRW_NOTMRW
 0

	)

739 
	#CDM_MRW_BGFORMAT_INACTIVE
 1

	)

740 
	#CDM_MRW_BGFORMAT_ACTIVE
 2

	)

741 
	#CDM_MRW_BGFORMAT_COMPLETE
 3

	)

746 
	#MRW_LBA_DMA
 0

	)

747 
	#MRW_LBA_GAA
 1

	)

753 
	#MRW_MODE_PC_PRE1
 0x2c

	)

754 
	#MRW_MODE_PC
 0x03

	)

756 
	smrw_„©uª_desc
 {

757 
__be16
 
	m„©uª_code
;

758 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

759 
__u8
 
	mª£rved1
 : 2;

760 
__u8
 
	m„©uª_vîsi⁄
 : 4;

761 
__u8
 
	m≥rsi°ít
 : 1;

762 
__u8
 
	mcuº
 : 1;

763 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

764 
__u8
 
	mcuº
 : 1;

765 
__u8
 
	m≥rsi°ít
 : 1;

766 
__u8
 
	m„©uª_vîsi⁄
 : 4;

767 
__u8
 
	mª£rved1
 : 2;

769 
__u8
 
	madd_Àn
;

770 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

771 
__u8
 
	mª£rved2
 : 7;

772 
__u8
 
	mwrôe
 : 1;

773 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

774 
__u8
 
	mwrôe
 : 1;

775 
__u8
 
	mª£rved2
 : 7;

777 
__u8
 
	mª£rved3
;

778 
__u8
 
	mª£rved4
;

779 
__u8
 
	mª£rved5
;

783 
	srwπ_„©uª_desc
 {

784 
__be16
 
	m„©uª_code
;

785 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

786 
__u8
 
	mª£rved1
 : 2;

787 
__u8
 
	m„©uª_vîsi⁄
 : 4;

788 
__u8
 
	m≥rsi°ít
 : 1;

789 
__u8
 
	mcuº
 : 1;

790 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

791 
__u8
 
	mcuº
 : 1;

792 
__u8
 
	m≥rsi°ít
 : 1;

793 
__u8
 
	m„©uª_vîsi⁄
 : 4;

794 
__u8
 
	mª£rved1
 : 2;

796 
__u8
 
	madd_Àn
;

797 
__u32
 
	mœ°_lba
;

798 
__u32
 
	mblock_size
;

799 
__u16
 
	mblockög
;

800 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

801 
__u8
 
	mª£rved2
 : 7;

802 
__u8
 
	m∑ge_¥e£¡
 : 1;

803 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

804 
__u8
 
	m∑ge_¥e£¡
 : 1;

805 
__u8
 
	mª£rved2
 : 7;

807 
__u8
 
	mª£rved3
;

811 
__be16
 
	mdisc_öf‹m©i⁄_Àngth
;

812 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

813 
__u8
 
	mª£rved1
 : 3;

814 
__u8
 
	mîaßbÀ
 : 1;

815 
__u8
 
	mb‹dî_°©us
 : 2;

816 
__u8
 
	mdisc_°©us
 : 2;

817 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

818 
__u8
 
	mdisc_°©us
 : 2;

819 
__u8
 
	mb‹dî_°©us
 : 2;

820 
__u8
 
	mîaßbÀ
 : 1;

821 
__u8
 
	mª£rved1
 : 3;

825 
__u8
 
	mn_fú°_åack
;

826 
__u8
 
	mn_£ssi⁄s_lsb
;

827 
__u8
 
	mfú°_åack_lsb
;

828 
__u8
 
	mœ°_åack_lsb
;

829 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

830 
__u8
 
	mdid_v
 : 1;

831 
__u8
 
	mdbc_v
 : 1;

832 
__u8
 
	muru
 : 1;

833 
__u8
 
	mª£rved2
 : 2;

834 
__u8
 
	mdbô
 : 1;

835 
__u8
 
	mmrw_°©us
 : 2;

836 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

837 
__u8
 
	mmrw_°©us
 : 2;

838 
__u8
 
	mdbô
 : 1;

839 
__u8
 
	mª£rved2
 : 2;

840 
__u8
 
	muru
 : 1;

841 
__u8
 
	mdbc_v
 : 1;

842 
__u8
 
	mdid_v
 : 1;

844 
__u8
 
	mdisc_ty≥
;

845 
__u8
 
	mn_£ssi⁄s_msb
;

846 
__u8
 
	mfú°_åack_msb
;

847 
__u8
 
	mœ°_åack_msb
;

848 
__u32
 
	mdisc_id
;

849 
__u32
 
	mÀad_ö
;

850 
__u32
 
	mÀad_out
;

851 
__u8
 
	mdisc_b¨_code
[8];

852 
__u8
 
	mª£rved3
;

853 
__u8
 
	mn_›c
;

854 } 
	tdisc_öf‹m©i⁄
;

857 
__be16
 
	måack_öf‹m©i⁄_Àngth
;

858 
__u8
 
	måack_lsb
;

859 
__u8
 
	m£ssi⁄_lsb
;

860 
__u8
 
	mª£rved1
;

861 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

862 
__u8
 
	mª£rved2
 : 2;

863 
__u8
 
	mdamage
 : 1;

864 
__u8
 
	mc›y
 : 1;

865 
__u8
 
	måack_mode
 : 4;

866 
__u8
 
	mπ
 : 1;

867 
__u8
 
	mbœnk
 : 1;

868 
__u8
 
	m∑ckë
 : 1;

869 
__u8
 
	mÂ
 : 1;

870 
__u8
 
	md©a_mode
 : 4;

871 
__u8
 
	mª£rved3
 : 6;

872 
__u8
 
	mÃa_v
 : 1;

873 
__u8
 
	mnwa_v
 : 1;

874 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

875 
__u8
 
	måack_mode
 : 4;

876 
__u8
 
	mc›y
 : 1;

877 
__u8
 
	mdamage
 : 1;

878 
__u8
 
	mª£rved2
 : 2;

879 
__u8
 
	md©a_mode
 : 4;

880 
__u8
 
	mÂ
 : 1;

881 
__u8
 
	m∑ckë
 : 1;

882 
__u8
 
	mbœnk
 : 1;

883 
__u8
 
	mπ
 : 1;

884 
__u8
 
	mnwa_v
 : 1;

885 
__u8
 
	mÃa_v
 : 1;

886 
__u8
 
	mª£rved3
 : 6;

888 
__be32
 
	måack_°¨t
;

889 
__be32
 
	m√xt_wrôabÀ
;

890 
__be32
 
	m‰ì_blocks
;

891 
__be32
 
	mfixed_∑ckë_size
;

892 
__be32
 
	måack_size
;

893 
__be32
 
	mœ°_ªc_addªss
;

894 } 
	tåack_öf‹m©i⁄
;

896 
	s„©uª_hódî
 {

897 
__u32
 
	md©a_Àn
;

898 
__u8
 
	mª£rved1
;

899 
__u8
 
	mª£rved2
;

900 
__u16
 
	mcuº_¥ofûe
;

903 
	smode_∑ge_hódî
 {

904 
__be16
 
	mmode_d©a_Àngth
;

905 
__u8
 
	mmedium_ty≥
;

906 
__u8
 
	mª£rved1
;

907 
__u8
 
	mª£rved2
;

908 
__u8
 
	mª£rved3
;

909 
__be16
 
	mdesc_Àngth
;

913 
	srm_„©uª_desc
 {

914 
__be16
 
	m„©uª_code
;

915 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

916 
__u8
 
	mª£rved1
:2;

917 
__u8
 
	m„©uª_vîsi⁄
:4;

918 
__u8
 
	m≥rsi°ít
:1;

919 
__u8
 
	mcuº
:1;

920 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

921 
__u8
 
	mcuº
:1;

922 
__u8
 
	m≥rsi°ít
:1;

923 
__u8
 
	m„©uª_vîsi⁄
:4;

924 
__u8
 
	mª£rved1
:2;

926 
__u8
 
	madd_Àn
;

927 #i‡
deföed
(
__BIG_ENDIAN_BITFIELD
)

928 
__u8
 
	mmech_ty≥
:3;

929 
__u8
 
	mlﬂd
:1;

930 
__u8
 
	meje˘
:1;

931 
__u8
 
	mpv¡_jm¥
:1;

932 
__u8
 
	mdbml
:1;

933 
__u8
 
	mlock
:1;

934 #ñi‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

935 
__u8
 
	mlock
:1;

936 
__u8
 
	mdbml
:1;

937 
__u8
 
	mpv¡_jm¥
:1;

938 
__u8
 
	meje˘
:1;

939 
__u8
 
	mlﬂd
:1;

940 
__u8
 
	mmech_ty≥
:3;

942 
__u8
 
	mª£rved2
;

943 
__u8
 
	mª£rved3
;

944 
__u8
 
	mª£rved4
;

	@/usr/include/linux/errno.h

1 
	~<asm/î∫o.h
>

	@/usr/include/linux/ethtool.h

14 #i‚de‡
_LINUX_ETHTOOL_H


15 
	#_LINUX_ETHTOOL_H


	)

17 
	~<löux/c⁄°.h
>

18 
	~<löux/ty≥s.h
>

19 
	~<löux/if_ëhî.h
>

21 
	~<limôs.h
>

94 
	sëhtoﬁ_cmd
 {

95 
__u32
 
	mcmd
;

96 
__u32
 
	msuµ‹ãd
;

97 
__u32
 
	madvîtisög
;

98 
__u16
 
	m•ìd
;

99 
__u8
 
	mdu∂ex
;

100 
__u8
 
	mp‹t
;

101 
__u8
 
	mphy_addªss
;

102 
__u8
 
	må™s˚ivî
;

103 
__u8
 
	maut⁄eg
;

104 
__u8
 
	mmdio_suµ‹t
;

105 
__u32
 
	mmaxtxpkt
;

106 
__u32
 
	mmaxrxpkt
;

107 
__u16
 
	m•ìd_hi
;

108 
__u8
 
	mëh_ç_mdix
;

109 
__u8
 
	mëh_ç_mdix_˘æ
;

110 
__u32
 
	mÕ_advîtisög
;

111 
__u32
 
	mª£rved
[2];

114 
__ölöe__
 
	$ëhtoﬁ_cmd_•ìd_£t
(
ëhtoﬁ_cmd
 *
ï
,

115 
__u32
 
•ìd
)

117 
ï
->
•ìd
 = (
__u16
)(speed & 0xFFFF);

118 
ï
->
•ìd_hi
 = (
__u16
)(
•ìd
 >> 16);

119 
	}
}

121 
__ölöe__
 
__u32
 
	$ëhtoﬁ_cmd_•ìd
(c⁄° 
ëhtoﬁ_cmd
 *
ï
)

123  (
ï
->
•ìd_hi
 << 16Ë|Ép->
•ìd
;

124 
	}
}

131 
	#ETH_MDIO_SUPPORTS_C22
 1

	)

138 
	#ETH_MDIO_SUPPORTS_C45
 2

	)

140 
	#ETHTOOL_FWVERS_LEN
 32

	)

141 
	#ETHTOOL_BUSINFO_LEN
 32

	)

142 
	#ETHTOOL_EROMVERS_LEN
 32

	)

175 
	sëhtoﬁ_drvöfo
 {

176 
__u32
 
	mcmd
;

177 
	mdrivî
[32];

178 
	mvîsi⁄
[32];

179 
	mfw_vîsi⁄
[
ETHTOOL_FWVERS_LEN
];

180 
	mbus_öfo
[
ETHTOOL_BUSINFO_LEN
];

181 
	mîom_vîsi⁄
[
ETHTOOL_EROMVERS_LEN
];

182 
	mª£rved2
[12];

183 
__u32
 
	mn_¥iv_Êags
;

184 
__u32
 
	mn_°©s
;

185 
__u32
 
	mã°öfo_Àn
;

186 
__u32
 
	mìdump_Àn
;

187 
__u32
 
	mªgdump_Àn
;

190 
	#SOPASS_MAX
 6

	)

201 
	sëhtoﬁ_wﬁöfo
 {

202 
__u32
 
	mcmd
;

203 
__u32
 
	msuµ‹ãd
;

204 
__u32
 
	mwﬁ›ts
;

205 
__u8
 
	ms›ass
[
SOPASS_MAX
];

209 
	sëhtoﬁ_vÆue
 {

210 
__u32
 
	mcmd
;

211 
__u32
 
	md©a
;

214 
	#PFC_STORM_PREVENTION_AUTO
 0xffff

	)

215 
	#PFC_STORM_PREVENTION_DISABLE
 0

	)

217 
	etu«bÀ_id
 {

218 
	mETHTOOL_ID_UNSPEC
,

219 
	mETHTOOL_RX_COPYBREAK
,

220 
	mETHTOOL_TX_COPYBREAK
,

221 
	mETHTOOL_PFC_PREVENTION_TOUT
,

226 
	m__ETHTOOL_TUNABLE_COUNT
,

229 
	etu«bÀ_ty≥_id
 {

230 
	mETHTOOL_TUNABLE_UNSPEC
,

231 
	mETHTOOL_TUNABLE_U8
,

232 
	mETHTOOL_TUNABLE_U16
,

233 
	mETHTOOL_TUNABLE_U32
,

234 
	mETHTOOL_TUNABLE_U64
,

235 
	mETHTOOL_TUNABLE_STRING
,

236 
	mETHTOOL_TUNABLE_S8
,

237 
	mETHTOOL_TUNABLE_S16
,

238 
	mETHTOOL_TUNABLE_S32
,

239 
	mETHTOOL_TUNABLE_S64
,

242 
	sëhtoﬁ_tu«bÀ
 {

243 
__u32
 
	mcmd
;

244 
__u32
 
	mid
;

245 
__u32
 
	mty≥_id
;

246 
__u32
 
	mÀn
;

247 *
	md©a
[0];

250 
	#DOWNSHIFT_DEV_DEFAULT_COUNT
 0xff

	)

251 
	#DOWNSHIFT_DEV_DISABLE
 0

	)

257 
	#ETHTOOL_PHY_FAST_LINK_DOWN_ON
 0

	)

258 
	#ETHTOOL_PHY_FAST_LINK_DOWN_OFF
 0xff

	)

277 
	#ETHTOOL_PHY_EDPD_DFLT_TX_MSECS
 0xffff

	)

278 
	#ETHTOOL_PHY_EDPD_NO_TX
 0xff„

	)

279 
	#ETHTOOL_PHY_EDPD_DISABLE
 0

	)

281 
	ephy_tu«bÀ_id
 {

282 
	mETHTOOL_PHY_ID_UNSPEC
,

283 
	mETHTOOL_PHY_DOWNSHIFT
,

284 
	mETHTOOL_PHY_FAST_LINK_DOWN
,

285 
	mETHTOOL_PHY_EDPD
,

290 
	m__ETHTOOL_PHY_TUNABLE_COUNT
,

308 
	sëhtoﬁ_ªgs
 {

309 
__u32
 
	mcmd
;

310 
__u32
 
	mvîsi⁄
;

311 
__u32
 
	mÀn
;

312 
__u8
 
	md©a
[0];

333 
	sëhtoﬁ_ì¥om
 {

334 
__u32
 
	mcmd
;

335 
__u32
 
	mmagic
;

336 
__u32
 
	moff£t
;

337 
__u32
 
	mÀn
;

338 
__u8
 
	md©a
[0];

358 
	sëhtoﬁ_ìe
 {

359 
__u32
 
	mcmd
;

360 
__u32
 
	msuµ‹ãd
;

361 
__u32
 
	madvîti£d
;

362 
__u32
 
	mÕ_advîti£d
;

363 
__u32
 
	mìe_a˘ive
;

364 
__u32
 
	mìe_íabÀd
;

365 
__u32
 
	mtx_Õi_íabÀd
;

366 
__u32
 
	mtx_Õi_timî
;

367 
__u32
 
	mª£rved
[2];

380 
	sëhtoﬁ_modöfo
 {

381 
__u32
 
	mcmd
;

382 
__u32
 
	mty≥
;

383 
__u32
 
	mì¥om_Àn
;

384 
__u32
 
	mª£rved
[8];

460 
	sëhtoﬁ_cﬂÀs˚
 {

461 
__u32
 
	mcmd
;

462 
__u32
 
	mrx_cﬂÀs˚_u£cs
;

463 
__u32
 
	mrx_max_cﬂÀs˚d_‰ames
;

464 
__u32
 
	mrx_cﬂÀs˚_u£cs_úq
;

465 
__u32
 
	mrx_max_cﬂÀs˚d_‰ames_úq
;

466 
__u32
 
	mtx_cﬂÀs˚_u£cs
;

467 
__u32
 
	mtx_max_cﬂÀs˚d_‰ames
;

468 
__u32
 
	mtx_cﬂÀs˚_u£cs_úq
;

469 
__u32
 
	mtx_max_cﬂÀs˚d_‰ames_úq
;

470 
__u32
 
	m°©s_block_cﬂÀs˚_u£cs
;

471 
__u32
 
	mu£_ad≠tive_rx_cﬂÀs˚
;

472 
__u32
 
	mu£_ad≠tive_tx_cﬂÀs˚
;

473 
__u32
 
	mpkt_øã_low
;

474 
__u32
 
	mrx_cﬂÀs˚_u£cs_low
;

475 
__u32
 
	mrx_max_cﬂÀs˚d_‰ames_low
;

476 
__u32
 
	mtx_cﬂÀs˚_u£cs_low
;

477 
__u32
 
	mtx_max_cﬂÀs˚d_‰ames_low
;

478 
__u32
 
	mpkt_øã_high
;

479 
__u32
 
	mrx_cﬂÀs˚_u£cs_high
;

480 
__u32
 
	mrx_max_cﬂÀs˚d_‰ames_high
;

481 
__u32
 
	mtx_cﬂÀs˚_u£cs_high
;

482 
__u32
 
	mtx_max_cﬂÀs˚d_‰ames_high
;

483 
__u32
 
	møã_ßm∂e_öãrvÆ
;

511 
	sëhtoﬁ_rög∑øm
 {

512 
__u32
 
	mcmd
;

513 
__u32
 
	mrx_max_≥ndög
;

514 
__u32
 
	mrx_möi_max_≥ndög
;

515 
__u32
 
	mrx_jumbo_max_≥ndög
;

516 
__u32
 
	mtx_max_≥ndög
;

517 
__u32
 
	mrx_≥ndög
;

518 
__u32
 
	mrx_möi_≥ndög
;

519 
__u32
 
	mrx_jumbo_≥ndög
;

520 
__u32
 
	mtx_≥ndög
;

539 
	sëhtoﬁ_ch™√ls
 {

540 
__u32
 
	mcmd
;

541 
__u32
 
	mmax_rx
;

542 
__u32
 
	mmax_tx
;

543 
__u32
 
	mmax_Ÿhî
;

544 
__u32
 
	mmax_comböed
;

545 
__u32
 
	mrx_cou¡
;

546 
__u32
 
	mtx_cou¡
;

547 
__u32
 
	mŸhî_cou¡
;

548 
__u32
 
	mcomböed_cou¡
;

573 
	sëhtoﬁ_∑u£∑øm
 {

574 
__u32
 
	mcmd
;

575 
__u32
 
	maut⁄eg
;

576 
__u32
 
	mrx_∑u£
;

577 
__u32
 
	mtx_∑u£
;

580 
	#ETH_GSTRING_LEN
 32

	)

595 
	eëhtoﬁ_°rög£t
 {

596 
	mETH_SS_TEST
 = 0,

597 
	mETH_SS_STATS
,

598 
	mETH_SS_PRIV_FLAGS
,

599 
	mETH_SS_NTUPLE_FILTERS
,

600 
	mETH_SS_FEATURES
,

601 
	mETH_SS_RSS_HASH_FUNCS
,

602 
	mETH_SS_TUNABLES
,

603 
	mETH_SS_PHY_STATS
,

604 
	mETH_SS_PHY_TUNABLES
,

619 
	sëhtoﬁ_g°rögs
 {

620 
__u32
 
	mcmd
;

621 
__u32
 
	m°rög_£t
;

622 
__u32
 
	mÀn
;

623 
__u8
 
	md©a
[0];

643 
	sëhtoﬁ_s£t_öfo
 {

644 
__u32
 
	mcmd
;

645 
__u32
 
	mª£rved
;

646 
__u64
 
	ms£t_mask
;

647 
__u32
 
	md©a
[0];

660 
	eëhtoﬁ_ã°_Êags
 {

661 
	mETH_TEST_FL_OFFLINE
 = (1 << 0),

662 
	mETH_TEST_FL_FAILED
 = (1 << 1),

663 
	mETH_TEST_FL_EXTERNAL_LB
 = (1 << 2),

664 
	mETH_TEST_FL_EXTERNAL_LB_DONE
 = (1 << 3),

681 
	sëhtoﬁ_ã°
 {

682 
__u32
 
	mcmd
;

683 
__u32
 
	mÊags
;

684 
__u32
 
	mª£rved
;

685 
__u32
 
	mÀn
;

686 
__u64
 
	md©a
[0];

700 
	sëhtoﬁ_°©s
 {

701 
__u32
 
	mcmd
;

702 
__u32
 
	mn_°©s
;

703 
__u64
 
	md©a
[0];

717 
	sëhtoﬁ_≥rm_addr
 {

718 
__u32
 
	mcmd
;

719 
__u32
 
	msize
;

720 
__u8
 
	md©a
[0];

732 
	eëhtoﬁ_Êags
 {

733 
	mETH_FLAG_TXVLAN
 = (1 << 7),

734 
	mETH_FLAG_RXVLAN
 = (1 << 8),

735 
	mETH_FLAG_LRO
 = (1 << 15),

736 
	mETH_FLAG_NTUPLE
 = (1 << 27),

737 
	mETH_FLAG_RXHASH
 = (1 << 28),

756 
	sëhtoﬁ_t˝ù4_•ec
 {

757 
__be32
 
	mù4§c
;

758 
__be32
 
	mù4d°
;

759 
__be16
 
	mp§c
;

760 
__be16
 
	mpd°
;

761 
__u8
 
	mtos
;

773 
	sëhtoﬁ_ah_e•ù4_•ec
 {

774 
__be32
 
	mù4§c
;

775 
__be32
 
	mù4d°
;

776 
__be32
 
	m•i
;

777 
__u8
 
	mtos
;

780 
	#ETH_RX_NFC_IP4
 1

	)

791 
	sëhtoﬁ_u§ù4_•ec
 {

792 
__be32
 
	mù4§c
;

793 
__be32
 
	mù4d°
;

794 
__be32
 
	ml4_4_byãs
;

795 
__u8
 
	mtos
;

796 
__u8
 
	mù_vî
;

797 
__u8
 
	m¥Ÿo
;

810 
	sëhtoﬁ_t˝ù6_•ec
 {

811 
__be32
 
	mù6§c
[4];

812 
__be32
 
	mù6d°
[4];

813 
__be16
 
	mp§c
;

814 
__be16
 
	mpd°
;

815 
__u8
 
	mt˛ass
;

827 
	sëhtoﬁ_ah_e•ù6_•ec
 {

828 
__be32
 
	mù6§c
[4];

829 
__be32
 
	mù6d°
[4];

830 
__be32
 
	m•i
;

831 
__u8
 
	mt˛ass
;

842 
	sëhtoﬁ_u§ù6_•ec
 {

843 
__be32
 
	mù6§c
[4];

844 
__be32
 
	mù6d°
[4];

845 
__be32
 
	ml4_4_byãs
;

846 
__u8
 
	mt˛ass
;

847 
__u8
 
	ml4_¥Ÿo
;

850 
	uëhtoﬁ_Êow_uni⁄
 {

851 
ëhtoﬁ_t˝ù4_•ec
 
	mt˝_ù4_•ec
;

852 
ëhtoﬁ_t˝ù4_•ec
 
	mudp_ù4_•ec
;

853 
ëhtoﬁ_t˝ù4_•ec
 
	ms˘p_ù4_•ec
;

854 
ëhtoﬁ_ah_e•ù4_•ec
 
	mah_ù4_•ec
;

855 
ëhtoﬁ_ah_e•ù4_•ec
 
	me•_ù4_•ec
;

856 
ëhtoﬁ_u§ù4_•ec
 
	mu§_ù4_•ec
;

857 
ëhtoﬁ_t˝ù6_•ec
 
	mt˝_ù6_•ec
;

858 
ëhtoﬁ_t˝ù6_•ec
 
	mudp_ù6_•ec
;

859 
ëhtoﬁ_t˝ù6_•ec
 
	ms˘p_ù6_•ec
;

860 
ëhtoﬁ_ah_e•ù6_•ec
 
	mah_ù6_•ec
;

861 
ëhtoﬁ_ah_e•ù6_•ec
 
	me•_ù6_•ec
;

862 
ëhtoﬁ_u§ù6_•ec
 
	mu§_ù6_•ec
;

863 
ëhhdr
 
	mëhî_•ec
;

864 
__u8
 
	mhd©a
[52];

878 
	sëhtoﬁ_Êow_ext
 {

879 
__u8
 
	m∑ddög
[2];

880 
	mh_de°
[
ETH_ALEN
];

881 
__be16
 
	mvœn_ëy≥
;

882 
__be16
 
	mvœn_tci
;

883 
__be32
 
	md©a
[2];

903 
	sëhtoﬁ_rx_Êow_•ec
 {

904 
__u32
 
	mÊow_ty≥
;

905 
ëhtoﬁ_Êow_uni⁄
 
	mh_u
;

906 
ëhtoﬁ_Êow_ext
 
	mh_ext
;

907 
ëhtoﬁ_Êow_uni⁄
 
	mm_u
;

908 
ëhtoﬁ_Êow_ext
 
	mm_ext
;

909 
__u64
 
	mrög_cookõ
;

910 
__u32
 
	mloˇti⁄
;

924 
	#ETHTOOL_RX_FLOW_SPEC_RING
 0x00000000FFFFFFFFLL

	)

925 
	#ETHTOOL_RX_FLOW_SPEC_RING_VF
 0x000000FF00000000LL

	)

926 
	#ETHTOOL_RX_FLOW_SPEC_RING_VF_OFF
 32

	)

927 
__ölöe__
 
__u64
 
	$ëhtoﬁ_gë_Êow_•ec_rög
(
__u64
 
rög_cookõ
)

929  
ETHTOOL_RX_FLOW_SPEC_RING
 & 
rög_cookõ
;

930 
	}
}

932 
__ölöe__
 
__u64
 
	$ëhtoﬁ_gë_Êow_•ec_rög_vf
(
__u64
 
rög_cookõ
)

934  (
ETHTOOL_RX_FLOW_SPEC_RING_VF
 & 
rög_cookõ
) >>

935 
ETHTOOL_RX_FLOW_SPEC_RING_VF_OFF
;

936 
	}
}

999 
	sëhtoﬁ_rxnfc
 {

1000 
__u32
 
	mcmd
;

1001 
__u32
 
	mÊow_ty≥
;

1002 
__u64
 
	md©a
;

1003 
ëhtoﬁ_rx_Êow_•ec
 
	mfs
;

1005 
__u32
 
	mruÀ_˙t
;

1006 
__u32
 
	mrss_c⁄ãxt
;

1008 
__u32
 
	mruÀ_locs
[0];

1025 
	sëhtoﬁ_rxfh_ödú
 {

1026 
__u32
 
	mcmd
;

1027 
__u32
 
	msize
;

1028 
__u32
 
	mrög_ödex
[0];

1060 
	sëhtoﬁ_rxfh
 {

1061 
__u32
 
	mcmd
;

1062 
__u32
 
	mrss_c⁄ãxt
;

1063 
__u32
 
	mödú_size
;

1064 
__u32
 
	mkey_size
;

1065 
__u8
 
	mhfunc
;

1066 
__u8
 
	mrsvd8
[3];

1067 
__u32
 
	mrsvd32
;

1068 
__u32
 
	mrss_c⁄fig
[0];

1070 
	#ETH_RXFH_CONTEXT_ALLOC
 0xffffffff

	)

1071 
	#ETH_RXFH_INDIR_NO_CHANGE
 0xffffffff

	)

1089 
	sëhtoﬁ_rx_¡u∂e_Êow_•ec
 {

1090 
__u32
 
	mÊow_ty≥
;

1092 
ëhtoﬁ_t˝ù4_•ec
 
	mt˝_ù4_•ec
;

1093 
ëhtoﬁ_t˝ù4_•ec
 
	mudp_ù4_•ec
;

1094 
ëhtoﬁ_t˝ù4_•ec
 
	ms˘p_ù4_•ec
;

1095 
ëhtoﬁ_ah_e•ù4_•ec
 
	mah_ù4_•ec
;

1096 
ëhtoﬁ_ah_e•ù4_•ec
 
	me•_ù4_•ec
;

1097 
ëhtoﬁ_u§ù4_•ec
 
	mu§_ù4_•ec
;

1098 
ëhhdr
 
	mëhî_•ec
;

1099 
__u8
 
	mhd©a
[72];

1100 } 
	mh_u
, 
	mm_u
;

1102 
__u16
 
	mvœn_èg
;

1103 
__u16
 
	mvœn_èg_mask
;

1104 
__u64
 
	md©a
;

1105 
__u64
 
	md©a_mask
;

1107 
__s32
 
	ma˘i⁄
;

1108 
	#ETHTOOL_RXNTUPLE_ACTION_DROP
 (-1Ë

	)

1109 
	#ETHTOOL_RXNTUPLE_ACTION_CLEAR
 (-2Ë

	)

1117 
	sëhtoﬁ_rx_¡u∂e
 {

1118 
__u32
 
	mcmd
;

1119 
ëhtoﬁ_rx_¡u∂e_Êow_•ec
 
	mfs
;

1122 
	#ETHTOOL_FLASH_MAX_FILENAME
 128

	)

1123 
	eëhtoﬁ_Êash_›_ty≥
 {

1124 
	mETHTOOL_FLASH_ALL_REGIONS
 = 0,

1128 
	sëhtoﬁ_Êash
 {

1129 
__u32
 
	mcmd
;

1130 
__u32
 
	mªgi⁄
;

1131 
	md©a
[
ETHTOOL_FLASH_MAX_FILENAME
];

1148 
	sëhtoﬁ_dump
 {

1149 
__u32
 
	mcmd
;

1150 
__u32
 
	mvîsi⁄
;

1151 
__u32
 
	mÊag
;

1152 
__u32
 
	mÀn
;

1153 
__u8
 
	md©a
[0];

1156 
	#ETH_FW_DUMP_DISABLE
 0

	)

1167 
	sëhtoﬁ_gë_„©uªs_block
 {

1168 
__u32
 
	mavaûabÀ
;

1169 
__u32
 
	mªque°ed
;

1170 
__u32
 
	ma˘ive
;

1171 
__u32
 
	m√vî_ch™ged
;

1182 
	sëhtoﬁ_g„©uªs
 {

1183 
__u32
 
	mcmd
;

1184 
__u32
 
	msize
;

1185 
ëhtoﬁ_gë_„©uªs_block
 
	m„©uªs
[0];

1193 
	sëhtoﬁ_£t_„©uªs_block
 {

1194 
__u32
 
	mvÆid
;

1195 
__u32
 
	mªque°ed
;

1204 
	sëhtoﬁ_s„©uªs
 {

1205 
__u32
 
	mcmd
;

1206 
__u32
 
	msize
;

1207 
ëhtoﬁ_£t_„©uªs_block
 
	m„©uªs
[0];

1228 
	sëhtoﬁ_ts_öfo
 {

1229 
__u32
 
	mcmd
;

1230 
__u32
 
	mso_time°ampög
;

1231 
__s32
 
	mphc_ödex
;

1232 
__u32
 
	mtx_ty≥s
;

1233 
__u32
 
	mtx_ª£rved
[3];

1234 
__u32
 
	mrx_fûãrs
;

1235 
__u32
 
	mrx_ª£rved
[3];

1263 
	eëhtoﬁ_s„©uªs_ªtvÆ_bôs
 {

1264 
	mETHTOOL_F_UNSUPPORTED__BIT
,

1265 
	mETHTOOL_F_WISH__BIT
,

1266 
	mETHTOOL_F_COMPAT__BIT
,

1269 
	#ETHTOOL_F_UNSUPPORTED
 (1 << 
ETHTOOL_F_UNSUPPORTED__BIT
)

	)

1270 
	#ETHTOOL_F_WISH
 (1 << 
ETHTOOL_F_WISH__BIT
)

	)

1271 
	#ETHTOOL_F_COMPAT
 (1 << 
ETHTOOL_F_COMPAT__BIT
)

	)

1273 
	#MAX_NUM_QUEUE
 4096

	)

1282 
	sëhtoﬁ_≥r_queue_›
 {

1283 
__u32
 
	mcmd
;

1284 
__u32
 
	msub_comm™d
;

1285 
__u32
 
	mqueue_mask
[
__KERNEL_DIV_ROUND_UP
(
MAX_NUM_QUEUE
, 32)];

1286 
	md©a
[];

1300 
	sëhtoﬁ_„˝¨am
 {

1301 
__u32
 
	mcmd
;

1303 
__u32
 
	ma˘ive_„c
;

1304 
__u32
 
	m„c
;

1305 
__u32
 
	mª£rved
;

1316 
	eëhtoﬁ_„c_c⁄fig_bôs
 {

1317 
	mETHTOOL_FEC_NONE_BIT
,

1318 
	mETHTOOL_FEC_AUTO_BIT
,

1319 
	mETHTOOL_FEC_OFF_BIT
,

1320 
	mETHTOOL_FEC_RS_BIT
,

1321 
	mETHTOOL_FEC_BASER_BIT
,

1324 
	#ETHTOOL_FEC_NONE
 (1 << 
ETHTOOL_FEC_NONE_BIT
)

	)

1325 
	#ETHTOOL_FEC_AUTO
 (1 << 
ETHTOOL_FEC_AUTO_BIT
)

	)

1326 
	#ETHTOOL_FEC_OFF
 (1 << 
ETHTOOL_FEC_OFF_BIT
)

	)

1327 
	#ETHTOOL_FEC_RS
 (1 << 
ETHTOOL_FEC_RS_BIT
)

	)

1328 
	#ETHTOOL_FEC_BASER
 (1 << 
ETHTOOL_FEC_BASER_BIT
)

	)

1331 
	#ETHTOOL_GSET
 0x00000001

	)

1334 
	#ETHTOOL_SSET
 0x00000002

	)

1337 
	#ETHTOOL_GDRVINFO
 0x00000003

	)

1338 
	#ETHTOOL_GREGS
 0x00000004

	)

1339 
	#ETHTOOL_GWOL
 0x00000005

	)

1340 
	#ETHTOOL_SWOL
 0x00000006

	)

1341 
	#ETHTOOL_GMSGLVL
 0x00000007

	)

1342 
	#ETHTOOL_SMSGLVL
 0x00000008

	)

1343 
	#ETHTOOL_NWAY_RST
 0x00000009

	)

1346 
	#ETHTOOL_GLINK
 0x0000000a

	)

1347 
	#ETHTOOL_GEEPROM
 0x0000000b

	)

1348 
	#ETHTOOL_SEEPROM
 0x0000000¯

	)

1349 
	#ETHTOOL_GCOALESCE
 0x0000000ê

	)

1350 
	#ETHTOOL_SCOALESCE
 0x0000000‡

	)

1351 
	#ETHTOOL_GRINGPARAM
 0x00000010

	)

1352 
	#ETHTOOL_SRINGPARAM
 0x00000011

	)

1353 
	#ETHTOOL_GPAUSEPARAM
 0x00000012

	)

1354 
	#ETHTOOL_SPAUSEPARAM
 0x00000013

	)

1355 
	#ETHTOOL_GRXCSUM
 0x00000014

	)

1356 
	#ETHTOOL_SRXCSUM
 0x00000015

	)

1357 
	#ETHTOOL_GTXCSUM
 0x00000016

	)

1358 
	#ETHTOOL_STXCSUM
 0x00000017

	)

1359 
	#ETHTOOL_GSG
 0x00000018

	)

1361 
	#ETHTOOL_SSG
 0x00000019

	)

1363 
	#ETHTOOL_TEST
 0x0000001®

	)

1364 
	#ETHTOOL_GSTRINGS
 0x0000001b

	)

1365 
	#ETHTOOL_PHYS_ID
 0x0000001¯

	)

1366 
	#ETHTOOL_GSTATS
 0x0000001d

	)

1367 
	#ETHTOOL_GTSO
 0x0000001ê

	)

1368 
	#ETHTOOL_STSO
 0x0000001‡

	)

1369 
	#ETHTOOL_GPERMADDR
 0x00000020

	)

1370 
	#ETHTOOL_GUFO
 0x00000021

	)

1371 
	#ETHTOOL_SUFO
 0x00000022

	)

1372 
	#ETHTOOL_GGSO
 0x00000023

	)

1373 
	#ETHTOOL_SGSO
 0x00000024

	)

1374 
	#ETHTOOL_GFLAGS
 0x00000025

	)

1375 
	#ETHTOOL_SFLAGS
 0x00000026

	)

1376 
	#ETHTOOL_GPFLAGS
 0x00000027

	)

1377 
	#ETHTOOL_SPFLAGS
 0x00000028

	)

1379 
	#ETHTOOL_GRXFH
 0x00000029

	)

1380 
	#ETHTOOL_SRXFH
 0x0000002®

	)

1381 
	#ETHTOOL_GGRO
 0x0000002b

	)

1382 
	#ETHTOOL_SGRO
 0x0000002¯

	)

1383 
	#ETHTOOL_GRXRINGS
 0x0000002d

	)

1384 
	#ETHTOOL_GRXCLSRLCNT
 0x0000002ê

	)

1385 
	#ETHTOOL_GRXCLSRULE
 0x0000002‡

	)

1386 
	#ETHTOOL_GRXCLSRLALL
 0x00000030

	)

1387 
	#ETHTOOL_SRXCLSRLDEL
 0x00000031

	)

1388 
	#ETHTOOL_SRXCLSRLINS
 0x00000032

	)

1389 
	#ETHTOOL_FLASHDEV
 0x00000033

	)

1390 
	#ETHTOOL_RESET
 0x00000034

	)

1391 
	#ETHTOOL_SRXNTUPLE
 0x00000035

	)

1392 
	#ETHTOOL_GRXNTUPLE
 0x00000036

	)

1393 
	#ETHTOOL_GSSET_INFO
 0x00000037

	)

1394 
	#ETHTOOL_GRXFHINDIR
 0x00000038

	)

1395 
	#ETHTOOL_SRXFHINDIR
 0x00000039

	)

1397 
	#ETHTOOL_GFEATURES
 0x0000003®

	)

1398 
	#ETHTOOL_SFEATURES
 0x0000003b

	)

1399 
	#ETHTOOL_GCHANNELS
 0x0000003¯

	)

1400 
	#ETHTOOL_SCHANNELS
 0x0000003d

	)

1401 
	#ETHTOOL_SET_DUMP
 0x0000003ê

	)

1402 
	#ETHTOOL_GET_DUMP_FLAG
 0x0000003‡

	)

1403 
	#ETHTOOL_GET_DUMP_DATA
 0x00000040

	)

1404 
	#ETHTOOL_GET_TS_INFO
 0x00000041

	)

1405 
	#ETHTOOL_GMODULEINFO
 0x00000042

	)

1406 
	#ETHTOOL_GMODULEEEPROM
 0x00000043

	)

1407 
	#ETHTOOL_GEEE
 0x00000044

	)

1408 
	#ETHTOOL_SEEE
 0x00000045

	)

1410 
	#ETHTOOL_GRSSH
 0x00000046

	)

1411 
	#ETHTOOL_SRSSH
 0x00000047

	)

1412 
	#ETHTOOL_GTUNABLE
 0x00000048

	)

1413 
	#ETHTOOL_STUNABLE
 0x00000049

	)

1414 
	#ETHTOOL_GPHYSTATS
 0x0000004®

	)

1416 
	#ETHTOOL_PERQUEUE
 0x0000004b

	)

1418 
	#ETHTOOL_GLINKSETTINGS
 0x0000004¯

	)

1419 
	#ETHTOOL_SLINKSETTINGS
 0x0000004d

	)

1420 
	#ETHTOOL_PHY_GTUNABLE
 0x0000004ê

	)

1421 
	#ETHTOOL_PHY_STUNABLE
 0x0000004‡

	)

1422 
	#ETHTOOL_GFECPARAM
 0x00000050

	)

1423 
	#ETHTOOL_SFECPARAM
 0x00000051

	)

1426 
	#SPARC_ETH_GSET
 
ETHTOOL_GSET


	)

1427 
	#SPARC_ETH_SSET
 
ETHTOOL_SSET


	)

1430 
	eëhtoﬁ_lök_mode_bô_ödi˚s
 {

1431 
	mETHTOOL_LINK_MODE_10ba£T_HÆf_BIT
 = 0,

1432 
	mETHTOOL_LINK_MODE_10ba£T_FuŒ_BIT
 = 1,

1433 
	mETHTOOL_LINK_MODE_100ba£T_HÆf_BIT
 = 2,

1434 
	mETHTOOL_LINK_MODE_100ba£T_FuŒ_BIT
 = 3,

1435 
	mETHTOOL_LINK_MODE_1000ba£T_HÆf_BIT
 = 4,

1436 
	mETHTOOL_LINK_MODE_1000ba£T_FuŒ_BIT
 = 5,

1437 
	mETHTOOL_LINK_MODE_Aut⁄eg_BIT
 = 6,

1438 
	mETHTOOL_LINK_MODE_TP_BIT
 = 7,

1439 
	mETHTOOL_LINK_MODE_AUI_BIT
 = 8,

1440 
	mETHTOOL_LINK_MODE_MII_BIT
 = 9,

1441 
	mETHTOOL_LINK_MODE_FIBRE_BIT
 = 10,

1442 
	mETHTOOL_LINK_MODE_BNC_BIT
 = 11,

1443 
	mETHTOOL_LINK_MODE_10000ba£T_FuŒ_BIT
 = 12,

1444 
	mETHTOOL_LINK_MODE_Pau£_BIT
 = 13,

1445 
	mETHTOOL_LINK_MODE_Asym_Pau£_BIT
 = 14,

1446 
	mETHTOOL_LINK_MODE_2500ba£X_FuŒ_BIT
 = 15,

1447 
	mETHTOOL_LINK_MODE_Back∂™e_BIT
 = 16,

1448 
	mETHTOOL_LINK_MODE_1000ba£KX_FuŒ_BIT
 = 17,

1449 
	mETHTOOL_LINK_MODE_10000ba£KX4_FuŒ_BIT
 = 18,

1450 
	mETHTOOL_LINK_MODE_10000ba£KR_FuŒ_BIT
 = 19,

1451 
	mETHTOOL_LINK_MODE_10000ba£R_FEC_BIT
 = 20,

1452 
	mETHTOOL_LINK_MODE_20000ba£MLD2_FuŒ_BIT
 = 21,

1453 
	mETHTOOL_LINK_MODE_20000ba£KR2_FuŒ_BIT
 = 22,

1454 
	mETHTOOL_LINK_MODE_40000ba£KR4_FuŒ_BIT
 = 23,

1455 
	mETHTOOL_LINK_MODE_40000ba£CR4_FuŒ_BIT
 = 24,

1456 
	mETHTOOL_LINK_MODE_40000ba£SR4_FuŒ_BIT
 = 25,

1457 
	mETHTOOL_LINK_MODE_40000ba£LR4_FuŒ_BIT
 = 26,

1458 
	mETHTOOL_LINK_MODE_56000ba£KR4_FuŒ_BIT
 = 27,

1459 
	mETHTOOL_LINK_MODE_56000ba£CR4_FuŒ_BIT
 = 28,

1460 
	mETHTOOL_LINK_MODE_56000ba£SR4_FuŒ_BIT
 = 29,

1461 
	mETHTOOL_LINK_MODE_56000ba£LR4_FuŒ_BIT
 = 30,

1462 
	mETHTOOL_LINK_MODE_25000ba£CR_FuŒ_BIT
 = 31,

1470 
	mETHTOOL_LINK_MODE_25000ba£KR_FuŒ_BIT
 = 32,

1471 
	mETHTOOL_LINK_MODE_25000ba£SR_FuŒ_BIT
 = 33,

1472 
	mETHTOOL_LINK_MODE_50000ba£CR2_FuŒ_BIT
 = 34,

1473 
	mETHTOOL_LINK_MODE_50000ba£KR2_FuŒ_BIT
 = 35,

1474 
	mETHTOOL_LINK_MODE_100000ba£KR4_FuŒ_BIT
 = 36,

1475 
	mETHTOOL_LINK_MODE_100000ba£SR4_FuŒ_BIT
 = 37,

1476 
	mETHTOOL_LINK_MODE_100000ba£CR4_FuŒ_BIT
 = 38,

1477 
	mETHTOOL_LINK_MODE_100000ba£LR4_ER4_FuŒ_BIT
 = 39,

1478 
	mETHTOOL_LINK_MODE_50000ba£SR2_FuŒ_BIT
 = 40,

1479 
	mETHTOOL_LINK_MODE_1000ba£X_FuŒ_BIT
 = 41,

1480 
	mETHTOOL_LINK_MODE_10000ba£CR_FuŒ_BIT
 = 42,

1481 
	mETHTOOL_LINK_MODE_10000ba£SR_FuŒ_BIT
 = 43,

1482 
	mETHTOOL_LINK_MODE_10000ba£LR_FuŒ_BIT
 = 44,

1483 
	mETHTOOL_LINK_MODE_10000ba£LRM_FuŒ_BIT
 = 45,

1484 
	mETHTOOL_LINK_MODE_10000ba£ER_FuŒ_BIT
 = 46,

1485 
	mETHTOOL_LINK_MODE_2500ba£T_FuŒ_BIT
 = 47,

1486 
	mETHTOOL_LINK_MODE_5000ba£T_FuŒ_BIT
 = 48,

1488 
	mETHTOOL_LINK_MODE_FEC_NONE_BIT
 = 49,

1489 
	mETHTOOL_LINK_MODE_FEC_RS_BIT
 = 50,

1490 
	mETHTOOL_LINK_MODE_FEC_BASER_BIT
 = 51,

1491 
	mETHTOOL_LINK_MODE_50000ba£KR_FuŒ_BIT
 = 52,

1492 
	mETHTOOL_LINK_MODE_50000ba£SR_FuŒ_BIT
 = 53,

1493 
	mETHTOOL_LINK_MODE_50000ba£CR_FuŒ_BIT
 = 54,

1494 
	mETHTOOL_LINK_MODE_50000ba£LR_ER_FR_FuŒ_BIT
 = 55,

1495 
	mETHTOOL_LINK_MODE_50000ba£DR_FuŒ_BIT
 = 56,

1496 
	mETHTOOL_LINK_MODE_100000ba£KR2_FuŒ_BIT
 = 57,

1497 
	mETHTOOL_LINK_MODE_100000ba£SR2_FuŒ_BIT
 = 58,

1498 
	mETHTOOL_LINK_MODE_100000ba£CR2_FuŒ_BIT
 = 59,

1499 
	mETHTOOL_LINK_MODE_100000ba£LR2_ER2_FR2_FuŒ_BIT
 = 60,

1500 
	mETHTOOL_LINK_MODE_100000ba£DR2_FuŒ_BIT
 = 61,

1501 
	mETHTOOL_LINK_MODE_200000ba£KR4_FuŒ_BIT
 = 62,

1502 
	mETHTOOL_LINK_MODE_200000ba£SR4_FuŒ_BIT
 = 63,

1503 
	mETHTOOL_LINK_MODE_200000ba£LR4_ER4_FR4_FuŒ_BIT
 = 64,

1504 
	mETHTOOL_LINK_MODE_200000ba£DR4_FuŒ_BIT
 = 65,

1505 
	mETHTOOL_LINK_MODE_200000ba£CR4_FuŒ_BIT
 = 66,

1506 
	mETHTOOL_LINK_MODE_100ba£T1_FuŒ_BIT
 = 67,

1507 
	mETHTOOL_LINK_MODE_1000ba£T1_FuŒ_BIT
 = 68,

1510 
	m__ETHTOOL_LINK_MODE_MASK_NBITS


1513 
	#__ETHTOOL_LINK_MODE_LEGACY_MASK
(
ba£_«me
) \

1514 (1UL << (
ETHTOOL_LINK_MODE_
 ## 
ba£_«me
 ## 
_BIT
))

	)

1520 
	#SUPPORTED_10ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_HÆf
)

	)

1521 
	#SUPPORTED_10ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_FuŒ
)

	)

1522 
	#SUPPORTED_100ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_HÆf
)

	)

1523 
	#SUPPORTED_100ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_FuŒ
)

	)

1524 
	#SUPPORTED_1000ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_HÆf
)

	)

1525 
	#SUPPORTED_1000ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_FuŒ
)

	)

1526 
	#SUPPORTED_Aut⁄eg
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Aut⁄eg
)

	)

1527 
	#SUPPORTED_TP
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
TP
)

	)

1528 
	#SUPPORTED_AUI
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
AUI
)

	)

1529 
	#SUPPORTED_MII
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
MII
)

	)

1530 
	#SUPPORTED_FIBRE
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
FIBRE
)

	)

1531 
	#SUPPORTED_BNC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
BNC
)

	)

1532 
	#SUPPORTED_10000ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£T_FuŒ
)

	)

1533 
	#SUPPORTED_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Pau£
)

	)

1534 
	#SUPPORTED_Asym_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Asym_Pau£
)

	)

1535 
	#SUPPORTED_2500ba£X_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(2500ba
£X_FuŒ
)

	)

1536 
	#SUPPORTED_Back∂™e
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Back∂™e
)

	)

1537 
	#SUPPORTED_1000ba£KX_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£KX_FuŒ
)

	)

1538 
	#SUPPORTED_10000ba£KX4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KX4_FuŒ
)

	)

1539 
	#SUPPORTED_10000ba£KR_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KR_FuŒ
)

	)

1540 
	#SUPPORTED_10000ba£R_FEC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£R_FEC
)

	)

1541 
	#SUPPORTED_20000ba£MLD2_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£MLD2_FuŒ
)

	)

1542 
	#SUPPORTED_20000ba£KR2_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£KR2_FuŒ
)

	)

1543 
	#SUPPORTED_40000ba£KR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£KR4_FuŒ
)

	)

1544 
	#SUPPORTED_40000ba£CR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£CR4_FuŒ
)

	)

1545 
	#SUPPORTED_40000ba£SR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£SR4_FuŒ
)

	)

1546 
	#SUPPORTED_40000ba£LR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£LR4_FuŒ
)

	)

1547 
	#SUPPORTED_56000ba£KR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£KR4_FuŒ
)

	)

1548 
	#SUPPORTED_56000ba£CR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£CR4_FuŒ
)

	)

1549 
	#SUPPORTED_56000ba£SR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£SR4_FuŒ
)

	)

1550 
	#SUPPORTED_56000ba£LR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£LR4_FuŒ
)

	)

1560 
	#ADVERTISED_10ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_HÆf
)

	)

1561 
	#ADVERTISED_10ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10ba
£T_FuŒ
)

	)

1562 
	#ADVERTISED_100ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_HÆf
)

	)

1563 
	#ADVERTISED_100ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(100ba
£T_FuŒ
)

	)

1564 
	#ADVERTISED_1000ba£T_HÆf
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_HÆf
)

	)

1565 
	#ADVERTISED_1000ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£T_FuŒ
)

	)

1566 
	#ADVERTISED_Aut⁄eg
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Aut⁄eg
)

	)

1567 
	#ADVERTISED_TP
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
TP
)

	)

1568 
	#ADVERTISED_AUI
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
AUI
)

	)

1569 
	#ADVERTISED_MII
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
MII
)

	)

1570 
	#ADVERTISED_FIBRE
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
FIBRE
)

	)

1571 
	#ADVERTISED_BNC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
BNC
)

	)

1572 
	#ADVERTISED_10000ba£T_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£T_FuŒ
)

	)

1573 
	#ADVERTISED_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Pau£
)

	)

1574 
	#ADVERTISED_Asym_Pau£
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Asym_Pau£
)

	)

1575 
	#ADVERTISED_2500ba£X_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(2500ba
£X_FuŒ
)

	)

1576 
	#ADVERTISED_Back∂™e
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(
Back∂™e
)

	)

1577 
	#ADVERTISED_1000ba£KX_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(1000ba
£KX_FuŒ
)

	)

1578 
	#ADVERTISED_10000ba£KX4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KX4_FuŒ
)

	)

1579 
	#ADVERTISED_10000ba£KR_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£KR_FuŒ
)

	)

1580 
	#ADVERTISED_10000ba£R_FEC
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(10000ba
£R_FEC
)

	)

1581 
	#ADVERTISED_20000ba£MLD2_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£MLD2_FuŒ
)

	)

1582 
	#ADVERTISED_20000ba£KR2_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(20000ba
£KR2_FuŒ
)

	)

1583 
	#ADVERTISED_40000ba£KR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£KR4_FuŒ
)

	)

1584 
	#ADVERTISED_40000ba£CR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£CR4_FuŒ
)

	)

1585 
	#ADVERTISED_40000ba£SR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£SR4_FuŒ
)

	)

1586 
	#ADVERTISED_40000ba£LR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(40000ba
£LR4_FuŒ
)

	)

1587 
	#ADVERTISED_56000ba£KR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£KR4_FuŒ
)

	)

1588 
	#ADVERTISED_56000ba£CR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£CR4_FuŒ
)

	)

1589 
	#ADVERTISED_56000ba£SR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£SR4_FuŒ
)

	)

1590 
	#ADVERTISED_56000ba£LR4_FuŒ
 
	`__ETHTOOL_LINK_MODE_LEGACY_MASK
(56000ba
£LR4_FuŒ
)

	)

1605 
	#SPEED_10
 10

	)

1606 
	#SPEED_100
 100

	)

1607 
	#SPEED_1000
 1000

	)

1608 
	#SPEED_2500
 2500

	)

1609 
	#SPEED_5000
 5000

	)

1610 
	#SPEED_10000
 10000

	)

1611 
	#SPEED_14000
 14000

	)

1612 
	#SPEED_20000
 20000

	)

1613 
	#SPEED_25000
 25000

	)

1614 
	#SPEED_40000
 40000

	)

1615 
	#SPEED_50000
 50000

	)

1616 
	#SPEED_56000
 56000

	)

1617 
	#SPEED_100000
 100000

	)

1618 
	#SPEED_200000
 200000

	)

1620 
	#SPEED_UNKNOWN
 -1

	)

1622 
__ölöe__
 
	$ëhtoﬁ_vÆid©e_•ìd
(
__u32
 
•ìd
)

1624  
•ìd
 <
INT_MAX
 || s≥ed =(
__u32
)
SPEED_UNKNOWN
;

1625 
	}
}

1628 
	#DUPLEX_HALF
 0x00

	)

1629 
	#DUPLEX_FULL
 0x01

	)

1630 
	#DUPLEX_UNKNOWN
 0xff

	)

1632 
__ölöe__
 
	$ëhtoﬁ_vÆid©e_du∂ex
(
__u8
 
du∂ex
)

1634 
du∂ex
) {

1635 
DUPLEX_HALF
:

1636 
DUPLEX_FULL
:

1637 
DUPLEX_UNKNOWN
:

1642 
	}
}

1645 
	#PORT_TP
 0x00

	)

1646 
	#PORT_AUI
 0x01

	)

1647 
	#PORT_MII
 0x02

	)

1648 
	#PORT_FIBRE
 0x03

	)

1649 
	#PORT_BNC
 0x04

	)

1650 
	#PORT_DA
 0x05

	)

1651 
	#PORT_NONE
 0xef

	)

1652 
	#PORT_OTHER
 0xff

	)

1655 
	#XCVR_INTERNAL
 0x00

	)

1656 
	#XCVR_EXTERNAL
 0x01

	)

1657 
	#XCVR_DUMMY1
 0x02

	)

1658 
	#XCVR_DUMMY2
 0x03

	)

1659 
	#XCVR_DUMMY3
 0x04

	)

1662 
	#AUTONEG_DISABLE
 0x00

	)

1663 
	#AUTONEG_ENABLE
 0x01

	)

1668 
	#ETH_TP_MDI_INVALID
 0x00

	)

1669 
	#ETH_TP_MDI
 0x01

	)

1670 
	#ETH_TP_MDI_X
 0x02

	)

1671 
	#ETH_TP_MDI_AUTO
 0x03

	)

1674 
	#WAKE_PHY
 (1 << 0)

	)

1675 
	#WAKE_UCAST
 (1 << 1)

	)

1676 
	#WAKE_MCAST
 (1 << 2)

	)

1677 
	#WAKE_BCAST
 (1 << 3)

	)

1678 
	#WAKE_ARP
 (1 << 4)

	)

1679 
	#WAKE_MAGIC
 (1 << 5)

	)

1680 
	#WAKE_MAGICSECURE
 (1 << 6Ë

	)

1681 
	#WAKE_FILTER
 (1 << 7)

	)

1684 
	#TCP_V4_FLOW
 0x01

	)

1685 
	#UDP_V4_FLOW
 0x02

	)

1686 
	#SCTP_V4_FLOW
 0x03

	)

1687 
	#AH_ESP_V4_FLOW
 0x04

	)

1688 
	#TCP_V6_FLOW
 0x05

	)

1689 
	#UDP_V6_FLOW
 0x06

	)

1690 
	#SCTP_V6_FLOW
 0x07

	)

1691 
	#AH_ESP_V6_FLOW
 0x08

	)

1692 
	#AH_V4_FLOW
 0x09

	)

1693 
	#ESP_V4_FLOW
 0x0®

	)

1694 
	#AH_V6_FLOW
 0x0b

	)

1695 
	#ESP_V6_FLOW
 0x0¯

	)

1696 
	#IPV4_USER_FLOW
 0x0d

	)

1697 
	#IP_USER_FLOW
 
IPV4_USER_FLOW


	)

1698 
	#IPV6_USER_FLOW
 0x0ê

	)

1699 
	#IPV4_FLOW
 0x10

	)

1700 
	#IPV6_FLOW
 0x11

	)

1701 
	#ETHER_FLOW
 0x12

	)

1703 
	#FLOW_EXT
 0x80000000

	)

1704 
	#FLOW_MAC_EXT
 0x40000000

	)

1706 
	#FLOW_RSS
 0x20000000

	)

1709 
	#RXH_L2DA
 (1 << 1)

	)

1710 
	#RXH_VLAN
 (1 << 2)

	)

1711 
	#RXH_L3_PROTO
 (1 << 3)

	)

1712 
	#RXH_IP_SRC
 (1 << 4)

	)

1713 
	#RXH_IP_DST
 (1 << 5)

	)

1714 
	#RXH_L4_B_0_1
 (1 << 6Ë

	)

1715 
	#RXH_L4_B_2_3
 (1 << 7Ë

	)

1716 
	#RXH_DISCARD
 (1 << 31)

	)

1718 
	#RX_CLS_FLOW_DISC
 0xffffffffffffffffULL

	)

1719 
	#RX_CLS_FLOW_WAKE
 0xffffffffffffff„ULL

	)

1722 
	#RX_CLS_LOC_SPECIAL
 0x80000000

	)

1723 
	#RX_CLS_LOC_ANY
 0xffffffff

	)

1724 
	#RX_CLS_LOC_FIRST
 0xffffff„

	)

1725 
	#RX_CLS_LOC_LAST
 0xfffffffd

	)

1728 
	#ETH_MODULE_SFF_8079
 0x1

	)

1729 
	#ETH_MODULE_SFF_8079_LEN
 256

	)

1730 
	#ETH_MODULE_SFF_8472
 0x2

	)

1731 
	#ETH_MODULE_SFF_8472_LEN
 512

	)

1732 
	#ETH_MODULE_SFF_8636
 0x3

	)

1733 
	#ETH_MODULE_SFF_8636_LEN
 256

	)

1734 
	#ETH_MODULE_SFF_8436
 0x4

	)

1735 
	#ETH_MODULE_SFF_8436_LEN
 256

	)

1737 
	#ETH_MODULE_SFF_8636_MAX_LEN
 640

	)

1738 
	#ETH_MODULE_SFF_8436_MAX_LEN
 640

	)

1747 
	eëhtoﬁ_ª£t_Êags
 {

1753 
	mETH_RESET_MGMT
 = 1 << 0,

1754 
	mETH_RESET_IRQ
 = 1 << 1,

1755 
	mETH_RESET_DMA
 = 1 << 2,

1756 
	mETH_RESET_FILTER
 = 1 << 3,

1757 
	mETH_RESET_OFFLOAD
 = 1 << 4,

1758 
	mETH_RESET_MAC
 = 1 << 5,

1759 
	mETH_RESET_PHY
 = 1 << 6,

1760 
	mETH_RESET_RAM
 = 1 << 7,

1762 
	mETH_RESET_AP
 = 1 << 8,

1764 
	mETH_RESET_DEDICATED
 = 0x0000ffff,

1766 
	mETH_RESET_ALL
 = 0xffffffff,

1769 
	#ETH_RESET_SHARED_SHIFT
 16

	)

1868 
	sëhtoﬁ_lök_£âögs
 {

1869 
__u32
 
	mcmd
;

1870 
__u32
 
	m•ìd
;

1871 
__u8
 
	mdu∂ex
;

1872 
__u8
 
	mp‹t
;

1873 
__u8
 
	mphy_addªss
;

1874 
__u8
 
	maut⁄eg
;

1875 
__u8
 
	mmdio_suµ‹t
;

1876 
__u8
 
	mëh_ç_mdix
;

1877 
__u8
 
	mëh_ç_mdix_˘æ
;

1878 
__s8
 
	mlök_mode_masks_nw‹ds
;

1879 
__u8
 
	må™s˚ivî
;

1880 
__u8
 
	mª£rved1
[3];

1881 
__u32
 
	mª£rved
[7];

1882 
__u32
 
	mlök_mode_masks
[0];

	@/usr/include/linux/fs.h

2 #i‚de‡
_LINUX_FS_H


3 
	#_LINUX_FS_H


	)

13 
	~<löux/limôs.h
>

14 
	~<löux/io˘l.h
>

15 
	~<löux/ty≥s.h
>

16 
	~<löux/fs¸y±.h
>

19 
	~<löux/mou¡.h
>

32 #unde‡
NR_OPEN


33 
	#INR_OPEN_CUR
 1024

	)

34 
	#INR_OPEN_MAX
 4096

	)

36 
	#BLOCK_SIZE_BITS
 10

	)

37 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

39 
	#SEEK_SET
 0

	)

40 
	#SEEK_CUR
 1

	)

41 
	#SEEK_END
 2

	)

42 
	#SEEK_DATA
 3

	)

43 
	#SEEK_HOLE
 4

	)

44 
	#SEEK_MAX
 
SEEK_HOLE


	)

46 
	#RENAME_NOREPLACE
 (1 << 0Ë

	)

47 
	#RENAME_EXCHANGE
 (1 << 1Ë

	)

48 
	#RENAME_WHITEOUT
 (1 << 2Ë

	)

50 
	sfûe_˛⁄e_ønge
 {

51 
__s64
 
	m§c_fd
;

52 
__u64
 
	m§c_off£t
;

53 
__u64
 
	m§c_Àngth
;

54 
__u64
 
	mde°_off£t
;

57 
	sf°rim_ønge
 {

58 
__u64
 
	m°¨t
;

59 
__u64
 
	mÀn
;

60 
__u64
 
	mmöÀn
;

64 
	#FILE_DEDUPE_RANGE_SAME
 0

	)

65 
	#FILE_DEDUPE_RANGE_DIFFERS
 1

	)

68 
	sfûe_dedu≥_ønge_öfo
 {

69 
__s64
 
	mde°_fd
;

70 
__u64
 
	mde°_off£t
;

71 
__u64
 
	mbyãs_dedu≥d
;

78 
__s32
 
	m°©us
;

79 
__u32
 
	mª£rved
;

83 
	sfûe_dedu≥_ønge
 {

84 
__u64
 
	m§c_off£t
;

85 
__u64
 
	m§c_Àngth
;

86 
__u16
 
	mde°_cou¡
;

87 
__u16
 
	mª£rved1
;

88 
__u32
 
	mª£rved2
;

89 
fûe_dedu≥_ønge_öfo
 
	möfo
[0];

93 
	sfûes_°©_°ru˘
 {

94 
	mƒ_fûes
;

95 
	mƒ_‰ì_fûes
;

96 
	mmax_fûes
;

99 
	söodes_°©_t
 {

100 
	mƒ_öodes
;

101 
	mƒ_unu£d
;

102 
	mdummy
[5];

106 
	#NR_FILE
 8192

	)

111 
	sfsx©å
 {

112 
__u32
 
	mfsx_xÊags
;

113 
__u32
 
	mfsx_extsize
;

114 
__u32
 
	mfsx_√xã¡s
;

115 
__u32
 
	mfsx_¥ojid
;

116 
__u32
 
	mfsx_cowextsize
;

117 
	mfsx_∑d
[8];

123 
	#FS_XFLAG_REALTIME
 0x00000001

	)

124 
	#FS_XFLAG_PREALLOC
 0x00000002

	)

125 
	#FS_XFLAG_IMMUTABLE
 0x00000008

	)

126 
	#FS_XFLAG_APPEND
 0x00000010

	)

127 
	#FS_XFLAG_SYNC
 0x00000020

	)

128 
	#FS_XFLAG_NOATIME
 0x00000040

	)

129 
	#FS_XFLAG_NODUMP
 0x00000080

	)

130 
	#FS_XFLAG_RTINHERIT
 0x00000100

	)

131 
	#FS_XFLAG_PROJINHERIT
 0x00000200

	)

132 
	#FS_XFLAG_NOSYMLINKS
 0x00000400

	)

133 
	#FS_XFLAG_EXTSIZE
 0x00000800

	)

134 
	#FS_XFLAG_EXTSZINHERIT
 0x00001000

	)

135 
	#FS_XFLAG_NODEFRAG
 0x00002000

	)

136 
	#FS_XFLAG_FILESTREAM
 0x00004000

	)

137 
	#FS_XFLAG_DAX
 0x00008000

	)

138 
	#FS_XFLAG_COWEXTSIZE
 0x00010000

	)

139 
	#FS_XFLAG_HASATTR
 0x80000000

	)

144 
	#BLKROSET
 
	`_IO
(0x12,93Ë

	)

145 
	#BLKROGET
 
	`_IO
(0x12,94Ë

	)

146 
	#BLKRRPART
 
	`_IO
(0x12,95Ë

	)

147 
	#BLKGETSIZE
 
	`_IO
(0x12,96Ë

	)

148 
	#BLKFLSBUF
 
	`_IO
(0x12,97Ë

	)

149 
	#BLKRASET
 
	`_IO
(0x12,98Ë

	)

150 
	#BLKRAGET
 
	`_IO
(0x12,99Ë

	)

151 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

152 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

153 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

154 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

155 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

157 
	#BLKPG
 
	`_IO
(0x12,105)

	)

161 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

162 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

167 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

168 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

169 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
Ë

	)

170 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_u£r_åa˚_£tup
)

	)

171 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

172 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

173 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

174 
	#BLKDISCARD
 
	`_IO
(0x12,119)

	)

175 
	#BLKIOMIN
 
	`_IO
(0x12,120)

	)

176 
	#BLKIOOPT
 
	`_IO
(0x12,121)

	)

177 
	#BLKALIGNOFF
 
	`_IO
(0x12,122)

	)

178 
	#BLKPBSZGET
 
	`_IO
(0x12,123)

	)

179 
	#BLKDISCARDZEROES
 
	`_IO
(0x12,124)

	)

180 
	#BLKSECDISCARD
 
	`_IO
(0x12,125)

	)

181 
	#BLKROTATIONAL
 
	`_IO
(0x12,126)

	)

182 
	#BLKZEROOUT
 
	`_IO
(0x12,127)

	)

188 
	#BMAP_IOCTL
 1

	)

189 
	#FIBMAP
 
	`_IO
(0x00,1Ë

	)

190 
	#FIGETBSZ
 
	`_IO
(0x00,2Ë

	)

191 
	#FIFREEZE
 
	`_IOWR
('X', 119, Ë

	)

192 
	#FITHAW
 
	`_IOWR
('X', 120, Ë

	)

193 
	#FITRIM
 
	`_IOWR
('X', 121, 
f°rim_ønge
Ë

	)

194 
	#FICLONE
 
	`_IOW
(0x94, 9, )

	)

195 
	#FICLONERANGE
 
	`_IOW
(0x94, 13, 
fûe_˛⁄e_ønge
)

	)

196 
	#FIDEDUPERANGE
 
	`_IOWR
(0x94, 54, 
fûe_dedu≥_ønge
)

	)

198 
	#FSLABEL_MAX
 256

	)

200 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

201 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

202 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

203 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

204 
	#FS_IOC_FIEMAP
 
	`_IOWR
('f', 11, 
fõm≠
)

	)

205 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

206 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

207 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

208 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

209 
	#FS_IOC_FSGETXATTR
 
	`_IOR
('X', 31, 
fsx©å
)

	)

210 
	#FS_IOC_FSSETXATTR
 
	`_IOW
('X', 32, 
fsx©å
)

	)

211 
	#FS_IOC_GETFSLABEL
 
	`_IOR
(0x94, 49, [
FSLABEL_MAX
])

	)

212 
	#FS_IOC_SETFSLABEL
 
	`_IOW
(0x94, 50, [
FSLABEL_MAX
])

	)

234 
	#FS_SECRM_FL
 0x00000001

	)

235 
	#FS_UNRM_FL
 0x00000002

	)

236 
	#FS_COMPR_FL
 0x00000004

	)

237 
	#FS_SYNC_FL
 0x00000008

	)

238 
	#FS_IMMUTABLE_FL
 0x00000010

	)

239 
	#FS_APPEND_FL
 0x00000020

	)

240 
	#FS_NODUMP_FL
 0x00000040

	)

241 
	#FS_NOATIME_FL
 0x00000080

	)

243 
	#FS_DIRTY_FL
 0x00000100

	)

244 
	#FS_COMPRBLK_FL
 0x00000200

	)

245 
	#FS_NOCOMP_FL
 0x00000400

	)

247 
	#FS_ENCRYPT_FL
 0x00000800

	)

248 
	#FS_BTREE_FL
 0x00001000

	)

249 
	#FS_INDEX_FL
 0x00001000

	)

250 
	#FS_IMAGIC_FL
 0x00002000

	)

251 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

252 
	#FS_NOTAIL_FL
 0x00008000

	)

253 
	#FS_DIRSYNC_FL
 0x00010000

	)

254 
	#FS_TOPDIR_FL
 0x00020000

	)

255 
	#FS_HUGE_FILE_FL
 0x00040000

	)

256 
	#FS_EXTENT_FL
 0x00080000

	)

257 
	#FS_VERITY_FL
 0x00100000

	)

258 
	#FS_EA_INODE_FL
 0x00200000

	)

259 
	#FS_EOFBLOCKS_FL
 0x00400000

	)

260 
	#FS_NOCOW_FL
 0x00800000

	)

261 
	#FS_INLINE_DATA_FL
 0x10000000

	)

262 
	#FS_PROJINHERIT_FL
 0x20000000

	)

263 
	#FS_CASEFOLD_FL
 0x40000000

	)

264 
	#FS_RESERVED_FL
 0x80000000

	)

266 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

267 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

270 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

271 
	#SYNC_FILE_RANGE_WRITE
 2

	)

272 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

273 
	#SYNC_FILE_RANGE_WRITE_AND_WAIT
 (
SYNC_FILE_RANGE_WRITE
 | \

274 
SYNC_FILE_RANGE_WAIT_BEFORE
 | \

275 
SYNC_FILE_RANGE_WAIT_AFTER
)

	)

281 
	t__bôwi£
 
	t__kî√l_rwf_t
;

284 
	#RWF_HIPRI
 ((
__kî√l_rwf_t
)0x00000001)

	)

287 
	#RWF_DSYNC
 ((
__kî√l_rwf_t
)0x00000002)

	)

290 
	#RWF_SYNC
 ((
__kî√l_rwf_t
)0x00000004)

	)

293 
	#RWF_NOWAIT
 ((
__kî√l_rwf_t
)0x00000008)

	)

296 
	#RWF_APPEND
 ((
__kî√l_rwf_t
)0x00000010)

	)

299 
	#RWF_SUPPORTED
 (
RWF_HIPRI
 | 
RWF_DSYNC
 | 
RWF_SYNC
 | 
RWF_NOWAIT
 |\

300 
RWF_APPEND
)

	)

	@/usr/include/linux/gpio.h

11 #i‚de‡
_GPIO_H_


12 
	#_GPIO_H_


	)

14 
	~<löux/io˘l.h
>

15 
	~<löux/ty≥s.h
>

24 
	sgpiochù_öfo
 {

25 
	m«me
[32];

26 
	mœbñ
[32];

27 
__u32
 
	mlöes
;

31 
	#GPIOLINE_FLAG_KERNEL
 (1UL << 0Ë

	)

32 
	#GPIOLINE_FLAG_IS_OUT
 (1UL << 1)

	)

33 
	#GPIOLINE_FLAG_ACTIVE_LOW
 (1UL << 2)

	)

34 
	#GPIOLINE_FLAG_OPEN_DRAIN
 (1UL << 3)

	)

35 
	#GPIOLINE_FLAG_OPEN_SOURCE
 (1UL << 4)

	)

49 
	sgpiﬁöe_öfo
 {

50 
__u32
 
	mlöe_off£t
;

51 
__u32
 
	mÊags
;

52 
	m«me
[32];

53 
	mc⁄sumî
[32];

57 
	#GPIOHANDLES_MAX
 64

	)

60 
	#GPIOHANDLE_REQUEST_INPUT
 (1UL << 0)

	)

61 
	#GPIOHANDLE_REQUEST_OUTPUT
 (1UL << 1)

	)

62 
	#GPIOHANDLE_REQUEST_ACTIVE_LOW
 (1UL << 2)

	)

63 
	#GPIOHANDLE_REQUEST_OPEN_DRAIN
 (1UL << 3)

	)

64 
	#GPIOHANDLE_REQUEST_OPEN_SOURCE
 (1UL << 4)

	)

88 
	sgpioh™dÀ_ªque°
 {

89 
__u32
 
	mlöeoff£ts
[
GPIOHANDLES_MAX
];

90 
__u32
 
	mÊags
;

91 
__u8
 
	mdeÁu…_vÆues
[
GPIOHANDLES_MAX
];

92 
	mc⁄sumî_œbñ
[32];

93 
__u32
 
	mlöes
;

94 
	mfd
;

103 
	sgpioh™dÀ_d©a
 {

104 
__u8
 
	mvÆues
[
GPIOHANDLES_MAX
];

107 
	#GPIOHANDLE_GET_LINE_VALUES_IOCTL
 
	`_IOWR
(0xB4, 0x08, 
gpioh™dÀ_d©a
)

	)

108 
	#GPIOHANDLE_SET_LINE_VALUES_IOCTL
 
	`_IOWR
(0xB4, 0x09, 
gpioh™dÀ_d©a
)

	)

111 
	#GPIOEVENT_REQUEST_RISING_EDGE
 (1UL << 0)

	)

112 
	#GPIOEVENT_REQUEST_FALLING_EDGE
 (1UL << 1)

	)

113 
	#GPIOEVENT_REQUEST_BOTH_EDGES
 ((1UL << 0Ë| (1UL << 1))

	)

129 
	sgpi€vít_ªque°
 {

130 
__u32
 
	mlöeoff£t
;

131 
__u32
 
	mh™dÀÊags
;

132 
__u32
 
	mevítÊags
;

133 
	mc⁄sumî_œbñ
[32];

134 
	mfd
;

140 
	#GPIOEVENT_EVENT_RISING_EDGE
 0x01

	)

141 
	#GPIOEVENT_EVENT_FALLING_EDGE
 0x02

	)

148 
	sgpi€vít_d©a
 {

149 
__u64
 
	mtime°amp
;

150 
__u32
 
	mid
;

153 
	#GPIO_GET_CHIPINFO_IOCTL
 
	`_IOR
(0xB4, 0x01, 
gpiochù_öfo
)

	)

154 
	#GPIO_GET_LINEINFO_IOCTL
 
	`_IOWR
(0xB4, 0x02, 
gpiﬁöe_öfo
)

	)

155 
	#GPIO_GET_LINEHANDLE_IOCTL
 
	`_IOWR
(0xB4, 0x03, 
gpioh™dÀ_ªque°
)

	)

156 
	#GPIO_GET_LINEEVENT_IOCTL
 
	`_IOWR
(0xB4, 0x04, 
gpi€vít_ªque°
)

	)

	@/usr/include/linux/hdreg.h

2 #i‚de‡
_LINUX_HDREG_H


3 
	#_LINUX_HDREG_H


	)

5 
	~<löux/ty≥s.h
>

11 
	#HDIO_DRIVE_CMD_HDR_SIZE
 (4 * (
__u8
))

	)

12 
	#HDIO_DRIVE_HOB_HDR_SIZE
 (8 * (
__u8
))

	)

13 
	#HDIO_DRIVE_TASK_HDR_SIZE
 (8 * (
__u8
))

	)

15 
	#IDE_DRIVE_TASK_NO_DATA
 0

	)

16 
	#IDE_DRIVE_TASK_INVALID
 -1

	)

17 
	#IDE_DRIVE_TASK_SET_XFER
 1

	)

18 
	#IDE_DRIVE_TASK_IN
 2

	)

19 
	#IDE_DRIVE_TASK_OUT
 3

	)

20 
	#IDE_DRIVE_TASK_RAW_WRITE
 4

	)

25 
	#IDE_TASKFILE_STD_IN_FLAGS
 0xFE

	)

26 
	#IDE_HOB_STD_IN_FLAGS
 0x3C

	)

27 
	#IDE_TASKFILE_STD_OUT_FLAGS
 0xFE

	)

28 
	#IDE_HOB_STD_OUT_FLAGS
 0x3C

	)

30 
	tèsk_i‹eg_t
;

31 
	tßè_i‹eg_t
;

33 
	uide_ªg_vÆid_s
 {

34 
	mÆl
 : 16;

36 
	md©a
 : 1;

37 
	mîr‹_„©uª
 : 1;

38 
	m£˘‹
 : 1;

39 
	mn£˘‹
 : 1;

40 
	mlcyl
 : 1;

41 
	mhcyl
 : 1;

42 
	m£À˘
 : 1;

43 
	m°©us_comm™d
 : 1;

45 
	md©a_hob
 : 1;

46 
	mîr‹_„©uª_hob
 : 1;

47 
	m£˘‹_hob
 : 1;

48 
	mn£˘‹_hob
 : 1;

49 
	mlcyl_hob
 : 1;

50 
	mhcyl_hob
 : 1;

51 
	m£À˘_hob
 : 1;

52 
	mc⁄åﬁ_hob
 : 1;

53 } 
	mb
;

54 } 
	tide_ªg_vÆid_t
;

56 
	side_èsk_ªque°_s
 {

57 
__u8
 
	mio_p‹ts
[8];

58 
__u8
 
	mhob_p‹ts
[8];

59 
ide_ªg_vÆid_t
 
	mout_Êags
;

60 
ide_ªg_vÆid_t
 
	mö_Êags
;

61 
	md©a_pha£
;

62 
	mªq_cmd
;

63 
	mout_size
;

64 
	mö_size
;

65 } 
	tide_èsk_ªque°_t
;

67 
	side_io˘l_ªque°_s
 {

68 
ide_èsk_ªque°_t
 *
	mèsk_ªque°
;

69 *
	mout_buf„r
;

70 *
	mö_buf„r
;

71 } 
	tide_io˘l_ªque°_t
;

73 
	shd_drive_cmd_hdr
 {

74 
__u8
 
	mcomm™d
;

75 
__u8
 
	m£˘‹_numbî
;

76 
__u8
 
	m„©uª
;

77 
__u8
 
	m£˘‹_cou¡
;

80 
	shd_drive_èsk_hdr
 {

81 
__u8
 
	md©a
;

82 
__u8
 
	m„©uª
;

83 
__u8
 
	m£˘‹_cou¡
;

84 
__u8
 
	m£˘‹_numbî
;

85 
__u8
 
	mlow_cylödî
;

86 
__u8
 
	mhigh_cylödî
;

87 
__u8
 
	mdevi˚_hód
;

88 
__u8
 
	mcomm™d
;

89 } 
	tèsk_°ru˘_t
;

91 
	shd_drive_hob_hdr
 {

92 
__u8
 
	md©a
;

93 
__u8
 
	m„©uª
;

94 
__u8
 
	m£˘‹_cou¡
;

95 
__u8
 
	m£˘‹_numbî
;

96 
__u8
 
	mlow_cylödî
;

97 
__u8
 
	mhigh_cylödî
;

98 
__u8
 
	mdevi˚_hód
;

99 
__u8
 
	mc⁄åﬁ
;

100 } 
	thob_°ru˘_t
;

102 
	#TASKFILE_NO_DATA
 0x0000

	)

104 
	#TASKFILE_IN
 0x0001

	)

105 
	#TASKFILE_MULTI_IN
 0x0002

	)

107 
	#TASKFILE_OUT
 0x0004

	)

108 
	#TASKFILE_MULTI_OUT
 0x0008

	)

109 
	#TASKFILE_IN_OUT
 0x0010

	)

111 
	#TASKFILE_IN_DMA
 0x0020

	)

112 
	#TASKFILE_OUT_DMA
 0x0040

	)

113 
	#TASKFILE_IN_DMAQ
 0x0080

	)

114 
	#TASKFILE_OUT_DMAQ
 0x0100

	)

116 
	#TASKFILE_P_IN
 0x0200

	)

117 
	#TASKFILE_P_OUT
 0x0400

	)

118 
	#TASKFILE_P_IN_DMA
 0x0800

	)

119 
	#TASKFILE_P_OUT_DMA
 0x1000

	)

120 
	#TASKFILE_P_IN_DMAQ
 0x2000

	)

121 
	#TASKFILE_P_OUT_DMAQ
 0x4000

	)

122 
	#TASKFILE_48
 0x8000

	)

123 
	#TASKFILE_INVALID
 0x7fff

	)

126 
	#WIN_NOP
 0x00

	)

130 
	#CFA_REQ_EXT_ERROR_CODE
 0x03

	)

134 
	#WIN_SRST
 0x08

	)

135 
	#WIN_DEVICE_RESET
 0x08

	)

139 
	#WIN_RECAL
 0x10

	)

140 
	#WIN_RESTORE
 
WIN_RECAL


	)

144 
	#WIN_READ
 0x20

	)

145 
	#WIN_READ_ONCE
 0x21

	)

146 
	#WIN_READ_LONG
 0x22

	)

147 
	#WIN_READ_LONG_ONCE
 0x23

	)

148 
	#WIN_READ_EXT
 0x24

	)

149 
	#WIN_READDMA_EXT
 0x25

	)

150 
	#WIN_READDMA_QUEUED_EXT
 0x26

	)

151 
	#WIN_READ_NATIVE_MAX_EXT
 0x27

	)

155 
	#WIN_MULTREAD_EXT
 0x29

	)

159 
	#WIN_WRITE
 0x30

	)

160 
	#WIN_WRITE_ONCE
 0x31

	)

161 
	#WIN_WRITE_LONG
 0x32

	)

162 
	#WIN_WRITE_LONG_ONCE
 0x33

	)

163 
	#WIN_WRITE_EXT
 0x34

	)

164 
	#WIN_WRITEDMA_EXT
 0x35

	)

165 
	#WIN_WRITEDMA_QUEUED_EXT
 0x36

	)

166 
	#WIN_SET_MAX_EXT
 0x37

	)

167 
	#CFA_WRITE_SECT_WO_ERASE
 0x38

	)

168 
	#WIN_MULTWRITE_EXT
 0x39

	)

172 
	#WIN_WRITE_VERIFY
 0x3C

	)

176 
	#WIN_VERIFY
 0x40

	)

177 
	#WIN_VERIFY_ONCE
 0x41

	)

178 
	#WIN_VERIFY_EXT
 0x42

	)

182 
	#WIN_FORMAT
 0x50

	)

186 
	#WIN_INIT
 0x60

	)

190 
	#WIN_SEEK
 0x70

	)

192 
	#CFA_TRANSLATE_SECTOR
 0x87

	)

193 
	#WIN_DIAGNOSE
 0x90

	)

194 
	#WIN_SPECIFY
 0x91

	)

195 
	#WIN_DOWNLOAD_MICROCODE
 0x92

	)

196 
	#WIN_STANDBYNOW2
 0x94

	)

197 
	#WIN_STANDBY2
 0x96

	)

198 
	#WIN_SETIDLE2
 0x97

	)

199 
	#WIN_CHECKPOWERMODE2
 0x98

	)

200 
	#WIN_SLEEPNOW2
 0x99

	)

204 
	#WIN_PACKETCMD
 0xA0

	)

205 
	#WIN_PIDENTIFY
 0xA1

	)

206 
	#WIN_QUEUED_SERVICE
 0xA2

	)

207 
	#WIN_SMART
 0xB0

	)

208 
	#CFA_ERASE_SECTORS
 0xC0

	)

209 
	#WIN_MULTREAD
 0xC4

	)

210 
	#WIN_MULTWRITE
 0xC5

	)

211 
	#WIN_SETMULT
 0xC6

	)

212 
	#WIN_READDMA_QUEUED
 0xC7

	)

213 
	#WIN_READDMA
 0xC8

	)

214 
	#WIN_READDMA_ONCE
 0xC9

	)

215 
	#WIN_WRITEDMA
 0xCA

	)

216 
	#WIN_WRITEDMA_ONCE
 0xCB

	)

217 
	#WIN_WRITEDMA_QUEUED
 0xCC

	)

218 
	#CFA_WRITE_MULTI_WO_ERASE
 0xCD

	)

219 
	#WIN_GETMEDIASTATUS
 0xDA

	)

220 
	#WIN_ACKMEDIACHANGE
 0xDB

	)

221 
	#WIN_POSTBOOT
 0xDC

	)

222 
	#WIN_PREBOOT
 0xDD

	)

223 
	#WIN_DOORLOCK
 0xDE

	)

224 
	#WIN_DOORUNLOCK
 0xDF

	)

225 
	#WIN_STANDBYNOW1
 0xE0

	)

226 
	#WIN_IDLEIMMEDIATE
 0xE1

	)

227 
	#WIN_STANDBY
 0xE2

	)

228 
	#WIN_SETIDLE1
 0xE3

	)

229 
	#WIN_READ_BUFFER
 0xE4

	)

230 
	#WIN_CHECKPOWERMODE1
 0xE5

	)

231 
	#WIN_SLEEPNOW1
 0xE6

	)

232 
	#WIN_FLUSH_CACHE
 0xE7

	)

233 
	#WIN_WRITE_BUFFER
 0xE8

	)

234 
	#WIN_WRITE_SAME
 0xE9

	)

236 
	#WIN_FLUSH_CACHE_EXT
 0xEA

	)

237 
	#WIN_IDENTIFY
 0xEC

	)

238 
	#WIN_MEDIAEJECT
 0xED

	)

239 
	#WIN_IDENTIFY_DMA
 0xEE

	)

240 
	#WIN_SETFEATURES
 0xEF

	)

241 
	#EXABYTE_ENABLE_NEST
 0xF0

	)

242 
	#WIN_SECURITY_SET_PASS
 0xF1

	)

243 
	#WIN_SECURITY_UNLOCK
 0xF2

	)

244 
	#WIN_SECURITY_ERASE_PREPARE
 0xF3

	)

245 
	#WIN_SECURITY_ERASE_UNIT
 0xF4

	)

246 
	#WIN_SECURITY_FREEZE_LOCK
 0xF5

	)

247 
	#WIN_SECURITY_DISABLE
 0xF6

	)

248 
	#WIN_READ_NATIVE_MAX
 0xF8

	)

249 
	#WIN_SET_MAX
 0xF9

	)

250 
	#DISABLE_SEAGATE
 0xFB

	)

254 
	#SMART_READ_VALUES
 0xD0

	)

255 
	#SMART_READ_THRESHOLDS
 0xD1

	)

256 
	#SMART_AUTOSAVE
 0xD2

	)

257 
	#SMART_SAVE
 0xD3

	)

258 
	#SMART_IMMEDIATE_OFFLINE
 0xD4

	)

259 
	#SMART_READ_LOG_SECTOR
 0xD5

	)

260 
	#SMART_WRITE_LOG_SECTOR
 0xD6

	)

261 
	#SMART_WRITE_THRESHOLDS
 0xD7

	)

262 
	#SMART_ENABLE
 0xD8

	)

263 
	#SMART_DISABLE
 0xD9

	)

264 
	#SMART_STATUS
 0xDA

	)

265 
	#SMART_AUTO_OFFLINE
 0xDB

	)

269 
	#SMART_LCYL_PASS
 0x4F

	)

270 
	#SMART_HCYL_PASS
 0xC2

	)

273 
	#SETFEATURES_EN_8BIT
 0x01

	)

274 
	#SETFEATURES_EN_WCACHE
 0x02

	)

275 
	#SETFEATURES_DIS_DEFECT
 0x04

	)

276 
	#SETFEATURES_EN_APM
 0x05

	)

277 
	#SETFEATURES_EN_SAME_R
 0x22

	)

278 
	#SETFEATURES_DIS_MSN
 0x31

	)

279 
	#SETFEATURES_DIS_RETRY
 0x33

	)

280 
	#SETFEATURES_EN_AAM
 0x42

	)

281 
	#SETFEATURES_RW_LONG
 0x44

	)

282 
	#SETFEATURES_SET_CACHE
 0x54

	)

283 
	#SETFEATURES_DIS_RLA
 0x55

	)

284 
	#SETFEATURES_EN_RI
 0x5D

	)

285 
	#SETFEATURES_EN_SI
 0x5E

	)

286 
	#SETFEATURES_DIS_RPOD
 0x66

	)

287 
	#SETFEATURES_DIS_ECC
 0x77

	)

288 
	#SETFEATURES_DIS_8BIT
 0x81

	)

289 
	#SETFEATURES_DIS_WCACHE
 0x82

	)

290 
	#SETFEATURES_EN_DEFECT
 0x84

	)

291 
	#SETFEATURES_DIS_APM
 0x85

	)

292 
	#SETFEATURES_EN_ECC
 0x88

	)

293 
	#SETFEATURES_EN_MSN
 0x95

	)

294 
	#SETFEATURES_EN_RETRY
 0x99

	)

295 
	#SETFEATURES_EN_RLA
 0xAA

	)

296 
	#SETFEATURES_PREFETCH
 0xAB

	)

297 
	#SETFEATURES_EN_REST
 0xAC

	)

298 
	#SETFEATURES_4B_RW_LONG
 0xBB

	)

299 
	#SETFEATURES_DIS_AAM
 0xC2

	)

300 
	#SETFEATURES_EN_RPOD
 0xCC

	)

301 
	#SETFEATURES_DIS_RI
 0xDD

	)

302 
	#SETFEATURES_EN_SAME_M
 0xDD

	)

303 
	#SETFEATURES_DIS_SI
 0xDE

	)

307 
	#SECURITY_SET_PASSWORD
 0xBA

	)

308 
	#SECURITY_UNLOCK
 0xBB

	)

309 
	#SECURITY_ERASE_PREPARE
 0xBC

	)

310 
	#SECURITY_ERASE_UNIT
 0xBD

	)

311 
	#SECURITY_FREEZE_LOCK
 0xBE

	)

312 
	#SECURITY_DISABLE_PASSWORD
 0xBF

	)

314 
	shd_geomëry
 {

315 
	mhóds
;

316 
	m£˘‹s
;

317 
	mcylödîs
;

318 
	m°¨t
;

322 
	#HDIO_GETGEO
 0x0301

	)

323 
	#HDIO_GET_UNMASKINTR
 0x0302

	)

324 
	#HDIO_GET_MULTCOUNT
 0x0304

	)

325 
	#HDIO_GET_QDMA
 0x0305

	)

327 
	#HDIO_SET_XFER
 0x0306

	)

329 
	#HDIO_OBSOLETE_IDENTITY
 0x0307

	)

330 
	#HDIO_GET_KEEPSETTINGS
 0x0308

	)

331 
	#HDIO_GET_32BIT
 0x0309

	)

332 
	#HDIO_GET_NOWERR
 0x030®

	)

333 
	#HDIO_GET_DMA
 0x030b

	)

334 
	#HDIO_GET_NICE
 0x030¯

	)

335 
	#HDIO_GET_IDENTITY
 0x030d

	)

336 
	#HDIO_GET_WCACHE
 0x030ê

	)

337 
	#HDIO_GET_ACOUSTIC
 0x030‡

	)

338 
	#HDIO_GET_ADDRESS
 0x0310

	)

340 
	#HDIO_GET_BUSSTATE
 0x031®

	)

341 
	#HDIO_TRISTATE_HWIF
 0x031b

	)

342 
	#HDIO_DRIVE_RESET
 0x031¯

	)

343 
	#HDIO_DRIVE_TASKFILE
 0x031d

	)

344 
	#HDIO_DRIVE_TASK
 0x031ê

	)

345 
	#HDIO_DRIVE_CMD
 0x031‡

	)

346 
	#HDIO_DRIVE_CMD_AEB
 
HDIO_DRIVE_TASK


	)

349 
	#HDIO_SET_MULTCOUNT
 0x0321

	)

350 
	#HDIO_SET_UNMASKINTR
 0x0322

	)

351 
	#HDIO_SET_KEEPSETTINGS
 0x0323

	)

352 
	#HDIO_SET_32BIT
 0x0324

	)

353 
	#HDIO_SET_NOWERR
 0x0325

	)

354 
	#HDIO_SET_DMA
 0x0326

	)

355 
	#HDIO_SET_PIO_MODE
 0x0327

	)

356 
	#HDIO_SCAN_HWIF
 0x0328

	)

357 
	#HDIO_UNREGISTER_HWIF
 0x032®

	)

358 
	#HDIO_SET_NICE
 0x0329

	)

359 
	#HDIO_SET_WCACHE
 0x032b

	)

360 
	#HDIO_SET_ACOUSTIC
 0x032¯

	)

361 
	#HDIO_SET_BUSSTATE
 0x032d

	)

362 
	#HDIO_SET_QDMA
 0x032ê

	)

363 
	#HDIO_SET_ADDRESS
 0x032‡

	)

367 
	mBUSSTATE_OFF
 = 0,

368 
	mBUSSTATE_ON
,

369 
	mBUSSTATE_TRISTATE


378 
	#__NEW_HD_DRIVE_ID


	)

386 
	shd_driveid
 {

387 
	mc⁄fig
;

388 
	mcyls
;

389 
	mª£rved2
;

390 
	mhóds
;

391 
	måack_byãs
;

392 
	m£˘‹_byãs
;

393 
	m£˘‹s
;

394 
	mvíd‹0
;

395 
	mvíd‹1
;

396 
	mvíd‹2
;

397 
	m£rül_no
[20];

398 
	mbuf_ty≥
;

399 
	mbuf_size
;

402 
	mecc_byãs
;

403 
	mfw_ªv
[8];

404 
	mmodñ
[40];

405 
	mmax_mu…£˘
;

406 
	mvíd‹3
;

407 
	mdw‹d_io
;

408 
	mvíd‹4
;

409 
	mˇ∑bûôy
;

415 
	mª£rved50
;

416 
	mvíd‹5
;

417 
	mtPIO
;

418 
	mvíd‹6
;

419 
	mtDMA
;

420 
	mfõld_vÆid
;

425 
	mcur_cyls
;

426 
	mcur_hóds
;

427 
	mcur_£˘‹s
;

428 
	mcur_ˇ∑côy0
;

429 
	mcur_ˇ∑côy1
;

430 
	mmu…£˘
;

431 
	mmu…£˘_vÆid
;

432 
	mlba_ˇ∑côy
;

433 
	mdma_1w‹d
;

434 
	mdma_mw‹d
;

435 
	meide_pio_modes
;

436 
	meide_dma_mö
;

437 
	meide_dma_time
;

438 
	meide_pio
;

439 
	meide_pio_i‹dy
;

440 
	mw‹ds69_70
[2];

443 
	mw‹ds71_74
[4];

446 
	mqueue_dïth
;

450 
	mw‹ds76_79
[4];

451 
	mmaj‹_ªv_num
;

452 
	mmö‹_ªv_num
;

453 
	mcomm™d_£t_1
;

471 
	mcomm™d_£t_2
;

489 
	mcfs£
;

501 
	mcfs_íabÀ_1
;

520 
	mcfs_íabÀ_2
;

539 
	mcsf_deÁu…
;

551 
	mdma_u…ø
;

552 
	må£uc
;

553 
	måsEuc
;

554 
	mCurAPMvÆues
;

555 
	mm¥c
;

556 
	mhw_c⁄fig
;

574 
	macou°ic
;

578 
	mm§qs
;

579 
	msx„π
;

580 
	mßl
;

581 
	m•g
;

582 
	mlba_ˇ∑côy_2
;

583 
	mw‹ds104_125
[22];

584 
	mœ°_lun
;

585 
	mw‹d127
;

593 
	mdlf
;

605 
	mcsfo
;

613 
	mw‹ds130_155
[26];

614 
	mw‹d156
;

615 
	mw‹ds157_159
[3];

616 
	mcÁ_powî
;

623 
	mw‹ds161_175
[15];

624 
	mw‹ds176_205
[30];

625 
	mw‹ds206_254
[49];

626 
	möãgrôy_w‹d
;

637 
	#IDE_NICE_DSC_OVERLAP
 (0Ë

	)

638 
	#IDE_NICE_ATAPI_OVERLAP
 (1Ë

	)

639 
	#IDE_NICE_1
 (3Ë

	)

640 
	#IDE_NICE_0
 (2Ë

	)

641 
	#IDE_NICE_2
 (4Ë

	)

	@/usr/include/linux/i2c.h

28 #i‚de‡
_LINUX_I2C_H


29 
	#_LINUX_I2C_H


	)

31 
	~<löux/ty≥s.h
>

69 
	si2c_msg
 {

70 
__u16
 
	maddr
;

71 
__u16
 
	mÊags
;

72 
	#I2C_M_RD
 0x0001

	)

74 
	#I2C_M_TEN
 0x0010

	)

75 
	#I2C_M_DMA_SAFE
 0x0200

	)

78 
	#I2C_M_RECV_LEN
 0x0400

	)

79 
	#I2C_M_NO_RD_ACK
 0x0800

	)

80 
	#I2C_M_IGNORE_NAK
 0x1000

	)

81 
	#I2C_M_REV_DIR_ADDR
 0x2000

	)

82 
	#I2C_M_NOSTART
 0x4000

	)

83 
	#I2C_M_STOP
 0x8000

	)

84 
__u16
 
	mÀn
;

85 
__u8
 *
	mbuf
;

90 
	#I2C_FUNC_I2C
 0x00000001

	)

91 
	#I2C_FUNC_10BIT_ADDR
 0x00000002

	)

92 
	#I2C_FUNC_PROTOCOL_MANGLING
 0x00000004

	)

93 
	#I2C_FUNC_SMBUS_PEC
 0x00000008

	)

94 
	#I2C_FUNC_NOSTART
 0x00000010

	)

95 
	#I2C_FUNC_SLAVE
 0x00000020

	)

96 
	#I2C_FUNC_SMBUS_BLOCK_PROC_CALL
 0x00008000

	)

97 
	#I2C_FUNC_SMBUS_QUICK
 0x00010000

	)

98 
	#I2C_FUNC_SMBUS_READ_BYTE
 0x00020000

	)

99 
	#I2C_FUNC_SMBUS_WRITE_BYTE
 0x00040000

	)

100 
	#I2C_FUNC_SMBUS_READ_BYTE_DATA
 0x00080000

	)

101 
	#I2C_FUNC_SMBUS_WRITE_BYTE_DATA
 0x00100000

	)

102 
	#I2C_FUNC_SMBUS_READ_WORD_DATA
 0x00200000

	)

103 
	#I2C_FUNC_SMBUS_WRITE_WORD_DATA
 0x00400000

	)

104 
	#I2C_FUNC_SMBUS_PROC_CALL
 0x00800000

	)

105 
	#I2C_FUNC_SMBUS_READ_BLOCK_DATA
 0x01000000

	)

106 
	#I2C_FUNC_SMBUS_WRITE_BLOCK_DATA
 0x02000000

	)

107 
	#I2C_FUNC_SMBUS_READ_I2C_BLOCK
 0x04000000

	)

108 
	#I2C_FUNC_SMBUS_WRITE_I2C_BLOCK
 0x08000000

	)

109 
	#I2C_FUNC_SMBUS_HOST_NOTIFY
 0x10000000

	)

111 
	#I2C_FUNC_SMBUS_BYTE
 (
I2C_FUNC_SMBUS_READ_BYTE
 | \

112 
I2C_FUNC_SMBUS_WRITE_BYTE
)

	)

113 
	#I2C_FUNC_SMBUS_BYTE_DATA
 (
I2C_FUNC_SMBUS_READ_BYTE_DATA
 | \

114 
I2C_FUNC_SMBUS_WRITE_BYTE_DATA
)

	)

115 
	#I2C_FUNC_SMBUS_WORD_DATA
 (
I2C_FUNC_SMBUS_READ_WORD_DATA
 | \

116 
I2C_FUNC_SMBUS_WRITE_WORD_DATA
)

	)

117 
	#I2C_FUNC_SMBUS_BLOCK_DATA
 (
I2C_FUNC_SMBUS_READ_BLOCK_DATA
 | \

118 
I2C_FUNC_SMBUS_WRITE_BLOCK_DATA
)

	)

119 
	#I2C_FUNC_SMBUS_I2C_BLOCK
 (
I2C_FUNC_SMBUS_READ_I2C_BLOCK
 | \

120 
I2C_FUNC_SMBUS_WRITE_I2C_BLOCK
)

	)

122 
	#I2C_FUNC_SMBUS_EMUL
 (
I2C_FUNC_SMBUS_QUICK
 | \

123 
I2C_FUNC_SMBUS_BYTE
 | \

124 
I2C_FUNC_SMBUS_BYTE_DATA
 | \

125 
I2C_FUNC_SMBUS_WORD_DATA
 | \

126 
I2C_FUNC_SMBUS_PROC_CALL
 | \

127 
I2C_FUNC_SMBUS_WRITE_BLOCK_DATA
 | \

128 
I2C_FUNC_SMBUS_I2C_BLOCK
 | \

129 
I2C_FUNC_SMBUS_PEC
)

	)

134 
	#I2C_SMBUS_BLOCK_MAX
 32

	)

135 
	ui2c_smbus_d©a
 {

136 
__u8
 
	mbyã
;

137 
__u16
 
	mw‹d
;

138 
__u8
 
	mblock
[
I2C_SMBUS_BLOCK_MAX
 + 2];

143 
	#I2C_SMBUS_READ
 1

	)

144 
	#I2C_SMBUS_WRITE
 0

	)

148 
	#I2C_SMBUS_QUICK
 0

	)

149 
	#I2C_SMBUS_BYTE
 1

	)

150 
	#I2C_SMBUS_BYTE_DATA
 2

	)

151 
	#I2C_SMBUS_WORD_DATA
 3

	)

152 
	#I2C_SMBUS_PROC_CALL
 4

	)

153 
	#I2C_SMBUS_BLOCK_DATA
 5

	)

154 
	#I2C_SMBUS_I2C_BLOCK_BROKEN
 6

	)

155 
	#I2C_SMBUS_BLOCK_PROC_CALL
 7

	)

156 
	#I2C_SMBUS_I2C_BLOCK_DATA
 8

	)

	@/usr/include/linux/input.h

9 #i‚de‡
_INPUT_H


10 
	#_INPUT_H


	)

13 
	~<sys/time.h
>

14 
	~<sys/io˘l.h
>

15 
	~<sys/ty≥s.h
>

16 
	~<löux/ty≥s.h
>

18 
	~"öput-evít-codes.h
"

26 
	söput_evít
 {

27 #i‡(
__BITS_PER_LONG
 !32 || !
deföed
(
__USE_TIME_BITS64
)Ë&& !deföed(
__KERNEL__
)

28 
timevÆ
 
	mtime
;

29 
	#öput_evít_£c
 
time
.
tv_£c


	)

30 
	#öput_evít_u£c
 
time
.
tv_u£c


	)

32 
__kî√l_ul⁄g_t
 
	m__£c
;

33 #i‡
deföed
(
__•¨c__
Ë&& deföed(
__¨ch64__
)

34 
	m__u£c
;

35 
	m__∑d
;

37 
__kî√l_ul⁄g_t
 
	m__u£c
;

39 
	#öput_evít_£c
 
__£c


	)

40 
	#öput_evít_u£c
 
__u£c


	)

42 
__u16
 
	mty≥
;

43 
__u16
 
	mcode
;

44 
__s32
 
	mvÆue
;

51 
	#EV_VERSION
 0x010001

	)

57 
	söput_id
 {

58 
__u16
 
	mbu°y≥
;

59 
__u16
 
	mvíd‹
;

60 
__u16
 
	m¥odu˘
;

61 
__u16
 
	mvîsi⁄
;

88 
	söput_absöfo
 {

89 
__s32
 
	mvÆue
;

90 
__s32
 
	mmöimum
;

91 
__s32
 
	mmaximum
;

92 
__s32
 
	mfuzz
;

93 
__s32
 
	mÊ©
;

94 
__s32
 
	mªsﬁuti⁄
;

112 
	söput_keym≠_íåy
 {

113 
	#INPUT_KEYMAP_BY_INDEX
 (1 << 0)

	)

114 
__u8
 
	mÊags
;

115 
__u8
 
	mÀn
;

116 
__u16
 
	mödex
;

117 
__u32
 
	mkeycode
;

118 
__u8
 
	msˇncode
[32];

121 
	söput_mask
 {

122 
__u32
 
	mty≥
;

123 
__u32
 
	mcodes_size
;

124 
__u64
 
	mcodes_±r
;

127 
	#EVIOCGVERSION
 
	`_IOR
('E', 0x01, Ë

	)

128 
	#EVIOCGID
 
	`_IOR
('E', 0x02, 
öput_id
Ë

	)

129 
	#EVIOCGREP
 
	`_IOR
('E', 0x03, [2]Ë

	)

130 
	#EVIOCSREP
 
	`_IOW
('E', 0x03, [2]Ë

	)

132 
	#EVIOCGKEYCODE
 
	`_IOR
('E', 0x04, [2]Ë

	)

133 
	#EVIOCGKEYCODE_V2
 
	`_IOR
('E', 0x04, 
öput_keym≠_íåy
)

	)

134 
	#EVIOCSKEYCODE
 
	`_IOW
('E', 0x04, [2]Ë

	)

135 
	#EVIOCSKEYCODE_V2
 
	`_IOW
('E', 0x04, 
öput_keym≠_íåy
)

	)

137 
	#EVIOCGNAME
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x06,ÜíË

	)

138 
	#EVIOCGPHYS
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x07,ÜíË

	)

139 
	#EVIOCGUNIQ
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x08,ÜíË

	)

140 
	#EVIOCGPROP
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x09,ÜíË

	)

166 
	#EVIOCGMTSLOTS
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x0a,Üí)

	)

168 
	#EVIOCGKEY
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x18,ÜíË

	)

169 
	#EVIOCGLED
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x19,ÜíË

	)

170 
	#EVIOCGSND
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x1a,ÜíË

	)

171 
	#EVIOCGSW
(
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x1b,ÜíË

	)

173 
	#EVIOCGBIT
(
ev
,
Àn
Ë
	`_IOC
(
_IOC_READ
, 'E', 0x20 + (ev),ÜíË

	)

174 
	#EVIOCGABS
(
abs
Ë
	`_IOR
('E', 0x40 + (abs), 
öput_absöfo
Ë

	)

175 
	#EVIOCSABS
(
abs
Ë
	`_IOW
('E', 0xc0 + (abs), 
öput_absöfo
Ë

	)

177 
	#EVIOCSFF
 
	`_IOW
('E', 0x80, 
ff_ef„˘
Ë

	)

178 
	#EVIOCRMFF
 
	`_IOW
('E', 0x81, Ë

	)

179 
	#EVIOCGEFFECTS
 
	`_IOR
('E', 0x84, Ë

	)

181 
	#EVIOCGRAB
 
	`_IOW
('E', 0x90, Ë

	)

182 
	#EVIOCREVOKE
 
	`_IOW
('E', 0x91, Ë

	)

213 
	#EVIOCGMASK
 
	`_IOR
('E', 0x92, 
öput_mask
Ë

	)

236 
	#EVIOCSMASK
 
	`_IOW
('E', 0x93, 
öput_mask
Ë

	)

238 
	#EVIOCSCLOCKID
 
	`_IOW
('E', 0xa0, Ë

	)

244 
	#ID_BUS
 0

	)

245 
	#ID_VENDOR
 1

	)

246 
	#ID_PRODUCT
 2

	)

247 
	#ID_VERSION
 3

	)

249 
	#BUS_PCI
 0x01

	)

250 
	#BUS_ISAPNP
 0x02

	)

251 
	#BUS_USB
 0x03

	)

252 
	#BUS_HIL
 0x04

	)

253 
	#BUS_BLUETOOTH
 0x05

	)

254 
	#BUS_VIRTUAL
 0x06

	)

256 
	#BUS_ISA
 0x10

	)

257 
	#BUS_I8042
 0x11

	)

258 
	#BUS_XTKBD
 0x12

	)

259 
	#BUS_RS232
 0x13

	)

260 
	#BUS_GAMEPORT
 0x14

	)

261 
	#BUS_PARPORT
 0x15

	)

262 
	#BUS_AMIGA
 0x16

	)

263 
	#BUS_ADB
 0x17

	)

264 
	#BUS_I2C
 0x18

	)

265 
	#BUS_HOST
 0x19

	)

266 
	#BUS_GSC
 0x1A

	)

267 
	#BUS_ATARI
 0x1B

	)

268 
	#BUS_SPI
 0x1C

	)

269 
	#BUS_RMI
 0x1D

	)

270 
	#BUS_CEC
 0x1E

	)

271 
	#BUS_INTEL_ISHTP
 0x1F

	)

276 
	#MT_TOOL_FINGER
 0x00

	)

277 
	#MT_TOOL_PEN
 0x01

	)

278 
	#MT_TOOL_PALM
 0x02

	)

279 
	#MT_TOOL_DIAL
 0x0a

	)

280 
	#MT_TOOL_MAX
 0x0f

	)

285 
	#FF_STATUS_STOPPED
 0x00

	)

286 
	#FF_STATUS_PLAYING
 0x01

	)

287 
	#FF_STATUS_MAX
 0x01

	)

304 
	sff_ª∂ay
 {

305 
__u16
 
	mÀngth
;

306 
__u16
 
	mdñay
;

314 
	sff_åiggî
 {

315 
__u16
 
	mbuâ⁄
;

316 
__u16
 
	möãrvÆ
;

331 
	sff_ívñ›e
 {

332 
__u16
 
	m©èck_Àngth
;

333 
__u16
 
	m©èck_Àvñ
;

334 
__u16
 
	mÁde_Àngth
;

335 
__u16
 
	mÁde_Àvñ
;

343 
	sff_c⁄°™t_ef„˘
 {

344 
__s16
 
	mÀvñ
;

345 
ff_ívñ›e
 
	mívñ›e
;

354 
	sff_ømp_ef„˘
 {

355 
__s16
 
	m°¨t_Àvñ
;

356 
__s16
 
	míd_Àvñ
;

357 
ff_ívñ›e
 
	mívñ›e
;

370 
	sff_c⁄dôi⁄_ef„˘
 {

371 
__u16
 
	mright_ßtuøti⁄
;

372 
__u16
 
	mÀ·_ßtuøti⁄
;

374 
__s16
 
	mright_c€ff
;

375 
__s16
 
	mÀ·_c€ff
;

377 
__u16
 
	mdódb™d
;

378 
__s16
 
	m˚¡î
;

399 
	sff_≥riodic_ef„˘
 {

400 
__u16
 
	mwavef‹m
;

401 
__u16
 
	m≥riod
;

402 
__s16
 
	mmagnôude
;

403 
__s16
 
	moff£t
;

404 
__u16
 
	mpha£
;

406 
ff_ívñ›e
 
	mívñ›e
;

408 
__u32
 
	mcu°om_Àn
;

409 
__s16
 *
	mcu°om_d©a
;

420 
	sff_rumbÀ_ef„˘
 {

421 
__u16
 
	m°r⁄g_magnôude
;

422 
__u16
 
	mwók_magnôude
;

448 
	sff_ef„˘
 {

449 
__u16
 
	mty≥
;

450 
__s16
 
	mid
;

451 
__u16
 
	mdúe˘i⁄
;

452 
ff_åiggî
 
	måiggî
;

453 
ff_ª∂ay
 
	mª∂ay
;

456 
ff_c⁄°™t_ef„˘
 
	mc⁄°™t
;

457 
ff_ømp_ef„˘
 
	mømp
;

458 
ff_≥riodic_ef„˘
 
	m≥riodic
;

459 
ff_c⁄dôi⁄_ef„˘
 
	mc⁄dôi⁄
[2];

460 
ff_rumbÀ_ef„˘
 
	mrumbÀ
;

461 } 
	mu
;

468 
	#FF_RUMBLE
 0x50

	)

469 
	#FF_PERIODIC
 0x51

	)

470 
	#FF_CONSTANT
 0x52

	)

471 
	#FF_SPRING
 0x53

	)

472 
	#FF_FRICTION
 0x54

	)

473 
	#FF_DAMPER
 0x55

	)

474 
	#FF_INERTIA
 0x56

	)

475 
	#FF_RAMP
 0x57

	)

477 
	#FF_EFFECT_MIN
 
FF_RUMBLE


	)

478 
	#FF_EFFECT_MAX
 
FF_RAMP


	)

484 
	#FF_SQUARE
 0x58

	)

485 
	#FF_TRIANGLE
 0x59

	)

486 
	#FF_SINE
 0x5a

	)

487 
	#FF_SAW_UP
 0x5b

	)

488 
	#FF_SAW_DOWN
 0x5c

	)

489 
	#FF_CUSTOM
 0x5d

	)

491 
	#FF_WAVEFORM_MIN
 
FF_SQUARE


	)

492 
	#FF_WAVEFORM_MAX
 
FF_CUSTOM


	)

498 
	#FF_GAIN
 0x60

	)

499 
	#FF_AUTOCENTER
 0x61

	)

507 
	#FF_MAX_EFFECTS
 
FF_GAIN


	)

509 
	#FF_MAX
 0x7f

	)

510 
	#FF_CNT
 (
FF_MAX
+1)

	)

	@/usr/include/linux/ioctl.h

2 #i‚de‡
_LINUX_IOCTL_H


3 
	#_LINUX_IOCTL_H


	)

5 
	~<asm/io˘l.h
>

	@/usr/include/linux/ip.h

18 #i‚de‡
_LINUX_IP_H


19 
	#_LINUX_IP_H


	)

20 
	~<löux/ty≥s.h
>

21 
	~<asm/byã‹dî.h
>

23 
	#IPTOS_TOS_MASK
 0x1E

	)

24 
	#IPTOS_TOS
(
tos
Ë(—os)&
IPTOS_TOS_MASK
)

	)

25 
	#IPTOS_LOWDELAY
 0x10

	)

26 
	#IPTOS_THROUGHPUT
 0x08

	)

27 
	#IPTOS_RELIABILITY
 0x04

	)

28 
	#IPTOS_MINCOST
 0x02

	)

30 
	#IPTOS_PREC_MASK
 0xE0

	)

31 
	#IPTOS_PREC
(
tos
Ë(—os)&
IPTOS_PREC_MASK
)

	)

32 
	#IPTOS_PREC_NETCONTROL
 0xe0

	)

33 
	#IPTOS_PREC_INTERNETCONTROL
 0xc0

	)

34 
	#IPTOS_PREC_CRITIC_ECP
 0xa0

	)

35 
	#IPTOS_PREC_FLASHOVERRIDE
 0x80

	)

36 
	#IPTOS_PREC_FLASH
 0x60

	)

37 
	#IPTOS_PREC_IMMEDIATE
 0x40

	)

38 
	#IPTOS_PREC_PRIORITY
 0x20

	)

39 
	#IPTOS_PREC_ROUTINE
 0x00

	)

43 
	#IPOPT_COPY
 0x80

	)

44 
	#IPOPT_CLASS_MASK
 0x60

	)

45 
	#IPOPT_NUMBER_MASK
 0x1f

	)

47 
	#IPOPT_COPIED
(
o
Ë((o)&
IPOPT_COPY
)

	)

48 
	#IPOPT_CLASS
(
o
Ë((o)&
IPOPT_CLASS_MASK
)

	)

49 
	#IPOPT_NUMBER
(
o
Ë((o)&
IPOPT_NUMBER_MASK
)

	)

51 
	#IPOPT_CONTROL
 0x00

	)

52 
	#IPOPT_RESERVED1
 0x20

	)

53 
	#IPOPT_MEASUREMENT
 0x40

	)

54 
	#IPOPT_RESERVED2
 0x60

	)

56 
	#IPOPT_END
 (0 |
IPOPT_CONTROL
)

	)

57 
	#IPOPT_NOOP
 (1 |
IPOPT_CONTROL
)

	)

58 
	#IPOPT_SEC
 (2 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

59 
	#IPOPT_LSRR
 (3 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

60 
	#IPOPT_TIMESTAMP
 (4 |
IPOPT_MEASUREMENT
)

	)

61 
	#IPOPT_CIPSO
 (6 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

62 
	#IPOPT_RR
 (7 |
IPOPT_CONTROL
)

	)

63 
	#IPOPT_SID
 (8 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

64 
	#IPOPT_SSRR
 (9 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

65 
	#IPOPT_RA
 (20|
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

67 
	#IPVERSION
 4

	)

68 
	#MAXTTL
 255

	)

69 
	#IPDEFTTL
 64

	)

71 
	#IPOPT_OPTVAL
 0

	)

72 
	#IPOPT_OLEN
 1

	)

73 
	#IPOPT_OFFSET
 2

	)

74 
	#IPOPT_MINOFF
 4

	)

75 
	#MAX_IPOPTLEN
 40

	)

76 
	#IPOPT_NOP
 
IPOPT_NOOP


	)

77 
	#IPOPT_EOL
 
IPOPT_END


	)

78 
	#IPOPT_TS
 
IPOPT_TIMESTAMP


	)

80 
	#IPOPT_TS_TSONLY
 0

	)

81 
	#IPOPT_TS_TSANDADDR
 1

	)

82 
	#IPOPT_TS_PRESPEC
 3

	)

84 
	#IPV4_BEET_PHMAXLEN
 8

	)

86 
	sùhdr
 {

87 #i‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

88 
__u8
 
	mihl
:4,

89 
	mvîsi⁄
:4;

90 #ñi‡
deföed
 (
__BIG_ENDIAN_BITFIELD
)

91 
__u8
 
	mvîsi⁄
:4,

92 
	mihl
:4;

96 
__u8
 
	mtos
;

97 
__be16
 
	mtŸ_Àn
;

98 
__be16
 
	mid
;

99 
__be16
 
	m‰ag_off
;

100 
__u8
 
	mâl
;

101 
__u8
 
	m¥Ÿocﬁ
;

102 
__sum16
 
	mcheck
;

103 
__be32
 
	mßddr
;

104 
__be32
 
	mdaddr
;

109 
	sù_auth_hdr
 {

110 
__u8
 
	m√xthdr
;

111 
__u8
 
	mhdæí
;

112 
__be16
 
	mª£rved
;

113 
__be32
 
	m•i
;

114 
__be32
 
	m£q_no
;

115 
__u8
 
	mauth_d©a
[0];

118 
	sù_e•_hdr
 {

119 
__be32
 
	m•i
;

120 
__be32
 
	m£q_no
;

121 
__u8
 
	míc_d©a
[0];

124 
	sù_comp_hdr
 {

125 
__u8
 
	m√xthdr
;

126 
__u8
 
	mÊags
;

127 
__be16
 
	m˝i
;

130 
	sù_bìt_phdr
 {

131 
__u8
 
	m√xthdr
;

132 
__u8
 
	mhdæí
;

133 
__u8
 
	m∑dÀn
;

134 
__u8
 
	mª£rved
;

140 
	mIPV4_DEVCONF_FORWARDING
=1,

141 
	mIPV4_DEVCONF_MC_FORWARDING
,

142 
	mIPV4_DEVCONF_PROXY_ARP
,

143 
	mIPV4_DEVCONF_ACCEPT_REDIRECTS
,

144 
	mIPV4_DEVCONF_SECURE_REDIRECTS
,

145 
	mIPV4_DEVCONF_SEND_REDIRECTS
,

146 
	mIPV4_DEVCONF_SHARED_MEDIA
,

147 
	mIPV4_DEVCONF_RP_FILTER
,

148 
	mIPV4_DEVCONF_ACCEPT_SOURCE_ROUTE
,

149 
	mIPV4_DEVCONF_BOOTP_RELAY
,

150 
	mIPV4_DEVCONF_LOG_MARTIANS
,

151 
	mIPV4_DEVCONF_TAG
,

152 
	mIPV4_DEVCONF_ARPFILTER
,

153 
	mIPV4_DEVCONF_MEDIUM_ID
,

154 
	mIPV4_DEVCONF_NOXFRM
,

155 
	mIPV4_DEVCONF_NOPOLICY
,

156 
	mIPV4_DEVCONF_FORCE_IGMP_VERSION
,

157 
	mIPV4_DEVCONF_ARP_ANNOUNCE
,

158 
	mIPV4_DEVCONF_ARP_IGNORE
,

159 
	mIPV4_DEVCONF_PROMOTE_SECONDARIES
,

160 
	mIPV4_DEVCONF_ARP_ACCEPT
,

161 
	mIPV4_DEVCONF_ARP_NOTIFY
,

162 
	mIPV4_DEVCONF_ACCEPT_LOCAL
,

163 
	mIPV4_DEVCONF_SRC_VMARK
,

164 
	mIPV4_DEVCONF_PROXY_ARP_PVLAN
,

165 
	mIPV4_DEVCONF_ROUTE_LOCALNET
,

166 
	mIPV4_DEVCONF_IGMPV2_UNSOLICITED_REPORT_INTERVAL
,

167 
	mIPV4_DEVCONF_IGMPV3_UNSOLICITED_REPORT_INTERVAL
,

168 
	mIPV4_DEVCONF_IGNORE_ROUTES_WITH_LINKDOWN
,

169 
	mIPV4_DEVCONF_DROP_UNICAST_IN_L2_MULTICAST
,

170 
	mIPV4_DEVCONF_DROP_GRATUITOUS_ARP
,

171 
	mIPV4_DEVCONF_BC_FORWARDING
,

172 
	m__IPV4_DEVCONF_MAX


175 
	#IPV4_DEVCONF_MAX
 (
__IPV4_DEVCONF_MAX
 - 1)

	)

	@/usr/include/linux/kernel.h

2 #i‚de‡
_LINUX_KERNEL_H


3 
	#_LINUX_KERNEL_H


	)

5 
	~<löux/sysöfo.h
>

6 
	~<löux/c⁄°.h
>

	@/usr/include/linux/limits.h

2 #i‚de‡
_LINUX_LIMITS_H


3 
	#_LINUX_LIMITS_H


	)

5 
	#NR_OPEN
 1024

	)

7 
	#NGROUPS_MAX
 65536

	)

8 
	#ARG_MAX
 131072

	)

9 
	#LINK_MAX
 127

	)

10 
	#MAX_CANON
 255

	)

11 
	#MAX_INPUT
 255

	)

12 
	#NAME_MAX
 255

	)

13 
	#PATH_MAX
 4096

	)

14 
	#PIPE_BUF
 4096

	)

15 
	#XATTR_NAME_MAX
 255

	)

16 
	#XATTR_SIZE_MAX
 65536

	)

17 
	#XATTR_LIST_MAX
 65536

	)

19 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/module.h

2 #i‚de‡
_LINUX_MODULE_H


3 
	#_LINUX_MODULE_H


	)

6 
	#MODULE_INIT_IGNORE_MODVERSIONS
 1

	)

7 
	#MODULE_INIT_IGNORE_VERMAGIC
 2

	)

	@/usr/include/linux/netdevice.h

26 #i‚de‡
_LINUX_NETDEVICE_H


27 
	#_LINUX_NETDEVICE_H


	)

29 
	~<löux/if.h
>

30 
	~<löux/if_ëhî.h
>

31 
	~<löux/if_∑ckë.h
>

32 
	~<löux/if_lök.h
>

35 
	#MAX_ADDR_LEN
 32

	)

38 
	#INIT_NETDEV_GROUP
 0

	)

42 
	#NET_NAME_UNKNOWN
 0

	)

43 
	#NET_NAME_ENUM
 1

	)

44 
	#NET_NAME_PREDICTABLE
 2

	)

45 
	#NET_NAME_USER
 3

	)

46 
	#NET_NAME_RENAMED
 4

	)

50 
	mIF_PORT_UNKNOWN
 = 0,

51 
	mIF_PORT_10BASE2
,

52 
	mIF_PORT_10BASET
,

53 
	mIF_PORT_AUI
,

54 
	mIF_PORT_100BASET
,

55 
	mIF_PORT_100BASETX
,

56 
	mIF_PORT_100BASEFX


60 
	#NET_ADDR_PERM
 0

	)

61 
	#NET_ADDR_RANDOM
 1

	)

62 
	#NET_ADDR_STOLEN
 2

	)

63 
	#NET_ADDR_SET
 3

	)

	@/usr/include/linux/netlink.h

2 #i‚de‡
__LINUX_NETLINK_H


3 
	#__LINUX_NETLINK_H


	)

5 
	~<löux/c⁄°.h
>

6 
	~<löux/sockë.h
>

7 
	~<löux/ty≥s.h
>

9 
	#NETLINK_ROUTE
 0

	)

10 
	#NETLINK_UNUSED
 1

	)

11 
	#NETLINK_USERSOCK
 2

	)

12 
	#NETLINK_FIREWALL
 3

	)

13 
	#NETLINK_SOCK_DIAG
 4

	)

14 
	#NETLINK_NFLOG
 5

	)

15 
	#NETLINK_XFRM
 6

	)

16 
	#NETLINK_SELINUX
 7

	)

17 
	#NETLINK_ISCSI
 8

	)

18 
	#NETLINK_AUDIT
 9

	)

19 
	#NETLINK_FIB_LOOKUP
 10

	)

20 
	#NETLINK_CONNECTOR
 11

	)

21 
	#NETLINK_NETFILTER
 12

	)

22 
	#NETLINK_IP6_FW
 13

	)

23 
	#NETLINK_DNRTMSG
 14

	)

24 
	#NETLINK_KOBJECT_UEVENT
 15

	)

25 
	#NETLINK_GENERIC
 16

	)

27 
	#NETLINK_SCSITRANSPORT
 18

	)

28 
	#NETLINK_ECRYPTFS
 19

	)

29 
	#NETLINK_RDMA
 20

	)

30 
	#NETLINK_CRYPTO
 21

	)

31 
	#NETLINK_SMC
 22

	)

33 
	#NETLINK_INET_DIAG
 
NETLINK_SOCK_DIAG


	)

35 
	#MAX_LINKS
 32

	)

37 
	ssockaddr_∆
 {

38 
__kî√l_ß_Ámûy_t
 
	m∆_Ámûy
;

39 
	m∆_∑d
;

40 
__u32
 
	m∆_pid
;

41 
__u32
 
	m∆_groups
;

44 
	s∆msghdr
 {

45 
__u32
 
	m∆msg_Àn
;

46 
__u16
 
	m∆msg_ty≥
;

47 
__u16
 
	m∆msg_Êags
;

48 
__u32
 
	m∆msg_£q
;

49 
__u32
 
	m∆msg_pid
;

54 
	#NLM_F_REQUEST
 0x01

	)

55 
	#NLM_F_MULTI
 0x02

	)

56 
	#NLM_F_ACK
 0x04

	)

57 
	#NLM_F_ECHO
 0x08

	)

58 
	#NLM_F_DUMP_INTR
 0x10

	)

59 
	#NLM_F_DUMP_FILTERED
 0x20

	)

62 
	#NLM_F_ROOT
 0x100

	)

63 
	#NLM_F_MATCH
 0x200

	)

64 
	#NLM_F_ATOMIC
 0x400

	)

65 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

68 
	#NLM_F_REPLACE
 0x100

	)

69 
	#NLM_F_EXCL
 0x200

	)

70 
	#NLM_F_CREATE
 0x400

	)

71 
	#NLM_F_APPEND
 0x800

	)

74 
	#NLM_F_NONREC
 0x100

	)

77 
	#NLM_F_CAPPED
 0x100

	)

78 
	#NLM_F_ACK_TLVS
 0x200

	)

89 
	#NLMSG_ALIGNTO
 4U

	)

90 
	#NLMSG_ALIGN
(
Àn
Ë–(÷í)+
NLMSG_ALIGNTO
-1Ë& ~(NLMSG_ALIGNTO-1Ë)

	)

91 
	#NLMSG_HDRLEN
 ((Ë
	`NLMSG_ALIGN
((
∆msghdr
)))

	)

92 
	#NLMSG_LENGTH
(
Àn
Ë(÷íË+ 
NLMSG_HDRLEN
)

	)

93 
	#NLMSG_SPACE
(
Àn
Ë
	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
÷í))

	)

94 
	#NLMSG_DATA
(
∆h
Ë((*)(((*ÍlhË+ 
	`NLMSG_LENGTH
(0)))

	)

95 
	#NLMSG_NEXT
(
∆h
,
Àn
Ë(÷íË-
	`NLMSG_ALIGN
(“lh)->
∆msg_Àn
), \

96 (
∆msghdr
*)(((*)(
∆h
)Ë+ 
	`NLMSG_ALIGN
(“lh)->
∆msg_Àn
)))

	)

97 
	#NLMSG_OK
(
∆h
,
Àn
Ë(÷íË>()(
∆msghdr
) && \

98 (
∆h
)->
∆msg_Àn
 >(
∆msghdr
) && \

99 (
∆h
)->
∆msg_Àn
 <(
Àn
))

	)

100 
	#NLMSG_PAYLOAD
(
∆h
,
Àn
Ë(“lh)->
∆msg_Àn
 - 
	`NLMSG_SPACE
(÷í)))

	)

102 
	#NLMSG_NOOP
 0x1

	)

103 
	#NLMSG_ERROR
 0x2

	)

104 
	#NLMSG_DONE
 0x3

	)

105 
	#NLMSG_OVERRUN
 0x4

	)

107 
	#NLMSG_MIN_TYPE
 0x10

	)

109 
	s∆msgîr
 {

110 
	mîr‹
;

111 
∆msghdr
 
	mmsg
;

135 
	e∆msgîr_©ås
 {

136 
	mNLMSGERR_ATTR_UNUSED
,

137 
	mNLMSGERR_ATTR_MSG
,

138 
	mNLMSGERR_ATTR_OFFS
,

139 
	mNLMSGERR_ATTR_COOKIE
,

141 
	m__NLMSGERR_ATTR_MAX
,

142 
	mNLMSGERR_ATTR_MAX
 = 
__NLMSGERR_ATTR_MAX
 - 1

145 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

146 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

147 
	#NETLINK_PKTINFO
 3

	)

148 
	#NETLINK_BROADCAST_ERROR
 4

	)

149 
	#NETLINK_NO_ENOBUFS
 5

	)

150 
	#NETLINK_RX_RING
 6

	)

151 
	#NETLINK_TX_RING
 7

	)

152 
	#NETLINK_LISTEN_ALL_NSID
 8

	)

153 
	#NETLINK_LIST_MEMBERSHIPS
 9

	)

154 
	#NETLINK_CAP_ACK
 10

	)

155 
	#NETLINK_EXT_ACK
 11

	)

156 
	#NETLINK_GET_STRICT_CHK
 12

	)

158 
	s∆_pktöfo
 {

159 
__u32
 
	mgroup
;

162 
	s∆_mm≠_ªq
 {

163 
	mnm_block_size
;

164 
	mnm_block_ƒ
;

165 
	mnm_‰ame_size
;

166 
	mnm_‰ame_ƒ
;

169 
	s∆_mm≠_hdr
 {

170 
	mnm_°©us
;

171 
	mnm_Àn
;

172 
__u32
 
	mnm_group
;

174 
__u32
 
	mnm_pid
;

175 
__u32
 
	mnm_uid
;

176 
__u32
 
	mnm_gid
;

179 
	e∆_mm≠_°©us
 {

180 
	mNL_MMAP_STATUS_UNUSED
,

181 
	mNL_MMAP_STATUS_RESERVED
,

182 
	mNL_MMAP_STATUS_VALID
,

183 
	mNL_MMAP_STATUS_COPY
,

184 
	mNL_MMAP_STATUS_SKIP
,

187 
	#NL_MMAP_MSG_ALIGNMENT
 
NLMSG_ALIGNTO


	)

188 
	#NL_MMAP_MSG_ALIGN
(
sz
Ë
	`__ALIGN_KERNEL
(sz, 
NL_MMAP_MSG_ALIGNMENT
)

	)

189 
	#NL_MMAP_HDRLEN
 
	`NL_MMAP_MSG_ALIGN
((
∆_mm≠_hdr
))

	)

191 
	#NET_MAJOR
 36

	)

194 
	mNETLINK_UNCONNECTED
 = 0,

195 
	mNETLINK_CONNECTED
,

207 
	s∆©å
 {

208 
__u16
 
	m∆a_Àn
;

209 
__u16
 
	m∆a_ty≥
;

222 
	#NLA_F_NESTED
 (1 << 15)

	)

223 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

224 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

226 
	#NLA_ALIGNTO
 4

	)

227 
	#NLA_ALIGN
(
Àn
Ë((÷íË+ 
NLA_ALIGNTO
 - 1Ë& ~(NLA_ALIGNTO - 1))

	)

228 
	#NLA_HDRLEN
 ((Ë
	`NLA_ALIGN
((
∆©å
)))

	)

243 
	s∆a_bôfõld32
 {

244 
__u32
 
	mvÆue
;

245 
__u32
 
	m£À˘‹
;

	@/usr/include/linux/ptrace.h

2 #i‚de‡
_LINUX_PTRACE_H


3 
	#_LINUX_PTRACE_H


	)

9 
	~<löux/ty≥s.h
>

11 
	#PTRACE_TRACEME
 0

	)

12 
	#PTRACE_PEEKTEXT
 1

	)

13 
	#PTRACE_PEEKDATA
 2

	)

14 
	#PTRACE_PEEKUSR
 3

	)

15 
	#PTRACE_POKETEXT
 4

	)

16 
	#PTRACE_POKEDATA
 5

	)

17 
	#PTRACE_POKEUSR
 6

	)

18 
	#PTRACE_CONT
 7

	)

19 
	#PTRACE_KILL
 8

	)

20 
	#PTRACE_SINGLESTEP
 9

	)

22 
	#PTRACE_ATTACH
 16

	)

23 
	#PTRACE_DETACH
 17

	)

25 
	#PTRACE_SYSCALL
 24

	)

28 
	#PTRACE_SETOPTIONS
 0x4200

	)

29 
	#PTRACE_GETEVENTMSG
 0x4201

	)

30 
	#PTRACE_GETSIGINFO
 0x4202

	)

31 
	#PTRACE_SETSIGINFO
 0x4203

	)

50 
	#PTRACE_GETREGSET
 0x4204

	)

51 
	#PTRACE_SETREGSET
 0x4205

	)

53 
	#PTRACE_SEIZE
 0x4206

	)

54 
	#PTRACE_INTERRUPT
 0x4207

	)

55 
	#PTRACE_LISTEN
 0x4208

	)

57 
	#PTRACE_PEEKSIGINFO
 0x4209

	)

59 
	s±ø˚_≥eksigöfo_¨gs
 {

60 
__u64
 
	moff
;

61 
__u32
 
	mÊags
;

62 
__s32
 
	mƒ
;

65 
	#PTRACE_GETSIGMASK
 0x420a

	)

66 
	#PTRACE_SETSIGMASK
 0x420b

	)

68 
	#PTRACE_SECCOMP_GET_FILTER
 0x420c

	)

69 
	#PTRACE_SECCOMP_GET_METADATA
 0x420d

	)

71 
	s£ccomp_mëad©a
 {

72 
__u64
 
	mfûãr_off
;

73 
__u64
 
	mÊags
;

76 
	#PTRACE_GET_SYSCALL_INFO
 0x420e

	)

77 
	#PTRACE_SYSCALL_INFO_NONE
 0

	)

78 
	#PTRACE_SYSCALL_INFO_ENTRY
 1

	)

79 
	#PTRACE_SYSCALL_INFO_EXIT
 2

	)

80 
	#PTRACE_SYSCALL_INFO_SECCOMP
 3

	)

82 
	s±ø˚_sysˇŒ_öfo
 {

83 
__u8
 
	m›
;

84 
__u8
 
	m∑d
[3];

85 
__u32
 
	m¨ch
;

86 
__u64
 
	mö°ru˘i⁄_poöãr
;

87 
__u64
 
	m°ack_poöãr
;

90 
__u64
 
	mƒ
;

91 
__u64
 
	m¨gs
[6];

92 } 
	míåy
;

94 
__s64
 
	mrvÆ
;

95 
__u8
 
	mis_îr‹
;

96 } 
	mexô
;

98 
__u64
 
	mƒ
;

99 
__u64
 
	m¨gs
[6];

100 
__u32
 
	mªt_d©a
;

101 } 
	m£ccomp
;

109 
	#PTRACE_EVENTMSG_SYSCALL_ENTRY
 1

	)

110 
	#PTRACE_EVENTMSG_SYSCALL_EXIT
 2

	)

113 
	#PTRACE_PEEKSIGINFO_SHARED
 (1 << 0)

	)

116 
	#PTRACE_EVENT_FORK
 1

	)

117 
	#PTRACE_EVENT_VFORK
 2

	)

118 
	#PTRACE_EVENT_CLONE
 3

	)

119 
	#PTRACE_EVENT_EXEC
 4

	)

120 
	#PTRACE_EVENT_VFORK_DONE
 5

	)

121 
	#PTRACE_EVENT_EXIT
 6

	)

122 
	#PTRACE_EVENT_SECCOMP
 7

	)

124 
	#PTRACE_EVENT_STOP
 128

	)

127 
	#PTRACE_O_TRACESYSGOOD
 1

	)

128 
	#PTRACE_O_TRACEFORK
 (1 << 
PTRACE_EVENT_FORK
)

	)

129 
	#PTRACE_O_TRACEVFORK
 (1 << 
PTRACE_EVENT_VFORK
)

	)

130 
	#PTRACE_O_TRACECLONE
 (1 << 
PTRACE_EVENT_CLONE
)

	)

131 
	#PTRACE_O_TRACEEXEC
 (1 << 
PTRACE_EVENT_EXEC
)

	)

132 
	#PTRACE_O_TRACEVFORKDONE
 (1 << 
PTRACE_EVENT_VFORK_DONE
)

	)

133 
	#PTRACE_O_TRACEEXIT
 (1 << 
PTRACE_EVENT_EXIT
)

	)

134 
	#PTRACE_O_TRACESECCOMP
 (1 << 
PTRACE_EVENT_SECCOMP
)

	)

137 
	#PTRACE_O_EXITKILL
 (1 << 20)

	)

138 
	#PTRACE_O_SUSPEND_SECCOMP
 (1 << 21)

	)

140 
	#PTRACE_O_MASK
 (\

141 0x000000f‡| 
PTRACE_O_EXITKILL
 | 
PTRACE_O_SUSPEND_SECCOMP
)

	)

143 
	~<asm/±ø˚.h
>

	@/usr/include/linux/random.h

8 #i‚de‡
_LINUX_RANDOM_H


9 
	#_LINUX_RANDOM_H


	)

11 
	~<löux/ty≥s.h
>

12 
	~<löux/io˘l.h
>

13 
	~<löux/úqƒ.h
>

18 
	#RNDGETENTCNT
 
	`_IOR
–'R', 0x00, )

	)

21 
	#RNDADDTOENTCNT
 
	`_IOW
–'R', 0x01, )

	)

24 
	#RNDGETPOOL
 
	`_IOR
–'R', 0x02, [2] )

	)

30 
	#RNDADDENTROPY
 
	`_IOW
–'R', 0x03, [2] )

	)

33 
	#RNDZAPENTCNT
 
	`_IO
–'R', 0x04 )

	)

36 
	#RNDCLEARPOOL
 
	`_IO
–'R', 0x06 )

	)

39 
	#RNDRESEEDCRNG
 
	`_IO
–'R', 0x07 )

	)

41 
	sønd_poﬁ_öfo
 {

42 
	míå›y_cou¡
;

43 
	mbuf_size
;

44 
__u32
 
	mbuf
[0];

54 
	#GRND_NONBLOCK
 0x0001

	)

55 
	#GRND_RANDOM
 0x0002

	)

56 
	#GRND_INSECURE
 0x0004

	)

	@/usr/include/linux/rtc.h

12 #i‚de‡
_LINUX_RTC_H_


13 
	#_LINUX_RTC_H_


	)

21 
	sπc_time
 {

22 
	mtm_£c
;

23 
	mtm_mö
;

24 
	mtm_hour
;

25 
	mtm_mday
;

26 
	mtm_m⁄
;

27 
	mtm_yór
;

28 
	mtm_wday
;

29 
	mtm_yday
;

30 
	mtm_isd°
;

37 
	sπc_wkÆrm
 {

38 
	míabÀd
;

39 
	m≥ndög
;

40 
πc_time
 
	mtime
;

56 
	sπc_∂l_öfo
 {

57 
	m∂l_˘æ
;

58 
	m∂l_vÆue
;

59 
	m∂l_max
;

60 
	m∂l_mö
;

61 
	m∂l_posmu…
;

62 
	m∂l_√gmu…
;

63 
	m∂l_˛ock
;

71 
	#RTC_AIE_ON
 
	`_IO
('p', 0x01Ë

	)

72 
	#RTC_AIE_OFF
 
	`_IO
('p', 0x02Ë

	)

73 
	#RTC_UIE_ON
 
	`_IO
('p', 0x03Ë

	)

74 
	#RTC_UIE_OFF
 
	`_IO
('p', 0x04Ë

	)

75 
	#RTC_PIE_ON
 
	`_IO
('p', 0x05Ë

	)

76 
	#RTC_PIE_OFF
 
	`_IO
('p', 0x06Ë

	)

77 
	#RTC_WIE_ON
 
	`_IO
('p', 0x0fË

	)

78 
	#RTC_WIE_OFF
 
	`_IO
('p', 0x10Ë

	)

80 
	#RTC_ALM_SET
 
	`_IOW
('p', 0x07, 
πc_time
Ë

	)

81 
	#RTC_ALM_READ
 
	`_IOR
('p', 0x08, 
πc_time
Ë

	)

82 
	#RTC_RD_TIME
 
	`_IOR
('p', 0x09, 
πc_time
Ë

	)

83 
	#RTC_SET_TIME
 
	`_IOW
('p', 0x0a, 
πc_time
Ë

	)

84 
	#RTC_IRQP_READ
 
	`_IOR
('p', 0x0b, Ë

	)

85 
	#RTC_IRQP_SET
 
	`_IOW
('p', 0x0c, Ë

	)

86 
	#RTC_EPOCH_READ
 
	`_IOR
('p', 0x0d, Ë

	)

87 
	#RTC_EPOCH_SET
 
	`_IOW
('p', 0x0e, Ë

	)

89 
	#RTC_WKALM_SET
 
	`_IOW
('p', 0x0f, 
πc_wkÆrm
)

	)

90 
	#RTC_WKALM_RD
 
	`_IOR
('p', 0x10, 
πc_wkÆrm
)

	)

92 
	#RTC_PLL_GET
 
	`_IOR
('p', 0x11, 
πc_∂l_öfo
Ë

	)

93 
	#RTC_PLL_SET
 
	`_IOW
('p', 0x12, 
πc_∂l_öfo
Ë

	)

95 
	#RTC_VL_READ
 
	`_IOR
('p', 0x13, Ë

	)

96 
	#RTC_VL_CLR
 
	`_IO
('p', 0x14Ë

	)

99 
	#RTC_IRQF
 0x80

	)

100 
	#RTC_PF
 0x40

	)

101 
	#RTC_AF
 0x20

	)

102 
	#RTC_UF
 0x10

	)

105 
	#RTC_MAX_FREQ
 8192

	)

	@/usr/include/linux/sched.h

2 #i‚de‡
_LINUX_SCHED_H


3 
	#_LINUX_SCHED_H


	)

5 
	~<löux/ty≥s.h
>

10 
	#CSIGNAL
 0x000000f‡

	)

11 
	#CLONE_VM
 0x00000100

	)

12 
	#CLONE_FS
 0x00000200

	)

13 
	#CLONE_FILES
 0x00000400

	)

14 
	#CLONE_SIGHAND
 0x00000800

	)

15 
	#CLONE_PIDFD
 0x00001000

	)

16 
	#CLONE_PTRACE
 0x00002000

	)

17 
	#CLONE_VFORK
 0x00004000

	)

18 
	#CLONE_PARENT
 0x00008000

	)

19 
	#CLONE_THREAD
 0x00010000

	)

20 
	#CLONE_NEWNS
 0x00020000

	)

21 
	#CLONE_SYSVSEM
 0x00040000

	)

22 
	#CLONE_SETTLS
 0x00080000

	)

23 
	#CLONE_PARENT_SETTID
 0x00100000

	)

24 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

25 
	#CLONE_DETACHED
 0x00400000

	)

26 
	#CLONE_UNTRACED
 0x00800000

	)

27 
	#CLONE_CHILD_SETTID
 0x01000000

	)

28 
	#CLONE_NEWCGROUP
 0x02000000

	)

29 
	#CLONE_NEWUTS
 0x04000000

	)

30 
	#CLONE_NEWIPC
 0x08000000

	)

31 
	#CLONE_NEWUSER
 0x10000000

	)

32 
	#CLONE_NEWPID
 0x20000000

	)

33 
	#CLONE_NEWNET
 0x40000000

	)

34 
	#CLONE_IO
 0x80000000

	)

36 #i‚de‡
__ASSEMBLY__


66 
	s˛⁄e_¨gs
 {

67 
__Æig√d_u64
 
	mÊags
;

68 
__Æig√d_u64
 
	mpidfd
;

69 
__Æig√d_u64
 
	mchûd_tid
;

70 
__Æig√d_u64
 
	m∑ª¡_tid
;

71 
__Æig√d_u64
 
	mexô_sig«l
;

72 
__Æig√d_u64
 
	m°ack
;

73 
__Æig√d_u64
 
	m°ack_size
;

74 
__Æig√d_u64
 
	més
;

78 
	#CLONE_ARGS_SIZE_VER0
 64

	)

83 
	#SCHED_NORMAL
 0

	)

84 
	#SCHED_FIFO
 1

	)

85 
	#SCHED_RR
 2

	)

86 
	#SCHED_BATCH
 3

	)

88 
	#SCHED_IDLE
 5

	)

89 
	#SCHED_DEADLINE
 6

	)

92 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

97 
	#SCHED_FLAG_RESET_ON_FORK
 0x01

	)

98 
	#SCHED_FLAG_RECLAIM
 0x02

	)

99 
	#SCHED_FLAG_DL_OVERRUN
 0x04

	)

100 
	#SCHED_FLAG_KEEP_POLICY
 0x08

	)

101 
	#SCHED_FLAG_KEEP_PARAMS
 0x10

	)

102 
	#SCHED_FLAG_UTIL_CLAMP_MIN
 0x20

	)

103 
	#SCHED_FLAG_UTIL_CLAMP_MAX
 0x40

	)

105 
	#SCHED_FLAG_KEEP_ALL
 (
SCHED_FLAG_KEEP_POLICY
 | \

106 
SCHED_FLAG_KEEP_PARAMS
)

	)

108 
	#SCHED_FLAG_UTIL_CLAMP
 (
SCHED_FLAG_UTIL_CLAMP_MIN
 | \

109 
SCHED_FLAG_UTIL_CLAMP_MAX
)

	)

111 
	#SCHED_FLAG_ALL
 (
SCHED_FLAG_RESET_ON_FORK
 | \

112 
SCHED_FLAG_RECLAIM
 | \

113 
SCHED_FLAG_DL_OVERRUN
 | \

114 
SCHED_FLAG_KEEP_ALL
 | \

115 
SCHED_FLAG_UTIL_CLAMP
)

	)

	@/usr/include/linux/signal.h

2 #i‚de‡
_LINUX_SIGNAL_H


3 
	#_LINUX_SIGNAL_H


	)

5 
	~<asm/sig«l.h
>

6 
	~<asm/sigöfo.h
>

8 
	#SS_ONSTACK
 1

	)

9 
	#SS_DISABLE
 2

	)

12 
	#SS_AUTODISARM
 (1U << 31Ë

	)

14 
	#SS_FLAG_BITS
 
SS_AUTODISARM


	)

	@/usr/include/linux/types.h

2 #i‚de‡
_LINUX_TYPES_H


3 
	#_LINUX_TYPES_H


	)

5 
	~<asm/ty≥s.h
>

7 #i‚de‡
__ASSEMBLY__


9 
	~<löux/posix_ty≥s.h
>

17 #ifde‡
__CHECKER__


18 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

20 
	#__bôwi£__


	)

22 
	#__bôwi£
 
__bôwi£__


	)

24 
__u16
 
	t__bôwi£
 
	t__À16
;

25 
__u16
 
	t__bôwi£
 
	t__be16
;

26 
__u32
 
	t__bôwi£
 
	t__À32
;

27 
__u32
 
	t__bôwi£
 
	t__be32
;

28 
__u64
 
	t__bôwi£
 
	t__À64
;

29 
__u64
 
	t__bôwi£
 
	t__be64
;

31 
__u16
 
	t__bôwi£
 
	t__sum16
;

32 
__u32
 
	t__bôwi£
 
	t__wsum
;

43 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

44 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

45 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	t__bôwi£
 
	t__pﬁl_t
;

	@/usr/include/linux/udp.h

18 #i‚de‡
_LINUX_UDP_H


19 
	#_LINUX_UDP_H


	)

21 
	~<löux/ty≥s.h
>

23 
	sudphdr
 {

24 
__be16
 
	msour˚
;

25 
__be16
 
	mde°
;

26 
__be16
 
	mÀn
;

27 
__sum16
 
	mcheck
;

31 
	#UDP_CORK
 1

	)

32 
	#UDP_ENCAP
 100

	)

33 
	#UDP_NO_CHECK6_TX
 101

	)

34 
	#UDP_NO_CHECK6_RX
 102

	)

35 
	#UDP_SEGMENT
 103

	)

36 
	#UDP_GRO
 104

	)

39 
	#UDP_ENCAP_ESPINUDP_NON_IKE
 1

	)

40 
	#UDP_ENCAP_ESPINUDP
 2

	)

41 
	#UDP_ENCAP_L2TPINUDP
 3

	)

42 
	#UDP_ENCAP_GTP0
 4

	)

43 
	#UDP_ENCAP_GTP1U
 5

	)

44 
	#UDP_ENCAP_RXRPC
 6

	)

	@/usr/include/linux/version.h

1 
	#LINUX_VERSION_CODE
 328914

	)

2 
	#KERNEL_VERSION
(
a
,
b
,
c
Ë((◊Ë<< 16Ë+ ((bË<< 8Ë+ ((cË> 255 ? 255 : (c)))

	)

	@/usr/include/linux/wait.h

2 #i‚de‡
_LINUX_WAIT_H


3 
	#_LINUX_WAIT_H


	)

5 
	#WNOHANG
 0x00000001

	)

6 
	#WUNTRACED
 0x00000002

	)

7 
	#WSTOPPED
 
WUNTRACED


	)

8 
	#WEXITED
 0x00000004

	)

9 
	#WCONTINUED
 0x00000008

	)

10 
	#WNOWAIT
 0x01000000

	)

12 
	#__WNOTHREAD
 0x20000000

	)

13 
	#__WALL
 0x40000000

	)

14 
	#__WCLONE
 0x80000000

	)

17 
	#P_ALL
 0

	)

18 
	#P_PID
 1

	)

19 
	#P_PGID
 2

	)

20 
	#P_PIDFD
 3

	)

	@/usr/include/locale.h

22 #i‚def 
_LOCALE_H


23 
	#_LOCALE_H
 1

	)

25 
	~<„©uªs.h
>

27 
	#__√ed_NULL


	)

28 
	~<°ddef.h
>

29 
	~<bôs/loˇÀ.h
>

31 
	g__BEGIN_DECLS


35 
	#LC_CTYPE
 
__LC_CTYPE


	)

36 
	#LC_NUMERIC
 
__LC_NUMERIC


	)

37 
	#LC_TIME
 
__LC_TIME


	)

38 
	#LC_COLLATE
 
__LC_COLLATE


	)

39 
	#LC_MONETARY
 
__LC_MONETARY


	)

40 
	#LC_MESSAGES
 
__LC_MESSAGES


	)

41 
	#LC_ALL
 
__LC_ALL


	)

42 
	#LC_PAPER
 
__LC_PAPER


	)

43 
	#LC_NAME
 
__LC_NAME


	)

44 
	#LC_ADDRESS
 
__LC_ADDRESS


	)

45 
	#LC_TELEPHONE
 
__LC_TELEPHONE


	)

46 
	#LC_MEASUREMENT
 
__LC_MEASUREMENT


	)

47 
	#LC_IDENTIFICATION
 
__LC_IDENTIFICATION


	)

51 
	slc⁄v


55 *
	mdecimÆ_poöt
;

56 *
	mthoußnds_£p
;

62 *
	mgroupög
;

68 *
	möt_cuº_symbﬁ
;

69 *
	mcuºícy_symbﬁ
;

70 *
	mm⁄_decimÆ_poöt
;

71 *
	mm⁄_thoußnds_£p
;

72 *
	mm⁄_groupög
;

73 *
	mposôive_sign
;

74 *
	m√g©ive_sign
;

75 
	möt_‰ac_digôs
;

76 
	m‰ac_digôs
;

78 
	mp_cs_¥e˚des
;

80 
	mp_£p_by_•a˚
;

82 
	mn_cs_¥e˚des
;

84 
	mn_£p_by_•a˚
;

91 
	mp_sign_po¢
;

92 
	mn_sign_po¢
;

93 #ifde‡
__USE_ISOC99


95 
	möt_p_cs_¥e˚des
;

97 
	möt_p_£p_by_•a˚
;

99 
	möt_n_cs_¥e˚des
;

101 
	möt_n_£p_by_•a˚
;

108 
	möt_p_sign_po¢
;

109 
	möt_n_sign_po¢
;

111 
	m__öt_p_cs_¥e˚des
;

112 
	m__öt_p_£p_by_•a˚
;

113 
	m__öt_n_cs_¥e˚des
;

114 
	m__öt_n_£p_by_•a˚
;

115 
	m__öt_p_sign_po¢
;

116 
	m__öt_n_sign_po¢
;

122 *
	$£éoˇÀ
 (
__ˇãg‹y
, c⁄° *
__loˇÀ
Ë
__THROW
;

125 
lc⁄v
 *
	$loˇÀc⁄v
 (Ë
__THROW
;

128 #ifdef 
__USE_XOPEN2K8


135 
	~<bôs/ty≥s/loˇÀ_t.h
>

141 
loˇÀ_t
 
	$√wloˇÀ
 (
__ˇãg‹y_mask
, c⁄° *
__loˇÀ
,

142 
loˇÀ_t
 
__ba£
Ë
__THROW
;

148 
	#LC_CTYPE_MASK
 (1 << 
__LC_CTYPE
)

	)

149 
	#LC_NUMERIC_MASK
 (1 << 
__LC_NUMERIC
)

	)

150 
	#LC_TIME_MASK
 (1 << 
__LC_TIME
)

	)

151 
	#LC_COLLATE_MASK
 (1 << 
__LC_COLLATE
)

	)

152 
	#LC_MONETARY_MASK
 (1 << 
__LC_MONETARY
)

	)

153 
	#LC_MESSAGES_MASK
 (1 << 
__LC_MESSAGES
)

	)

154 
	#LC_PAPER_MASK
 (1 << 
__LC_PAPER
)

	)

155 
	#LC_NAME_MASK
 (1 << 
__LC_NAME
)

	)

156 
	#LC_ADDRESS_MASK
 (1 << 
__LC_ADDRESS
)

	)

157 
	#LC_TELEPHONE_MASK
 (1 << 
__LC_TELEPHONE
)

	)

158 
	#LC_MEASUREMENT_MASK
 (1 << 
__LC_MEASUREMENT
)

	)

159 
	#LC_IDENTIFICATION_MASK
 (1 << 
__LC_IDENTIFICATION
)

	)

160 
	#LC_ALL_MASK
 (
LC_CTYPE_MASK
 \

161 | 
LC_NUMERIC_MASK
 \

162 | 
LC_TIME_MASK
 \

163 | 
LC_COLLATE_MASK
 \

164 | 
LC_MONETARY_MASK
 \

165 | 
LC_MESSAGES_MASK
 \

166 | 
LC_PAPER_MASK
 \

167 | 
LC_NAME_MASK
 \

168 | 
LC_ADDRESS_MASK
 \

169 | 
LC_TELEPHONE_MASK
 \

170 | 
LC_MEASUREMENT_MASK
 \

171 | 
LC_IDENTIFICATION_MASK
 \

172 )

	)

176 
loˇÀ_t
 
	$du∂oˇÀ
 (
loˇÀ_t
 
__d©a£t
Ë
__THROW
;

180 
	$‰ìloˇÀ
 (
loˇÀ_t
 
__d©a£t
Ë
__THROW
;

187 
loˇÀ_t
 
	$u£loˇÀ
 (
loˇÀ_t
 
__d©a£t
Ë
__THROW
;

191 
	#LC_GLOBAL_LOCALE
 ((
loˇÀ_t
Ë-1L)

	)

195 
__END_DECLS


	@/usr/include/malloc.h

19 #i‚de‡
_MALLOC_H


20 
	#_MALLOC_H
 1

	)

22 
	~<„©uªs.h
>

23 
	~<°ddef.h
>

24 
	~<°dio.h
>

26 #ifde‡
_LIBC


27 
	#__MALLOC_HOOK_VOLATILE


	)

28 
	#__MALLOC_DEPRECATED


	)

30 
	#__MALLOC_HOOK_VOLATILE
 vﬁ©ûe

	)

31 
	#__MALLOC_DEPRECATED
 
__©åibuã_dïªˇãd__


	)

35 
__BEGIN_DECLS


38 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__


39 
	`__©åibuã_Æloc_size__
 ((1)Ë
__wur
;

42 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

43 
__THROW
 
__©åibuã_mÆloc__
 
	`__©åibuã_Æloc_size__
 ((1, 2)Ë
__wur
;

50 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

51 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
 
	`__©åibuã_Æloc_size__
 ((2));

58 *
	$ªÆloˇºay
 (*
__±r
, 
size_t
 
__nmemb
, size_à
__size
)

59 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
 
	`__©åibuã_Æloc_size__
 ((2, 3));

62 
	$‰ì
 (*
__±r
Ë
__THROW
;

65 *
	$memÆign
 (
size_t
 
__Æignmít
, size_à
__size
)

66 
__THROW
 
__©åibuã_mÆloc__
 
	`__©åibuã_Æloc_size__
 ((2)Ë
__wur
;

69 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__


70 
	`__©åibuã_Æloc_size__
 ((1)Ë
__wur
;

74 *
	$pvÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

78 *(*
__m‹ec‹e
Ë(
±rdiff_t
 
__size
);

81 *
	$__deÁu…_m‹ec‹e
 (
±rdiff_t
 
__size
)

82 
__THROW
 
__©åibuã_mÆloc__
;

86 
	smÆlöfo


88 
¨ía
;

89 
‹dblks
;

90 
smblks
;

91 
hblks
;

92 
hblkhd
;

93 
usmblks
;

94 
fsmblks
;

95 
u‹dblks
;

96 
f‹dblks
;

97 
kìpco°
;

101 
mÆlöfo
 
	$mÆlöfo
 (Ë
__THROW
;

104 #i‚de‡
M_MXFAST


105 
	#M_MXFAST
 1

	)

107 #i‚de‡
M_NLBLKS


108 
	#M_NLBLKS
 2

	)

110 #i‚de‡
M_GRAIN


111 
	#M_GRAIN
 3

	)

113 #i‚de‡
M_KEEP


114 
	#M_KEEP
 4

	)

118 
	#M_TRIM_THRESHOLD
 -1

	)

119 
	#M_TOP_PAD
 -2

	)

120 
	#M_MMAP_THRESHOLD
 -3

	)

121 
	#M_MMAP_MAX
 -4

	)

122 
	#M_CHECK_ACTION
 -5

	)

123 
	#M_PERTURB
 -6

	)

124 
	#M_ARENA_TEST
 -7

	)

125 
	#M_ARENA_MAX
 -8

	)

128 
	$mÆl›t
 (
__∑øm
, 
__vÆ
Ë
__THROW
;

132 
	$mÆloc_åim
 (
size_t
 
__∑d
Ë
__THROW
;

136 
size_t
 
	$mÆloc_ußbÀ_size
 (*
__±r
Ë
__THROW
;

139 
	$mÆloc_°©s
 (Ë
__THROW
;

142 
	$mÆloc_öfo
 (
__›ti⁄s
, 
FILE
 *
__Â
Ë
__THROW
;

145 (*
__MALLOC_HOOK_VOLATILE
 
__‰ì_hook
Ë(*
__±r
,

147 
__MALLOC_DEPRECATED
;

148 *(*
__MALLOC_HOOK_VOLATILE
 
__mÆloc_hook
)(
size_t
 
__size
,

150 
__MALLOC_DEPRECATED
;

151 *(*
__MALLOC_HOOK_VOLATILE
 
__ªÆloc_hook
)(*
__±r
,

152 
size_t
 
__size
,

154 
__MALLOC_DEPRECATED
;

155 *(*
__MALLOC_HOOK_VOLATILE
 
__memÆign_hook
)(
size_t
 
__Æignmít
,

156 
size_t
 
__size
,

158 
__MALLOC_DEPRECATED
;

159 (*
__MALLOC_HOOK_VOLATILE
 
__a·î_m‹ec‹e_hook
) ();

162 
__END_DECLS


	@/usr/include/math.h

23 #i‚def 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

27 
	~<bôs/libc-hódî-°¨t.h
>

29 #i‡
deföed
 
log
 && deföed 
__GNUC__


30 #w¨nög 
A
 
ma¸o
 
ˇŒed
 
log
 
was
 
Æªady
 
deföed
 
whí
 <
m©h
.
h
> wa†
ö˛uded
.

31 #w¨nög 
This
 
wûl
 
ˇu£
 
compû©i⁄
 
¥obÀms
.

34 
	g__BEGIN_DECLS


37 
	~<bôs/ty≥s.h
>

40 
	~<bôs/m©h-ve˘‹.h
>

43 
	~<bôs/Êﬂä.h
>

47 #i‡
__GNUC_PREREQ
 (3, 3)

48 
	#HUGE_VAL
 (
	`__buûtö_huge_vÆ
 ())

	)

55 
	#HUGE_VAL
 1e10000

	)

57 #ifde‡
__USE_ISOC99


58 #i‡
__GNUC_PREREQ
 (3, 3)

59 
	#HUGE_VALF
 (
	`__buûtö_huge_vÆf
 ())

	)

60 
	#HUGE_VALL
 (
	`__buûtö_huge_vÆl
 ())

	)

62 
	#HUGE_VALF
 1e10000f

	)

63 
	#HUGE_VALL
 1e10000L

	)

66 #i‡
__HAVE_FLOAT16
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

67 
	#HUGE_VAL_F16
 (
	`__buûtö_huge_vÆf16
 ())

	)

69 #i‡
__HAVE_FLOAT32
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

70 
	#HUGE_VAL_F32
 (
	`__buûtö_huge_vÆf32
 ())

	)

72 #i‡
__HAVE_FLOAT64
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

73 
	#HUGE_VAL_F64
 (
	`__buûtö_huge_vÆf64
 ())

	)

75 #i‡
__HAVE_FLOAT128
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

76 
	#HUGE_VAL_F128
 (
	`__buûtö_huge_vÆf128
 ())

	)

78 #i‡
__HAVE_FLOAT32X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

79 
	#HUGE_VAL_F32X
 (
	`__buûtö_huge_vÆf32x
 ())

	)

81 #i‡
__HAVE_FLOAT64X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

82 
	#HUGE_VAL_F64X
 (
	`__buûtö_huge_vÆf64x
 ())

	)

84 #i‡
__HAVE_FLOAT128X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

85 
	#HUGE_VAL_F128X
 (
	`__buûtö_huge_vÆf128x
 ())

	)

88 #ifde‡
__USE_ISOC99


90 #i‡
__GNUC_PREREQ
 (3, 3)

91 
	#INFINITY
 (
	`__buûtö_öff
 ())

	)

93 
	#INFINITY
 
HUGE_VALF


	)

97 #i‡
__GNUC_PREREQ
 (3, 3)

98 
	#NAN
 (
	`__buûtö_«nf
 (""))

	)

103 
	#NAN
 (0.0‡/ 0.0f)

	)

107 #i‡
__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

109 #i‡
__GNUC_PREREQ
 (3, 3)

110 
	#SNANF
 (
	`__buûtö_«nsf
 (""))

	)

111 
	#SNAN
 (
	`__buûtö_«ns
 (""))

	)

112 
	#SNANL
 (
	`__buûtö_«n¶
 (""))

	)

115 #i‡
__HAVE_FLOAT16
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

116 
	#SNANF16
 (
	`__buûtö_«nsf16
 (""))

	)

118 #i‡
__HAVE_FLOAT32
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

119 
	#SNANF32
 (
	`__buûtö_«nsf32
 (""))

	)

121 #i‡
__HAVE_FLOAT64
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

122 
	#SNANF64
 (
	`__buûtö_«nsf64
 (""))

	)

124 #i‡
__HAVE_FLOAT128
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

125 
	#SNANF128
 (
	`__buûtö_«nsf128
 (""))

	)

127 #i‡
__HAVE_FLOAT32X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

128 
	#SNANF32X
 (
	`__buûtö_«nsf32x
 (""))

	)

130 #i‡
__HAVE_FLOAT64X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

131 
	#SNANF64X
 (
	`__buûtö_«nsf64x
 (""))

	)

133 #i‡
__HAVE_FLOAT128X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

134 
	#SNANF128X
 (
	`__buûtö_«nsf128x
 (""))

	)

138 
	~<bôs/Êt-evÆ-mëhod.h
>

140 #ifde‡
__USE_ISOC99


148 #i‡
__GLIBC_FLT_EVAL_METHOD
 == 0 || __GLIBC_FLT_EVAL_METHOD == 16

149 
	tÊﬂt_t
;

150 
	tdoubÀ_t
;

151 #ñi‡
__GLIBC_FLT_EVAL_METHOD
 == 1

152 
	tÊﬂt_t
;

153 
	tdoubÀ_t
;

154 #ñi‡
__GLIBC_FLT_EVAL_METHOD
 == 2

155 
	tÊﬂt_t
;

156 
	tdoubÀ_t
;

157 #ñi‡
__GLIBC_FLT_EVAL_METHOD
 == 32

158 
_Flﬂt32
 
	tÊﬂt_t
;

159 
	tdoubÀ_t
;

160 #ñi‡
__GLIBC_FLT_EVAL_METHOD
 == 33

161 
_Flﬂt32x
 
	tÊﬂt_t
;

162 
_Flﬂt32x
 
	tdoubÀ_t
;

163 #ñi‡
__GLIBC_FLT_EVAL_METHOD
 == 64

164 
_Flﬂt64
 
	tÊﬂt_t
;

165 
_Flﬂt64
 
	tdoubÀ_t
;

166 #ñi‡
__GLIBC_FLT_EVAL_METHOD
 == 65

167 
_Flﬂt64x
 
	tÊﬂt_t
;

168 
_Flﬂt64x
 
	tdoubÀ_t
;

169 #ñi‡
__GLIBC_FLT_EVAL_METHOD
 == 128

170 
_Flﬂt128
 
	tÊﬂt_t
;

171 
_Flﬂt128
 
	tdoubÀ_t
;

172 #ñi‡
__GLIBC_FLT_EVAL_METHOD
 == 129

173 
_Flﬂt128x
 
	tÊﬂt_t
;

174 
_Flﬂt128x
 
	tdoubÀ_t
;

190 
	~<bôs/Â-logb.h
>

191 #ifde‡
__USE_ISOC99


192 #i‡
__FP_LOGB0_IS_MIN


193 
	#FP_ILOGB0
 (-2147483647 - 1)

	)

195 
	#FP_ILOGB0
 (-2147483647)

	)

197 #i‡
__FP_LOGBNAN_IS_MIN


198 
	#FP_ILOGBNAN
 (-2147483647 - 1)

	)

200 
	#FP_ILOGBNAN
 2147483647

	)

203 #i‡
__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

204 #i‡
__WORDSIZE
 == 32

205 
	#__FP_LONG_MAX
 0x7fffffffL

	)

207 
	#__FP_LONG_MAX
 0x7fffffffffffffffL

	)

209 #i‡
__FP_LOGB0_IS_MIN


210 
	#FP_LLOGB0
 (-
__FP_LONG_MAX
 - 1)

	)

212 
	#FP_LLOGB0
 (-
__FP_LONG_MAX
)

	)

214 #i‡
__FP_LOGBNAN_IS_MIN


215 
	#FP_LLOGBNAN
 (-
__FP_LONG_MAX
 - 1)

	)

217 
	#FP_LLOGBNAN
 
__FP_LONG_MAX


	)

233 
	~<bôs/Â-Á°.h
>

235 #i‡
__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

239 
	mFP_INT_UPWARD
 =

240 
	#FP_INT_UPWARD
 0

	)

241 
FP_INT_UPWARD
,

242 
	mFP_INT_DOWNWARD
 =

243 
	#FP_INT_DOWNWARD
 1

	)

244 
FP_INT_DOWNWARD
,

245 
	mFP_INT_TOWARDZERO
 =

246 
	#FP_INT_TOWARDZERO
 2

	)

247 
FP_INT_TOWARDZERO
,

248 
	mFP_INT_TONEARESTFROMZERO
 =

249 
	#FP_INT_TONEARESTFROMZERO
 3

	)

250 
FP_INT_TONEARESTFROMZERO
,

251 
	mFP_INT_TONEAREST
 =

252 
	#FP_INT_TONEAREST
 4

	)

253 
FP_INT_TONEAREST
,

262 
	#__SIMD_DECL
(
fun˘i⁄
Ë
	`__CONCAT
 (
__DECL_SIMD_
, fun˘i⁄)

	)

264 
	#__MATHCALL_VEC
(
fun˘i⁄
, 
suffix
, 
¨gs
) \

265 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
fun˘i⁄
, 
suffix
)) \

266 
	`__MATHCALL
 (
fun˘i⁄
, 
suffix
, 
¨gs
)

	)

268 
	#__MATHDECL_VEC
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

269 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
fun˘i⁄
, 
suffix
)) \

270 
	`__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
)

	)

272 
	#__MATHCALL
(
fun˘i⁄
,
suffix
, 
¨gs
) \

273 
	`__MATHDECL
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
)

	)

274 
	#__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

275 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
); \

276 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
)

	)

277 
	#__MATHCALLX
(
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

278 
	`__MATHDECLX
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
)

	)

279 
	#__MATHDECLX
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

280 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
); \

281 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
)

	)

282 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

283 
ty≥
 
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
Ë
¨gs
 
__THROW


	)

285 
	#_MdoubÀ_
 

	)

286 
	#__MATH_PRECNAME
(
«me
,
r
Ë
	`__CONCAT
“ame,r)

	)

287 
	#__MATH_DECLARING_DOUBLE
 1

	)

288 
	#__MATH_DECLARING_FLOATN
 0

	)

289 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

290 
	~<bôs/m©hˇŒs.h
>

291 #unde‡
_MdoubÀ_


292 #unde‡
__MATH_PRECNAME


293 #unde‡
__MATH_DECLARING_DOUBLE


294 #unde‡
__MATH_DECLARING_FLOATN


296 #ifde‡
__USE_ISOC99


302 
	#_MdoubÀ_
 

	)

303 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f
##
	)
r

304 
	#__MATH_DECLARING_DOUBLE
 0

	)

305 
	#__MATH_DECLARING_FLOATN
 0

	)

306 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

307 
	~<bôs/m©hˇŒs.h
>

308 #unde‡
_MdoubÀ_


309 #unde‡
__MATH_PRECNAME


310 #unde‡
__MATH_DECLARING_DOUBLE


311 #unde‡
__MATH_DECLARING_FLOATN


313 #i‡!(
deföed
 
__NO_LONG_DOUBLE_MATH
 && deföed 
_LIBC
) \

314 || 
deföed
 
__LDBL_COMPAT
 \

315 || 
deföed
 
_LIBC_TEST


316 #ifde‡
__LDBL_COMPAT


318 #ifde‡
__USE_ISOC99


319 
	$__∆dbl_√xâow¨df
 (
__x
, 
__y
)

320 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

321 #ifde‡
__REDIRECT_NTH


322 
	`__REDIRECT_NTH
 (
√xâow¨df
, (
__x
, 
__y
),

323 
__∆dbl_√xâow¨df
)

324 
	`__©åibuã__
 ((
__c⁄°__
));

325 
	`__REDIRECT_NTH
 (
√xâow¨d
, (
__x
, 
__y
),

326 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

327 
	`__REDIRECT_NTH
 (
√xâow¨dl
,

328 (
__x
, 
__y
),

329 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

333 #unde‡
__MATHDECL_1


334 
	#__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
Æüs
) \

335 
ty≥
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
), \

336 
¨gs
, 
Æüs
)

	)

337 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

338 
	`__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
	`__CONCAT
(fun˘i⁄,suffix))

	)

344 
	#_MdoubÀ_
 

	)

345 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
l
##
	)
r

346 
	#__MATH_DECLARING_DOUBLE
 0

	)

347 
	#__MATH_DECLARING_FLOATN
 0

	)

348 
	#__MATH_DECLARE_LDOUBLE
 1

	)

349 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

350 
	~<bôs/m©hˇŒs.h
>

351 #unde‡
_MdoubÀ_


352 #unde‡
__MATH_PRECNAME


353 #unde‡
__MATH_DECLARING_DOUBLE


354 #unde‡
__MATH_DECLARING_FLOATN


363 #i‡
__HAVE_DISTINCT_FLOAT16
 || (
__HAVE_FLOAT16
 && !
deföed
 
_LIBC
)

364 
	#_MdoubÀ_
 
_Flﬂt16


	)

365 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f16
##
	)
r

366 
	#__MATH_DECLARING_DOUBLE
 0

	)

367 
	#__MATH_DECLARING_FLOATN
 1

	)

368 #i‡
__HAVE_DISTINCT_FLOAT16


369 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

371 #i‡
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

372 
	~<bôs/m©hˇŒs.h
>

374 #unde‡
_MdoubÀ_


375 #unde‡
__MATH_PRECNAME


376 #unde‡
__MATH_DECLARING_DOUBLE


377 #unde‡
__MATH_DECLARING_FLOATN


380 #i‡
__HAVE_DISTINCT_FLOAT32
 || (
__HAVE_FLOAT32
 && !
deföed
 
_LIBC
)

381 
	#_MdoubÀ_
 
_Flﬂt32


	)

382 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f32
##
	)
r

383 
	#__MATH_DECLARING_DOUBLE
 0

	)

384 
	#__MATH_DECLARING_FLOATN
 1

	)

385 #i‡
__HAVE_DISTINCT_FLOAT32


386 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

388 #i‡
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

389 
	~<bôs/m©hˇŒs.h
>

391 #unde‡
_MdoubÀ_


392 #unde‡
__MATH_PRECNAME


393 #unde‡
__MATH_DECLARING_DOUBLE


394 #unde‡
__MATH_DECLARING_FLOATN


397 #i‡
__HAVE_DISTINCT_FLOAT64
 || (
__HAVE_FLOAT64
 && !
deföed
 
_LIBC
)

398 
	#_MdoubÀ_
 
_Flﬂt64


	)

399 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f64
##
	)
r

400 
	#__MATH_DECLARING_DOUBLE
 0

	)

401 
	#__MATH_DECLARING_FLOATN
 1

	)

402 #i‡
__HAVE_DISTINCT_FLOAT64


403 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

405 #i‡
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

406 
	~<bôs/m©hˇŒs.h
>

408 #unde‡
_MdoubÀ_


409 #unde‡
__MATH_PRECNAME


410 #unde‡
__MATH_DECLARING_DOUBLE


411 #unde‡
__MATH_DECLARING_FLOATN


414 #i‡
__HAVE_DISTINCT_FLOAT128
 || (
__HAVE_FLOAT128
 && !
deföed
 
_LIBC
)

415 
	#_MdoubÀ_
 
_Flﬂt128


	)

416 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f128
##
	)
r

417 
	#__MATH_DECLARING_DOUBLE
 0

	)

418 
	#__MATH_DECLARING_FLOATN
 1

	)

419 #i‡
__HAVE_DISTINCT_FLOAT128


420 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

422 #i‡
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

423 
	~<bôs/m©hˇŒs.h
>

425 #unde‡
_MdoubÀ_


426 #unde‡
__MATH_PRECNAME


427 #unde‡
__MATH_DECLARING_DOUBLE


428 #unde‡
__MATH_DECLARING_FLOATN


431 #i‡
__HAVE_DISTINCT_FLOAT32X
 || (
__HAVE_FLOAT32X
 && !
deföed
 
_LIBC
)

432 
	#_MdoubÀ_
 
_Flﬂt32x


	)

433 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f32x
##
	)
r

434 
	#__MATH_DECLARING_DOUBLE
 0

	)

435 
	#__MATH_DECLARING_FLOATN
 1

	)

436 #i‡
__HAVE_DISTINCT_FLOAT32X


437 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

439 #i‡
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

440 
	~<bôs/m©hˇŒs.h
>

442 #unde‡
_MdoubÀ_


443 #unde‡
__MATH_PRECNAME


444 #unde‡
__MATH_DECLARING_DOUBLE


445 #unde‡
__MATH_DECLARING_FLOATN


448 #i‡
__HAVE_DISTINCT_FLOAT64X
 || (
__HAVE_FLOAT64X
 && !
deföed
 
_LIBC
)

449 
	#_MdoubÀ_
 
_Flﬂt64x


	)

450 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f64x
##
	)
r

451 
	#__MATH_DECLARING_DOUBLE
 0

	)

452 
	#__MATH_DECLARING_FLOATN
 1

	)

453 #i‡
__HAVE_DISTINCT_FLOAT64X


454 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

456 #i‡
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

457 
	~<bôs/m©hˇŒs.h
>

459 #unde‡
_MdoubÀ_


460 #unde‡
__MATH_PRECNAME


461 #unde‡
__MATH_DECLARING_DOUBLE


462 #unde‡
__MATH_DECLARING_FLOATN


465 #i‡
__HAVE_DISTINCT_FLOAT128X
 || (
__HAVE_FLOAT128X
 && !
deföed
 
_LIBC
)

466 
	#_MdoubÀ_
 
_Flﬂt128x


	)

467 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f128x
##
	)
r

468 
	#__MATH_DECLARING_DOUBLE
 0

	)

469 
	#__MATH_DECLARING_FLOATN
 1

	)

470 #i‡
__HAVE_DISTINCT_FLOAT128X


471 
	~<bôs/m©hˇŒs-hñ≥r-fun˘i⁄s.h
>

473 #i‡
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

474 
	~<bôs/m©hˇŒs.h
>

476 #unde‡
_MdoubÀ_


477 #unde‡
__MATH_PRECNAME


478 #unde‡
__MATH_DECLARING_DOUBLE


479 #unde‡
__MATH_DECLARING_FLOATN


482 #unde‡
__MATHDECL_1


483 #unde‡
__MATHDECL


484 #unde‡
__MATHCALL


487 
	#__MATHCALL_NARROW_ARGS_1
 (
_M¨g_
 
__x
)

	)

488 
	#__MATHCALL_NARROW_ARGS_2
 (
_M¨g_
 
__x
, _M¨g_ 
__y
)

	)

489 
	#__MATHCALL_NARROW_ARGS_3
 (
_M¨g_
 
__x
, _M¨g_ 
__y
, _M¨g_ 
__z
)

	)

490 
	#__MATHCALL_NARROW_NORMAL
(
func
, 
«rgs
) \

491 
_Mªt_
 
func
 
__MATHCALL_NARROW_ARGS_
 ## 
«rgs
 
__THROW


	)

492 
	#__MATHCALL_NARROW_REDIR
(
func
, 
ªdú
, 
«rgs
) \

493 
_Mªt_
 
	`__REDIRECT_NTH
 (
func
, 
__MATHCALL_NARROW_ARGS_
 ## 
«rgs
, \

494 
ªdú
)

	)

495 
	#__MATHCALL_NARROW
(
func
, 
ªdú
, 
«rgs
) \

496 
	`__MATHCALL_NARROW_NORMAL
 (
func
, 
«rgs
)

	)

498 #i‡
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

500 
	#_Mªt_
 

	)

501 
	#_M¨g_
 

	)

502 
	#__MATHCALL_NAME
(
«me
Ë
f
 ## 
	)
name

503 
	~<bôs/m©hˇŒs-«ºow.h
>

504 #unde‡
_Mªt_


505 #unde‡
_M¨g_


506 #unde‡
__MATHCALL_NAME


508 
	#_Mªt_
 

	)

509 
	#_M¨g_
 

	)

510 
	#__MATHCALL_NAME
(
«me
Ë
f
 ##Çamê## 
l


	)

511 #ifde‡
__LDBL_COMPAT


512 
	#__MATHCALL_REDIR_NAME
(
«me
Ë
f
 ## 
	)
name

513 #unde‡
__MATHCALL_NARROW


514 
	#__MATHCALL_NARROW
(
func
, 
ªdú
, 
«rgs
) \

515 
	`__MATHCALL_NARROW_REDIR
 (
func
, 
ªdú
, 
«rgs
)

	)

517 
	~<bôs/m©hˇŒs-«ºow.h
>

518 #unde‡
_Mªt_


519 #unde‡
_M¨g_


520 #unde‡
__MATHCALL_NAME


521 #ifde‡
__LDBL_COMPAT


522 #unde‡
__MATHCALL_REDIR_NAME


523 #unde‡
__MATHCALL_NARROW


524 
	#__MATHCALL_NARROW
(
func
, 
ªdú
, 
«rgs
) \

525 
	`__MATHCALL_NARROW_NORMAL
 (
func
, 
«rgs
)

	)

528 
	#_Mªt_
 

	)

529 
	#_M¨g_
 

	)

530 
	#__MATHCALL_NAME
(
«me
Ë
d
 ##Çamê## 
l


	)

531 #ifde‡
__LDBL_COMPAT


532 
	#__MATHCALL_REDIR_NAME
(
«me
Ë
__∆dbl_d
 ##Çamê## 
l


	)

533 #unde‡
__MATHCALL_NARROW


534 
	#__MATHCALL_NARROW
(
func
, 
ªdú
, 
«rgs
) \

535 
	`__MATHCALL_NARROW_REDIR
 (
func
, 
ªdú
, 
«rgs
)

	)

537 
	~<bôs/m©hˇŒs-«ºow.h
>

538 #unde‡
_Mªt_


539 #unde‡
_M¨g_


540 #unde‡
__MATHCALL_NAME


541 #ifde‡
__LDBL_COMPAT


542 #unde‡
__MATHCALL_REDIR_NAME


543 #unde‡
__MATHCALL_NARROW


544 
	#__MATHCALL_NARROW
(
func
, 
ªdú
, 
«rgs
) \

545 
	`__MATHCALL_NARROW_NORMAL
 (
func
, 
«rgs
)

	)

550 #i‡
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

552 #i‡
__HAVE_FLOAT16
 && 
__HAVE_FLOAT32


553 
	#_Mªt_
 
_Flﬂt16


	)

554 
	#_M¨g_
 
_Flﬂt32


	)

555 
	#__MATHCALL_NAME
(
«me
Ë
f16
 ##Çamê## 
f32


	)

556 
	~<bôs/m©hˇŒs-«ºow.h
>

557 #unde‡
_Mªt_


558 #unde‡
_M¨g_


559 #unde‡
__MATHCALL_NAME


562 #i‡
__HAVE_FLOAT16
 && 
__HAVE_FLOAT32X


563 
	#_Mªt_
 
_Flﬂt16


	)

564 
	#_M¨g_
 
_Flﬂt32x


	)

565 
	#__MATHCALL_NAME
(
«me
Ë
f16
 ##Çamê## 
f32x


	)

566 
	~<bôs/m©hˇŒs-«ºow.h
>

567 #unde‡
_Mªt_


568 #unde‡
_M¨g_


569 #unde‡
__MATHCALL_NAME


572 #i‡
__HAVE_FLOAT16
 && 
__HAVE_FLOAT64


573 
	#_Mªt_
 
_Flﬂt16


	)

574 
	#_M¨g_
 
_Flﬂt64


	)

575 
	#__MATHCALL_NAME
(
«me
Ë
f16
 ##Çamê## 
f64


	)

576 
	~<bôs/m©hˇŒs-«ºow.h
>

577 #unde‡
_Mªt_


578 #unde‡
_M¨g_


579 #unde‡
__MATHCALL_NAME


582 #i‡
__HAVE_FLOAT16
 && 
__HAVE_FLOAT64X


583 
	#_Mªt_
 
_Flﬂt16


	)

584 
	#_M¨g_
 
_Flﬂt64x


	)

585 
	#__MATHCALL_NAME
(
«me
Ë
f16
 ##Çamê## 
f64x


	)

586 
	~<bôs/m©hˇŒs-«ºow.h
>

587 #unde‡
_Mªt_


588 #unde‡
_M¨g_


589 #unde‡
__MATHCALL_NAME


592 #i‡
__HAVE_FLOAT16
 && 
__HAVE_FLOAT128


593 
	#_Mªt_
 
_Flﬂt16


	)

594 
	#_M¨g_
 
_Flﬂt128


	)

595 
	#__MATHCALL_NAME
(
«me
Ë
f16
 ##Çamê## 
f128


	)

596 
	~<bôs/m©hˇŒs-«ºow.h
>

597 #unde‡
_Mªt_


598 #unde‡
_M¨g_


599 #unde‡
__MATHCALL_NAME


602 #i‡
__HAVE_FLOAT16
 && 
__HAVE_FLOAT128X


603 
	#_Mªt_
 
_Flﬂt16


	)

604 
	#_M¨g_
 
_Flﬂt128x


	)

605 
	#__MATHCALL_NAME
(
«me
Ë
f16
 ##Çamê## 
f128x


	)

606 
	~<bôs/m©hˇŒs-«ºow.h
>

607 #unde‡
_Mªt_


608 #unde‡
_M¨g_


609 #unde‡
__MATHCALL_NAME


612 #i‡
__HAVE_FLOAT32
 && 
__HAVE_FLOAT32X


613 
	#_Mªt_
 
_Flﬂt32


	)

614 
	#_M¨g_
 
_Flﬂt32x


	)

615 
	#__MATHCALL_NAME
(
«me
Ë
f32
 ##Çamê## 
f32x


	)

616 
	~<bôs/m©hˇŒs-«ºow.h
>

617 #unde‡
_Mªt_


618 #unde‡
_M¨g_


619 #unde‡
__MATHCALL_NAME


622 #i‡
__HAVE_FLOAT32
 && 
__HAVE_FLOAT64


623 
	#_Mªt_
 
_Flﬂt32


	)

624 
	#_M¨g_
 
_Flﬂt64


	)

625 
	#__MATHCALL_NAME
(
«me
Ë
f32
 ##Çamê## 
f64


	)

626 
	~<bôs/m©hˇŒs-«ºow.h
>

627 #unde‡
_Mªt_


628 #unde‡
_M¨g_


629 #unde‡
__MATHCALL_NAME


632 #i‡
__HAVE_FLOAT32
 && 
__HAVE_FLOAT64X


633 
	#_Mªt_
 
_Flﬂt32


	)

634 
	#_M¨g_
 
_Flﬂt64x


	)

635 
	#__MATHCALL_NAME
(
«me
Ë
f32
 ##Çamê## 
f64x


	)

636 
	~<bôs/m©hˇŒs-«ºow.h
>

637 #unde‡
_Mªt_


638 #unde‡
_M¨g_


639 #unde‡
__MATHCALL_NAME


642 #i‡
__HAVE_FLOAT32
 && 
__HAVE_FLOAT128


643 
	#_Mªt_
 
_Flﬂt32


	)

644 
	#_M¨g_
 
_Flﬂt128


	)

645 
	#__MATHCALL_NAME
(
«me
Ë
f32
 ##Çamê## 
f128


	)

646 
	~<bôs/m©hˇŒs-«ºow.h
>

647 #unde‡
_Mªt_


648 #unde‡
_M¨g_


649 #unde‡
__MATHCALL_NAME


652 #i‡
__HAVE_FLOAT32
 && 
__HAVE_FLOAT128X


653 
	#_Mªt_
 
_Flﬂt32


	)

654 
	#_M¨g_
 
_Flﬂt128x


	)

655 
	#__MATHCALL_NAME
(
«me
Ë
f32
 ##Çamê## 
f128x


	)

656 
	~<bôs/m©hˇŒs-«ºow.h
>

657 #unde‡
_Mªt_


658 #unde‡
_M¨g_


659 #unde‡
__MATHCALL_NAME


662 #i‡
__HAVE_FLOAT32X
 && 
__HAVE_FLOAT64


663 
	#_Mªt_
 
_Flﬂt32x


	)

664 
	#_M¨g_
 
_Flﬂt64


	)

665 
	#__MATHCALL_NAME
(
«me
Ë
f32x
 ##Çamê## 
f64


	)

666 
	~<bôs/m©hˇŒs-«ºow.h
>

667 #unde‡
_Mªt_


668 #unde‡
_M¨g_


669 #unde‡
__MATHCALL_NAME


672 #i‡
__HAVE_FLOAT32X
 && 
__HAVE_FLOAT64X


673 
	#_Mªt_
 
_Flﬂt32x


	)

674 
	#_M¨g_
 
_Flﬂt64x


	)

675 
	#__MATHCALL_NAME
(
«me
Ë
f32x
 ##Çamê## 
f64x


	)

676 
	~<bôs/m©hˇŒs-«ºow.h
>

677 #unde‡
_Mªt_


678 #unde‡
_M¨g_


679 #unde‡
__MATHCALL_NAME


682 #i‡
__HAVE_FLOAT32X
 && 
__HAVE_FLOAT128


683 
	#_Mªt_
 
_Flﬂt32x


	)

684 
	#_M¨g_
 
_Flﬂt128


	)

685 
	#__MATHCALL_NAME
(
«me
Ë
f32x
 ##Çamê## 
f128


	)

686 
	~<bôs/m©hˇŒs-«ºow.h
>

687 #unde‡
_Mªt_


688 #unde‡
_M¨g_


689 #unde‡
__MATHCALL_NAME


692 #i‡
__HAVE_FLOAT32X
 && 
__HAVE_FLOAT128X


693 
	#_Mªt_
 
_Flﬂt32x


	)

694 
	#_M¨g_
 
_Flﬂt128x


	)

695 
	#__MATHCALL_NAME
(
«me
Ë
f32x
 ##Çamê## 
f128x


	)

696 
	~<bôs/m©hˇŒs-«ºow.h
>

697 #unde‡
_Mªt_


698 #unde‡
_M¨g_


699 #unde‡
__MATHCALL_NAME


702 #i‡
__HAVE_FLOAT64
 && 
__HAVE_FLOAT64X


703 
	#_Mªt_
 
_Flﬂt64


	)

704 
	#_M¨g_
 
_Flﬂt64x


	)

705 
	#__MATHCALL_NAME
(
«me
Ë
f64
 ##Çamê## 
f64x


	)

706 
	~<bôs/m©hˇŒs-«ºow.h
>

707 #unde‡
_Mªt_


708 #unde‡
_M¨g_


709 #unde‡
__MATHCALL_NAME


712 #i‡
__HAVE_FLOAT64
 && 
__HAVE_FLOAT128


713 
	#_Mªt_
 
_Flﬂt64


	)

714 
	#_M¨g_
 
_Flﬂt128


	)

715 
	#__MATHCALL_NAME
(
«me
Ë
f64
 ##Çamê## 
f128


	)

716 
	~<bôs/m©hˇŒs-«ºow.h
>

717 #unde‡
_Mªt_


718 #unde‡
_M¨g_


719 #unde‡
__MATHCALL_NAME


722 #i‡
__HAVE_FLOAT64
 && 
__HAVE_FLOAT128X


723 
	#_Mªt_
 
_Flﬂt64


	)

724 
	#_M¨g_
 
_Flﬂt128x


	)

725 
	#__MATHCALL_NAME
(
«me
Ë
f64
 ##Çamê## 
f128x


	)

726 
	~<bôs/m©hˇŒs-«ºow.h
>

727 #unde‡
_Mªt_


728 #unde‡
_M¨g_


729 #unde‡
__MATHCALL_NAME


732 #i‡
__HAVE_FLOAT64X
 && 
__HAVE_FLOAT128


733 
	#_Mªt_
 
_Flﬂt64x


	)

734 
	#_M¨g_
 
_Flﬂt128


	)

735 
	#__MATHCALL_NAME
(
«me
Ë
f64x
 ##Çamê## 
f128


	)

736 
	~<bôs/m©hˇŒs-«ºow.h
>

737 #unde‡
_Mªt_


738 #unde‡
_M¨g_


739 #unde‡
__MATHCALL_NAME


742 #i‡
__HAVE_FLOAT64X
 && 
__HAVE_FLOAT128X


743 
	#_Mªt_
 
_Flﬂt64x


	)

744 
	#_M¨g_
 
_Flﬂt128x


	)

745 
	#__MATHCALL_NAME
(
«me
Ë
f64x
 ##Çamê## 
f128x


	)

746 
	~<bôs/m©hˇŒs-«ºow.h
>

747 #unde‡
_Mªt_


748 #unde‡
_M¨g_


749 #unde‡
__MATHCALL_NAME


752 #i‡
__HAVE_FLOAT128
 && 
__HAVE_FLOAT128X


753 
	#_Mªt_
 
_Flﬂt128


	)

754 
	#_M¨g_
 
_Flﬂt128x


	)

755 
	#__MATHCALL_NAME
(
«me
Ë
f128
 ##Çamê## 
f128x


	)

756 
	~<bôs/m©hˇŒs-«ºow.h
>

757 #unde‡
_Mªt_


758 #unde‡
_M¨g_


759 #unde‡
__MATHCALL_NAME


764 #unde‡
__MATHCALL_NARROW_ARGS_1


765 #unde‡
__MATHCALL_NARROW_ARGS_2


766 #unde‡
__MATHCALL_NARROW_ARGS_3


767 #unde‡
__MATHCALL_NARROW_NORMAL


768 #unde‡
__MATHCALL_NARROW_REDIR


769 #unde‡
__MATHCALL_NARROW


771 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


773 
signgam
;

776 #i‡(
__HAVE_DISTINCT_FLOAT16
 \

777 || 
__HAVE_DISTINCT_FLOAT32
 \

778 || 
__HAVE_DISTINCT_FLOAT64
 \

779 || 
__HAVE_DISTINCT_FLOAT32X
 \

780 || 
__HAVE_DISTINCT_FLOAT64X
 \

781 || 
__HAVE_DISTINCT_FLOAT128X
)

794 #ifde‡
__NO_LONG_DOUBLE_MATH


795 #i‡
__HAVE_DISTINCT_FLOAT128


798 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

799 ( (
TG_ARG
Ë= (Ë? 
FUNC
 ## 
f
 
ARGS
 : FUNC ARGS)

	)

800 #ñi‡
__HAVE_DISTINCT_FLOAT128


801 #i‡
__HAVE_GENERIC_SELECTION


802 #i‡
__HAVE_FLOATN_NOT_TYPEDEF
 && 
__HAVE_FLOAT32


803 
	#__MATH_TG_F32
(
FUNC
, 
ARGS
Ë
_Flﬂt32
: FUNC ## 
f
 ARGS,

	)

805 
	#__MATH_TG_F32
(
FUNC
, 
ARGS
)

	)

807 #i‡
__HAVE_FLOATN_NOT_TYPEDEF
 && 
__HAVE_FLOAT64X


808 #i‡
__HAVE_FLOAT64X_LONG_DOUBLE


809 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
Ë
_Flﬂt64x
: FUNC ## 
l
 ARGS,

	)

811 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
Ë
_Flﬂt64x
: FUNC ## 
f128
 ARGS,

	)

814 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
)

	)

816 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

817 
	`_Gíîic
 ((
TG_ARG
), \

818 : 
FUNC
 ## 
f
 
ARGS
, \

819 
	`__MATH_TG_F32
 (
FUNC
, 
ARGS
) \

820 : 
FUNC
 
ARGS
, \

821 : 
FUNC
 ## 
l
 
ARGS
, \

822 
	`__MATH_TG_F64X
 (
FUNC
, 
ARGS
) \

823 
_Flﬂt128
: 
FUNC
 ## 
f128
 
ARGS
)

	)

825 #i‡
__HAVE_FLOATN_NOT_TYPEDEF


828 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

829 
__buûtö_choo£_ex¥
 \

830 (
	`__buûtö_ty≥s_com∑tibÀ_p
 (
	`__ty≥of
 (
TG_ARG
), ), \

831 
FUNC
 ## 
f
 
ARGS
, \

832 
__buûtö_choo£_ex¥
 \

833 (
	`__buûtö_ty≥s_com∑tibÀ_p
 (
	`__ty≥of
 (
TG_ARG
), ), \

834 
FUNC
 
ARGS
, \

835 
__buûtö_choo£_ex¥
 \

836 (
	`__buûtö_ty≥s_com∑tibÀ_p
 (
	`__ty≥of
 (
TG_ARG
), ), \

837 
FUNC
 ## 
l
 
ARGS
, \

838 
FUNC
 ## 
f128
 
ARGS
)))

	)

841 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

842 ( (
TG_ARG
) ==  () \

843 ? 
FUNC
 ## 
f
 
ARGS
 \

844 :  (
TG_ARG
) ==  () \

845 ? 
FUNC
 
ARGS
 \

846 : 
FUNC
 ## 
l
 
ARGS
)

	)

850 #ifde‡
__USE_ISOC99


855 
FP_NAN
 =

856 
	#FP_NAN
 0

	)

857 
FP_NAN
,

858 
FP_INFINITE
 =

859 
	#FP_INFINITE
 1

	)

860 
FP_INFINITE
,

861 
FP_ZERO
 =

862 
	#FP_ZERO
 2

	)

863 
FP_ZERO
,

864 
FP_SUBNORMAL
 =

865 
	#FP_SUBNORMAL
 3

	)

866 
FP_SUBNORMAL
,

867 
FP_NORMAL
 =

868 
	#FP_NORMAL
 4

	)

869 
FP_NORMAL


877 #i‡((
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__
) \

878 || 
	`__glibc_˛™g_¥îeq
 (2,8)) \

879 && (!
deföed
 
__OPTIMIZE_SIZE__
 || deföed 
__˝lu•lus
)

886 
	#Â˛assify
(
x
Ë
	`__buûtö_Â˛assify
 (
FP_NAN
, 
FP_INFINITE
, \

887 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

889 
	#Â˛assify
(
x
Ë
	`__MATH_TG
 ((x), 
__Â˛assify
, (x))

	)

893 #i‡
	`__GNUC_PREREQ
 (6,0Ë|| 
	`__glibc_˛™g_¥îeq
 (3,3)

894 
	#signbô
(
x
Ë
	`__buûtö_signbô
 (x)

	)

895 #ñi‡
deföed
 
__˝lu•lus


903 
	#signbô
(
x
Ë
	`__buûtö_signbôl
 (x)

	)

904 #ñi‡
	`__GNUC_PREREQ
 (4,0)

905 
	#signbô
(
x
Ë
	`__MATH_TG
 ((x), 
__buûtö_signbô
, (x))

	)

907 
	#signbô
(
x
Ë
	`__MATH_TG
 ((x), 
__signbô
, (x))

	)

911 #i‡(
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__
) \

912 || 
	$__glibc_˛™g_¥îeq
 (2,8)

913 
	#isföôe
(
x
Ë
	`__buûtö_isföôe
 (x)

	)

915 
	#isföôe
(
x
Ë
	`__MATH_TG
 ((x), 
__föôe
, (x))

	)

919 #i‡(
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__
) \

920 || 
	$__glibc_˛™g_¥îeq
 (2,8)

921 
	#i¢‹mÆ
(
x
Ë
	`__buûtö_i¢‹mÆ
 (x)

	)

923 
	#i¢‹mÆ
(
x
Ë(
	`Â˛assify
 (xË=
FP_NORMAL
)

	)

928 #i‡(
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__
) \

929 || 
	$__glibc_˛™g_¥îeq
 (2,8)

930 
	#i¢™
(
x
Ë
	`__buûtö_i¢™
 (x)

	)

932 
	#i¢™
(
x
Ë
	`__MATH_TG
 ((x), 
__i¢™
, (x))

	)

936 #i‡
__HAVE_DISTINCT_FLOAT128
 && !
	`__GNUC_PREREQ
 (7,0) \

937 && !
deföed
 
__SUPPORT_SNAN__
 && !deföed 
__˝lu•lus


943 
	#isöf
(
x
) \

944 (
	`__buûtö_ty≥s_com∑tibÀ_p
 (
	`__ty≥of
 (
x
), 
_Flﬂt128
) \

945 ? 
	`__isöff128
 (
x
Ë: 
	`__buûtö_isöf_sign
 (x))

	)

946 #ñi‡(
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__
) \

947 || 
	$__glibc_˛™g_¥îeq
 (3,7)

948 
	#isöf
(
x
Ë
	`__buûtö_isöf_sign
 (x)

	)

950 
	#isöf
(
x
Ë
	`__MATH_TG
 ((x), 
__isöf
, (x))

	)

954 
	#MATH_ERRNO
 1

	)

955 
	#MATH_ERREXCEPT
 2

	)

962 #ifde‡
__FAST_MATH__


963 
	#m©h_îrh™dlög
 0

	)

964 #ñi‡
deföed
 
__NO_MATH_ERRNO__


965 
	#m©h_îrh™dlög
 (
MATH_ERREXCEPT
)

	)

967 
	#m©h_îrh™dlög
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

972 #i‡
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

973 
	~<bôs/isˇn⁄iˇl.h
>

976 #i‚de‡
__˝lu•lus


977 
	#issig«lög
(
x
Ë
	`__MATH_TG
 ((x), 
__issig«lög
, (x))

	)

986 
ölöe
 
	`issig«lög
 (
__vÆ
Ë{  
	`__issig«lögf
 (__val); }

987 
ölöe
 
	`issig«lög
 (
__vÆ
Ë{  
	`__issig«lög
 (__val); }

988 
ölöe
 

989 
	`issig«lög
 (
__vÆ
)

991 #ifde‡
__NO_LONG_DOUBLE_MATH


992  
	`__issig«lög
 (
__vÆ
);

994  
	`__issig«lögl
 (
__vÆ
);

997 #i‡
__HAVE_FLOAT128_UNLIKE_LDBL


1000 
ölöe
 
	`issig«lög
 (
_Flﬂt128
 
__vÆ
Ë{  
	`__issig«lögf128
 (__val); }

1002 
	}
}

1006 
	#issubn‹mÆ
(
x
Ë(
	`Â˛assify
 (xË=
FP_SUBNORMAL
)

	)

1009 #i‚de‡
__˝lu•lus


1010 #ifde‡
__SUPPORT_SNAN__


1011 
	#iszîo
(
x
Ë(
	`Â˛assify
 (xË=
FP_ZERO
)

	)

1013 
	#iszîo
(
x
Ë(((
	`__ty≥of
 (x)Ë(x)Ë=0)

	)

1017 #ifde‡
__SUPPORT_SNAN__


1018 
ölöe
 

1019 
iszîo
 (
__vÆ
)

1021  
__Â˛assifyf
 (
__vÆ
Ë=
FP_ZERO
;

1023 
ölöe
 

1024 
iszîo
 (
__vÆ
)

1026  
__Â˛assify
 (
__vÆ
Ë=
FP_ZERO
;

1028 
ölöe
 

1029 
iszîo
 (
__vÆ
)

1031 #ifde‡
__NO_LONG_DOUBLE_MATH


1032  
__Â˛assify
 (
__vÆ
Ë=
FP_ZERO
;

1034  
__Â˛assifyl
 (
__vÆ
Ë=
FP_ZERO
;

1037 #i‡
__HAVE_FLOAT128_UNLIKE_LDBL


1040 
ölöe
 

1041 
iszîo
 (
_Flﬂt128
 
__vÆ
)

1043  
__Â˛assifyf128
 (
__vÆ
Ë=
FP_ZERO
;

1047 
ãm∂©e
 <
˛ass
 
__T
> 
ölöe
 
boﬁ


1048 
iszîo
 (
__T
 
__vÆ
)

1050  
__vÆ
 == 0;

1057 #ifde‡
__USE_XOPEN


1059 
	#MAXFLOAT
 3.40282347e+38F

	)

1064 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


1065 
	#M_E
 2.7182818284590452354

	)

1066 
	#M_LOG2E
 1.4426950408889634074

	)

1067 
	#M_LOG10E
 0.43429448190325182765

	)

1068 
	#M_LN2
 0.69314718055994530942

	)

1069 
	#M_LN10
 2.30258509299404568402

	)

1070 
	#M_PI
 3.14159265358979323846

	)

1071 
	#M_PI_2
 1.57079632679489661923

	)

1072 
	#M_PI_4
 0.78539816339744830962

	)

1073 
	#M_1_PI
 0.31830988618379067154

	)

1074 
	#M_2_PI
 0.63661977236758134308

	)

1075 
	#M_2_SQRTPI
 1.12837916709551257390

	)

1076 
	#M_SQRT2
 1.41421356237309504880

	)

1077 
	#M_SQRT1_2
 0.70710678118654752440

	)

1083 #ifde‡
__USE_GNU


1084 
	#M_El
 2.718281828459045235360287471352662498L

	)

1085 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

1086 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

1087 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

1088 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

1089 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

1090 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

1091 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

1092 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

1093 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

1094 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

1095 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

1096 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

1099 #i‡
__HAVE_FLOAT16
 && 
deföed
 
__USE_GNU


1100 
	#M_Ef16
 
	`__f16
 (2.718281828459045235360287471352662498Ë

	)

1101 
	#M_LOG2Ef16
 
	`__f16
 (1.442695040888963407359924681001892137Ë

	)

1102 
	#M_LOG10Ef16
 
	`__f16
 (0.434294481903251827651128918916605082Ë

	)

1103 
	#M_LN2f16
 
	`__f16
 (0.693147180559945309417232121458176568Ë

	)

1104 
	#M_LN10f16
 
	`__f16
 (2.302585092994045684017991454684364208Ë

	)

1105 
	#M_PIf16
 
	`__f16
 (3.141592653589793238462643383279502884Ë

	)

1106 
	#M_PI_2f16
 
	`__f16
 (1.570796326794896619231321691639751442Ë

	)

1107 
	#M_PI_4f16
 
	`__f16
 (0.785398163397448309615660845819875721Ë

	)

1108 
	#M_1_PIf16
 
	`__f16
 (0.318309886183790671537767526745028724Ë

	)

1109 
	#M_2_PIf16
 
	`__f16
 (0.636619772367581343075535053490057448Ë

	)

1110 
	#M_2_SQRTPIf16
 
	`__f16
 (1.128379167095512573896158903121545172Ë

	)

1111 
	#M_SQRT2f16
 
	`__f16
 (1.414213562373095048801688724209698079Ë

	)

1112 
	#M_SQRT1_2f16
 
	`__f16
 (0.707106781186547524400844362104849039Ë

	)

1115 #i‡
__HAVE_FLOAT32
 && 
deföed
 
__USE_GNU


1116 
	#M_Ef32
 
	`__f32
 (2.718281828459045235360287471352662498Ë

	)

1117 
	#M_LOG2Ef32
 
	`__f32
 (1.442695040888963407359924681001892137Ë

	)

1118 
	#M_LOG10Ef32
 
	`__f32
 (0.434294481903251827651128918916605082Ë

	)

1119 
	#M_LN2f32
 
	`__f32
 (0.693147180559945309417232121458176568Ë

	)

1120 
	#M_LN10f32
 
	`__f32
 (2.302585092994045684017991454684364208Ë

	)

1121 
	#M_PIf32
 
	`__f32
 (3.141592653589793238462643383279502884Ë

	)

1122 
	#M_PI_2f32
 
	`__f32
 (1.570796326794896619231321691639751442Ë

	)

1123 
	#M_PI_4f32
 
	`__f32
 (0.785398163397448309615660845819875721Ë

	)

1124 
	#M_1_PIf32
 
	`__f32
 (0.318309886183790671537767526745028724Ë

	)

1125 
	#M_2_PIf32
 
	`__f32
 (0.636619772367581343075535053490057448Ë

	)

1126 
	#M_2_SQRTPIf32
 
	`__f32
 (1.128379167095512573896158903121545172Ë

	)

1127 
	#M_SQRT2f32
 
	`__f32
 (1.414213562373095048801688724209698079Ë

	)

1128 
	#M_SQRT1_2f32
 
	`__f32
 (0.707106781186547524400844362104849039Ë

	)

1131 #i‡
__HAVE_FLOAT64
 && 
deföed
 
__USE_GNU


1132 
	#M_Ef64
 
	`__f64
 (2.718281828459045235360287471352662498Ë

	)

1133 
	#M_LOG2Ef64
 
	`__f64
 (1.442695040888963407359924681001892137Ë

	)

1134 
	#M_LOG10Ef64
 
	`__f64
 (0.434294481903251827651128918916605082Ë

	)

1135 
	#M_LN2f64
 
	`__f64
 (0.693147180559945309417232121458176568Ë

	)

1136 
	#M_LN10f64
 
	`__f64
 (2.302585092994045684017991454684364208Ë

	)

1137 
	#M_PIf64
 
	`__f64
 (3.141592653589793238462643383279502884Ë

	)

1138 
	#M_PI_2f64
 
	`__f64
 (1.570796326794896619231321691639751442Ë

	)

1139 
	#M_PI_4f64
 
	`__f64
 (0.785398163397448309615660845819875721Ë

	)

1140 
	#M_1_PIf64
 
	`__f64
 (0.318309886183790671537767526745028724Ë

	)

1141 
	#M_2_PIf64
 
	`__f64
 (0.636619772367581343075535053490057448Ë

	)

1142 
	#M_2_SQRTPIf64
 
	`__f64
 (1.128379167095512573896158903121545172Ë

	)

1143 
	#M_SQRT2f64
 
	`__f64
 (1.414213562373095048801688724209698079Ë

	)

1144 
	#M_SQRT1_2f64
 
	`__f64
 (0.707106781186547524400844362104849039Ë

	)

1147 #i‡
__HAVE_FLOAT128
 && 
deföed
 
__USE_GNU


1148 
	#M_Ef128
 
	`__f128
 (2.718281828459045235360287471352662498Ë

	)

1149 
	#M_LOG2Ef128
 
	`__f128
 (1.442695040888963407359924681001892137Ë

	)

1150 
	#M_LOG10Ef128
 
	`__f128
 (0.434294481903251827651128918916605082Ë

	)

1151 
	#M_LN2f128
 
	`__f128
 (0.693147180559945309417232121458176568Ë

	)

1152 
	#M_LN10f128
 
	`__f128
 (2.302585092994045684017991454684364208Ë

	)

1153 
	#M_PIf128
 
	`__f128
 (3.141592653589793238462643383279502884Ë

	)

1154 
	#M_PI_2f128
 
	`__f128
 (1.570796326794896619231321691639751442Ë

	)

1155 
	#M_PI_4f128
 
	`__f128
 (0.785398163397448309615660845819875721Ë

	)

1156 
	#M_1_PIf128
 
	`__f128
 (0.318309886183790671537767526745028724Ë

	)

1157 
	#M_2_PIf128
 
	`__f128
 (0.636619772367581343075535053490057448Ë

	)

1158 
	#M_2_SQRTPIf128
 
	`__f128
 (1.128379167095512573896158903121545172Ë

	)

1159 
	#M_SQRT2f128
 
	`__f128
 (1.414213562373095048801688724209698079Ë

	)

1160 
	#M_SQRT1_2f128
 
	`__f128
 (0.707106781186547524400844362104849039Ë

	)

1163 #i‡
__HAVE_FLOAT32X
 && 
deföed
 
__USE_GNU


1164 
	#M_Ef32x
 
	`__f32x
 (2.718281828459045235360287471352662498Ë

	)

1165 
	#M_LOG2Ef32x
 
	`__f32x
 (1.442695040888963407359924681001892137Ë

	)

1166 
	#M_LOG10Ef32x
 
	`__f32x
 (0.434294481903251827651128918916605082Ë

	)

1167 
	#M_LN2f32x
 
	`__f32x
 (0.693147180559945309417232121458176568Ë

	)

1168 
	#M_LN10f32x
 
	`__f32x
 (2.302585092994045684017991454684364208Ë

	)

1169 
	#M_PIf32x
 
	`__f32x
 (3.141592653589793238462643383279502884Ë

	)

1170 
	#M_PI_2f32x
 
	`__f32x
 (1.570796326794896619231321691639751442Ë

	)

1171 
	#M_PI_4f32x
 
	`__f32x
 (0.785398163397448309615660845819875721Ë

	)

1172 
	#M_1_PIf32x
 
	`__f32x
 (0.318309886183790671537767526745028724Ë

	)

1173 
	#M_2_PIf32x
 
	`__f32x
 (0.636619772367581343075535053490057448Ë

	)

1174 
	#M_2_SQRTPIf32x
 
	`__f32x
 (1.128379167095512573896158903121545172Ë

	)

1175 
	#M_SQRT2f32x
 
	`__f32x
 (1.414213562373095048801688724209698079Ë

	)

1176 
	#M_SQRT1_2f32x
 
	`__f32x
 (0.707106781186547524400844362104849039Ë

	)

1179 #i‡
__HAVE_FLOAT64X
 && 
deföed
 
__USE_GNU


1180 
	#M_Ef64x
 
	`__f64x
 (2.718281828459045235360287471352662498Ë

	)

1181 
	#M_LOG2Ef64x
 
	`__f64x
 (1.442695040888963407359924681001892137Ë

	)

1182 
	#M_LOG10Ef64x
 
	`__f64x
 (0.434294481903251827651128918916605082Ë

	)

1183 
	#M_LN2f64x
 
	`__f64x
 (0.693147180559945309417232121458176568Ë

	)

1184 
	#M_LN10f64x
 
	`__f64x
 (2.302585092994045684017991454684364208Ë

	)

1185 
	#M_PIf64x
 
	`__f64x
 (3.141592653589793238462643383279502884Ë

	)

1186 
	#M_PI_2f64x
 
	`__f64x
 (1.570796326794896619231321691639751442Ë

	)

1187 
	#M_PI_4f64x
 
	`__f64x
 (0.785398163397448309615660845819875721Ë

	)

1188 
	#M_1_PIf64x
 
	`__f64x
 (0.318309886183790671537767526745028724Ë

	)

1189 
	#M_2_PIf64x
 
	`__f64x
 (0.636619772367581343075535053490057448Ë

	)

1190 
	#M_2_SQRTPIf64x
 
	`__f64x
 (1.128379167095512573896158903121545172Ë

	)

1191 
	#M_SQRT2f64x
 
	`__f64x
 (1.414213562373095048801688724209698079Ë

	)

1192 
	#M_SQRT1_2f64x
 
	`__f64x
 (0.707106781186547524400844362104849039Ë

	)

1195 #i‡
__HAVE_FLOAT128X
 && 
deföed
 
__USE_GNU


1202 #i‡
deföed
 
__STRICT_ANSI__
 && !deföed 
__NO_MATH_INLINES


1203 
	#__NO_MATH_INLINES
 1

	)

1206 #ifde‡
__USE_ISOC99


1207 #i‡
__GNUC_PREREQ
 (3, 1)

1214 
	#isgª©î
(
x
, 
y
Ë
	`__buûtö_isgª©î
(x, y)

	)

1215 
	#isgª©îequÆ
(
x
, 
y
Ë
	`__buûtö_isgª©îequÆ
(x, y)

	)

1216 
	#i¶ess
(
x
, 
y
Ë
	`__buûtö_i¶ess
(x, y)

	)

1217 
	#i¶es£quÆ
(
x
, 
y
Ë
	`__buûtö_i¶es£quÆ
(x, y)

	)

1218 
	#i¶essgª©î
(
x
, 
y
Ë
	`__buûtö_i¶essgª©î
(x, y)

	)

1219 
	#isun‹dîed
(
x
, 
y
Ë
	`__buûtö_isun‹dîed
(x, y)

	)

1221 
	#isgª©î
(
x
, 
y
) \

1222 (
	`__exãnsi⁄__
 ({ 
	`__ty≥of__
 (
x
Ë
__x
 = (x); __ty≥of__ (
y
Ë
__y
 = (y); \

1223 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x > __y; }))

	)

1224 
	#isgª©îequÆ
(
x
, 
y
) \

1225 (
	`__exãnsi⁄__
 ({ 
	`__ty≥of__
 (
x
Ë
__x
 = (x); __ty≥of__ (
y
Ë
__y
 = (y); \

1226 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x >__y; }))

	)

1227 
	#i¶ess
(
x
, 
y
) \

1228 (
	`__exãnsi⁄__
 ({ 
	`__ty≥of__
 (
x
Ë
__x
 = (x); __ty≥of__ (
y
Ë
__y
 = (y); \

1229 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x < __y; }))

	)

1230 
	#i¶es£quÆ
(
x
, 
y
) \

1231 (
	`__exãnsi⁄__
 ({ 
	`__ty≥of__
 (
x
Ë
__x
 = (x); __ty≥of__ (
y
Ë
__y
 = (y); \

1232 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x <__y; }))

	)

1233 
	#i¶essgª©î
(
x
, 
y
) \

1234 (
	`__exãnsi⁄__
 ({ 
	`__ty≥of__
 (
x
Ë
__x
 = (x); __ty≥of__ (
y
Ë
__y
 = (y); \

1235 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x !__y; }))

	)

1237 
	#isun‹dîed
(
x
, 
y
) \

1238 (
	`__exãnsi⁄__
 ({ 
	`__ty≥of__
 (
x
Ë
__u
 = (x); __ty≥of__ (
y
Ë
__v
 = (y); \

1239 
__u
 !
__v
 && (__u !__u || __v !__v); }))

	)

1244 #ifde‡
__USE_EXTERN_INLINES


1245 
	~<bôs/m©hölöe.h
>

1249 #i‡
__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

1252 #i‡
__FLT_EVAL_METHOD__
 == 2 || __FLT_EVAL_METHOD__ > 64

1253 
	#__MATH_EVAL_FMT2
(
x
, 
y
Ë((xË+ (yË+ 0.0L)

	)

1254 #ñi‡
__FLT_EVAL_METHOD__
 == 1 || __FLT_EVAL_METHOD__ > 32

1255 
	#__MATH_EVAL_FMT2
(
x
, 
y
Ë((xË+ (yË+ 0.0)

	)

1256 #ñi‡
__FLT_EVAL_METHOD__
 == 0 || __FLT_EVAL_METHOD__ == 32

1257 
	#__MATH_EVAL_FMT2
(
x
, 
y
Ë((xË+ (yË+ 0.0f)

	)

1259 
	#__MATH_EVAL_FMT2
(
x
, 
y
Ë((xË+ (y))

	)

1264 #i‡!
deföed
 
__˝lu•lus
 || (__˝lu•lu†< 201103L && !deföed 
__GNUC__
)

1265 
	#i£qsig
(
x
, 
y
) \

1266 
	`__MATH_TG
 (
	`__MATH_EVAL_FMT2
 (
x
, 
y
), 
__i£qsig
, ((x), (y)))

	)

1279 
ãm∂©e
<
ty≥«me
> 
__i£qsig_ty≥
;

1281 
ãm∂©e
<> 
__i£qsig_ty≥
<>

1283 
__ˇŒ
 (
__x
, 
__y
Ë
throw
 ()

1285  
__i£qsigf
 (
__x
, 
__y
);

1289 
ãm∂©e
<> 
__i£qsig_ty≥
<>

1291 
__ˇŒ
 (
__x
, 
__y
Ë
throw
 ()

1293  
__i£qsig
 (
__x
, 
__y
);

1297 
ãm∂©e
<> 
__i£qsig_ty≥
<>

1299 
__ˇŒ
 (
__x
, 
__y
Ë
throw
 ()

1301 #i‚de‡
__NO_LONG_DOUBLE_MATH


1302  
__i£qsigl
 (
__x
, 
__y
);

1304  
__i£qsig
 (
__x
, 
__y
);

1309 #i‡
__HAVE_FLOAT128_UNLIKE_LDBL


1312 
ãm∂©e
<> 
__i£qsig_ty≥
<
_Flﬂt128
>

1314 
__ˇŒ
 (
_Flﬂt128
 
__x
, _Flﬂt128 
__y
Ë
throw
 ()

1316  
__i£qsigf128
 (
__x
, 
__y
);

1321 
ãm∂©e
<
ty≥«me
 
_T1
,Åy≥«mê
_T2
>

1322 
ölöe
 

1323 
i£qsig
 (
_T1
 
__x
, 
_T2
 
__y
Ë
throw
 ()

1325 #i‡
__˝lu•lus
 >= 201103L

1326 
de˛ty≥
 (
	t__MATH_EVAL_FMT2
 (
	t__x
, 
	t__y
)Ë
	t_T3
;

1328 
__ty≥of
 (
	t__MATH_EVAL_FMT2
 (
	t__x
, 
	t__y
)Ë
	t_T3
;

1330  
__i£qsig_ty≥
<
_T3
>::
__ˇŒ
 (
__x
, 
__y
);

1338 
__END_DECLS


	@/usr/include/mqueue.h

18 #i‚de‡
_MQUEUE_H


19 
	#_MQUEUE_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<sys/ty≥s.h
>

23 
	~<f˙é.h
>

24 
	~<bôs/ty≥s/sigevít_t.h
>

25 
	~<bôs/ty≥s/°ru˘_time•ec.h
>

27 
	~<bôs/mqueue.h
>

29 
__BEGIN_DECLS


38 
mqd_t
 
	$mq_›í
 (c⁄° *
__«me
, 
__oÊag
, ...)

39 
__THROW
 
	`__n⁄nuŒ
 ((1));

43 
	$mq_˛o£
 (
mqd_t
 
__mqdes
Ë
__THROW
;

46 
	$mq_gë©å
 (
mqd_t
 
__mqdes
, 
mq_©å
 *
__mq°©
)

47 
__THROW
 
	`__n⁄nuŒ
 ((2));

51 
	$mq_£èâr
 (
mqd_t
 
__mqdes
,

52 c⁄° 
mq_©å
 *
__ª°ri˘
 
__mq°©
,

53 
mq_©å
 *
__ª°ri˘
 
__omq°©
)

54 
__THROW
 
	`__n⁄nuŒ
 ((2));

57 
	$mq_u∆ök
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

61 
	$mq_nŸify
 (
mqd_t
 
__mqdes
, c⁄° 
sigevít
 *
__nŸifiˇti⁄
)

62 
__THROW
;

66 
ssize_t
 
	$mq_ª˚ive
 (
mqd_t
 
__mqdes
, *
__msg_±r
, 
size_t
 
__msg_Àn
,

67 *
__msg_¥io
Ë
	`__n⁄nuŒ
 ((2));

70 
	$mq_£nd
 (
mqd_t
 
__mqdes
, c⁄° *
__msg_±r
, 
size_t
 
__msg_Àn
,

71 
__msg_¥io
Ë
	`__n⁄nuŒ
 ((2));

73 #ifde‡
__USE_XOPEN2K


76 
ssize_t
 
	$mq_timedª˚ive
 (
mqd_t
 
__mqdes
, *
__ª°ri˘
 
__msg_±r
,

77 
size_t
 
__msg_Àn
,

78 *
__ª°ri˘
 
__msg_¥io
,

79 c⁄° 
time•ec
 *
__ª°ri˘
 
__abs_timeout
)

80 
	`__n⁄nuŒ
 ((2, 5));

84 
	$mq_timed£nd
 (
mqd_t
 
__mqdes
, c⁄° *
__msg_±r
,

85 
size_t
 
__msg_Àn
, 
__msg_¥io
,

86 c⁄° 
time•ec
 *
__abs_timeout
)

87 
	`__n⁄nuŒ
 ((2, 5));

91 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄
 \

92 && 
deföed
 
__va_¨g_∑ck_Àn


93 
	~<bôs/mqueue2.h
>

96 
__END_DECLS


	@/usr/include/netdb.h

22 #i‚def 
_NETDB_H


23 
	#_NETDB_H
 1

	)

25 
	~<„©uªs.h
>

27 
	~<√töë/ö.h
>

28 
	~<bôs/°döt-uöä.h
>

29 #ifde‡
__USE_MISC


32 
	~<Ωc/√tdb.h
>

35 #ifde‡
__USE_GNU


36 
	~<bôs/ty≥s/sigevít_t.h
>

37 
	~<bôs/ty≥s/°ru˘_time•ec.h
>

40 
	~<bôs/√tdb.h
>

43 
	#_PATH_HEQUIV
 "/ëc/ho°s.equiv"

	)

44 
	#_PATH_HOSTS
 "/ëc/ho°s"

	)

45 
	#_PATH_NETWORKS
 "/ëc/√tw‹ks"

	)

46 
	#_PATH_NSSWITCH_CONF
 "/ëc/nsswôch.c⁄f"

	)

47 
	#_PATH_PROTOCOLS
 "/ëc/¥Ÿocﬁs"

	)

48 
	#_PATH_SERVICES
 "/ëc/£rvi˚s"

	)

51 
	g__BEGIN_DECLS


53 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


56 
	#h_î∫o
 (*
	`__h_î∫o_loˇti⁄
 ())

	)

59 *
	$__h_î∫o_loˇti⁄
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

63 
	#HOST_NOT_FOUND
 1

	)

64 
	#TRY_AGAIN
 2

	)

66 
	#NO_RECOVERY
 3

	)

68 
	#NO_DATA
 4

	)

71 #ifde‡
__USE_MISC


72 
	#NETDB_INTERNAL
 -1

	)

73 
	#NETDB_SUCCESS
 0

	)

74 
	#NO_ADDRESS
 
NO_DATA


	)

77 #i‡
deföed
 
__USE_XOPEN2K
 || deföed 
__USE_XOPEN_EXTENDED


79 
	#IPPORT_RESERVED
 1024

	)

82 #ifde‡
__USE_GNU


84 
	#SCOPE_DELIMITER
 '%'

	)

87 #ifde‡
__USE_MISC


90 
	$hîr‹
 (c⁄° *
__°r
Ë
__THROW
;

93 c⁄° *
	$h°ªº‹
 (
__îr_num
Ë
__THROW
;

98 
	sho°ít


100 *
h_«me
;

101 **
h_Æü£s
;

102 
h_addπy≥
;

103 
h_Àngth
;

104 **
h_addr_li°
;

105 #ifde‡
__USE_MISC


106 
	#h_addr
 
h_addr_li°
[0]

	)

115 
	`£tho°ít
 (
__°ay_›í
);

121 
	`ídho°ít
 ();

128 
ho°ít
 *
	`gëho°ít
 ();

135 
ho°ít
 *
	`gëho°byaddr
 (c⁄° *
__addr
, 
__sockÀn_t
 
__Àn
,

136 
__ty≥
);

142 
ho°ít
 *
	`gëho°by«me
 (c⁄° *
__«me
);

144 #ifde‡
__USE_MISC


153 
ho°ít
 *
	`gëho°by«me2
 (c⁄° *
__«me
, 
__af
);

165 
	`gëho°ít_r
 (
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

166 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

167 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

168 *
__ª°ri˘
 
__h_î∫›
);

170 
	`gëho°byaddr_r
 (c⁄° *
__ª°ri˘
 
__addr
, 
__sockÀn_t
 
__Àn
,

171 
__ty≥
,

172 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

173 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

174 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

175 *
__ª°ri˘
 
__h_î∫›
);

177 
	`gëho°by«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

178 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

179 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

180 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

181 *
__ª°ri˘
 
__h_î∫›
);

183 
	`gëho°by«me2_r
 (c⁄° *
__ª°ri˘
 
__«me
, 
__af
,

184 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

185 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

186 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

187 *
__ª°ri˘
 
__h_î∫›
);

196 
	`£äëít
 (
__°ay_›í
);

202 
	`íd√ã¡
 ();

209 
√ã¡
 *
	`gë√ã¡
 ();

216 
√ã¡
 *
	`gë√tbyaddr
 (
uöt32_t
 
__√t
, 
__ty≥
);

222 
√ã¡
 *
	`gë√tby«me
 (c⁄° *
__«me
);

224 #ifdef 
__USE_MISC


235 
	`gë√ã¡_r
 (
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

236 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

237 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

238 *
__ª°ri˘
 
__h_î∫›
);

240 
	`gë√tbyaddr_r
 (
uöt32_t
 
__√t
, 
__ty≥
,

241 
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

242 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

243 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

244 *
__ª°ri˘
 
__h_î∫›
);

246 
	`gë√tby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

247 
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

248 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

249 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

250 *
__ª°ri˘
 
__h_î∫›
);

255 
	s£rvít


257 *
s_«me
;

258 **
s_Æü£s
;

259 
s_p‹t
;

260 *
s_¥Ÿo
;

268 
	`£t£rvít
 (
__°ay_›í
);

274 
	`íd£rvít
 ();

281 
£rvít
 *
	`gë£rvít
 ();

288 
£rvít
 *
	`gë£rvby«me
 (c⁄° *
__«me
, c⁄° *
__¥Ÿo
);

295 
£rvít
 *
	`gë£rvbyp‹t
 (
__p‹t
, c⁄° *
__¥Ÿo
);

298 #ifdef 
__USE_MISC


306 
	`gë£rvít_r
 (
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

307 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

308 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

310 
	`gë£rvby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

311 c⁄° *
__ª°ri˘
 
__¥Ÿo
,

312 
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

313 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

314 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

316 
	`gë£rvbyp‹t_r
 (
__p‹t
, c⁄° *
__ª°ri˘
 
__¥Ÿo
,

317 
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

318 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

319 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

324 
	s¥Ÿ€¡


326 *
p_«me
;

327 **
p_Æü£s
;

328 
p_¥Ÿo
;

336 
	`£çrŸ€¡
 (
__°ay_›í
);

342 
	`íd¥Ÿ€¡
 ();

349 
¥Ÿ€¡
 *
	`gë¥Ÿ€¡
 ();

355 
¥Ÿ€¡
 *
	`gë¥Ÿoby«me
 (c⁄° *
__«me
);

361 
¥Ÿ€¡
 *
	`gë¥Ÿobynumbî
 (
__¥Ÿo
);

364 #ifdef 
__USE_MISC


372 
	`gë¥Ÿ€¡_r
 (
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

373 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

374 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

376 
	`gë¥Ÿoby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

377 
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

378 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

379 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

381 
	`gë¥Ÿobynumbî_r
 (
__¥Ÿo
,

382 
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

383 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

384 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

393 
	`£äëgª¡
 (c⁄° *
__√tgroup
);

401 
	`íd√tgª¡
 ();

410 
	`gë√tgª¡
 (**
__ª°ri˘
 
__ho°p
,

411 **
__ª°ri˘
 
__u£Ω
,

412 **
__ª°ri˘
 
__domaöp
);

421 
	`ö√tgr
 (c⁄° *
__√tgroup
, c⁄° *
__ho°
,

422 c⁄° *
__u£r
, c⁄° *
__domaö
);

430 
	`gë√tgª¡_r
 (**
__ª°ri˘
 
__ho°p
,

431 **
__ª°ri˘
 
__u£Ω
,

432 **
__ª°ri˘
 
__domaöp
,

433 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
);

437 #ifde‡
__USE_MISC


449 
	`rcmd
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

450 c⁄° *
__ª°ri˘
 
__locu£r
,

451 c⁄° *
__ª°ri˘
 
__ªmu£r
,

452 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
);

461 
	`rcmd_af
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

462 c⁄° *
__ª°ri˘
 
__locu£r
,

463 c⁄° *
__ª°ri˘
 
__ªmu£r
,

464 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
,

465 
ß_Ámûy_t
 
__af
);

477 
	`ªxec
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

478 c⁄° *
__ª°ri˘
 
__«me
,

479 c⁄° *
__ª°ri˘
 
__∑ss
,

480 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
);

489 
	`ªxec_af
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

490 c⁄° *
__ª°ri˘
 
__«me
,

491 c⁄° *
__ª°ri˘
 
__∑ss
,

492 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
,

493 
ß_Ámûy_t
 
__af
);

503 
	`ru£rok
 (c⁄° *
__rho°
, 
__su£r
,

504 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
);

513 
	`ru£rok_af
 (c⁄° *
__rho°
, 
__su£r
,

514 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
,

515 
ß_Ámûy_t
 
__af
);

526 
	`úu£rok
 (
uöt32_t
 
__øddr
, 
__su£r
,

527 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
);

537 
	`úu£rok_af
 (c⁄° *
__øddr
, 
__su£r
,

538 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
,

539 
ß_Ámûy_t
 
__af
);

549 
	`ºesvp‹t
 (*
__Æp‹t
);

558 
	`ºesvp‹t_af
 (*
__Æp‹t
, 
ß_Ámûy_t
 
__af
);

563 #ifde‡
__USE_XOPEN2K


565 
	saddröfo


567 
ai_Êags
;

568 
ai_Ámûy
;

569 
ai_sockty≥
;

570 
ai_¥Ÿocﬁ
;

571 
sockÀn_t
 
ai_addæí
;

572 
sockaddr
 *
ai_addr
;

573 *
ai_ˇn⁄«me
;

574 
addröfo
 *
ai_√xt
;

577 #ifde‡
__USE_GNU


579 
	sgaicb


581 c⁄° *
¨_«me
;

582 c⁄° *
¨_£rvi˚
;

583 c⁄° 
addröfo
 *
¨_ªque°
;

584 
addröfo
 *
¨_ªsu…
;

586 
__ªtu∫
;

587 
__glibc_ª£rved
[5];

591 
	#GAI_WAIT
 0

	)

592 
	#GAI_NOWAIT
 1

	)

596 
	#AI_PASSIVE
 0x0001

	)

597 
	#AI_CANONNAME
 0x0002

	)

598 
	#AI_NUMERICHOST
 0x0004

	)

599 
	#AI_V4MAPPED
 0x0008

	)

600 
	#AI_ALL
 0x0010

	)

601 
	#AI_ADDRCONFIG
 0x0020

	)

603 #ifde‡
__USE_GNU


604 
	#AI_IDN
 0x0040

	)

607 
	#AI_CANONIDN
 0x0080

	)

608 
	#AI_IDN_ALLOW_UNASSIGNED
 \

609 
	`__glibc_ma¸o_w¨nög
 ("AI_IDN_ALLOW_UNASSIGNED i†dïªˇãd"Ë0x0100

	)

610 
	#AI_IDN_USE_STD3_ASCII_RULES
 \

611 
	`__glibc_ma¸o_w¨nög
 ("AI_IDN_USE_STD3_ASCII_RULES i†dïªˇãd"Ë0x0200

	)

613 
	#AI_NUMERICSERV
 0x0400

	)

616 
	#EAI_BADFLAGS
 -1

	)

617 
	#EAI_NONAME
 -2

	)

618 
	#EAI_AGAIN
 -3

	)

619 
	#EAI_FAIL
 -4

	)

620 
	#EAI_FAMILY
 -6

	)

621 
	#EAI_SOCKTYPE
 -7

	)

622 
	#EAI_SERVICE
 -8

	)

623 
	#EAI_MEMORY
 -10

	)

624 
	#EAI_SYSTEM
 -11

	)

625 
	#EAI_OVERFLOW
 -12

	)

626 #ifde‡
__USE_GNU


627 
	#EAI_NODATA
 -5

	)

628 
	#EAI_ADDRFAMILY
 -9

	)

629 
	#EAI_INPROGRESS
 -100

	)

630 
	#EAI_CANCELED
 -101

	)

631 
	#EAI_NOTCANCELED
 -102

	)

632 
	#EAI_ALLDONE
 -103

	)

633 
	#EAI_INTR
 -104

	)

634 
	#EAI_IDN_ENCODE
 -105

	)

637 #ifde‡
__USE_MISC


638 
	#NI_MAXHOST
 1025

	)

639 
	#NI_MAXSERV
 32

	)

642 
	#NI_NUMERICHOST
 1

	)

643 
	#NI_NUMERICSERV
 2

	)

644 
	#NI_NOFQDN
 4

	)

645 
	#NI_NAMEREQD
 8

	)

646 
	#NI_DGRAM
 16

	)

647 #ifde‡
__USE_GNU


648 
	#NI_IDN
 32

	)

649 
	#NI_IDN_ALLOW_UNASSIGNED
 \

650 
	`__glibc_ma¸o_w¨nög
 ("NI_IDN_ALLOW_UNASSIGNED i†dïªˇãd"Ë64

	)

651 
	#NI_IDN_USE_STD3_ASCII_RULES
 \

652 
	`__glibc_ma¸o_w¨nög
 ("NI_IDN_USE_STD3_ASCII_RULES i†dïªˇãd"Ë128

	)

660 
	`gëaddröfo
 (c⁄° *
__ª°ri˘
 
__«me
,

661 c⁄° *
__ª°ri˘
 
__£rvi˚
,

662 c⁄° 
addröfo
 *
__ª°ri˘
 
__ªq
,

663 
addröfo
 **
__ª°ri˘
 
__∑i
);

666 
	$‰ìaddröfo
 (
addröfo
 *
__ai
Ë
__THROW
;

669 c⁄° *
	$gai_°ªº‹
 (
__ecode
Ë
__THROW
;

675 
	`gë«meöfo
 (c⁄° 
sockaddr
 *
__ª°ri˘
 
__ß
,

676 
sockÀn_t
 
__ßÀn
, *
__ª°ri˘
 
__ho°
,

677 
sockÀn_t
 
__ho°Àn
, *
__ª°ri˘
 
__£rv
,

678 
sockÀn_t
 
__£rvÀn
, 
__Êags
);

681 #ifde‡
__USE_GNU


690 
	`gëaddröfo_a
 (
__mode
, 
gaicb
 *
__li°
[
__ª°ri˘_¨r
],

691 
__ít
, 
sigevít
 *
__ª°ri˘
 
__sig
);

701 
	`gai_su•íd
 (c⁄° 
gaicb
 *c⁄° 
__li°
[], 
__ít
,

702 c⁄° 
time•ec
 *
__timeout
);

705 
	$gai_îr‹
 (
gaicb
 *
__ªq
Ë
__THROW
;

708 
	$gai_ˇn˚l
 (
gaicb
 *
__gaicbp
Ë
__THROW
;

711 
__END_DECLS


	@/usr/include/netinet/in.h

18 #i‚def 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<bôs/°döt-uöä.h
>

23 
	~<sys/sockë.h
>

24 
	~<bôs/ty≥s.h
>

27 
__BEGIN_DECLS


30 
uöt32_t
 
	tö_addr_t
;

31 
	sö_addr


33 
ö_addr_t
 
	ms_addr
;

37 
	~<bôs/ö.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_MPLS
 = 137,

89 
	#IPPROTO_MPLS
 
IPPROTO_MPLS


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


98 #i‡!
__USE_KERNEL_IPV6_DEFS


101 
	mIPPROTO_HOPOPTS
 = 0,

102 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

103 
	mIPPROTO_ROUTING
 = 43,

104 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

105 
	mIPPROTO_FRAGMENT
 = 44,

106 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

107 
	mIPPROTO_ICMPV6
 = 58,

108 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

109 
	mIPPROTO_NONE
 = 59,

110 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

111 
	mIPPROTO_DSTOPTS
 = 60,

112 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

113 
	mIPPROTO_MH
 = 135

114 
	#IPPROTO_MH
 
IPPROTO_MH


	)

119 
uöt16_t
 
	tö_p‹t_t
;

124 
	mIPPORT_ECHO
 = 7,

125 
	mIPPORT_DISCARD
 = 9,

126 
	mIPPORT_SYSTAT
 = 11,

127 
	mIPPORT_DAYTIME
 = 13,

128 
	mIPPORT_NETSTAT
 = 15,

129 
	mIPPORT_FTP
 = 21,

130 
	mIPPORT_TELNET
 = 23,

131 
	mIPPORT_SMTP
 = 25,

132 
	mIPPORT_TIMESERVER
 = 37,

133 
	mIPPORT_NAMESERVER
 = 42,

134 
	mIPPORT_WHOIS
 = 43,

135 
	mIPPORT_MTP
 = 57,

137 
	mIPPORT_TFTP
 = 69,

138 
	mIPPORT_RJE
 = 77,

139 
	mIPPORT_FINGER
 = 79,

140 
	mIPPORT_TTYLINK
 = 87,

141 
	mIPPORT_SUPDUP
 = 95,

144 
	mIPPORT_EXECSERVER
 = 512,

145 
	mIPPORT_LOGINSERVER
 = 513,

146 
	mIPPORT_CMDSERVER
 = 514,

147 
	mIPPORT_EFSSERVER
 = 520,

150 
	mIPPORT_BIFFUDP
 = 512,

151 
	mIPPORT_WHOSERVER
 = 513,

152 
	mIPPORT_ROUTESERVER
 = 520,

155 
	mIPPORT_RESERVED
 = 1024,

158 
	mIPPORT_USERRESERVED
 = 5000

166 
	#IN_CLASSA
(
a
Ë((((
ö_addr_t
)◊)Ë& 0x80000000Ë=0)

	)

167 
	#IN_CLASSA_NET
 0xff000000

	)

168 
	#IN_CLASSA_NSHIFT
 24

	)

169 
	#IN_CLASSA_HOST
 (0xfffffff‡& ~
IN_CLASSA_NET
)

	)

170 
	#IN_CLASSA_MAX
 128

	)

172 
	#IN_CLASSB
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xc0000000Ë=0x80000000)

	)

173 
	#IN_CLASSB_NET
 0xffff0000

	)

174 
	#IN_CLASSB_NSHIFT
 16

	)

175 
	#IN_CLASSB_HOST
 (0xfffffff‡& ~
IN_CLASSB_NET
)

	)

176 
	#IN_CLASSB_MAX
 65536

	)

178 
	#IN_CLASSC
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xc0000000)

	)

179 
	#IN_CLASSC_NET
 0xffffff00

	)

180 
	#IN_CLASSC_NSHIFT
 8

	)

181 
	#IN_CLASSC_HOST
 (0xfffffff‡& ~
IN_CLASSC_NET
)

	)

183 
	#IN_CLASSD
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xe0000000)

	)

184 
	#IN_MULTICAST
(
a
Ë
	`IN_CLASSD
◊)

	)

186 
	#IN_EXPERIMENTAL
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xe0000000)

	)

187 
	#IN_BADCLASS
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xf0000000)

	)

190 
	#INADDR_ANY
 ((
ö_addr_t
Ë0x00000000)

	)

192 
	#INADDR_BROADCAST
 ((
ö_addr_t
Ë0xffffffff)

	)

194 
	#INADDR_NONE
 ((
ö_addr_t
Ë0xffffffff)

	)

197 
	#IN_LOOPBACKNET
 127

	)

199 #i‚de‡
INADDR_LOOPBACK


200 
	#INADDR_LOOPBACK
 ((
ö_addr_t
Ë0x7f000001Ë

	)

204 
	#INADDR_UNSPEC_GROUP
 ((
ö_addr_t
Ë0xe0000000Ë

	)

205 
	#INADDR_ALLHOSTS_GROUP
 ((
ö_addr_t
Ë0xe0000001Ë

	)

206 
	#INADDR_ALLRTRS_GROUP
 ((
ö_addr_t
Ë0xe0000002Ë

	)

207 
	#INADDR_ALLSNOOPERS_GROUP
 ((
ö_addr_t
Ë0xe000006aË

	)

208 
	#INADDR_MAX_LOCAL_GROUP
 ((
ö_addr_t
Ë0xe00000ffË

	)

210 #i‡!
__USE_KERNEL_IPV6_DEFS


212 
	sö6_addr


216 
uöt8_t
 
	m__u6_addr8
[16];

217 
uöt16_t
 
	m__u6_addr16
[8];

218 
uöt32_t
 
	m__u6_addr32
[4];

219 } 
	m__ö6_u
;

220 
	#s6_addr
 
__ö6_u
.
__u6_addr8


	)

221 #ifde‡
__USE_MISC


222 
	#s6_addr16
 
__ö6_u
.
__u6_addr16


	)

223 
	#s6_addr32
 
__ö6_u
.
__u6_addr32


	)

228 c⁄° 
ö6_addr
 
ö6addr_™y
;

229 c⁄° 
ö6_addr
 
ö6addr_lo›back
;

230 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

231 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

233 
	#INET_ADDRSTRLEN
 16

	)

234 
	#INET6_ADDRSTRLEN
 46

	)

238 
	ssockaddr_ö


240 
__SOCKADDR_COMMON
 (
sö_
);

241 
ö_p‹t_t
 
	msö_p‹t
;

242 
ö_addr
 
	msö_addr
;

245 
	msö_zîo
[ (
sockaddr
)

246 - 
__SOCKADDR_COMMON_SIZE


247 -  (
ö_p‹t_t
)

248 -  (
ö_addr
)];

251 #i‡!
__USE_KERNEL_IPV6_DEFS


253 
	ssockaddr_ö6


255 
__SOCKADDR_COMMON
 (
sö6_
);

256 
ö_p‹t_t
 
	msö6_p‹t
;

257 
uöt32_t
 
	msö6_Êowöfo
;

258 
ö6_addr
 
	msö6_addr
;

259 
uöt32_t
 
	msö6_sc›e_id
;

263 #ifde‡
__USE_MISC


265 
	sù_mªq


268 
ö_addr
 
	mimr_mu…üddr
;

271 
ö_addr
 
	mimr_öãrÁ˚
;

274 
	sù_mªq_sour˚


277 
ö_addr
 
	mimr_mu…üddr
;

280 
ö_addr
 
	mimr_öãrÁ˚
;

283 
ö_addr
 
	mimr_sour˚addr
;

287 #i‡!
__USE_KERNEL_IPV6_DEFS


289 
	sùv6_mªq


292 
ö6_addr
 
	mùv6mr_mu…üddr
;

295 
	mùv6mr_öãrÁ˚
;

299 #ifde‡
__USE_MISC


301 
	sgroup_ªq


304 
uöt32_t
 
	mgr_öãrÁ˚
;

307 
sockaddr_°‹age
 
	mgr_group
;

310 
	sgroup_sour˚_ªq


313 
uöt32_t
 
	mg§_öãrÁ˚
;

316 
sockaddr_°‹age
 
	mg§_group
;

319 
sockaddr_°‹age
 
	mg§_sour˚
;

324 
	sù_msfûãr


327 
ö_addr
 
	mimsf_mu…üddr
;

330 
ö_addr
 
	mimsf_öãrÁ˚
;

333 
uöt32_t
 
	mimsf_fmode
;

336 
uöt32_t
 
	mimsf_num§c
;

338 
ö_addr
 
	mimsf_¶i°
[1];

341 
	#IP_MSFILTER_SIZE
(
num§c
Ë( (
ù_msfûãr
) \

342 -  (
ö_addr
) \

343 + (
num§c
Ë*  (
ö_addr
))

	)

345 
	sgroup_fûãr


348 
uöt32_t
 
	mgf_öãrÁ˚
;

351 
sockaddr_°‹age
 
	mgf_group
;

354 
uöt32_t
 
	mgf_fmode
;

357 
uöt32_t
 
	mgf_num§c
;

359 
sockaddr_°‹age
 
	mgf_¶i°
[1];

362 
	#GROUP_FILTER_SIZE
(
num§c
Ë( (
group_fûãr
) \

363 -  (
sockaddr_°‹age
) \

364 + ((
num§c
) \

365 *  (
sockaddr_°‹age
)))

	)

375 
uöt32_t
 
	$¡ohl
 (
uöt32_t
 
__√é⁄g
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

376 
uöt16_t
 
	$¡ohs
 (
uöt16_t
 
__√tsh‹t
)

377 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

378 
uöt32_t
 
	$ht⁄l
 (
uöt32_t
 
__ho°l⁄g
)

379 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

380 
uöt16_t
 
	$ht⁄s
 (
uöt16_t
 
__ho°sh‹t
)

381 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

383 
	~<ídün.h
>

386 
	~<bôs/byãsw≠.h
>

387 
	~<bôs/uöä-idítôy.h
>

389 #ifde‡
__OPTIMIZE__


393 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


396 
	#¡ohl
(
x
Ë
	`__uöt32_idítôy
 (x)

	)

397 
	#¡ohs
(
x
Ë
	`__uöt16_idítôy
 (x)

	)

398 
	#ht⁄l
(
x
Ë
	`__uöt32_idítôy
 (x)

	)

399 
	#ht⁄s
(
x
Ë
	`__uöt16_idítôy
 (x)

	)

401 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


402 
	#¡ohl
(
x
Ë
	`__bsw≠_32
 (x)

	)

403 
	#¡ohs
(
x
Ë
	`__bsw≠_16
 (x)

	)

404 
	#ht⁄l
(
x
Ë
	`__bsw≠_32
 (x)

	)

405 
	#ht⁄s
(
x
Ë
	`__bsw≠_16
 (x)

	)

410 #ifde‡
__GNUC__


411 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

412 (
__exãnsi⁄__
 \

413 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

414 
__a
->
__ö6_u
.
__u6_addr32
[0] == 0 \

415 && 
__a
->
__ö6_u
.
__u6_addr32
[1] == 0 \

416 && 
__a
->
__ö6_u
.
__u6_addr32
[2] == 0 \

417 && 
__a
->
__ö6_u
.
__u6_addr32
[3] =0; 
	}
}))

	)

419 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

420 (
__exãnsi⁄__
 \

421 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

422 
__a
->
__ö6_u
.
__u6_addr32
[0] == 0 \

423 && 
__a
->
__ö6_u
.
__u6_addr32
[1] == 0 \

424 && 
__a
->
__ö6_u
.
__u6_addr32
[2] == 0 \

425 && 
__a
->
__ö6_u
.
__u6_addr32
[3] =
	`ht⁄l
 (1); }))

	)

427 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

428 (
__exãnsi⁄__
 \

429 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

430 (
__a
->
__ö6_u
.
__u6_addr32
[0] & 
	`ht⁄l
 (0xffc00000)Ë=ht⁄»(0x„800000); }))

	)

432 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

433 (
__exãnsi⁄__
 \

434 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

435 (
__a
->
__ö6_u
.
__u6_addr32
[0] & 
	`ht⁄l
 (0xffc00000)Ë=ht⁄»(0x„c00000); }))

	)

437 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

438 (
__exãnsi⁄__
 \

439 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

440 
__a
->
__ö6_u
.
__u6_addr32
[0] == 0 \

441 && 
__a
->
__ö6_u
.
__u6_addr32
[1] == 0 \

442 && 
__a
->
__ö6_u
.
__u6_addr32
[2] =
	`ht⁄l
 (0xffff); }))

	)

444 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

445 (
__exãnsi⁄__
 \

446 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

447 
__a
->
__ö6_u
.
__u6_addr32
[0] == 0 \

448 && 
__a
->
__ö6_u
.
__u6_addr32
[1] == 0 \

449 && 
__a
->
__ö6_u
.
__u6_addr32
[2] == 0 \

450 && 
	`¡ohl
 (
__a
->
__ö6_u
.
__u6_addr32
[3]Ë> 1; }))

	)

452 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

453 (
__exãnsi⁄__
 \

454 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

455 c⁄° 
ö6_addr
 *
__b
 = (c⁄° ö6_add∏*Ë(
b
); \

456 
__a
->
__ö6_u
.
__u6_addr32
[0] =
__b
->__in6_u.__u6_addr32[0] \

457 && 
__a
->
__ö6_u
.
__u6_addr32
[1] =
__b
->__in6_u.__u6_addr32[1] \

458 && 
__a
->
__ö6_u
.
__u6_addr32
[2] =
__b
->__in6_u.__u6_addr32[2] \

459 && 
__a
->
__ö6_u
.
__u6_addr32
[3] =
__b
->__ö6_u.__u6_addr32[3]; }))

	)

461 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

462 (((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0 \

463 && ((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0 \

464 && ((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0 \

465 && ((c⁄° 
uöt32_t
 *Ë(
a
))[3] =0)

	)

467 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

468 (((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0 \

469 && ((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0 \

470 && ((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0 \

471 && ((c⁄° 
uöt32_t
 *Ë(
a
))[3] =
	`ht⁄l
 (1))

	)

473 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

474 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

475 =
	`ht⁄l
 (0x„800000))

	)

477 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

478 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

479 =
	`ht⁄l
 (0x„c00000))

	)

481 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

482 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0) \

483 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0) \

484 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] =
	`ht⁄l
 (0xffff)))

	)

486 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

487 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0) \

488 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0) \

489 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0) \

490 && (
	`¡ohl
 (((c⁄° 
uöt32_t
 *Ë(
a
))[3]Ë> 1))

	)

492 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

493 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] =((c⁄° uöt32_à*Ë(
b
))[0]) \

494 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] =((c⁄° uöt32_à*Ë(
b
))[1]) \

495 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] =((c⁄° uöt32_à*Ë(
b
))[2]) \

496 && (((c⁄° 
uöt32_t
 *Ë(
a
))[3] =((c⁄° uöt32_à*Ë(
b
))[3]))

	)

499 
	#IN6_IS_ADDR_MULTICAST
(
a
Ë(((c⁄° 
uöt8_t
 *Ë◊))[0] =0xff)

	)

501 #ifde‡
__USE_MISC


503 
	$bödªsvp‹t
 (
__sockfd
, 
sockaddr_ö
 *
__sock_ö
Ë
__THROW
;

506 
	$bödªsvp‹t6
 (
__sockfd
, 
sockaddr_ö6
 *
__sock_ö
)

507 
__THROW
;

511 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

512 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

513 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x1))

	)

515 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

516 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

517 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x2))

	)

519 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

520 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

521 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x5))

	)

523 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

524 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

525 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x8))

	)

527 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

528 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

529 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0xe))

	)

532 #ifde‡
__USE_GNU


533 
cmsghdr
;

535 #i‡!
__USE_KERNEL_IPV6_DEFS


537 
	sö6_pktöfo


539 
ö6_addr
 
ùi6_addr
;

540 
ùi6_ifödex
;

544 
	sù6_mtuöfo


546 
sockaddr_ö6
 
ù6m_addr
;

547 
uöt32_t
 
ù6m_mtu
;

552 
	$öë6_›ti⁄_•a˚
 (
__nbyãs
)

553 
__THROW
 
__©åibuã_dïªˇãd__
;

554 
	$öë6_›ti⁄_öô
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

555 
__ty≥
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

556 
	$öë6_›ti⁄_≠≥nd
 (
cmsghdr
 *
__cmsg
,

557 c⁄° 
uöt8_t
 *
__ty≥p
, 
__mu…x
,

558 
__∂usy
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

559 
uöt8_t
 *
	$öë6_›ti⁄_Æloc
 (
cmsghdr
 *
__cmsg
, 
__d©Æí
,

560 
__mu…x
, 
__∂usy
)

561 
__THROW
 
__©åibuã_dïªˇãd__
;

562 
	$öë6_›ti⁄_√xt
 (c⁄° 
cmsghdr
 *
__cmsg
,

563 
uöt8_t
 **
__çåp
)

564 
__THROW
 
__©åibuã_dïªˇãd__
;

565 
	$öë6_›ti⁄_föd
 (c⁄° 
cmsghdr
 *
__cmsg
,

566 
uöt8_t
 **
__çåp
, 
__ty≥
)

567 
__THROW
 
__©åibuã_dïªˇãd__
;

571 
	$öë6_›t_öô
 (*
__extbuf
, 
sockÀn_t
 
__exéí
Ë
__THROW
;

572 
	$öë6_›t_≠≥nd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

573 
uöt8_t
 
__ty≥
, 
sockÀn_t
 
__Àn
, uöt8_à
__Æign
,

574 **
__d©abuÂ
Ë
__THROW
;

575 
	$öë6_›t_föish
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
)

576 
__THROW
;

577 
	$öë6_›t_£t_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

578 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

579 
	$öë6_›t_√xt
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

580 
uöt8_t
 *
__ty≥p
, 
sockÀn_t
 *
__À≈
,

581 **
__d©abuÂ
Ë
__THROW
;

582 
	$öë6_›t_föd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

583 
uöt8_t
 
__ty≥
, 
sockÀn_t
 *
__À≈
,

584 **
__d©abuÂ
Ë
__THROW
;

585 
	$öë6_›t_gë_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

586 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

590 
sockÀn_t
 
	$öë6_πh_•a˚
 (
__ty≥
, 
__£gmíts
Ë
__THROW
;

591 *
	$öë6_πh_öô
 (*
__bp
, 
sockÀn_t
 
__bp_Àn
, 
__ty≥
,

592 
__£gmíts
Ë
__THROW
;

593 
	$öë6_πh_add
 (*
__bp
, c⁄° 
ö6_addr
 *
__addr
Ë
__THROW
;

594 
	$öë6_πh_ªvî£
 (c⁄° *
__ö
, *
__out
Ë
__THROW
;

595 
	$öë6_πh_£gmíts
 (c⁄° *
__bp
Ë
__THROW
;

596 
ö6_addr
 *
	$öë6_πh_gëaddr
 (c⁄° *
__bp
, 
__ödex
)

597 
__THROW
;

603 
	$gëùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

604 
ö_addr
 
__group
, 
uöt32_t
 *
__fmode
,

605 
uöt32_t
 *
__num§c
, 
ö_addr
 *
__¶i°
)

606 
__THROW
;

609 
	$£tùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

610 
ö_addr
 
__group
, 
uöt32_t
 
__fmode
,

611 
uöt32_t
 
__num§c
,

612 c⁄° 
ö_addr
 *
__¶i°
)

613 
__THROW
;

617 
	$gësour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

618 c⁄° 
sockaddr
 *
__group
,

619 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 *
__fmode
,

620 
uöt32_t
 *
__num§c
,

621 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

624 
	$£tsour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

625 c⁄° 
sockaddr
 *
__group
,

626 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 
__fmode
,

627 
uöt32_t
 
__num§c
,

628 c⁄° 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

631 
__END_DECLS


	@/usr/include/pthread.h

18 #i‚de‡
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<sched.h
>

23 
	~<time.h
>

25 
	~<bôs/ídün.h
>

26 
	~<bôs/±hªadty≥s.h
>

27 
	~<bôs/£tjmp.h
>

28 
	~<bôs/w‹dsize.h
>

29 
	~<bôs/ty≥s/°ru˘_time•ec.h
>

35 
	mPTHREAD_CREATE_JOINABLE
,

36 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

37 
	mPTHREAD_CREATE_DETACHED


38 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

45 
	mPTHREAD_MUTEX_TIMED_NP
,

46 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

47 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

48 
	mPTHREAD_MUTEX_ADAPTIVE_NP


49 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


51 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

52 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

53 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

54 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


56 #ifde‡
__USE_GNU


58 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


63 #ifde‡
__USE_XOPEN2K


67 
	mPTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

69 
	mPTHREAD_MUTEX_ROBUST
,

70 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


75 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


79 
	mPTHREAD_PRIO_NONE
,

80 
	mPTHREAD_PRIO_INHERIT
,

81 
	mPTHREAD_PRIO_PROTECT


86 
	#PTHREAD_MUTEX_INITIALIZER
 \

87 { { 
	`__PTHREAD_MUTEX_INITIALIZER
 (
PTHREAD_MUTEX_TIMED_NP
Ë} }

	)

88 #ifde‡
__USE_GNU


89 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

90 { { 
	`__PTHREAD_MUTEX_INITIALIZER
 (
PTHREAD_MUTEX_RECURSIVE_NP
Ë} }

	)

91 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

92 { { 
	`__PTHREAD_MUTEX_INITIALIZER
 (
PTHREAD_MUTEX_ERRORCHECK_NP
Ë} }

	)

93 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

94 { { 
	`__PTHREAD_MUTEX_INITIALIZER
 (
PTHREAD_MUTEX_ADAPTIVE_NP
Ë} }

	)

99 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


102 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

103 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

104 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

105 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


110 
	#PTHREAD_RWLOCK_INITIALIZER
 \

111 { { 
	`__PTHREAD_RWLOCK_INITIALIZER
 (
PTHREAD_RWLOCK_DEFAULT_NP
Ë} }

	)

112 #ifde‡
__USE_GNU


113 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

114 { { 
	`__PTHREAD_RWLOCK_INITIALIZER
 (
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
Ë} }

	)

122 
	mPTHREAD_INHERIT_SCHED
,

123 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

124 
	mPTHREAD_EXPLICIT_SCHED


125 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

132 
	mPTHREAD_SCOPE_SYSTEM
,

133 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

134 
	mPTHREAD_SCOPE_PROCESS


135 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

142 
	mPTHREAD_PROCESS_PRIVATE
,

143 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

144 
	mPTHREAD_PROCESS_SHARED


145 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

151 
	#PTHREAD_COND_INITIALIZER
 { { {0}, {0}, {0, 0}, {0, 0}, 0, 0, {0, 0} } }

	)

155 
	s_±hªad_˛ónup_buf„r


157 (*
	m__routöe
) (*);

158 *
	m__¨g
;

159 
	m__ˇn˚…y≥
;

160 
_±hªad_˛ónup_buf„r
 *
	m__¥ev
;

166 
	mPTHREAD_CANCEL_ENABLE
,

167 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

168 
	mPTHREAD_CANCEL_DISABLE


169 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

173 
	mPTHREAD_CANCEL_DEFERRED
,

174 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

175 
	mPTHREAD_CANCEL_ASYNCHRONOUS


176 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

178 
	#PTHREAD_CANCELED
 ((*Ë-1)

	)

182 
	#PTHREAD_ONCE_INIT
 0

	)

185 #ifde‡
__USE_XOPEN2K


189 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

193 
__BEGIN_DECLS


198 
	$±hªad_¸óã
 (
±hªad_t
 *
__ª°ri˘
 
__√wthªad
,

199 c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

200 *(*
__°¨t_routöe
) (*),

201 *
__ª°ri˘
 
__¨g
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 3));

207 
	$±hªad_exô
 (*
__ªtvÆ
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

215 
	`±hªad_joö
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
);

217 #ifde‡
__USE_GNU


220 
	$±hªad_åyjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
Ë
__THROW
;

228 
	`±hªad_timedjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
,

229 c⁄° 
time•ec
 *
__ab°ime
);

238 
	`±hªad_˛ockjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
,

239 
˛ockid_t
 
__˛ockid
,

240 c⁄° 
time•ec
 *
__ab°ime
);

247 
	$±hªad_dëach
 (
±hªad_t
 
__th
Ë
__THROW
;

251 
±hªad_t
 
	$±hªad_£lf
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

254 
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
)

255 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

263 
	$±hªad_©å_öô
 (
±hªad_©å_t
 *
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

266 
	$±hªad_©å_de°roy
 (
±hªad_©å_t
 *
__©å
)

267 
__THROW
 
	`__n⁄nuŒ
 ((1));

270 
	$±hªad_©å_gëdëach°©e
 (c⁄° 
±hªad_©å_t
 *
__©å
,

271 *
__dëach°©e
)

272 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

275 
	$±hªad_©å_£tdëach°©e
 (
±hªad_©å_t
 *
__©å
,

276 
__dëach°©e
)

277 
__THROW
 
	`__n⁄nuŒ
 ((1));

281 
	$±hªad_©å_gëgu¨dsize
 (c⁄° 
±hªad_©å_t
 *
__©å
,

282 
size_t
 *
__gu¨dsize
)

283 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

286 
	$±hªad_©å_£tgu¨dsize
 (
±hªad_©å_t
 *
__©å
,

287 
size_t
 
__gu¨dsize
)

288 
__THROW
 
	`__n⁄nuŒ
 ((1));

292 
	$±hªad_©å_gësched∑øm
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

293 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

294 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

297 
	$±hªad_©å_£tsched∑øm
 (
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

298 c⁄° 
sched_∑øm
 *
__ª°ri˘


299 
__∑øm
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

302 
	$±hªad_©å_gëschedpﬁicy
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


303 
__©å
, *
__ª°ri˘
 
__pﬁicy
)

304 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

307 
	$±hªad_©å_£tschedpﬁicy
 (
±hªad_©å_t
 *
__©å
, 
__pﬁicy
)

308 
__THROW
 
	`__n⁄nuŒ
 ((1));

311 
	$±hªad_©å_gëöhîôsched
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


312 
__©å
, *
__ª°ri˘
 
__öhîô
)

313 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

316 
	$±hªad_©å_£töhîôsched
 (
±hªad_©å_t
 *
__©å
,

317 
__öhîô
)

318 
__THROW
 
	`__n⁄nuŒ
 ((1));

322 
	$±hªad_©å_gësc›e
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

323 *
__ª°ri˘
 
__sc›e
)

324 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

327 
	$±hªad_©å_£tsc›e
 (
±hªad_©å_t
 *
__©å
, 
__sc›e
)

328 
__THROW
 
	`__n⁄nuŒ
 ((1));

331 
	$±hªad_©å_gë°ackaddr
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


332 
__©å
, **
__ª°ri˘
 
__°ackaddr
)

333 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__©åibuã_dïªˇãd__
;

339 
	$±hªad_©å_£t°ackaddr
 (
±hªad_©å_t
 *
__©å
,

340 *
__°ackaddr
)

341 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
;

344 
	$±hªad_©å_gë°acksize
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


345 
__©å
, 
size_t
 *
__ª°ri˘
 
__°acksize
)

346 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

351 
	$±hªad_©å_£t°acksize
 (
±hªad_©å_t
 *
__©å
,

352 
size_t
 
__°acksize
)

353 
__THROW
 
	`__n⁄nuŒ
 ((1));

355 #ifde‡
__USE_XOPEN2K


357 
	$±hªad_©å_gë°ack
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

358 **
__ª°ri˘
 
__°ackaddr
,

359 
size_t
 *
__ª°ri˘
 
__°acksize
)

360 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

365 
	$±hªad_©å_£t°ack
 (
±hªad_©å_t
 *
__©å
, *
__°ackaddr
,

366 
size_t
 
__°acksize
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

369 #ifde‡
__USE_GNU


372 
	$±hªad_©å_£èfföôy_≈
 (
±hªad_©å_t
 *
__©å
,

373 
size_t
 
__˝u£tsize
,

374 c⁄° 
˝u_£t_t
 *
__˝u£t
)

375 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

379 
	$±hªad_©å_gëafföôy_≈
 (c⁄° 
±hªad_©å_t
 *
__©å
,

380 
size_t
 
__˝u£tsize
,

381 
˝u_£t_t
 *
__˝u£t
)

382 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

385 
	$±hªad_gë©å_deÁu…_≈
 (
±hªad_©å_t
 *
__©å
)

386 
__THROW
 
	`__n⁄nuŒ
 ((1));

390 
	$±hªad_£èâr_deÁu…_≈
 (c⁄° 
±hªad_©å_t
 *
__©å
)

391 
__THROW
 
	`__n⁄nuŒ
 ((1));

396 
	$±hªad_gë©å_≈
 (
±hªad_t
 
__th
, 
±hªad_©å_t
 *
__©å
)

397 
__THROW
 
	`__n⁄nuŒ
 ((2));

405 
	$±hªad_£tsched∑øm
 (
±hªad_t
 
__èrgë_thªad
, 
__pﬁicy
,

406 c⁄° 
sched_∑øm
 *
__∑øm
)

407 
__THROW
 
	`__n⁄nuŒ
 ((3));

410 
	$±hªad_gësched∑øm
 (
±hªad_t
 
__èrgë_thªad
,

411 *
__ª°ri˘
 
__pﬁicy
,

412 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

413 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

416 
	$±hªad_£tsched¥io
 (
±hªad_t
 
__èrgë_thªad
, 
__¥io
)

417 
__THROW
;

420 #ifde‡
__USE_GNU


422 
	$±hªad_gë«me_≈
 (
±hªad_t
 
__èrgë_thªad
, *
__buf
,

423 
size_t
 
__buÊí
)

424 
__THROW
 
	`__n⁄nuŒ
 ((2));

427 
	$±hªad_£äame_≈
 (
±hªad_t
 
__èrgë_thªad
, c⁄° *
__«me
)

428 
__THROW
 
	`__n⁄nuŒ
 ((2));

432 #ifde‡
__USE_UNIX98


434 
	$±hªad_gëc⁄cuºícy
 (Ë
__THROW
;

437 
	$±hªad_£tc⁄cuºícy
 (
__Àvñ
Ë
__THROW
;

440 #ifde‡
__USE_GNU


445 
	$±hªad_yõld
 (Ë
__THROW
;

450 
	$±hªad_£èfföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

451 c⁄° 
˝u_£t_t
 *
__˝u£t
)

452 
__THROW
 
	`__n⁄nuŒ
 ((3));

455 
	$±hªad_gëafföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

456 
˝u_£t_t
 *
__˝u£t
)

457 
__THROW
 
	`__n⁄nuŒ
 ((3));

470 
	$±hªad_⁄˚
 (
±hªad_⁄˚_t
 *
__⁄˚_c⁄åﬁ
,

471 (*
__öô_routöe
Ë()Ë
	`__n⁄nuŒ
 ((1, 2));

482 
	`±hªad_£tˇn˚l°©e
 (
__°©e
, *
__ﬁd°©e
);

486 
	`±hªad_£tˇn˚…y≥
 (
__ty≥
, *
__ﬁdty≥
);

489 
	`±hªad_ˇn˚l
 (
±hªad_t
 
__th
);

494 
	`±hªad_ã°ˇn˚l
 ();

503 
__jmp_buf
 
__ˇn˚l_jmp_buf
;

504 
__mask_was_ßved
;

505 } 
__ˇn˚l_jmp_buf
[1];

506 *
__∑d
[4];

507 } 
	t__±hªad_unwöd_buf_t
 
	t__©åibuã__
 ((
	t__Æig√d__
));

510 #i‚de‡
__˛ónup_f˘_©åibuã


511 
	#__˛ónup_f˘_©åibuã


	)

516 
	s__±hªad_˛ónup_‰ame


518 (*
__ˇn˚l_routöe
) (*);

519 *
__ˇn˚l_¨g
;

520 
__do_ô
;

521 
__ˇn˚l_ty≥
;

524 #i‡
deföed
 
__GNUC__
 && deföed 
__EXCEPTIONS


525 #ifde‡
__˝lu•lus


527 ˛as†
	c__±hªad_˛ónup_˛ass


529 (*
__ˇn˚l_routöe
) (*);

530 *
__ˇn˚l_¨g
;

531 
__do_ô
;

532 
__ˇn˚l_ty≥
;

534 
public
:

535 
	$__±hªad_˛ónup_˛ass
 ((*
__f˘
Ë(*), *
__¨g
)

536 : 
	`__ˇn˚l_routöe
 (
__f˘
), 
	`__ˇn˚l_¨g
 (
__¨g
), 
	$__do_ô
 (1) { }

537 ~
	$__±hªad_˛ónup_˛ass
 (Ë{ i‡(
__do_ô
Ë
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); 
	}
}

538 
	$__£tdoô
 (
__√wvÆ
Ë{ 
__do_ô
 = __√wvÆ; 
	}
}

539 
	$__de„r
 (Ë{ 
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
,

540 &
__ˇn˚l_ty≥
); 
	}
}

541 
	$__ª°‹e
 (Ëc⁄° { 
	`±hªad_£tˇn˚…y≥
 (
__ˇn˚l_ty≥
, 0); 
	}
}

551 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

553 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
)

	)

557 
	#±hªad_˛ónup_p›
(
execuã
) \

558 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

559 } 0)

	)

561 #ifde‡
__USE_GNU


565 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

567 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
); \

568 
__˛‰ame
.
	`__de„r
 ()

	)

573 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

574 
__˛‰ame
.
	`__ª°‹e
 (); \

575 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

576 } 0)

	)

583 
__exã∫_ölöe
 

584 
	$__±hªad_˛ónup_routöe
 (
__±hªad_˛ónup_‰ame
 *
__‰ame
)

586 i‡(
__‰ame
->
__do_ô
)

587 
__‰ame
->
	`__ˇn˚l_routöe
 (__‰ame->
__ˇn˚l_¨g
);

588 
	}
}

597 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

599 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

600 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

601 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

602 .
__do_ô
 = 1 };

	)

606 
	#±hªad_˛ónup_p›
(
execuã
) \

607 
__˛‰ame
.
__do_ô
 = (
execuã
); \

608 } 0)

	)

610 #ifde‡
__USE_GNU


614 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

616 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

617 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

618 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

619 .
__do_ô
 = 1 }; \

620 (Ë
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
, \

621 &
__˛‰ame
.
__ˇn˚l_ty≥
)

	)

626 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

627 (Ë
	`±hªad_£tˇn˚…y≥
 (
__˛‰ame
.
__ˇn˚l_ty≥
, 
NULL
); \

628 
__˛‰ame
.
__do_ô
 = (
execuã
); \

629 } 0)

	)

640 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

642 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

643 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

644 *
__ˇn˚l_¨g
 = (
¨g
); \

645 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

646 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

647 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

649 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

650 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

654 
	`__±hªad_ªgi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

655 dÿ{

	)

656 
__±hªad_ªgi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

657 
__˛ónup_f˘_©åibuã
;

661 
	#±hªad_˛ónup_p›
(
execuã
) \

664 
	`__±hªad_uƒegi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

665 i‡(
execuã
) \

666 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

667 } 0)

	)

668 
	$__±hªad_uƒegi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

669 
__˛ónup_f˘_©åibuã
;

671 #ifde‡
__USE_GNU


675 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

677 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

678 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

679 *
__ˇn˚l_¨g
 = (
¨g
); \

680 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

681 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

682 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

684 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

685 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

689 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (&
__ˇn˚l_buf
); \

690 dÿ{

	)

691 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (
__±hªad_unwöd_buf_t
 *
__buf
)

692 
__˛ónup_f˘_©åibuã
;

697 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

700 
	`__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (&
__ˇn˚l_buf
); \

701 i‡(
execuã
) \

702 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

703 
	}
} 0)

	)

704 
	$__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (
__±hªad_unwöd_buf_t
 *
__buf
)

705 
__˛ónup_f˘_©åibuã
;

709 
	$__±hªad_unwöd_√xt
 (
__±hªad_unwöd_buf_t
 *
__buf
)

710 
__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

711 #i‚de‡
SHARED


712 
	`__©åibuã__
 ((
__wók__
))

718 
__jmp_buf_èg
;

719 
	$__sig£tjmp
 (
__jmp_buf_èg
 *
__ív
, 
__ßvemask
Ë
__THROWNL
;

725 
	$±hªad_muãx_öô
 (
±hªad_muãx_t
 *
__muãx
,

726 c⁄° 
±hªad_muãx©å_t
 *
__muãx©å
)

727 
__THROW
 
	`__n⁄nuŒ
 ((1));

730 
	$±hªad_muãx_de°roy
 (
±hªad_muãx_t
 *
__muãx
)

731 
__THROW
 
	`__n⁄nuŒ
 ((1));

734 
	$±hªad_muãx_åylock
 (
±hªad_muãx_t
 *
__muãx
)

735 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

738 
	$±hªad_muãx_lock
 (
±hªad_muãx_t
 *
__muãx
)

739 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

741 #ifde‡
__USE_XOPEN2K


743 
	$±hªad_muãx_timedlock
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

744 c⁄° 
time•ec
 *
__ª°ri˘


745 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

748 #ifde‡
__USE_GNU


749 
	$±hªad_muãx_˛ocklock
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

750 
˛ockid_t
 
__˛ockid
,

751 c⁄° 
time•ec
 *
__ª°ri˘


752 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 3));

756 
	$±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 *
__muãx
)

757 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

761 
	$±hªad_muãx_gë¥io˚ûög
 (c⁄° 
±hªad_muãx_t
 *

762 
__ª°ri˘
 
__muãx
,

763 *
__ª°ri˘
 
__¥io˚ûög
)

764 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

768 
	$±hªad_muãx_£çrio˚ûög
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

769 
__¥io˚ûög
,

770 *
__ª°ri˘
 
__ﬁd_˚ûög
)

771 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

774 #ifde‡
__USE_XOPEN2K8


776 
	$±hªad_muãx_c⁄si°ít
 (
±hªad_muãx_t
 *
__muãx
)

777 
__THROW
 
	`__n⁄nuŒ
 ((1));

778 #ifde‡
__USE_GNU


779 
	$±hªad_muãx_c⁄si°ít_≈
 (
±hªad_muãx_t
 *
__muãx
)

780 
__THROW
 
	`__n⁄nuŒ
 ((1));

789 
	$±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 *
__©å
)

790 
__THROW
 
	`__n⁄nuŒ
 ((1));

793 
	$±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 *
__©å
)

794 
__THROW
 
	`__n⁄nuŒ
 ((1));

797 
	$±hªad_muãx©å_gëpsh¨ed
 (c⁄° 
±hªad_muãx©å_t
 *

798 
__ª°ri˘
 
__©å
,

799 *
__ª°ri˘
 
__psh¨ed
)

800 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

803 
	$±hªad_muãx©å_£çsh¨ed
 (
±hªad_muãx©å_t
 *
__©å
,

804 
__psh¨ed
)

805 
__THROW
 
	`__n⁄nuŒ
 ((1));

807 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


809 
	$±hªad_muãx©å_gëty≥
 (c⁄° 
±hªad_muãx©å_t
 *
__ª°ri˘


810 
__©å
, *
__ª°ri˘
 
__köd
)

811 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

816 
	$±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 *
__©å
, 
__köd
)

817 
__THROW
 
	`__n⁄nuŒ
 ((1));

821 
	$±hªad_muãx©å_gë¥Ÿocﬁ
 (c⁄° 
±hªad_muãx©å_t
 *

822 
__ª°ri˘
 
__©å
,

823 *
__ª°ri˘
 
__¥Ÿocﬁ
)

824 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

828 
	$±hªad_muãx©å_£çrŸocﬁ
 (
±hªad_muãx©å_t
 *
__©å
,

829 
__¥Ÿocﬁ
)

830 
__THROW
 
	`__n⁄nuŒ
 ((1));

833 
	$±hªad_muãx©å_gë¥io˚ûög
 (c⁄° 
±hªad_muãx©å_t
 *

834 
__ª°ri˘
 
__©å
,

835 *
__ª°ri˘
 
__¥io˚ûög
)

836 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

839 
	$±hªad_muãx©å_£çrio˚ûög
 (
±hªad_muãx©å_t
 *
__©å
,

840 
__¥io˚ûög
)

841 
__THROW
 
	`__n⁄nuŒ
 ((1));

843 #ifde‡
__USE_XOPEN2K


845 
	$±hªad_muãx©å_gërobu°
 (c⁄° 
±hªad_muãx©å_t
 *
__©å
,

846 *
__robu°√ss
)

847 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

848 #ifde‡
__USE_GNU


849 
	$±hªad_muãx©å_gërobu°_≈
 (c⁄° 
±hªad_muãx©å_t
 *
__©å
,

850 *
__robu°√ss
)

851 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

855 
	$±hªad_muãx©å_£åobu°
 (
±hªad_muãx©å_t
 *
__©å
,

856 
__robu°√ss
)

857 
__THROW
 
	`__n⁄nuŒ
 ((1));

858 #ifde‡
__USE_GNU


859 
	$±hªad_muãx©å_£åobu°_≈
 (
±hªad_muãx©å_t
 *
__©å
,

860 
__robu°√ss
)

861 
__THROW
 
	`__n⁄nuŒ
 ((1));

866 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


871 
	$±hªad_rwlock_öô
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

872 c⁄° 
±hªad_rwlock©å_t
 *
__ª°ri˘


873 
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

876 
	$±hªad_rwlock_de°roy
 (
±hªad_rwlock_t
 *
__rwlock
)

877 
__THROW
 
	`__n⁄nuŒ
 ((1));

880 
	$±hªad_rwlock_rdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

881 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

884 
	$±hªad_rwlock_åyrdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

885 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

887 #ifde‡
__USE_XOPEN2K


889 
	$±hªad_rwlock_timedrdlock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

890 c⁄° 
time•ec
 *
__ª°ri˘


891 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

894 #ifde‡
__USE_GNU


895 
	$±hªad_rwlock_˛ockrdlock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

896 
˛ockid_t
 
__˛ockid
,

897 c⁄° 
time•ec
 *
__ª°ri˘


898 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 3));

902 
	$±hªad_rwlock_wæock
 (
±hªad_rwlock_t
 *
__rwlock
)

903 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

906 
	$±hªad_rwlock_åywæock
 (
±hªad_rwlock_t
 *
__rwlock
)

907 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

909 #ifde‡
__USE_XOPEN2K


911 
	$±hªad_rwlock_timedwæock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

912 c⁄° 
time•ec
 *
__ª°ri˘


913 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

916 #ifde‡
__USE_GNU


917 
	$±hªad_rwlock_˛ockwæock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

918 
˛ockid_t
 
__˛ockid
,

919 c⁄° 
time•ec
 *
__ª°ri˘


920 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 3));

924 
	$±hªad_rwlock_u∆ock
 (
±hªad_rwlock_t
 *
__rwlock
)

925 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

931 
	$±hªad_rwlock©å_öô
 (
±hªad_rwlock©å_t
 *
__©å
)

932 
__THROW
 
	`__n⁄nuŒ
 ((1));

935 
	$±hªad_rwlock©å_de°roy
 (
±hªad_rwlock©å_t
 *
__©å
)

936 
__THROW
 
	`__n⁄nuŒ
 ((1));

939 
	$±hªad_rwlock©å_gëpsh¨ed
 (c⁄° 
±hªad_rwlock©å_t
 *

940 
__ª°ri˘
 
__©å
,

941 *
__ª°ri˘
 
__psh¨ed
)

942 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

945 
	$±hªad_rwlock©å_£çsh¨ed
 (
±hªad_rwlock©å_t
 *
__©å
,

946 
__psh¨ed
)

947 
__THROW
 
	`__n⁄nuŒ
 ((1));

950 
	$±hªad_rwlock©å_gëköd_≈
 (c⁄° 
±hªad_rwlock©å_t
 *

951 
__ª°ri˘
 
__©å
,

952 *
__ª°ri˘
 
__¥ef
)

953 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

956 
	$±hªad_rwlock©å_£tköd_≈
 (
±hªad_rwlock©å_t
 *
__©å
,

957 
__¥ef
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

965 
	$±hªad_c⁄d_öô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

966 c⁄° 
±hªad_c⁄d©å_t
 *
__ª°ri˘
 
__c⁄d_©å
)

967 
__THROW
 
	`__n⁄nuŒ
 ((1));

970 
	$±hªad_c⁄d_de°roy
 (
±hªad_c⁄d_t
 *
__c⁄d
)

971 
__THROW
 
	`__n⁄nuŒ
 ((1));

974 
	$±hªad_c⁄d_sig«l
 (
±hªad_c⁄d_t
 *
__c⁄d
)

975 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

978 
	$±hªad_c⁄d_brﬂdˇ°
 (
±hªad_c⁄d_t
 *
__c⁄d
)

979 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

986 
	$±hªad_c⁄d_waô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

987 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
)

988 
	`__n⁄nuŒ
 ((1, 2));

997 
	$±hªad_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

998 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

999 c⁄° 
time•ec
 *
__ª°ri˘
 
__ab°ime
)

1000 
	`__n⁄nuŒ
 ((1, 2, 3));

1002 #ifde‡
__USE_GNU


1010 
	$±hªad_c⁄d_˛ockwaô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

1011 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

1012 
__˛ockid_t
 
__˛ock_id
,

1013 c⁄° 
time•ec
 *
__ª°ri˘
 
__ab°ime
)

1014 
	`__n⁄nuŒ
 ((1, 2, 4));

1020 
	$±hªad_c⁄d©å_öô
 (
±hªad_c⁄d©å_t
 *
__©å
)

1021 
__THROW
 
	`__n⁄nuŒ
 ((1));

1024 
	$±hªad_c⁄d©å_de°roy
 (
±hªad_c⁄d©å_t
 *
__©å
)

1025 
__THROW
 
	`__n⁄nuŒ
 ((1));

1028 
	$±hªad_c⁄d©å_gëpsh¨ed
 (c⁄° 
±hªad_c⁄d©å_t
 *

1029 
__ª°ri˘
 
__©å
,

1030 *
__ª°ri˘
 
__psh¨ed
)

1031 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1034 
	$±hªad_c⁄d©å_£çsh¨ed
 (
±hªad_c⁄d©å_t
 *
__©å
,

1035 
__psh¨ed
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

1037 #ifde‡
__USE_XOPEN2K


1039 
	$±hªad_c⁄d©å_gë˛ock
 (c⁄° 
±hªad_c⁄d©å_t
 *

1040 
__ª°ri˘
 
__©å
,

1041 
__˛ockid_t
 *
__ª°ri˘
 
__˛ock_id
)

1042 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1045 
	$±hªad_c⁄d©å_£t˛ock
 (
±hªad_c⁄d©å_t
 *
__©å
,

1046 
__˛ockid_t
 
__˛ock_id
)

1047 
__THROW
 
	`__n⁄nuŒ
 ((1));

1051 #ifde‡
__USE_XOPEN2K


1056 
	$±hªad_•ö_öô
 (
±hªad_•ölock_t
 *
__lock
, 
__psh¨ed
)

1057 
__THROW
 
	`__n⁄nuŒ
 ((1));

1060 
	$±hªad_•ö_de°roy
 (
±hªad_•ölock_t
 *
__lock
)

1061 
__THROW
 
	`__n⁄nuŒ
 ((1));

1064 
	$±hªad_•ö_lock
 (
±hªad_•ölock_t
 *
__lock
)

1065 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1068 
	$±hªad_•ö_åylock
 (
±hªad_•ölock_t
 *
__lock
)

1069 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1072 
	$±hªad_•ö_u∆ock
 (
±hªad_•ölock_t
 *
__lock
)

1073 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1080 
	$±hªad_b¨rõr_öô
 (
±hªad_b¨rõr_t
 *
__ª°ri˘
 
__b¨rõr
,

1081 c⁄° 
±hªad_b¨rõøâr_t
 *
__ª°ri˘


1082 
__©å
, 
__cou¡
)

1083 
__THROW
 
	`__n⁄nuŒ
 ((1));

1086 
	$±hªad_b¨rõr_de°roy
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1087 
__THROW
 
	`__n⁄nuŒ
 ((1));

1090 
	$±hªad_b¨rõr_waô
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1091 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1095 
	$±hªad_b¨rõøâr_öô
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1096 
__THROW
 
	`__n⁄nuŒ
 ((1));

1099 
	$±hªad_b¨rõøâr_de°roy
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1100 
__THROW
 
	`__n⁄nuŒ
 ((1));

1103 
	$±hªad_b¨rõøâr_gëpsh¨ed
 (c⁄° 
±hªad_b¨rõøâr_t
 *

1104 
__ª°ri˘
 
__©å
,

1105 *
__ª°ri˘
 
__psh¨ed
)

1106 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1109 
	$±hªad_b¨rõøâr_£çsh¨ed
 (
±hªad_b¨rõøâr_t
 *
__©å
,

1110 
__psh¨ed
)

1111 
__THROW
 
	`__n⁄nuŒ
 ((1));

1123 
	$±hªad_key_¸óã
 (
±hªad_key_t
 *
__key
,

1124 (*
__de°r_fun˘i⁄
) (*))

1125 
__THROW
 
	`__n⁄nuŒ
 ((1));

1128 
	$±hªad_key_dñëe
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1131 *
	$±hªad_gë•ecific
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1134 
	$±hªad_£t•ecific
 (
±hªad_key_t
 
__key
,

1135 c⁄° *
__poöãr
Ë
__THROW
 ;

1138 #ifde‡
__USE_XOPEN2K


1140 
	$±hªad_gë˝u˛ockid
 (
±hªad_t
 
__thªad_id
,

1141 
__˛ockid_t
 *
__˛ock_id
)

1142 
__THROW
 
	`__n⁄nuŒ
 ((2));

1157 
	$±hªad_©f‹k
 ((*
__¥ï¨e
) (),

1158 (*
__∑ª¡
) (),

1159 (*
__chûd
Ë()Ë
__THROW
;

1162 #ifde‡
__USE_EXTERN_INLINES


1164 
__exã∫_ölöe
 

1165 
	`__NTH
 (
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
))

1167  
__thªad1
 =
__thªad2
;

1168 
	}
}

1171 
	g__END_DECLS


	@/usr/include/pwd.h

22 #i‚def 
_PWD_H


23 
	#_PWD_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/ty≥s.h
>

31 
	#__√ed_size_t


	)

32 
	~<°ddef.h
>

34 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


37 #i‚de‡
__gid_t_deföed


38 
__gid_t
 
	tgid_t
;

39 
	#__gid_t_deföed


	)

42 #i‚de‡
__uid_t_deföed


43 
__uid_t
 
	tuid_t
;

44 
	#__uid_t_deföed


	)

49 
	s∑sswd


51 *
	mpw_«me
;

52 *
	mpw_∑sswd
;

54 
__uid_t
 
	mpw_uid
;

55 
__gid_t
 
	mpw_gid
;

56 *
	mpw_gecos
;

57 *
	mpw_dú
;

58 *
	mpw_shñl
;

62 #ifde‡
__USE_MISC


63 
	~<bôs/ty≥s/FILE.h
>

67 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


72 
£çwít
 ();

78 
ídpwít
 ();

84 
∑sswd
 *
gëpwít
 ();

87 #ifdef 
__USE_MISC


94 
∑sswd
 *
	$fgëpwít
 (
FILE
 *
__°ªam
Ë
	`__n⁄nuŒ
 ((1));

102 
	`puçwít
 (c⁄° 
∑sswd
 *
__ª°ri˘
 
__p
,

103 
FILE
 *
__ª°ri˘
 
__f
);

110 
∑sswd
 *
	`gëpwuid
 (
__uid_t
 
__uid
);

116 
∑sswd
 *
	$gëpw«m
 (c⁄° *
__«me
Ë
	`__n⁄nuŒ
 ((1));

118 #ifde‡
__USE_POSIX


120 #ifde‡
__USE_MISC


123 
	#NSS_BUFLEN_PASSWD
 1024

	)

134 #ifde‡
__USE_MISC


139 
	$gëpwít_r
 (
∑sswd
 *
__ª°ri˘
 
__ªsu…buf
,

140 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
,

141 
∑sswd
 **
__ª°ri˘
 
__ªsu…
)

142 
	`__n⁄nuŒ
 ((1, 2, 4));

145 
	$gëpwuid_r
 (
__uid_t
 
__uid
,

146 
∑sswd
 *
__ª°ri˘
 
__ªsu…buf
,

147 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
,

148 
∑sswd
 **
__ª°ri˘
 
__ªsu…
)

149 
	`__n⁄nuŒ
 ((2, 3, 5));

151 
	$gëpw«m_r
 (c⁄° *
__ª°ri˘
 
__«me
,

152 
∑sswd
 *
__ª°ri˘
 
__ªsu…buf
,

153 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
,

154 
∑sswd
 **
__ª°ri˘
 
__ªsu…
)

155 
	`__n⁄nuŒ
 ((1, 2, 3, 5));

158 #ifdef 
__USE_MISC


166 
	$fgëpwít_r
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

167 
∑sswd
 *
__ª°ri˘
 
__ªsu…buf
,

168 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
,

169 
∑sswd
 **
__ª°ri˘
 
__ªsu…
)

170 
	`__n⁄nuŒ
 ((1, 2, 3, 5));

175 #ifde‡
__USE_GNU


184 
	`gëpw
 (
__uid_t
 
__uid
, *
__buf„r
);

187 
__END_DECLS


	@/usr/include/sched.h

19 #i‚def 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<„©uªs.h
>

25 
	~<bôs/ty≥s.h
>

27 
	#__√ed_size_t


	)

28 
	#__√ed_NULL


	)

29 
	~<°ddef.h
>

31 
	~<bôs/ty≥s/time_t.h
>

32 
	~<bôs/ty≥s/°ru˘_time•ec.h
>

33 #i‚de‡
__USE_XOPEN2K


34 
	~<time.h
>

37 #i‚de‡
__pid_t_deföed


38 
__pid_t
 
	tpid_t
;

39 
	#__pid_t_deföed


	)

43 
	~<bôs/sched.h
>

44 
	~<bôs/˝u-£t.h
>

47 
	#sched_¥i‹ôy
 
sched_¥i‹ôy


	)

48 
	#__sched_¥i‹ôy
 
sched_¥i‹ôy


	)

51 
__BEGIN_DECLS


54 
	$sched_£ç¨am
 (
__pid_t
 
__pid
, c⁄° 
sched_∑øm
 *
__∑øm
)

55 
__THROW
;

58 
	$sched_gë∑øm
 (
__pid_t
 
__pid
, 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

61 
	$sched_£tscheduÀr
 (
__pid_t
 
__pid
, 
__pﬁicy
,

62 c⁄° 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

65 
	$sched_gëscheduÀr
 (
__pid_t
 
__pid
Ë
__THROW
;

68 
	$sched_yõld
 (Ë
__THROW
;

71 
	$sched_gë_¥i‹ôy_max
 (
__Æg‹ôhm
Ë
__THROW
;

74 
	$sched_gë_¥i‹ôy_mö
 (
__Æg‹ôhm
Ë
__THROW
;

77 
	$sched_º_gë_öãrvÆ
 (
__pid_t
 
__pid
, 
time•ec
 *
__t
Ë
__THROW
;

80 #ifde‡
__USE_GNU


82 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

83 
	#CPU_SET
(
˝u
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

84 
	#CPU_CLR
(
˝u
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

85 
	#CPU_ISSET
(
˝u
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (˝u,  (
˝u_£t_t
), \

86 
˝u£ç
)

	)

87 
	#CPU_ZERO
(
˝u£ç
Ë
	`__CPU_ZERO_S
 ( (
˝u_£t_t
), cpu£ç)

	)

88 
	#CPU_COUNT
(
˝u£ç
Ë
	`__CPU_COUNT_S
 ( (
˝u_£t_t
), cpu£ç)

	)

90 
	#CPU_SET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u, sësize, cpu£ç)

	)

91 
	#CPU_CLR_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u, sësize, cpu£ç)

	)

92 
	#CPU_ISSET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (cpu, setsize, \

93 
˝u£ç
)

	)

94 
	#CPU_ZERO_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_ZERO_S
 (£tsize, cpu£ç)

	)

95 
	#CPU_COUNT_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_COUNT_S
 (£tsize, cpu£ç)

	)

97 
	#CPU_EQUAL
(
˝u£ç1
, 
˝u£ç2
) \

98 
	`__CPU_EQUAL_S
 ( (
˝u_£t_t
), 
˝u£ç1
, 
˝u£ç2
)

	)

99 
	#CPU_EQUAL_S
(
£tsize
, 
˝u£ç1
, 
˝u£ç2
) \

100 
	`__CPU_EQUAL_S
 (
£tsize
, 
˝u£ç1
, 
˝u£ç2
)

	)

102 
	#CPU_AND
(
de°£t
, 
§c£t1
, 
§c£t2
) \

103 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

104 
	#CPU_OR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

105 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

106 
	#CPU_XOR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

107 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

108 
	#CPU_AND_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

109 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

110 
	#CPU_OR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

111 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

112 
	#CPU_XOR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

113 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

115 
	#CPU_ALLOC_SIZE
(
cou¡
Ë
	`__CPU_ALLOC_SIZE
 (cou¡)

	)

116 
	#CPU_ALLOC
(
cou¡
Ë
	`__CPU_ALLOC
 (cou¡)

	)

117 
	#CPU_FREE
(
˝u£t
Ë
	`__CPU_FREE
 (˝u£t)

	)

121 
	$sched_£èfföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

122 c⁄° 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

125 
	$sched_gëafföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

126 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

129 
__END_DECLS


	@/usr/include/semaphore.h

18 #i‚de‡
_SEMAPHORE_H


19 
	#_SEMAPHORE_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<sys/ty≥s.h
>

23 #ifde‡
__USE_XOPEN2K


24 
	~<bôs/ty≥s/°ru˘_time•ec.h
>

28 
	~<bôs/£m≠h‹e.h
>

31 
__BEGIN_DECLS


35 
	$£m_öô
 (
£m_t
 *
__£m
, 
__psh¨ed
, 
__vÆue
)

36 
__THROW
 
	`__n⁄nuŒ
 ((1));

39 
	$£m_de°roy
 (
£m_t
 *
__£m
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

42 
£m_t
 *
	$£m_›í
 (c⁄° *
__«me
, 
__oÊag
, ...)

43 
__THROW
 
	`__n⁄nuŒ
 ((1));

46 
	$£m_˛o£
 (
£m_t
 *
__£m
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

49 
	$£m_u∆ök
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

55 
	$£m_waô
 (
£m_t
 *
__£m
Ë
	`__n⁄nuŒ
 ((1));

57 #ifde‡
__USE_XOPEN2K


62 
	$£m_timedwaô
 (
£m_t
 *
__ª°ri˘
 
__£m
,

63 c⁄° 
time•ec
 *
__ª°ri˘
 
__ab°ime
)

64 
	`__n⁄nuŒ
 ((1, 2));

67 #ifde‡
__USE_GNU


68 
	$£m_˛ockwaô
 (
£m_t
 *
__ª°ri˘
 
__£m
,

69 
˛ockid_t
 
˛ock
,

70 c⁄° 
time•ec
 *
__ª°ri˘
 
__ab°ime
)

71 
	`__n⁄nuŒ
 ((1, 3));

75 
	$£m_åywaô
 (
£m_t
 *
__£m
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1));

78 
	$£m_po°
 (
£m_t
 *
__£m
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1));

81 
	$£m_gëvÆue
 (
£m_t
 *
__ª°ri˘
 
__£m
, *__ª°ri˘ 
__svÆ
)

82 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

85 
__END_DECLS


	@/usr/include/signal.h

22 #i‚def 
_SIGNAL_H


23 
	#_SIGNAL_H


	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/ty≥s.h
>

30 
	~<bôs/signum.h
>

32 
	~<bôs/ty≥s/sig_©omic_t.h
>

34 #i‡
deföed
 
__USE_POSIX


35 
	~<bôs/ty≥s/sig£t_t.h
>

38 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


39 #i‚de‡
__pid_t_deföed


40 
__pid_t
 
	tpid_t
;

41 
	#__pid_t_deföed


	)

43 #ifde‡
__USE_XOPEN


45 #i‚de‡
__uid_t_deföed


46 
__uid_t
 
	tuid_t
;

47 
	#__uid_t_deföed


	)

51 #ifde‡
__USE_POSIX199309


53 
	~<bôs/ty≥s/°ru˘_time•ec.h
>

56 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_XOPEN_EXTENDED


57 
	~<bôs/ty≥s/sigöfo_t.h
>

58 
	~<bôs/sigöfo-c⁄°s.h
>

61 #ifde‡
__USE_MISC


62 
	~<bôs/ty≥s/sigvÆ_t.h
>

65 #ifde‡
__USE_POSIX199309


66 
	~<bôs/ty≥s/sigevít_t.h
>

67 
	~<bôs/sigevít-c⁄°s.h
>

72 (*
	t__sigh™dÀr_t
) ();

77 
__sigh™dÀr_t
 
	$__sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

78 
__THROW
;

79 #ifde‡
__USE_GNU


80 
__sigh™dÀr_t
 
	$sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

81 
__THROW
;

87 #ifde‡
__USE_MISC


88 
__sigh™dÀr_t
 
	$sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

89 
__THROW
;

92 #ifde‡
__REDIRECT_NTH


93 
__sigh™dÀr_t
 
	`__REDIRECT_NTH
 (
sig«l
,

94 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
),

95 
__sysv_sig«l
);

97 
	#sig«l
 
__sysv_sig«l


	)

101 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8


104 
__sigh™dÀr_t
 
	$bsd_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

105 
__THROW
;

111 #ifde‡
__USE_POSIX


112 
	$kûl
 (
__pid_t
 
__pid
, 
__sig
Ë
__THROW
;

115 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


119 
	$kûÕg
 (
__pid_t
 
__pgΩ
, 
__sig
Ë
__THROW
;

123 
	$øi£
 (
__sig
Ë
__THROW
;

125 #ifde‡
__USE_MISC


127 
__sigh™dÀr_t
 
	$ssig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

128 
__THROW
;

129 
	$gsig«l
 (
__sig
Ë
__THROW
;

132 #ifde‡
__USE_XOPEN2K8


134 
	`psig«l
 (
__sig
, c⁄° *
__s
);

137 
	`psigöfo
 (c⁄° 
sigöfo_t
 *
__pöfo
, c⁄° *
__s
);

149 #ifde‡
__USE_XOPEN_EXTENDED


150 #ifde‡
__GNUC__


151 
	$sig∑u£
 (
__sig
Ë
	`__asm__
 ("__xpg_sigpause");

153 
	`__sig∑u£
 (
__sig_‹_mask
, 
__is_sig
);

155 
	#sig∑u£
(
sig
Ë
	`__sig∑u£
 ((sig), 1)

	)

160 #ifde‡
__USE_MISC


167 
	#sigmask
(
sig
Ë(()(1u << ((sigË- 1)))

	)

170 
	$sigblock
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

173 
	$sig£tmask
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

176 
	$siggëmask
 (Ë
__THROW
 
__©åibuã_dïªˇãd__
;

180 #ifde‡
__USE_MISC


181 
	#NSIG
 
_NSIG


	)

184 #ifde‡
__USE_GNU


185 
__sigh™dÀr_t
 
	tsigh™dÀr_t
;

189 #ifde‡
__USE_MISC


190 
__sigh™dÀr_t
 
	tsig_t
;

193 #ifde‡
__USE_POSIX


196 
	$sigem±y£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

199 
	$sigfûl£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

202 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

205 
	$sigdñ£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

208 
	$sigismembî
 (c⁄° 
sig£t_t
 *
__£t
, 
__signo
)

209 
__THROW
 
	`__n⁄nuŒ
 ((1));

211 #ifde‡
__USE_GNU


213 
	$sigi£m±y£t
 (c⁄° 
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

216 
	$sig™d£t
 (
sig£t_t
 *
__£t
, c⁄° sig£t_à*
__À·
,

217 c⁄° 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

220 
	$sig‹£t
 (
sig£t_t
 *
__£t
, c⁄° sig£t_à*
__À·
,

221 c⁄° 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

226 
	~<bôs/siga˘i⁄.h
>

229 
	$sig¥ocmask
 (
__how
, c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

230 
sig£t_t
 *
__ª°ri˘
 
__o£t
Ë
__THROW
;

237 
	$sigsu•íd
 (c⁄° 
sig£t_t
 *
__£t
Ë
	`__n⁄nuŒ
 ((1));

240 
	$siga˘i⁄
 (
__sig
, c⁄° 
siga˘i⁄
 *
__ª°ri˘
 
__a˘
,

241 
siga˘i⁄
 *
__ª°ri˘
 
__ﬂ˘
Ë
__THROW
;

244 
	$sig≥ndög
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

247 #ifde‡
__USE_POSIX199506


252 
	$sigwaô
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
, *__ª°ri˘ 
__sig
)

253 
	`__n⁄nuŒ
 ((1, 2));

256 #ifde‡
__USE_POSIX199309


261 
	$sigwaôöfo
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

262 
sigöfo_t
 *
__ª°ri˘
 
__öfo
Ë
	`__n⁄nuŒ
 ((1));

269 
	$sigtimedwaô
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

270 
sigöfo_t
 *
__ª°ri˘
 
__öfo
,

271 c⁄° 
time•ec
 *
__ª°ri˘
 
__timeout
)

272 
	`__n⁄nuŒ
 ((1));

276 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, c⁄° 
sigvÆ
 
__vÆ
)

277 
__THROW
;

282 #ifde‡
__USE_MISC


286 c⁄° *c⁄° 
_sys_sigli°
[
_NSIG
];

287 c⁄° *c⁄° 
sys_sigli°
[
_NSIG
];

291 
	~<bôs/sigc⁄ãxt.h
>

294 
	$sigªtu∫
 (
sigc⁄ãxt
 *
__s˝
Ë
__THROW
;

299 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


300 
	#__√ed_size_t


	)

301 
	~<°ddef.h
>

303 
	~<bôs/ty≥s/°ack_t.h
>

304 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


306 
	~<sys/uc⁄ãxt.h
>

310 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_MISC


314 
	$sigöãºu±
 (
__sig
, 
__öãºu±
Ë
__THROW
;

316 
	~<bôs/sig°ack.h
>

317 
	~<bôs/ss_Êags.h
>

321 
	$sigÆt°ack
 (c⁄° 
°ack_t
 *
__ª°ri˘
 
__ss
,

322 
°ack_t
 *
__ª°ri˘
 
__oss
Ë
__THROW
;

325 #i‡((
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

326 || 
deföed
 
__USE_MISC
)

327 
	~<bôs/ty≥s/°ru˘_sig°ack.h
>

330 #i‡((
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

331 || 
deföed
 
__USE_MISC
)

335 
	$sig°ack
 (
sig°ack
 *
__ss
, sig°ack *
__oss
)

336 
__THROW
 
__©åibuã_dïªˇãd__
;

339 #ifde‡
__USE_XOPEN_EXTENDED


343 
	$sighﬁd
 (
__sig
Ë
__THROW
;

346 
	$sigªl£
 (
__sig
Ë
__THROW
;

349 
	$sigign‹e
 (
__sig
Ë
__THROW
;

352 
__sigh™dÀr_t
 
	$sig£t
 (
__sig
, 
__sigh™dÀr_t
 
__di•
Ë
__THROW
;

355 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


358 
	~<bôs/±hªadty≥s.h
>

359 
	~<bôs/sigthªad.h
>

366 
	$__libc_cuºít_sigπmö
 (Ë
__THROW
;

368 
	$__libc_cuºít_sigπmax
 (Ë
__THROW
;

370 
	#SIGRTMIN
 (
	`__libc_cuºít_sigπmö
 ())

	)

371 
	#SIGRTMAX
 (
	`__libc_cuºít_sigπmax
 ())

	)

374 
	~<bôs/sig«l_ext.h
>

376 
__END_DECLS


	@/usr/include/stdio.h

23 #i‚de‡
_STDIO_H


24 
	#_STDIO_H
 1

	)

26 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

27 
	~<bôs/libc-hódî-°¨t.h
>

29 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	#__√ed___va_li°


	)

36 
	~<°d¨g.h
>

38 
	~<bôs/ty≥s.h
>

39 
	~<bôs/ty≥s/__Âos_t.h
>

40 
	~<bôs/ty≥s/__Âos64_t.h
>

41 
	~<bôs/ty≥s/__FILE.h
>

42 
	~<bôs/ty≥s/FILE.h
>

43 
	~<bôs/ty≥s/°ru˘_FILE.h
>

45 #ifde‡
__USE_GNU


46 
	~<bôs/ty≥s/cookõ_io_fun˘i⁄s_t.h
>

49 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


50 #ifde‡
__GNUC__


51 #i‚de‡
_VA_LIST_DEFINED


52 
__gnuc_va_li°
 
	tva_li°
;

53 
	#_VA_LIST_DEFINED


	)

56 
	~<°d¨g.h
>

60 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


61 #i‚de‡
__off_t_deföed


62 #i‚de‡
__USE_FILE_OFFSET64


63 
__off_t
 
	toff_t
;

65 
__off64_t
 
	toff_t
;

67 
	#__off_t_deföed


	)

69 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


70 
__off64_t
 
	toff64_t
;

71 
	#__off64_t_deföed


	)

75 #ifde‡
__USE_XOPEN2K8


76 #i‚de‡
__ssize_t_deföed


77 
__ssize_t
 
	tssize_t
;

78 
	#__ssize_t_deföed


	)

83 #i‚de‡
__USE_FILE_OFFSET64


84 
__Âos_t
 
	tÂos_t
;

86 
__Âos64_t
 
	tÂos_t
;

88 #ifde‡
__USE_LARGEFILE64


89 
__Âos64_t
 
	tÂos64_t
;

93 
	#_IOFBF
 0

	)

94 
	#_IOLBF
 1

	)

95 
	#_IONBF
 2

	)

99 
	#BUFSIZ
 8192

	)

104 
	#EOF
 (-1)

	)

109 
	#SEEK_SET
 0

	)

110 
	#SEEK_CUR
 1

	)

111 
	#SEEK_END
 2

	)

112 #ifde‡
__USE_GNU


113 
	#SEEK_DATA
 3

	)

114 
	#SEEK_HOLE
 4

	)

118 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


120 
	#P_tmpdú
 "/tmp"

	)

133 
	~<bôs/°dio_lim.h
>

137 
FILE
 *
°dö
;

138 
FILE
 *
°dout
;

139 
FILE
 *
°dîr
;

141 
	#°dö
 
°dö


	)

142 
	#°dout
 
°dout


	)

143 
	#°dîr
 
°dîr


	)

146 
	$ªmove
 (c⁄° *
__fûíame
Ë
__THROW
;

148 
	$ª«me
 (c⁄° *
__ﬁd
, c⁄° *
__√w
Ë
__THROW
;

150 #ifde‡
__USE_ATFILE


152 
	$ª«mót
 (
__ﬁdfd
, c⁄° *
__ﬁd
, 
__√wfd
,

153 c⁄° *
__√w
Ë
__THROW
;

156 #ifde‡
__USE_GNU


158 
	#RENAME_NOREPLACE
 (1 << 0)

	)

159 
	#RENAME_EXCHANGE
 (1 << 1)

	)

160 
	#RENAME_WHITEOUT
 (1 << 2)

	)

164 
	$ª«mót2
 (
__ﬁdfd
, c⁄° *
__ﬁd
, 
__√wfd
,

165 c⁄° *
__√w
, 
__Êags
Ë
__THROW
;

172 #i‚de‡
__USE_FILE_OFFSET64


173 
FILE
 *
	$tmpfûe
 (Ë
__wur
;

175 #ifde‡
__REDIRECT


176 
FILE
 *
	`__REDIRECT
 (
tmpfûe
, (), 
tmpfûe64
Ë
__wur
;

178 
	#tmpfûe
 
tmpfûe64


	)

182 #ifde‡
__USE_LARGEFILE64


183 
FILE
 *
	$tmpfûe64
 (Ë
__wur
;

187 *
	$tm≤am
 (*
__s
Ë
__THROW
 
__wur
;

189 #ifde‡
__USE_MISC


192 *
	$tm≤am_r
 (*
__s
Ë
__THROW
 
__wur
;

196 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


204 *
	$ãm≤am
 (c⁄° *
__dú
, c⁄° *
__pfx
)

205 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

213 
	`f˛o£
 (
FILE
 *
__°ªam
);

218 
	`fÊush
 (
FILE
 *
__°ªam
);

220 #ifde‡
__USE_MISC


227 
	`fÊush_u∆ocked
 (
FILE
 *
__°ªam
);

230 #ifde‡
__USE_GNU


237 
	`f˛o£Æl
 ();

241 #i‚de‡
__USE_FILE_OFFSET64


246 
FILE
 *
	$f›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

247 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

252 
FILE
 *
	$‰e›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

253 c⁄° *
__ª°ri˘
 
__modes
,

254 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

256 #ifde‡
__REDIRECT


257 
FILE
 *
	`__REDIRECT
 (
f›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

258 c⁄° *
__ª°ri˘
 
__modes
), 
f›í64
)

259 
__wur
;

260 
FILE
 *
	`__REDIRECT
 (
‰e›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

261 c⁄° *
__ª°ri˘
 
__modes
,

262 
FILE
 *
__ª°ri˘
 
__°ªam
), 
‰e›í64
)

263 
__wur
;

265 
	#f›í
 
f›í64


	)

266 
	#‰e›í
 
‰e›í64


	)

269 #ifde‡
__USE_LARGEFILE64


270 
FILE
 *
	$f›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

271 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

272 
FILE
 *
	$‰e›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

273 c⁄° *
__ª°ri˘
 
__modes
,

274 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

277 #ifdef 
__USE_POSIX


279 
FILE
 *
	$fd›í
 (
__fd
, c⁄° *
__modes
Ë
__THROW
 
__wur
;

282 #ifdef 
__USE_GNU


285 
FILE
 *
	$f›ícookõ
 (*
__ª°ri˘
 
__magic_cookõ
,

286 c⁄° *
__ª°ri˘
 
__modes
,

287 
cookõ_io_fun˘i⁄s_t
 
__io_funcs
Ë
__THROW
 
__wur
;

290 #i‡
deföed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

292 
FILE
 *
	$fmem›í
 (*
__s
, 
size_t
 
__Àn
, c⁄° *
__modes
)

293 
__THROW
 
__wur
;

298 
FILE
 *
	$›í_mem°ªam
 (**
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
 
__wur
;

304 
	$£tbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
Ë
__THROW
;

308 
	$£tvbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

309 
__modes
, 
size_t
 
__n
Ë
__THROW
;

311 #ifdef 
__USE_MISC


314 
	$£tbuf„r
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

315 
size_t
 
__size
Ë
__THROW
;

318 
	$£éöebuf
 (
FILE
 *
__°ªam
Ë
__THROW
;

326 
	`Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

327 c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

332 
	`¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

334 
	$•rötf
 (*
__ª°ri˘
 
__s
,

335 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROWNL
;

341 
	`vÂrötf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

342 
__gnuc_va_li°
 
__¨g
);

347 
	`v¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
__gnuc_va_li°
 
__¨g
);

349 
	$v•rötf
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

350 
__gnuc_va_li°
 
__¨g
Ë
__THROWNL
;

352 #i‡
deföed
 
__USE_ISOC99
 || deföed 
__USE_UNIX98


354 
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

355 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

356 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

358 
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

359 c⁄° *
__ª°ri˘
 
__f‹m©
, 
__gnuc_va_li°
 
__¨g
)

360 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

363 #i‡
	`__GLIBC_USE
 (
LIB_EXT2
)

366 
	$va•rötf
 (**
__ª°ri˘
 
__±r
, c⁄° *__ª°ri˘ 
__f
,

367 
__gnuc_va_li°
 
__¨g
)

368 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 0))Ë
__wur
;

369 
	$__a•rötf
 (**
__ª°ri˘
 
__±r
,

370 c⁄° *
__ª°ri˘
 
__fmt
, ...)

371 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

372 
	$a•rötf
 (**
__ª°ri˘
 
__±r
,

373 c⁄° *
__ª°ri˘
 
__fmt
, ...)

374 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

377 #ifde‡
__USE_XOPEN2K8


379 
	$vd¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
,

380 
__gnuc_va_li°
 
__¨g
)

381 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

382 
	$d¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
, ...)

383 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

391 
	$fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

392 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

397 
	$sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

399 
	$ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

400 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

405 #i‡!
	`__GLIBC_USE
 (
DEPRECATED_SCANF
Ë&& !
deföed
 
__LDBL_COMPAT


406 #ifde‡
__REDIRECT


407 
	`__REDIRECT
 (
fsˇnf
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

408 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

409 
__isoc99_fsˇnf
Ë
__wur
;

410 
	`__REDIRECT
 (
sˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

411 
__isoc99_sˇnf
Ë
__wur
;

412 
	`__REDIRECT_NTH
 (
ssˇnf
, (c⁄° *
__ª°ri˘
 
__s
,

413 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

414 
__isoc99_ssˇnf
);

416 
	$__isoc99_fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

417 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

418 
	$__isoc99_sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

419 
	$__isoc99_ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

420 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

421 
	#fsˇnf
 
__isoc99_fsˇnf


	)

422 
	#sˇnf
 
__isoc99_sˇnf


	)

423 
	#ssˇnf
 
__isoc99_ssˇnf


	)

427 #ifdef 
__USE_ISOC99


432 
	$vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

433 
__gnuc_va_li°
 
__¨g
)

434 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

440 
	$vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
__gnuc_va_li°
 
__¨g
)

441 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

444 
	$vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

445 c⁄° *
__ª°ri˘
 
__f‹m©
, 
__gnuc_va_li°
 
__¨g
)

446 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

449 #i‡!
	`__GLIBC_USE
 (
DEPRECATED_SCANF
)

450 #i‡
deföed
 
__REDIRECT
 && !deföed 
__LDBL_COMPAT


451 
	`__REDIRECT
 (
vfsˇnf
,

452 (
FILE
 *
__ª°ri˘
 
__s
,

453 c⁄° *
__ª°ri˘
 
__f‹m©
, 
__gnuc_va_li°
 
__¨g
),

454 
__isoc99_vfsˇnf
)

455 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

456 
	`__REDIRECT
 (
vsˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
,

457 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vsˇnf
)

458 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

459 
	`__REDIRECT_NTH
 (
vssˇnf
,

460 (c⁄° *
__ª°ri˘
 
__s
,

461 c⁄° *
__ª°ri˘
 
__f‹m©
,

462 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vssˇnf
)

463 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

464 #ñi‡!
deföed
 
__REDIRECT


465 
	$__isoc99_vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
,

466 c⁄° *
__ª°ri˘
 
__f‹m©
,

467 
__gnuc_va_li°
 
__¨g
Ë
__wur
;

468 
	$__isoc99_vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
,

469 
__gnuc_va_li°
 
__¨g
Ë
__wur
;

470 
	$__isoc99_vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

471 c⁄° *
__ª°ri˘
 
__f‹m©
,

472 
__gnuc_va_li°
 
__¨g
Ë
__THROW
;

473 
	#vfsˇnf
 
__isoc99_vfsˇnf


	)

474 
	#vsˇnf
 
__isoc99_vsˇnf


	)

475 
	#vssˇnf
 
__isoc99_vssˇnf


	)

485 
	`fgëc
 (
FILE
 *
__°ªam
);

486 
	`gëc
 (
FILE
 *
__°ªam
);

492 
	`gëch¨
 ();

494 #ifde‡
__USE_POSIX199506


499 
	`gëc_u∆ocked
 (
FILE
 *
__°ªam
);

500 
	`gëch¨_u∆ocked
 ();

503 #ifde‡
__USE_MISC


510 
	`fgëc_u∆ocked
 (
FILE
 *
__°ªam
);

521 
	`Âutc
 (
__c
, 
FILE
 *
__°ªam
);

522 
	`putc
 (
__c
, 
FILE
 *
__°ªam
);

528 
	`putch¨
 (
__c
);

530 #ifde‡
__USE_MISC


537 
	`Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

540 #ifde‡
__USE_POSIX199506


545 
	`putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

546 
	`putch¨_u∆ocked
 (
__c
);

550 #i‡
deföed
 
__USE_MISC
 \

551 || (
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

553 
	`gëw
 (
FILE
 *
__°ªam
);

556 
	`putw
 (
__w
, 
FILE
 *
__°ªam
);

564 *
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

565 
__wur
;

567 #i‡
	`__GLIBC_USE
 (
DEPRECATED_GETS
)

577 *
	$gës
 (*
__s
Ë
__wur
 
__©åibuã_dïªˇãd__
;

580 #ifde‡
__USE_GNU


587 *
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
,

588 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

592 #i‡
deföed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

603 
__ssize_t
 
	$__gëdñim
 (**
__ª°ri˘
 
__löïå
,

604 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

605 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

606 
__ssize_t
 
	$gëdñim
 (**
__ª°ri˘
 
__löïå
,

607 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

608 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

616 
__ssize_t
 
	$gëlöe
 (**
__ª°ri˘
 
__löïå
,

617 
size_t
 *
__ª°ri˘
 
__n
,

618 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

626 
	`Âuts
 (c⁄° *
__ª°ri˘
 
__s
, 
FILE
 *__ª°ri˘ 
__°ªam
);

632 
	`puts
 (c⁄° *
__s
);

639 
	`ungëc
 (
__c
, 
FILE
 *
__°ªam
);

646 
size_t
 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

647 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

652 
size_t
 
	`fwrôe
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

653 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__s
);

655 #ifde‡
__USE_GNU


662 
	`Âuts_u∆ocked
 (c⁄° *
__ª°ri˘
 
__s
,

663 
FILE
 *
__ª°ri˘
 
__°ªam
);

666 #ifde‡
__USE_MISC


673 
size_t
 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

674 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

675 
size_t
 
	`fwrôe_u∆ocked
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

676 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
);

684 
	`f£ek
 (
FILE
 *
__°ªam
, 
__off
, 
__whí˚
);

689 
	$·ñl
 (
FILE
 *
__°ªam
Ë
__wur
;

694 
	`ªwöd
 (
FILE
 *
__°ªam
);

701 #i‡
deföed
 
__USE_LARGEFILE
 || deföed 
__USE_XOPEN2K


702 #i‚de‡
__USE_FILE_OFFSET64


707 
	`f£eko
 (
FILE
 *
__°ªam
, 
__off_t
 
__off
, 
__whí˚
);

712 
__off_t
 
	$·ñlo
 (
FILE
 *
__°ªam
Ë
__wur
;

714 #ifde‡
__REDIRECT


715 
	`__REDIRECT
 (
f£eko
,

716 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
),

717 
f£eko64
);

718 
__off64_t
 
	`__REDIRECT
 (
·ñlo
, (
FILE
 *
__°ªam
), 
·ñlo64
);

720 
	#f£eko
 
f£eko64


	)

721 
	#·ñlo
 
·ñlo64


	)

726 #i‚de‡
__USE_FILE_OFFSET64


731 
	`fgëpos
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos_t
 *__ª°ri˘ 
__pos
);

736 
	`f£ços
 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
);

738 #ifde‡
__REDIRECT


739 
	`__REDIRECT
 (
fgëpos
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

740 
Âos_t
 *
__ª°ri˘
 
__pos
), 
fgëpos64
);

741 
	`__REDIRECT
 (
f£ços
,

742 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
), 
f£ços64
);

744 
	#fgëpos
 
fgëpos64


	)

745 
	#f£ços
 
f£ços64


	)

749 #ifde‡
__USE_LARGEFILE64


750 
	`f£eko64
 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
);

751 
__off64_t
 
	$·ñlo64
 (
FILE
 *
__°ªam
Ë
__wur
;

752 
	`fgëpos64
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos64_t
 *__ª°ri˘ 
__pos
);

753 
	`f£ços64
 (
FILE
 *
__°ªam
, c⁄° 
Âos64_t
 *
__pos
);

757 
	$˛óªº
 (
FILE
 *
__°ªam
Ë
__THROW
;

759 
	$„of
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

761 
	$„º‹
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

763 #ifde‡
__USE_MISC


765 
	$˛óªº_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
;

766 
	$„of_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

767 
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

775 
	`≥º‹
 (c⁄° *
__s
);

781 
	~<bôs/sys_îæi°.h
>

784 #ifdef 
__USE_POSIX


786 
	$fûío
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

789 #ifde‡
__USE_MISC


791 
	$fûío_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

795 #ifde‡
__USE_POSIX2


800 
FILE
 *
	$p›í
 (c⁄° *
__comm™d
, c⁄° *
__modes
Ë
__wur
;

806 
	`p˛o£
 (
FILE
 *
__°ªam
);

810 #ifdef 
__USE_POSIX


812 *
	$˘îmid
 (*
__s
Ë
__THROW
;

816 #i‡(
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
Ë|| deföed 
__USE_GNU


818 *
	`cu£rid
 (*
__s
);

822 #ifdef 
__USE_GNU


823 
ob°ack
;

826 
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

827 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

828 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

829 
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

830 c⁄° *
__ª°ri˘
 
__f‹m©
,

831 
__gnuc_va_li°
 
__¨gs
)

832 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

836 #ifde‡
__USE_POSIX199506


840 
	$Êockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

844 
	$·rylockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

847 
	$fu∆ockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

850 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


853 
	~<bôs/gë›t_posix.h
>

858 
	`__uÊow
 (
FILE
 *);

859 
	`__ovîÊow
 (
FILE
 *, );

863 #ifde‡
__USE_EXTERN_INLINES


864 
	~<bôs/°dio.h
>

866 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


867 
	~<bôs/°dio2.h
>

869 #ifde‡
__LDBL_COMPAT


870 
	~<bôs/°dio-ldbl.h
>

873 
__END_DECLS


	@/usr/include/stdlib.h

22 #i‚def 
_STDLIB_H


24 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

25 
	~<bôs/libc-hódî-°¨t.h
>

28 
	#__√ed_size_t


	)

29 
	#__√ed_wch¨_t


	)

30 
	#__√ed_NULL


	)

31 
	~<°ddef.h
>

33 
	g__BEGIN_DECLS


35 
	#_STDLIB_H
 1

	)

37 #i‡(
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8
Ë&& !deföed 
_SYS_WAIT_H


39 
	~<bôs/waôÊags.h
>

40 
	~<bôs/waô°©us.h
>

43 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
 (°©us)

	)

44 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
 (°©us)

	)

45 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
 (°©us)

	)

46 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
 (°©us)

	)

47 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
 (°©us)

	)

48 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
 (°©us)

	)

49 #ifde‡
__WIFCONTINUED


50 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
 (°©us)

	)

55 
	~<bôs/Êﬂä.h
>

60 
	mquŸ
;

61 
	mªm
;

62 } 
	tdiv_t
;

65 #i‚de‡
__ldiv_t_deföed


68 
	mquŸ
;

69 
	mªm
;

70 } 
	tldiv_t
;

71 
	#__ldiv_t_deföed
 1

	)

74 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


76 
__exãnsi⁄__
 struct

78 
	mquŸ
;

79 
	mªm
;

80 } 
	tŒdiv_t
;

81 
	#__Œdiv_t_deföed
 1

	)

86 
	#RAND_MAX
 2147483647

	)

91 
	#EXIT_FAILURE
 1

	)

92 
	#EXIT_SUCCESS
 0

	)

96 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

97 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

101 
	$©of
 (c⁄° *
__≈å
)

102 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

104 
	$©oi
 (c⁄° *
__≈å
)

105 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

107 
	$©ﬁ
 (c⁄° *
__≈å
)

108 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

110 #ifde‡
__USE_ISOC99


112 
__exãnsi⁄__
 
	$©ﬁl
 (c⁄° *
__≈å
)

113 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

117 
	$°πod
 (c⁄° *
__ª°ri˘
 
__≈å
,

118 **
__ª°ri˘
 
__íd±r
)

119 
__THROW
 
	`__n⁄nuŒ
 ((1));

121 #ifdef 
__USE_ISOC99


123 
	$°πof
 (c⁄° *
__ª°ri˘
 
__≈å
,

124 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

126 
	$°πﬁd
 (c⁄° *
__ª°ri˘
 
__≈å
,

127 **
__ª°ri˘
 
__íd±r
)

128 
__THROW
 
	`__n⁄nuŒ
 ((1));

133 #i‡
__HAVE_FLOAT16
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

134 
_Flﬂt16
 
	$°πof16
 (c⁄° *
__ª°ri˘
 
__≈å
,

135 **
__ª°ri˘
 
__íd±r
)

136 
__THROW
 
	`__n⁄nuŒ
 ((1));

139 #i‡
__HAVE_FLOAT32
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

140 
_Flﬂt32
 
	$°πof32
 (c⁄° *
__ª°ri˘
 
__≈å
,

141 **
__ª°ri˘
 
__íd±r
)

142 
__THROW
 
	`__n⁄nuŒ
 ((1));

145 #i‡
__HAVE_FLOAT64
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

146 
_Flﬂt64
 
	$°πof64
 (c⁄° *
__ª°ri˘
 
__≈å
,

147 **
__ª°ri˘
 
__íd±r
)

148 
__THROW
 
	`__n⁄nuŒ
 ((1));

151 #i‡
__HAVE_FLOAT128
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

152 
_Flﬂt128
 
	$°πof128
 (c⁄° *
__ª°ri˘
 
__≈å
,

153 **
__ª°ri˘
 
__íd±r
)

154 
__THROW
 
	`__n⁄nuŒ
 ((1));

157 #i‡
__HAVE_FLOAT32X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

158 
_Flﬂt32x
 
	$°πof32x
 (c⁄° *
__ª°ri˘
 
__≈å
,

159 **
__ª°ri˘
 
__íd±r
)

160 
__THROW
 
	`__n⁄nuŒ
 ((1));

163 #i‡
__HAVE_FLOAT64X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

164 
_Flﬂt64x
 
	$°πof64x
 (c⁄° *
__ª°ri˘
 
__≈å
,

165 **
__ª°ri˘
 
__íd±r
)

166 
__THROW
 
	`__n⁄nuŒ
 ((1));

169 #i‡
__HAVE_FLOAT128X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

170 
_Flﬂt128x
 
	$°πof128x
 (c⁄° *
__ª°ri˘
 
__≈å
,

171 **
__ª°ri˘
 
__íd±r
)

172 
__THROW
 
	`__n⁄nuŒ
 ((1));

176 
	$°πﬁ
 (c⁄° *
__ª°ri˘
 
__≈å
,

177 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

178 
__THROW
 
	`__n⁄nuŒ
 ((1));

180 
	$°πoul
 (c⁄° *
__ª°ri˘
 
__≈å
,

181 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

182 
__THROW
 
	`__n⁄nuŒ
 ((1));

184 #ifde‡
__USE_MISC


186 
__exãnsi⁄__


187 
	$°πoq
 (c⁄° *
__ª°ri˘
 
__≈å
,

188 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

189 
__THROW
 
	`__n⁄nuŒ
 ((1));

191 
__exãnsi⁄__


192 
	$°πouq
 (c⁄° *
__ª°ri˘
 
__≈å
,

193 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

194 
__THROW
 
	`__n⁄nuŒ
 ((1));

197 #ifde‡
__USE_ISOC99


199 
__exãnsi⁄__


200 
	$°πﬁl
 (c⁄° *
__ª°ri˘
 
__≈å
,

201 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

202 
__THROW
 
	`__n⁄nuŒ
 ((1));

204 
__exãnsi⁄__


205 
	$°πouŒ
 (c⁄° *
__ª°ri˘
 
__≈å
,

206 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

207 
__THROW
 
	`__n⁄nuŒ
 ((1));

211 #i‡
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT_C2X
)

212 
	$°r‰omd
 (*
__de°
, 
size_t
 
__size
, c⁄° *
__f‹m©
,

213 
__f
)

214 
__THROW
 
	`__n⁄nuŒ
 ((3));

216 
	$°r‰omf
 (*
__de°
, 
size_t
 
__size
, c⁄° *
__f‹m©
,

217 
__f
)

218 
__THROW
 
	`__n⁄nuŒ
 ((3));

220 
	$°r‰oml
 (*
__de°
, 
size_t
 
__size
, c⁄° *
__f‹m©
,

221 
__f
)

222 
__THROW
 
	`__n⁄nuŒ
 ((3));

225 #i‡
__HAVE_FLOAT16
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

226 
	$°r‰omf16
 (*
__de°
, 
size_t
 
__size
, c⁄° * 
__f‹m©
,

227 
_Flﬂt16
 
__f
)

228 
__THROW
 
	`__n⁄nuŒ
 ((3));

231 #i‡
__HAVE_FLOAT32
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

232 
	$°r‰omf32
 (*
__de°
, 
size_t
 
__size
, c⁄° * 
__f‹m©
,

233 
_Flﬂt32
 
__f
)

234 
__THROW
 
	`__n⁄nuŒ
 ((3));

237 #i‡
__HAVE_FLOAT64
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

238 
	$°r‰omf64
 (*
__de°
, 
size_t
 
__size
, c⁄° * 
__f‹m©
,

239 
_Flﬂt64
 
__f
)

240 
__THROW
 
	`__n⁄nuŒ
 ((3));

243 #i‡
__HAVE_FLOAT128
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

244 
	$°r‰omf128
 (*
__de°
, 
size_t
 
__size
, c⁄° * 
__f‹m©
,

245 
_Flﬂt128
 
__f
)

246 
__THROW
 
	`__n⁄nuŒ
 ((3));

249 #i‡
__HAVE_FLOAT32X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

250 
	$°r‰omf32x
 (*
__de°
, 
size_t
 
__size
, c⁄° * 
__f‹m©
,

251 
_Flﬂt32x
 
__f
)

252 
__THROW
 
	`__n⁄nuŒ
 ((3));

255 #i‡
__HAVE_FLOAT64X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

256 
	$°r‰omf64x
 (*
__de°
, 
size_t
 
__size
, c⁄° * 
__f‹m©
,

257 
_Flﬂt64x
 
__f
)

258 
__THROW
 
	`__n⁄nuŒ
 ((3));

261 #i‡
__HAVE_FLOAT128X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

262 
	$°r‰omf128x
 (*
__de°
, 
size_t
 
__size
, c⁄° * 
__f‹m©
,

263 
_Flﬂt128x
 
__f
)

264 
__THROW
 
	`__n⁄nuŒ
 ((3));

268 #ifde‡
__USE_GNU


272 
	~<bôs/ty≥s/loˇÀ_t.h
>

274 
	$°πﬁ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

275 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

276 
loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

278 
	$°πoul_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

279 **
__ª°ri˘
 
__íd±r
,

280 
__ba£
, 
loˇÀ_t
 
__loc
)

281 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

283 
__exãnsi⁄__


284 
	$°πﬁl_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

285 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

286 
loˇÀ_t
 
__loc
)

287 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

289 
__exãnsi⁄__


290 
	$°πouŒ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

291 **
__ª°ri˘
 
__íd±r
,

292 
__ba£
, 
loˇÀ_t
 
__loc
)

293 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

295 
	$°πod_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

296 **
__ª°ri˘
 
__íd±r
, 
loˇÀ_t
 
__loc
)

297 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

299 
	$°πof_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

300 **
__ª°ri˘
 
__íd±r
, 
loˇÀ_t
 
__loc
)

301 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

303 
	$°πﬁd_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

304 **
__ª°ri˘
 
__íd±r
,

305 
loˇÀ_t
 
__loc
)

306 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

308 #i‡
__HAVE_FLOAT16


309 
_Flﬂt16
 
	$°πof16_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

310 **
__ª°ri˘
 
__íd±r
,

311 
loˇÀ_t
 
__loc
)

312 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

315 #i‡
__HAVE_FLOAT32


316 
_Flﬂt32
 
	$°πof32_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

317 **
__ª°ri˘
 
__íd±r
,

318 
loˇÀ_t
 
__loc
)

319 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

322 #i‡
__HAVE_FLOAT64


323 
_Flﬂt64
 
	$°πof64_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

324 **
__ª°ri˘
 
__íd±r
,

325 
loˇÀ_t
 
__loc
)

326 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

329 #i‡
__HAVE_FLOAT128


330 
_Flﬂt128
 
	$°πof128_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

331 **
__ª°ri˘
 
__íd±r
,

332 
loˇÀ_t
 
__loc
)

333 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

336 #i‡
__HAVE_FLOAT32X


337 
_Flﬂt32x
 
	$°πof32x_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

338 **
__ª°ri˘
 
__íd±r
,

339 
loˇÀ_t
 
__loc
)

340 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

343 #i‡
__HAVE_FLOAT64X


344 
_Flﬂt64x
 
	$°πof64x_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

345 **
__ª°ri˘
 
__íd±r
,

346 
loˇÀ_t
 
__loc
)

347 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

350 #i‡
__HAVE_FLOAT128X


351 
_Flﬂt128x
 
	$°πof128x_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

352 **
__ª°ri˘
 
__íd±r
,

353 
loˇÀ_t
 
__loc
)

354 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

359 #ifde‡
__USE_EXTERN_INLINES


360 
__exã∫_ölöe
 

361 
	`__NTH
 (
	$©oi
 (c⁄° *
__≈å
))

363  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

364 
	}
}

365 
__exã∫_ölöe
 

366 
__NTH
 (
	$©ﬁ
 (c⁄° *
__≈å
))

368  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

369 
	}
}

371 #ifde‡
__USE_ISOC99


372 
__exãnsi⁄__
 
__exã∫_ölöe
 

373 
__NTH
 (
	$©ﬁl
 (c⁄° *
__≈å
))

375  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

376 
	}
}

381 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


385 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

388 
	$a64l
 (c⁄° *
__s
)

389 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

393 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


394 
	~<sys/ty≥s.h
>

401 
	$øndom
 (Ë
__THROW
;

404 
	$§™dom
 (
__£ed
Ë
__THROW
;

410 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

411 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

415 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

418 #ifde‡
__USE_MISC


423 
	søndom_d©a


425 
öt32_t
 *
Âå
;

426 
öt32_t
 *
Ωå
;

427 
öt32_t
 *
°©e
;

428 
ønd_ty≥
;

429 
ønd_deg
;

430 
ønd_£p
;

431 
öt32_t
 *
íd_±r
;

434 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

435 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

437 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

438 
__THROW
 
	`__n⁄nuŒ
 ((2));

440 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

441 
size_t
 
__°©ñí
,

442 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

443 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

445 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

446 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

447 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

453 
	$ønd
 (Ë
__THROW
;

455 
	$§™d
 (
__£ed
Ë
__THROW
;

457 #ifde‡
__USE_POSIX199506


459 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

463 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


467 
	$dønd48
 (Ë
__THROW
;

468 
	$î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

471 
	$Ã™d48
 (Ë
__THROW
;

472 
	$ƒ™d48
 (
__xsubi
[3])

473 
__THROW
 
	`__n⁄nuŒ
 ((1));

476 
	$mønd48
 (Ë
__THROW
;

477 
	$jønd48
 (
__xsubi
[3])

478 
__THROW
 
	`__n⁄nuŒ
 ((1));

481 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

482 *
	$£ed48
 (
__£ed16v
[3])

483 
__THROW
 
	`__n⁄nuŒ
 ((1));

484 
	$lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

486 #ifde‡
__USE_MISC


490 
	sdønd48_d©a


492 
__x
[3];

493 
__ﬁd_x
[3];

494 
__c
;

495 
__öô
;

496 
__exãnsi⁄__
 
__a
;

501 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

502 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

503 
	$î™d48_r
 (
__xsubi
[3],

504 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

505 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

508 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

509 *
__ª°ri˘
 
__ªsu…
)

510 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

511 
	$ƒ™d48_r
 (
__xsubi
[3],

512 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

513 *
__ª°ri˘
 
__ªsu…
)

514 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

517 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

518 *
__ª°ri˘
 
__ªsu…
)

519 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

520 
	$jønd48_r
 (
__xsubi
[3],

521 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

522 *
__ª°ri˘
 
__ªsu…
)

523 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

526 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

527 
__THROW
 
	`__n⁄nuŒ
 ((2));

529 
	$£ed48_r
 (
__£ed16v
[3],

530 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

532 
	$lc⁄g48_r
 (
__∑øm
[7],

533 
dønd48_d©a
 *
__buf„r
)

534 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

539 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__


540 
	`__©åibuã_Æloc_size__
 ((1)Ë
__wur
;

542 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

543 
__THROW
 
__©åibuã_mÆloc__
 
	`__©åibuã_Æloc_size__
 ((1, 2)Ë
__wur
;

550 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

551 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
 
	`__©åibuã_Æloc_size__
 ((2));

553 #ifde‡
__USE_MISC


559 *
	$ªÆloˇºay
 (*
__±r
, 
size_t
 
__nmemb
, size_à
__size
)

560 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__


561 
	`__©åibuã_Æloc_size__
 ((2, 3));

565 
	$‰ì
 (*
__±r
Ë
__THROW
;

567 #ifde‡
__USE_MISC


568 
	~<Æloˇ.h
>

571 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

572 || 
deföed
 
__USE_MISC


574 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__


575 
	`__©åibuã_Æloc_size__
 ((1)Ë
__wur
;

578 #ifde‡
__USE_XOPEN2K


580 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

581 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

584 #ifde‡
__USE_ISOC11


586 *
	$Æig√d_Æloc
 (
size_t
 
__Æignmít
, size_à
__size
)

587 
__THROW
 
__©åibuã_mÆloc__
 
	`__©åibuã_Æloc_size__
 ((2)Ë
__wur
;

591 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

595 
	$©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

597 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


599 #ifde‡
__˝lu•lus


600 "C++" 
	$©_quick_exô
 ((*
__func
) ())

601 
__THROW
 
	`__asm
 ("©_quick_exô"Ë
	`__n⁄nuŒ
 ((1));

603 
	$©_quick_exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

607 #ifdef 
__USE_MISC


610 
	$⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

611 
__THROW
 
	`__n⁄nuŒ
 ((1));

617 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

619 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


623 
	$quick_exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

626 #ifde‡
__USE_ISOC99


629 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

634 *
	$gëív
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

636 #ifde‡
__USE_GNU


639 *
	$£cuª_gëív
 (c⁄° *
__«me
)

640 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

643 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


647 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

650 #ifde‡
__USE_XOPEN2K


653 
	$£ãnv
 (c⁄° *
__«me
, c⁄° *
__vÆue
, 
__ª∂a˚
)

654 
__THROW
 
	`__n⁄nuŒ
 ((2));

657 
	$un£ãnv
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

660 #ifdef 
__USE_MISC


664 
	$˛óªnv
 (Ë
__THROW
;

668 #i‡
deföed
 
__USE_MISC
 \

669 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
)

675 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

678 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


687 #i‚de‡
__USE_FILE_OFFSET64


688 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

690 #ifde‡
__REDIRECT


691 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

692 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

694 
	#mk°emp
 
mk°emp64


	)

697 #ifde‡
__USE_LARGEFILE64


698 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

702 #ifde‡
__USE_MISC


709 #i‚de‡
__USE_FILE_OFFSET64


710 
	$mk°emps
 (*
__ãm∂©e
, 
__suffixÀn
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

712 #ifde‡
__REDIRECT


713 
	`__REDIRECT
 (
mk°emps
, (*
__ãm∂©e
, 
__suffixÀn
),

714 
mk°emps64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

716 
	#mk°emps
 
mk°emps64


	)

719 #ifde‡
__USE_LARGEFILE64


720 
	$mk°emps64
 (*
__ãm∂©e
, 
__suffixÀn
)

721 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

725 #ifde‡
__USE_XOPEN2K8


731 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

734 #ifde‡
__USE_GNU


741 #i‚de‡
__USE_FILE_OFFSET64


742 
	$mko°emp
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

744 #ifde‡
__REDIRECT


745 
	`__REDIRECT
 (
mko°emp
, (*
__ãm∂©e
, 
__Êags
), 
mko°emp64
)

746 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

748 
	#mko°emp
 
mko°emp64


	)

751 #ifde‡
__USE_LARGEFILE64


752 
	$mko°emp64
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

761 #i‚de‡
__USE_FILE_OFFSET64


762 
	$mko°emps
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

763 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

765 #ifde‡
__REDIRECT


766 
	`__REDIRECT
 (
mko°emps
, (*
__ãm∂©e
, 
__suffixÀn
,

767 
__Êags
), 
mko°emps64
)

768 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

770 
	#mko°emps
 
mko°emps64


	)

773 #ifde‡
__USE_LARGEFILE64


774 
	$mko°emps64
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

775 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

784 
	$sy°em
 (c⁄° *
__comm™d
Ë
__wur
;

787 #ifdef 
__USE_GNU


790 *
	$ˇn⁄iˇlize_fûe_«me
 (c⁄° *
__«me
)

791 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

794 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


800 *
	$ªÆ∑th
 (c⁄° *
__ª°ri˘
 
__«me
,

801 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

806 #i‚de‡
__COMPAR_FN_T


807 
	#__COMPAR_FN_T


	)

808 (*
	t__com∑r_‚_t
) (const *, const *);

810 #ifdef 
__USE_GNU


811 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

814 #ifde‡
__USE_GNU


815 (*
	t__com∑r_d_‚_t
) (const *, const *, *);

820 *
	$b£¨ch
 (c⁄° *
__key
, c⁄° *
__ba£
,

821 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

822 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

824 #ifde‡
__USE_EXTERN_INLINES


825 
	~<bôs/°dlib-b£¨ch.h
>

830 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

831 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

832 #ifde‡
__USE_GNU


833 
	$qs‹t_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

834 
__com∑r_d_‚_t
 
__com∑r
, *
__¨g
)

835 
	`__n⁄nuŒ
 ((1, 4));

840 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

841 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

843 #ifde‡
__USE_ISOC99


844 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

845 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

852 
div_t
 
	$div
 (
__numî
, 
__díom
)

853 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

854 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

855 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

857 #ifde‡
__USE_ISOC99


858 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

859 
__díom
)

860 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

864 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

865 || 
deföed
 
__USE_MISC


872 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

873 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

878 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

879 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

884 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

885 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

888 #ifde‡
__USE_MISC


890 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

891 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

892 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

893 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

894 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

895 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

896 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

897 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

902 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

903 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

904 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

905 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

906 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

907 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

909 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

910 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

911 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

912 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

913 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

914 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

915 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

916 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

922 
	$mbÀn
 (c⁄° *
__s
, 
size_t
 
__n
Ë
__THROW
;

925 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

926 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

929 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
;

933 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

934 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

936 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

937 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

938 
__THROW
;

941 #ifde‡
__USE_MISC


946 
	$Ωm©ch
 (c⁄° *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

950 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


957 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

958 *c⁄° *
__ª°ri˘
 
__tokís
,

959 **
__ª°ri˘
 
__vÆuï
)

960 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

966 #ifde‡
__USE_XOPEN2KXSI


968 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

971 #ifde‡
__USE_XOPEN_EXTENDED


976 
	$gø¡±
 (
__fd
Ë
__THROW
;

980 
	$u∆ock±
 (
__fd
Ë
__THROW
;

985 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

988 #ifde‡
__USE_GNU


992 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

993 
__THROW
 
	`__n⁄nuŒ
 ((2));

996 
	`gë±
 ();

999 #ifde‡
__USE_MISC


1003 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

1004 
__THROW
 
	`__n⁄nuŒ
 ((1));

1007 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K


1010 
	$ây¶Ÿ
 (Ë
__THROW
;

1013 
	~<bôs/°dlib-Êﬂt.h
>

1016 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


1017 
	~<bôs/°dlib.h
>

1019 #ifde‡
__LDBL_COMPAT


1020 
	~<bôs/°dlib-ldbl.h
>

1023 
__END_DECLS


	@/usr/include/string.h

22 #i‚def 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<bôs/libc-hódî-°¨t.h
>

28 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

36 #i‡
deföed
 
__˝lu•lus
 && (
__GNUC_PREREQ
 (4, 4) \

37 || 
	$__glibc_˛™g_¥îeq
 (3, 5))

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

43 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

44 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

47 *
	$memmove
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

48 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

53 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN
 || 
	`__GLIBC_USE
 (
ISOC2X
)

54 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

61 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

64 
	$memcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

65 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

68 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


71 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

72 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

73 c⁄° *
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

74 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

76 #ifde‡
__OPTIMIZE__


77 
__exã∫_Æways_ölöe
 *

78 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


80  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

83 
__exã∫_Æways_ölöe
 const *

84 
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


86  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

89 
	}
}

91 *
	$memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

92 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

95 #ifde‡
__USE_GNU


98 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


99 "C++" *
	$øwmemchr
 (*
__s
, 
__c
)

100 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

101 "C++" c⁄° *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

104 *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

105 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

109 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


110 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

111 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

112 "C++" c⁄° *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

115 *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

122 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

123 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

125 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

126 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

127 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

130 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

131 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

133 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

134 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

137 
	$°rcmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

138 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

140 
	$°∫cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

141 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

144 
	$°rcﬁl
 (c⁄° *
__s1
, c⁄° *
__s2
)

145 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

147 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

148 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

149 
__THROW
 
	`__n⁄nuŒ
 ((2));

151 #ifde‡
__USE_XOPEN2K8


153 
	~<bôs/ty≥s/loˇÀ_t.h
>

156 
	$°rcﬁl_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
loˇÀ_t
 
__l
)

157 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

160 
size_t
 
	$°rx‰m_l
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
,

161 
loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

164 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8
 \

165 || 
	`__GLIBC_USE
 (
LIB_EXT2
Ë|| 
	$__GLIBC_USE
 (
ISOC2X
))

167 *
	$°rdup
 (c⁄° *
__s
)

168 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

174 #i‡
deföed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
Ë|| __GLIBC_USE (
ISOC2X
)

175 *
	$°∫dup
 (c⁄° *
__°rög
, 
size_t
 
__n
)

176 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

179 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


181 
	#°rdu∑
(
s
) \

182 (
__exãnsi⁄__
 \

184 c⁄° *
__ﬁd
 = (
s
); \

185 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

186 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

187 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

188 
	}
}))

	)

191 
	#°∫du∑
(
s
, 
n
) \

192 (
__exãnsi⁄__
 \

194 c⁄° *
__ﬁd
 = (
s
); \

195 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

196 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

197 
__√w
[
__Àn
] = '\0'; \

198 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

199 }))

	)

203 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


206 *
°rchr
 (*
__s
, 
__c
)

207 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

208 c⁄° *
°rchr
 (c⁄° *
__s
, 
__c
)

209 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

211 #ifde‡
__OPTIMIZE__


212 
__exã∫_Æways_ölöe
 *

213 
°rchr
 (*
__s
, 
__c
Ë
	g__THROW


215  
__buûtö_°rchr
 (
__s
, 
__c
);

218 
__exã∫_Æways_ölöe
 const *

219 
°rchr
 (c⁄° *
__s
, 
__c
Ë
	g__THROW


221  
__buûtö_°rchr
 (
__s
, 
__c
);

226 *
	$°rchr
 (c⁄° *
__s
, 
__c
)

227 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

230 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


233 *
	`°ºchr
 (*
__s
, 
__c
)

234 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

235 c⁄° *
	`°ºchr
 (c⁄° *
__s
, 
__c
)

236 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

238 #ifde‡
__OPTIMIZE__


239 
__exã∫_Æways_ölöe
 *

240 
	`°ºchr
 (*
__s
, 
__c
Ë
__THROW


242  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

245 
__exã∫_Æways_ölöe
 const *

246 
	`°ºchr
 (c⁄° *
__s
, 
__c
Ë
__THROW


248  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

251 
	}
}

253 *
	$°ºchr
 (c⁄° *
__s
, 
__c
)

254 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

257 #ifde‡
__USE_GNU


260 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


261 "C++" *
	$°rch∫ul
 (*
__s
, 
__c
)

262 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

263 "C++" c⁄° *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

264 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

266 *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

267 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

273 
size_t
 
	$°rc•n
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

274 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

277 
size_t
 
	$°r•n
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

278 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

280 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


283 *
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
)

284 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

285 c⁄° *
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

286 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

288 #ifde‡
__OPTIMIZE__


289 
__exã∫_Æways_ölöe
 *

290 
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
Ë
__THROW


292  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

295 
__exã∫_Æways_ölöe
 const *

296 
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
Ë
__THROW


298  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

301 
	}
}

303 *
	$°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

304 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

307 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


310 *
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

311 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

312 c⁄° *
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

313 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

315 #ifde‡
__OPTIMIZE__


316 
__exã∫_Æways_ölöe
 *

317 
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


319  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

322 
__exã∫_Æways_ölöe
 const *

323 
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


325  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

328 
	}
}

330 *
	$°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

331 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

336 *
	$°πok
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
)

337 
__THROW
 
	`__n⁄nuŒ
 ((2));

341 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

342 c⁄° *
__ª°ri˘
 
__dñim
,

343 **
__ª°ri˘
 
__ßve_±r
)

344 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

345 #ifde‡
__USE_POSIX


346 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
,

347 **
__ª°ri˘
 
__ßve_±r
)

348 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

351 #ifde‡
__USE_GNU


353 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


354 "C++" *
	$°rˇ£°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

355 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

356 "C++" c⁄° *
	$°rˇ£°r
 (c⁄° *
__hay°ack
,

357 c⁄° *
__√edÀ
)

358 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

360 *
	$°rˇ£°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

361 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

365 #ifde‡
__USE_GNU


369 *
	$memmem
 (c⁄° *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

370 c⁄° *
__√edÀ
, 
size_t
 
__√edÀÀn
)

371 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3));

375 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

376 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

377 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

378 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

379 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

380 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

385 
size_t
 
	$°æí
 (c⁄° *
__s
)

386 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

388 #ifdef 
__USE_XOPEN2K8


391 
size_t
 
	$°∫Àn
 (c⁄° *
__°rög
, 
size_t
 
__maxÀn
)

392 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

397 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

398 #ifde‡
__USE_XOPEN2K


406 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


409 #ifde‡
__REDIRECT_NTH


410 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

411 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

412 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2));

414 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

415 
__THROW
 
	`__n⁄nuŒ
 ((2));

416 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

421 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

422 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

426 #ifde‡
__USE_XOPEN2K8


428 *
	$°ªº‹_l
 (
__î∫um
, 
loˇÀ_t
 
__l
Ë
__THROW
;

431 #ifde‡
__USE_MISC


432 
	~<°rögs.h
>

436 
	$ex∂icô_bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

440 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

441 c⁄° *
__ª°ri˘
 
__dñim
)

442 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

445 #ifdef 
__USE_XOPEN2K8


447 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

450 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

451 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

452 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

453 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

457 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

458 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

459 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

460 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

461 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

462 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

465 #ifdef 
__USE_GNU


467 
	$°rvîscmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

468 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

471 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

474 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

476 #i‚de‡
ba£«me


481 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


482 "C++" *
	$ba£«me
 (*
__fûíame
)

483 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

484 "C++" c⁄° *
	$ba£«me
 (c⁄° *
__fûíame
)

485 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

487 *
	$ba£«me
 (c⁄° *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

492 #i‡
	`__GNUC_PREREQ
 (3,4)

493 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


495 
	~<bôs/°rög_f‹tifõd.h
>

499 
__END_DECLS


	@/usr/include/strings.h

18 #i‚def 
_STRINGS_H


19 
	#_STRINGS_H
 1

	)

21 
	~<„©uªs.h
>

22 
	#__√ed_size_t


	)

23 
	~<°ddef.h
>

26 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

27 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

30 
	g__BEGIN_DECLS


32 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


34 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

35 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

38 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
)

39 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

42 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

45 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


48 *
	`ödex
 (*
__s
, 
__c
)

49 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

50 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

51 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

53 #i‡
deföed
 
__OPTIMIZE__


54 
__exã∫_Æways_ölöe
 *

55 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


57  
	`__buûtö_ödex
 (
__s
, 
__c
);

60 
__exã∫_Æways_ölöe
 const *

61 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


63  
	`__buûtö_ödex
 (
__s
, 
__c
);

66 
	}
}

68 *
	$ödex
 (c⁄° *
__s
, 
__c
)

69 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

73 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


76 *
	`rödex
 (*
__s
, 
__c
)

77 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

78 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

79 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

81 #i‡
deföed
 
__OPTIMIZE__


82 
__exã∫_Æways_ölöe
 *

83 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


85  
	`__buûtö_rödex
 (
__s
, 
__c
);

88 
__exã∫_Æways_ölöe
 const *

89 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


91  
	`__buûtö_rödex
 (
__s
, 
__c
);

94 
	}
}

96 *
	$rödex
 (c⁄° *
__s
, 
__c
)

97 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

101 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8
 || deföed 
__USE_XOPEN2K8XSI


104 
	$ffs
 (
__i
Ë
__THROW
 
__©åibuã_c⁄°__
;

109 #ifdef 
__USE_MISC


110 
	$ff¶
 (
__l
Ë
__THROW
 
__©åibuã_c⁄°__
;

111 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

112 
__THROW
 
__©åibuã_c⁄°__
;

116 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

117 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

120 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

121 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

123 #ifdef 
__USE_XOPEN2K8


125 
	~<bôs/ty≥s/loˇÀ_t.h
>

128 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
loˇÀ_t
 
__loc
)

129 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

133 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

134 
size_t
 
__n
, 
loˇÀ_t
 
__loc
)

135 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

138 
__END_DECLS


140 #i‡
	`__GNUC_PREREQ
 (3,4Ë&& 
__USE_FORTIFY_LEVEL
 > 0 \

141 && 
deföed
 
__f‹tify_fun˘i⁄


143 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


144 
	~<bôs/°rögs_f‹tifõd.h
>

	@/usr/include/time.h

22 #i‚def 
_TIME_H


23 
	#_TIME_H
 1

	)

25 
	~<„©uªs.h
>

27 
	#__√ed_size_t


	)

28 
	#__√ed_NULL


	)

29 
	~<°ddef.h
>

33 
	~<bôs/time.h
>

37 
	~<bôs/ty≥s/˛ock_t.h
>

38 
	~<bôs/ty≥s/time_t.h
>

39 
	~<bôs/ty≥s/°ru˘_tm.h
>

41 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_ISOC11


42 
	~<bôs/ty≥s/°ru˘_time•ec.h
>

45 #ifde‡
__USE_POSIX199309


46 
	~<bôs/ty≥s/˛ockid_t.h
>

47 
	~<bôs/ty≥s/timî_t.h
>

48 
	~<bôs/ty≥s/°ru˘_ôimî•ec.h
>

49 
	gsigevít
;

52 #ifde‡
__USE_XOPEN2K


53 #i‚de‡
__pid_t_deföed


54 
__pid_t
 
	tpid_t
;

55 
	#__pid_t_deföed


	)

59 #ifde‡
__USE_XOPEN2K8


60 
	~<bôs/ty≥s/loˇÀ_t.h
>

63 #ifde‡
__USE_ISOC11


65 
	#TIME_UTC
 1

	)

68 
__BEGIN_DECLS


72 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

75 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

78 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

79 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

82 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

88 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

89 c⁄° *
__ª°ri˘
 
__f‹m©
,

90 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

92 #ifde‡
__USE_XOPEN


95 *
	$°Ωtime
 (c⁄° *
__ª°ri˘
 
__s
,

96 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

97 
__THROW
;

100 #ifde‡
__USE_XOPEN2K8


104 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

105 c⁄° *
__ª°ri˘
 
__f‹m©
,

106 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

107 
loˇÀ_t
 
__loc
Ë
__THROW
;

110 #ifde‡
__USE_GNU


111 *
	$°Ωtime_l
 (c⁄° *
__ª°ri˘
 
__s
,

112 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

113 
loˇÀ_t
 
__loc
Ë
__THROW
;

119 
tm
 *
	$gmtime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

123 
tm
 *
	$loˇ…ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

125 #i‡
deföed
 
__USE_POSIX
 || 
	`__GLIBC_USE
 (
ISOC2X
)

128 
tm
 *
	$gmtime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

129 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

133 
tm
 *
	$loˇ…ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

134 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

139 *
	$as˘ime
 (c⁄° 
tm
 *
__ç
Ë
__THROW
;

142 *
	$˘ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

144 #i‡
deföed
 
__USE_POSIX
 || 
	`__GLIBC_USE
 (
ISOC2X
)

149 *
	$as˘ime_r
 (c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

150 *
__ª°ri˘
 
__buf
Ë
__THROW
;

153 *
	$˘ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

154 *
__ª°ri˘
 
__buf
Ë
__THROW
;

159 *
__tz«me
[2];

160 
__daylight
;

161 
__timez⁄e
;

164 #ifdef 
__USE_POSIX


166 *
tz«me
[2];

170 
	$tz£t
 (Ë
__THROW
;

173 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


174 
daylight
;

175 
timez⁄e
;

181 
	#__i¶óp
(
yór
) \

182 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

185 #ifde‡
__USE_MISC


190 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

193 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

196 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

200 #ifde‡
__USE_POSIX199309


205 
	`«no¶ìp
 (c⁄° 
time•ec
 *
__ªque°ed_time
,

206 
time•ec
 *
__ªmaöög
);

210 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

213 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

216 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, c⁄° 
time•ec
 *
__ç
)

217 
__THROW
;

219 #ifde‡
__USE_XOPEN2K


224 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

225 c⁄° 
time•ec
 *
__ªq
,

226 
time•ec
 *
__ªm
);

229 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

234 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

235 
sigevít
 *
__ª°ri˘
 
__evp
,

236 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

239 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

242 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

243 c⁄° 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

244 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

247 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

248 
__THROW
;

251 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

255 #ifde‡
__USE_ISOC11


257 
	$time•ec_gë
 (
time•ec
 *
__ts
, 
__ba£
)

258 
__THROW
 
	`__n⁄nuŒ
 ((1));

262 #ifde‡
__USE_XOPEN_EXTENDED


274 
gëd©e_îr
;

283 
tm
 *
	`gëd©e
 (c⁄° *
__°rög
);

286 #ifde‡
__USE_GNU


297 
	`gëd©e_r
 (c⁄° *
__ª°ri˘
 
__°rög
,

298 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

301 
__END_DECLS


	@/usr/include/ucontext.h

20 #i‚de‡
_UCONTEXT_H


21 
	#_UCONTEXT_H
 1

	)

23 
	~<„©uªs.h
>

26 
	~<bôs/ödúe˘-ªtu∫.h
>

29 
	~<sys/uc⁄ãxt.h
>

31 
__BEGIN_DECLS


34 
	$gëc⁄ãxt
 (
uc⁄ãxt_t
 *
__u˝
Ë
__THROWNL
;

37 
	$£tc⁄ãxt
 (c⁄° 
uc⁄ãxt_t
 *
__u˝
Ë
__THROWNL
;

41 
	$sw≠c⁄ãxt
 (
uc⁄ãxt_t
 *
__ª°ri˘
 
__ou˝
,

42 c⁄° 
uc⁄ãxt_t
 *
__ª°ri˘
 
__u˝
)

43 
__THROWNL
 
__INDIRECT_RETURN
;

51 
	$makec⁄ãxt
 (
uc⁄ãxt_t
 *
__u˝
, (*
__func
) (),

52 
__¨gc
, ...Ë
__THROW
;

54 
__END_DECLS


	@/usr/include/unistd.h

22 #i‚def 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


32 #ifde‡
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #ñi‡
deföed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #ñi‡
deföed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #ñi‡
deföed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifde‡
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #ñi‡
deföed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #ñi‡
deföed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifde‡
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #ñi‡
deföed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #ñi‡
deföed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

112 
	#_XOPEN_ENH_I18N
 1

	)

115 
	#_XOPEN_LEGACY
 1

	)

202 
	~<bôs/posix_›t.h
>

205 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


206 
	~<bôs/ívú⁄míts.h
>

210 
	#STDIN_FILENO
 0

	)

211 
	#STDOUT_FILENO
 1

	)

212 
	#STDERR_FILENO
 2

	)

217 
	~<bôs/ty≥s.h
>

219 #i‚def 
__ssize_t_deföed


220 
__ssize_t
 
	tssize_t
;

221 
	#__ssize_t_deföed


	)

224 
	#__√ed_size_t


	)

225 
	#__√ed_NULL


	)

226 
	~<°ddef.h
>

228 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


231 #i‚de‡
__gid_t_deföed


232 
__gid_t
 
	tgid_t
;

233 
	#__gid_t_deföed


	)

236 #i‚de‡
__uid_t_deföed


237 
__uid_t
 
	tuid_t
;

238 
	#__uid_t_deföed


	)

241 #i‚de‡
__off_t_deföed


242 #i‚de‡
__USE_FILE_OFFSET64


243 
__off_t
 
	toff_t
;

245 
__off64_t
 
	toff_t
;

247 
	#__off_t_deföed


	)

249 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


250 
__off64_t
 
	toff64_t
;

251 
	#__off64_t_deföed


	)

254 #i‚de‡
__u£c⁄ds_t_deföed


255 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

256 
	#__u£c⁄ds_t_deföed


	)

259 #i‚de‡
__pid_t_deföed


260 
__pid_t
 
	tpid_t
;

261 
	#__pid_t_deföed


	)

265 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


266 #i‚de‡
__öçå_t_deföed


267 
__öçå_t
 
	töçå_t
;

268 
	#__öçå_t_deföed


	)

272 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


273 #i‚de‡
__sockÀn_t_deföed


274 
__sockÀn_t
 
	tsockÀn_t
;

275 
	#__sockÀn_t_deföed


	)

281 
	#R_OK
 4

	)

282 
	#W_OK
 2

	)

283 
	#X_OK
 1

	)

284 
	#F_OK
 0

	)

287 
	$ac˚ss
 (c⁄° *
__«me
, 
__ty≥
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

289 #ifde‡
__USE_GNU


292 
	$euidac˚ss
 (c⁄° *
__«me
, 
__ty≥
)

293 
__THROW
 
	`__n⁄nuŒ
 ((1));

296 
	$óc˚ss
 (c⁄° *
__«me
, 
__ty≥
)

297 
__THROW
 
	`__n⁄nuŒ
 ((1));

300 #ifde‡
__USE_ATFILE


304 
	$Ác˚sßt
 (
__fd
, c⁄° *
__fûe
, 
__ty≥
, 
__Êag
)

305 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

310 #i‚def 
_STDIO_H


311 
	#SEEK_SET
 0

	)

312 
	#SEEK_CUR
 1

	)

313 
	#SEEK_END
 2

	)

314 #ifde‡
__USE_GNU


315 
	#SEEK_DATA
 3

	)

316 
	#SEEK_HOLE
 4

	)

320 #i‡
deföed
 
__USE_MISC
 && !deföed 
L_SET


322 
	#L_SET
 
SEEK_SET


	)

323 
	#L_INCR
 
SEEK_CUR


	)

324 
	#L_XTND
 
SEEK_END


	)

333 #i‚de‡
__USE_FILE_OFFSET64


334 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__whí˚
Ë
__THROW
;

336 #ifde‡
__REDIRECT_NTH


337 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

338 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
),

339 
l£ek64
);

341 
	#l£ek
 
l£ek64


	)

344 #ifde‡
__USE_LARGEFILE64


345 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
)

346 
__THROW
;

353 
	`˛o£
 (
__fd
);

360 
ssize_t
 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
Ë
__wur
;

366 
ssize_t
 
	$wrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
Ë
__wur
;

368 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


369 #i‚de‡
__USE_FILE_OFFSET64


376 
ssize_t
 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

377 
__off_t
 
__off£t
Ë
__wur
;

384 
ssize_t
 
	$pwrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

385 
__off_t
 
__off£t
Ë
__wur
;

387 #ifde‡
__REDIRECT


388 
ssize_t
 
	`__REDIRECT
 (
¥ód
, (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

389 
__off64_t
 
__off£t
),

390 
¥ód64
Ë
__wur
;

391 
ssize_t
 
	`__REDIRECT
 (
pwrôe
, (
__fd
, c⁄° *
__buf
,

392 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
),

393 
pwrôe64
Ë
__wur
;

395 
	#¥ód
 
¥ód64


	)

396 
	#pwrôe
 
pwrôe64


	)

400 #ifde‡
__USE_LARGEFILE64


404 
ssize_t
 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

405 
__off64_t
 
__off£t
Ë
__wur
;

408 
ssize_t
 
	$pwrôe64
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

409 
__off64_t
 
__off£t
Ë
__wur
;

417 
	$pùe
 (
__pùedes
[2]Ë
__THROW
 
__wur
;

419 #ifde‡
__USE_GNU


422 
	$pùe2
 (
__pùedes
[2], 
__Êags
Ë
__THROW
 
__wur
;

432 
	$Æ¨m
 (
__£c⁄ds
Ë
__THROW
;

444 
	`¶ìp
 (
__£c⁄ds
);

446 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

447 || 
deföed
 
__USE_MISC


452 
__u£c⁄ds_t
 
	$uÆ¨m
 (
__u£c⁄ds_t
 
__vÆue
, __u£c⁄ds_à
__öãrvÆ
)

453 
__THROW
;

460 
	`u¶ìp
 (
__u£c⁄ds_t
 
__u£c⁄ds
);

469 
	`∑u£
 ();

473 
	$chown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

474 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

476 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


478 
	$fchown
 (
__fd
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
Ë
__THROW
 
__wur
;

483 
	$lchown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

484 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

488 #ifde‡
__USE_ATFILE


491 
	$fchow«t
 (
__fd
, c⁄° *
__fûe
, 
__uid_t
 
__ow√r
,

492 
__gid_t
 
__group
, 
__Êag
)

493 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

497 
	$chdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

499 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


501 
	$fchdú
 (
__fd
Ë
__THROW
 
__wur
;

511 *
	$gëcwd
 (*
__buf
, 
size_t
 
__size
Ë
__THROW
 
__wur
;

513 #ifdef 
__USE_GNU


517 *
	$gë_cuºít_dú_«me
 (Ë
__THROW
;

520 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

521 || 
deföed
 
__USE_MISC


525 *
	$gëwd
 (*
__buf
)

526 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
;

531 
	$dup
 (
__fd
Ë
__THROW
 
__wur
;

534 
	$dup2
 (
__fd
, 
__fd2
Ë
__THROW
;

536 #ifde‡
__USE_GNU


539 
	$dup3
 (
__fd
, 
__fd2
, 
__Êags
Ë
__THROW
;

543 **
__ívú⁄
;

544 #ifde‡
__USE_GNU


545 **
ívú⁄
;

551 
	$execve
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[],

552 *c⁄° 
__ívp
[]Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

554 #ifde‡
__USE_XOPEN2K8


557 
	$„xecve
 (
__fd
, *c⁄° 
__¨gv
[], *c⁄° 
__ívp
[])

558 
__THROW
 
	`__n⁄nuŒ
 ((2));

563 
	$execv
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[])

564 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

568 
	$exe˛e
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

569 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

573 
	$exe˛
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

574 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

578 
	$execvp
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[])

579 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

584 
	$exe˛p
 (c⁄° *
__fûe
, c⁄° *
__¨g
, ...)

585 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

587 #ifde‡
__USE_GNU


590 
	$execv≥
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[],

591 *c⁄° 
__ívp
[])

592 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

596 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


598 
	$ni˚
 (
__öc
Ë
__THROW
 
__wur
;

603 
	$_exô
 (
__°©us
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

609 
	~<bôs/c⁄‚ame.h
>

612 
	$∑thc⁄f
 (c⁄° *
__∑th
, 
__«me
)

613 
__THROW
 
	`__n⁄nuŒ
 ((1));

616 
	$Â©hc⁄f
 (
__fd
, 
__«me
Ë
__THROW
;

619 
	$sysc⁄f
 (
__«me
Ë
__THROW
;

621 #ifdef 
__USE_POSIX2


623 
size_t
 
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

628 
__pid_t
 
	$gëpid
 (Ë
__THROW
;

631 
__pid_t
 
	$gëµid
 (Ë
__THROW
;

634 
__pid_t
 
	$gëpgΩ
 (Ë
__THROW
;

637 
__pid_t
 
	$__gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

638 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


639 
__pid_t
 
	$gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

646 
	$£çgid
 (
__pid_t
 
__pid
, __pid_à
__pgid
Ë
__THROW
;

648 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


660 
	$£çgΩ
 (Ë
__THROW
;

667 
__pid_t
 
	$£tsid
 (Ë
__THROW
;

669 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


671 
__pid_t
 
	$gësid
 (
__pid_t
 
__pid
Ë
__THROW
;

675 
__uid_t
 
	$gëuid
 (Ë
__THROW
;

678 
__uid_t
 
	$gëeuid
 (Ë
__THROW
;

681 
__gid_t
 
	$gëgid
 (Ë
__THROW
;

684 
__gid_t
 
	$gëegid
 (Ë
__THROW
;

689 
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]Ë
__THROW
 
__wur
;

691 #ifdef 
__USE_GNU


693 
	$group_membî
 (
__gid_t
 
__gid
Ë
__THROW
;

700 
	$£tuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

702 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


705 
	$£åeuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
Ë
__THROW
 
__wur
;

708 #ifde‡
__USE_XOPEN2K


710 
	$£ãuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

717 
	$£tgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

719 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


722 
	$£åegid
 (
__gid_t
 
__rgid
, __gid_à
__egid
Ë
__THROW
 
__wur
;

725 #ifde‡
__USE_XOPEN2K


727 
	$£ãgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

730 #ifde‡
__USE_GNU


733 
	$gëªsuid
 (
__uid_t
 *
__ruid
, __uid_à*
__euid
, __uid_à*
__suid
)

734 
__THROW
;

738 
	$gëªsgid
 (
__gid_t
 *
__rgid
, __gid_à*
__egid
, __gid_à*
__sgid
)

739 
__THROW
;

743 
	$£åesuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
, __uid_à
__suid
)

744 
__THROW
 
__wur
;

748 
	$£åesgid
 (
__gid_t
 
__rgid
, __gid_à
__egid
, __gid_à
__sgid
)

749 
__THROW
 
__wur
;

756 
__pid_t
 
	$f‹k
 (Ë
__THROWNL
;

758 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

759 || 
deföed
 
__USE_MISC


764 
__pid_t
 
	$vf‹k
 (Ë
__THROW
;

770 *
	$ây«me
 (
__fd
Ë
__THROW
;

774 
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

775 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

779 
	$ißây
 (
__fd
Ë
__THROW
;

781 #ifde‡
__USE_MISC


784 
	$ây¶Ÿ
 (Ë
__THROW
;

789 
	$lök
 (c⁄° *
__‰om
, c⁄° *
__to
)

790 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

792 #ifde‡
__USE_ATFILE


795 
	$lök©
 (
__‰omfd
, c⁄° *
__‰om
, 
__tofd
,

796 c⁄° *
__to
, 
__Êags
)

797 
__THROW
 
	`__n⁄nuŒ
 ((2, 4)Ë
__wur
;

800 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


802 
	$symlök
 (c⁄° *
__‰om
, c⁄° *
__to
)

803 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

808 
ssize_t
 
	$ªadlök
 (c⁄° *
__ª°ri˘
 
__∑th
,

809 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

810 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

813 #ifde‡
__USE_ATFILE


815 
	$symlök©
 (c⁄° *
__‰om
, 
__tofd
,

816 c⁄° *
__to
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

819 
ssize_t
 
	$ªadlök©
 (
__fd
, c⁄° *
__ª°ri˘
 
__∑th
,

820 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

821 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

825 
	$u∆ök
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

827 #ifde‡
__USE_ATFILE


829 
	$u∆ök©
 (
__fd
, c⁄° *
__«me
, 
__Êag
)

830 
__THROW
 
	`__n⁄nuŒ
 ((2));

834 
	$rmdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

838 
__pid_t
 
	$tcgëpgΩ
 (
__fd
Ë
__THROW
;

841 
	$tc£çgΩ
 (
__fd
, 
__pid_t
 
__pgΩ_id
Ë
__THROW
;

848 *
	`gëlogö
 ();

849 #ifde‡
__USE_POSIX199506


856 
	$gëlogö_r
 (*
__«me
, 
size_t
 
__«me_Àn
Ë
	`__n⁄nuŒ
 ((1));

859 #ifdef 
__USE_MISC


861 
	$£éogö
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

865 #ifdef 
__USE_POSIX2


869 
	~<bôs/gë›t_posix.h
>

873 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


877 
	$gëho°«me
 (*
__«me
, 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

881 #i‡
deföed
 
__USE_MISC


884 
	$£tho°«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

885 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

889 
	$£tho°id
 (
__id
Ë
__THROW
 
__wur
;

895 
	$gëdomaö«me
 (*
__«me
, 
size_t
 
__Àn
)

896 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

897 
	$£tdomaö«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

898 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

904 
	$vh™gup
 (Ë
__THROW
;

907 
	$ªvoke
 (c⁄° *
__fûe
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

915 
	$¥ofû
 (*
__ßm∂e_buf„r
, 
size_t
 
__size
,

916 
size_t
 
__off£t
, 
__sˇÀ
)

917 
__THROW
 
	`__n⁄nuŒ
 ((1));

923 
	$ac˘
 (c⁄° *
__«me
Ë
__THROW
;

927 *
	$gëu£rshñl
 (Ë
__THROW
;

928 
	$ídu£rshñl
 (Ë
__THROW
;

929 
	$£tu£rshñl
 (Ë
__THROW
;

935 
	$d´m⁄
 (
__nochdú
, 
__no˛o£
Ë
__THROW
 
__wur
;

939 #i‡
deföed
 
__USE_MISC
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

942 
	$chroŸ
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

946 *
	$gë∑ss
 (c⁄° *
__¥om±
Ë
	`__n⁄nuŒ
 ((1));

954 
	`fsync
 (
__fd
);

957 #ifde‡
__USE_GNU


960 
	$syncfs
 (
__fd
Ë
__THROW
;

964 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


967 
	`gëho°id
 ();

970 
	$sync
 (Ë
__THROW
;

973 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K


976 
	$gë∑gesize
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

981 
	$gëdèbÀsize
 (Ë
__THROW
;

987 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


990 #i‚de‡
__USE_FILE_OFFSET64


991 
	$åunˇã
 (c⁄° *
__fûe
, 
__off_t
 
__Àngth
)

992 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

994 #ifde‡
__REDIRECT_NTH


995 
	`__REDIRECT_NTH
 (
åunˇã
,

996 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
),

997 
åunˇã64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

999 
	#åunˇã
 
åunˇã64


	)

1002 #ifde‡
__USE_LARGEFILE64


1003 
	$åunˇã64
 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
)

1004 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1009 #i‡
deföed
 
__USE_POSIX199309
 \

1010 || 
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


1013 #i‚de‡
__USE_FILE_OFFSET64


1014 
	$·runˇã
 (
__fd
, 
__off_t
 
__Àngth
Ë
__THROW
 
__wur
;

1016 #ifde‡
__REDIRECT_NTH


1017 
	`__REDIRECT_NTH
 (
·runˇã
, (
__fd
, 
__off64_t
 
__Àngth
),

1018 
·runˇã64
Ë
__wur
;

1020 
	#·runˇã
 
·runˇã64


	)

1023 #ifde‡
__USE_LARGEFILE64


1024 
	$·runˇã64
 (
__fd
, 
__off64_t
 
__Àngth
Ë
__THROW
 
__wur
;

1030 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

1031 || 
deföed
 
__USE_MISC


1035 
	$brk
 (*
__addr
Ë
__THROW
 
__wur
;

1041 *
	$sbrk
 (
öçå_t
 
__dñè
Ë
__THROW
;

1045 #ifde‡
__USE_MISC


1056 
	$sysˇŒ
 (
__sy¢o
, ...Ë
__THROW
;

1061 #i‡(
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
Ë&& !deföed 
F_LOCK


1073 
	#F_ULOCK
 0

	)

1074 
	#F_LOCK
 1

	)

1075 
	#F_TLOCK
 2

	)

1076 
	#F_TEST
 3

	)

1078 #i‚de‡
__USE_FILE_OFFSET64


1079 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
Ë
__wur
;

1081 #ifde‡
__REDIRECT


1082 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
),

1083 
lockf64
Ë
__wur
;

1085 
	#lockf
 
lockf64


	)

1088 #ifde‡
__USE_LARGEFILE64


1089 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
Ë
__wur
;

1094 #ifde‡
__USE_GNU


1099 
	#TEMP_FAILURE_RETRY
(
ex¥essi⁄
) \

1100 (
__exãnsi⁄__
 \

1101 ({ 
__ªsu…
; \

1102 dÿ
__ªsu…
 = (Ë(
ex¥essi⁄
); \

1103 
__ªsu…
 =-1L && 
î∫o
 =
EINTR
); \

1104 
__ªsu…
; 
	}
}))

	)

1107 
ssize_t
 
c›y_fûe_ønge
 (
__öfd
, 
__off64_t
 *
__pöoff
,

1108 
__outfd
, 
__off64_t
 *
__poutoff
,

1109 
size_t
 
__Àngth
, 
__Êags
);

1112 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


1115 
fd©async
 (
__fûdes
);

1118 #ifde‡
__USE_MISC


1124 *
	$¸y±
 (c⁄° *
__key
, c⁄° *
__ß…
)

1125 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1128 #ifdef 
__USE_XOPEN


1133 
	$swab
 (c⁄° *
__ª°ri˘
 
__‰om
, *__ª°ri˘ 
__to
,

1134 
ssize_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1141 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K


1143 *
	$˘îmid
 (*
__s
Ë
__THROW
;

1146 *
	`cu£rid
 (*
__s
);

1152 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__USE_XOPEN2K


1153 
	$±hªad_©f‹k
 ((*
__¥ï¨e
) (),

1154 (*
__∑ª¡
) (),

1155 (*
__chûd
Ë()Ë
__THROW
;

1158 #ifde‡
__USE_MISC


1161 
	$gëíå›y
 (*
__buf„r
, 
size_t
 
__Àngth
Ë
__wur
;

1165 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


1166 
	~<bôs/uni°d.h
>

1170 
	~<bôs/uni°d_ext.h
>

1172 
__END_DECLS


	@/usr/include/endian.h

18 #i‚def 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<„©uªs.h
>

24 
	~<bôs/ídün.h
>

26 #ifde‡
__USE_MISC


27 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

28 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

29 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

30 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

33 #i‡
deföed
 
__USE_MISC
 && !deföed 
__ASSEMBLER__


35 
	~<bôs/byãsw≠.h
>

36 
	~<bôs/uöä-idítôy.h
>

38 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


39 
	#htobe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

40 
	#htﬁe16
(
x
Ë
	`__uöt16_idítôy
 (x)

	)

41 
	#be16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

42 
	#À16toh
(
x
Ë
	`__uöt16_idítôy
 (x)

	)

44 
	#htobe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

45 
	#htﬁe32
(
x
Ë
	`__uöt32_idítôy
 (x)

	)

46 
	#be32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

47 
	#À32toh
(
x
Ë
	`__uöt32_idítôy
 (x)

	)

49 
	#htobe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

50 
	#htﬁe64
(
x
Ë
	`__uöt64_idítôy
 (x)

	)

51 
	#be64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

52 
	#À64toh
(
x
Ë
	`__uöt64_idítôy
 (x)

	)

55 
	#htobe16
(
x
Ë
	`__uöt16_idítôy
 (x)

	)

56 
	#htﬁe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

57 
	#be16toh
(
x
Ë
	`__uöt16_idítôy
 (x)

	)

58 
	#À16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

60 
	#htobe32
(
x
Ë
	`__uöt32_idítôy
 (x)

	)

61 
	#htﬁe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

62 
	#be32toh
(
x
Ë
	`__uöt32_idítôy
 (x)

	)

63 
	#À32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

65 
	#htobe64
(
x
Ë
	`__uöt64_idítôy
 (x)

	)

66 
	#htﬁe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

67 
	#be64toh
(
x
Ë
	`__uöt64_idítôy
 (x)

	)

68 
	#À64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

120 #unde‡
__USE_ISOC11


121 #unde‡
__USE_ISOC99


122 #unde‡
__USE_ISOC95


123 #unde‡
__USE_ISOCXX11


124 #unde‡
__USE_POSIX


125 #unde‡
__USE_POSIX2


126 #unde‡
__USE_POSIX199309


127 #unde‡
__USE_POSIX199506


128 #unde‡
__USE_XOPEN


129 #unde‡
__USE_XOPEN_EXTENDED


130 #unde‡
__USE_UNIX98


131 #unde‡
__USE_XOPEN2K


132 #unde‡
__USE_XOPEN2KXSI


133 #unde‡
__USE_XOPEN2K8


134 #unde‡
__USE_XOPEN2K8XSI


135 #unde‡
__USE_LARGEFILE


136 #unde‡
__USE_LARGEFILE64


137 #unde‡
__USE_FILE_OFFSET64


138 #unde‡
__USE_MISC


139 #unde‡
__USE_ATFILE


140 #unde‡
__USE_GNU


141 #unde‡
__USE_FORTIFY_LEVEL


142 #unde‡
__KERNEL_STRICT_NAMES


143 #unde‡
__GLIBC_USE_ISOC2X


144 #unde‡
__GLIBC_USE_DEPRECATED_GETS


145 #unde‡
__GLIBC_USE_DEPRECATED_SCANF


149 #i‚de‡
_LOOSE_KERNEL_NAMES


150 
	#__KERNEL_STRICT_NAMES


	)

160 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


161 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

162 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

164 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

171 #i‡
deföed
 
__˛™g_maj‹__
 && deföed 
__˛™g_mö‹__


172 
	#__glibc_˛™g_¥îeq
(
maj
, 
mö
) \

173 ((
__˛™g_maj‹__
 << 16Ë+ 
__˛™g_mö‹__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

175 
	#__glibc_˛™g_¥îeq
(
maj
, 
mö
Ë0

	)

179 
	#__GLIBC_USE
(
F
Ë
__GLIBC_USE_
 ## 
	)
F

185 #i‡(
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE
) \

186 && !
deföed
 
	g_DEFAULT_SOURCE


188 #unde‡
_DEFAULT_SOURCE


189 
	#_DEFAULT_SOURCE
 1

	)

193 #ifde‡
_GNU_SOURCE


194 #unde‡
_ISOC95_SOURCE


195 
	#_ISOC95_SOURCE
 1

	)

196 #unde‡
_ISOC99_SOURCE


197 
	#_ISOC99_SOURCE
 1

	)

198 #unde‡
_ISOC11_SOURCE


199 
	#_ISOC11_SOURCE
 1

	)

200 #unde‡
_ISOC2X_SOURCE


201 
	#_ISOC2X_SOURCE
 1

	)

202 #unde‡
_POSIX_SOURCE


203 
	#_POSIX_SOURCE
 1

	)

204 #unde‡
_POSIX_C_SOURCE


205 
	#_POSIX_C_SOURCE
 200809L

	)

206 #unde‡
_XOPEN_SOURCE


207 
	#_XOPEN_SOURCE
 700

	)

208 #unde‡
_XOPEN_SOURCE_EXTENDED


209 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

210 #unde‡
_LARGEFILE64_SOURCE


211 
	#_LARGEFILE64_SOURCE
 1

	)

212 #unde‡
_DEFAULT_SOURCE


213 
	#_DEFAULT_SOURCE
 1

	)

214 #unde‡
_ATFILE_SOURCE


215 
	#_ATFILE_SOURCE
 1

	)

220 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

221 || (!
deföed
 
	g__STRICT_ANSI__
 \

222 && !
deföed
 
	g_ISOC99_SOURCE
 && !deföed 
	g_ISOC11_SOURCE
 \

223 && !
deföed
 
	g_ISOC2X_SOURCE
 \

224 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

225 && !
deföed
 
	g_XOPEN_SOURCE
))

226 #unde‡
_DEFAULT_SOURCE


227 
	#_DEFAULT_SOURCE
 1

	)

231 #i‡(
deföed
 
_ISOC2X_SOURCE
 \

232 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ > 201710L))

233 
	#__GLIBC_USE_ISOC2X
 1

	)

235 
	#__GLIBC_USE_ISOC2X
 0

	)

239 #i‡(
deföed
 
_ISOC11_SOURCE
 || deföed 
_ISOC2X_SOURCE
 \

240 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

241 
	#__USE_ISOC11
 1

	)

245 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

246 || 
deföed
 
_ISOC2X_SOURCE
 \

247 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

248 
	#__USE_ISOC99
 1

	)

252 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

253 || 
deföed
 
_ISOC2X_SOURCE
 \

254 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

255 
	#__USE_ISOC95
 1

	)

258 #ifde‡
__˝lu•lus


260 #i‡
__˝lu•lus
 >= 201703L

261 
	#__USE_ISOC11
 1

	)

265 #i‡
__˝lu•lus
 >201103L || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__


266 
	#__USE_ISOCXX11
 1

	)

267 
	#__USE_ISOC99
 1

	)

274 #ifde‡
_DEFAULT_SOURCE


275 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


276 
	#__USE_POSIX_IMPLICITLY
 1

	)

278 #unde‡
_POSIX_SOURCE


279 
	#_POSIX_SOURCE
 1

	)

280 #unde‡
_POSIX_C_SOURCE


281 
	#_POSIX_C_SOURCE
 200809L

	)

284 #i‡((!
deföed
 
__STRICT_ANSI__
 \

285 || (
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

286 && !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

287 
	#_POSIX_SOURCE
 1

	)

288 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

289 
	#_POSIX_C_SOURCE
 2

	)

290 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

291 
	#_POSIX_C_SOURCE
 199506L

	)

292 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

293 
	#_POSIX_C_SOURCE
 200112L

	)

295 
	#_POSIX_C_SOURCE
 200809L

	)

297 
	#__USE_POSIX_IMPLICITLY
 1

	)

306 #i‡((!
deföed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

307 && (
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE
))

308 
	#_POSIX_SOURCE
 1

	)

309 #unde‡
_POSIX_C_SOURCE


310 
	#_POSIX_C_SOURCE
 199506L

	)

313 #i‡(
deföed
 
_POSIX_SOURCE
 \

314 || (
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

315 || 
deföed
 
_XOPEN_SOURCE
)

316 
	#__USE_POSIX
 1

	)

319 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


320 
	#__USE_POSIX2
 1

	)

323 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

324 
	#__USE_POSIX199309
 1

	)

327 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

328 
	#__USE_POSIX199506
 1

	)

331 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

332 
	#__USE_XOPEN2K
 1

	)

333 #unde‡
__USE_ISOC95


334 
	#__USE_ISOC95
 1

	)

335 #unde‡
__USE_ISOC99


336 
	#__USE_ISOC99
 1

	)

339 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

340 
	#__USE_XOPEN2K8
 1

	)

341 #unde‡
_ATFILE_SOURCE


342 
	#_ATFILE_SOURCE
 1

	)

345 #ifdef 
_XOPEN_SOURCE


346 
	#__USE_XOPEN
 1

	)

347 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

348 
	#__USE_XOPEN_EXTENDED
 1

	)

349 
	#__USE_UNIX98
 1

	)

350 #unde‡
_LARGEFILE_SOURCE


351 
	#_LARGEFILE_SOURCE
 1

	)

352 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

353 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

354 
	#__USE_XOPEN2K8
 1

	)

355 
	#__USE_XOPEN2K8XSI
 1

	)

357 
	#__USE_XOPEN2K
 1

	)

358 
	#__USE_XOPEN2KXSI
 1

	)

359 #unde‡
__USE_ISOC95


360 
	#__USE_ISOC95
 1

	)

361 #unde‡
__USE_ISOC99


362 
	#__USE_ISOC99
 1

	)

365 #ifde‡
_XOPEN_SOURCE_EXTENDED


366 
	#__USE_XOPEN_EXTENDED
 1

	)

371 #ifde‡
_LARGEFILE_SOURCE


372 
	#__USE_LARGEFILE
 1

	)

375 #ifde‡
_LARGEFILE64_SOURCE


376 
	#__USE_LARGEFILE64
 1

	)

379 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

380 
	#__USE_FILE_OFFSET64
 1

	)

383 #i‡
deföed
 
_DEFAULT_SOURCE


384 
	#__USE_MISC
 1

	)

387 #ifdef 
_ATFILE_SOURCE


388 
	#__USE_ATFILE
 1

	)

391 #ifdef 
_GNU_SOURCE


392 
	#__USE_GNU
 1

	)

395 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

396 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

397 #i‡
_FORTIFY_SOURCE
 > 1

398 
	#__USE_FORTIFY_LEVEL
 2

	)

400 
	#__USE_FORTIFY_LEVEL
 1

	)

403 
	#__USE_FORTIFY_LEVEL
 0

	)

410 #i‡
deföed
 
__˝lu•lus
 ? __˝lu•lu†>201402L : deföed 
__USE_ISOC11


411 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

413 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

428 #i‡(
deföed
 
__USE_GNU
 \

429 && (
deföed
 
	g__˝lu•lus
 \

430 ? (
	g__˝lu•lus
 < 201103L && !
deföed
 
	g__GXX_EXPERIMENTAL_CXX0X__
) \

431 : (!
deföed
 
__STDC_VERSION__
 || __STDC_VERSION__ < 199901L)))

432 
	#__GLIBC_USE_DEPRECATED_SCANF
 1

	)

434 
	#__GLIBC_USE_DEPRECATED_SCANF
 0

	)

439 
	~<°dc-¥edef.h
>

447 #unde‡
__GNU_LIBRARY__


448 
	#__GNU_LIBRARY__
 6

	)

452 
	#__GLIBC__
 2

	)

453 
	#__GLIBC_MINOR__
 31

	)

455 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

456 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

459 #i‚de‡
__ASSEMBLER__


460 #i‚de‡
_SYS_CDEFS_H


461 
	~<sys/cdefs.h
>

466 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


467 
	#__USE_LARGEFILE
 1

	)

468 
	#__USE_LARGEFILE64
 1

	)

474 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

475 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

476 && 
deföed
 
	g__exã∫_ölöe


477 
	#__USE_EXTERN_INLINES
 1

	)

485 
	~<gnu/°ubs.h
>

	@/usr/include/linux/const.h

4 #i‚de‡
_LINUX_CONST_H


5 
	#_LINUX_CONST_H


	)

16 #ifde‡
__ASSEMBLY__


17 
	#_AC
(
X
,
Y
Ë
	)
X

18 
	#_AT
(
T
,
X
Ë
	)
X

20 
	#__AC
(
X
,
Y
Ë(X##Y)

	)

21 
	#_AC
(
X
,
Y
Ë
	`__AC
(X,Y)

	)

22 
	#_AT
(
T
,
X
Ë((T)(X))

	)

25 
	#_UL
(
x
Ë(
	`_AC
(x, 
UL
))

	)

26 
	#_ULL
(
x
Ë(
	`_AC
(x, 
ULL
))

	)

28 
	#_BITUL
(
x
Ë(
	`_UL
(1Ë<< (x))

	)

29 
	#_BITULL
(
x
Ë(
	`_ULL
(1Ë<< (x))

	)

31 
	#__ALIGN_KERNEL
(
x
, 
a
Ë
	`__ALIGN_KERNEL_MASK
(x, (
	`ty≥of
(x))◊Ë- 1)

	)

32 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
Ë(((xË+ (mask)Ë& ~(mask))

	)

34 
	#__KERNEL_DIV_ROUND_UP
(
n
, 
d
Ë((“Ë+ (dË- 1Ë/ (d))

	)

	@/usr/include/linux/fscrypt.h

8 #i‚de‡
_LINUX_FSCRYPT_H


9 
	#_LINUX_FSCRYPT_H


	)

11 
	~<löux/ty≥s.h
>

14 
	#FSCRYPT_POLICY_FLAGS_PAD_4
 0x00

	)

15 
	#FSCRYPT_POLICY_FLAGS_PAD_8
 0x01

	)

16 
	#FSCRYPT_POLICY_FLAGS_PAD_16
 0x02

	)

17 
	#FSCRYPT_POLICY_FLAGS_PAD_32
 0x03

	)

18 
	#FSCRYPT_POLICY_FLAGS_PAD_MASK
 0x03

	)

19 
	#FSCRYPT_POLICY_FLAG_DIRECT_KEY
 0x04

	)

22 
	#FSCRYPT_MODE_AES_256_XTS
 1

	)

23 
	#FSCRYPT_MODE_AES_256_CTS
 4

	)

24 
	#FSCRYPT_MODE_AES_128_CBC
 5

	)

25 
	#FSCRYPT_MODE_AES_128_CTS
 6

	)

26 
	#FSCRYPT_MODE_ADIANTUM
 9

	)

35 
	#FSCRYPT_POLICY_V1
 0

	)

36 
	#FSCRYPT_KEY_DESCRIPTOR_SIZE
 8

	)

37 
	sfs¸y±_pﬁicy_v1
 {

38 
__u8
 
	mvîsi⁄
;

39 
__u8
 
	mc⁄ã¡s_í¸y±i⁄_mode
;

40 
__u8
 
	mfûíames_í¸y±i⁄_mode
;

41 
__u8
 
	mÊags
;

42 
__u8
 
	mma°î_key_des¸ùt‹
[
FSCRYPT_KEY_DESCRIPTOR_SIZE
];

44 
	#fs¸y±_pﬁicy
 
fs¸y±_pﬁicy_v1


	)

50 
	#FSCRYPT_KEY_DESC_PREFIX
 "fs¸y±:"

	)

51 
	#FSCRYPT_KEY_DESC_PREFIX_SIZE
 8

	)

52 
	#FSCRYPT_MAX_KEY_SIZE
 64

	)

53 
	sfs¸y±_key
 {

54 
__u32
 
	mmode
;

55 
__u8
 
	møw
[
FSCRYPT_MAX_KEY_SIZE
];

56 
__u32
 
	msize
;

62 
	#FSCRYPT_POLICY_V2
 2

	)

63 
	#FSCRYPT_KEY_IDENTIFIER_SIZE
 16

	)

64 
	sfs¸y±_pﬁicy_v2
 {

65 
__u8
 
	mvîsi⁄
;

66 
__u8
 
	mc⁄ã¡s_í¸y±i⁄_mode
;

67 
__u8
 
	mfûíames_í¸y±i⁄_mode
;

68 
__u8
 
	mÊags
;

69 
__u8
 
	m__ª£rved
[4];

70 
__u8
 
	mma°î_key_idítifõr
[
FSCRYPT_KEY_IDENTIFIER_SIZE
];

74 
	sfs¸y±_gë_pﬁicy_ex_¨g
 {

75 
__u64
 
	mpﬁicy_size
;

77 
__u8
 
	mvîsi⁄
;

78 
fs¸y±_pﬁicy_v1
 
	mv1
;

79 
fs¸y±_pﬁicy_v2
 
	mv2
;

80 } 
	mpﬁicy
;

87 
	#FSCRYPT_KEY_SPEC_TYPE_DESCRIPTOR
 1

	)

94 
	#FSCRYPT_KEY_SPEC_TYPE_IDENTIFIER
 2

	)

100 
	sfs¸y±_key_•ecifõr
 {

101 
__u32
 
	mty≥
;

102 
__u32
 
	m__ª£rved
;

104 
__u8
 
	m__ª£rved
[32];

105 
__u8
 
	mdes¸ùt‹
[
FSCRYPT_KEY_DESCRIPTOR_SIZE
];

106 
__u8
 
	midítifõr
[
FSCRYPT_KEY_IDENTIFIER_SIZE
];

107 } 
	mu
;

111 
	sfs¸y±_add_key_¨g
 {

112 
fs¸y±_key_•ecifõr
 
	mkey_•ec
;

113 
__u32
 
	møw_size
;

114 
__u32
 
	m__ª£rved
[9];

115 
__u8
 
	møw
[];

119 
	sfs¸y±_ªmove_key_¨g
 {

120 
fs¸y±_key_•ecifõr
 
	mkey_•ec
;

121 
	#FSCRYPT_KEY_REMOVAL_STATUS_FLAG_FILES_BUSY
 0x00000001

	)

122 
	#FSCRYPT_KEY_REMOVAL_STATUS_FLAG_OTHER_USERS
 0x00000002

	)

123 
__u32
 
	mªmovÆ_°©us_Êags
;

124 
__u32
 
	m__ª£rved
[5];

128 
	sfs¸y±_gë_key_°©us_¨g
 {

130 
fs¸y±_key_•ecifõr
 
	mkey_•ec
;

131 
__u32
 
	m__ª£rved
[6];

134 
	#FSCRYPT_KEY_STATUS_ABSENT
 1

	)

135 
	#FSCRYPT_KEY_STATUS_PRESENT
 2

	)

136 
	#FSCRYPT_KEY_STATUS_INCOMPLETELY_REMOVED
 3

	)

137 
__u32
 
	m°©us
;

138 
	#FSCRYPT_KEY_STATUS_FLAG_ADDED_BY_SELF
 0x00000001

	)

139 
__u32
 
	m°©us_Êags
;

140 
__u32
 
	mu£r_cou¡
;

141 
__u32
 
	m__out_ª£rved
[13];

144 
	#FS_IOC_SET_ENCRYPTION_POLICY
 
	`_IOR
('f', 19, 
fs¸y±_pﬁicy
)

	)

145 
	#FS_IOC_GET_ENCRYPTION_PWSALT
 
	`_IOW
('f', 20, 
__u8
[16])

	)

146 
	#FS_IOC_GET_ENCRYPTION_POLICY
 
	`_IOW
('f', 21, 
fs¸y±_pﬁicy
)

	)

147 
	#FS_IOC_GET_ENCRYPTION_POLICY_EX
 
	`_IOWR
('f', 22, 
__u8
[9]Ë

	)

148 
	#FS_IOC_ADD_ENCRYPTION_KEY
 
	`_IOWR
('f', 23, 
fs¸y±_add_key_¨g
)

	)

149 
	#FS_IOC_REMOVE_ENCRYPTION_KEY
 
	`_IOWR
('f', 24, 
fs¸y±_ªmove_key_¨g
)

	)

150 
	#FS_IOC_REMOVE_ENCRYPTION_KEY_ALL_USERS
 
	`_IOWR
('f', 25, 
fs¸y±_ªmove_key_¨g
)

	)

151 
	#FS_IOC_GET_ENCRYPTION_KEY_STATUS
 
	`_IOWR
('f', 26, 
fs¸y±_gë_key_°©us_¨g
)

	)

156 
	#FS_KEY_DESCRIPTOR_SIZE
 
FSCRYPT_KEY_DESCRIPTOR_SIZE


	)

157 
	#FS_POLICY_FLAGS_PAD_4
 
FSCRYPT_POLICY_FLAGS_PAD_4


	)

158 
	#FS_POLICY_FLAGS_PAD_8
 
FSCRYPT_POLICY_FLAGS_PAD_8


	)

159 
	#FS_POLICY_FLAGS_PAD_16
 
FSCRYPT_POLICY_FLAGS_PAD_16


	)

160 
	#FS_POLICY_FLAGS_PAD_32
 
FSCRYPT_POLICY_FLAGS_PAD_32


	)

161 
	#FS_POLICY_FLAGS_PAD_MASK
 
FSCRYPT_POLICY_FLAGS_PAD_MASK


	)

162 
	#FS_POLICY_FLAG_DIRECT_KEY
 
FSCRYPT_POLICY_FLAG_DIRECT_KEY


	)

163 
	#FS_POLICY_FLAGS_VALID
 0x07

	)

164 
	#FS_ENCRYPTION_MODE_INVALID
 0

	)

165 
	#FS_ENCRYPTION_MODE_AES_256_XTS
 
FSCRYPT_MODE_AES_256_XTS


	)

166 
	#FS_ENCRYPTION_MODE_AES_256_GCM
 2

	)

167 
	#FS_ENCRYPTION_MODE_AES_256_CBC
 3

	)

168 
	#FS_ENCRYPTION_MODE_AES_256_CTS
 
FSCRYPT_MODE_AES_256_CTS


	)

169 
	#FS_ENCRYPTION_MODE_AES_128_CBC
 
FSCRYPT_MODE_AES_128_CBC


	)

170 
	#FS_ENCRYPTION_MODE_AES_128_CTS
 
FSCRYPT_MODE_AES_128_CTS


	)

171 
	#FS_ENCRYPTION_MODE_SPECK128_256_XTS
 7

	)

172 
	#FS_ENCRYPTION_MODE_SPECK128_256_CTS
 8

	)

173 
	#FS_ENCRYPTION_MODE_ADIANTUM
 
FSCRYPT_MODE_ADIANTUM


	)

174 
	#FS_KEY_DESC_PREFIX
 
FSCRYPT_KEY_DESC_PREFIX


	)

175 
	#FS_KEY_DESC_PREFIX_SIZE
 
FSCRYPT_KEY_DESC_PREFIX_SIZE


	)

176 
	#FS_MAX_KEY_SIZE
 
FSCRYPT_MAX_KEY_SIZE


	)

	@/usr/include/linux/if.h

20 #i‚de‡
_LINUX_IF_H


21 
	#_LINUX_IF_H


	)

23 
	~<löux/libc-com∑t.h
>

24 
	~<löux/ty≥s.h
>

25 
	~<löux/sockë.h
>

28 
	~<sys/sockë.h
>

30 #i‡
__UAPI_DEF_IF_IFNAMSIZ


31 
	#IFNAMSIZ
 16

	)

33 
	#IFALIASZ
 256

	)

34 
	~<löux/hdlc/io˘l.h
>

37 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 != 0 || \

38 
	g__UAPI_DEF_IF_NET_DEVICE_FLAGS
 != 0

79 
	e√t_devi˚_Êags
 {

81 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS


82 
IFF_UP
 = 1<<0,

83 
	mIFF_BROADCAST
 = 1<<1,

84 
	mIFF_DEBUG
 = 1<<2,

85 
	mIFF_LOOPBACK
 = 1<<3,

86 
	mIFF_POINTOPOINT
 = 1<<4,

87 
	mIFF_NOTRAILERS
 = 1<<5,

88 
	mIFF_RUNNING
 = 1<<6,

89 
	mIFF_NOARP
 = 1<<7,

90 
	mIFF_PROMISC
 = 1<<8,

91 
	mIFF_ALLMULTI
 = 1<<9,

92 
	mIFF_MASTER
 = 1<<10,

93 
	mIFF_SLAVE
 = 1<<11,

94 
	mIFF_MULTICAST
 = 1<<12,

95 
	mIFF_PORTSEL
 = 1<<13,

96 
	mIFF_AUTOMEDIA
 = 1<<14,

97 
	mIFF_DYNAMIC
 = 1<<15,

99 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


100 
	mIFF_LOWER_UP
 = 1<<16,

101 
	mIFF_DORMANT
 = 1<<17,

102 
	mIFF_ECHO
 = 1<<18,

108 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS


109 
	#IFF_UP
 
IFF_UP


	)

110 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

111 
	#IFF_DEBUG
 
IFF_DEBUG


	)

112 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

113 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

114 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

115 
	#IFF_RUNNING
 
IFF_RUNNING


	)

116 
	#IFF_NOARP
 
IFF_NOARP


	)

117 
	#IFF_PROMISC
 
IFF_PROMISC


	)

118 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

119 
	#IFF_MASTER
 
IFF_MASTER


	)

120 
	#IFF_SLAVE
 
IFF_SLAVE


	)

121 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

122 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

123 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

124 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

127 #i‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


128 
	#IFF_LOWER_UP
 
IFF_LOWER_UP


	)

129 
	#IFF_DORMANT
 
IFF_DORMANT


	)

130 
	#IFF_ECHO
 
IFF_ECHO


	)

133 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|
IFF_ECHO
|\

134 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

136 
	#IF_GET_IFACE
 0x0001

	)

137 
	#IF_GET_PROTO
 0x0002

	)

140 
	#IF_IFACE_V35
 0x1000

	)

141 
	#IF_IFACE_V24
 0x1001

	)

142 
	#IF_IFACE_X21
 0x1002

	)

143 
	#IF_IFACE_T1
 0x1003

	)

144 
	#IF_IFACE_E1
 0x1004

	)

145 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

146 
	#IF_IFACE_X21D
 0x1006

	)

149 
	#IF_PROTO_HDLC
 0x2000

	)

150 
	#IF_PROTO_PPP
 0x2001

	)

151 
	#IF_PROTO_CISCO
 0x2002

	)

152 
	#IF_PROTO_FR
 0x2003

	)

153 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

154 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

155 
	#IF_PROTO_X25
 0x2006

	)

156 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

157 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

158 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

159 
	#IF_PROTO_FR_PVC
 0x200A

	)

160 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

161 
	#IF_PROTO_RAW
 0x200C

	)

165 
	mIF_OPER_UNKNOWN
,

166 
	mIF_OPER_NOTPRESENT
,

167 
	mIF_OPER_DOWN
,

168 
	mIF_OPER_LOWERLAYERDOWN
,

169 
	mIF_OPER_TESTING
,

170 
	mIF_OPER_DORMANT
,

171 
	mIF_OPER_UP
,

176 
	mIF_LINK_MODE_DEFAULT
,

177 
	mIF_LINK_MODE_DORMANT
,

191 #i‡
__UAPI_DEF_IF_IFMAP


192 
	sifm≠
 {

193 
	mmem_°¨t
;

194 
	mmem_íd
;

195 
	mba£_addr
;

196 
	múq
;

197 
	mdma
;

198 
	mp‹t
;

203 
	sif_£âögs
 {

204 
	mty≥
;

205 
	msize
;

208 
øw_hdlc_¥Ÿo
 *
	møw_hdlc
;

209 
cisco_¥Ÿo
 *
	mcisco
;

210 
‰_¥Ÿo
 *
	m‰
;

211 
‰_¥Ÿo_pvc
 *
	m‰_pvc
;

212 
‰_¥Ÿo_pvc_öfo
 *
	m‰_pvc_öfo
;

215 
sync_£rül_£âögs
 *
	msync
;

216 
ã1_£âögs
 *
	mã1
;

217 } 
	mifs_ifsu
;

228 #i‡
__UAPI_DEF_IF_IFREQ


229 
	si‰eq
 {

230 
	#IFHWADDRLEN
 6

	)

233 
	mi‰n_«me
[
IFNAMSIZ
];

234 } 
	mi‰_i‰n
;

237 
sockaddr
 
	mi‰u_addr
;

238 
sockaddr
 
	mi‰u_d°addr
;

239 
sockaddr
 
	mi‰u_brﬂdaddr
;

240 
sockaddr
 
	mi‰u_√tmask
;

241 
sockaddr
 
	mi‰u_hwaddr
;

242 
	mi‰u_Êags
;

243 
	mi‰u_ivÆue
;

244 
	mi‰u_mtu
;

245 
ifm≠
 
	mi‰u_m≠
;

246 
	mi‰u_¶ave
[
IFNAMSIZ
];

247 
	mi‰u_√w«me
[
IFNAMSIZ
];

248 * 
	mi‰u_d©a
;

249 
if_£âögs
 
	mi‰u_£âögs
;

250 } 
	mi‰_i‰u
;

254 
	#i‰_«me
 
i‰_i‰n
.
i‰n_«me


	)

255 
	#i‰_hwaddr
 
i‰_i‰u
.
i‰u_hwaddr


	)

256 
	#i‰_addr
 
i‰_i‰u
.
i‰u_addr


	)

257 
	#i‰_d°addr
 
i‰_i‰u
.
i‰u_d°addr


	)

258 
	#i‰_brﬂdaddr
 
i‰_i‰u
.
i‰u_brﬂdaddr


	)

259 
	#i‰_√tmask
 
i‰_i‰u
.
i‰u_√tmask


	)

260 
	#i‰_Êags
 
i‰_i‰u
.
i‰u_Êags


	)

261 
	#i‰_mëric
 
i‰_i‰u
.
i‰u_ivÆue


	)

262 
	#i‰_mtu
 
i‰_i‰u
.
i‰u_mtu


	)

263 
	#i‰_m≠
 
i‰_i‰u
.
i‰u_m≠


	)

264 
	#i‰_¶ave
 
i‰_i‰u
.
i‰u_¶ave


	)

265 
	#i‰_d©a
 
i‰_i‰u
.
i‰u_d©a


	)

266 
	#i‰_ifödex
 
i‰_i‰u
.
i‰u_ivÆue


	)

267 
	#i‰_b™dwidth
 
i‰_i‰u
.
i‰u_ivÆue


	)

268 
	#i‰_qÀn
 
i‰_i‰u
.
i‰u_ivÆue


	)

269 
	#i‰_√w«me
 
i‰_i‰u
.
i‰u_√w«me


	)

270 
	#i‰_£âögs
 
i‰_i‰u
.
i‰u_£âögs


	)

280 #i‡
__UAPI_DEF_IF_IFCONF


281 
	sifc⁄f
 {

282 
	mifc_Àn
;

284 *
	mifcu_buf
;

285 
i‰eq
 *
	mifcu_ªq
;

286 } 
	mifc_ifcu
;

290 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

291 
	#ifc_ªq
 
ifc_ifcu
.
ifcu_ªq


	)

	@/usr/include/linux/if_ether.h

22 #i‚de‡
_LINUX_IF_ETHER_H


23 
	#_LINUX_IF_ETHER_H


	)

25 
	~<löux/ty≥s.h
>

32 
	#ETH_ALEN
 6

	)

33 
	#ETH_TLEN
 2

	)

34 
	#ETH_HLEN
 14

	)

35 
	#ETH_ZLEN
 60

	)

36 
	#ETH_DATA_LEN
 1500

	)

37 
	#ETH_FRAME_LEN
 1514

	)

38 
	#ETH_FCS_LEN
 4

	)

40 
	#ETH_MIN_MTU
 68

	)

41 
	#ETH_MAX_MTU
 0xFFFFU

	)

47 
	#ETH_P_LOOP
 0x0060

	)

48 
	#ETH_P_PUP
 0x0200

	)

49 
	#ETH_P_PUPAT
 0x0201

	)

50 
	#ETH_P_TSN
 0x22F0

	)

51 
	#ETH_P_ERSPAN2
 0x22EB

	)

52 
	#ETH_P_IP
 0x0800

	)

53 
	#ETH_P_X25
 0x0805

	)

54 
	#ETH_P_ARP
 0x0806

	)

55 
	#ETH_P_BPQ
 0x08FF

	)

56 
	#ETH_P_IEEEPUP
 0x0a00

	)

57 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

58 
	#ETH_P_BATMAN
 0x4305

	)

59 
	#ETH_P_DEC
 0x6000

	)

60 
	#ETH_P_DNA_DL
 0x6001

	)

61 
	#ETH_P_DNA_RC
 0x6002

	)

62 
	#ETH_P_DNA_RT
 0x6003

	)

63 
	#ETH_P_LAT
 0x6004

	)

64 
	#ETH_P_DIAG
 0x6005

	)

65 
	#ETH_P_CUST
 0x6006

	)

66 
	#ETH_P_SCA
 0x6007

	)

67 
	#ETH_P_TEB
 0x6558

	)

68 
	#ETH_P_RARP
 0x8035

	)

69 
	#ETH_P_ATALK
 0x809B

	)

70 
	#ETH_P_AARP
 0x80F3

	)

71 
	#ETH_P_8021Q
 0x8100

	)

72 
	#ETH_P_ERSPAN
 0x88BE

	)

73 
	#ETH_P_IPX
 0x8137

	)

74 
	#ETH_P_IPV6
 0x86DD

	)

75 
	#ETH_P_PAUSE
 0x8808

	)

76 
	#ETH_P_SLOW
 0x8809

	)

77 
	#ETH_P_WCCP
 0x883E

	)

79 
	#ETH_P_MPLS_UC
 0x8847

	)

80 
	#ETH_P_MPLS_MC
 0x8848

	)

81 
	#ETH_P_ATMMPOA
 0x884¯

	)

82 
	#ETH_P_PPP_DISC
 0x8863

	)

83 
	#ETH_P_PPP_SES
 0x8864

	)

84 
	#ETH_P_LINK_CTL
 0x886¯

	)

85 
	#ETH_P_ATMFATE
 0x8884

	)

88 
	#ETH_P_PAE
 0x888E

	)

89 
	#ETH_P_AOE
 0x88A2

	)

90 
	#ETH_P_8021AD
 0x88A8

	)

91 
	#ETH_P_802_EX1
 0x88B5

	)

92 
	#ETH_P_PREAUTH
 0x88C7

	)

93 
	#ETH_P_TIPC
 0x88CA

	)

94 
	#ETH_P_LLDP
 0x88CC

	)

95 
	#ETH_P_MACSEC
 0x88E5

	)

96 
	#ETH_P_8021AH
 0x88E7

	)

97 
	#ETH_P_MVRP
 0x88F5

	)

98 
	#ETH_P_1588
 0x88F7

	)

99 
	#ETH_P_NCSI
 0x88F8

	)

100 
	#ETH_P_PRP
 0x88FB

	)

101 
	#ETH_P_FCOE
 0x8906

	)

102 
	#ETH_P_IBOE
 0x8915

	)

103 
	#ETH_P_TDLS
 0x890D

	)

104 
	#ETH_P_FIP
 0x8914

	)

105 
	#ETH_P_80221
 0x8917

	)

106 
	#ETH_P_HSR
 0x892F

	)

107 
	#ETH_P_NSH
 0x894F

	)

108 
	#ETH_P_LOOPBACK
 0x9000

	)

109 
	#ETH_P_QINQ1
 0x9100

	)

110 
	#ETH_P_QINQ2
 0x9200

	)

111 
	#ETH_P_QINQ3
 0x9300

	)

112 
	#ETH_P_EDSA
 0xDADA

	)

113 
	#ETH_P_DSA_8021Q
 0xDADB

	)

114 
	#ETH_P_IFE
 0xED3E

	)

115 
	#ETH_P_AF_IUCV
 0xFBFB

	)

117 
	#ETH_P_802_3_MIN
 0x0600

	)

124 
	#ETH_P_802_3
 0x0001

	)

125 
	#ETH_P_AX25
 0x0002

	)

126 
	#ETH_P_ALL
 0x0003

	)

127 
	#ETH_P_802_2
 0x0004

	)

128 
	#ETH_P_SNAP
 0x0005

	)

129 
	#ETH_P_DDCMP
 0x0006

	)

130 
	#ETH_P_WAN_PPP
 0x0007

	)

131 
	#ETH_P_PPP_MP
 0x0008

	)

132 
	#ETH_P_LOCALTALK
 0x0009

	)

133 
	#ETH_P_CAN
 0x000C

	)

134 
	#ETH_P_CANFD
 0x000D

	)

135 
	#ETH_P_PPPTALK
 0x0010

	)

136 
	#ETH_P_TR_802_2
 0x0011

	)

137 
	#ETH_P_MOBITEX
 0x0015

	)

138 
	#ETH_P_CONTROL
 0x0016

	)

139 
	#ETH_P_IRDA
 0x0017

	)

140 
	#ETH_P_ECONET
 0x0018

	)

141 
	#ETH_P_HDLC
 0x0019

	)

142 
	#ETH_P_ARCNET
 0x001A

	)

143 
	#ETH_P_DSA
 0x001B

	)

144 
	#ETH_P_TRAILER
 0x001C

	)

145 
	#ETH_P_PHONET
 0x00F5

	)

146 
	#ETH_P_IEEE802154
 0x00F6

	)

147 
	#ETH_P_CAIF
 0x00F7

	)

148 
	#ETH_P_XDSA
 0x00F8

	)

149 
	#ETH_P_MAP
 0x00F9

	)

158 #i‚de‡
__UAPI_DEF_ETHHDR


159 
	#__UAPI_DEF_ETHHDR
 1

	)

162 #i‡
__UAPI_DEF_ETHHDR


163 
	sëhhdr
 {

164 
	mh_de°
[
ETH_ALEN
];

165 
	mh_sour˚
[
ETH_ALEN
];

166 
__be16
 
	mh_¥Ÿo
;

167 } 
__©åibuã__
((
∑cked
));

	@/usr/include/linux/if_link.h

2 #i‚de‡
_LINUX_IF_LINK_H


3 
	#_LINUX_IF_LINK_H


	)

5 
	~<löux/ty≥s.h
>

6 
	~<löux/√éök.h
>

9 
	sπ∆_lök_°©s
 {

10 
__u32
 
	mrx_∑ckës
;

11 
__u32
 
	mtx_∑ckës
;

12 
__u32
 
	mrx_byãs
;

13 
__u32
 
	mtx_byãs
;

14 
__u32
 
	mrx_îr‹s
;

15 
__u32
 
	mtx_îr‹s
;

16 
__u32
 
	mrx_dr›≥d
;

17 
__u32
 
	mtx_dr›≥d
;

18 
__u32
 
	mmu…iˇ°
;

19 
__u32
 
	mcﬁlisi⁄s
;

22 
__u32
 
	mrx_Àngth_îr‹s
;

23 
__u32
 
	mrx_ovî_îr‹s
;

24 
__u32
 
	mrx_¸c_îr‹s
;

25 
__u32
 
	mrx_‰ame_îr‹s
;

26 
__u32
 
	mrx_fifo_îr‹s
;

27 
__u32
 
	mrx_mis£d_îr‹s
;

30 
__u32
 
	mtx_ab‹ãd_îr‹s
;

31 
__u32
 
	mtx_ˇºõr_îr‹s
;

32 
__u32
 
	mtx_fifo_îr‹s
;

33 
__u32
 
	mtx_hóπbót_îr‹s
;

34 
__u32
 
	mtx_wödow_îr‹s
;

37 
__u32
 
	mrx_com¥es£d
;

38 
__u32
 
	mtx_com¥es£d
;

40 
__u32
 
	mrx_noh™dÀr
;

44 
	sπ∆_lök_°©s64
 {

45 
__u64
 
	mrx_∑ckës
;

46 
__u64
 
	mtx_∑ckës
;

47 
__u64
 
	mrx_byãs
;

48 
__u64
 
	mtx_byãs
;

49 
__u64
 
	mrx_îr‹s
;

50 
__u64
 
	mtx_îr‹s
;

51 
__u64
 
	mrx_dr›≥d
;

52 
__u64
 
	mtx_dr›≥d
;

53 
__u64
 
	mmu…iˇ°
;

54 
__u64
 
	mcﬁlisi⁄s
;

57 
__u64
 
	mrx_Àngth_îr‹s
;

58 
__u64
 
	mrx_ovî_îr‹s
;

59 
__u64
 
	mrx_¸c_îr‹s
;

60 
__u64
 
	mrx_‰ame_îr‹s
;

61 
__u64
 
	mrx_fifo_îr‹s
;

62 
__u64
 
	mrx_mis£d_îr‹s
;

65 
__u64
 
	mtx_ab‹ãd_îr‹s
;

66 
__u64
 
	mtx_ˇºõr_îr‹s
;

67 
__u64
 
	mtx_fifo_îr‹s
;

68 
__u64
 
	mtx_hóπbót_îr‹s
;

69 
__u64
 
	mtx_wödow_îr‹s
;

72 
__u64
 
	mrx_com¥es£d
;

73 
__u64
 
	mtx_com¥es£d
;

75 
__u64
 
	mrx_noh™dÀr
;

79 
	sπ∆_lök_ifm≠
 {

80 
__u64
 
	mmem_°¨t
;

81 
__u64
 
	mmem_íd
;

82 
__u64
 
	mba£_addr
;

83 
__u16
 
	múq
;

84 
__u8
 
	mdma
;

85 
__u8
 
	mp‹t
;

107 
	mIFLA_UNSPEC
,

108 
	mIFLA_ADDRESS
,

109 
	mIFLA_BROADCAST
,

110 
	mIFLA_IFNAME
,

111 
	mIFLA_MTU
,

112 
	mIFLA_LINK
,

113 
	mIFLA_QDISC
,

114 
	mIFLA_STATS
,

115 
	mIFLA_COST
,

116 
	#IFLA_COST
 
IFLA_COST


	)

117 
	mIFLA_PRIORITY
,

118 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

119 
	mIFLA_MASTER
,

120 
	#IFLA_MASTER
 
IFLA_MASTER


	)

121 
	mIFLA_WIRELESS
,

122 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

123 
	mIFLA_PROTINFO
,

124 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

125 
	mIFLA_TXQLEN
,

126 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

127 
	mIFLA_MAP
,

128 
	#IFLA_MAP
 
IFLA_MAP


	)

129 
	mIFLA_WEIGHT
,

130 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

131 
	mIFLA_OPERSTATE
,

132 
	mIFLA_LINKMODE
,

133 
	mIFLA_LINKINFO
,

134 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

135 
	mIFLA_NET_NS_PID
,

136 
	mIFLA_IFALIAS
,

137 
	mIFLA_NUM_VF
,

138 
	mIFLA_VFINFO_LIST
,

139 
	mIFLA_STATS64
,

140 
	mIFLA_VF_PORTS
,

141 
	mIFLA_PORT_SELF
,

142 
	mIFLA_AF_SPEC
,

143 
	mIFLA_GROUP
,

144 
	mIFLA_NET_NS_FD
,

145 
	mIFLA_EXT_MASK
,

146 
	mIFLA_PROMISCUITY
,

147 
	#IFLA_PROMISCUITY
 
IFLA_PROMISCUITY


	)

148 
	mIFLA_NUM_TX_QUEUES
,

149 
	mIFLA_NUM_RX_QUEUES
,

150 
	mIFLA_CARRIER
,

151 
	mIFLA_PHYS_PORT_ID
,

152 
	mIFLA_CARRIER_CHANGES
,

153 
	mIFLA_PHYS_SWITCH_ID
,

154 
	mIFLA_LINK_NETNSID
,

155 
	mIFLA_PHYS_PORT_NAME
,

156 
	mIFLA_PROTO_DOWN
,

157 
	mIFLA_GSO_MAX_SEGS
,

158 
	mIFLA_GSO_MAX_SIZE
,

159 
	mIFLA_PAD
,

160 
	mIFLA_XDP
,

161 
	mIFLA_EVENT
,

162 
	mIFLA_NEW_NETNSID
,

163 
	mIFLA_IF_NETNSID
,

164 
	mIFLA_TARGET_NETNSID
 = 
IFLA_IF_NETNSID
,

165 
	mIFLA_CARRIER_UP_COUNT
,

166 
	mIFLA_CARRIER_DOWN_COUNT
,

167 
	mIFLA_NEW_IFINDEX
,

168 
	mIFLA_MIN_MTU
,

169 
	mIFLA_MAX_MTU
,

170 
	m__IFLA_MAX


174 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

177 
	#IFLA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
iföfomsg
))))

	)

178 
	#IFLA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
iföfomsg
))

	)

181 
	mIFLA_INET_UNSPEC
,

182 
	mIFLA_INET_CONF
,

183 
	m__IFLA_INET_MAX
,

186 
	#IFLA_INET_MAX
 (
__IFLA_INET_MAX
 - 1)

	)

219 
	mIFLA_INET6_UNSPEC
,

220 
	mIFLA_INET6_FLAGS
,

221 
	mIFLA_INET6_CONF
,

222 
	mIFLA_INET6_STATS
,

223 
	mIFLA_INET6_MCAST
,

224 
	mIFLA_INET6_CACHEINFO
,

225 
	mIFLA_INET6_ICMP6STATS
,

226 
	mIFLA_INET6_TOKEN
,

227 
	mIFLA_INET6_ADDR_GEN_MODE
,

228 
	m__IFLA_INET6_MAX


231 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

233 
	eö6_addr_gí_mode
 {

234 
	mIN6_ADDR_GEN_MODE_EUI64
,

235 
	mIN6_ADDR_GEN_MODE_NONE
,

236 
	mIN6_ADDR_GEN_MODE_STABLE_PRIVACY
,

237 
	mIN6_ADDR_GEN_MODE_RANDOM
,

243 
	mIFLA_BR_UNSPEC
,

244 
	mIFLA_BR_FORWARD_DELAY
,

245 
	mIFLA_BR_HELLO_TIME
,

246 
	mIFLA_BR_MAX_AGE
,

247 
	mIFLA_BR_AGEING_TIME
,

248 
	mIFLA_BR_STP_STATE
,

249 
	mIFLA_BR_PRIORITY
,

250 
	mIFLA_BR_VLAN_FILTERING
,

251 
	mIFLA_BR_VLAN_PROTOCOL
,

252 
	mIFLA_BR_GROUP_FWD_MASK
,

253 
	mIFLA_BR_ROOT_ID
,

254 
	mIFLA_BR_BRIDGE_ID
,

255 
	mIFLA_BR_ROOT_PORT
,

256 
	mIFLA_BR_ROOT_PATH_COST
,

257 
	mIFLA_BR_TOPOLOGY_CHANGE
,

258 
	mIFLA_BR_TOPOLOGY_CHANGE_DETECTED
,

259 
	mIFLA_BR_HELLO_TIMER
,

260 
	mIFLA_BR_TCN_TIMER
,

261 
	mIFLA_BR_TOPOLOGY_CHANGE_TIMER
,

262 
	mIFLA_BR_GC_TIMER
,

263 
	mIFLA_BR_GROUP_ADDR
,

264 
	mIFLA_BR_FDB_FLUSH
,

265 
	mIFLA_BR_MCAST_ROUTER
,

266 
	mIFLA_BR_MCAST_SNOOPING
,

267 
	mIFLA_BR_MCAST_QUERY_USE_IFADDR
,

268 
	mIFLA_BR_MCAST_QUERIER
,

269 
	mIFLA_BR_MCAST_HASH_ELASTICITY
,

270 
	mIFLA_BR_MCAST_HASH_MAX
,

271 
	mIFLA_BR_MCAST_LAST_MEMBER_CNT
,

272 
	mIFLA_BR_MCAST_STARTUP_QUERY_CNT
,

273 
	mIFLA_BR_MCAST_LAST_MEMBER_INTVL
,

274 
	mIFLA_BR_MCAST_MEMBERSHIP_INTVL
,

275 
	mIFLA_BR_MCAST_QUERIER_INTVL
,

276 
	mIFLA_BR_MCAST_QUERY_INTVL
,

277 
	mIFLA_BR_MCAST_QUERY_RESPONSE_INTVL
,

278 
	mIFLA_BR_MCAST_STARTUP_QUERY_INTVL
,

279 
	mIFLA_BR_NF_CALL_IPTABLES
,

280 
	mIFLA_BR_NF_CALL_IP6TABLES
,

281 
	mIFLA_BR_NF_CALL_ARPTABLES
,

282 
	mIFLA_BR_VLAN_DEFAULT_PVID
,

283 
	mIFLA_BR_PAD
,

284 
	mIFLA_BR_VLAN_STATS_ENABLED
,

285 
	mIFLA_BR_MCAST_STATS_ENABLED
,

286 
	mIFLA_BR_MCAST_IGMP_VERSION
,

287 
	mIFLA_BR_MCAST_MLD_VERSION
,

288 
	mIFLA_BR_VLAN_STATS_PER_PORT
,

289 
	mIFLA_BR_MULTI_BOOLOPT
,

290 
	m__IFLA_BR_MAX
,

293 
	#IFLA_BR_MAX
 (
__IFLA_BR_MAX
 - 1)

	)

295 
	siÊa_bridge_id
 {

296 
__u8
 
	m¥io
[2];

297 
__u8
 
	maddr
[6];

301 
	mBRIDGE_MODE_UNSPEC
,

302 
	mBRIDGE_MODE_HAIRPIN
,

306 
	mIFLA_BRPORT_UNSPEC
,

307 
	mIFLA_BRPORT_STATE
,

308 
	mIFLA_BRPORT_PRIORITY
,

309 
	mIFLA_BRPORT_COST
,

310 
	mIFLA_BRPORT_MODE
,

311 
	mIFLA_BRPORT_GUARD
,

312 
	mIFLA_BRPORT_PROTECT
,

313 
	mIFLA_BRPORT_FAST_LEAVE
,

314 
	mIFLA_BRPORT_LEARNING
,

315 
	mIFLA_BRPORT_UNICAST_FLOOD
,

316 
	mIFLA_BRPORT_PROXYARP
,

317 
	mIFLA_BRPORT_LEARNING_SYNC
,

318 
	mIFLA_BRPORT_PROXYARP_WIFI
,

319 
	mIFLA_BRPORT_ROOT_ID
,

320 
	mIFLA_BRPORT_BRIDGE_ID
,

321 
	mIFLA_BRPORT_DESIGNATED_PORT
,

322 
	mIFLA_BRPORT_DESIGNATED_COST
,

323 
	mIFLA_BRPORT_ID
,

324 
	mIFLA_BRPORT_NO
,

325 
	mIFLA_BRPORT_TOPOLOGY_CHANGE_ACK
,

326 
	mIFLA_BRPORT_CONFIG_PENDING
,

327 
	mIFLA_BRPORT_MESSAGE_AGE_TIMER
,

328 
	mIFLA_BRPORT_FORWARD_DELAY_TIMER
,

329 
	mIFLA_BRPORT_HOLD_TIMER
,

330 
	mIFLA_BRPORT_FLUSH
,

331 
	mIFLA_BRPORT_MULTICAST_ROUTER
,

332 
	mIFLA_BRPORT_PAD
,

333 
	mIFLA_BRPORT_MCAST_FLOOD
,

334 
	mIFLA_BRPORT_MCAST_TO_UCAST
,

335 
	mIFLA_BRPORT_VLAN_TUNNEL
,

336 
	mIFLA_BRPORT_BCAST_FLOOD
,

337 
	mIFLA_BRPORT_GROUP_FWD_MASK
,

338 
	mIFLA_BRPORT_NEIGH_SUPPRESS
,

339 
	mIFLA_BRPORT_ISOLATED
,

340 
	mIFLA_BRPORT_BACKUP_PORT
,

341 
	m__IFLA_BRPORT_MAX


343 
	#IFLA_BRPORT_MAX
 (
__IFLA_BRPORT_MAX
 - 1)

	)

345 
	siÊa_ˇcheöfo
 {

346 
__u32
 
	mmax_ªasm_Àn
;

347 
__u32
 
	mt°amp
;

348 
__u32
 
	mªachabÀ_time
;

349 
__u32
 
	mªå™s_time
;

353 
	mIFLA_INFO_UNSPEC
,

354 
	mIFLA_INFO_KIND
,

355 
	mIFLA_INFO_DATA
,

356 
	mIFLA_INFO_XSTATS
,

357 
	mIFLA_INFO_SLAVE_KIND
,

358 
	mIFLA_INFO_SLAVE_DATA
,

359 
	m__IFLA_INFO_MAX
,

362 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

367 
	mIFLA_VLAN_UNSPEC
,

368 
	mIFLA_VLAN_ID
,

369 
	mIFLA_VLAN_FLAGS
,

370 
	mIFLA_VLAN_EGRESS_QOS
,

371 
	mIFLA_VLAN_INGRESS_QOS
,

372 
	mIFLA_VLAN_PROTOCOL
,

373 
	m__IFLA_VLAN_MAX
,

376 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

378 
	siÊa_vœn_Êags
 {

379 
__u32
 
	mÊags
;

380 
__u32
 
	mmask
;

384 
	mIFLA_VLAN_QOS_UNSPEC
,

385 
	mIFLA_VLAN_QOS_MAPPING
,

386 
	m__IFLA_VLAN_QOS_MAX


389 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

391 
	siÊa_vœn_qos_m≠pög
 {

392 
__u32
 
	m‰om
;

393 
__u32
 
	mto
;

398 
	mIFLA_MACVLAN_UNSPEC
,

399 
	mIFLA_MACVLAN_MODE
,

400 
	mIFLA_MACVLAN_FLAGS
,

401 
	mIFLA_MACVLAN_MACADDR_MODE
,

402 
	mIFLA_MACVLAN_MACADDR
,

403 
	mIFLA_MACVLAN_MACADDR_DATA
,

404 
	mIFLA_MACVLAN_MACADDR_COUNT
,

405 
	m__IFLA_MACVLAN_MAX
,

408 
	#IFLA_MACVLAN_MAX
 (
__IFLA_MACVLAN_MAX
 - 1)

	)

410 
	emacvœn_mode
 {

411 
	mMACVLAN_MODE_PRIVATE
 = 1,

412 
	mMACVLAN_MODE_VEPA
 = 2,

413 
	mMACVLAN_MODE_BRIDGE
 = 4,

414 
	mMACVLAN_MODE_PASSTHRU
 = 8,

415 
	mMACVLAN_MODE_SOURCE
 = 16,

418 
	emacvœn_maˇddr_mode
 {

419 
	mMACVLAN_MACADDR_ADD
,

420 
	mMACVLAN_MACADDR_DEL
,

421 
	mMACVLAN_MACADDR_FLUSH
,

422 
	mMACVLAN_MACADDR_SET
,

425 
	#MACVLAN_FLAG_NOPROMISC
 1

	)

429 
	mIFLA_VRF_UNSPEC
,

430 
	mIFLA_VRF_TABLE
,

431 
	m__IFLA_VRF_MAX


434 
	#IFLA_VRF_MAX
 (
__IFLA_VRF_MAX
 - 1)

	)

437 
	mIFLA_VRF_PORT_UNSPEC
,

438 
	mIFLA_VRF_PORT_TABLE
,

439 
	m__IFLA_VRF_PORT_MAX


442 
	#IFLA_VRF_PORT_MAX
 (
__IFLA_VRF_PORT_MAX
 - 1)

	)

446 
	mIFLA_MACSEC_UNSPEC
,

447 
	mIFLA_MACSEC_SCI
,

448 
	mIFLA_MACSEC_PORT
,

449 
	mIFLA_MACSEC_ICV_LEN
,

450 
	mIFLA_MACSEC_CIPHER_SUITE
,

451 
	mIFLA_MACSEC_WINDOW
,

452 
	mIFLA_MACSEC_ENCODING_SA
,

453 
	mIFLA_MACSEC_ENCRYPT
,

454 
	mIFLA_MACSEC_PROTECT
,

455 
	mIFLA_MACSEC_INC_SCI
,

456 
	mIFLA_MACSEC_ES
,

457 
	mIFLA_MACSEC_SCB
,

458 
	mIFLA_MACSEC_REPLAY_PROTECT
,

459 
	mIFLA_MACSEC_VALIDATION
,

460 
	mIFLA_MACSEC_PAD
,

461 
	m__IFLA_MACSEC_MAX
,

464 
	#IFLA_MACSEC_MAX
 (
__IFLA_MACSEC_MAX
 - 1)

	)

468 
	mIFLA_XFRM_UNSPEC
,

469 
	mIFLA_XFRM_LINK
,

470 
	mIFLA_XFRM_IF_ID
,

471 
	m__IFLA_XFRM_MAX


474 
	#IFLA_XFRM_MAX
 (
__IFLA_XFRM_MAX
 - 1)

	)

476 
	emac£c_vÆid©i⁄_ty≥
 {

477 
	mMACSEC_VALIDATE_DISABLED
 = 0,

478 
	mMACSEC_VALIDATE_CHECK
 = 1,

479 
	mMACSEC_VALIDATE_STRICT
 = 2,

480 
	m__MACSEC_VALIDATE_END
,

481 
	mMACSEC_VALIDATE_MAX
 = 
__MACSEC_VALIDATE_END
 - 1,

486 
	mIFLA_IPVLAN_UNSPEC
,

487 
	mIFLA_IPVLAN_MODE
,

488 
	mIFLA_IPVLAN_FLAGS
,

489 
	m__IFLA_IPVLAN_MAX


492 
	#IFLA_IPVLAN_MAX
 (
__IFLA_IPVLAN_MAX
 - 1)

	)

494 
	eùvœn_mode
 {

495 
	mIPVLAN_MODE_L2
 = 0,

496 
	mIPVLAN_MODE_L3
,

497 
	mIPVLAN_MODE_L3S
,

498 
	mIPVLAN_MODE_MAX


501 
	#IPVLAN_F_PRIVATE
 0x01

	)

502 
	#IPVLAN_F_VEPA
 0x02

	)

506 
	mIFLA_VXLAN_UNSPEC
,

507 
	mIFLA_VXLAN_ID
,

508 
	mIFLA_VXLAN_GROUP
,

509 
	mIFLA_VXLAN_LINK
,

510 
	mIFLA_VXLAN_LOCAL
,

511 
	mIFLA_VXLAN_TTL
,

512 
	mIFLA_VXLAN_TOS
,

513 
	mIFLA_VXLAN_LEARNING
,

514 
	mIFLA_VXLAN_AGEING
,

515 
	mIFLA_VXLAN_LIMIT
,

516 
	mIFLA_VXLAN_PORT_RANGE
,

517 
	mIFLA_VXLAN_PROXY
,

518 
	mIFLA_VXLAN_RSC
,

519 
	mIFLA_VXLAN_L2MISS
,

520 
	mIFLA_VXLAN_L3MISS
,

521 
	mIFLA_VXLAN_PORT
,

522 
	mIFLA_VXLAN_GROUP6
,

523 
	mIFLA_VXLAN_LOCAL6
,

524 
	mIFLA_VXLAN_UDP_CSUM
,

525 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_TX
,

526 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_RX
,

527 
	mIFLA_VXLAN_REMCSUM_TX
,

528 
	mIFLA_VXLAN_REMCSUM_RX
,

529 
	mIFLA_VXLAN_GBP
,

530 
	mIFLA_VXLAN_REMCSUM_NOPARTIAL
,

531 
	mIFLA_VXLAN_COLLECT_METADATA
,

532 
	mIFLA_VXLAN_LABEL
,

533 
	mIFLA_VXLAN_GPE
,

534 
	mIFLA_VXLAN_TTL_INHERIT
,

535 
	mIFLA_VXLAN_DF
,

536 
	mIFLA_VXLAN_FAN_MAP
 = 33,

537 
	m__IFLA_VXLAN_MAX


539 
	#IFLA_VXLAN_MAX
 (
__IFLA_VXLAN_MAX
 - 1)

	)

541 
	siÊa_vxœn_p‹t_ønge
 {

542 
__be16
 
	mlow
;

543 
__be16
 
	mhigh
;

546 
	eiÊa_vxœn_df
 {

547 
	mVXLAN_DF_UNSET
 = 0,

548 
	mVXLAN_DF_SET
,

549 
	mVXLAN_DF_INHERIT
,

550 
	m__VXLAN_DF_END
,

551 
	mVXLAN_DF_MAX
 = 
__VXLAN_DF_END
 - 1,

556 
	mIFLA_GENEVE_UNSPEC
,

557 
	mIFLA_GENEVE_ID
,

558 
	mIFLA_GENEVE_REMOTE
,

559 
	mIFLA_GENEVE_TTL
,

560 
	mIFLA_GENEVE_TOS
,

561 
	mIFLA_GENEVE_PORT
,

562 
	mIFLA_GENEVE_COLLECT_METADATA
,

563 
	mIFLA_GENEVE_REMOTE6
,

564 
	mIFLA_GENEVE_UDP_CSUM
,

565 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_TX
,

566 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_RX
,

567 
	mIFLA_GENEVE_LABEL
,

568 
	mIFLA_GENEVE_TTL_INHERIT
,

569 
	mIFLA_GENEVE_DF
,

570 
	m__IFLA_GENEVE_MAX


572 
	#IFLA_GENEVE_MAX
 (
__IFLA_GENEVE_MAX
 - 1)

	)

574 
	eiÊa_gíeve_df
 {

575 
	mGENEVE_DF_UNSET
 = 0,

576 
	mGENEVE_DF_SET
,

577 
	mGENEVE_DF_INHERIT
,

578 
	m__GENEVE_DF_END
,

579 
	mGENEVE_DF_MAX
 = 
__GENEVE_DF_END
 - 1,

584 
	mIFLA_PPP_UNSPEC
,

585 
	mIFLA_PPP_DEV_FD
,

586 
	m__IFLA_PPP_MAX


588 
	#IFLA_PPP_MAX
 (
__IFLA_PPP_MAX
 - 1)

	)

592 
	eiÊa_gç_rﬁe
 {

593 
	mGTP_ROLE_GGSN
 = 0,

594 
	mGTP_ROLE_SGSN
,

598 
	mIFLA_GTP_UNSPEC
,

599 
	mIFLA_GTP_FD0
,

600 
	mIFLA_GTP_FD1
,

601 
	mIFLA_GTP_PDP_HASHSIZE
,

602 
	mIFLA_GTP_ROLE
,

603 
	m__IFLA_GTP_MAX
,

605 
	#IFLA_GTP_MAX
 (
__IFLA_GTP_MAX
 - 1)

	)

610 
	mIFLA_BOND_UNSPEC
,

611 
	mIFLA_BOND_MODE
,

612 
	mIFLA_BOND_ACTIVE_SLAVE
,

613 
	mIFLA_BOND_MIIMON
,

614 
	mIFLA_BOND_UPDELAY
,

615 
	mIFLA_BOND_DOWNDELAY
,

616 
	mIFLA_BOND_USE_CARRIER
,

617 
	mIFLA_BOND_ARP_INTERVAL
,

618 
	mIFLA_BOND_ARP_IP_TARGET
,

619 
	mIFLA_BOND_ARP_VALIDATE
,

620 
	mIFLA_BOND_ARP_ALL_TARGETS
,

621 
	mIFLA_BOND_PRIMARY
,

622 
	mIFLA_BOND_PRIMARY_RESELECT
,

623 
	mIFLA_BOND_FAIL_OVER_MAC
,

624 
	mIFLA_BOND_XMIT_HASH_POLICY
,

625 
	mIFLA_BOND_RESEND_IGMP
,

626 
	mIFLA_BOND_NUM_PEER_NOTIF
,

627 
	mIFLA_BOND_ALL_SLAVES_ACTIVE
,

628 
	mIFLA_BOND_MIN_LINKS
,

629 
	mIFLA_BOND_LP_INTERVAL
,

630 
	mIFLA_BOND_PACKETS_PER_SLAVE
,

631 
	mIFLA_BOND_AD_LACP_RATE
,

632 
	mIFLA_BOND_AD_SELECT
,

633 
	mIFLA_BOND_AD_INFO
,

634 
	mIFLA_BOND_AD_ACTOR_SYS_PRIO
,

635 
	mIFLA_BOND_AD_USER_PORT_KEY
,

636 
	mIFLA_BOND_AD_ACTOR_SYSTEM
,

637 
	mIFLA_BOND_TLB_DYNAMIC_LB
,

638 
	mIFLA_BOND_PEER_NOTIF_DELAY
,

639 
	m__IFLA_BOND_MAX
,

642 
	#IFLA_BOND_MAX
 (
__IFLA_BOND_MAX
 - 1)

	)

645 
	mIFLA_BOND_AD_INFO_UNSPEC
,

646 
	mIFLA_BOND_AD_INFO_AGGREGATOR
,

647 
	mIFLA_BOND_AD_INFO_NUM_PORTS
,

648 
	mIFLA_BOND_AD_INFO_ACTOR_KEY
,

649 
	mIFLA_BOND_AD_INFO_PARTNER_KEY
,

650 
	mIFLA_BOND_AD_INFO_PARTNER_MAC
,

651 
	m__IFLA_BOND_AD_INFO_MAX
,

654 
	#IFLA_BOND_AD_INFO_MAX
 (
__IFLA_BOND_AD_INFO_MAX
 - 1)

	)

657 
	mIFLA_BOND_SLAVE_UNSPEC
,

658 
	mIFLA_BOND_SLAVE_STATE
,

659 
	mIFLA_BOND_SLAVE_MII_STATUS
,

660 
	mIFLA_BOND_SLAVE_LINK_FAILURE_COUNT
,

661 
	mIFLA_BOND_SLAVE_PERM_HWADDR
,

662 
	mIFLA_BOND_SLAVE_QUEUE_ID
,

663 
	mIFLA_BOND_SLAVE_AD_AGGREGATOR_ID
,

664 
	mIFLA_BOND_SLAVE_AD_ACTOR_OPER_PORT_STATE
,

665 
	mIFLA_BOND_SLAVE_AD_PARTNER_OPER_PORT_STATE
,

666 
	m__IFLA_BOND_SLAVE_MAX
,

669 
	#IFLA_BOND_SLAVE_MAX
 (
__IFLA_BOND_SLAVE_MAX
 - 1)

	)

674 
	mIFLA_VF_INFO_UNSPEC
,

675 
	mIFLA_VF_INFO
,

676 
	m__IFLA_VF_INFO_MAX
,

679 
	#IFLA_VF_INFO_MAX
 (
__IFLA_VF_INFO_MAX
 - 1)

	)

682 
	mIFLA_VF_UNSPEC
,

683 
	mIFLA_VF_MAC
,

684 
	mIFLA_VF_VLAN
,

685 
	mIFLA_VF_TX_RATE
,

686 
	mIFLA_VF_SPOOFCHK
,

687 
	mIFLA_VF_LINK_STATE
,

688 
	mIFLA_VF_RATE
,

689 
	mIFLA_VF_RSS_QUERY_EN
,

692 
	mIFLA_VF_STATS
,

693 
	mIFLA_VF_TRUST
,

694 
	mIFLA_VF_IB_NODE_GUID
,

695 
	mIFLA_VF_IB_PORT_GUID
,

696 
	mIFLA_VF_VLAN_LIST
,

697 
	mIFLA_VF_BROADCAST
,

698 
	m__IFLA_VF_MAX
,

701 
	#IFLA_VF_MAX
 (
__IFLA_VF_MAX
 - 1)

	)

703 
	siÊa_vf_mac
 {

704 
__u32
 
	mvf
;

705 
__u8
 
	mmac
[32];

708 
	siÊa_vf_brﬂdˇ°
 {

709 
__u8
 
	mbrﬂdˇ°
[32];

712 
	siÊa_vf_vœn
 {

713 
__u32
 
	mvf
;

714 
__u32
 
	mvœn
;

715 
__u32
 
	mqos
;

719 
	mIFLA_VF_VLAN_INFO_UNSPEC
,

720 
	mIFLA_VF_VLAN_INFO
,

721 
	m__IFLA_VF_VLAN_INFO_MAX
,

724 
	#IFLA_VF_VLAN_INFO_MAX
 (
__IFLA_VF_VLAN_INFO_MAX
 - 1)

	)

725 
	#MAX_VLAN_LIST_LEN
 1

	)

727 
	siÊa_vf_vœn_öfo
 {

728 
__u32
 
	mvf
;

729 
__u32
 
	mvœn
;

730 
__u32
 
	mqos
;

731 
__be16
 
	mvœn_¥Ÿo
;

734 
	siÊa_vf_tx_øã
 {

735 
__u32
 
	mvf
;

736 
__u32
 
	møã
;

739 
	siÊa_vf_øã
 {

740 
__u32
 
	mvf
;

741 
__u32
 
	mmö_tx_øã
;

742 
__u32
 
	mmax_tx_øã
;

745 
	siÊa_vf_•oofchk
 {

746 
__u32
 
	mvf
;

747 
__u32
 
	m£âög
;

750 
	siÊa_vf_guid
 {

751 
__u32
 
	mvf
;

752 
__u64
 
	mguid
;

756 
	mIFLA_VF_LINK_STATE_AUTO
,

757 
	mIFLA_VF_LINK_STATE_ENABLE
,

758 
	mIFLA_VF_LINK_STATE_DISABLE
,

759 
	m__IFLA_VF_LINK_STATE_MAX
,

762 
	siÊa_vf_lök_°©e
 {

763 
__u32
 
	mvf
;

764 
__u32
 
	mlök_°©e
;

767 
	siÊa_vf_rss_quîy_í
 {

768 
__u32
 
	mvf
;

769 
__u32
 
	m£âög
;

773 
	mIFLA_VF_STATS_RX_PACKETS
,

774 
	mIFLA_VF_STATS_TX_PACKETS
,

775 
	mIFLA_VF_STATS_RX_BYTES
,

776 
	mIFLA_VF_STATS_TX_BYTES
,

777 
	mIFLA_VF_STATS_BROADCAST
,

778 
	mIFLA_VF_STATS_MULTICAST
,

779 
	mIFLA_VF_STATS_PAD
,

780 
	mIFLA_VF_STATS_RX_DROPPED
,

781 
	mIFLA_VF_STATS_TX_DROPPED
,

782 
	m__IFLA_VF_STATS_MAX
,

785 
	#IFLA_VF_STATS_MAX
 (
__IFLA_VF_STATS_MAX
 - 1)

	)

787 
	siÊa_vf_åu°
 {

788 
__u32
 
	mvf
;

789 
__u32
 
	m£âög
;

808 
	mIFLA_VF_PORT_UNSPEC
,

809 
	mIFLA_VF_PORT
,

810 
	m__IFLA_VF_PORT_MAX
,

813 
	#IFLA_VF_PORT_MAX
 (
__IFLA_VF_PORT_MAX
 - 1)

	)

816 
	mIFLA_PORT_UNSPEC
,

817 
	mIFLA_PORT_VF
,

818 
	mIFLA_PORT_PROFILE
,

819 
	mIFLA_PORT_VSI_TYPE
,

820 
	mIFLA_PORT_INSTANCE_UUID
,

821 
	mIFLA_PORT_HOST_UUID
,

822 
	mIFLA_PORT_REQUEST
,

823 
	mIFLA_PORT_RESPONSE
,

824 
	m__IFLA_PORT_MAX
,

827 
	#IFLA_PORT_MAX
 (
__IFLA_PORT_MAX
 - 1)

	)

829 
	#PORT_PROFILE_MAX
 40

	)

830 
	#PORT_UUID_MAX
 16

	)

831 
	#PORT_SELF_VF
 -1

	)

834 
	mPORT_REQUEST_PREASSOCIATE
 = 0,

835 
	mPORT_REQUEST_PREASSOCIATE_RR
,

836 
	mPORT_REQUEST_ASSOCIATE
,

837 
	mPORT_REQUEST_DISASSOCIATE
,

841 
	mPORT_VDP_RESPONSE_SUCCESS
 = 0,

842 
	mPORT_VDP_RESPONSE_INVALID_FORMAT
,

843 
	mPORT_VDP_RESPONSE_INSUFFICIENT_RESOURCES
,

844 
	mPORT_VDP_RESPONSE_UNUSED_VTID
,

845 
	mPORT_VDP_RESPONSE_VTID_VIOLATION
,

846 
	mPORT_VDP_RESPONSE_VTID_VERSION_VIOALTION
,

847 
	mPORT_VDP_RESPONSE_OUT_OF_SYNC
,

849 
	mPORT_PROFILE_RESPONSE_SUCCESS
 = 0x100,

850 
	mPORT_PROFILE_RESPONSE_INPROGRESS
,

851 
	mPORT_PROFILE_RESPONSE_INVALID
,

852 
	mPORT_PROFILE_RESPONSE_BADSTATE
,

853 
	mPORT_PROFILE_RESPONSE_INSUFFICIENT_RESOURCES
,

854 
	mPORT_PROFILE_RESPONSE_ERROR
,

857 
	siÊa_p‹t_vsi
 {

858 
__u8
 
	mvsi_mgr_id
;

859 
__u8
 
	mvsi_ty≥_id
[3];

860 
__u8
 
	mvsi_ty≥_vîsi⁄
;

861 
__u8
 
	m∑d
[3];

868 
	mIFLA_IPOIB_UNSPEC
,

869 
	mIFLA_IPOIB_PKEY
,

870 
	mIFLA_IPOIB_MODE
,

871 
	mIFLA_IPOIB_UMCAST
,

872 
	m__IFLA_IPOIB_MAX


876 
	mIPOIB_MODE_DATAGRAM
 = 0,

877 
	mIPOIB_MODE_CONNECTED
 = 1,

880 
	#IFLA_IPOIB_MAX
 (
__IFLA_IPOIB_MAX
 - 1)

	)

886 
	mIFLA_HSR_UNSPEC
,

887 
	mIFLA_HSR_SLAVE1
,

888 
	mIFLA_HSR_SLAVE2
,

889 
	mIFLA_HSR_MULTICAST_SPEC
,

890 
	mIFLA_HSR_SUPERVISION_ADDR
,

891 
	mIFLA_HSR_SEQ_NR
,

892 
	mIFLA_HSR_VERSION
,

893 
	m__IFLA_HSR_MAX
,

896 
	#IFLA_HSR_MAX
 (
__IFLA_HSR_MAX
 - 1)

	)

900 
	sif_°©s_msg
 {

901 
__u8
 
	mÁmûy
;

902 
__u8
 
	m∑d1
;

903 
__u16
 
	m∑d2
;

904 
__u32
 
	mifödex
;

905 
__u32
 
	mfûãr_mask
;

912 
	mIFLA_STATS_UNSPEC
,

913 
	mIFLA_STATS_LINK_64
,

914 
	mIFLA_STATS_LINK_XSTATS
,

915 
	mIFLA_STATS_LINK_XSTATS_SLAVE
,

916 
	mIFLA_STATS_LINK_OFFLOAD_XSTATS
,

917 
	mIFLA_STATS_AF_SPEC
,

918 
	m__IFLA_STATS_MAX
,

921 
	#IFLA_STATS_MAX
 (
__IFLA_STATS_MAX
 - 1)

	)

923 
	#IFLA_STATS_FILTER_BIT
(
ATTR
Ë(1 << (ATTR - 1))

	)

931 
	mLINK_XSTATS_TYPE_UNSPEC
,

932 
	mLINK_XSTATS_TYPE_BRIDGE
,

933 
	mLINK_XSTATS_TYPE_BOND
,

934 
	m__LINK_XSTATS_TYPE_MAX


936 
	#LINK_XSTATS_TYPE_MAX
 (
__LINK_XSTATS_TYPE_MAX
 - 1)

	)

940 
	mIFLA_OFFLOAD_XSTATS_UNSPEC
,

941 
	mIFLA_OFFLOAD_XSTATS_CPU_HIT
,

942 
	m__IFLA_OFFLOAD_XSTATS_MAX


944 
	#IFLA_OFFLOAD_XSTATS_MAX
 (
__IFLA_OFFLOAD_XSTATS_MAX
 - 1)

	)

948 
	#XDP_FLAGS_UPDATE_IF_NOEXIST
 (1U << 0)

	)

949 
	#XDP_FLAGS_SKB_MODE
 (1U << 1)

	)

950 
	#XDP_FLAGS_DRV_MODE
 (1U << 2)

	)

951 
	#XDP_FLAGS_HW_MODE
 (1U << 3)

	)

952 
	#XDP_FLAGS_MODES
 (
XDP_FLAGS_SKB_MODE
 | \

953 
XDP_FLAGS_DRV_MODE
 | \

954 
XDP_FLAGS_HW_MODE
)

	)

955 
	#XDP_FLAGS_MASK
 (
XDP_FLAGS_UPDATE_IF_NOEXIST
 | \

956 
XDP_FLAGS_MODES
)

	)

960 
	mXDP_ATTACHED_NONE
 = 0,

961 
	mXDP_ATTACHED_DRV
,

962 
	mXDP_ATTACHED_SKB
,

963 
	mXDP_ATTACHED_HW
,

964 
	mXDP_ATTACHED_MULTI
,

968 
	mIFLA_XDP_UNSPEC
,

969 
	mIFLA_XDP_FD
,

970 
	mIFLA_XDP_ATTACHED
,

971 
	mIFLA_XDP_FLAGS
,

972 
	mIFLA_XDP_PROG_ID
,

973 
	mIFLA_XDP_DRV_PROG_ID
,

974 
	mIFLA_XDP_SKB_PROG_ID
,

975 
	mIFLA_XDP_HW_PROG_ID
,

976 
	m__IFLA_XDP_MAX
,

979 
	#IFLA_XDP_MAX
 (
__IFLA_XDP_MAX
 - 1)

	)

982 
	mIFLA_EVENT_NONE
,

983 
	mIFLA_EVENT_REBOOT
,

984 
	mIFLA_EVENT_FEATURES
,

985 
	mIFLA_EVENT_BONDING_FAILOVER
,

986 
	mIFLA_EVENT_NOTIFY_PEERS
,

987 
	mIFLA_EVENT_IGMP_RESEND
,

988 
	mIFLA_EVENT_BONDING_OPTIONS
,

994 
	mIFLA_TUN_UNSPEC
,

995 
	mIFLA_TUN_OWNER
,

996 
	mIFLA_TUN_GROUP
,

997 
	mIFLA_TUN_TYPE
,

998 
	mIFLA_TUN_PI
,

999 
	mIFLA_TUN_VNET_HDR
,

1000 
	mIFLA_TUN_PERSIST
,

1001 
	mIFLA_TUN_MULTI_QUEUE
,

1002 
	mIFLA_TUN_NUM_QUEUES
,

1003 
	mIFLA_TUN_NUM_DISABLED_QUEUES
,

1004 
	m__IFLA_TUN_MAX
,

1007 
	#IFLA_TUN_MAX
 (
__IFLA_TUN_MAX
 - 1)

	)

1011 
	#RMNET_FLAGS_INGRESS_DEAGGREGATION
 (1U << 0)

	)

1012 
	#RMNET_FLAGS_INGRESS_MAP_COMMANDS
 (1U << 1)

	)

1013 
	#RMNET_FLAGS_INGRESS_MAP_CKSUMV4
 (1U << 2)

	)

1014 
	#RMNET_FLAGS_EGRESS_MAP_CKSUMV4
 (1U << 3)

	)

1017 
	mIFLA_RMNET_UNSPEC
,

1018 
	mIFLA_RMNET_MUX_ID
,

1019 
	mIFLA_RMNET_FLAGS
,

1020 
	m__IFLA_RMNET_MAX
,

1023 
	#IFLA_RMNET_MAX
 (
__IFLA_RMNET_MAX
 - 1)

	)

1025 
	siÊa_rm√t_Êags
 {

1026 
__u32
 
	mÊags
;

1027 
__u32
 
	mmask
;

	@/usr/include/linux/if_packet.h

2 #i‚de‡
__LINUX_IF_PACKET_H


3 
	#__LINUX_IF_PACKET_H


	)

5 
	~<löux/ty≥s.h
>

7 
	ssockaddr_pkt
 {

8 
	m•kt_Ámûy
;

9 
	m•kt_devi˚
[14];

10 
__be16
 
	m•kt_¥Ÿocﬁ
;

13 
	ssockaddr_Œ
 {

14 
	m¶l_Ámûy
;

15 
__be16
 
	m¶l_¥Ÿocﬁ
;

16 
	m¶l_ifödex
;

17 
	m¶l_h©y≥
;

18 
	m¶l_pkây≥
;

19 
	m¶l_hÆí
;

20 
	m¶l_addr
[8];

25 
	#PACKET_HOST
 0

	)

26 
	#PACKET_BROADCAST
 1

	)

27 
	#PACKET_MULTICAST
 2

	)

28 
	#PACKET_OTHERHOST
 3

	)

29 
	#PACKET_OUTGOING
 4

	)

30 
	#PACKET_LOOPBACK
 5

	)

31 
	#PACKET_USER
 6

	)

32 
	#PACKET_KERNEL
 7

	)

34 
	#PACKET_FASTROUTE
 6

	)

38 
	#PACKET_ADD_MEMBERSHIP
 1

	)

39 
	#PACKET_DROP_MEMBERSHIP
 2

	)

40 
	#PACKET_RECV_OUTPUT
 3

	)

42 
	#PACKET_RX_RING
 5

	)

43 
	#PACKET_STATISTICS
 6

	)

44 
	#PACKET_COPY_THRESH
 7

	)

45 
	#PACKET_AUXDATA
 8

	)

46 
	#PACKET_ORIGDEV
 9

	)

47 
	#PACKET_VERSION
 10

	)

48 
	#PACKET_HDRLEN
 11

	)

49 
	#PACKET_RESERVE
 12

	)

50 
	#PACKET_TX_RING
 13

	)

51 
	#PACKET_LOSS
 14

	)

52 
	#PACKET_VNET_HDR
 15

	)

53 
	#PACKET_TX_TIMESTAMP
 16

	)

54 
	#PACKET_TIMESTAMP
 17

	)

55 
	#PACKET_FANOUT
 18

	)

56 
	#PACKET_TX_HAS_OFF
 19

	)

57 
	#PACKET_QDISC_BYPASS
 20

	)

58 
	#PACKET_ROLLOVER_STATS
 21

	)

59 
	#PACKET_FANOUT_DATA
 22

	)

60 
	#PACKET_IGNORE_OUTGOING
 23

	)

62 
	#PACKET_FANOUT_HASH
 0

	)

63 
	#PACKET_FANOUT_LB
 1

	)

64 
	#PACKET_FANOUT_CPU
 2

	)

65 
	#PACKET_FANOUT_ROLLOVER
 3

	)

66 
	#PACKET_FANOUT_RND
 4

	)

67 
	#PACKET_FANOUT_QM
 5

	)

68 
	#PACKET_FANOUT_CBPF
 6

	)

69 
	#PACKET_FANOUT_EBPF
 7

	)

70 
	#PACKET_FANOUT_FLAG_ROLLOVER
 0x1000

	)

71 
	#PACKET_FANOUT_FLAG_UNIQUEID
 0x2000

	)

72 
	#PACKET_FANOUT_FLAG_DEFRAG
 0x8000

	)

74 
	sçackë_°©s
 {

75 
	mç_∑ckës
;

76 
	mç_dr›s
;

79 
	sçackë_°©s_v3
 {

80 
	mç_∑ckës
;

81 
	mç_dr›s
;

82 
	mç_‰ìze_q_˙t
;

85 
	sçackë_rﬁlovî_°©s
 {

86 
__Æig√d_u64
 
	mç_Æl
;

87 
__Æig√d_u64
 
	mç_huge
;

88 
__Æig√d_u64
 
	mç_Áûed
;

91 
	uçackë_°©s_u
 {

92 
çackë_°©s
 
	m°©s1
;

93 
çackë_°©s_v3
 
	m°©s3
;

96 
	sçackë_auxd©a
 {

97 
__u32
 
	mç_°©us
;

98 
__u32
 
	mç_Àn
;

99 
__u32
 
	mç_¢≠Àn
;

100 
__u16
 
	mç_mac
;

101 
__u16
 
	mç_√t
;

102 
__u16
 
	mç_vœn_tci
;

103 
__u16
 
	mç_vœn_çid
;

107 
	#TP_STATUS_KERNEL
 0

	)

108 
	#TP_STATUS_USER
 (1 << 0)

	)

109 
	#TP_STATUS_COPY
 (1 << 1)

	)

110 
	#TP_STATUS_LOSING
 (1 << 2)

	)

111 
	#TP_STATUS_CSUMNOTREADY
 (1 << 3)

	)

112 
	#TP_STATUS_VLAN_VALID
 (1 << 4Ë

	)

113 
	#TP_STATUS_BLK_TMO
 (1 << 5)

	)

114 
	#TP_STATUS_VLAN_TPID_VALID
 (1 << 6Ë

	)

115 
	#TP_STATUS_CSUM_VALID
 (1 << 7)

	)

118 
	#TP_STATUS_AVAILABLE
 0

	)

119 
	#TP_STATUS_SEND_REQUEST
 (1 << 0)

	)

120 
	#TP_STATUS_SENDING
 (1 << 1)

	)

121 
	#TP_STATUS_WRONG_FORMAT
 (1 << 2)

	)

124 
	#TP_STATUS_TS_SOFTWARE
 (1 << 29)

	)

125 
	#TP_STATUS_TS_SYS_HARDWARE
 (1 << 30Ë

	)

126 
	#TP_STATUS_TS_RAW_HARDWARE
 (1U << 31)

	)

129 
	#TP_FT_REQ_FILL_RXHASH
 0x1

	)

131 
	sçackë_hdr
 {

132 
	mç_°©us
;

133 
	mç_Àn
;

134 
	mç_¢≠Àn
;

135 
	mç_mac
;

136 
	mç_√t
;

137 
	mç_£c
;

138 
	mç_u£c
;

141 
	#TPACKET_ALIGNMENT
 16

	)

142 
	#TPACKET_ALIGN
(
x
Ë(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

143 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë_hdr
)Ë+ (
sockaddr_Œ
))

	)

145 
	sçackë2_hdr
 {

146 
__u32
 
	mç_°©us
;

147 
__u32
 
	mç_Àn
;

148 
__u32
 
	mç_¢≠Àn
;

149 
__u16
 
	mç_mac
;

150 
__u16
 
	mç_√t
;

151 
__u32
 
	mç_£c
;

152 
__u32
 
	mç_n£c
;

153 
__u16
 
	mç_vœn_tci
;

154 
__u16
 
	mç_vœn_çid
;

155 
__u8
 
	mç_∑ddög
[4];

158 
	sçackë_hdr_v¨ü¡1
 {

159 
__u32
 
	mç_rxhash
;

160 
__u32
 
	mç_vœn_tci
;

161 
__u16
 
	mç_vœn_çid
;

162 
__u16
 
	mç_∑ddög
;

165 
	sçackë3_hdr
 {

166 
__u32
 
	mç_√xt_off£t
;

167 
__u32
 
	mç_£c
;

168 
__u32
 
	mç_n£c
;

169 
__u32
 
	mç_¢≠Àn
;

170 
__u32
 
	mç_Àn
;

171 
__u32
 
	mç_°©us
;

172 
__u16
 
	mç_mac
;

173 
__u16
 
	mç_√t
;

176 
çackë_hdr_v¨ü¡1
 
	mhv1
;

178 
__u8
 
	mç_∑ddög
[8];

181 
	sçackë_bd_ts
 {

182 
	mts_£c
;

184 
	mts_u£c
;

185 
	mts_n£c
;

189 
	sçackë_hdr_v1
 {

190 
__u32
 
	mblock_°©us
;

191 
__u32
 
	mnum_pkts
;

192 
__u32
 
	moff£t_to_fú°_pkt
;

197 
__u32
 
	mblk_Àn
;

208 
__Æig√d_u64
 
	m£q_num
;

235 
çackë_bd_ts
 
	mts_fú°_pkt
, 
	mts_œ°_pkt
;

238 
	uçackë_bd_hódî_u
 {

239 
çackë_hdr_v1
 
	mbh1
;

242 
	sçackë_block_desc
 {

243 
__u32
 
	mvîsi⁄
;

244 
__u32
 
	moff£t_to_¥iv
;

245 
çackë_bd_hódî_u
 
	mhdr
;

248 
	#TPACKET2_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë2_hdr
)Ë+ (
sockaddr_Œ
))

	)

249 
	#TPACKET3_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë3_hdr
)Ë+ (
sockaddr_Œ
))

	)

251 
	eçackë_vîsi⁄s
 {

252 
	mTPACKET_V1
,

253 
	mTPACKET_V2
,

254 
	mTPACKET_V3


270 
	sçackë_ªq
 {

271 
	mç_block_size
;

272 
	mç_block_ƒ
;

273 
	mç_‰ame_size
;

274 
	mç_‰ame_ƒ
;

277 
	sçackë_ªq3
 {

278 
	mç_block_size
;

279 
	mç_block_ƒ
;

280 
	mç_‰ame_size
;

281 
	mç_‰ame_ƒ
;

282 
	mç_ªtúe_blk_tov
;

283 
	mç_sizeof_¥iv
;

284 
	mç_„©uª_ªq_w‹d
;

287 
	uçackë_ªq_u
 {

288 
çackë_ªq
 
	mªq
;

289 
çackë_ªq3
 
	mªq3
;

292 
	s∑ckë_mªq
 {

293 
	mmr_ifödex
;

294 
	mmr_ty≥
;

295 
	mmr_Æí
;

296 
	mmr_addªss
[8];

299 
	#PACKET_MR_MULTICAST
 0

	)

300 
	#PACKET_MR_PROMISC
 1

	)

301 
	#PACKET_MR_ALLMULTI
 2

	)

302 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/linux/irqnr.h

	@/usr/include/linux/mount.h

1 #i‚de‡
_LINUX_MOUNT_H


2 
	#_LINUX_MOUNT_H


	)

11 
	#MS_RDONLY
 1

	)

12 
	#MS_NOSUID
 2

	)

13 
	#MS_NODEV
 4

	)

14 
	#MS_NOEXEC
 8

	)

15 
	#MS_SYNCHRONOUS
 16

	)

16 
	#MS_REMOUNT
 32

	)

17 
	#MS_MANDLOCK
 64

	)

18 
	#MS_DIRSYNC
 128

	)

19 
	#MS_NOATIME
 1024

	)

20 
	#MS_NODIRATIME
 2048

	)

21 
	#MS_BIND
 4096

	)

22 
	#MS_MOVE
 8192

	)

23 
	#MS_REC
 16384

	)

24 
	#MS_VERBOSE
 32768

	)

26 
	#MS_SILENT
 32768

	)

27 
	#MS_POSIXACL
 (1<<16Ë

	)

28 
	#MS_UNBINDABLE
 (1<<17Ë

	)

29 
	#MS_PRIVATE
 (1<<18Ë

	)

30 
	#MS_SLAVE
 (1<<19Ë

	)

31 
	#MS_SHARED
 (1<<20Ë

	)

32 
	#MS_RELATIME
 (1<<21Ë

	)

33 
	#MS_KERNMOUNT
 (1<<22Ë

	)

34 
	#MS_I_VERSION
 (1<<23Ë

	)

35 
	#MS_STRICTATIME
 (1<<24Ë

	)

36 
	#MS_LAZYTIME
 (1<<25Ë

	)

39 
	#MS_SUBMOUNT
 (1<<26)

	)

40 
	#MS_NOREMOTELOCK
 (1<<27)

	)

41 
	#MS_NOSEC
 (1<<28)

	)

42 
	#MS_BORN
 (1<<29)

	)

43 
	#MS_ACTIVE
 (1<<30)

	)

44 
	#MS_NOUSER
 (1<<31)

	)

49 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
|
MS_I_VERSION
|\

50 
MS_LAZYTIME
)

	)

55 
	#MS_MGC_VAL
 0xC0ED0000

	)

56 
	#MS_MGC_MSK
 0xffff0000

	)

61 
	#OPEN_TREE_CLONE
 1

	)

62 
	#OPEN_TREE_CLOEXEC
 
O_CLOEXEC


	)

67 
	#MOVE_MOUNT_F_SYMLINKS
 0x00000001

	)

68 
	#MOVE_MOUNT_F_AUTOMOUNTS
 0x00000002

	)

69 
	#MOVE_MOUNT_F_EMPTY_PATH
 0x00000004

	)

70 
	#MOVE_MOUNT_T_SYMLINKS
 0x00000010

	)

71 
	#MOVE_MOUNT_T_AUTOMOUNTS
 0x00000020

	)

72 
	#MOVE_MOUNT_T_EMPTY_PATH
 0x00000040

	)

73 
	#MOVE_MOUNT__MASK
 0x00000077

	)

78 
	#FSOPEN_CLOEXEC
 0x00000001

	)

83 
	#FSPICK_CLOEXEC
 0x00000001

	)

84 
	#FSPICK_SYMLINK_NOFOLLOW
 0x00000002

	)

85 
	#FSPICK_NO_AUTOMOUNT
 0x00000004

	)

86 
	#FSPICK_EMPTY_PATH
 0x00000008

	)

91 
	efsc⁄fig_comm™d
 {

92 
	mFSCONFIG_SET_FLAG
 = 0,

93 
	mFSCONFIG_SET_STRING
 = 1,

94 
	mFSCONFIG_SET_BINARY
 = 2,

95 
	mFSCONFIG_SET_PATH
 = 3,

96 
	mFSCONFIG_SET_PATH_EMPTY
 = 4,

97 
	mFSCONFIG_SET_FD
 = 5,

98 
	mFSCONFIG_CMD_CREATE
 = 6,

99 
	mFSCONFIG_CMD_RECONFIGURE
 = 7,

105 
	#FSMOUNT_CLOEXEC
 0x00000001

	)

110 
	#MOUNT_ATTR_RDONLY
 0x00000001

	)

111 
	#MOUNT_ATTR_NOSUID
 0x00000002

	)

112 
	#MOUNT_ATTR_NODEV
 0x00000004

	)

113 
	#MOUNT_ATTR_NOEXEC
 0x00000008

	)

114 
	#MOUNT_ATTR__ATIME
 0x00000070

	)

115 
	#MOUNT_ATTR_RELATIME
 0x00000000

	)

116 
	#MOUNT_ATTR_NOATIME
 0x00000010

	)

117 
	#MOUNT_ATTR_STRICTATIME
 0x00000020

	)

118 
	#MOUNT_ATTR_NODIRATIME
 0x00000080

	)

	@/usr/include/linux/posix_types.h

2 #i‚de‡
_LINUX_POSIX_TYPES_H


3 
	#_LINUX_POSIX_TYPES_H


	)

5 
	~<löux/°ddef.h
>

22 #unde‡
__FD_SETSIZE


23 
	#__FD_SETSIZE
 1024

	)

26 
	mfds_bôs
[
__FD_SETSIZE
 / (8 * ())];

27 } 
	t__kî√l_fd_£t
;

30 (*
	t__kî√l_sigh™dÀr_t
)();

33 
	t__kî√l_key_t
;

34 
	t__kî√l_mqd_t
;

36 
	~<asm/posix_ty≥s.h
>

	@/usr/include/linux/socket.h

2 #i‚de‡
_LINUX_SOCKET_H


3 
	#_LINUX_SOCKET_H


	)

8 
	#_K_SS_MAXSIZE
 128

	)

10 
	t__kî√l_ß_Ámûy_t
;

16 
	s__kî√l_sockaddr_°‹age
 {

19 
__kî√l_ß_Ámûy_t
 
	mss_Ámûy
;

21 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

25 *
	m__Æign
;

	@/usr/include/linux/sysinfo.h

2 #i‚de‡
_LINUX_SYSINFO_H


3 
	#_LINUX_SYSINFO_H


	)

5 
	~<löux/ty≥s.h
>

7 
	#SI_LOAD_SHIFT
 16

	)

8 
	ssysöfo
 {

9 
__kî√l_l⁄g_t
 
	mu±ime
;

10 
__kî√l_ul⁄g_t
 
	mlﬂds
[3];

11 
__kî√l_ul⁄g_t
 
	mtŸÆøm
;

12 
__kî√l_ul⁄g_t
 
	m‰ìøm
;

13 
__kî√l_ul⁄g_t
 
	msh¨edøm
;

14 
__kî√l_ul⁄g_t
 
	mbuf„ºam
;

15 
__kî√l_ul⁄g_t
 
	mtŸÆsw≠
;

16 
__kî√l_ul⁄g_t
 
	m‰ìsw≠
;

17 
__u16
 
	m¥ocs
;

18 
__u16
 
	m∑d
;

19 
__kî√l_ul⁄g_t
 
	mtŸÆhigh
;

20 
__kî√l_ul⁄g_t
 
	m‰ìhigh
;

21 
__u32
 
	mmem_unô
;

22 
	m_f
[20-2*(
__kî√l_ul⁄g_t
)-(
__u32
)];

	@/usr/include/rpc/netdb.h

36 #i‚de‡
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<„©uªs.h
>

41 
	#__√ed_size_t


	)

42 
	~<°ddef.h
>

44 
__BEGIN_DECLS


46 
	sΩ˚¡


48 *
	mr_«me
;

49 **
	mr_Æü£s
;

50 
	mr_numbî
;

53 
	$£åp˚¡
 (
__°ay›í
Ë
__THROW
;

54 
	$ídΩ˚¡
 (Ë
__THROW
;

55 
Ω˚¡
 *
	$gëΩcby«me
 (c⁄° *
__«me
Ë
__THROW
;

56 
Ω˚¡
 *
	$gëΩcbynumbî
 (
__numbî
Ë
__THROW
;

57 
Ω˚¡
 *
	$gëΩ˚¡
 (Ë
__THROW
;

59 #ifde‡
__USE_MISC


60 
	$gëΩcby«me_r
 (c⁄° *
__«me
, 
Ω˚¡
 *
__ªsu…_buf
,

61 *
__buf„r
, 
size_t
 
__buÊí
,

62 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

64 
	$gëΩcbynumbî_r
 (
__numbî
, 
Ω˚¡
 *
__ªsu…_buf
,

65 *
__buf„r
, 
size_t
 
__buÊí
,

66 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

68 
	$gëΩ˚¡_r
 (
Ω˚¡
 *
__ªsu…_buf
, *
__buf„r
,

69 
size_t
 
__buÊí
, 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

72 
__END_DECLS


	@/usr/include/linux/hdlc/ioctl.h

2 #i‚de‡
__HDLC_IOCTL_H__


3 
	#__HDLC_IOCTL_H__


	)

6 
	#GENERIC_HDLC_VERSION
 4

	)

8 
	#CLOCK_DEFAULT
 0

	)

9 
	#CLOCK_EXT
 1

	)

10 
	#CLOCK_INT
 2

	)

11 
	#CLOCK_TXINT
 3

	)

12 
	#CLOCK_TXFROMRX
 4

	)

15 
	#ENCODING_DEFAULT
 0

	)

16 
	#ENCODING_NRZ
 1

	)

17 
	#ENCODING_NRZI
 2

	)

18 
	#ENCODING_FM_MARK
 3

	)

19 
	#ENCODING_FM_SPACE
 4

	)

20 
	#ENCODING_MANCHESTER
 5

	)

23 
	#PARITY_DEFAULT
 0

	)

24 
	#PARITY_NONE
 1

	)

25 
	#PARITY_CRC16_PR0
 2

	)

26 
	#PARITY_CRC16_PR1
 3

	)

27 
	#PARITY_CRC16_PR0_CCITT
 4

	)

28 
	#PARITY_CRC16_PR1_CCITT
 5

	)

29 
	#PARITY_CRC32_PR0_CCITT
 6

	)

30 
	#PARITY_CRC32_PR1_CCITT
 7

	)

32 
	#LMI_DEFAULT
 0

	)

33 
	#LMI_NONE
 1

	)

34 
	#LMI_ANSI
 2

	)

35 
	#LMI_CCITT
 3

	)

36 
	#LMI_CISCO
 4

	)

38 #i‚de‡
__ASSEMBLY__


41 
	m˛ock_øã
;

42 
	m˛ock_ty≥
;

43 
	mlo›back
;

44 } 
	tsync_£rül_£âögs
;

47 
	m˛ock_øã
;

48 
	m˛ock_ty≥
;

49 
	mlo›back
;

50 
	m¶Ÿ_m≠
;

51 } 
	tã1_£âögs
;

54 
	mícodög
;

55 
	m∑rôy
;

56 } 
	tøw_hdlc_¥Ÿo
;

59 
	mt391
;

60 
	mt392
;

61 
	mn391
;

62 
	mn392
;

63 
	mn393
;

64 
	mlmi
;

65 
	md˚
;

66 } 
	t‰_¥Ÿo
;

69 
	mdlci
;

70 } 
	t‰_¥Ÿo_pvc
;

73 
	mdlci
;

74 
	mma°î
[
IFNAMSIZ
];

75 }
	t‰_¥Ÿo_pvc_öfo
;

78 
	möãrvÆ
;

79 
	mtimeout
;

80 } 
	tcisco_¥Ÿo
;

	@/usr/include/linux/libc-compat.h

49 #i‚de‡
_LIBC_COMPAT_H


50 
	#_LIBC_COMPAT_H


	)

53 #i‡
deföed
(
__GLIBC__
)

56 #i‡
deföed
(
_NET_IF_H
Ë&& deföed(
__USE_MISC
)

61 
	#__UAPI_DEF_IF_IFCONF
 0

	)

62 
	#__UAPI_DEF_IF_IFMAP
 0

	)

63 
	#__UAPI_DEF_IF_IFNAMSIZ
 0

	)

64 
	#__UAPI_DEF_IF_IFREQ
 0

	)

66 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 0

	)

68 #i‚de‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


69 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

78 
	#__UAPI_DEF_IF_IFCONF
 1

	)

79 
	#__UAPI_DEF_IF_IFMAP
 1

	)

80 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

81 
	#__UAPI_DEF_IF_IFREQ
 1

	)

83 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

85 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

90 #i‡
deföed
(
_NETINET_IN_H
)

94 
	#__UAPI_DEF_IN_ADDR
 0

	)

95 
	#__UAPI_DEF_IN_IPPROTO
 0

	)

96 
	#__UAPI_DEF_IN_PKTINFO
 0

	)

97 
	#__UAPI_DEF_IP_MREQ
 0

	)

98 
	#__UAPI_DEF_SOCKADDR_IN
 0

	)

99 
	#__UAPI_DEF_IN_CLASS
 0

	)

101 
	#__UAPI_DEF_IN6_ADDR
 0

	)

106 #i‡
deföed
(
__USE_MISC
Ë|| deföed (
__USE_GNU
)

107 
	#__UAPI_DEF_IN6_ADDR_ALT
 0

	)

109 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

111 
	#__UAPI_DEF_SOCKADDR_IN6
 0

	)

112 
	#__UAPI_DEF_IPV6_MREQ
 0

	)

113 
	#__UAPI_DEF_IPPROTO_V6
 0

	)

114 
	#__UAPI_DEF_IPV6_OPTIONS
 0

	)

115 
	#__UAPI_DEF_IN6_PKTINFO
 0

	)

116 
	#__UAPI_DEF_IP6_MTUINFO
 0

	)

123 
	#__UAPI_DEF_IN_ADDR
 1

	)

124 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

125 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

126 
	#__UAPI_DEF_IP_MREQ
 1

	)

127 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

128 
	#__UAPI_DEF_IN_CLASS
 1

	)

130 
	#__UAPI_DEF_IN6_ADDR
 1

	)

133 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

134 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

135 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

136 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

137 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

138 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

139 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

144 #i‡
deföed
(
__NETIPX_IPX_H
)

146 
	#__UAPI_DEF_SOCKADDR_IPX
 0

	)

147 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 0

	)

148 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 0

	)

149 
	#__UAPI_DEF_IPX_CONFIG_DATA
 0

	)

150 
	#__UAPI_DEF_IPX_ROUTE_DEF
 0

	)

154 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

155 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

156 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

157 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

158 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

163 #i‡
deföed
(
_SYS_XATTR_H
)

164 
	#__UAPI_DEF_XATTR
 0

	)

166 
	#__UAPI_DEF_XATTR
 1

	)

176 #i‚de‡
__UAPI_DEF_IF_IFCONF


177 
	#__UAPI_DEF_IF_IFCONF
 1

	)

179 #i‚de‡
__UAPI_DEF_IF_IFMAP


180 
	#__UAPI_DEF_IF_IFMAP
 1

	)

182 #i‚de‡
__UAPI_DEF_IF_IFNAMSIZ


183 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

185 #i‚de‡
__UAPI_DEF_IF_IFREQ


186 
	#__UAPI_DEF_IF_IFREQ
 1

	)

189 #i‚de‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS


190 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

193 #i‚de‡
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


194 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

198 #i‚de‡
__UAPI_DEF_IN_ADDR


199 
	#__UAPI_DEF_IN_ADDR
 1

	)

201 #i‚de‡
__UAPI_DEF_IN_IPPROTO


202 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

204 #i‚de‡
__UAPI_DEF_IN_PKTINFO


205 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

207 #i‚de‡
__UAPI_DEF_IP_MREQ


208 
	#__UAPI_DEF_IP_MREQ
 1

	)

210 #i‚de‡
__UAPI_DEF_SOCKADDR_IN


211 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

213 #i‚de‡
__UAPI_DEF_IN_CLASS


214 
	#__UAPI_DEF_IN_CLASS
 1

	)

218 #i‚de‡
__UAPI_DEF_IN6_ADDR


219 
	#__UAPI_DEF_IN6_ADDR
 1

	)

221 #i‚de‡
__UAPI_DEF_IN6_ADDR_ALT


222 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

224 #i‚de‡
__UAPI_DEF_SOCKADDR_IN6


225 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

227 #i‚de‡
__UAPI_DEF_IPV6_MREQ


228 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

230 #i‚de‡
__UAPI_DEF_IPPROTO_V6


231 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

233 #i‚de‡
__UAPI_DEF_IPV6_OPTIONS


234 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

236 #i‚de‡
__UAPI_DEF_IN6_PKTINFO


237 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

239 #i‚de‡
__UAPI_DEF_IP6_MTUINFO


240 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

244 #i‚de‡
__UAPI_DEF_SOCKADDR_IPX


245 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

247 #i‚de‡
__UAPI_DEF_IPX_ROUTE_DEFINITION


248 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

250 #i‚de‡
__UAPI_DEF_IPX_INTERFACE_DEFINITION


251 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

253 #i‚de‡
__UAPI_DEF_IPX_CONFIG_DATA


254 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

256 #i‚de‡
__UAPI_DEF_IPX_ROUTE_DEF


257 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

261 #i‚de‡
__UAPI_DEF_XATTR


262 
	#__UAPI_DEF_XATTR
 1

	)

	@/usr/include/linux/stddef.h

4 #i‚de‡
__Æways_ölöe


5 
	#__Æways_ölöe
 
__ölöe__


	)

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifde‡
__GCC_IEC_559_COMPLEX


45 #i‡
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

58 
	#__STDC_ISO_10646__
 201706L

	)

	@
1
.
1
/usr/include
593
35823
Books/Hands-on-System-Programming-with-Linux/A_fileio/fork_printf_1.c
Books/Hands-on-System-Programming-with-Linux/A_fileio/fork_printf_2.c
Books/Hands-on-System-Programming-with-Linux/A_fileio/io_setbuf.c
Books/Hands-on-System-Programming-with-Linux/A_fileio/iobuf.c
Books/Hands-on-System-Programming-with-Linux/A_fileio/mode_def.c
Books/Hands-on-System-Programming-with-Linux/A_fileio/redirct.c
Books/Hands-on-System-Programming-with-Linux/A_fileio/simpcp1.c
Books/Hands-on-System-Programming-with-Linux/A_fileio/simpcp2.c
Books/Hands-on-System-Programming-with-Linux/A_fileio/streamio1.c
Books/Hands-on-System-Programming-with-Linux/B_daemon/daemon_trad.c
Books/Hands-on-System-Programming-with-Linux/ch1/getreg.c
Books/Hands-on-System-Programming-with-Linux/ch1/getreg_cr0.c
Books/Hands-on-System-Programming-with-Linux/ch1/getreg_cr3.c
Books/Hands-on-System-Programming-with-Linux/ch1/getreg_rcx.c
Books/Hands-on-System-Programming-with-Linux/ch1/hello.c
Books/Hands-on-System-Programming-with-Linux/ch1/helloworld.c
Books/Hands-on-System-Programming-with-Linux/ch10/fork1.c
Books/Hands-on-System-Programming-with-Linux/ch10/fork2.c
Books/Hands-on-System-Programming-with-Linux/ch10/fork3.c
Books/Hands-on-System-Programming-with-Linux/ch10/fork4.c
Books/Hands-on-System-Programming-with-Linux/ch10/fork4_prnum.c
Books/Hands-on-System-Programming-with-Linux/ch10/fork5.c
Books/Hands-on-System-Programming-with-Linux/ch10/fork_malloc_test.c
Books/Hands-on-System-Programming-with-Linux/ch10/fork_r6_of.c
Books/Hands-on-System-Programming-with-Linux/ch10/simpsh_v1.c
Books/Hands-on-System-Programming-with-Linux/ch10/simpsh_v2.c
Books/Hands-on-System-Programming-with-Linux/ch10/simpsh_v3.c
Books/Hands-on-System-Programming-with-Linux/ch11/altstack.c
Books/Hands-on-System-Programming-with-Linux/ch11/defer_or_not.c
Books/Hands-on-System-Programming-with-Linux/ch11/query_mask.c
Books/Hands-on-System-Programming-with-Linux/ch11/sig1.c
Books/Hands-on-System-Programming-with-Linux/ch11/sig2.c
Books/Hands-on-System-Programming-with-Linux/ch11/zombies_clear_linux26.c
Books/Hands-on-System-Programming-with-Linux/ch12/handle_segv.c
Books/Hands-on-System-Programming-with-Linux/ch12/rtsigs_waiter.c
Books/Hands-on-System-Programming-with-Linux/ch12/sigq_ipc/sigq_recv.c
Books/Hands-on-System-Programming-with-Linux/ch12/sigq_ipc/sigq_sender.c
Books/Hands-on-System-Programming-with-Linux/ch12/sigwt/sigwt.c
Books/Hands-on-System-Programming-with-Linux/ch12/sleeping_beauty.c
Books/Hands-on-System-Programming-with-Linux/ch13/alarm1.c
Books/Hands-on-System-Programming-with-Linux/ch13/alarm2_rep.c
Books/Hands-on-System-Programming-with-Linux/ch13/intv_clksimple.c
Books/Hands-on-System-Programming-with-Linux/ch13/react.c
Books/Hands-on-System-Programming-with-Linux/ch13/runwalk_timer.c
Books/Hands-on-System-Programming-with-Linux/ch14/cr8_so_many_threads.c
Books/Hands-on-System-Programming-with-Linux/ch14/disp_defattr_pthread.c
Books/Hands-on-System-Programming-with-Linux/ch14/param_passing/pthreads1_wrong.c
Books/Hands-on-System-Programming-with-Linux/ch14/param_passing/struct_as_param.c
Books/Hands-on-System-Programming-with-Linux/ch14/pthreads1.c
Books/Hands-on-System-Programming-with-Linux/ch14/pthreads2.c
Books/Hands-on-System-Programming-with-Linux/ch14/pthreads3.c
Books/Hands-on-System-Programming-with-Linux/ch14/pthreads_joiner1.c
Books/Hands-on-System-Programming-with-Linux/ch14/pthreads_joiner2.c
Books/Hands-on-System-Programming-with-Linux/ch14/speed_multiprcs_vs_multithrd_simple/create_destroy/fork_test.c
Books/Hands-on-System-Programming-with-Linux/ch14/speed_multiprcs_vs_multithrd_simple/create_destroy/pthread_test.c
Books/Hands-on-System-Programming-with-Linux/ch14/speed_multiprcs_vs_multithrd_simple/matrixmul/prcs_matrixmul.c
Books/Hands-on-System-Programming-with-Linux/ch14/speed_multiprcs_vs_multithrd_simple/matrixmul/thrd_matrixmul.c
Books/Hands-on-System-Programming-with-Linux/ch14/stack_test.c
Books/Hands-on-System-Programming-with-Linux/ch15/cv_simple.c
Books/Hands-on-System-Programming-with-Linux/ch15/facto.c
Books/Hands-on-System-Programming-with-Linux/ch15/mutex1.c
Books/Hands-on-System-Programming-with-Linux/ch15/pshared_mutex_demo.c
Books/Hands-on-System-Programming-with-Linux/ch16/cancelit.c
Books/Hands-on-System-Programming-with-Linux/ch16/cleanup_hdlr.c
Books/Hands-on-System-Programming-with-Linux/ch16/mt_iobuf_mtx.c
Books/Hands-on-System-Programming-with-Linux/ch16/mt_iobuf_rfct.c
Books/Hands-on-System-Programming-with-Linux/ch16/mt_iobuf_tls.c
Books/Hands-on-System-Programming-with-Linux/ch16/pthreads_app_template.c
Books/Hands-on-System-Programming-with-Linux/ch16/tsig.c
Books/Hands-on-System-Programming-with-Linux/ch17/sched_rt_eg.c
Books/Hands-on-System-Programming-with-Linux/ch18/diskspc.c
Books/Hands-on-System-Programming-with-Linux/ch18/mmap_file_simple.c
Books/Hands-on-System-Programming-with-Linux/ch18/sgio_simple.c
Books/Hands-on-System-Programming-with-Linux/ch2/mem_app1buggy.c
Books/Hands-on-System-Programming-with-Linux/ch2/stacker.c
Books/Hands-on-System-Programming-with-Linux/ch3/rlimit_primes.c
Books/Hands-on-System-Programming-with-Linux/ch3/rlimits_show.c
Books/Hands-on-System-Programming-with-Linux/ch4/alloca_try.c
Books/Hands-on-System-Programming-with-Linux/ch4/malloc_brk_test.c
Books/Hands-on-System-Programming-with-Linux/ch4/mallocmax.c
Books/Hands-on-System-Programming-with-Linux/ch4/memprot.c
Books/Hands-on-System-Programming-with-Linux/ch4/memprot_arm.c
Books/Hands-on-System-Programming-with-Linux/ch4/mlock_try.c
Books/Hands-on-System-Programming-with-Linux/ch4/show_curbrk.c
Books/Hands-on-System-Programming-with-Linux/ch5/membugs.c
Books/Hands-on-System-Programming-with-Linux/ch7/hello_pause.c
Books/Hands-on-System-Programming-with-Linux/ch7/query_creds.c
Books/Hands-on-System-Programming-with-Linux/ch7/rootsh_hack1.c
Books/Hands-on-System-Programming-with-Linux/ch7/rootsh_hack2.c
Books/Hands-on-System-Programming-with-Linux/ch7/savedset_demo.c
Books/Hands-on-System-Programming-with-Linux/ch8/hello_pause.c
Books/Hands-on-System-Programming-with-Linux/ch8/query_pcap.c
Books/Hands-on-System-Programming-with-Linux/ch8/set_pcap.c
Books/Hands-on-System-Programming-with-Linux/ch9/execl_eg.c
Books/Hands-on-System-Programming-with-Linux/ch9/pdfrdr_exec.c
Books/Hands-on-System-Programming-with-Linux/ch9/predcs_name.c
Books/Hands-on-System-Programming-with-Linux/ch9/successor_setnm.c
Books/Hands-on-System-Programming-with-Linux/common.c
Books/Hands-on-System-Programming-with-Linux/common.h
Books/Hands-on-System-Programming-with-Linux/misc/simple_feature_test_macros.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/A_fileio/redirct2.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch1/getreg_cr2.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/fork2c.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/forkbomb.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/pdf_rdr.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/smallbomb.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch10/zombie.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch11/atomic_A.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch11/atomic_B.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch11/donthup.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch12/killer.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch12/murder.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch12/segv_altstack.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch12/sigtmwtinfo.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch13/3intv.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/named_threads.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/pthreads_joiner3.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/pthreads_joiner4.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/pthreads_joiner_BUGGY_3.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch14/see_tid.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch15/bankacc.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch16/mt_primes1.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch16/mt_primes2.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch17/assgn2.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch18/mt_copy.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch3/segflt_nocore.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch4/memprot.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch7/query_creds.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch8/assgn1.c
Books/Hands-on-System-Programming-with-Linux/solutions_to_assgn/ch9/exec_pid_poc.c
Books/Linux-Kernel-Debugging/ch10/kthread_stuck/kthread_stuck.c
Books/Linux-Kernel-Debugging/ch10/letspanic/letspanic.c
Books/Linux-Kernel-Debugging/ch10/panic_notifier/panic_notifier_lkm.c
Books/Linux-Kernel-Debugging/ch10/workq_stall/workq_stall.c
Books/Linux-Kernel-Debugging/ch11/kgdb_try/kgdb_try.c
Books/Linux-Kernel-Debugging/ch3/miscdrv_rdwr/miscdrv_rdwr.c
Books/Linux-Kernel-Debugging/ch3/miscdrv_rdwr/rdwr_test_secret.c
Books/Linux-Kernel-Debugging/ch3/printk_loglevels/printk_loglevels.c
Books/Linux-Kernel-Debugging/ch3/ratelimit_test/ratelimit_test.c
Books/Linux-Kernel-Debugging/ch4/kprobes/1_kprobe/1_kprobe.c
Books/Linux-Kernel-Debugging/ch4/kprobes/2_kprobe/2_kprobe.c
Books/Linux-Kernel-Debugging/ch4/kprobes/3_kprobe/3_kprobe.c
Books/Linux-Kernel-Debugging/ch4/kprobes/4_kprobe_helper/helper_kp.c
Books/Linux-Kernel-Debugging/ch5/kmembugs_test/debugfs_kmembugs.c
Books/Linux-Kernel-Debugging/ch5/kmembugs_test/kmembugs_test.c
Books/Linux-Kernel-Debugging/ch7/oops_inirqv3/oops_inirqv3.c
Books/Linux-Kernel-Debugging/ch7/oops_tryv1/oops_tryv1.c
Books/Linux-Kernel-Debugging/ch7/oops_tryv2/oops_tryv2.c
Books/Linux-Kernel-Debugging/ch8/kcsan_datarace/kcsan_datarace.c
Books/Linux-Kernel-Debugging/convenient.h
Books/Linux-Kernel-Programming-Part-2/ch1/bad_miscdrv/bad_miscdrv.c
Books/Linux-Kernel-Programming-Part-2/ch1/bad_miscdrv/rdwr_test_hackit.c
Books/Linux-Kernel-Programming-Part-2/ch1/miscdrv/miscdrv.c
Books/Linux-Kernel-Programming-Part-2/ch1/miscdrv/rdwr_test.c
Books/Linux-Kernel-Programming-Part-2/ch1/miscdrv_rdwr/miscdrv_rdwr.c
Books/Linux-Kernel-Programming-Part-2/ch1/miscdrv_rdwr/rdwr_test_secret.c
Books/Linux-Kernel-Programming-Part-2/ch2/debugfs_simple_intf/debugfs_simple_intf.c
Books/Linux-Kernel-Programming-Part-2/ch2/debugfs_simple_intf/debugfs_simple_intf2.c
Books/Linux-Kernel-Programming-Part-2/ch2/ioctl_intf/ioctl_llkd.h
Books/Linux-Kernel-Programming-Part-2/ch2/ioctl_intf/kerneldrv_ioctl/ioctl_llkd_kdrv.c
Books/Linux-Kernel-Programming-Part-2/ch2/ioctl_intf/userspace_ioctl/ioctl_llkd_userspace.c
Books/Linux-Kernel-Programming-Part-2/ch2/netlink_simple_intf/kernelspace_netlink/netlink_simple_intf.c
Books/Linux-Kernel-Programming-Part-2/ch2/netlink_simple_intf/userapp_netlink/netlink_userapp.c
Books/Linux-Kernel-Programming-Part-2/ch2/procfs_simple_intf/procfs_simple_intf.c
Books/Linux-Kernel-Programming-Part-2/ch2/sysfs_simple_intf/sysfs_simple_intf.c
Books/Linux-Kernel-Programming-Part-2/ch5/delays_sleeps/delays_sleeps.c
Books/Linux-Kernel-Programming-Part-2/ch5/kthread_simple/kthread_simple.c
Books/Linux-Kernel-Programming-Part-2/ch5/sed1/sed1_driver/sed1_drv.c
Books/Linux-Kernel-Programming-Part-2/ch5/sed1/sed_common.h
Books/Linux-Kernel-Programming-Part-2/ch5/sed1/userapp_sed/userapp_sed1.c
Books/Linux-Kernel-Programming-Part-2/ch5/sed2/sed2_driver/sed2_drv.c
Books/Linux-Kernel-Programming-Part-2/ch5/sed2/sed_common.h
Books/Linux-Kernel-Programming-Part-2/ch5/sed2/userapp_sed/userapp_sed2.c
Books/Linux-Kernel-Programming-Part-2/ch5/sed3/sed3_driver/sed3_drv.c
Books/Linux-Kernel-Programming-Part-2/ch5/timer_simple/timer_simple.c
Books/Linux-Kernel-Programming-Part-2/ch5/workq_simple/workq_simple.c
Books/Linux-Kernel-Programming-Part-2/convenient.h
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch1/misc_plat/misc_plat.c
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/dbgfs_showall_threads/dbgfs_showall_threads.c
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/ioctl_undoc/ioctl_llkd.h
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/ioctl_undoc/kerneldrv_ioctl/ioctl_undoc_kdrv.c
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/ioctl_undoc/userspace_ioctl/ioctl_llkd_userspace.c
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch2/sysfs_addrxlate/sysfs_addrxlate.c
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch5/timer_simple_check/timer_simple_check.c
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch5/workq_delayed/workq_delayed.c
Books/Linux-Kernel-Programming-Part-2/solutions_to_assgn/ch5/workq_simple2/workq_simple2.c
Books/Linux-Kernel-Programming/ch11/cpu_affinity/userspc_cpuaffinity.c
Books/Linux-Kernel-Programming/ch12/1_miscdrv_rdwr_mutexlock/miscdrv_rdwr_mutexlock.c
Books/Linux-Kernel-Programming/ch12/2_miscdrv_rdwr_spinlock/miscdrv_rdwr_spinlock.c
Books/Linux-Kernel-Programming/ch13/1_rmw_atomic_bitops/rmw_atomic_bitops.c
Books/Linux-Kernel-Programming/ch13/2_percpu/percpu_var.c
Books/Linux-Kernel-Programming/ch13/3_lockdep/buggy_thrdshow_eg/thrd_showall_buggy.c
Books/Linux-Kernel-Programming/ch13/3_lockdep/deadlock_eg_AB-BA/deadlock_eg_AB-BA.c
Books/Linux-Kernel-Programming/ch13/3_lockdep/fixed_thrdshow_eg/thrd_showall_fixed.c
Books/Linux-Kernel-Programming/ch4/helloworld_lkm/helloworld_lkm.c
Books/Linux-Kernel-Programming/ch4/printk_loglvl/printk_loglvl.c
Books/Linux-Kernel-Programming/ch5/cross/helloworld_lkm.c
Books/Linux-Kernel-Programming/ch5/fp_in_lkm/fp_in_lkm.c
Books/Linux-Kernel-Programming/ch5/lkm_template/lkm_template.c
Books/Linux-Kernel-Programming/ch5/min_sysinfo/min_sysinfo.c
Books/Linux-Kernel-Programming/ch5/modparams/modparams1/modparams1.c
Books/Linux-Kernel-Programming/ch5/modparams/modparams2/modparams2.c
Books/Linux-Kernel-Programming/ch5/modstacking/core_lkm.c
Books/Linux-Kernel-Programming/ch5/modstacking/user_lkm.c
Books/Linux-Kernel-Programming/ch6/current_affairs/current_affairs.c
Books/Linux-Kernel-Programming/ch6/ebpf_stacktrace_eg/helloworld.c
Books/Linux-Kernel-Programming/ch6/foreach/prcs_showall/prcs_showall.c
Books/Linux-Kernel-Programming/ch6/foreach/thrd_showall/thrd_showall.c
Books/Linux-Kernel-Programming/ch7/show_kernel_seg/kernel_seg.c
Books/Linux-Kernel-Programming/ch8/lowlevel_mem/lowlevel_mem.c
Books/Linux-Kernel-Programming/ch8/page_exact_loop/page_exact_loop.c
Books/Linux-Kernel-Programming/ch8/slab1/slab1.c
Books/Linux-Kernel-Programming/ch8/slab2_buggy/slab2_buggy.c
Books/Linux-Kernel-Programming/ch8/slab3_maxsize/slab3_maxsize.c
Books/Linux-Kernel-Programming/ch8/slab4_actualsize/slab4_actualsize.c
Books/Linux-Kernel-Programming/ch8/slab4_actualsz_wstg_plot/slab4_actualsz_wstg_plot.c
Books/Linux-Kernel-Programming/ch9/oom_killer_try/oom_killer_try.c
Books/Linux-Kernel-Programming/ch9/poison_test/poison_test.c
Books/Linux-Kernel-Programming/ch9/slab_custom/slab_custom.c
Books/Linux-Kernel-Programming/ch9/vmalloc_demo/vmalloc_demo.c
Books/Linux-Kernel-Programming/convenient.h
Books/Linux-Kernel-Programming/klib_llkd.c
Books/Linux-Kernel-Programming/klib_llkd.h
Books/Linux-Kernel-Programming/solutions_to_assgn/ch13/miscdrv_rdwr_refcount/miscdrv_rdwr_refcount.c
Books/Linux-Kernel-Programming/solutions_to_assgn/ch5/libtest/mycaller.c
Books/Linux-Kernel-Programming/solutions_to_assgn/ch5/libtest/mylib.c
Books/Linux-Kernel-Programming/solutions_to_assgn/ch8/slab_ptr_array/slab_ptr_array.c
Books/Linux-Kernel-Programming/solutions_to_assgn/ch9/slab_custom_mult/slab_custom_mult.c
Training/L1_sysprg_trg/0_Makefile_template/killer/killer.c
Training/L1_sysprg_trg/assert_try/assert_try.c
Training/L1_sysprg_trg/assert_try/assert_try2.c
Training/L1_sysprg_trg/common.c
Training/L1_sysprg_trg/common.h
Training/L1_sysprg_trg/convenient.h
Training/L1_sysprg_trg/exec/1_exec_poc/exec_poc.c
Training/L1_sysprg_trg/exec/2_exec_envp/envp.c
Training/L1_sysprg_trg/exec/3_exec_a_script/exec_a_script.c
Training/L1_sysprg_trg/fork/fork2c/fork2c.c
Training/L1_sysprg_trg/fork/fork_data_addr/fork_data_addr.c
Training/L1_sysprg_trg/fork/fork_ret.c
Training/L1_sysprg_trg/fork/forkbomb1.c
Training/L1_sysprg_trg/fork/mysh/mysh.c
Training/L1_sysprg_trg/fork/mysh_simple/mysh_simple.c
Training/L1_sysprg_trg/fork/orphan/orphan.c
Training/L1_sysprg_trg/fork/wait_fail.c
Training/L1_sysprg_trg/fork/zombie/zombie.c
Training/L1_sysprg_trg/gdb/.correct.c
Training/L1_sysprg_trg/gdb/1_buggy.c
Training/L1_sysprg_trg/gdb/gdb_2part_solution/1_buggy.c
Training/L1_sysprg_trg/gdb/hxdump_buggy/hxdump_buggy.c
Training/L1_sysprg_trg/gdb/vaddr.c
Training/L1_sysprg_trg/helloworld/helloworld.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/mq/convenient.h
Training/L1_sysprg_trg/ipc/SYS_V_ipc/mq/mqapp.h
Training/L1_sysprg_trg/ipc/SYS_V_ipc/mq/msg1_r.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/mq/msg1_w.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/beej/semdemo.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/beej/semrm.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/sem1.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/sem2.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/real/sem_lib.h
Training/L1_sysprg_trg/ipc/SYS_V_ipc/sem/simple/sem1.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/shm/hdr_shm.h
Training/L1_sysprg_trg/ipc/SYS_V_ipc/shm/shm1_r.c
Training/L1_sysprg_trg/ipc/SYS_V_ipc/shm/shm1_w.c
Training/L1_sysprg_trg/ipc/mmap_ipc/fileio_mmap/mmap_fileio.c
Training/L1_sysprg_trg/ipc/mmap_ipc/fileio_mmap/restart_lib.h
Training/L1_sysprg_trg/ipc/mmap_ipc/mmap_simple/convenient.h
Training/L1_sysprg_trg/ipc/mmap_ipc/mmap_simple/mmap_simple.c
Training/L1_sysprg_trg/ipc/mmap_ipc/mmap_simple/restart_lib.h
Training/L1_sysprg_trg/ipc/pipes/fifos/rd_fifo.c
Training/L1_sysprg_trg/ipc/pipes/fifos/wr_fifo.c
Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/no_pclose_zomb.c
Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/pipe-dup2.c
Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/pipe1.c
Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/pipe2.c
Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/popen_tst.c
Training/L1_sysprg_trg/ipc/pipes/unnamed_pipes/whopipe.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_message_queue_child.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_message_queue_parent.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_semaphore_child.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_semaphore_parent.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_shared_memory_child.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/posix_shared_memory_parent.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_message_queue_file_child.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_message_queue_file_parent.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_semaphore_file_child.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_semaphore_file_parent.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_shared_memory_file_child.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_shared_memory_file_parent.c
Training/L1_sysprg_trg/ipc/posix_ipc/hildstrom_ipc_sysv_posix/sysv_shared_memory_private.c
Training/L1_sysprg_trg/ipc/posix_ipc/mq_posix/recv_mq.c
Training/L1_sysprg_trg/ipc/posix_ipc/mq_posix/sender_mq.c
Training/L1_sysprg_trg/makefile_templ/hdr_var/audio/s4.c
Training/L1_sysprg_trg/makefile_templ/hdr_var/engine/s3.c
Training/L1_sysprg_trg/makefile_templ/hdr_var/hdr.h
Training/L1_sysprg_trg/makefile_templ/hdr_var/main.c
Training/L1_sysprg_trg/makefile_templ/hdr_var/s2.c
Training/L1_sysprg_trg/makefile_templ/simple1/audio/s4.c
Training/L1_sysprg_trg/makefile_templ/simple1/engine/s3.c
Training/L1_sysprg_trg/makefile_templ/simple1/main.c
Training/L1_sysprg_trg/makefile_templ/simple1/s2.c
Training/L1_sysprg_trg/memory/vaddr_process.c
Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/client_any/client_any.c
Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/select_svr_chat/convenient.h
Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/select_svr_chat/selectserver.c
Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/showip_getaddrinfo/convenient.h
Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/showip_getaddrinfo/showip.c
Training/L1_sysprg_trg/net_sockets/inet_domain/beej_newer/showip_getaddrinfo/showip_port.c
Training/L1_sysprg_trg/net_sockets/inet_domain/cpudtl_tstsvr/cpudtl_tstsvr.c
Training/L1_sysprg_trg/net_sockets/inet_domain/fingr_cs/cfingr.c
Training/L1_sysprg_trg/net_sockets/inet_domain/fingr_cs/convenient.h
Training/L1_sysprg_trg/net_sockets/inet_domain/fingr_cs/fingr.h
Training/L1_sysprg_trg/net_sockets/inet_domain/fingr_cs/sfingr.c
Training/L1_sysprg_trg/net_sockets/inet_domain/mt_finger/cfingr.c
Training/L1_sysprg_trg/net_sockets/inet_domain/mt_finger/convenient.h
Training/L1_sysprg_trg/net_sockets/inet_domain/mt_finger/inet.h
Training/L1_sysprg_trg/net_sockets/inet_domain/mt_finger/mt_sfingr.c
Training/L1_sysprg_trg/net_sockets/inet_domain/server_pre_threaded/svr_pre_mt.c
Training/L1_sysprg_trg/net_sockets/unix_domain/unet.h
Training/L1_sysprg_trg/net_sockets/unix_domain/unix_cli.c
Training/L1_sysprg_trg/net_sockets/unix_domain/unix_svr.c
Training/L1_sysprg_trg/net_sockets/zero_copy_sendfile/restart_lib.h
Training/L1_sysprg_trg/net_sockets/zero_copy_sendfile/xfer_file.c
Training/L1_sysprg_trg/pthreads/0_Makefile_template_pthreads/cr8ManyThrds/cr8ManyThrds.c
Training/L1_sysprg_trg/pthreads/assgn_robbins/prg12.9.c
Training/L1_sysprg_trg/pthreads/assgn_robbins/whichexit.c
Training/L1_sysprg_trg/pthreads/isit_atomic/isit_atomic.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/convenient.h
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/fork_test.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/libpk.h
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/matrixmul-dbg.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt1.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt2-join.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt3-matrixmul.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt4-condvar.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pt4-condvar.orig.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/pthread_test.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/stacksz.c
Training/L1_sysprg_trg/pthreads/llnl-tut-prgs/stacksz_old.c
Training/L1_sysprg_trg/pthreads/main_dies/main_dies.c
Training/L1_sysprg_trg/pthreads/main_dies/worker_dies.c
Training/L1_sysprg_trg/pthreads/misc/cr8ManyThrds/buggy_manythrds/cr8ManyThrds.c
Training/L1_sysprg_trg/pthreads/misc/cr8ManyThrds/cr8ManyThrds.c
Training/L1_sysprg_trg/pthreads/misc/forking_MT_prcs/mt_fork_exec.c
Training/L1_sysprg_trg/pthreads/misc/pthrd_attr_getset/attr_setget.c
Training/L1_sysprg_trg/pthreads/misc/rlim_pthrds/rlim_threads.c
Training/L1_sysprg_trg/pthreads/sched/sched_prios/sched_prios.c
Training/L1_sysprg_trg/pthreads/sched/sched_pthrd_rtprio/libpk.h
Training/L1_sysprg_trg/pthreads/sched/sched_pthrd_rtprio/sched_pthrd_rtprio.c
Training/L1_sysprg_trg/pthreads/sched/tmslice/tmslc.c
Training/L1_sysprg_trg/pthreads/signalling_mt/tsig.c
Training/L1_sysprg_trg/pthreads/speed_thrdprcs_simple/create_destroy/fork_test.c
Training/L1_sysprg_trg/pthreads/speed_thrdprcs_simple/create_destroy/pthread_test.c
Training/L1_sysprg_trg/pthreads/speed_thrdprcs_simple/matrixmul/prcs_matrixmul/prcs_matrixmul.c
Training/L1_sysprg_trg/pthreads/speed_thrdprcs_simple/matrixmul/thrd_matrixmul/thrd_matrixmul.c
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/alt_functions.h
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/error_functions.c
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/error_functions.h
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/get_num.h
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tlpi_hdr.h
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/convenient.h
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/strerror.c
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/strerror_test.c
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/strerror_tls.c
Training/L1_sysprg_trg/pthreads/tlpi_TLS_TSD/tsd_and_tls/strerror_tsd.c
Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/alt_functions.h
Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/error_functions.c
Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/error_functions.h
Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/get_num.h
Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/thread_cancel.c
Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/thread_cleanup.c
Training/L1_sysprg_trg/pthreads/tlpi_code_cancel_cleanup/tlpi_hdr.h
Training/L1_sysprg_trg/pthreads/tls_eg/strerror.c
Training/L1_sysprg_trg/pthreads/tls_eg/strerror_tls.c
Training/L1_sysprg_trg/restart_lib-Robbins.c
Training/L1_sysprg_trg/setuid_caps/pr_ids/pr_ids.c
Training/L1_sysprg_trg/setuid_caps/savedset_ids/savedset_ids.c
Training/L1_sysprg_trg/signalling/chld_sig/chld_sig.c
Training/L1_sysprg_trg/signalling/handle_segfault/handle_segv/handle_segv.c
Training/L1_sysprg_trg/signalling/handle_segfault/handle_segv_altstack/handle_segv_altstack.c
Training/L1_sysprg_trg/signalling/handle_segfault/stackmem_corrupt/stackmem_corrupt.c
Training/L1_sysprg_trg/signalling/killer.c
Training/L1_sysprg_trg/signalling/nano.c
Training/L1_sysprg_trg/signalling/sanodef.c
Training/L1_sysprg_trg/signalling/sig1.c
Training/L1_sysprg_trg/signalling/sig2.c
Training/L1_sysprg_trg/signalling/sigcrit.c
Training/L1_sysprg_trg/signalling/sigfd_man_eg.c
Training/L1_sysprg_trg/signalling/sigq/sigq_rcv.c
Training/L1_sysprg_trg/signalling/sigq/sigq_snd.c
Training/L1_sysprg_trg/signalling/zombies_clear_linux26.c
Training/L1_sysprg_trg/signalling/zombies_clear_traditional.c
Training/L1_sysprg_trg/size_pdatatype.c
Training/L1_sysprg_trg/wip/feature_test_macros/featr_test_macs.c
Training/L1_sysprg_trg/wip/systemd_svcunit/primegen/primegen.c
Training/L2_kernel_trg/convenient.h
Training/L2_kernel_trg/foreach/prcs_show/foreach.c
Training/L2_kernel_trg/foreach/prcs_show/rdtasks.c
Training/L2_kernel_trg/foreach/thrd_show/showthreads.c
Training/L2_kernel_trg/helloworld/hello.c
Training/L2_kernel_trg/list/list.c
Training/L2_kernel_trg/lkm_template/lkm_template.c
Training/L2_kernel_trg/mm/allocsize_tests/kmalloc_test/kmalloc_test.c
Training/L2_kernel_trg/mm/allocsize_tests/ksize_test/ksz_test.c
Training/L2_kernel_trg/mm/slab_custom/slab_custom.c
Training/L2_kernel_trg/mm/vm_show_kernel_seg/convenient.h
Training/L2_kernel_trg/mm/vm_show_kernel_seg/vm_show_kernel_seg.c
Training/L2_kernel_trg/mm/vm_usermode/gen_malloc_pgfault/gen_malloc_pgfault.c
Training/L2_kernel_trg/mm/vm_usermode/hello.c
Training/L2_kernel_trg/mm/vm_usermode/malloc_brk_test.c
Training/L2_kernel_trg/mm/vm_usermode/mem_sequence.c
Training/L2_kernel_trg/mm/vm_usermode/mmap/fileio_mmap/mmap_fileio.c
Training/L2_kernel_trg/mm/vm_usermode/mmap/fileio_mmap/reg_fileio.c
Training/L2_kernel_trg/mm/vm_usermode/mmap/fileio_mmap/restart_lib.h
Training/L2_kernel_trg/mm/vm_usermode/mmap/mmap_simple/mmap_simple.c
Training/L2_kernel_trg/mm/vm_usermode/mmap/mmap_simple/restart_lib.h
Training/L2_kernel_trg/mm/vm_usermode/oom_try/oom-killer-try.c
Training/L2_kernel_trg/mm/vm_usermode/oom_try/rdpg_oom_try.c
Training/L2_kernel_trg/mm/vm_usermode/segv_pgfault.c
Training/L2_kernel_trg/mm/vm_usermode/vm_user.c
Training/L2_kernel_trg/mm/xtras/malloc_brk_test.c
Training/L2_kernel_trg/mm/xtras/segv_pgfault.c
Training/L2_kernel_trg/mm/xtras/trick.c
Training/L2_kernel_trg/mm/xtras/vm_vas/vm_user.c
Training/L2_kernel_trg/sched/sched_pthrd_app/libpk.h
Training/L2_kernel_trg/sched/sched_pthrd_app/sched_pthrd.c
Training/L2_kernel_trg/show_monolithic/show_monolithic.c
Training/L2_kernel_trg/taskdtl/taskdtl_display.c
Training/L2_kernel_trg/taskdtl/taskdtl_miscdrv/taskdtl_miscdrv.c
Training/L2_kernel_trg/taskdtl/taskdtl_raw/taskdtl.c
Training/L3_dd_trg/2.6k_chardrv_template/chardrv_template.c
Training/L3_dd_trg/blockdrv/older_sbd/sbd.c
Training/L3_dd_trg/blockdrv/sblkdev/convenient.h
Training/L3_dd_trg/blockdrv/sblkdev/device.c
Training/L3_dd_trg/blockdrv/sblkdev/device.h
Training/L3_dd_trg/blockdrv/sblkdev/main.c
Training/L3_dd_trg/convenient.h
Training/L3_dd_trg/cz_chardrv/badcdrv/app_badread.c
Training/L3_dd_trg/cz_chardrv/badcdrv/badcdrv.c
Training/L3_dd_trg/cz_chardrv/cz.c
Training/L3_dd_trg/cz_chardrv/cz.mod.c
Training/L3_dd_trg/cz_chardrv/cz_enh.c
Training/L3_dd_trg/cz_chardrv/cz_enh.mod.c
Training/L3_dd_trg/cz_chardrv/mmap_cz/cz_mmap.c
Training/L3_dd_trg/cz_chardrv/mmap_cz/mmap_tst.c
Training/L3_dd_trg/cz_chardrv/rd_tst.c
Training/L3_dd_trg/cz_chardrv/wr_tst.c
Training/L3_dd_trg/dt_platform_drv/dtdemo_platformdrv/dtdemo_platdrv.c
Training/L3_dd_trg/dt_platform_drv/platform_devdrv_demo/platdemo.c
Training/L3_dd_trg/dt_platform_drv/rtc_ds3231/convenient.h
Training/L3_dd_trg/dt_platform_drv/rtc_ds3231/ds3231.c
Training/L3_dd_trg/dt_platform_drv/rtc_ds3231/uapp.c
Training/L3_dd_trg/input_drv_mouse/coord_gen.c
Training/L3_dd_trg/input_drv_mouse/input_drv_mouse.c
Training/L3_dd_trg/ioctl_kernel_poc/convenient.h
Training/L3_dd_trg/ioctl_kernel_poc/ioctl_kdrv.c
Training/L3_dd_trg/ioctl_kernel_poc/ioctl_kdrv.h
Training/L3_dd_trg/ioctl_kernel_poc/ioctl_user_test.c
Training/L3_dd_trg/irq_work/irq_work.c
Training/L3_dd_trg/kthread_demo/ktdemo.c
Training/L3_dd_trg/ktime_stuff/ktimers/ktimers.c
Training/L3_dd_trg/ktime_stuff/time_lld_cookbk/time.c
Training/L3_dd_trg/ldm_template_drv/ldm_template_drv.c
Training/L3_dd_trg/lkm_template/lkm_template.c
Training/L3_dd_trg/miscmj_chardrv/miscmj_cdrv.c
Training/L3_dd_trg/older/intr_ctx/intr_work.c
Training/L3_dd_trg/older/sysfs_sample_parrot_drv/parrot_driver.c
Training/L3_dd_trg/older/sysfs_sample_parrot_drv/parrot_driver.h
Training/L3_dd_trg/sleepy_waitq/rd_tst.c
Training/L3_dd_trg/sleepy_waitq/slpy.c
Training/L3_dd_trg/sleepy_waitq/wr_tst.c
Training/L3_dd_trg/workq_slpydrv_plus_timer/workq_slpydrv.c
Training/L5_debug_trg/1_buggy_gdb_usermode/.1_correct.c
Training/L5_debug_trg/1_buggy_gdb_usermode/1_buggy.c
Training/L5_debug_trg/1_buggy_gdb_usermode/1buggy_segv_handler/1buggy_segv_handler.c
Training/L5_debug_trg/1_buggy_gdb_usermode/gdb_2part_solution/1_buggy.c
Training/L5_debug_trg/1_buggy_gdb_usermode/vaddr.c
Training/L5_debug_trg/1by10.c
Training/L5_debug_trg/kernel_debug/convenient.c
Training/L5_debug_trg/kernel_debug/convenient.h
Training/L5_debug_trg/kernel_debug/convenient_simpler.h
Training/L5_debug_trg/kernel_debug/ctemplate.c
Training/L5_debug_trg/kernel_debug/debugfs/01_debugfs_all_eg/debugfs_eg.c
Training/L5_debug_trg/kernel_debug/debugfs/assgn_debugfs/assgn_debugfs.c
Training/L5_debug_trg/kernel_debug/debugfs/showthrds_dbgfs/convenient.h
Training/L5_debug_trg/kernel_debug/debugfs/showthrds_dbgfs/showthrds_dbgfs.c
Training/L5_debug_trg/kernel_debug/hello_gdb/hello_gdb.c
Training/L5_debug_trg/kernel_debug/ioctl/convenient.h
Training/L5_debug_trg/kernel_debug/ioctl/ioctl_kdrv.c
Training/L5_debug_trg/kernel_debug/ioctl/ioctl_kdrv.h
Training/L5_debug_trg/kernel_debug/ioctl/user_test.c
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/lab_oops_hang_panic/hang_panic.c
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/miscdrv_rdwr_buggy/miscdrv_rdwr.c
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/miscdrv_rdwr_buggy/rdwr_test_secret.c
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/oops1/oops1.c
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/oops2/convenient.h
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/oops2/oops2.c
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/panic_notifier/convenient.h
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/panic_notifier/panic_handler_lkm.c
Training/L5_debug_trg/kernel_debug/k_oops_warn_panic/warn_bug_try/warn_bug_try.c
Training/L5_debug_trg/kernel_debug/kmemleak_kmemcheck_test/kmemchk_test.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/1_kp_simple/kp_intr.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/1_kp_simple/kp_sched.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/1_kp_simple/kp_sys_open.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/2_helper_kp/convenient.h
Training/L5_debug_trg/kernel_debug/kprobes_stuff/2_helper_kp/helper_kp.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/2_helper_kp/kp_hello_oops.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/3_jprobes_simple/jprobe_eg.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/4_helper_jp_probeit/convenient.h
Training/L5_debug_trg/kernel_debug/kprobes_stuff/4_helper_jp_probeit/jp_helper_template.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/5_jkret_helper/helper_jkret.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/6_kp_kretp_kmalloc/kp_kretp_kmalloc.c
Training/L5_debug_trg/kernel_debug/kprobes_stuff/convenient.h
Training/L5_debug_trg/kernel_debug/membugs_kasan/membugs_kasan.c
Training/L5_debug_trg/kernel_debug/panic_notifier/convenient.h
Training/L5_debug_trg/kernel_debug/panic_notifier/pnc.c
Training/L5_debug_trg/kernel_debug/stkovf/stkovf.c
Training/L5_debug_trg/kernel_debug/to_debug_assgn/lab1_simple_oops/oops_lab.c
Training/L5_debug_trg/kernel_debug/to_debug_assgn/lab2_oops_hang_panic/hang_panic.c
Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/netdriver/buggy_veth_netdrv.c
Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/netdriver/debugfs_veth.c
Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/netdriver/veth_common.h
Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/userspc/listener_dgram.c
Training/L5_debug_trg/kernel_debug/to_debug_assgn/netdrv_buggy/userspc/talker_dgram.c
Training/L5_debug_trg/stackmem_corrupt/stackmem_corrupt.c
/usr/include/alloca.h
/usr/include/arpa/inet.h
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/limits.h
/usr/include/linux/cdrom.h
/usr/include/linux/errno.h
/usr/include/linux/ethtool.h
/usr/include/linux/fs.h
/usr/include/linux/gpio.h
/usr/include/linux/hdreg.h
/usr/include/linux/i2c.h
/usr/include/linux/input.h
/usr/include/linux/ioctl.h
/usr/include/linux/ip.h
/usr/include/linux/kernel.h
/usr/include/linux/limits.h
/usr/include/linux/module.h
/usr/include/linux/netdevice.h
/usr/include/linux/netlink.h
/usr/include/linux/ptrace.h
/usr/include/linux/random.h
/usr/include/linux/rtc.h
/usr/include/linux/sched.h
/usr/include/linux/signal.h
/usr/include/linux/types.h
/usr/include/linux/udp.h
/usr/include/linux/version.h
/usr/include/linux/wait.h
/usr/include/locale.h
/usr/include/malloc.h
/usr/include/math.h
/usr/include/mqueue.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/pthread.h
/usr/include/pwd.h
/usr/include/sched.h
/usr/include/semaphore.h
/usr/include/signal.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/strings.h
/usr/include/time.h
/usr/include/ucontext.h
/usr/include/unistd.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/linux/const.h
/usr/include/linux/fscrypt.h
/usr/include/linux/if.h
/usr/include/linux/if_ether.h
/usr/include/linux/if_link.h
/usr/include/linux/if_packet.h
/usr/include/linux/irqnr.h
/usr/include/linux/mount.h
/usr/include/linux/posix_types.h
/usr/include/linux/socket.h
/usr/include/linux/sysinfo.h
/usr/include/rpc/netdb.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/libc-compat.h
/usr/include/linux/stddef.h
/usr/include/stdc-predef.h
